{
  "$schema": "https://encore.dev/schemas/infra.schema.json",
  "metadata": {
    "app_id": "skyforge",
    "env_name": "production",
    "env_type": "production",
    "cloud": "local",
    "base_url": "http://skyforge-server:8085"
  },
  "sql_servers": [
    {
      "host": "db:5432",
      "databases": {
        "skyforge_server": {
          "username": "skyforge_server",
          "password": {
            "$env": "SKYFORGE_DB_PASSWORD"
          },
          "max_connections": 50,
          "min_connections": 5
        }
      }
    }
  ],
  "object_storage": [
    {
      "type": "s3",
      "region": "us-east-1",
      "endpoint": "http://minio:9000",
      "access_key_id": "minioadmin",
      "secret_access_key": "minioadmin",
      "buckets": {
        "skyforge": {
          "name": "skyforge",
          "public_base_url": "http://minio:9000/skyforge"
        }
      }
    }
  ],
  "pubsub": [
    {
      "type": "nsq",
      "hosts": "nsq:4150",
      "topics": {
        "skyforge-task-cancel": {
          "name": "skyforge-task-cancel",
          "subscriptions": {
            "skyforge-task-worker-cancel": {
              "name": "skyforge-task-worker-cancel"
            }
          }
        },
        "skyforge-task-queue-interactive": {
          "name": "skyforge-task-queue-interactive",
          "subscriptions": {
            "skyforge-task-worker": {
              "name": "skyforge-task-worker"
            }
          }
        },
        "skyforge-task-queue-background": {
          "name": "skyforge-task-queue-background",
          "subscriptions": {
            "skyforge-task-worker-background": {
              "name": "skyforge-task-worker-background"
            }
          }
        },
        "skyforge-task-status": {
          "name": "skyforge-task-status",
          "subscriptions": {
            "skyforge-task-status-handler": {
              "name": "skyforge-task-status-handler"
            }
          }
        },
        "skyforge-maintenance": {
          "name": "skyforge-maintenance",
          "subscriptions": {
            "skyforge-maintenance-worker": {
              "name": "skyforge-maintenance-worker"
            }
          }
        }
      }
    }
  ],
  "redis": {
    "default": {
      "host": "redis:6379",
      "database_index": 0,
      "key_prefix": "skyforge"
    }
  },
  "graceful_shutdown": {
    "total": 30,
    "shutdown_hooks": 10,
    "handlers": 20
  },
  "secrets": {
    "SKYFORGE_SESSION_SECRET": { "$env": "SKYFORGE_SESSION_SECRET" },
    "SKYFORGE_ADMIN_PASSWORD": { "$env": "SKYFORGE_ADMIN_PASSWORD" },
    "SKYFORGE_OIDC_CLIENT_ID": { "$env": "SKYFORGE_OIDC_CLIENT_ID" },
    "SKYFORGE_OIDC_CLIENT_SECRET": { "$env": "SKYFORGE_OIDC_CLIENT_SECRET" },
    "SKYFORGE_LDAP_URL": { "$env": "SKYFORGE_LDAP_URL" },
    "SKYFORGE_LDAP_BIND_TEMPLATE": { "$env": "SKYFORGE_LDAP_BIND_TEMPLATE" },
    "SKYFORGE_LDAP_LOOKUP_BINDDN": { "$env": "SKYFORGE_LDAP_LOOKUP_BINDDN" },
    "SKYFORGE_LDAP_LOOKUP_BINDPASSWORD": { "$env": "SKYFORGE_LDAP_LOOKUP_BINDPASSWORD" },
    "SKYFORGE_DB_PASSWORD": { "$env": "SKYFORGE_DB_PASSWORD" },
    "SKYFORGE_GITEA_PASSWORD": { "$env": "SKYFORGE_GITEA_PASSWORD" },
    "SKYFORGE_OBJECT_STORAGE_ROOT_USER": { "$env": "SKYFORGE_OBJECT_STORAGE_ROOT_USER" },
    "SKYFORGE_OBJECT_STORAGE_ROOT_PASSWORD": { "$env": "SKYFORGE_OBJECT_STORAGE_ROOT_PASSWORD" },
    "SKYFORGE_OBJECT_STORAGE_TERRAFORM_ACCESS_KEY": { "$env": "SKYFORGE_OBJECT_STORAGE_TERRAFORM_ACCESS_KEY" },
    "SKYFORGE_OBJECT_STORAGE_TERRAFORM_SECRET_KEY": { "$env": "SKYFORGE_OBJECT_STORAGE_TERRAFORM_SECRET_KEY" },
    "SKYFORGE_CONTAINERLAB_JWT_SECRET": { "$env": "SKYFORGE_CONTAINERLAB_JWT_SECRET" },
    "SKYFORGE_PKI_CA_CERT": { "$env": "SKYFORGE_PKI_CA_CERT" },
    "SKYFORGE_PKI_CA_KEY": { "$env": "SKYFORGE_PKI_CA_KEY" },
    "SKYFORGE_SSH_CA_KEY": { "$env": "SKYFORGE_SSH_CA_KEY" },
    "SKYFORGE_INTERNAL_TOKEN": { "$env": "SKYFORGE_INTERNAL_TOKEN" },
    "SKYFORGE_LABPP_NETBOX_USERNAME": { "$env": "SKYFORGE_LABPP_NETBOX_USERNAME" },
    "SKYFORGE_LABPP_NETBOX_PASSWORD": { "$env": "SKYFORGE_LABPP_NETBOX_PASSWORD" },
    "SKYFORGE_LABPP_NETBOX_TOKEN": { "$env": "SKYFORGE_LABPP_NETBOX_TOKEN" },
    "SKYFORGE_LABPP_S3_ACCESS_KEY": { "$env": "SKYFORGE_LABPP_S3_ACCESS_KEY" },
    "SKYFORGE_LABPP_S3_SECRET_KEY": { "$env": "SKYFORGE_LABPP_S3_SECRET_KEY" },
    "YAADE_ADMIN_PASSWORD": { "$env": "YAADE_ADMIN_PASSWORD" }
  },
  "env": {
    "SKYFORGE_DB_HOST": "db",
    "SKYFORGE_DB_PORT": "5432",
    "SKYFORGE_DB_NAME": "skyforge_server",
    "SKYFORGE_DB_USER": "skyforge_server",
    "SKYFORGE_DB_SSLMODE": "disable",
    "SKYFORGE_OBJECT_STORAGE_ENDPOINT": "minio:9000",
    "SKYFORGE_OBJECT_STORAGE_USE_SSL": "false",
    "APP_VERSION": "${APP_VERSION}",
    "BUILD_TIME": "${BUILD_TIME}",
    "UI_VERSION": "${UI_VERSION}"
  }
}
