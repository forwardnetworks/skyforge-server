import{a as e}from"./rolldown-runtime-DAKAggwm.js";import{a as t,c as n,d as r,f as i,h as a,i as o,l as s,m as c,n as l,o as u,p as d,r as f,s as p,t as m,u as h}from"./tanstack-BEm8Qe8X.js";import{$ as g,$n as ee,$t as _,A as v,An as te,At as ne,B as re,Bn as ie,Bt as ae,C as y,Cn as b,Ct as x,D as S,Dn as oe,Dt as se,E as ce,En as le,Et as C,F as ue,Fn as w,Ft as T,G as de,Gn as fe,Gt as E,H as pe,Hn as me,Ht as he,I as ge,In as _e,It as ve,J as ye,Jn as be,Jt as xe,K as Se,Kn as D,Kt as Ce,L as we,Ln as Te,Lt as Ee,M as De,Mn as Oe,Mt as ke,N as Ae,Nn as je,Nt as Me,O,On as Ne,Ot as Pe,P as Fe,Pn as Ie,Pt as Le,Q as Re,Qn as ze,Qt as Be,R as Ve,Rn as He,Rt as Ue,S as We,Sn as Ge,St as Ke,T as qe,Tn as Je,Tt as Ye,U as Xe,Un as Ze,Ut as Qe,V as $e,Vn as et,Vt as tt,W as nt,Wn as rt,Wt as it,X as at,Xn as ot,Xt as st,Y as ct,Yn as lt,Yt as ut,Z as dt,Zn as ft,Zt as k,_ as pt,_n as mt,_t as ht,a as A,an as gt,ar as _t,at as vt,b as yt,bn as bt,bt as xt,c as St,cn as Ct,ct as wt,d as Tt,dn as Et,dt as Dt,en as Ot,er as kt,et as At,f as jt,fn as Mt,ft as Nt,g as Pt,gn as Ft,gt as It,h as Lt,hn as Rt,ht as zt,i as Bt,in as Vt,it as j,j as Ht,jn as Ut,jt as Wt,k as Gt,kn as Kt,kt as qt,l as Jt,ln as Yt,lt as Xt,m as Zt,mn as Qt,mt as $t,n as en,nn as tn,nr as nn,nt as rn,o as an,on,or as sn,ot as cn,p as ln,pn as un,pt as dn,q as fn,qn as pn,qt as mn,r as hn,rn as gn,rt as _n,s as vn,sn as yn,st as bn,t as xn,tn as Sn,tr as Cn,tt as wn,u as Tn,un as En,ut as Dn,v as On,vn as kn,vt as An,w as jn,wn as Mn,wt as Nn,x as Pn,xn as Fn,xt as In,y as Ln,yn as Rn,yt as zn,z as Bn,zn as Vn,zt as Hn}from"./react-7u7ZcmS7.js";import{n as Un,r as Wn,t as Gn}from"./ui-utils-l2x0dF3k.js";import{a as Kn,c as qn,i as Jn,n as Yn,o as Xn,r as Zn,s as Qn,t as $n}from"./vendor-eD_tp6fL.js";(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var er=e(nn(),1),M=e(sn(),1);function N(...e){return Un(Wn(e))}var P=_t(),tr=se,nr=C,rr=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Ye,{ref:n,className:N(`fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t}));rr.displayName=Ye.displayName;var ir=M.forwardRef(({className:e,children:t,...n},r)=>(0,P.jsxs)(nr,{children:[(0,P.jsx)(rr,{}),(0,P.jsxs)(x,{ref:r,className:N(`fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg`,e),...n,children:[t,(0,P.jsxs)(Ke,{className:`absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground`,children:[(0,P.jsx)(Wt,{className:`h-4 w-4`}),(0,P.jsx)(`span`,{className:`sr-only`,children:`Close`})]})]})]}));ir.displayName=x.displayName;var ar=({className:e,...t})=>(0,P.jsx)(`div`,{className:N(`flex flex-col space-y-1.5 text-center sm:text-left`,e),...t});ar.displayName=`DialogHeader`;var or=({className:e,...t})=>(0,P.jsx)(`div`,{className:N(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});or.displayName=`DialogFooter`;var sr=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Pe,{ref:n,className:N(`text-lg font-semibold leading-none tracking-tight`,e),...t}));sr.displayName=Pe.displayName;var cr=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Nn,{ref:n,className:N(`text-sm text-muted-foreground`,e),...t}));cr.displayName=Nn.displayName;var lr=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(xt,{ref:n,className:N(`flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground`,e),...t}));lr.displayName=xt.displayName;var ur=({children:e,...t})=>(0,P.jsx)(tr,{...t,children:(0,P.jsx)(ir,{className:`overflow-hidden p-0 shadow-lg`,children:(0,P.jsx)(lr,{className:`[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5`,children:e})})}),dr=M.forwardRef(({className:e,...t},n)=>(0,P.jsxs)(`div`,{className:`flex items-center border-b px-3`,"cmdk-input-wrapper":``,children:[(0,P.jsx)(k,{className:`mr-2 h-4 w-4 shrink-0 opacity-50`}),(0,P.jsx)(xt.Input,{ref:n,className:N(`flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50`,e),...t})]}));dr.displayName=xt.Input.displayName;var fr=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(xt.List,{ref:n,className:N(`max-h-[300px] overflow-y-auto overflow-x-hidden`,e),...t}));fr.displayName=xt.List.displayName;var pr=M.forwardRef((e,t)=>(0,P.jsx)(xt.Empty,{ref:t,className:`py-6 text-center text-sm`,...e}));pr.displayName=xt.Empty.displayName;var mr=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(xt.Group,{ref:n,className:N(`overflow-hidden p-1 text-popover-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground`,e),...t}));mr.displayName=xt.Group.displayName;var hr=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(xt.Separator,{ref:n,className:N(`-mx-1 h-px bg-border`,e),...t}));hr.displayName=xt.Separator.displayName;var gr=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(xt.Item,{ref:n,className:N(`relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...t}));gr.displayName=xt.Item.displayName;var _r=({className:e,...t})=>(0,P.jsx)(`span`,{className:N(`ml-auto text-xs tracking-widest text-muted-foreground`,e),...t});_r.displayName=`CommandShortcut`;function vr(){let[e,t]=M.useState(!1),r=n();M.useEffect(()=>{let e=e=>{e.key===`k`&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),t(e=>!e))};return document.addEventListener(`keydown`,e),()=>document.removeEventListener(`keydown`,e)},[]);let i=M.useCallback(e=>{t(!1),e()},[]);return(0,P.jsxs)(ur,{open:e,onOpenChange:t,children:[(0,P.jsx)(dr,{placeholder:`Type a command or search...`}),(0,P.jsxs)(fr,{children:[(0,P.jsx)(pr,{children:`No results found.`}),(0,P.jsxs)(mr,{heading:`Suggestions`,children:[(0,P.jsxs)(gr,{onSelect:()=>i(()=>r({to:`/status`})),children:[(0,P.jsx)(Qt,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Dashboard`})]}),(0,P.jsxs)(gr,{onSelect:()=>i(()=>r({to:`/dashboard/deployments`})),children:[(0,P.jsx)(Je,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Deployments`})]}),(0,P.jsxs)(gr,{onSelect:()=>i(()=>r({to:`/status`})),children:[(0,P.jsx)(Cn,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Platform Status`})]})]}),(0,P.jsx)(hr,{}),(0,P.jsx)(mr,{heading:`Infrastructure`,children:(0,P.jsxs)(gr,{onSelect:()=>i(()=>r({to:`/dashboard/s3`})),children:[(0,P.jsx)(st,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Artifacts (S3)`})]})}),(0,P.jsx)(hr,{}),(0,P.jsxs)(mr,{heading:`Events & Monitoring`,children:[(0,P.jsxs)(gr,{onSelect:()=>i(()=>r({to:`/notifications`})),children:[(0,P.jsx)(ze,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Notifications`})]}),(0,P.jsxs)(gr,{onSelect:()=>i(()=>r({to:`/webhooks`})),children:[(0,P.jsx)(Me,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Webhooks`})]}),(0,P.jsxs)(gr,{onSelect:()=>i(()=>r({to:`/syslog`})),children:[(0,P.jsx)(kn,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Syslog`})]}),(0,P.jsxs)(gr,{onSelect:()=>i(()=>r({to:`/snmp`})),children:[(0,P.jsx)(mn,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`SNMP Traps`})]})]})]})]})}function yr(){let e=s({select:e=>e.status===`pending`}),[t,n]=M.useState(!1);return M.useEffect(()=>{let t;return e?n(!0):t=setTimeout(()=>n(!1),500),()=>clearTimeout(t)},[e]),t?(0,P.jsx)(`div`,{className:N(`fixed top-0 left-0 z-[100] h-1 w-full bg-transparent overflow-hidden`),children:(0,P.jsx)(`div`,{className:N(`h-full w-full bg-primary/80 origin-left animate-progress`)})}):null}var br=(0,M.createContext)({theme:`system`,setTheme:()=>null});function xr({children:e,defaultTheme:t=`system`,storageKey:n=`vite-ui-theme`}){let[r,i]=(0,M.useState)(()=>localStorage.getItem(n)||t);(0,M.useEffect)(()=>{let e=window.document.documentElement;if(e.classList.remove(`light`,`dark`),r===`system`){let t=window.matchMedia(`(prefers-color-scheme: dark)`).matches?`dark`:`light`;e.classList.add(t);return}e.classList.add(r)},[r]);let a={theme:r,setTheme:e=>{localStorage.setItem(n,e),i(e)}};return(0,P.jsx)(br.Provider,{value:a,children:e})}const Sr=()=>{let e=(0,M.useContext)(br);if(e===void 0)throw Error(`useTheme must be used within a ThemeProvider`);return e};var Cr=Gn(`inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0`,{variants:{variant:{default:`bg-primary text-primary-foreground hover:bg-primary/90`,destructive:`bg-destructive text-destructive-foreground hover:bg-destructive/90`,outline:`border border-input bg-background hover:bg-accent hover:text-accent-foreground`,secondary:`bg-secondary text-secondary-foreground hover:bg-secondary/80`,ghost:`hover:bg-accent hover:text-accent-foreground`,link:`text-primary underline-offset-4 hover:underline`},size:{default:`h-10 px-4 py-2`,sm:`h-9 rounded-md px-3`,lg:`h-11 rounded-md px-8`,icon:`h-10 w-10`}},defaultVariants:{variant:`default`,size:`default`}}),F=M.forwardRef(({className:e,variant:t,size:n,...r},i)=>(0,P.jsx)(`button`,{className:N(Cr({variant:t,size:n,className:e})),ref:i,...r}));F.displayName=`Button`;var wr=$t,Tr=zn,Er=M.forwardRef(({className:e,inset:t,children:n,...r},i)=>(0,P.jsxs)(An,{ref:i,className:N(`flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent`,t&&`pl-8`,e),...r,children:[n,(0,P.jsx)(rt,{className:`ml-auto h-4 w-4`})]}));Er.displayName=An.displayName;var Dr=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(ht,{ref:n,className:N(`z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,e),...t}));Dr.displayName=ht.displayName;var Or=M.forwardRef(({className:e,sideOffset:t=4,...n},r)=>(0,P.jsx)(Dt,{children:(0,P.jsx)(cn,{ref:r,sideOffset:t,className:N(`z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,e),...n})}));Or.displayName=cn.displayName;var kr=M.forwardRef(({className:e,inset:t,...n},r)=>(0,P.jsx)(wt,{ref:r,className:N(`relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,t&&`pl-8`,e),...n}));kr.displayName=wt.displayName;var Ar=M.forwardRef(({className:e,children:t,checked:n,...r},i)=>(0,P.jsxs)(vt,{ref:i,className:N(`relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),checked:n,...r,children:[(0,P.jsx)(`span`,{className:`absolute left-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,P.jsx)(Xt,{children:(0,P.jsx)(pn,{className:`h-4 w-4`})})}),t]}));Ar.displayName=vt.displayName;var jr=M.forwardRef(({className:e,children:t,...n},r)=>(0,P.jsxs)(dn,{ref:r,className:N(`relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...n,children:[(0,P.jsx)(`span`,{className:`absolute left-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,P.jsx)(Xt,{children:(0,P.jsx)(ie,{className:`h-2 w-2 fill-current`})})}),t]}));jr.displayName=dn.displayName;var Mr=M.forwardRef(({className:e,inset:t,...n},r)=>(0,P.jsx)(Dn,{ref:r,className:N(`px-2 py-1.5 text-sm font-semibold`,t&&`pl-8`,e),...n}));Mr.displayName=Dn.displayName;var Nr=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(zt,{ref:n,className:N(`-mx-1 my-1 h-px bg-muted`,e),...t}));Nr.displayName=zt.displayName;var Pr=({className:e,...t})=>(0,P.jsx)(`span`,{className:N(`ml-auto text-xs tracking-widest opacity-60`,e),...t});Pr.displayName=`DropdownMenuShortcut`;function Fr(){let{setTheme:e}=Sr();return(0,P.jsxs)(wr,{children:[(0,P.jsx)(Tr,{asChild:!0,children:(0,P.jsxs)(F,{variant:`outline`,size:`icon`,children:[(0,P.jsx)(Qe,{className:`h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0`}),(0,P.jsx)(Ct,{className:`absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100`}),(0,P.jsx)(`span`,{className:`sr-only`,children:`Toggle theme`})]})}),(0,P.jsxs)(Or,{align:`end`,children:[(0,P.jsx)(kr,{onClick:()=>e(`light`),children:`Light`}),(0,P.jsx)(kr,{onClick:()=>e(`dark`),children:`Dark`}),(0,P.jsx)(kr,{onClick:()=>e(`system`),children:`System`})]})]})}const Ir=`/api`;function Lr(e){let t=e.startsWith(`/`)?e:`/`;return`${Ir}/oidc/login?next=${encodeURIComponent(t)}`}var Rr=class extends Error{status;bodyText;constructor(e,t,n){super(e),this.name=`ApiError`,this.status=t,this.bodyText=n}};function zr(e){let t=(e??``).trim();if(!t)return``;try{let e=JSON.parse(t);if(typeof e?.message==`string`&&e.message.trim())return e.message.trim();if(typeof e?.error?.message==`string`&&e.error.message.trim())return e.error.message.trim()}catch{}return t}async function I(e,t){let n=(t?.method??`GET`).toUpperCase(),r=await fetch(`${e}`,{credentials:`include`,...t,headers:{"Content-Type":`application/json`,...t?.headers??{}}});if(r.status===401){let e=await r.text().catch(()=>``);if(n===`GET`&&typeof window<`u`){let e=window.location.pathname+(window.location.search??``);window.location.href=Lr(e)}throw new Rr(`unauthorized`,r.status,e)}if(r.status===403){let e=await r.text().catch(()=>``),t=zr(e);throw new Rr(t?`forbidden: ${t}`:`forbidden`,r.status,e)}if(!r.ok){let e=await r.text().catch(()=>``),t=zr(e);throw new Rr(t?`request failed (${r.status}): ${t}`:`request failed (${r.status})`,r.status,e)}return r.status===204?{}:await r.json()}async function Br(){return I(`/api/session`)}async function Vr(){let e=await fetch(`/auth/logout`,{method:`POST`,credentials:`include`,headers:{"Content-Type":`application/json`},body:`{}`});if(!e.ok){let t=await e.text().catch(()=>``);throw Error(`logout failed (${e.status}): ${t}`)}}async function Hr(){return I(`/api/workspaces`)}async function Ur(){return I(`/api/dashboard/snapshot`)}async function Wr(e,t){let n=new URLSearchParams;t?.include_read&&n.set(`include_read`,t.include_read),t?.limit&&n.set(`limit`,t.limit);let r=n.toString();return I(`/notifications/for-user/${encodeURIComponent(e)}${r?`?${r}`:``}`)}async function Gr(e){return I(`/notifications/for-user/${encodeURIComponent(e)}/read-all`,{method:`PUT`})}async function Kr(e){return I(`/notifications/single/${encodeURIComponent(e)}/read`,{method:`PUT`})}async function qr(e){return I(`/notifications/single/${encodeURIComponent(e)}`,{method:`DELETE`})}async function Jr(e,t){let n=new URLSearchParams;t?.server&&n.set(`server`,t.server),t?.path&&n.set(`path`,t.path),t?.recursive&&n.set(`recursive`,`true`);let r=n.toString();return I(`/api/workspaces/${encodeURIComponent(e)}/eve/labs${r?`?${r}`:``}`)}async function Yr(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/eve/import`,{method:`POST`,body:JSON.stringify(t)})}async function Xr(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/eve/convert`,{method:`POST`,body:JSON.stringify(t)})}async function Zr(){return I(`/api/user/integrations/servicenow`)}async function Qr(e){return I(`/api/user/integrations/servicenow`,{method:`PUT`,body:JSON.stringify(e)})}async function $r(){return I(`/api/user/integrations/servicenow/install`,{method:`POST`,body:`{}`})}async function ei(){return I(`/api/user/integrations/servicenow/pdiStatus`)}async function ti(){return I(`/api/user/integrations/servicenow/schemaStatus`)}async function ni(){return I(`/api/user/integrations/servicenow/wake`,{method:`POST`,body:`{}`})}async function ri(){return I(`/api/user/integrations/servicenow/configureForwardTicketing`,{method:`POST`,body:`{}`})}async function ii(){return I(`/api/user/integrations/gemini`)}async function ai(){await I(`/api/user/integrations/gemini/disconnect`,{method:`POST`,body:`{}`})}async function oi(){return I(`/api/user/integrations/elastic`)}async function si(e){return I(`/api/user/integrations/elastic`,{method:`PUT`,body:JSON.stringify(e)})}async function ci(){await I(`/api/user/integrations/elastic/clear`,{method:`POST`,body:`{}`})}async function li(){return I(`/api/user/integrations/elastic/test`,{method:`POST`,body:`{}`})}async function ui(){return I(`/api/system/elastic/tools/status`)}async function di(){return I(`/api/system/elastic/tools/wake`,{method:`POST`,body:`{}`})}async function fi(e,t){return I(`/api/user/ai/generate`,{method:`POST`,body:JSON.stringify(e),signal:t?.signal})}async function pi(){return I(`/api/user/ai/history`)}async function mi(e){return I(`/api/user/ai/save`,{method:`POST`,body:JSON.stringify(e)})}async function hi(e){return I(`/api/user/ai/validate`,{method:`POST`,body:JSON.stringify(e)})}async function gi(e){return I(`/api/user/ai/autofix`,{method:`POST`,body:JSON.stringify(e)})}async function _i(){return I(`/api/user/git-credentials`)}async function vi(){return I(`/api/user/settings`)}async function yi(e){return I(`/api/user/settings`,{method:`PUT`,body:JSON.stringify(e)})}async function bi(){return I(`/api/aws/sso/config`)}async function xi(){return I(`/api/aws/sso/status`)}async function Si(){return I(`/api/aws/sso/start`,{method:`POST`,body:`{}`})}async function Ci(e){return I(`/api/aws/sso/poll`,{method:`POST`,body:JSON.stringify(e)})}async function wi(){return I(`/api/aws/sso/logout`,{method:`POST`,body:`{}`})}async function Ti(){return I(`/api/user/cloud/aws-static`)}async function Ei(e){return I(`/api/user/cloud/aws-static`,{method:`PUT`,body:JSON.stringify(e)})}async function Di(){await I(`/api/user/cloud/aws-static`,{method:`DELETE`})}async function Oi(){return I(`/api/user/cloud/azure`)}async function ki(e){return I(`/api/user/cloud/azure`,{method:`PUT`,body:JSON.stringify(e)})}async function Ai(){await I(`/api/user/cloud/azure`,{method:`DELETE`})}async function ji(){return I(`/api/user/cloud/gcp`)}async function Mi(e){return I(`/api/user/cloud/gcp`,{method:`PUT`,body:JSON.stringify(e)})}async function Ni(){await I(`/api/user/cloud/gcp`,{method:`DELETE`})}async function Pi(){return I(`/api/user/cloud/ibm`)}async function Fi(e){return I(`/api/user/cloud/ibm`,{method:`PUT`,body:JSON.stringify(e)})}async function Ii(){await I(`/api/user/cloud/ibm`,{method:`DELETE`})}async function Li(){return I(`/api/user/netlab/servers`)}async function Ri(e){return I(`/api/user/netlab/servers`,{method:`PUT`,body:JSON.stringify(e)})}async function zi(e){await I(`/api/user/netlab/servers/${encodeURIComponent(e)}`,{method:`DELETE`})}async function Bi(){return I(`/api/user/eve/servers`)}async function Vi(e){return I(`/api/user/eve/servers`,{method:`PUT`,body:JSON.stringify(e)})}async function Hi(e){await I(`/api/user/eve/servers/${encodeURIComponent(e)}`,{method:`DELETE`})}async function Ui(){return I(`/api/user/containerlab/servers`)}async function Wi(e){return I(`/api/user/containerlab/servers`,{method:`PUT`,body:JSON.stringify(e)})}async function Gi(e){await I(`/api/user/containerlab/servers/${encodeURIComponent(e)}`,{method:`DELETE`})}async function Ki(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/forward`,{method:`PUT`,body:JSON.stringify(n)})}async function qi(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/forward/sync`,{method:`POST`,body:`{}`})}async function Ji(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/capacity/summary`)}async function Yi(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/capacity/rollups/refresh`,{method:`POST`,body:`{}`})}async function Xi(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/capacity/summary`)}async function Zi(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/capacity/rollups/refresh`,{method:`POST`,body:`{}`})}async function Qi(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/assurance/summary`)}async function $i(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/assurance/refresh`,{method:`POST`,body:`{}`})}async function ea(e,t,n){let r=new URLSearchParams;n&&r.set(`limit`,n);let i=r.toString()?`?${r.toString()}`:``;return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/assurance/summary/history${i}`)}async function ta(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/assurance/demo/seed`,{method:`POST`,body:`{}`})}async function na(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/capacity/coverage`)}async function ra(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/capacity/snapshot-delta`)}async function ia(e,t,n={}){let r=new URLSearchParams;n.window&&r.set(`window`,n.window);let i=r.toString()?`?${r.toString()}`:``;return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/capacity/upgrade-candidates${i}`)}async function aa(e){return I(`/api/workspaces/${encodeURIComponent(e)}/capacity/forward-networks/portfolio`)}async function oa(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/capacity/inventory`)}async function sa(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/capacity/inventory`)}async function ca(e,t,n){let r=new URLSearchParams;return r.set(`metric`,n.metric),r.set(`window`,n.window),n.objectType&&r.set(`objectType`,n.objectType),n.compareHours&&r.set(`compareHours`,String(n.compareHours)),n.limit&&r.set(`limit`,String(n.limit)),I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/capacity/growth?${r.toString()}`)}async function la(e,t,n){let r=new URLSearchParams;return r.set(`metric`,n.metric),r.set(`window`,n.window),n.objectType&&r.set(`objectType`,n.objectType),n.compareHours&&r.set(`compareHours`,String(n.compareHours)),n.limit&&r.set(`limit`,String(n.limit)),I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/capacity/growth?${r.toString()}`)}async function ua(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/capacity/perf/interface-metrics-history`,{method:`POST`,body:JSON.stringify(n)})}async function da(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/capacity/perf/interface-metrics-history`,{method:`POST`,body:JSON.stringify(n)})}async function fa(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/capacity/perf/device-metrics-history`,{method:`POST`,body:JSON.stringify(n)})}async function pa(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/capacity/perf/device-metrics-history`,{method:`POST`,body:JSON.stringify(n)})}async function ma(e,t,n){let r=new URLSearchParams;n.snapshotId&&r.set(`snapshotId`,n.snapshotId),n.endTime&&r.set(`endTime`,n.endTime);let i=r.toString()?`?${r.toString()}`:``;return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/capacity/perf/unhealthy-devices${i}`)}async function ha(e,t,n){let r=new URLSearchParams;n.snapshotId&&r.set(`snapshotId`,n.snapshotId),n.endTime&&r.set(`endTime`,n.endTime);let i=r.toString()?`?${r.toString()}`:``;return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/capacity/perf/unhealthy-devices${i}`)}async function ga(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/capacity/path-bottlenecks`,{method:`POST`,body:JSON.stringify(n)})}async function _a(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/impair`,{method:`POST`,body:JSON.stringify(n)})}async function va(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/admin`,{method:`POST`,body:JSON.stringify(n)})}async function ya(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/capture`,{method:`POST`,body:JSON.stringify(n)})}async function ba(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/interfaces`)}async function xa(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/running-config`)}async function Sa(e,t,n=`json`){let r=new URLSearchParams;return r.set(`format`,n),I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/inventory?${r.toString()}`)}async function Ca(e,t,n,r){let i=new URLSearchParams;r?.tail&&i.set(`tail`,String(r.tail)),r?.container&&i.set(`container`,r.container);let a=i.toString();return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/logs${a?`?${a}`:``}`)}async function wa(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/describe`)}async function Ta(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/save-config`,{method:`POST`,body:`{}`})}async function Ea(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/stats`)}async function Da(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return I(`/api/workspaces/${encodeURIComponent(e)}/netlab/templates${r?`?${r}`:``}`)}async function Oa(e,t){let n=new URLSearchParams;return t.source&&n.set(`source`,t.source),t.repo&&n.set(`repo`,t.repo),t.dir&&n.set(`dir`,t.dir),n.set(`template`,t.template),I(`/api/workspaces/${encodeURIComponent(e)}/netlab/template?${n.toString()}`)}async function ka(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/netlab/validate`,{method:`POST`,body:JSON.stringify(t)})}async function Aa(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return I(`/api/workspaces/${encodeURIComponent(e)}/containerlab/templates${r?`?${r}`:``}`)}async function ja(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return I(`/api/workspaces/${encodeURIComponent(e)}/terraform/templates${r?`?${r}`:``}`)}async function Ma(e,t){let n=new URLSearchParams;return t.source&&n.set(`source`,t.source),t.repo&&n.set(`repo`,t.repo),t.dir&&n.set(`dir`,t.dir),n.set(`file`,t.file),I(`/api/workspaces/${encodeURIComponent(e)}/containerlab/template?${n.toString()}`)}async function Na(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return I(`/api/workspaces/${encodeURIComponent(e)}/eve-ng/templates${r?`?${r}`:``}`)}async function Pa(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments`,{method:`POST`,body:JSON.stringify(t)})}async function Fa(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/containerlab/topologies`,{method:`POST`,body:JSON.stringify(t)})}async function Ia(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments-designer/clabernetes/from-template`,{method:`POST`,body:JSON.stringify(t)})}async function La(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments-designer/containerlab/from-template`,{method:`POST`,body:JSON.stringify(t)})}async function Ra(e){return I(`/api/workspaces`,{method:`POST`,body:JSON.stringify(e)})}async function za(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/members`,{method:`PUT`,body:JSON.stringify(t)})}async function Ba(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/topology`)}async function Va(e){let t=new URLSearchParams;e?.q&&t.set(`q`,e.q),e?.n&&t.set(`n`,String(e.n));let n=t.toString();return I(`/api/registry/repos${n?`?${n}`:``}`)}async function Ha(e,t){let n=new URLSearchParams;t?.q&&n.set(`q`,t.q);let r=n.toString();return I(`/api/registry/repos/${encodeURIComponent(e)}/tags${r?`?${r}`:``}`)}async function Ua(e,t){let n=new URLSearchParams;return n.set(`confirm`,t.confirm),t.force&&n.set(`force`,`true`),I(`/api/workspaces/${encodeURIComponent(e)}?${n.toString()}`,{method:`DELETE`})}async function Wa(){return I(`/api/forward/collector-configs`)}async function Ga(e){return I(`/api/forward/collector-configs`,{method:`POST`,body:JSON.stringify(e)})}async function Ka(e){return I(`/api/forward/collector-configs/${encodeURIComponent(e)}`,{method:`DELETE`})}async function qa(e,t){let n=new URLSearchParams;t&&t>0&&n.set(`tail`,String(t));let r=n.toString();return I(`/api/forward/collector-configs/${encodeURIComponent(e)}/logs${r?`?${r}`:``}`)}async function Ja(e){return I(`/api/forward/collector-configs/${encodeURIComponent(e)}/restart`,{method:`POST`,body:`{}`})}async function Ya(e,t){let n=new URLSearchParams;t?.prefix&&n.set(`prefix`,t.prefix),t?.limit&&n.set(`limit`,t.limit);let r=n.toString();return I(`/api/workspaces/${encodeURIComponent(e)}/artifacts${r?`?${r}`:``}`)}async function Xa(e,t){let n=new URLSearchParams({key:t});return I(`/api/workspaces/${encodeURIComponent(e)}/artifacts/download?${n.toString()}`)}async function Za(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/artifacts/object`,{method:`POST`,body:JSON.stringify(t)})}async function Qa(e,t){let n=new URLSearchParams({key:t});return I(`/api/workspaces/${encodeURIComponent(e)}/artifacts/object?${n.toString()}`,{method:`DELETE`})}async function $a(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/artifacts/folder`,{method:`POST`,body:JSON.stringify({prefix:t})})}async function eo(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit),e?.before_id&&t.set(`before_id`,e.before_id);let n=t.toString();return I(`/api/webhooks/events${n?`?${n}`:``}`)}async function to(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit),e?.before_id&&t.set(`before_id`,e.before_id),e?.source_ip&&t.set(`source_ip`,e.source_ip),e?.unassigned&&t.set(`unassigned`,e.unassigned);let n=t.toString();return I(`/api/syslog/events${n?`?${n}`:``}`)}async function no(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit),e?.before_id&&t.set(`before_id`,e.before_id);let n=t.toString();return I(`/api/snmp/traps/events${n?`?${n}`:``}`)}async function ro(){return I(`/api/admin/governance/summary`)}async function io(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString();return I(`/api/admin/governance/resources${n?`?${n}`:``}`)}async function ao(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString();return I(`/api/admin/governance/costs${n?`?${n}`:``}`)}async function oo(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString();return I(`/api/admin/governance/usage${n?`?${n}`:``}`)}async function so(){await I(`/api/admin/governance/sync`,{method:`POST`,body:`{}`})}async function co(){return I(`/api/admin/config`)}async function lo(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString();return I(`/api/admin/audit${n?`?${n}`:``}`)}async function uo(){return I(`/api/admin/impersonate/status`)}async function fo(e){return I(`/api/admin/impersonate/start`,{method:`POST`,body:JSON.stringify(e)})}async function po(){return I(`/api/admin/impersonate/stop`,{method:`POST`,body:`{}`})}async function mo(e){return I(`/api/admin/tasks/reconcile`,{method:`POST`,body:JSON.stringify(e)})}async function ho(e){return I(`/api/admin/tasks/reconcile-running`,{method:`POST`,body:JSON.stringify(e)})}async function go(e){return I(`/api/admin/users/purge`,{method:`POST`,body:JSON.stringify(e)})}async function _o(){return I(`/api/admin/governance/policy`)}async function vo(e){return I(`/api/admin/governance/policy`,{method:`PUT`,body:JSON.stringify(e)})}async function yo(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/start`,{method:`POST`,body:`{}`})}async function bo(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/stop`,{method:`POST`,body:`{}`})}async function xo(e,t,n){let r=new URLSearchParams;n?.forwardDelete&&r.set(`forward_delete`,`true`);let i=r.toString();return I(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}${i?`?${i}`:``}`,{method:`DELETE`})}async function So(){return I(`/api/ui/config`)}async function Co(){return I(`/status/summary`)}async function wo(e,t){let n=new URLSearchParams;return t&&n.set(`workspace_id`,t),I(`/api/runs/${encodeURIComponent(String(e))}/cancel${n.toString()?`?${n.toString()}`:``}`,{method:`POST`,body:`{}`})}async function To(){return I(`/api/user/variable-groups`)}async function Eo(e){return I(`/api/user/variable-groups`,{method:`POST`,body:JSON.stringify(e)})}async function Do(e,t){return I(`/api/user/variable-groups/${encodeURIComponent(e)}`,{method:`PUT`,body:JSON.stringify(t)})}async function Oo(e){return I(`/api/user/variable-groups/${encodeURIComponent(e)}`,{method:`DELETE`})}async function ko(e){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/checks`)}async function Ao(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/checks/${encodeURIComponent(t)}`)}async function jo(e){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/packs`)}async function Mo(e,t,n){let r=new URLSearchParams;return r.set(`networkId`,t),typeof n==`number`&&r.set(`maxResults`,String(n)),I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/snapshots?${r.toString()}`)}async function No(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/checks/run`,{method:`POST`,body:JSON.stringify(t)})}async function Po(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/packs/run`,{method:`POST`,body:JSON.stringify(t)})}async function Fo(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/packs/delta`,{method:`POST`,body:JSON.stringify(t)})}async function Io(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/governance/campaigns`,{method:`POST`,body:JSON.stringify(t)})}async function Lo(e,t,n){let r=new URLSearchParams;return t&&r.set(`status`,t),typeof n==`number`&&r.set(`limit`,String(n)),I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/governance/campaigns?${r.toString()}`)}async function Ro(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/governance/campaigns/${encodeURIComponent(t)}/generate`,{method:`POST`,body:JSON.stringify(n)})}async function zo(e,t,n,r,i){let a=new URLSearchParams;return t&&a.set(`campaignId`,t),n&&a.set(`status`,n),r&&a.set(`assignee`,r),typeof i==`number`&&a.set(`limit`,String(i)),I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/governance/assignments?${a.toString()}`)}async function Bo(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/governance/assignments/${encodeURIComponent(t)}/attest`,{method:`POST`,body:JSON.stringify(n)})}async function Vo(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/governance/assignments/${encodeURIComponent(t)}/waive`,{method:`POST`,body:JSON.stringify(n)})}async function Ho(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks`,{method:`POST`,body:JSON.stringify(t)})}async function Uo(e){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks`)}async function Wo(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}`,{method:`DELETE`})}async function Go(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/networks`,{method:`POST`,body:JSON.stringify(t)})}async function Ko(e){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/networks`)}async function qo(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/networks/${encodeURIComponent(t)}`,{method:`DELETE`})}async function Jo(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/networks/${encodeURIComponent(t)}/credentials`)}async function Yo(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/networks/${encodeURIComponent(t)}/credentials`,{method:`PUT`,body:JSON.stringify(n)})}async function Xo(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/networks/${encodeURIComponent(t)}/credentials`,{method:`DELETE`})}async function Zo(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/networks/${encodeURIComponent(t)}/zones`,{method:`POST`,body:JSON.stringify(n)})}async function Qo(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/networks/${encodeURIComponent(t)}/zones`)}async function $o(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/networks/${encodeURIComponent(t)}/zones/${encodeURIComponent(n)}`,{method:`DELETE`})}async function es(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/presets`,{method:`POST`,body:JSON.stringify(t)})}async function ts(e,t,n,r){let i=new URLSearchParams;t&&i.set(`forwardNetworkId`,t),typeof n==`boolean`&&i.set(`enabled`,n?`true`:`false`),typeof r==`number`&&i.set(`limit`,String(r));let a=i.toString();return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/presets${a?`?${a}`:``}`)}async function ns(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/presets/${encodeURIComponent(t)}`,{method:`DELETE`})}async function rs(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/presets/${encodeURIComponent(t)}/run`,{method:`POST`,body:`{}`})}async function is(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/paths/enforcement-bypass`,{method:`POST`,body:JSON.stringify(t)})}async function as(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/paths/enforcement-bypass/store`,{method:`POST`,body:JSON.stringify(t)})}async function os(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/runs`,{method:`POST`,body:JSON.stringify(t)})}async function ss(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/runs/custom`,{method:`POST`,body:JSON.stringify(t)})}async function cs(e,t,n,r,i){let a=new URLSearchParams;return t&&a.set(`forwardNetworkId`,t),n&&a.set(`packId`,n),r&&a.set(`status`,r),typeof i==`number`&&a.set(`limit`,String(i)),I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/runs?${a.toString()}`)}async function ls(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/runs/${encodeURIComponent(t)}`)}async function us(e,t,n,r){let i=new URLSearchParams;n&&i.set(`checkId`,n),typeof r==`number`&&i.set(`limit`,String(r));let a=i.toString();return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/runs/${encodeURIComponent(t)}/findings${a?`?${a}`:``}`)}async function ds(e,t,n,r,i){let a=new URLSearchParams;return t&&a.set(`forwardNetworkId`,t),n&&a.set(`checkId`,n),r&&a.set(`status`,r),typeof i==`number`&&a.set(`limit`,String(i)),I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/findings?${a.toString()}`)}async function fs(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/governance/exceptions`,{method:`POST`,body:JSON.stringify(t)})}async function ps(e,t,n,r){let i=new URLSearchParams;return t&&i.set(`forwardNetworkId`,t),n&&i.set(`status`,n),typeof r==`number`&&i.set(`limit`,String(r)),I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/governance/exceptions?${i.toString()}`)}async function ms(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/governance/exceptions/${encodeURIComponent(t)}/approve`,{method:`POST`,body:`{}`})}async function hs(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/governance/exceptions/${encodeURIComponent(t)}/reject`,{method:`POST`,body:`{}`})}async function gs(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/policy-reports/change-planning/simulate`,{method:`POST`,body:JSON.stringify(t)})}var _s=[{label:`Dashboard`,href:`/status`,icon:Qt},{label:`Deployments`,href:`/dashboard/deployments`,icon:Je},{label:`Runs`,href:`/dashboard/runs`,icon:ke},{label:`Workspaces`,href:`/dashboard/workspaces`,icon:T},{label:`Designer`,href:`/dashboard/labs/designer`,icon:Rn,newTab:!0},{label:`Connect`,href:``,icon:ke,children:[{label:`Overview`,href:`/dashboard/integrations`,icon:ke},{label:`Forward Collector`,href:`/dashboard/forward`,icon:tn},{label:`Forward Networks`,href:`/dashboard/forward-networks`,icon:yn},{label:`ServiceNow`,href:`/dashboard/servicenow`,icon:ke},{label:`Elastic`,href:`/dashboard/elastic`,icon:Ie},{label:`Artifacts`,href:`/dashboard/s3`,icon:st},{label:`Git`,href:`/git/`,icon:Fn,external:!0},{label:`DNS`,href:`${Ir}/dns/sso?next=/dns/`,icon:yn,external:!0},{label:`Coder`,href:`/coder/launch`,icon:He,external:!0},{label:`Coder Admin`,href:`/coder/`,icon:He,external:!0,adminOnly:!0},{label:`Elastic (Kibana)`,href:`/kibana/`,icon:Ie,external:!0}]},{label:`Tools`,href:``,icon:Ie,children:[{label:`AI`,href:`/dashboard/ai`,icon:E},{label:`Policy Reports`,href:`/dashboard/policy-reports`,icon:mn},{label:`Webhooks`,href:`/webhooks`,icon:Me},{label:`Syslog`,href:`/syslog`,icon:kn},{label:`SNMP`,href:`/snmp`,icon:mn},{label:`API Testing`,href:`${Ir}/yaade/sso`,icon:on,external:!0},{label:`NetBox`,href:`/netbox/`,icon:yn,external:!0},{label:`Nautobot`,href:`/nautobot/`,icon:yn,external:!0},{label:`Docs`,href:`/dashboard/docs`,icon:ft}]},{label:`Settings`,href:``,icon:ut,children:[{label:`My Settings`,href:`/dashboard/settings`,icon:ut},{label:`Admin Settings`,href:`/admin/settings`,icon:ut,adminOnly:!0},{label:`Governance`,href:`/admin/governance`,icon:mn,adminOnly:!0}]}];function vs(e){let t=s({select:e=>e.location.pathname}),[n,r]=(0,M.useState)({Tools:!0,Connect:!0}),i=`_blank`,a=`noreferrer noopener`,o=e=>!!e.external||!!e.newTab,c=e=>e?e===`/`?t===`/`:e.endsWith(`/`)?t.startsWith(e):t===e||t.startsWith(`${e}/`):!1,l=e=>{r(t=>({...t,[e]:!t[e]}))};return(0,P.jsx)(`nav`,{className:`grid items-start gap-2`,children:(0,P.jsx)(`div`,{className:`space-y-2`,children:(0,P.jsx)(`div`,{className:`grid gap-1`,children:_s.filter(t=>t.adminOnly?!!e.isAdmin:!0).flatMap(t=>{let n=e.features;if(!n)return[t];if(t.label===`Connect`){let r=t.children?.filter(t=>t.label===`Forward Collector`||t.label===`Forward Networks`||t.label===`ServiceNow`?!!n.forwardEnabled:t.label===`Elastic`?!!n.forwardEnabled&&!!n.elasticEnabled:t.label===`Artifacts`?!!n.minioEnabled:t.label===`Git`?!!n.giteaEnabled:t.label===`DNS`?!!n.dnsEnabled:t.label===`Coder`||t.label===`Coder Admin`?!!n.coderEnabled:t.label===`Elastic (Kibana)`?!!n.forwardEnabled&&!!n.elasticEnabled:t.adminOnly?!!e.isAdmin:!0)??[];return r.length===0?[]:[{...t,children:r}]}if(t.label===`Tools`){let e=t.children?.filter(e=>e.label===`API Testing`?!!n.yaadeEnabled:e.label===`NetBox`?!!n.netboxEnabled:e.label===`Nautobot`?!!n.nautobotEnabled:!0)??[];return e.length===0?[]:[{...t,children:e}]}if(t.label===`Settings`){let n=t.children?.filter(t=>t.adminOnly?!!e.isAdmin:!0)??[];return n.length===0?[]:[{...t,children:n}]}return[t]}).map(t=>{let r=t.icon;if(t.children){let o=t.children.some(e=>c(e.href)),s=n[t.label];return e.collapsed?(0,P.jsxs)(wr,{children:[(0,P.jsx)(Tr,{asChild:!0,children:(0,P.jsx)(`button`,{className:N(`group flex items-center justify-center rounded-md px-2 py-2 text-sm font-medium transition-colors w-full`,`hover:bg-accent hover:text-accent-foreground`,o?`bg-accent text-accent-foreground`:`transparent`),title:t.label,children:(0,P.jsx)(r,{className:`h-5 w-5`})})}),(0,P.jsxs)(Or,{side:`right`,align:`start`,sideOffset:10,children:[(0,P.jsx)(Mr,{children:t.label}),(0,P.jsx)(Nr,{}),t.children.map(e=>(0,P.jsx)(kr,{asChild:!0,children:e.external?(0,P.jsxs)(`a`,{href:e.href,target:i,rel:a,className:`flex items-center gap-2 cursor-pointer w-full`,children:[(0,P.jsx)(e.icon,{className:`h-4 w-4 mr-2`}),e.label]}):(0,P.jsxs)(p,{to:e.href,className:`flex items-center gap-2 cursor-pointer w-full`,children:[(0,P.jsx)(e.icon,{className:`h-4 w-4 mr-2`}),e.label]})},e.href))]})]},t.label):(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsxs)(`button`,{onClick:()=>l(t.label),className:N(`group flex w-full items-center justify-between rounded-md px-3 py-2 text-sm font-medium transition-colors`,`hover:bg-accent hover:text-accent-foreground`,o?`text-foreground font-semibold`:`text-muted-foreground`),children:[(0,P.jsxs)(`div`,{className:`flex items-center`,children:[(0,P.jsx)(r,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:t.label})]}),s?(0,P.jsx)(D,{className:`h-4 w-4 opacity-50`}):(0,P.jsx)(rt,{className:`h-4 w-4 opacity-50`})]}),s&&(0,P.jsx)(`div`,{className:`grid gap-1 pl-4 border-l ml-4 border-border/50`,children:t.children.map(e=>{let t=c(e.href),n=e.icon,r=N(`group flex items-center rounded-md px-3 py-2 text-sm font-medium transition-colors`,`hover:bg-accent hover:text-accent-foreground`,t?`bg-accent text-accent-foreground`:`text-muted-foreground`);return e.external?(0,P.jsxs)(`a`,{href:e.href,target:i,rel:a,className:r,children:[(0,P.jsx)(n,{className:`mr-2 h-4 w-4 opacity-70 group-hover:opacity-100`}),(0,P.jsx)(`span`,{children:e.label})]},e.href):(0,P.jsxs)(p,{to:e.href,className:r,children:[(0,P.jsx)(n,{className:`mr-2 h-4 w-4 opacity-70 group-hover:opacity-100`}),(0,P.jsx)(`span`,{children:e.label})]},e.href)})})]},t.label)}let s=N(`group flex items-center rounded-md px-3 py-2 text-sm font-medium transition-colors`,`hover:bg-accent hover:text-accent-foreground`,c(t.href)?`bg-accent`:`transparent`,e.collapsed&&`justify-center px-2`),u=N(`transition-transform duration-200 group-hover:scale-110 group-hover:text-primary`,e.collapsed?`h-5 w-5`:`mr-2 h-4 w-4`);return t.external?(0,P.jsxs)(`a`,{href:t.href,target:i,rel:a,className:s,title:e.collapsed?t.label:void 0,children:[(0,P.jsx)(r,{className:u}),e.collapsed?null:(0,P.jsx)(`span`,{children:t.label})]},t.href):(0,P.jsxs)(p,{to:t.href,className:s,title:e.collapsed?t.label:void 0,target:o(t)?i:void 0,rel:o(t)?a:void 0,children:[(0,P.jsx)(r,{className:u}),e.collapsed?null:(0,P.jsx)(`span`,{children:t.label})]},t.href)})})})})}var ys=M.forwardRef(({...e},t)=>(0,P.jsx)(`nav`,{ref:t,"aria-label":`breadcrumb`,...e}));ys.displayName=`Breadcrumb`;var bs=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`ol`,{ref:n,className:N(`flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5`,e),...t}));bs.displayName=`BreadcrumbList`;var xs=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`li`,{ref:n,className:N(`inline-flex items-center gap-1.5`,e),...t}));xs.displayName=`BreadcrumbItem`;var Ss=M.forwardRef(({asChild:e,className:t,...n},r)=>(0,P.jsx)(e?In:`a`,{ref:r,className:N(`transition-colors hover:text-foreground`,t),...n}));Ss.displayName=`BreadcrumbLink`;var Cs=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`span`,{ref:n,role:`link`,"aria-disabled":`true`,"aria-current":`page`,className:N(`font-normal text-foreground`,e),...t}));Cs.displayName=`BreadcrumbPage`;var ws=({children:e,className:t,...n})=>(0,P.jsx)(`li`,{role:`presentation`,"aria-hidden":`true`,className:N(`[&>svg]:size-3.5`,t),...n,children:e??(0,P.jsx)(rt,{})});ws.displayName=`BreadcrumbSeparator`;var Ts=({className:e,...t})=>(0,P.jsxs)(`span`,{role:`presentation`,"aria-hidden":`true`,className:N(`flex h-9 w-9 items-center justify-center`,e),...t,children:[(0,P.jsx)(Ut,{className:`h-4 w-4`}),(0,P.jsx)(`span`,{className:`sr-only`,children:`More`})]});Ts.displayName=`BreadcrumbEllipsis`;var Es=Gn(`rounded-lg border text-card-foreground shadow-sm`,{variants:{variant:{default:`bg-card`,elevated:`bg-card shadow-lg`,gradient:`bg-gradient-to-br from-card to-card/60`,glass:`bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60`,glow:`bg-card shadow-lg shadow-primary/10`,interactive:`bg-card hover:shadow-md transition-shadow cursor-pointer`,success:`border-green-500/50 bg-green-500/5`,warning:`border-amber-500/50 bg-amber-500/5`,danger:`border-red-500/50 bg-red-500/5`,info:`border-blue-500/50 bg-blue-500/5`,flat:`bg-card shadow-none`},size:{default:``,compact:`p-3`,comfortable:`p-6`}},defaultVariants:{variant:`default`,size:`default`}}),L=M.forwardRef(({className:e,variant:t,size:n,...r},i)=>(0,P.jsx)(`div`,{ref:i,className:N(Es({variant:t,size:n,className:e})),...r}));L.displayName=`Card`;var R=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`div`,{ref:n,className:N(`flex flex-col space-y-1.5 p-6`,e),...t}));R.displayName=`CardHeader`;var z=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`div`,{ref:n,className:N(`text-2xl font-semibold leading-none tracking-tight`,e),...t}));z.displayName=`CardTitle`;var B=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`div`,{ref:n,className:N(`text-sm text-muted-foreground`,e),...t}));B.displayName=`CardDescription`;var V=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`div`,{ref:n,className:N(`p-6 pt-0`,e),...t}));V.displayName=`CardContent`;var Ds=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`div`,{ref:n,className:N(`flex items-center p-6 pt-0`,e),...t}));Ds.displayName=`CardFooter`;var Os=se,ks=qt,As=C,js=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Ye,{className:N(`fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t,ref:n}));js.displayName=Ye.displayName;var Ms=Gn(`fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500`,{variants:{side:{top:`inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top`,bottom:`inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom`,left:`inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm`,right:`inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm`}},defaultVariants:{side:`right`}}),Ns=M.forwardRef(({side:e=`right`,className:t,children:n,...r},i)=>(0,P.jsxs)(As,{children:[(0,P.jsx)(js,{}),(0,P.jsxs)(x,{ref:i,className:N(Ms({side:e}),t),...r,children:[n,(0,P.jsxs)(Ke,{className:`absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary`,children:[(0,P.jsx)(Wt,{className:`h-4 w-4`}),(0,P.jsx)(`span`,{className:`sr-only`,children:`Close`})]})]})]}));Ns.displayName=x.displayName;var Ps=({className:e,...t})=>(0,P.jsx)(`div`,{className:N(`flex flex-col space-y-2 text-center sm:text-left`,e),...t});Ps.displayName=`SheetHeader`;var Fs=({className:e,...t})=>(0,P.jsx)(`div`,{className:N(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});Fs.displayName=`SheetFooter`;var Is=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Pe,{ref:n,className:N(`text-lg font-semibold text-foreground`,e),...t}));Is.displayName=Pe.displayName;var Ls=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Nn,{ref:n,className:N(`text-sm text-muted-foreground`,e),...t}));Ls.displayName=Nn.displayName;var Rs=({...e})=>(0,P.jsx)(_n,{className:`toaster group`,toastOptions:{classNames:{toast:`group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg`,description:`group-[.toast]:text-muted-foreground`,actionButton:`group-[.toast]:bg-primary group-[.toast]:text-primary-foreground`,cancelButton:`group-[.toast]:bg-muted group-[.toast]:text-muted-foreground`}},...e});async function zs(){try{let e=await fetch(`/api/session`,{credentials:`include`,headers:{"Content-Type":`application/json`}});return e.ok?await e.json():null}catch{return null}}async function Bs(e){if(typeof window>`u`)return!1;let t=e.pollIntervalMs??750,n=e.timeoutMs??2*6e4;if((await zs())?.authenticated)return!0;let r=Math.max(0,Math.floor((window.screen.width-520)/2)),i=Math.max(0,Math.floor((window.screen.height-720)/2)),a=[`popup=yes`,`width=520`,`height=720`,`left=${r}`,`top=${i}`].join(`,`),o=window.open(e.loginHref,`skyforge_login`,a);if(!o)return!1;try{o.focus()}catch{}return await new Promise(e=>{let r=Date.now(),i=window.setInterval(async()=>{try{if(o.closed){window.clearInterval(i),e(!1);return}if(Date.now()-r>n){window.clearInterval(i);try{o.close()}catch{}e(!1);return}if((await zs())?.authenticated){window.clearInterval(i);try{o.close()}catch{}e(!0)}}catch{}},t)})}const H={session:()=>[`session`],uiConfig:()=>[`uiConfig`],dashboardSnapshot:()=>[`dashboardSnapshot`],statusSummary:()=>[`statusSummary`],runLogs:e=>[`runLogs`,e],deploymentTopology:(e,t)=>[`deploymentTopology`,e,t],deploymentUIEvents:(e,t)=>[`deploymentUIEvents`,e,t],deploymentCapacitySummary:(e,t)=>[`deploymentCapacitySummary`,e,t],deploymentCapacityInventory:(e,t)=>[`deploymentCapacityInventory`,e,t],deploymentCapacityGrowth:(e,t,n,r,i,a)=>[`deploymentCapacityGrowth`,e,t,n,r,String(i),a],workspaceForwardNetworks:e=>[`workspaceForwardNetworks`,e],assuranceStudioScenarios:(e,t)=>[`assuranceStudioScenarios`,e,t],assuranceStudioScenario:(e,t,n)=>[`assuranceStudioScenario`,e,t,n],assuranceStudioRuns:(e,t)=>[`assuranceStudioRuns`,e,t],assuranceStudioRun:(e,t,n)=>[`assuranceStudioRun`,e,t,n],forwardNetworkAssuranceSummary:(e,t)=>[`forwardNetworkAssuranceSummary`,e,t],forwardNetworkAssuranceHistory:(e,t,n)=>[`forwardNetworkAssuranceHistory`,e,t,n??``],forwardNetworkCapacitySummary:(e,t)=>[`forwardNetworkCapacitySummary`,e,t],forwardNetworkCapacityInventory:(e,t)=>[`forwardNetworkCapacityInventory`,e,t],forwardNetworkCapacityCoverage:(e,t)=>[`forwardNetworkCapacityCoverage`,e,t],forwardNetworkCapacitySnapshotDelta:(e,t)=>[`forwardNetworkCapacitySnapshotDelta`,e,t],forwardNetworkCapacityUpgradeCandidates:(e,t,n)=>[`forwardNetworkCapacityUpgradeCandidates`,e,t,n],workspaceForwardNetworkCapacityPortfolio:e=>[`workspaceForwardNetworkCapacityPortfolio`,e],forwardNetworkCapacityGrowth:(e,t,n,r,i,a)=>[`forwardNetworkCapacityGrowth`,e,t,n,r,String(i),a],workspaces:()=>[`workspaces`],workspaceForwardConfig:e=>[`workspaceForwardConfig`,e],workspaceForwardCollectors:e=>[`workspaceForwardCollectors`,e],forwardCollectors:()=>[`forwardCollectors`],userForwardCollector:()=>[`userForwardCollector`],userCollectorRuntime:()=>[`userCollectorRuntime`],userCollectorLogs:()=>[`userCollectorLogs`],userGitCredentials:()=>[`userGitCredentials`],userSettings:()=>[`userSettings`],userVariableGroups:()=>[`userVariableGroups`],userNetlabServers:()=>[`userNetlabServers`],userEveServers:()=>[`userEveServers`],userContainerlabServers:()=>[`userContainerlabServers`],userAwsStaticCredentials:()=>[`userAwsStaticCredentials`],userAwsSsoCredentials:()=>[`userAwsSsoCredentials`],awsSsoConfig:()=>[`awsSsoConfig`],awsSsoStatus:()=>[`awsSsoStatus`],userAzureCredentials:()=>[`userAzureCredentials`],userGcpCredentials:()=>[`userGcpCredentials`],userIbmCredentials:()=>[`userIbmCredentials`],userForwardCollectorConfigs:()=>[`userForwardCollectorConfigs`],userForwardCollectorConfigRuntime:e=>[`userForwardCollectorConfigRuntime`,e],userForwardCollectorConfigLogs:e=>[`userForwardCollectorConfigLogs`,e],userServiceNowConfig:()=>[`userServiceNowConfig`],userServiceNowPdiStatus:()=>[`userServiceNowPdiStatus`],userServiceNowSchemaStatus:()=>[`userServiceNowSchemaStatus`],userGeminiConfig:()=>[`userGeminiConfig`],userElasticConfig:()=>[`userElasticConfig`],elasticToolsStatus:()=>[`elasticToolsStatus`],userAIHistory:()=>[`userAIHistory`],storageFiles:()=>[`storageFiles`],workspaceArtifacts:e=>[`workspaceArtifacts`,e],workspaceEveServers:e=>[`workspaceEveServers`,e],workspaceEveLabs:(e,t,n,r)=>[`workspaceEveLabs`,e,t,n,r?`1`:`0`],workspaceNetlabServers:e=>[`workspaceNetlabServers`,e],notifications:(e,t)=>[`notifications`,e?`1`:`0`,t??``],syslogEvents:e=>[`syslogEvents`,e??``],snmpTrapEvents:e=>[`snmpTrapEvents`,e??``],workspaceTemplates:(e,t,n,r,i)=>[`workspaceTemplates`,e,t,n,r??``,i??``],pkiRoot:()=>[`pkiRoot`],pkiCerts:()=>[`pkiCerts`],pkiSshRoot:()=>[`pkiSshRoot`],pkiSshCerts:()=>[`pkiSshCerts`],webhookEvents:e=>[`webhookEvents`,e??``],notificationSettings:()=>[`notificationSettings`],governanceSummary:()=>[`governanceSummary`],governanceResources:e=>[`governanceResources`,e??``],governanceCosts:e=>[`governanceCosts`,e??``],governanceUsage:e=>[`governanceUsage`,e??``],governancePolicy:()=>[`governancePolicy`],adminConfig:()=>[`adminConfig`],adminAudit:e=>[`adminAudit`,e??``],adminImpersonateStatus:()=>[`adminImpersonateStatus`],registryRepos:e=>[`registryRepos`,e],registryTags:(e,t)=>[`registryTags`,e,t],policyReportsChecks:e=>[`policyReportsChecks`,e],policyReportsPacks:e=>[`policyReportsPacks`,e],policyReportsSnapshots:(e,t)=>[`policyReportsSnapshots`,e,t],policyReportsRecertCampaigns:(e,t)=>[`policyReportsRecertCampaigns`,e,t??``],policyReportsRecertCampaign:(e,t)=>[`policyReportsRecertCampaign`,e,t],policyReportsRecertAssignments:(e,t,n,r)=>[`policyReportsRecertAssignments`,e,t??``,n??``,r??``],policyReportsExceptions:(e,t,n)=>[`policyReportsExceptions`,e,t??``,n??``],policyReportsZones:(e,t)=>[`policyReportsZones`,e,t],policyReportsRuns:(e,t,n,r)=>[`policyReportsRuns`,e,t??``,n??``,r??``],policyReportsRun:(e,t)=>[`policyReportsRun`,e,t],policyReportsRunFindings:(e,t,n)=>[`policyReportsRunFindings`,e,t,n??``],policyReportsFindings:(e,t,n,r)=>[`policyReportsFindings`,e,t??``,n??``,r??``]};var Vs=new Map;function Hs(e){for(let[t,n]of e.handlers.entries())for(let r of n.values())e.es.addEventListener(t,r)}function Us(e){let t=new EventSource(e.url,{withCredentials:!0});return t.onopen=()=>{e.retryMs=500},t.onerror=()=>{if(e.closed||e.reconnectTimer)return;try{t.close()}catch{}let n=e.retryMs;e.retryMs=Math.min(e.retryMs*2,15e3),e.reconnectTimer=window.setTimeout(()=>{e.reconnectTimer=void 0,!e.closed&&(e.es=Us(e),Hs(e))},n)},t}function Ws(e){let t=Vs.get(e);if(t)return t.refs+=1,t;let n={url:e,es:void 0,refs:1,handlers:new Map,retryMs:500,closed:!1};return n.es=Us(n),Vs.set(e,n),n}function Gs(e){let t=Vs.get(e);if(t&&(--t.refs,!(t.refs>0))){Vs.delete(e),t.closed=!0,t.reconnectTimer&&=(window.clearTimeout(t.reconnectTimer),void 0);try{t.es.close()}catch{}}}function Ks(e,t){let n=Ws(e);for(let[e,r]of Object.entries(t)){let t=n.handlers.get(e);t||(t=new Set,n.handlers.set(e,t)),t.add(r),n.es.addEventListener(e,r)}return{close:()=>{for(let[e,r]of Object.entries(t)){try{n.es.removeEventListener(e,r)}catch{}let t=n.handlers.get(e);t&&(t.delete(r),t.size===0&&n.handlers.delete(e))}Gs(e)}}}function qs(e,t,n){let r=c(),i=(0,M.useMemo)(()=>{let e=new URLSearchParams;return e.set(`include_read`,t?`true`:`false`),e.set(`limit`,n),`${Ir}/notifications/events?${e.toString()}`},[t,n]);(0,M.useEffect)(()=>{if(!e)return;let a=Ks(i,{snapshot:e=>{try{let i=JSON.parse(e.data);if(!i||!Array.isArray(i.notifications))return;r.setQueryData(H.notifications(t,n),i)}catch{}}});return()=>{a.close()}},[e,t,n,r,i])}const Js=u()({component:Ys,errorComponent:Zs,notFoundComponent:Xs});function Ys(){let e=s({select:e=>e.location}),t=n(),r=c(),[a,l]=(0,M.useState)(!1),[u,d]=(0,M.useState)(!1),[f,p]=(0,M.useState)(!1),[m,h]=(0,M.useState)(!1),g=(0,M.useMemo)(()=>e.pathname===`/dashboard/labs/designer`,[e.pathname]),ee=(0,M.useMemo)(()=>g||e.pathname===`/dashboard/labs/map`,[g,e.pathname]);(0,M.useEffect)(()=>{g&&p(!0)},[g]),(0,M.useEffect)(()=>{window.location.pathname===`/index.html`&&t({to:`/`,replace:!0})},[t]);let _=i({queryKey:H.session(),queryFn:Br,retry:!1,staleTime:3e4}),v=i({queryKey:H.uiConfig(),queryFn:So,staleTime:5*6e4}),te=v.data?.productName||`Skyforge`,ne=v.data?.productSubtitle||`Automation Platform`,re=(0,M.useMemo)(()=>`${e.pathname}${e.searchStr??``}${e.hash??``}`,[e.pathname,e.searchStr,e.hash]),ie=(0,M.useMemo)(()=>Lr(re),[re]),ae=(0,M.useMemo)(()=>[`/dashboard`,`/admin`,`/webhooks`,`/syslog`,`/snmp`].some(t=>e.pathname.startsWith(t)),[e.pathname]);(0,M.useEffect)(()=>{h(!1)},[e.pathname]);let y=_.data?.displayName||_.data?.username||``,b=!!_.data?.isAdmin,x=ae&&!_.isLoading&&!_.data?.authenticated,S=_.data?.username??``;qs(!!S,!1,`20`);let oe=i({queryKey:H.notifications(!1,`20`),enabled:!!S,queryFn:async()=>({notifications:(await Wr(S,{include_read:`false`,limit:`20`})).notifications??[]}),staleTime:1/0,initialData:{notifications:[]}}),se=(0,M.useMemo)(()=>(oe.data?.notifications??[]).filter(e=>!e.is_read).length,[oe.data?.notifications]);return(0,P.jsx)(xr,{defaultTheme:`dark`,storageKey:`vite-ui-theme`,children:(0,P.jsxs)(`div`,{className:`min-h-full`,children:[(0,P.jsx)(yr,{}),(0,P.jsx)(`header`,{className:`sticky top-0 z-40 border-b glass-header`,children:(0,P.jsxs)(`div`,{className:`mx-auto flex h-16 max-w-[1600px] items-center justify-between gap-4 px-4`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-6`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,P.jsxs)(Os,{open:m,onOpenChange:h,children:[(0,P.jsx)(ks,{asChild:!0,children:(0,P.jsxs)(F,{variant:`ghost`,size:`icon`,className:`lg:hidden`,children:[(0,P.jsx)(Yt,{className:`h-5 w-5`}),(0,P.jsx)(`span`,{className:`sr-only`,children:`Toggle menu`})]})}),(0,P.jsx)(Ns,{side:`left`,className:`w-[240px] p-0`,children:(0,P.jsx)(`div`,{className:`px-2 py-6`,children:(0,P.jsx)(vs,{collapsed:!1,isAdmin:b,features:v.data?.features})})})]}),(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`div`,{className:`text-[10px] uppercase tracking-wider text-muted-foreground leading-none`,children:ne}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2 text-base font-semibold tracking-tight`,children:[(0,P.jsx)(kt,{className:`h-5 w-5 text-primary`}),(0,P.jsx)(`span`,{children:te})]})]}),(0,P.jsx)(`div`,{className:`h-8 w-px bg-border hidden md:block`}),(0,P.jsx)(`img`,{src:`/assets/skyforge/FN-logo.svg`,alt:`Forward Networks`,className:`h-6 w-auto hidden sm:block`})]}),(0,P.jsxs)(F,{variant:`outline`,className:`hidden md:flex h-9 w-64 items-center justify-start px-3 text-sm text-muted-foreground font-normal`,onClick:()=>{let e=new KeyboardEvent(`keydown`,{key:`k`,metaKey:!0,bubbles:!0});document.dispatchEvent(e)},children:[(0,P.jsx)(k,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Search...`}),(0,P.jsxs)(`kbd`,{className:`pointer-events-none ml-auto inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100`,children:[(0,P.jsx)(`span`,{className:`text-xs`,children:``}),`K`]})]})]}),(0,P.jsxs)(`nav`,{className:`flex items-center gap-4 text-sm`,children:[(0,P.jsxs)(F,{variant:`ghost`,size:`icon`,className:`relative text-muted-foreground hover:text-foreground`,"aria-label":`Notifications`,onClick:()=>void t({to:`/notifications`}),children:[(0,P.jsx)(ze,{className:`h-4 w-4`}),se>0?(0,P.jsx)(`span`,{className:`absolute -right-1 -top-1 inline-flex h-4 min-w-[16px] items-center justify-center rounded-full bg-primary px-1 text-[10px] font-semibold text-primary-foreground`,children:se>99?`99+`:se}):null]}),(0,P.jsx)(Fr,{}),_.data?.authenticated?(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsxs)(`div`,{className:`hidden md:flex flex-col items-end`,children:[(0,P.jsx)(`span`,{className:`text-[10px] text-muted-foreground uppercase leading-none`,children:`Signed in as`}),(0,P.jsx)(`span`,{className:`text-xs font-medium leading-none mt-1`,children:y})]}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,disabled:a,onClick:async()=>{try{l(!0),await Vr(),window.location.href=`/status?signin=1`}finally{l(!1)}},children:a?``:`Logout`})]}):(0,P.jsx)(F,{variant:`outline`,size:`sm`,disabled:u,onClick:async()=>{try{if(d(!0),!await Bs({loginHref:ie})){window.location.href=ie;return}await r.invalidateQueries({queryKey:H.session()})}finally{d(!1)}},children:u?``:`Login`})]})]})}),(0,P.jsxs)(`div`,{className:N(`mx-auto flex min-h-[calc(100vh-4rem)]`,ee?`max-w-none`:`max-w-[1600px]`),children:[_.data?.authenticated&&(0,P.jsx)(`aside`,{className:N(`hidden lg:block border-r bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60`,`transition-all duration-300 ease-in-out`,f?`w-[64px]`:`w-[220px]`),children:(0,P.jsxs)(`div`,{className:`relative h-full`,children:[(0,P.jsx)(`div`,{className:N(`h-full px-4 py-4`,f&&`px-2`),children:(0,P.jsx)(vs,{collapsed:f,isAdmin:b,features:v.data?.features})}),(0,P.jsx)(`button`,{className:N(`absolute -right-3 top-4 flex h-7 w-7 items-center justify-center rounded-full border bg-background text-foreground shadow-sm`,`hover:bg-accent hover:text-accent-foreground transition-colors`),onClick:()=>p(e=>!e),"aria-label":f?`Expand navigation`:`Collapse navigation`,children:f?(0,P.jsx)(rt,{className:`h-4 w-4`}):(0,P.jsx)(fe,{className:`h-4 w-4`})})]})}),(0,P.jsx)(`main`,{className:N(`flex-1 w-full overflow-hidden flex flex-col`,ee?`px-0 py-0`:`px-4 py-6`),children:x?(0,P.jsx)(`div`,{className:`mx-auto max-w-xl`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Login Required`}),(0,P.jsx)(B,{children:`Sign in to access this page.`})]}),(0,P.jsxs)(V,{className:`flex flex-col gap-3`,children:[(0,P.jsx)(F,{variant:`default`,disabled:u,onClick:async()=>{try{if(d(!0),!await Bs({loginHref:ie})){window.location.href=ie;return}await r.invalidateQueries({queryKey:H.session()})}finally{d(!1)}},children:u?``:`Login`}),(0,P.jsx)(`a`,{className:`text-sm text-muted-foreground underline`,href:ie,children:`Login with redirect instead`})]})]})}):(0,P.jsxs)(P.Fragment,{children:[ee?null:(0,P.jsx)(`div`,{className:`mb-6`,children:(0,P.jsx)(ys,{children:(0,P.jsxs)(bs,{children:[(0,P.jsx)(xs,{children:(0,P.jsx)(Ss,{href:`/status`,children:`Dashboard`})}),` `,(()=>{let t=e.pathname.split(`/`).filter(Boolean),n=t;for(;n[0]===`dashboard`;)n=n.slice(1);let r=t[0]===`dashboard`?`/dashboard`:``;return n.map((e,t,n)=>{let i=`${r}/${n.slice(0,t+1).join(`/`)}`,a=t===n.length-1;return(0,P.jsxs)(M.Fragment,{children:[(0,P.jsx)(ws,{}),(0,P.jsx)(xs,{children:a?(0,P.jsx)(Cs,{className:`capitalize`,children:e}):(0,P.jsx)(Ss,{href:i,className:`capitalize`,children:e})})]},i)})})()]})})}),(0,P.jsx)(o,{}),ee?null:(0,P.jsxs)(`footer`,{className:`mt-auto pt-12 pb-6 flex items-center justify-between text-xs text-muted-foreground border-t`,children:[(0,P.jsx)(`div`,{className:`flex gap-4`,children:(0,P.jsxs)(`span`,{children:[`Questions? Reach out at`,` `,(0,P.jsx)(`span`,{className:`font-mono text-primary`,children:`#ask-skyforge`})]})}),(0,P.jsx)(`a`,{className:`hover:text-foreground transition-colors underline hover:no-underline`,href:`/git/skyforge/skyforge/issues/new`,target:`_blank`,rel:`noreferrer`,children:`File an issue`})]})]})})]}),(0,P.jsx)(vr,{}),(0,P.jsx)(Rs,{})]})})}function Xs(){return(0,P.jsx)(`div`,{className:`flex flex-col items-center justify-center min-h-[50vh] space-y-4 text-center`,children:(0,P.jsxs)(L,{variant:`glass`,className:`max-w-md`,children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{className:`text-2xl`,children:`Page not found`}),(0,P.jsx)(B,{children:`This route hasnt been migrated yet (or the URL is incorrect).`})]}),(0,P.jsxs)(V,{className:`flex flex-wrap justify-center gap-3`,children:[(0,P.jsx)(F,{variant:`default`,asChild:!0,children:(0,P.jsx)(p,{to:`/dashboard/deployments`,children:`Go to deployments`})}),(0,P.jsx)(F,{variant:`outline`,asChild:!0,children:(0,P.jsx)(p,{to:`/status`,children:`Platform status`})})]})]})})}function Zs(e){let t=e.error instanceof Error?e.error.message:typeof e.error==`string`?e.error:`Unknown error`;return(0,P.jsxs)(`div`,{className:`space-y-6`,children:[(0,P.jsxs)(L,{variant:`danger`,children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Application error`}),(0,P.jsx)(B,{className:`text-red-200/80`,children:t})]}),(0,P.jsxs)(V,{className:`flex flex-wrap gap-3`,children:[(0,P.jsx)(F,{variant:`outline`,className:`border-red-500/50 bg-red-500/10 hover:bg-red-500/20 text-red-100`,onClick:()=>e.reset(),children:`Try again`}),(0,P.jsx)(F,{variant:`secondary`,asChild:!0,children:(0,P.jsx)(p,{to:`/dashboard/deployments`,children:`Go to deployments`})})]})]}),e.error instanceof Error&&e.error.stack&&(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{className:`text-sm`,children:`Error Stack Trace`})}),(0,P.jsx)(V,{children:(0,P.jsx)(`pre`,{className:`overflow-auto whitespace-pre-wrap text-xs text-muted-foreground p-4 rounded-md bg-muted`,children:e.error.stack})})]})]})}function Qs(e){return e===void 0?`minmax(0, 1fr)`:typeof e==`number`?`${e}px`:e}function $s({columns:e,rows:t,getRowId:n,onRowClick:r,getRowClassName:i,getRowAriaSelected:a,isLoading:o,emptyText:s=`No results.`,scrollable:c=!0,maxHeightClassName:l=`max-h-[70vh]`,minWidthClassName:u=`min-w-[900px]`,estimateRowHeight:d=34}){let f=M.useRef(null),p=u!==`min-w-0`,h=M.useMemo(()=>e.map(e=>Qs(e.width)).join(` `),[e]),g=m({count:t.length,getScrollElement:()=>c?f.current:null,estimateSize:()=>d,overscan:10}),ee=g.getVirtualItems();return(0,P.jsx)(`div`,{className:N(`w-full rounded-md border`,p?`overflow-x-auto overflow-y-hidden`:`overflow-hidden`),children:(0,P.jsx)(`div`,{className:N(u),children:(0,P.jsxs)(`div`,{role:`table`,"aria-rowcount":t.length,className:`w-full text-sm`,style:{gridTemplateColumns:h},children:[(0,P.jsx)(`div`,{role:`rowgroup`,className:`sticky top-0 z-10 border-b bg-background/90 backdrop-blur`,children:(0,P.jsx)(`div`,{role:`row`,className:`grid`,style:{gridTemplateColumns:h},children:e.map(e=>(0,P.jsx)(`div`,{role:`columnheader`,className:N(`px-3 py-2 text-xs font-medium uppercase tracking-wide text-muted-foreground`,e.align===`center`&&`text-center`,e.align===`right`&&`text-right`,e.headerClassName),children:e.header},e.id))})}),(0,P.jsx)(`div`,{role:`rowgroup`,ref:c?f:void 0,className:N(`relative`,c&&`overflow-auto`,c&&l),children:o?(0,P.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:`Loading`}):t.length===0?(0,P.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:s}):c?(0,P.jsx)(`div`,{className:`relative`,style:{height:`${g.getTotalSize()}px`},children:ee.map(o=>{let s=t[o.index],c=n(s),l=!!r,u=i?.(s,o.index),d=a?.(s,o.index);return(0,P.jsx)(`div`,{role:`row`,"aria-rowindex":o.index+1,"aria-selected":d,className:N(`absolute left-0 right-0 grid border-b last:border-b-0`,o.index%2==0&&`bg-background`,o.index%2==1&&`bg-muted/20`,l&&`cursor-pointer hover:bg-muted/40`,u),style:{gridTemplateColumns:h,transform:`translateY(${o.start}px)`},onClick:l?()=>r?.(s):void 0,children:e.map(e=>(0,P.jsx)(`div`,{role:`cell`,className:N(`px-3 py-2 align-middle`,e.align===`center`&&`text-center`,e.align===`right`&&`text-right`,e.className),children:e.cell(s)},e.id))},c)})}):(0,P.jsx)(`div`,{className:`relative`,children:t.map((t,o)=>{let s=n(t),c=!!r,l=i?.(t,o),u=a?.(t,o);return(0,P.jsx)(`div`,{role:`row`,"aria-rowindex":o+1,"aria-selected":u,className:N(`grid border-b last:border-b-0`,o%2==0&&`bg-background`,o%2==1&&`bg-muted/20`,c&&`cursor-pointer hover:bg-muted/40`,l),style:{gridTemplateColumns:h},onClick:c?()=>r?.(t):void 0,children:e.map(e=>(0,P.jsx)(`div`,{role:`cell`,className:N(`px-3 py-2 align-middle`,e.align===`center`&&`text-center`,e.align===`right`&&`text-right`,e.className),children:e.cell(t)},e.id))},s)})})})]})})})}function ec({title:e,description:t,icon:n,action:r,className:i,...a}){return(0,P.jsx)(`div`,{className:N(`flex min-h-[400px] flex-col items-center justify-center rounded-md border border-dashed p-8 text-center animate-in fade-in zoom-in duration-300`,i),...a,children:(0,P.jsxs)(`div`,{className:`mx-auto flex max-w-[420px] flex-col items-center justify-center text-center`,children:[n&&(0,P.jsx)(`div`,{className:`flex h-20 w-20 items-center justify-center rounded-full bg-muted`,children:(0,P.jsx)(n,{className:`h-10 w-10 text-muted-foreground`})}),(0,P.jsx)(`h3`,{className:`mt-4 text-lg font-semibold`,children:e}),t&&(0,P.jsx)(`p`,{className:`mb-4 mt-2 text-sm text-muted-foreground`,children:t}),r&&(0,P.jsx)(F,{onClick:r.onClick,variant:`outline`,size:`sm`,children:r.label})]})})}function U({className:e,...t}){return(0,P.jsx)(`div`,{className:N(`animate-pulse rounded-md bg-muted`,e),...t})}function tc(e,t){let n=c(),r=(0,M.useMemo)(()=>`${Ir}/webhooks/events/stream?limit=${encodeURIComponent(t)}`,[t]);(0,M.useEffect)(()=>{if(!e)return;let i=Ks(r,{snapshot:e=>{try{let r=JSON.parse(e.data);n.setQueryData(H.webhookEvents(t),r)}catch{}}});return()=>{i.close()}},[e,t,n,r])}const nc=t(`/webhooks`)({component:rc});function rc(){tc(!0,`200`);let e=i({queryKey:H.webhookEvents(`200`),queryFn:()=>eo({limit:`200`}),staleTime:1/0}),t=e.data?.events??[];return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Webhook inbox`}),(0,P.jsx)(B,{children:`Recent webhook events routed to your user.`})]})}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-0`,children:e.isLoading?(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(U,{className:`h-12 w-full`}),(0,P.jsx)(U,{className:`h-12 w-full`}),(0,P.jsx)(U,{className:`h-12 w-full`})]}):e.isError?(0,P.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load webhook events.`}):t.length===0?(0,P.jsx)(ec,{icon:kn,title:`No webhook events`,description:`No webhook events have been received yet.`}):(0,P.jsx)($s,{columns:[{id:`time`,header:`Time`,width:190,cell:e=>(0,P.jsx)(`span`,{className:`text-muted-foreground whitespace-nowrap text-xs`,children:e.receivedAt??``})},{id:`source`,header:`Source`,width:160,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.sourceIp??``})},{id:`event`,header:`Event`,cell:e=>(0,P.jsxs)(`span`,{className:`font-medium text-sm`,children:[e.method,` `,e.path]})},{id:`id`,header:`ID`,width:120,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:String(e.id)})}],rows:t,getRowId:e=>String(e.id),maxHeightClassName:`max-h-[65vh]`})})})]})}function ic(e,t){let n=c(),r=(0,M.useMemo)(()=>`${Ir}/syslog/events/stream?limit=${encodeURIComponent(t)}`,[t]);(0,M.useEffect)(()=>{if(!e)return;let i=Ks(r,{snapshot:e=>{try{let r=JSON.parse(e.data);n.setQueryData(H.syslogEvents(t),r)}catch{}}});return()=>{i.close()}},[e,t,n,r])}const ac=t(`/syslog`)({component:oc});function oc(){ic(!0,`200`);let e=i({queryKey:H.syslogEvents(`200`),queryFn:()=>to({limit:`200`}),staleTime:1/0}),t=e.data?.events??[];return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Syslog inbox`}),(0,P.jsx)(B,{children:`Recent syslog events mapped to your user.`})]})}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-0`,children:e.isLoading?(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(U,{className:`h-12 w-full`}),(0,P.jsx)(U,{className:`h-12 w-full`}),(0,P.jsx)(U,{className:`h-12 w-full`})]}):e.isError?(0,P.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load syslog events.`}):t.length===0?(0,P.jsx)(ec,{icon:kn,title:`No syslog events`,description:`No syslog messages have been received yet.`}):(0,P.jsx)($s,{columns:[{id:`time`,header:`Time`,width:190,cell:e=>(0,P.jsx)(`span`,{className:`text-muted-foreground whitespace-nowrap text-xs`,children:e.receivedAt??``})},{id:`source`,header:`Source`,width:160,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.sourceIp??``})},{id:`app`,header:`App`,width:160,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.appName??``})},{id:`message`,header:`Message`,cell:e=>(0,P.jsx)(`span`,{className:`font-medium text-foreground text-sm line-clamp-2`,children:e.message??``})}],rows:t,getRowId:e=>String(e.id),maxHeightClassName:`max-h-[65vh]`})})})]})}var sc=Gn(`inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2`,{variants:{variant:{default:`border-transparent bg-primary text-primary-foreground hover:bg-primary/80`,secondary:`border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80`,destructive:`border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80`,outline:`text-foreground`}},defaultVariants:{variant:`default`}});function W({className:e,variant:t,...n}){return(0,P.jsx)(`div`,{className:N(sc({variant:t}),e),...n})}var cc={blue:`from-blue-500/10 via-blue-500/5 to-transparent`,green:`from-emerald-500/10 via-emerald-500/5 to-transparent`,purple:`from-purple-500/10 via-purple-500/5 to-transparent`,orange:`from-orange-500/10 via-orange-500/5 to-transparent`,red:`from-red-500/10 via-red-500/5 to-transparent`};const lc=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`div`,{ref:n,className:N(`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4`,e),...t}));lc.displayName=`BentoGrid`;const uc=M.forwardRef(({className:e,gradient:t=`blue`,children:n,...r},i)=>(0,P.jsx)(`div`,{ref:i,className:N(`relative overflow-hidden rounded-xl border border-border bg-card p-6`,`bg-gradient-to-br`,cc[t],e),...r,children:n}));uc.displayName=`BentoItem`;const dc=M.forwardRef(({title:e,value:t,gradient:n=`blue`,icon:r,subtitle:i,trend:a,className:o},s)=>(0,P.jsxs)(uc,{ref:s,gradient:n,className:o,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2 mb-2`,children:[r&&(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:r}),(0,P.jsx)(`h3`,{className:`text-sm font-medium text-muted-foreground/80`,children:e})]}),(0,P.jsxs)(`div`,{className:`flex items-end justify-between`,children:[(0,P.jsx)(`div`,{className:`text-3xl font-bold`,children:t}),a&&(0,P.jsxs)(`div`,{className:N(`flex items-center gap-1 text-sm`,a.direction===`up`?`text-emerald-500`:`text-red-500`),children:[a.direction===`up`?(0,P.jsx)(Hn,{className:`w-4 h-4`}):(0,P.jsx)(ae,{className:`w-4 h-4`}),a.value,`%`]})]}),i&&(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground/70 mt-2`,children:i})]}));dc.displayName=`BentoStatCard`;const fc=M.forwardRef(({userName:e,subtitle:t,className:n},r)=>(0,P.jsx)(uc,{ref:r,gradient:`purple`,className:N(`md:col-span-2`,n),children:(0,P.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,children:[(0,P.jsx)(`div`,{className:`p-2 rounded-full bg-purple-500/10`,children:(0,P.jsx)(ve,{className:`w-5 h-5 text-purple-500`})}),(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h2`,{className:`text-xl font-bold`,children:e?`Welcome back, ${e}`:`Welcome to Skyforge`}),t&&(0,P.jsx)(`p`,{className:`text-sm text-muted-foreground/80`,children:t})]})]})}));fc.displayName=`BentoWelcomeCard`;const pc=M.forwardRef(({actions:e,className:t},n)=>(0,P.jsxs)(uc,{ref:n,gradient:`blue`,className:N(`md:col-span-2`,t),children:[(0,P.jsx)(`h3`,{className:`font-semibold mb-4`,children:`Quick Actions`}),(0,P.jsx)(`div`,{className:`grid grid-cols-2 gap-3`,children:e.map((e,t)=>(0,P.jsxs)(rn.button,{onClick:e.onClick,className:`flex items-center gap-2 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors text-left`,whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.icon,(0,P.jsx)(`span`,{className:`text-sm font-medium`,children:e.label})]},t))})]}));pc.displayName=`BentoQuickActions`;const mc=M.forwardRef(({servers:e,className:t},n)=>(0,P.jsxs)(uc,{ref:n,gradient:`green`,className:N(`md:col-span-2`,t),children:[(0,P.jsx)(`h3`,{className:`font-semibold mb-4`,children:`Server Status`}),(0,P.jsx)(`div`,{className:`grid grid-cols-2 gap-3`,children:e.map((e,t)=>(0,P.jsxs)(`div`,{className:`flex items-center justify-between p-3 rounded-lg bg-muted/30`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`div`,{className:N(`w-2 h-2 rounded-full`,e.status===`online`?`bg-emerald-500`:e.status===`degraded`?`bg-amber-500`:`bg-red-500`)}),(0,P.jsx)(`span`,{className:`text-sm font-medium`,children:e.name})]}),e.cpu!==void 0&&(0,P.jsxs)(W,{variant:`secondary`,className:`text-xs`,children:[e.cpu,`%`]})]},t))})]}));mc.displayName=`BentoServerStatus`;function hc(e){let t=c(),n=(0,M.useMemo)(()=>`/status/summary/events`,[]);(0,M.useEffect)(()=>{if(!e)return;let r=Ks(n,{snapshot:e=>{try{let n=JSON.parse(e.data);t.setQueryData(H.statusSummary(),n)}catch{}}});return()=>{r.close()}},[e,t,n])}const gc=t(`/status`)({component:_c});function _c(){hc(!0);let e=i({queryKey:H.statusSummary(),queryFn:Co,staleTime:1/0}),t=i({queryKey:H.uiConfig(),queryFn:So,staleTime:1/0}),n=t.data?.features,r=e.data,a=r?.checks??[],o=a.filter(e=>e.status!==`up`&&e.status!==`ok`);return(0,P.jsxs)(`div`,{className:`space-y-8 p-6`,children:[(0,P.jsxs)(lc,{className:`gap-4`,children:[(0,P.jsx)(fc,{subtitle:`Here's what's happening with your infrastructure today.`}),e.isLoading?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(uc,{className:`h-32`,children:(0,P.jsx)(U,{className:`h-full w-full`})}),(0,P.jsx)(uc,{className:`h-32`,children:(0,P.jsx)(U,{className:`h-full w-full`})}),(0,P.jsx)(uc,{className:`h-32`,children:(0,P.jsx)(U,{className:`h-full w-full`})})]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(dc,{title:`Active Deployments`,value:r?.deploymentsActive??0,gradient:`green`,icon:(0,P.jsx)(He,{className:`w-5 h-5`}),subtitle:`${r?.deploymentsTotal??0} total deployments`}),(0,P.jsx)(dc,{title:`Services Operational`,value:`${r?.up??0} / ${a.length}`,gradient:r?.up===a.length?`green`:`orange`,icon:(0,P.jsx)(me,{className:`w-5 h-5`})}),(0,P.jsx)(dc,{title:`Services Down`,value:r?.down??0,gradient:r?.down?`red`:`blue`,icon:(0,P.jsx)(Cn,{className:`w-5 h-5`})}),(0,P.jsxs)(uc,{gradient:`purple`,className:`relative overflow-hidden`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between mb-3`,children:[(0,P.jsxs)(`h3`,{className:`font-semibold flex items-center gap-2 text-sm text-muted-foreground/80`,children:[(0,P.jsx)(ne,{className:`w-4 h-4`}),`Platform Health`]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(`span`,{className:`relative flex h-2 w-2`,children:[(0,P.jsx)(`span`,{className:`animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75`}),(0,P.jsx)(`span`,{className:`relative inline-flex rounded-full h-2 w-2 bg-emerald-500`})]}),(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:`Live`})]})]}),(0,P.jsx)(`div`,{className:`flex items-end gap-4`,children:(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`span`,{className:N(`text-3xl font-bold`,r?.status===`ok`?`text-emerald-500`:r?.status===`degraded`?`text-amber-500`:`text-muted-foreground`),children:(r?.status??`checking`).toUpperCase()}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground mt-1`,children:r?.timestamp?`Refreshed ${new Date(r.timestamp).toLocaleTimeString()}`:`Checking...`})]})})]})]})]}),(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-3`,children:[t.data?.externalUrl&&(0,P.jsxs)(L,{variant:`glass`,className:`border-green-500/20 bg-green-500/5`,children:[(0,P.jsx)(R,{children:(0,P.jsxs)(z,{className:`text-base flex items-center gap-2 text-green-500`,children:[(0,P.jsx)(bt,{className:`w-4 h-4`}),`Public Access`]})}),(0,P.jsxs)(V,{className:`text-sm text-muted-foreground space-y-3`,children:[(0,P.jsx)(`p`,{children:`This environment is securely accessible via Cloudflare Tunnel.`}),(0,P.jsx)(`div`,{className:`rounded bg-background/50 p-2 border`,children:(0,P.jsx)(`a`,{className:`text-primary hover:underline break-all font-mono text-xs`,href:t.data.externalUrl,target:`_blank`,rel:`noreferrer`,children:t.data.externalUrl})})]})]}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsx)(R,{children:(0,P.jsxs)(z,{className:`text-base flex items-center gap-2`,children:[(0,P.jsx)(E,{className:`w-4 h-4 text-orange-500`}),`Skyforge at a Glance`]})}),(0,P.jsxs)(V,{className:`text-sm text-muted-foreground space-y-3`,children:[(0,P.jsx)(`p`,{children:`Skyforge coordinates lab + cloud tooling into repeatable, auditable workflows for platform teams.`}),(0,P.jsxs)(`ul`,{className:`list-disc pl-4 space-y-1`,children:[(0,P.jsx)(`li`,{children:`Teams can still run tools manually; Skyforge standardizes the "happy path".`}),(0,P.jsx)(`li`,{children:`Enables consistent lab delivery across on-prem and cloud environments.`}),(0,P.jsx)(`li`,{children:`Creates shared context for collaboration, troubleshooting, and handoffs.`})]})]})]}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsx)(R,{children:(0,P.jsxs)(z,{className:`text-base flex items-center gap-2`,children:[(0,P.jsx)(oe,{className:`w-4 h-4 text-blue-500`}),`What You Can Do Here`]})}),(0,P.jsxs)(V,{className:`text-sm text-muted-foreground space-y-2`,children:[(0,P.jsx)(p,{className:`text-primary hover:underline`,to:`/dashboard/deployments`,children:` Open the dashboard`}),(0,P.jsx)(p,{className:`text-primary hover:underline`,to:`/dashboard/deployments/new`,children:` Create a deployment`}),(0,P.jsx)(p,{className:`text-primary hover:underline`,to:`/dashboard/s3`,children:` Browse artifacts (S3)`}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground mt-3`,children:`Status is refreshed automatically via Server-Sent Events.`})]})]}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsx)(R,{children:(0,P.jsxs)(z,{className:`text-base flex items-center gap-2`,children:[(0,P.jsx)(ke,{className:`w-4 h-4 text-purple-500`}),`How Workflows Run`]})}),(0,P.jsxs)(V,{className:`text-sm text-muted-foreground space-y-2`,children:[(0,P.jsx)(`p`,{children:`Skyforge connects source control, automation, and lab capacity into one delivery loop.`}),(0,P.jsxs)(`ol`,{className:`list-decimal pl-4 space-y-1`,children:[(0,P.jsx)(`li`,{children:`Choose a blueprint (Git).`}),(0,P.jsx)(`li`,{children:`Run deployments (native task engine).`}),(0,P.jsx)(`li`,{children:`Validate on lab servers (BYOS + In-Cluster).`}),(0,P.jsx)(`li`,{children:`Store artifacts + state (Skyforge storage).`})]})]})]})]}),(0,P.jsx)(lc,{className:`gap-4`,children:(0,P.jsxs)(uc,{gradient:`blue`,className:`md:col-span-4 hover-lift`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between mb-6`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(`div`,{className:`p-2 rounded-lg bg-blue-500/10`,children:(0,P.jsx)(Cn,{className:`w-5 h-5 text-blue-500`})}),(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h3`,{className:`font-semibold`,children:`Integrated Toolchain & Status`}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Live health checks for all platform services.`})]})]}),o.length>0&&(0,P.jsxs)(W,{variant:`destructive`,className:`animate-pulse`,children:[o.length,` Service`,o.length>1?`s`:``,` `,`Reporting Issues`]})]}),(0,P.jsx)(`div`,{className:`grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4`,children:[{id:`gitea`,name:`Git`,path:`/git/`,icon:Fn,enabled:n?.giteaEnabled??!0,external:!0},{id:`netbox`,name:`NetBox`,path:`/netbox/`,icon:yn,enabled:n?.netboxEnabled??!1,external:!0},{id:`nautobot`,name:`Nautobot`,path:`/nautobot/`,icon:yn,enabled:n?.nautobotEnabled??!1,external:!0},{id:`coder`,name:`Coder`,path:`/coder/launch`,icon:He,enabled:n?.coderEnabled??!1,external:!0},{id:`yaade`,name:`API Testing`,path:`${Ir}/yaade/sso`,icon:ne,enabled:n?.yaadeEnabled??!1,external:!0},{id:`webhooks`,name:`Webhooks`,path:`/dashboard/webhooks`,icon:ke,enabled:!0,external:!1}].filter(e=>e.enabled).map(e=>{let t=a.find(t=>t.name.toLowerCase().includes(e.id)),n=t?t.status===`up`||t.status===`ok`:!0,r=n?`bg-emerald-500`:`bg-red-500`,i=e.icon;return(0,P.jsxs)(`a`,{href:e.path,target:e.external?`_blank`:`_self`,rel:e.external?`noreferrer noopener`:void 0,className:`flex flex-col items-center justify-center p-4 rounded-lg bg-background/50 border hover:bg-background/80 transition-colors group relative overflow-hidden`,children:[(0,P.jsx)(`div`,{className:`absolute top-2 right-2 w-2 h-2 rounded-full ${r} ${n?``:`animate-pulse`}`}),(0,P.jsx)(i,{className:`w-6 h-6 mb-2 text-muted-foreground group-hover:text-primary transition-colors`}),(0,P.jsx)(`span`,{className:`text-sm font-medium`,children:e.name}),(0,P.jsx)(`span`,{className:N(`text-[10px] mt-1 capitalize font-medium`,n?`text-emerald-500/80`:`text-red-500`),children:t?.status??`Operational`})]},e.id)})}),o.length>0&&(0,P.jsxs)(`div`,{className:`mt-6 pt-6 border-t`,children:[(0,P.jsx)(`h4`,{className:`text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-3`,children:`Service Alerts`}),(0,P.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:o.map(e=>(0,P.jsxs)(W,{variant:`outline`,className:`text-[10px] border-red-500/30 text-red-400 bg-red-500/5`,children:[e.name,`: `,e.status]},e.name))})]})]})})]})}function vc(e,t){let n=c(),r=(0,M.useMemo)(()=>`${Ir}/snmp/traps/events/stream?limit=${encodeURIComponent(t)}`,[t]);(0,M.useEffect)(()=>{if(!e)return;let i=Ks(r,{snapshot:e=>{try{let r=JSON.parse(e.data);n.setQueryData(H.snmpTrapEvents(t),r)}catch{}}});return()=>{i.close()}},[e,t,n,r])}const yc=t(`/snmp`)({component:bc});function bc(){vc(!0,`200`);let e=i({queryKey:H.snmpTrapEvents(`200`),queryFn:()=>no({limit:`200`}),staleTime:1/0}),t=e.data?.events??[];return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`SNMP trap inbox`}),(0,P.jsx)(B,{children:`Recent SNMP trap events routed to your user.`})]})}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-0`,children:e.isLoading?(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(U,{className:`h-12 w-full`}),(0,P.jsx)(U,{className:`h-12 w-full`}),(0,P.jsx)(U,{className:`h-12 w-full`})]}):e.isError?(0,P.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load SNMP trap events.`}):t.length===0?(0,P.jsx)(ec,{icon:kn,title:`No trap events`,description:`No SNMP traps have been received yet.`}):(0,P.jsx)($s,{columns:[{id:`time`,header:`Time`,width:190,cell:e=>(0,P.jsx)(`span`,{className:`text-muted-foreground whitespace-nowrap text-xs`,children:e.receivedAt??``})},{id:`source`,header:`Source`,width:160,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.sourceIp??``})},{id:`oid`,header:`OID`,cell:e=>(0,P.jsx)(`span`,{className:`font-medium text-foreground text-sm font-mono`,children:e.oid??``})},{id:`id`,header:`ID`,width:120,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:String(e.id)})}],rows:t,getRowId:e=>String(e.id),maxHeightClassName:`max-h-[65vh]`})})})]})}var xc=g,Sc=Re,Cc=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(dt,{className:N(`fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t,ref:n}));Cc.displayName=dt.displayName;var wc=M.forwardRef(({className:e,...t},n)=>(0,P.jsxs)(Sc,{children:[(0,P.jsx)(Cc,{}),(0,P.jsx)(ct,{ref:n,className:N(`fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg`,e),...t})]}));wc.displayName=ct.displayName;var Tc=({className:e,...t})=>(0,P.jsx)(`div`,{className:N(`flex flex-col space-y-2 text-center sm:text-left`,e),...t});Tc.displayName=`AlertDialogHeader`;var Ec=({className:e,...t})=>(0,P.jsx)(`div`,{className:N(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});Ec.displayName=`AlertDialogFooter`;var Dc=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(At,{ref:n,className:N(`text-lg font-semibold`,e),...t}));Dc.displayName=At.displayName;var Oc=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(at,{ref:n,className:N(`text-sm text-muted-foreground`,e),...t}));Oc.displayName=at.displayName;var kc=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(fn,{ref:n,className:N(Cr(),e),...t}));kc.displayName=fn.displayName;var Ac=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(ye,{ref:n,className:N(Cr({variant:`outline`}),`mt-2 sm:mt-0`,e),...t}));Ac.displayName=ye.displayName;var jc=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(de,{ref:n,className:N(`peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground`,e),...t,children:(0,P.jsx)(Se,{className:N(`flex items-center justify-center text-current`),children:(0,P.jsx)(pn,{className:`h-4 w-4`})})}));jc.displayName=de.displayName;var Mc=Gn(`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70`),G=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(nt,{ref:n,className:N(Mc(),e),...t}));G.displayName=nt.displayName;var Nc=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(pe,{className:N(`peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input`,e),...t,ref:n,children:(0,P.jsx)(Xe,{className:N(`pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0`)})}));Nc.displayName=pe.displayName;const Pc=t(`/notifications`)({component:Fc});function Fc(){let[e,t]=(0,M.useState)(!1),[n,r]=(0,M.useState)(null),[a,o]=(0,M.useState)(!1),[s,l]=(0,M.useState)(new Set),u=c(),d=i({queryKey:H.session(),queryFn:Br,staleTime:3e4,retry:!1}).data?.username??``;qs(!!d,e,`50`);let f=i({queryKey:H.notifications(e,`50`),enabled:!!d,queryFn:async()=>({notifications:(await Wr(d,{include_read:e?`true`:`false`,limit:`50`})).notifications??[]}),staleTime:1/0,initialData:{notifications:[]}}),p=(0,M.useMemo)(()=>f.data?.notifications??[],[f.data?.notifications]),m=(0,M.useMemo)(()=>p.filter(e=>!e.is_read).length,[p]),h=e=>{l(e?new Set(p.map(e=>String(e.id))):new Set)},g=(e,t)=>{let n=new Set(s);t?n.add(e):n.delete(e),l(n)},ee=async()=>{try{let t=Array.from(s).map(e=>Kr(e));await Promise.all(t),j.success(`${s.size} notifications marked as read`),l(new Set),await u.invalidateQueries({queryKey:H.notifications(e,`50`)})}catch(e){j.error(`Failed to mark selection as read`,{description:e.message})}},_=async()=>{try{let t=Array.from(s).map(e=>qr(e));await Promise.all(t),j.success(`${s.size} notifications deleted`),l(new Set),await u.invalidateQueries({queryKey:H.notifications(e,`50`)})}catch(e){j.error(`Failed to delete selection`,{description:e.message})}},v=async()=>{try{await Gr(d),j.success(`All notifications marked as read`)}catch(e){j.error(`Failed to mark notifications as read`,{description:e.message})}},te=async e=>{try{await Kr(e),j.success(`Notification marked as read`)}catch(e){j.error(`Failed to mark notification as read`,{description:e.message})}},ne=async()=>{if(n)try{await qr(n),j.success(`Notification deleted`),o(!1),r(null)}catch(e){j.error(`Failed to delete notification`,{description:e.message})}},re=[{id:`select`,header:(0,P.jsx)(jc,{checked:p.length>0&&s.size===p.length,onCheckedChange:e=>h(!!e),"aria-label":`Select all`}),width:54,headerClassName:`px-2 py-0`,className:`px-2 py-0`,cell:e=>{let t=String(e.id);return(0,P.jsx)(jc,{checked:s.has(t),onCheckedChange:e=>g(t,e),"aria-label":`Select notification ${t}`})}},{id:`time`,header:`Time`,width:190,cell:e=>(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs whitespace-nowrap`,children:e.created_at??``})},{id:`message`,header:`Title & Message`,cell:e=>(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`div`,{className:`font-medium text-sm`,children:e.title??``}),e.message?(0,P.jsx)(`div`,{className:`mt-1 text-xs text-muted-foreground line-clamp-2`,children:e.message}):null]})},{id:`category`,header:`Category`,width:160,cell:e=>(0,P.jsx)(`span`,{className:`inline-flex items-center rounded-full bg-muted px-2 py-0.5 text-[10px] font-medium text-muted-foreground capitalize`,children:e.category??`System`})},{id:`actions`,header:`Actions`,width:120,align:`right`,cell:e=>{let t=String(e.id);return(0,P.jsxs)(wr,{children:[(0,P.jsx)(Tr,{asChild:!0,children:(0,P.jsxs)(F,{variant:`ghost`,size:`icon`,className:`h-8 w-8`,children:[(0,P.jsx)(Ut,{className:`h-4 w-4`}),(0,P.jsx)(`span`,{className:`sr-only`,children:`Open menu`})]})}),(0,P.jsxs)(Or,{align:`end`,children:[!e.is_read&&(0,P.jsxs)(kr,{onClick:()=>te(t),children:[(0,P.jsx)(pn,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Mark as read`})]}),(0,P.jsxs)(kr,{className:`text-destructive focus:text-destructive`,onClick:()=>{r(t),o(!0)},children:[(0,P.jsx)(tt,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Delete`})]})]})]})}}];return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(`div`,{className:`p-2 rounded-full bg-primary/10`,children:(0,P.jsx)(ze,{className:`h-6 w-6 text-primary`})}),(0,P.jsxs)(`div`,{children:[(0,P.jsx)(z,{children:`Notifications`}),(0,P.jsx)(B,{children:`Stay updated with platform events and system alerts.`})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(Nc,{id:`show-read`,checked:e,onCheckedChange:t}),(0,P.jsx)(G,{htmlFor:`show-read`,className:`cursor-pointer`,children:`Show read`})]}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,disabled:!d||m===0,onClick:v,children:`Mark all read`})]})]})})}),s.size>0&&(0,P.jsxs)(`div`,{className:`fixed bottom-6 left-1/2 -translate-x-1/2 z-50 flex items-center gap-4 rounded-full border bg-background/95 p-2 px-6 shadow-xl backdrop-blur animate-in slide-in-from-bottom-10 fade-in duration-300`,children:[(0,P.jsxs)(`span`,{className:`text-sm font-medium`,children:[s.size,` selected`]}),(0,P.jsx)(`div`,{className:`h-4 w-px bg-border`}),(0,P.jsxs)(F,{size:`sm`,variant:`ghost`,onClick:ee,children:[(0,P.jsx)(pn,{className:`mr-2 h-4 w-4`}),`Mark read`]}),(0,P.jsxs)(F,{size:`sm`,variant:`destructive`,onClick:_,children:[(0,P.jsx)(tt,{className:`mr-2 h-4 w-4`}),`Delete`]}),(0,P.jsx)(F,{size:`sm`,variant:`ghost`,onClick:()=>l(new Set),children:`Cancel`})]}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-0`,children:f.isLoading?(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(U,{className:`h-12 w-full`}),(0,P.jsx)(U,{className:`h-12 w-full`}),(0,P.jsx)(U,{className:`h-12 w-full`})]}):f.isError?(0,P.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load notifications.`}):p.length===0?(0,P.jsx)(ec,{icon:kn,title:`No notifications`,description:e?`You don't have any notifications at the moment.`:`You've read all your notifications!`}):(0,P.jsx)($s,{columns:re,rows:p,getRowId:e=>String(e.id),getRowClassName:e=>{let t=String(e.id),n=s.has(t);return[e.is_read?`opacity-60 grayscale-[0.5]`:``,n?`bg-primary/10 hover:bg-primary/10`:``].filter(Boolean).join(` `)},getRowAriaSelected:e=>s.has(String(e.id)),maxHeightClassName:`max-h-[65vh]`,minWidthClassName:`min-w-[900px]`})})}),(0,P.jsx)(xc,{open:a,onOpenChange:o,children:(0,P.jsxs)(wc,{children:[(0,P.jsxs)(Tc,{children:[(0,P.jsx)(Dc,{children:`Delete notification?`}),(0,P.jsx)(Oc,{children:`This action cannot be undone.`})]}),(0,P.jsxs)(Ec,{children:[(0,P.jsx)(Ac,{children:`Cancel`}),(0,P.jsx)(kc,{onClick:ne,className:Cr({variant:`destructive`}),children:`Delete`})]})]})})]})}var K=M.forwardRef(({className:e,type:t,...n},r)=>(0,P.jsx)(`input`,{type:t,className:N(`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm`,e),ref:r,...n}));K.displayName=`Input`;var q=ue,J=re,Y=M.forwardRef(({className:e,children:t,...n},r)=>(0,P.jsxs)(Bn,{ref:r,className:N(`flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1`,e),...n,children:[t,(0,P.jsx)(Gt,{asChild:!0,children:(0,P.jsx)(D,{className:`h-4 w-4 opacity-50`})})]}));Y.displayName=Bn.displayName;var Ic=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(we,{ref:n,className:N(`flex cursor-default items-center justify-center py-1`,e),...t,children:(0,P.jsx)(Ze,{className:`h-4 w-4`})}));Ic.displayName=we.displayName;var Lc=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(ge,{ref:n,className:N(`flex cursor-default items-center justify-center py-1`,e),...t,children:(0,P.jsx)(D,{className:`h-4 w-4`})}));Lc.displayName=ge.displayName;var X=M.forwardRef(({className:e,children:t,position:n=`popper`,...r},i)=>(0,P.jsx)(Fe,{children:(0,P.jsxs)(S,{ref:i,className:N(`relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,n===`popper`&&`data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1`,e),position:n,...r,children:[(0,P.jsx)(Ic,{}),(0,P.jsx)($e,{className:N(`p-1`,n===`popper`&&`h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]`),children:t}),(0,P.jsx)(Lc,{})]})}));X.displayName=S.displayName;var Rc=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Ae,{ref:n,className:N(`py-1.5 pl-8 pr-2 text-sm font-semibold`,e),...t}));Rc.displayName=Ae.displayName;var Z=M.forwardRef(({className:e,children:t,...n},r)=>(0,P.jsxs)(v,{ref:r,className:N(`relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...n,children:[(0,P.jsx)(`span`,{className:`absolute left-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,P.jsx)(Ht,{children:(0,P.jsx)(pn,{className:`h-4 w-4`})})}),(0,P.jsx)(De,{children:t})]}));Z.displayName=v.displayName;var zc=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Ve,{ref:n,className:N(`-mx-1 my-1 h-px bg-muted`,e),...t}));zc.displayName=Ve.displayName;var Bc=qe,Vc=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(jn,{ref:n,className:N(`inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground`,e),...t}));Vc.displayName=jn.displayName;var Hc=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(ce,{ref:n,className:N(`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm`,e),...t}));Hc.displayName=ce.displayName;var Uc=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(y,{ref:n,className:N(`mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2`,e),...t}));Uc.displayName=y.displayName;const Wc=t(`/design`)({component:Gc});function Gc(){return(0,P.jsxs)(`div`,{className:`space-y-10 p-6 pb-20`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`h1`,{className:`text-3xl font-bold tracking-tight`,children:`Design System`}),(0,P.jsx)(`p`,{className:`text-muted-foreground`,children:`A catalog of all reusable UI components available in the portal.`})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Buttons`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-4`,children:[(0,P.jsx)(F,{variant:`default`,children:`Default`}),(0,P.jsx)(F,{variant:`secondary`,children:`Secondary`}),(0,P.jsx)(F,{variant:`destructive`,children:`Destructive`}),(0,P.jsx)(F,{variant:`outline`,children:`Outline`}),(0,P.jsx)(F,{variant:`ghost`,children:`Ghost`}),(0,P.jsx)(F,{variant:`link`,children:`Link`}),(0,P.jsx)(F,{size:`sm`,children:`Small`}),(0,P.jsx)(F,{size:`lg`,children:`Large`}),(0,P.jsx)(F,{size:`icon`,children:(0,P.jsx)(ut,{className:`h-4 w-4`})}),(0,P.jsx)(F,{disabled:!0,children:`Disabled`}),(0,P.jsxs)(F,{variant:`outline`,className:`gap-2`,children:[(0,P.jsx)(En,{className:`h-4 w-4`}),` With Icon`]})]})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Badges`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-4`,children:[(0,P.jsx)(W,{children:`Default`}),(0,P.jsx)(W,{variant:`secondary`,children:`Secondary`}),(0,P.jsx)(W,{variant:`outline`,children:`Outline`}),(0,P.jsx)(W,{variant:`destructive`,children:`Destructive`})]})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Cards`}),(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2 lg:grid-cols-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Default Card`}),(0,P.jsx)(B,{children:`Standard container style`})]}),(0,P.jsx)(V,{children:`Content goes here`})]}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Glass Card`}),(0,P.jsx)(B,{children:`Backdrop blur effect`})]}),(0,P.jsx)(V,{children:`Popular for headers`})]}),(0,P.jsxs)(L,{variant:`flat`,children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Flat Card`}),(0,P.jsx)(B,{children:`No shadow, border only`})]}),(0,P.jsx)(V,{children:`Clean look`})]}),(0,P.jsxs)(L,{variant:`danger`,children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Danger Card`}),(0,P.jsx)(B,{children:`For error states`})]}),(0,P.jsx)(V,{className:`text-sm`,children:`Something went wrong`})]})]})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Bento Grid`}),(0,P.jsxs)(lc,{children:[(0,P.jsx)(dc,{title:`Total Revenue`,value:`$45,231.89`,icon:(0,P.jsx)(w,{className:`h-4 w-4`}),gradient:`blue`}),(0,P.jsx)(dc,{title:`Active Users`,value:`+2350`,icon:(0,P.jsx)(ve,{className:`h-4 w-4`}),gradient:`green`}),(0,P.jsx)(uc,{gradient:`purple`,className:`md:col-span-2`,children:(0,P.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,P.jsx)(`div`,{className:`p-2 bg-background/20 rounded-full`,children:(0,P.jsx)(He,{className:`h-6 w-6`})}),(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h3`,{className:`font-semibold text-lg`,children:`Cloud Infrastructure`}),(0,P.jsx)(`p`,{className:`text-sm text-muted-foreground/80`,children:`Manage your cloud resources and deployments from a single dashboard.`})]})]})})]})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Form Inputs`}),(0,P.jsx)(L,{children:(0,P.jsxs)(V,{className:`pt-6 space-y-4 max-w-md`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{htmlFor:`email`,children:`Email address`}),(0,P.jsx)(K,{type:`email`,id:`email`,placeholder:`name@example.com`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Framework`}),(0,P.jsxs)(q,{children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select framework`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`react`,children:`React`}),(0,P.jsx)(Z,{value:`vue`,children:`Vue`}),(0,P.jsx)(Z,{value:`svelte`,children:`Svelte`})]})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center space-x-2`,children:[(0,P.jsx)(Nc,{id:`airplane-mode`}),(0,P.jsx)(G,{htmlFor:`airplane-mode`,children:`Airplane Mode`})]})]})})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Tabs`}),(0,P.jsxs)(Bc,{defaultValue:`account`,className:`w-[400px]`,children:[(0,P.jsxs)(Vc,{children:[(0,P.jsx)(Hc,{value:`account`,children:`Account`}),(0,P.jsx)(Hc,{value:`password`,children:`Password`})]}),(0,P.jsx)(Uc,{value:`account`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Account`}),(0,P.jsx)(B,{children:`Make changes to your account here.`})]}),(0,P.jsx)(V,{className:`space-y-2`,children:(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{htmlFor:`name`,children:`Name`}),(0,P.jsx)(K,{id:`name`,defaultValue:`Pedro Duarte`})]})}),(0,P.jsx)(Ds,{children:(0,P.jsx)(F,{children:`Save changes`})})]})}),(0,P.jsx)(Uc,{value:`password`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Password`}),(0,P.jsx)(B,{children:`Change your password here.`})]}),(0,P.jsx)(V,{className:`space-y-2`,children:(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{htmlFor:`current`,children:`Current password`}),(0,P.jsx)(K,{id:`current`,type:`password`})]})}),(0,P.jsx)(Ds,{children:(0,P.jsx)(F,{children:`Save password`})})]})})]})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Feedback & Status`}),(0,P.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsx)(`h3`,{className:`text-sm font-medium text-muted-foreground`,children:`Empty State`}),(0,P.jsx)(`div`,{className:`border rounded-lg p-4`,children:(0,P.jsx)(ec,{icon:kn,title:`No items found`,description:`You haven't created any items yet.`,action:{label:`Create Item`,onClick:()=>j(`Clicked create`)},className:`min-h-[200px]`})})]}),(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsx)(`h3`,{className:`text-sm font-medium text-muted-foreground`,children:`Skeleton Loading`}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(U,{className:`h-5 w-[140px] mb-2`}),(0,P.jsx)(U,{className:`h-4 w-[250px]`})]}),(0,P.jsxs)(V,{className:`space-y-2`,children:[(0,P.jsx)(U,{className:`h-4 w-full`}),(0,P.jsx)(U,{className:`h-4 w-full`}),(0,P.jsx)(U,{className:`h-4 w-3/4`})]})]})]})]})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Toast Notifications`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-4`,children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>j(`Event has been created`),children:`Simple Toast`}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>j.success(`Event created successfully`),children:`Success`}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>j.error(`Failed to create event`),children:`Error`}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>j.info(`New updates available`,{description:`Refresh to see changes`}),children:`With Description`}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>j(`Event deleted`,{action:{label:`Undo`,onClick:()=>console.log(`Undo`)}}),children:`With Action`})]})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Breadcrumbs`}),(0,P.jsx)(`div`,{className:`p-4 border rounded-lg`,children:(0,P.jsx)(ys,{children:(0,P.jsxs)(bs,{children:[(0,P.jsx)(xs,{children:(0,P.jsx)(Ss,{href:`/status`,children:`Dashboard`})}),` `,(0,P.jsx)(ws,{}),(0,P.jsx)(xs,{children:(0,P.jsx)(Ss,{href:`/components`,children:`Components`})}),(0,P.jsx)(ws,{}),(0,P.jsx)(xs,{children:(0,P.jsx)(Cs,{children:`Breadcrumb`})})]})})})]})]})}const Kc=t(`/`)({component:qc});function qc(){let e=n(),t=i({queryKey:H.session(),queryFn:Br,retry:!1,staleTime:3e4});return(0,M.useEffect)(()=>{t.isLoading||(t.data?.authenticated?e({to:`/dashboard/deployments`,replace:!0}):e({to:`/status`,replace:!0}))},[t.data?.authenticated,t.isLoading,e]),null}const Jc=t(`/docs/`)({beforeLoad:()=>{throw h({to:`/dashboard/docs`})}}),Yc=t(`/dashboard/`)({component:Xc});function Xc(){let e=n();return(0,M.useEffect)(()=>{e({to:`/status`,replace:!0})},[e]),null}const Zc=t(`/admin/`)({component:Qc});function Qc(){let e=n();return(0,M.useEffect)(()=>{e({to:`/admin/settings`,replace:!0})},[e]),null}const $c=t(`/docs/$slug`)({beforeLoad:({params:e})=>{let t=String(e.slug??``);throw h({to:`/dashboard/docs/$slug`,params:{slug:t.endsWith(`.html`)?t.slice(0,-5):t}})}});var el=Ln,tl=M.createContext({}),nl=({...e})=>(0,P.jsx)(tl.Provider,{value:{name:e.name},children:(0,P.jsx)(On,{...e})}),rl=()=>{let e=M.useContext(tl),t=M.useContext(il),{getFieldState:n,formState:r}=We(),i=n(e.name,r);if(!e)throw Error(`useFormField should be used within <FormField>`);let{id:a}=t;return{id:a,name:e.name,formItemId:`${a}-form-item`,formDescriptionId:`${a}-form-item-description`,formMessageId:`${a}-form-item-message`,...i}},il=M.createContext({}),al=M.forwardRef(({className:e,...t},n)=>{let r=M.useId();return(0,P.jsx)(il.Provider,{value:{id:r},children:(0,P.jsx)(`div`,{ref:n,className:N(`space-y-2`,e),...t})})});al.displayName=`FormItem`;var ol=M.forwardRef(({className:e,...t},n)=>{let{error:r,formItemId:i}=rl();return(0,P.jsx)(G,{ref:n,className:N(r&&`text-destructive`,e),htmlFor:i,...t})});ol.displayName=`FormLabel`;var sl=M.forwardRef(({...e},t)=>{let{error:n,formItemId:r,formDescriptionId:i,formMessageId:a}=rl();return(0,P.jsx)(In,{ref:t,id:r,"aria-describedby":n?`${i} ${a}`:`${i}`,"aria-invalid":!!n,...e})});sl.displayName=`FormControl`;var cl=M.forwardRef(({className:e,...t},n)=>{let{formDescriptionId:r}=rl();return(0,P.jsx)(`p`,{ref:n,id:r,className:N(`text-sm text-muted-foreground`,e),...t})});cl.displayName=`FormDescription`;var ll=M.forwardRef(({className:e,children:t,...n},r)=>{let{error:i,formMessageId:a}=rl(),o=i?String(i?.message):t;return o?(0,P.jsx)(`p`,{ref:r,id:a,className:N(`text-sm font-medium text-destructive`,e),...n,children:o}):null});ll.displayName=`FormMessage`;var ul=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`textarea`,{className:N(`flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm`,e),ref:n,...t}));ul.displayName=`Textarea`;var dl=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`div`,{className:`relative w-full overflow-auto`,children:(0,P.jsx)(`table`,{ref:n,className:N(`w-full caption-bottom text-sm`,e),...t})}));dl.displayName=`Table`;var fl=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`thead`,{ref:n,className:N(`[&_tr]:border-b`,e),...t}));fl.displayName=`TableHeader`;var pl=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`tbody`,{ref:n,className:N(`[&_tr:last-child]:border-0`,e),...t}));pl.displayName=`TableBody`;var ml=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`tfoot`,{ref:n,className:N(`border-t bg-muted/50 font-medium [&>tr]:last:border-b-0`,e),...t}));ml.displayName=`TableFooter`;var hl=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`tr`,{ref:n,className:N(`border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted`,e),...t}));hl.displayName=`TableRow`;var Q=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`th`,{ref:n,className:N(`h-10 px-3 text-left align-middle text-xs font-medium uppercase tracking-wide text-muted-foreground [&:has([role=checkbox])]:pr-0`,e),...t}));Q.displayName=`TableHead`;var $=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`td`,{ref:n,className:N(`px-3 py-2 align-middle [&:has([role=checkbox])]:pr-0`,e),...t}));$.displayName=`TableCell`;var gl=M.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`caption`,{ref:n,className:N(`mt-4 text-sm text-muted-foreground`,e),...t}));gl.displayName=`TableCaption`;function _l({allowEdit:e}){let t=c(),[n,a]=(0,M.useState)(!1),[o,s]=(0,M.useState)(null),[l,u]=(0,M.useState)(null),d=i({queryKey:H.userVariableGroups(),queryFn:To,staleTime:3e4}),f=d.data?.groups??[],p=r({mutationFn:async e=>Oo(e),onSuccess:()=>{j.success(`Variable group deleted`),t.invalidateQueries({queryKey:H.userVariableGroups()}),u(null)},onError:e=>j.error(`Failed to delete group`,{description:e.message})});return(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(z,{children:`Variable Groups`}),(0,P.jsx)(B,{children:`Define reusable environment variables for your deployments.`})]}),(0,P.jsxs)(F,{size:`sm`,onClick:()=>a(!0),disabled:!e,children:[(0,P.jsx)(gn,{className:`mr-2 h-4 w-4`}),`New Group`]})]})}),(0,P.jsx)(V,{children:d.isLoading?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading groups`}):f.length===0?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground border border-dashed rounded-lg p-8 text-center`,children:`No variable groups defined.`}):(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Name`}),(0,P.jsx)(Q,{children:`Variables`}),(0,P.jsx)(Q,{className:`text-right`,children:`Actions`})]})}),(0,P.jsx)(pl,{children:f.map(t=>(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{className:`font-medium`,children:t.name}),(0,P.jsxs)($,{className:`text-muted-foreground text-xs`,children:[Object.keys(t.variables??{}).length,` variables`]}),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[(0,P.jsx)(F,{variant:`ghost`,size:`icon`,className:`h-8 w-8`,onClick:()=>s(t),disabled:!e,children:(0,P.jsx)(gt,{className:`h-4 w-4`})}),(0,P.jsx)(F,{variant:`ghost`,size:`icon`,className:`h-8 w-8 text-destructive hover:text-destructive`,onClick:()=>u(t),disabled:!e,children:(0,P.jsx)(tt,{className:`h-4 w-4`})})]})})]},t.id))})]})})}),(0,P.jsx)(vl,{open:n,onOpenChange:a,allowEdit:e,mode:`create`}),o&&(0,P.jsx)(vl,{open:!!o,onOpenChange:e=>!e&&s(null),allowEdit:e,mode:`edit`,initialData:o}),(0,P.jsx)(xc,{open:!!l,onOpenChange:e=>!e&&u(null),children:(0,P.jsxs)(wc,{children:[(0,P.jsxs)(Tc,{children:[(0,P.jsx)(Dc,{children:`Delete variable group?`}),(0,P.jsxs)(Oc,{children:[`This will permanently delete `,(0,P.jsx)(`strong`,{children:l?.name}),`.`]})]}),(0,P.jsxs)(Ec,{children:[(0,P.jsx)(Ac,{children:`Cancel`}),(0,P.jsx)(kc,{className:`bg-destructive text-destructive-foreground hover:bg-destructive/90`,onClick:()=>l&&p.mutate(l.id),children:p.isPending?`Deleting`:`Delete`})]})]})})]})}function vl({open:e,onOpenChange:t,allowEdit:n,mode:i,initialData:a}){let o=c(),[s,l]=(0,M.useState)(a?.name??``),[u,d]=(0,M.useState)(()=>a?.variables?Object.entries(a.variables).map(([e,t])=>({key:e,value:t})):[{key:``,value:``}]),f=r({mutationFn:async()=>{let e={};for(let t of u)t.key.trim()&&(e[t.key.trim()]=t.value);let t={name:s.trim(),variables:e};return i===`create`?Eo(t):Do(a?.id??0,t)},onSuccess:()=>{o.invalidateQueries({queryKey:H.userVariableGroups()}),j.success(i===`create`?`Variable group created`:`Saved`),t(!1)},onError:e=>j.error(`Failed to save group`,{description:e.message})}),p=(e,t)=>{d(n=>n.map((n,r)=>r===e?t:n))};return(0,P.jsx)(tr,{open:e,onOpenChange:t,children:(0,P.jsxs)(ir,{children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:i===`create`?`New variable group`:`Edit variable group`}),(0,P.jsx)(cr,{children:`Group common environment variables to reuse across deployments.`})]}),(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Name`}),(0,P.jsx)(K,{value:s,onChange:e=>l(e.target.value),placeholder:`Defaults`,disabled:!n})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(G,{children:`Variables`}),(0,P.jsx)(F,{type:`button`,variant:`outline`,size:`sm`,onClick:()=>d(e=>[...e,{key:``,value:``}]),disabled:!n,children:`Add variable`})]}),(0,P.jsx)(`div`,{className:`space-y-2 max-h-[320px] overflow-y-auto pr-2`,children:u.map((e,t)=>(0,P.jsxs)(`div`,{className:`grid grid-cols-12 gap-2`,children:[(0,P.jsx)(K,{value:e.key,onChange:n=>p(t,{key:n.target.value,value:e.value}),placeholder:`KEY`,className:`col-span-5 font-mono text-xs`,disabled:!n}),(0,P.jsx)(ul,{value:e.value,onChange:n=>p(t,{key:e.key,value:n.target.value}),placeholder:`Value`,rows:1,className:`col-span-7 text-xs`,disabled:!n})]},t))})]})]}),(0,P.jsxs)(or,{children:[(0,P.jsx)(F,{type:`button`,variant:`outline`,onClick:()=>t(!1),children:`Cancel`}),(0,P.jsx)(F,{type:`button`,onClick:()=>f.mutate(),disabled:!n||f.isPending,children:f.isPending?`Saving`:`Save`})]})]})})}const yl=[{label:"Device (`NETLAB_DEVICE`)",key:`NETLAB_DEVICE`},{label:"BGP AS (`NETLAB_BGP_AS`)",key:`NETLAB_BGP_AS`},{label:"P2P IPv4 pool (`NETLAB_ADDRESSING_P2P_IPV4`)",key:`NETLAB_ADDRESSING_P2P_IPV4`},{label:"P2P IPv6 mode (`NETLAB_ADDRESSING_P2P_IPV6`)",key:`NETLAB_ADDRESSING_P2P_IPV6`},{label:"Loopback IPv4 pool (`NETLAB_ADDRESSING_LOOPBACK_IPV4`)",key:`NETLAB_ADDRESSING_LOOPBACK_IPV4`},{label:"LAN IPv4 pool (`NETLAB_ADDRESSING_LAN_IPV4`)",key:`NETLAB_ADDRESSING_LAN_IPV4`},{label:"Netlab `--set` overrides (`SKYFORGE_NETLAB_SET_OVERRIDES`)",key:`SKYFORGE_NETLAB_SET_OVERRIDES`}],bl=[{label:`Arista EOS (eos)`,value:`eos`},{label:`Cisco IOL (iol)`,value:`iol`},{label:`Cisco IOSv (iosv)`,value:`iosv`},{label:`Cisco IOSvL2 (iosvl2)`,value:`iosvl2`},{label:`Cisco CSR1000v (csr)`,value:`csr`},{label:`Cisco ASA (asav)`,value:`asav`},{label:`Cisco NX-OSv9k (nxos)`,value:`nxos`},{label:`Juniper SRX`,value:`vsrx`},{label:`Juniper vMX (vmx)`,value:`vmx`},{label:`Juniper vJunos Router (vjunos-router)`,value:`vjunos-router`},{label:`Juniper vJunos Switch (vjunos-switch)`,value:`vjunos-switch`},{label:`Nokia SR OS (sros)`,value:`sros`},{label:`Linux (linux)`,value:`linux`}];function xl(e){return String(e??``).trim().toUpperCase()===`SKYFORGE_NETLAB_SET_OVERRIDES`}function Sl(e){switch(String(e??``).trim().toUpperCase()){case`NETLAB_DEVICE`:return bl;case`NETLAB_BGP_AS`:return[{label:`65000`,value:`65000`},{label:`65100`,value:`65100`},{label:`65200`,value:`65200`},{label:`65500`,value:`65500`}];case`NETLAB_ADDRESSING_P2P_IPV4`:return[{label:`198.18.0.0/16 (benchmark range)`,value:`198.18.0.0/16`},{label:`172.16.0.0/12`,value:`172.16.0.0/12`},{label:`100.64.0.0/10`,value:`100.64.0.0/10`}];case`NETLAB_ADDRESSING_P2P_IPV6`:return[{label:`false (disable / avoid LLA-only)`,value:`false`},{label:`true`,value:`true`}];case`NETLAB_ADDRESSING_LOOPBACK_IPV4`:return[{label:`10.0.0.0/24`,value:`10.0.0.0/24`},{label:`198.18.1.0/24`,value:`198.18.1.0/24`},{label:`172.16.0.0/24`,value:`172.16.0.0/24`}];case`NETLAB_ADDRESSING_LAN_IPV4`:return[{label:`172.18.0.0/16`,value:`172.18.0.0/16`},{label:`198.18.128.0/17`,value:`198.18.128.0/17`}];default:return null}}const Cl=t(`/dashboard/settings`)({component:Tl});var wl=Qn({defaultForwardCollectorConfigId:qn().optional(),defaultEnv:Kn(Qn({key:qn().min(1),value:qn()})).optional(),externalTemplateRepos:Kn(Qn({id:qn().optional(),name:qn().optional(),repo:qn().min(1),defaultBranch:qn().optional()})).optional()});function Tl(){let e=c(),t=i({queryKey:H.userForwardCollectorConfigs(),queryFn:Wa,staleTime:1e4}),n=i({queryKey:H.userSettings(),queryFn:vi,staleTime:1e4}),a=t.data?.collectors??[],o=(0,M.useMemo)(()=>n.data?.defaultForwardCollectorConfigId||(a.find(e=>e.name===`default`)?.id??a[0]?.id??``),[a,n.data?.defaultForwardCollectorConfigId]),s=Pn({resolver:pt(wl),values:{defaultForwardCollectorConfigId:o||void 0,defaultEnv:n.data?.defaultEnv??[],externalTemplateRepos:n.data?.externalTemplateRepos??[]}}),l=yt({control:s.control,name:`defaultEnv`}),u=yt({control:s.control,name:`externalTemplateRepos`}),d=r({mutationFn:async e=>{let t=(e.externalTemplateRepos??[]).map(e=>{let t=e.repo.trim(),n=t.split(`/`).filter(Boolean).at(-1)?.replace(/\.git$/,``)??`repo`;return{id:e.id??globalThis.crypto?.randomUUID?.()??n,name:e.name?.trim()||n,repo:t,defaultBranch:e.defaultBranch?.trim()||`main`}});return yi({defaultForwardCollectorConfigId:e.defaultForwardCollectorConfigId,defaultEnv:e.defaultEnv??[],externalTemplateRepos:t})},onSuccess:async()=>{await e.invalidateQueries({queryKey:H.userSettings()}),j.success(`Saved`)},onError:e=>{j.error(e instanceof Error?e.message:`Failed to save user settings`)}}),f=t.isLoading||n.isLoading||d.isPending,m=i({queryKey:H.userAwsStaticCredentials(),queryFn:Ti,staleTime:1e4,retry:!1}),h=i({queryKey:H.awsSsoConfig(),queryFn:bi,staleTime:1e4,retry:!1}),g=i({queryKey:H.awsSsoStatus(),queryFn:xi,staleTime:1e4,retry:!1}),ee=i({queryKey:H.userAzureCredentials(),queryFn:Oi,staleTime:1e4,retry:!1}),_=i({queryKey:H.userGcpCredentials(),queryFn:ji,staleTime:1e4,retry:!1}),v=i({queryKey:H.userIbmCredentials(),queryFn:Pi,staleTime:1e4,retry:!1}),te=i({queryKey:H.userNetlabServers(),queryFn:Li,staleTime:1e4,retry:!1}),ne=i({queryKey:H.userEveServers(),queryFn:Bi,staleTime:1e4,retry:!1}),re=i({queryKey:H.userContainerlabServers(),queryFn:Ui,staleTime:1e4,retry:!1}),ie=i({queryKey:H.userServiceNowConfig(),queryFn:Zr,staleTime:1e4,retry:!1}),ae=i({queryKey:H.userGeminiConfig(),queryFn:ii,staleTime:1e4,retry:!1}),[y,b]=(0,M.useState)(``),[x,S]=(0,M.useState)(``),[oe,se]=(0,M.useState)(``),[ce,le]=(0,M.useState)(``),[C,ue]=(0,M.useState)(``),[w,T]=(0,M.useState)(``),[de,fe]=(0,M.useState)(``),[E,pe]=(0,M.useState)(``),[me,he]=(0,M.useState)(``),[ge,_e]=(0,M.useState)(``),[ve,ye]=(0,M.useState)(``),[be,xe]=(0,M.useState)(``),[Se,D]=(0,M.useState)(!0),[Ce,we]=(0,M.useState)(``),[Te,Ee]=(0,M.useState)(``),[De,Oe]=(0,M.useState)(``),[ke,Ae]=(0,M.useState)(!0),[je,Me]=(0,M.useState)(``),[O,Ne]=(0,M.useState)(``),[Pe,Fe]=(0,M.useState)(``),[Ie,Le]=(0,M.useState)(``),[Re,ze]=(0,M.useState)(!0),[Ve,He]=(0,M.useState)(``),[Ue,We]=(0,M.useState)(``),Ge=e=>{try{return new URL(e).hostname||e}catch{return e}},Ke=r({mutationFn:async()=>Ei({accessKeyId:y.trim(),secretAccessKey:x}),onSuccess:async()=>{S(``),await e.invalidateQueries({queryKey:H.userAwsStaticCredentials()}),j.success(`AWS static credentials saved`)},onError:e=>j.error(`Failed to save AWS static credentials`,{description:e instanceof Error?e.message:String(e)})}),qe=r({mutationFn:async()=>Di(),onSuccess:async()=>{b(``),S(``),await e.invalidateQueries({queryKey:H.userAwsStaticCredentials()}),j.success(`AWS static credentials deleted`)},onError:e=>j.error(`Failed to delete AWS static credentials`,{description:e instanceof Error?e.message:String(e)})}),[Je,Ye]=(0,M.useState)(null),[Xe,Ze]=(0,M.useState)(``),Qe=r({mutationFn:Si,onSuccess:e=>{Ye(e),Ze(`pending`),window.open(e.verificationUriComplete,`_blank`,`noopener,noreferrer`)},onError:e=>j.error(`Failed to start AWS SSO`,{description:e instanceof Error?e.message:String(e)})}),$e=r({mutationFn:wi,onSuccess:async()=>{Ye(null),Ze(``),await e.invalidateQueries({queryKey:H.awsSsoStatus()}),j.success(`AWS SSO disconnected`)},onError:e=>j.error(`Failed to disconnect AWS SSO`,{description:e instanceof Error?e.message:String(e)})});(0,M.useEffect)(()=>{if(!Je||!Je.requestId)return;let t=!1,n=null,r=async()=>{try{let i=await Ci({requestId:Je.requestId});if(t)return;if(Ze(i.status),i.status===`ok`){Ye(null),await e.invalidateQueries({queryKey:H.awsSsoStatus()}),j.success(`AWS SSO connected`);return}if(i.status===`pending`){n=setTimeout(r,Math.max(1,Je.intervalSeconds)*1e3);return}Ye(null),j.error(`AWS SSO authorization did not complete`,{description:i.status})}catch(e){if(t)return;Ye(null),j.error(`AWS SSO polling failed`,{description:e instanceof Error?e.message:String(e)})}};return n=setTimeout(r,Math.max(1,Je.intervalSeconds)*1e3),()=>{t=!0,n&&clearTimeout(n)}},[Je,e]);let et=r({mutationFn:async()=>ki({tenantId:oe.trim(),clientId:ce.trim(),clientSecret:C,subscriptionId:w.trim()||void 0}),onSuccess:async()=>{ue(``),await e.invalidateQueries({queryKey:H.userAzureCredentials()}),j.success(`Azure credentials saved`)},onError:e=>j.error(`Failed to save Azure credentials`,{description:e instanceof Error?e.message:String(e)})}),nt=r({mutationFn:async()=>Ai(),onSuccess:async()=>{se(``),le(``),ue(``),T(``),await e.invalidateQueries({queryKey:H.userAzureCredentials()}),j.success(`Azure credentials deleted`)},onError:e=>j.error(`Failed to delete Azure credentials`,{description:e instanceof Error?e.message:String(e)})}),rt=r({mutationFn:async()=>Mi({projectId:de.trim(),serviceAccountJSON:E}),onSuccess:async()=>{pe(``),await e.invalidateQueries({queryKey:H.userGcpCredentials()}),j.success(`GCP credentials saved`)},onError:e=>j.error(`Failed to save GCP credentials`,{description:e instanceof Error?e.message:String(e)})}),it=r({mutationFn:async()=>Ni(),onSuccess:async()=>{fe(``),pe(``),await e.invalidateQueries({queryKey:H.userGcpCredentials()}),j.success(`GCP credentials deleted`)},onError:e=>j.error(`Failed to delete GCP credentials`,{description:e instanceof Error?e.message:String(e)})}),at=r({mutationFn:async()=>Fi({apiKey:me,region:ge.trim(),resourceGroupId:ve.trim()||void 0}),onSuccess:async()=>{he(``),await e.invalidateQueries({queryKey:H.userIbmCredentials()}),j.success(`IBM Cloud credentials saved`)},onError:e=>j.error(`Failed to save IBM Cloud credentials`,{description:e instanceof Error?e.message:String(e)})}),ot=r({mutationFn:async()=>Ii(),onSuccess:async()=>{he(``),_e(``),ye(``),await e.invalidateQueries({queryKey:H.userIbmCredentials()}),j.success(`IBM Cloud credentials deleted`)},onError:e=>j.error(`Failed to delete IBM Cloud credentials`,{description:e instanceof Error?e.message:String(e)})}),st=r({mutationFn:async()=>Ri({name:Ge(be).trim(),apiUrl:be.trim(),apiInsecure:Se,apiUser:Ce.trim()||void 0,apiPassword:Te.trim()||void 0}),onSuccess:async()=>{xe(``),D(!0),we(``),Ee(``),await e.invalidateQueries({queryKey:H.userNetlabServers()}),j.success(`Netlab server saved`)},onError:e=>j.error(`Failed to save Netlab server`,{description:e instanceof Error?e.message:String(e)})}),ct=r({mutationFn:async e=>zi(e),onSuccess:async()=>{await e.invalidateQueries({queryKey:H.userNetlabServers()}),j.success(`Netlab server deleted`)},onError:e=>j.error(`Failed to delete Netlab server`,{description:e instanceof Error?e.message:String(e)})}),lt=r({mutationFn:async()=>Wi({name:Ge(De).trim(),apiUrl:De.trim(),apiInsecure:ke,apiUser:je.trim()||void 0,apiPassword:O.trim()||void 0}),onSuccess:async()=>{Oe(``),Ae(!0),Me(``),Ne(``),await e.invalidateQueries({queryKey:H.userContainerlabServers()}),j.success(`Containerlab server saved`)},onError:e=>j.error(`Failed to save Containerlab server`,{description:e instanceof Error?e.message:String(e)})}),ut=r({mutationFn:async e=>Gi(e),onSuccess:async()=>{await e.invalidateQueries({queryKey:H.userContainerlabServers()}),j.success(`Containerlab server deleted`)},onError:e=>j.error(`Failed to delete Containerlab server`,{description:e instanceof Error?e.message:String(e)})}),dt=r({mutationFn:async()=>Vi({name:Ge(Pe).trim(),apiUrl:Pe.trim(),webUrl:Ie.trim()||void 0,skipTlsVerify:Re,apiUser:Ve.trim()||void 0,apiPassword:Ue.trim()||void 0}),onSuccess:async()=>{Fe(``),Le(``),ze(!0),He(``),We(``),await e.invalidateQueries({queryKey:H.userEveServers()}),j.success(`EVE-NG server saved`)},onError:e=>j.error(`Failed to save EVE-NG server`,{description:e instanceof Error?e.message:String(e)})}),ft=r({mutationFn:async e=>Hi(e),onSuccess:async()=>{await e.invalidateQueries({queryKey:H.userEveServers()}),j.success(`EVE-NG server deleted`)},onError:e=>j.error(`Failed to delete EVE-NG server`,{description:e instanceof Error?e.message:String(e)})});return(0,P.jsxs)(`div`,{className:`mx-auto w-full max-w-4xl space-y-6 p-6`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`My Settings`}),(0,P.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Defaults that pre-fill new deployments. These do not change existing deployments.`})]}),(0,P.jsx)(el,{...s,children:(0,P.jsxs)(`form`,{onSubmit:s.handleSubmit(e=>d.mutate(e)),className:`space-y-6`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Integrations`})}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Forward collector`}),(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:a.length?`${a.length} configured`:`None configured`})]}),(0,P.jsx)(F,{asChild:!0,variant:`outline`,children:(0,P.jsx)(p,{to:`/dashboard/forward`,children:`Open`})})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`ServiceNow`}),(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:ie.data?.configured?`Configured`:`Not configured`})]}),(0,P.jsx)(F,{asChild:!0,variant:`outline`,children:(0,P.jsx)(p,{to:`/dashboard/servicenow`,children:`Open`})})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Connect AI (Gemini)`}),(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:ae.data?.enabled?ae.data?.configured?`Connected`:`Not connected`:`Disabled`})]}),(0,P.jsx)(F,{asChild:!0,variant:`outline`,children:(0,P.jsx)(p,{to:`/dashboard/gemini`,children:`Open`})})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Defaults`})}),(0,P.jsxs)(V,{className:`space-y-6`,children:[(0,P.jsx)(nl,{control:s.control,name:`defaultForwardCollectorConfigId`,render:({field:e})=>(0,P.jsxs)(al,{children:[(0,P.jsx)(ol,{children:`Default Forward collector`}),(0,P.jsxs)(q,{value:e.value??``,onValueChange:t=>e.onChange(t),disabled:a.length===0,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:a.length?`Select collector`:`No collectors`})}),(0,P.jsx)(X,{children:a.slice().sort((e,t)=>e.name===`default`?-1:t.name===`default`?1:0).map(e=>(0,P.jsx)(Z,{value:e.id,children:e.name},e.id))})]}),(0,P.jsx)(ll,{})]})}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Default environment variables`}),(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Used for Netlab/Clabernetes generator env overrides.`})]}),(0,P.jsx)(F,{type:`button`,variant:`outline`,onClick:()=>l.append({key:`NETLAB_DEVICE`,value:``}),children:`Add variable`})]}),l.fields.length===0?(0,P.jsx)(`div`,{className:`rounded border p-4 text-sm text-muted-foreground`,children:`No default variables.`}):(0,P.jsx)(`div`,{className:`space-y-3`,children:l.fields.map((e,t)=>{let n=`defaultEnv.${t}.key`,r=`defaultEnv.${t}.value`,i=s.watch(n)||e.key,a=Sl(i),o=xl(i);return(0,P.jsxs)(`div`,{className:`flex gap-2`,children:[(0,P.jsx)(nl,{control:s.control,name:n,render:({field:e})=>(0,P.jsxs)(al,{className:`w-1/2`,children:[(0,P.jsx)(ol,{className:`sr-only`,children:`Key`}),(0,P.jsxs)(q,{value:e.value,onValueChange:t=>e.onChange(t),children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select key`})}),(0,P.jsx)(X,{children:yl.map(e=>(0,P.jsx)(Z,{value:e.key,children:e.label},e.key))})]}),(0,P.jsx)(ll,{})]})}),(0,P.jsx)(nl,{control:s.control,name:r,render:({field:e})=>(0,P.jsxs)(al,{className:`w-1/2`,children:[(0,P.jsx)(ol,{className:`sr-only`,children:`Value`}),a?(0,P.jsxs)(q,{value:e.value,onValueChange:t=>e.onChange(t),children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select value`})}),(0,P.jsx)(X,{children:a.map(e=>(0,P.jsx)(Z,{value:e.value,children:e.label},e.value))})]}):(0,P.jsx)(K,{...e,placeholder:o?`Enter value`:`Value`}),(0,P.jsx)(ll,{})]})}),(0,P.jsx)(F,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>l.remove(t),children:(0,P.jsx)(tt,{className:`h-4 w-4`})})]},e.id)})})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`External Template Repos`})}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-4`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`IDs referenced when selecting template source = External.`}),(0,P.jsx)(F,{type:`button`,variant:`outline`,onClick:()=>u.append({name:``,repo:``,defaultBranch:``}),children:`Add repo`})]}),u.fields.length===0?(0,P.jsx)(`div`,{className:`rounded border p-4 text-sm text-muted-foreground`,children:`No external repos configured.`}):(0,P.jsx)(`div`,{className:`space-y-3`,children:u.fields.map((e,t)=>{let n=`externalTemplateRepos.${t}.id`,r=`externalTemplateRepos.${t}.name`,i=`externalTemplateRepos.${t}.repo`,a=`externalTemplateRepos.${t}.defaultBranch`;return(0,P.jsxs)(`div`,{className:`grid gap-2 rounded border p-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`ID:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:s.watch(n)||e.id||`(new)`})]}),(0,P.jsx)(F,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>u.remove(t),children:(0,P.jsx)(tt,{className:`h-4 w-4`})})]}),(0,P.jsx)(nl,{control:s.control,name:n,render:({field:e})=>(0,P.jsxs)(al,{className:`hidden`,children:[(0,P.jsx)(ol,{className:`sr-only`,children:`ID`}),(0,P.jsx)(K,{...e})]})}),(0,P.jsx)(nl,{control:s.control,name:r,render:({field:e})=>(0,P.jsxs)(al,{children:[(0,P.jsx)(ol,{children:`Name (optional)`}),(0,P.jsx)(K,{...e,placeholder:`My repo`}),(0,P.jsx)(ll,{})]})}),(0,P.jsx)(nl,{control:s.control,name:i,render:({field:e})=>(0,P.jsxs)(al,{children:[(0,P.jsx)(ol,{children:`Repo`}),(0,P.jsx)(K,{...e,placeholder:`owner/repo or git URL`}),(0,P.jsx)(ll,{})]})}),(0,P.jsx)(nl,{control:s.control,name:a,render:({field:e})=>(0,P.jsxs)(al,{children:[(0,P.jsx)(ol,{children:`Default branch (optional)`}),(0,P.jsx)(K,{...e,placeholder:`main`}),(0,P.jsx)(ll,{})]})})]},e.id)})})]})]}),(0,P.jsx)(`div`,{className:`flex items-center justify-end gap-2`,children:(0,P.jsx)(F,{type:`submit`,disabled:f||!s.formState.isDirty,children:d.isPending?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Et,{className:`mr-2 h-4 w-4 animate-spin`}),`Saving`]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Be,{className:`mr-2 h-4 w-4`}),`Save`]})})})]})}),(0,P.jsx)(_l,{allowEdit:!0}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Cloud Credentials`})}),(0,P.jsxs)(V,{className:`space-y-8`,children:[(0,P.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`rounded border p-4 space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`AWS (static)`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:m.data?.configured?`Configured (${m.data?.accessKeyLast4??``})`:`Not configured`})]}),(0,P.jsx)(K,{placeholder:`Access key id`,value:y,onChange:e=>b(e.target.value)}),(0,P.jsx)(K,{placeholder:`Secret access key`,type:`password`,value:x,onChange:e=>S(e.target.value)}),(0,P.jsxs)(`div`,{className:`flex gap-2`,children:[(0,P.jsx)(F,{type:`button`,onClick:()=>Ke.mutate(),disabled:Ke.isPending,children:`Save`}),(0,P.jsx)(F,{type:`button`,variant:`outline`,onClick:()=>qe.mutate(),disabled:qe.isPending,children:`Delete`})]})]}),(0,P.jsxs)(`div`,{className:`rounded border p-4 space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`AWS (SSO)`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:h.data?.configured?g.data?.connected?`Connected`:`Not connected`:`Not configured`})]}),g.data?.lastAuthenticatedAt?(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Last authenticated:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:g.data.lastAuthenticatedAt})]}):null,g.data?.expiresAt?(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Expires:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:g.data.expiresAt})]}):null,Je?(0,P.jsxs)(`div`,{className:`rounded border bg-muted/30 p-3 text-xs space-y-1`,children:[(0,P.jsx)(`div`,{className:`font-medium`,children:`Complete sign-in`}),(0,P.jsxs)(`div`,{children:[`Code:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:Je.userCode})]}),(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[`Open:`,` `,(0,P.jsx)(`span`,{className:`font-mono break-all`,children:Je.verificationUriComplete})]}),Xe?(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[`Status: `,Xe]}):null]}):null,(0,P.jsxs)(`div`,{className:`flex gap-2`,children:[(0,P.jsx)(F,{type:`button`,onClick:()=>Qe.mutate(),disabled:!h.data?.configured||Qe.isPending||!!Je,children:`Connect`}),(0,P.jsx)(F,{type:`button`,variant:`outline`,onClick:()=>$e.mutate(),disabled:!g.data?.connected||$e.isPending,children:`Disconnect`})]})]})]}),(0,P.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`rounded border p-4 space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Azure`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:ee.data?.configured?`Configured`:`Not configured`})]}),(0,P.jsx)(K,{placeholder:`Tenant ID`,value:oe,onChange:e=>se(e.target.value)}),(0,P.jsx)(K,{placeholder:`Client ID`,value:ce,onChange:e=>le(e.target.value)}),(0,P.jsx)(K,{placeholder:`Client secret`,type:`password`,value:C,onChange:e=>ue(e.target.value)}),(0,P.jsx)(K,{placeholder:`Subscription ID (optional)`,value:w,onChange:e=>T(e.target.value)}),(0,P.jsxs)(`div`,{className:`flex gap-2`,children:[(0,P.jsx)(F,{type:`button`,onClick:()=>et.mutate(),disabled:et.isPending,children:`Save`}),(0,P.jsx)(F,{type:`button`,variant:`outline`,onClick:()=>nt.mutate(),disabled:nt.isPending,children:`Delete`})]})]}),(0,P.jsxs)(`div`,{className:`rounded border p-4 space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`GCP`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:_.data?.configured?`Configured`:`Not configured`})]}),(0,P.jsx)(K,{placeholder:`Project ID`,value:de,onChange:e=>fe(e.target.value)}),(0,P.jsx)(ul,{placeholder:`Service account JSON`,className:`min-h-[140px] font-mono text-xs`,value:E,onChange:e=>pe(e.target.value)}),(0,P.jsxs)(`div`,{className:`flex gap-2`,children:[(0,P.jsx)(F,{type:`button`,onClick:()=>rt.mutate(),disabled:rt.isPending,children:`Save`}),(0,P.jsx)(F,{type:`button`,variant:`outline`,onClick:()=>it.mutate(),disabled:it.isPending,children:`Delete`})]})]}),(0,P.jsxs)(`div`,{className:`rounded border p-4 space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`IBM Cloud`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:v.data?.configured?`Configured`:`Not configured`})]}),(0,P.jsx)(K,{placeholder:`Region`,value:ge,onChange:e=>_e(e.target.value)}),(0,P.jsx)(K,{placeholder:`API key`,type:`password`,value:me,onChange:e=>he(e.target.value)}),(0,P.jsx)(K,{placeholder:`Resource group ID (optional)`,value:ve,onChange:e=>ye(e.target.value)}),(0,P.jsxs)(`div`,{className:`flex gap-2`,children:[(0,P.jsx)(F,{type:`button`,onClick:()=>at.mutate(),disabled:at.isPending,children:`Save`}),(0,P.jsx)(F,{type:`button`,variant:`outline`,onClick:()=>ot.mutate(),disabled:ot.isPending,children:`Delete`})]})]})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`BYOL Servers`})}),(0,P.jsxs)(V,{className:`space-y-8`,children:[(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Netlab`}),(0,P.jsxs)(`div`,{className:`grid gap-2 md:grid-cols-2`,children:[(0,P.jsx)(K,{placeholder:`https://netlab.example.com`,value:be,onChange:e=>xe(e.target.value)}),(0,P.jsx)(K,{placeholder:`API username (optional)`,value:Ce,onChange:e=>we(e.target.value)}),(0,P.jsx)(K,{placeholder:`API password (optional)`,type:`password`,value:Te,onChange:e=>Ee(e.target.value)}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:Se,onChange:e=>D(e.target.checked)}),(0,P.jsx)(`div`,{className:`text-sm`,children:`Skip TLS verify`})]})]}),(0,P.jsx)(F,{type:`button`,variant:`outline`,onClick:()=>st.mutate(),disabled:!be.trim()||st.isPending,children:`Add/Update`}),(0,P.jsx)(`div`,{className:`space-y-2`,children:(te.data?.servers??[]).map(e=>(0,P.jsxs)(`div`,{className:`flex items-center justify-between rounded border px-3 py-2`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(`div`,{className:`truncate text-sm font-medium`,children:e.name}),(0,P.jsx)(`div`,{className:`truncate text-xs text-muted-foreground font-mono`,children:e.apiUrl})]}),(0,P.jsx)(F,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>e.id&&ct.mutate(e.id),children:(0,P.jsx)(tt,{className:`h-4 w-4`})})]},e.id))})]}),(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Containerlab`}),(0,P.jsxs)(`div`,{className:`grid gap-2 md:grid-cols-2`,children:[(0,P.jsx)(K,{placeholder:`https://clab.example.com`,value:De,onChange:e=>Oe(e.target.value)}),(0,P.jsx)(K,{placeholder:`API username (optional)`,value:je,onChange:e=>Me(e.target.value)}),(0,P.jsx)(K,{placeholder:`API password (optional)`,type:`password`,value:O,onChange:e=>Ne(e.target.value)}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:ke,onChange:e=>Ae(e.target.checked)}),(0,P.jsx)(`div`,{className:`text-sm`,children:`Skip TLS verify`})]})]}),(0,P.jsx)(F,{type:`button`,variant:`outline`,onClick:()=>lt.mutate(),disabled:!De.trim()||lt.isPending,children:`Add/Update`}),(0,P.jsx)(`div`,{className:`space-y-2`,children:(re.data?.servers??[]).map(e=>(0,P.jsxs)(`div`,{className:`flex items-center justify-between rounded border px-3 py-2`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(`div`,{className:`truncate text-sm font-medium`,children:e.name}),(0,P.jsx)(`div`,{className:`truncate text-xs text-muted-foreground font-mono`,children:e.apiUrl})]}),(0,P.jsx)(F,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>e.id&&ut.mutate(e.id),children:(0,P.jsx)(tt,{className:`h-4 w-4`})})]},e.id))})]}),(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`EVE-NG`}),(0,P.jsxs)(`div`,{className:`grid gap-2 md:grid-cols-2`,children:[(0,P.jsx)(K,{placeholder:`https://eve.example.com/api`,value:Pe,onChange:e=>Fe(e.target.value)}),(0,P.jsx)(K,{placeholder:`Web URL (optional)`,value:Ie,onChange:e=>Le(e.target.value)}),(0,P.jsx)(K,{placeholder:`API username (optional)`,value:Ve,onChange:e=>He(e.target.value)}),(0,P.jsx)(K,{placeholder:`API password (optional)`,type:`password`,value:Ue,onChange:e=>We(e.target.value)}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:Re,onChange:e=>ze(e.target.checked)}),(0,P.jsx)(`div`,{className:`text-sm`,children:`Skip TLS verify`})]})]}),(0,P.jsx)(F,{type:`button`,variant:`outline`,onClick:()=>dt.mutate(),disabled:!Pe.trim()||dt.isPending,children:`Add/Update`}),(0,P.jsx)(`div`,{className:`space-y-2`,children:(ne.data?.servers??[]).map(e=>(0,P.jsxs)(`div`,{className:`flex items-center justify-between rounded border px-3 py-2`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(`div`,{className:`truncate text-sm font-medium`,children:e.name}),(0,P.jsx)(`div`,{className:`truncate text-xs text-muted-foreground font-mono`,children:e.apiUrl})]}),(0,P.jsx)(F,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>e.id&&ft.mutate(e.id),children:(0,P.jsx)(tt,{className:`h-4 w-4`})})]},e.id))})]})]})]})]})}const El=t(`/dashboard/servicenow`)({component:Dl});function Dl(){let e=c(),t=H.userServiceNowConfig(),n=H.userServiceNowPdiStatus(),a=H.userServiceNowSchemaStatus(),o=H.userForwardCollectorConfigs(),s=i({queryKey:t,queryFn:Zr,retry:!1}).data,[l,u]=(0,M.useState)(``),[d,f]=(0,M.useState)(``),[p,m]=(0,M.useState)(``),[h,g]=(0,M.useState)(``),[ee,_]=(0,M.useState)(`collector`),[v,te]=(0,M.useState)(``),[ne,re]=(0,M.useState)(``),[ie,ae]=(0,M.useState)(!0);(0,M.useEffect)(()=>{s&&(u(s.instanceUrl??``),f(s.adminUsername??``),g(s.forwardCollectorConfigId??``),_(s.forwardCollectorConfigId?`collector`:s.forwardUsername?`custom`:`collector`),te(s.forwardUsername??``))},[s]);let y=i({queryKey:o,queryFn:Wa,retry:!1,staleTime:3e4}),b=(0,M.useMemo)(()=>y.data?.collectors??[],[y.data]);(0,M.useEffect)(()=>{if(ee!==`collector`||h)return;let e=b.find(e=>e.isDefault)??b[0];e?.id&&g(e.id)},[s,b,h,ee]);let x=i({queryKey:n,queryFn:ei,enabled:!!s?.configured,retry:!1,refetchOnWindowFocus:!0,staleTime:0,refetchInterval:e=>{if(document.visibilityState===`hidden`)return!1;let t=e.state.data?.status??``;return t===`awake`?12e4:t===`sleeping`||t===`waking`||t===`unreachable`?3e4:6e4}}),S=i({queryKey:a,queryFn:ti,enabled:!!s?.configured,retry:!1,refetchOnWindowFocus:!0,staleTime:0}),oe=(0,M.useMemo)(()=>(S.data?.missing??[]).some(e=>e.startsWith(`table:`)),[S.data?.missing]),se=(0,M.useMemo)(()=>{let e=(l||s?.instanceUrl||``).trim().replace(/\/+$/,``);return e?`${e}/sp?id=connectivity_ticket`:``},[s?.instanceUrl,l]),ce=r({mutationFn:async()=>ni(),onSuccess:async()=>{j.success(`Wake requested`),await e.invalidateQueries({queryKey:n})},onError:e=>j.error(`Failed to wake PDI`,{description:e.message})}),le=r({mutationFn:async()=>{if(!l.trim())throw Error(`ServiceNow instance URL is required`);if(!d.trim())throw Error(`ServiceNow admin username is required`);let e=ee===`collector`;if(e){if(!h.trim())throw Error(`Select a Forward collector (or choose Custom)`)}else if(!v.trim())throw Error(`Forward username is required`);return Qr({instanceUrl:l.trim(),adminUsername:d.trim(),adminPassword:p,forwardCollectorConfigId:e?h.trim():``,forwardUsername:e?``:v.trim(),forwardPassword:e?``:ne})},onSuccess:async()=>{j.success(`Saved ServiceNow settings`),m(``),re(``),await e.invalidateQueries({queryKey:t}),await e.invalidateQueries({queryKey:n}),await e.invalidateQueries({queryKey:a}),ie&&ue.mutate()},onError:e=>j.error(`Failed to save ServiceNow settings`,{description:e.message})}),C=r({mutationFn:async()=>$r(),onSuccess:async r=>{r.installed?j.success(`ServiceNow demo installed`):j.error(`ServiceNow install failed`,{description:r.message}),await e.invalidateQueries({queryKey:t}),await e.invalidateQueries({queryKey:n}),await e.invalidateQueries({queryKey:a})},onError:e=>j.error(`Failed to install ServiceNow demo`,{description:e.message})}),ue=r({mutationFn:async()=>ri(),onSuccess:async e=>{e.configured?j.success(`Configured Forward ticketing integration`):j.error(`Failed to configure Forward`,{description:e.message})},onError:e=>j.error(`Failed to configure Forward`,{description:e.message})});return(0,P.jsxs)(`div`,{className:`p-6 space-y-6`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold`,children:`ServiceNow`}),(0,P.jsx)(`p`,{className:`text-sm text-muted-foreground mt-1`,children:`Install the Forward Connectivity Ticket demo into a ServiceNow PDI. ServiceNow calls Forward SaaS directly; Skyforge only installs and configures the app.`})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Quick links`}),(0,P.jsx)(B,{children:`Create a ServiceNow PDI (manual step).`})]}),(0,P.jsxs)(V,{className:`space-y-2`,children:[(0,P.jsx)(`a`,{className:`text-sm underline`,href:`https://developer.servicenow.com/dev.do#!/guides/now-platform/pdi-guide/obtaining-a-pdi`,target:`_blank`,rel:`noreferrer`,children:`Create a Personal Developer Instance (PDI)`}),(0,P.jsx)(`a`,{className:`text-sm underline`,href:`/dashboard/docs/servicenow`,target:`_blank`,rel:`noreferrer`,children:`Open Skyforge ServiceNow docs`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Create and wake your PDI in the ServiceNow portal; then paste the instance URL and admin creds below.`}),se?(0,P.jsx)(`a`,{className:`text-sm underline`,href:se,target:`_blank`,rel:`noreferrer`,children:`Open the demo portal page (after install)`}):null,s?.configured&&(l||s?.instanceUrl)?(0,P.jsx)(`a`,{className:`text-sm underline`,href:`${(l||s?.instanceUrl||``).replace(/\/+$/,``)}/sys_app_application_list.do?sysparm_query=title=Forward%20Connectivity%20Ticket`,target:`_blank`,rel:`noreferrer`,children:`Find the demo app menu in ServiceNow (after install)`}):null]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`PDI status`}),(0,P.jsx)(B,{children:`ServiceNow PDIs can sleep after inactivity. Skyforge can detect this and attempt to wake the instance.`})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsx)(`div`,{className:`text-sm`,children:s?.configured?(0,P.jsxs)(P.Fragment,{children:[`Status:`,` `,(0,P.jsx)(`span`,{className:`font-medium`,children:x.data?.status??(x.isFetching?`checking`:`unknown`)}),x.data?.httpStatus?` (HTTP ${x.data.httpStatus})`:``,x.data?.detail?`  ${x.data.detail}`:``]}):(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:`Save configuration first.`})}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{variant:`secondary`,onClick:()=>void x.refetch(),disabled:!s?.configured||x.isFetching||ce.isPending,children:`Check now`}),(0,P.jsx)(F,{variant:`secondary`,onClick:()=>ce.mutate(),disabled:!s?.configured||ce.isPending,children:`Wake up`})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Schema status`}),(0,P.jsx)(B,{children:`The demo requires two custom tables. Create the tables once in the PDI; Skyforge can auto-create the required fields and choice lists when you install the demo app.`})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsx)(`div`,{className:`text-sm`,children:s?.configured?(0,P.jsxs)(P.Fragment,{children:[`Status:`,` `,(0,P.jsx)(`span`,{className:`font-medium`,children:S.data?.status??(S.isFetching?`checking`:`unknown`)}),S.data?.checkedAt?` (checked ${S.data.checkedAt})`:``,S.data?.detail?`  ${S.data.detail}`:``]}):(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:`Save configuration first.`})}),s?.configured&&l?(0,P.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Portal page:`,` `,(0,P.jsx)(`a`,{className:`underline`,href:`${l.replace(/\/+$/,``)}/sp?id=connectivity_ticket`,target:`_blank`,rel:`noreferrer`,children:`/sp?id=connectivity_ticket`})]}):null,s?.configured&&l?(0,P.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Find records:`,` `,(0,P.jsx)(`a`,{className:`underline`,href:`${l.replace(/\/+$/,``)}/sp_widget_list.do?sysparm_query=name=Connectivity%20Ticket%20Analyzer`,target:`_blank`,rel:`noreferrer`,children:`widget`}),`  `,(0,P.jsx)(`a`,{className:`underline`,href:`${l.replace(/\/+$/,``)}/sp_page_list.do?sysparm_query=id=connectivity_ticket`,target:`_blank`,rel:`noreferrer`,children:`page`}),`  `,(0,P.jsx)(`a`,{className:`underline`,href:`${l.replace(/\/+$/,``)}/sys_rest_message_list.do?sysparm_query=name=Forward%20API`,target:`_blank`,rel:`noreferrer`,children:`REST message`})]}):null,S.data?.status===`missing`&&S.data.missing?.length?(0,P.jsxs)(`div`,{className:`rounded-md border p-3 bg-muted/30`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground mb-2`,children:`Missing items:`}),oe?(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground mb-2`,children:[`Create the missing `,(0,P.jsx)(`span`,{className:`font-medium`,children:`tables`}),` `,`in ServiceNow first; then click`,` `,(0,P.jsx)(`span`,{className:`font-medium`,children:`Install demo app`}),` to let Skyforge auto-create the rest.`]}):(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground mb-2`,children:[`Click `,(0,P.jsx)(`span`,{className:`font-medium`,children:`Install demo app`}),` to let Skyforge auto-create these fields/choices.`]}),(0,P.jsx)(`ul`,{className:`text-xs font-mono space-y-1`,children:S.data.missing.map(e=>(0,P.jsxs)(`li`,{children:[`- `,e]},e))})]}):null,(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{variant:`secondary`,onClick:()=>void S.refetch(),disabled:!s?.configured||S.isFetching,children:`Check schema`}),(0,P.jsx)(`a`,{className:`text-sm underline text-muted-foreground`,href:`/dashboard/docs/servicenow`,target:`_blank`,rel:`noreferrer`,children:`Docs`})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Configuration`}),(0,P.jsx)(B,{children:`Skyforge uses ServiceNow admin creds to install/configure. Forward creds are stored in ServiceNow as a Basic Auth credential for the demo REST Message.`})]}),(0,P.jsxs)(V,{className:`space-y-6`,children:[(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`ServiceNow instance URL`}),(0,P.jsx)(K,{value:l,onChange:e=>u(e.target.value),placeholder:`https://dev12345.service-now.com`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`ServiceNow admin username`}),(0,P.jsx)(K,{value:d,onChange:e=>f(e.target.value),placeholder:`admin`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`ServiceNow admin password`}),(0,P.jsx)(K,{type:`password`,value:p,onChange:e=>m(e.target.value),placeholder:s?.hasAdminPassword?`(leave blank to keep stored)`:``})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Forward credentials`}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Uses Forward SaaS (`,(0,P.jsx)(`code`,{children:`https://fwd.app`}),`).`]}),(0,P.jsxs)(q,{value:ee===`custom`?`custom`:h||``,onValueChange:e=>{if(e===`custom`){_(`custom`),g(``);return}_(`collector`),g(e)},children:[(0,P.jsx)(Y,{className:`w-full`,children:(0,P.jsx)(J,{placeholder:`Select a collector`})}),(0,P.jsxs)(X,{children:[b.map(e=>(0,P.jsxs)(Z,{value:e.id,children:[e.name,e.isDefault?` (default)`:``]},e.id)),(0,P.jsx)(Z,{value:`custom`,children:`Custom`})]})]})]}),ee===`custom`?(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Forward username`}),(0,P.jsx)(K,{value:v,onChange:e=>te(e.target.value),placeholder:`you@example.com`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Forward password`}),(0,P.jsx)(K,{type:`password`,value:ne,onChange:e=>re(e.target.value),placeholder:s?.hasForwardPassword?`(leave blank to keep stored)`:``})]})]}):null,(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Forward integration`}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(jc,{id:`snow-configure-ticketing-on-save`,checked:ie,onCheckedChange:e=>ae(!!e)}),(0,P.jsx)(G,{htmlFor:`snow-configure-ticketing-on-save`,className:`font-normal text-sm`,children:`Configure Forward ticketing integration on save`})]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Configures Forward SaaS to auto-create and auto-update incidents in this ServiceNow instance.`})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{onClick:()=>le.mutate(),disabled:le.isPending||C.isPending,children:`Save`}),(0,P.jsx)(F,{variant:`secondary`,onClick:()=>C.mutate(),disabled:C.isPending||le.isPending||!s?.configured||oe,children:`Install demo app`}),se?(0,P.jsx)(F,{variant:`outline`,asChild:!0,disabled:!s?.configured||oe,children:(0,P.jsx)(`a`,{href:se,target:`_blank`,rel:`noreferrer`,children:`Open in ServiceNow`})}):null,(0,P.jsx)(F,{variant:`secondary`,onClick:()=>ue.mutate(),disabled:ue.isPending||le.isPending||!s?.configured,children:`Configure Forward (ticketing)`}),(0,P.jsx)(`a`,{className:`text-sm underline text-muted-foreground ml-2`,href:`/dashboard/docs/servicenow`,target:`_blank`,rel:`noreferrer`,children:`Docs`}),s?.lastInstallStatus?(0,P.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Status: `,s.lastInstallStatus,s.lastInstallError?` (${s.lastInstallError})`:``]}):null]})]})]})]})}const Ol=t(`/dashboard/s3`)({component:kl});function kl(){let e=i({queryKey:H.workspaces(),queryFn:Hr,staleTime:3e4}),t=e.data?.workspaces??[],[n,r]=(0,M.useState)(``),[a,o]=(0,M.useState)(``);(0,M.useEffect)(()=>{if(t.length===0)return;let e=window.localStorage.getItem(`skyforge.lastWorkspaceId.s3`)??``,n=t.some(t=>t.id===e)?e:t[0]?.id??``;r(e=>e||n)},[t]);let s=i({queryKey:H.workspaceArtifacts(n),queryFn:async()=>Ya(n,{prefix:a||void 0}),staleTime:1e4,enabled:!!n}),c=s.data?.items??[],l=(0,M.useMemo)(()=>[{id:`object`,header:`Object`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.key})},{id:`actions`,header:`Actions`,width:300,align:`right`,cell:e=>(0,P.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[e.key.toLowerCase().endsWith(`.json`)&&(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:async()=>{try{let t=await Xa(n,e.key),r=atob(t.fileData),i=new Uint8Array(r.length);for(let e=0;e<r.length;e++)i[e]=r.charCodeAt(e);let a=new TextDecoder().decode(i),o=JSON.stringify(JSON.parse(a),null,2),s=new Blob([o],{type:`application/json`}),c=URL.createObjectURL(s);window.open(c,`_blank`,`noopener,noreferrer`),window.setTimeout(()=>URL.revokeObjectURL(c),1e4)}catch(e){j.error(`View failed`,{description:e.message})}},disabled:!n,children:[(0,P.jsx)(Kt,{className:`mr-2 h-3 w-3`}),`View`]}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:async()=>{try{let t=await Xa(n,e.key),r=atob(t.fileData),i=new Uint8Array(r.length);for(let e=0;e<r.length;e++)i[e]=r.charCodeAt(e);let a=new Blob([i]),o=URL.createObjectURL(a),s=document.createElement(`a`);s.href=o,s.download=e.key.split(`/`).pop()||`artifact`,document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(o)}catch(e){j.error(`Download failed`,{description:e.message})}},disabled:!n,children:[(0,P.jsx)(Oe,{className:`mr-2 h-3 w-3`}),`Download`]}),(0,P.jsxs)(F,{variant:`destructive`,size:`sm`,onClick:async()=>{if(confirm(`Delete ${e.key}?`))try{await Qa(n,e.key),j.success(`Deleted`,{description:e.key}),await s.refetch()}catch(e){j.error(`Delete failed`,{description:e.message})}},disabled:!n,children:[(0,P.jsx)(tt,{className:`mr-2 h-3 w-3`}),`Delete`]})]})}],[s.refetch,n]),u=(0,P.jsxs)(`div`,{className:`p-4 border-b flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Workspace`}),(0,P.jsxs)(q,{value:n,onValueChange:e=>{r(e),window.localStorage.setItem(`skyforge.lastWorkspaceId.s3`,e)},disabled:t.length===0,children:[(0,P.jsx)(Y,{className:`w-[280px]`,children:(0,P.jsx)(J,{placeholder:`Select workspace`})}),(0,P.jsx)(X,{children:t.map(e=>(0,P.jsxs)(Z,{value:e.id,children:[e.name,` (`,e.slug,`)`]},e.id))})]})]}),(0,P.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center`,children:[(0,P.jsx)(K,{placeholder:`Prefix (e.g. topology/)`,value:a,onChange:e=>o(e.target.value),className:`w-[260px]`}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>s.refetch(),disabled:!n,children:`Refresh`}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:async()=>{if(!n)return;let e=window.prompt(`Folder prefix (e.g. uploads/)`);if(e)try{await $a(n,e),j.success(`Folder created`),await s.refetch()}catch(e){j.error(`Create folder failed`,{description:e.message})}},disabled:!n,children:[(0,P.jsx)(b,{className:`mr-2 h-3 w-3`}),`Folder`]}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>{if(!n)return;let e=document.createElement(`input`);e.type=`file`,e.onchange=()=>{let t=e.files?.[0];t&&(async()=>{try{let e=new Uint8Array(await t.arrayBuffer()),r=``,i=32*1024;for(let t=0;t<e.length;t+=i){let n=e.subarray(t,t+i);r+=btoa(String.fromCharCode(...n))}let o=(a||``)+t.name;await Za(n,{key:o,contentBase64:r,contentType:t.type||`application/octet-stream`}),j.success(`Uploaded`,{description:o}),await s.refetch()}catch(e){j.error(`Upload failed`,{description:e.message})}})()},e.click()},disabled:!n,children:[(0,P.jsx)(Ue,{className:`mr-2 h-3 w-3`}),`Upload`]})]})]});return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`S3`}),(0,P.jsx)(B,{children:`Workspace artifacts and generated files (backed by the platform object store).`})]})}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-0`,children:e.isLoading||s.isLoading?(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(U,{className:`h-12 w-full`}),(0,P.jsx)(U,{className:`h-12 w-full`}),(0,P.jsx)(U,{className:`h-12 w-full`})]}):(0,P.jsxs)(`div`,{children:[u,e.isError||s.isError?(0,P.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to list objects.`}):c.length===0?(0,P.jsx)(`div`,{className:`p-6`,children:(0,P.jsx)(ec,{icon:kn,title:`No objects found`,description:`No artifacts found for this workspace.`})}):(0,P.jsx)($s,{columns:l,rows:c,getRowId:e=>e.key,maxHeightClassName:`max-h-[60vh]`,minWidthClassName:`min-w-[900px]`})]})})})]})}const Al=t(`/dashboard/policy-reports`)({component:jl});function jl(){let e=i({queryKey:H.workspaces(),queryFn:Hr,staleTime:3e4}).data?.workspaces??[];return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsxs)(`div`,{className:`space-y-1 border-b pb-6`,children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Policy Reports`}),(0,P.jsx)(`p`,{className:`text-muted-foreground text-sm`,children:`Run security and compliance checks against a Forward snapshot, per workspace.`})]}),e.length===0?(0,P.jsx)(ec,{title:`No workspaces`,description:`Create a workspace first, then run policy reports inside it.`,icon:mn}):(0,P.jsx)(`div`,{className:`grid gap-4 md:grid-cols-2 lg:grid-cols-3`,children:e.map(e=>(0,P.jsxs)(L,{className:`hover:border-foreground/20 transition-colors`,children:[(0,P.jsx)(R,{className:`pb-3`,children:(0,P.jsxs)(z,{className:`flex items-center justify-between gap-2 text-base`,children:[(0,P.jsx)(`span`,{className:`truncate`,children:e.name}),(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.slug})]})}),(0,P.jsx)(V,{className:`pt-0`,children:(0,P.jsx)(p,{to:`/dashboard/workspaces/$workspaceId/policy-reports`,params:{workspaceId:e.id},className:`text-sm text-primary underline hover:no-underline`,children:`Open policy reports`})})]},e.id))})]})}const Ml=t(`/dashboard/integrations`)({component:Nl});function Nl(){let e=i({queryKey:H.userGeminiConfig(),queryFn:ii,retry:!1,staleTime:1e4}),t=i({queryKey:H.userServiceNowConfig(),queryFn:Zr,retry:!1,staleTime:1e4}),n=i({queryKey:H.userForwardCollectorConfigs(),queryFn:Wa,retry:!1,staleTime:1e4}),r=i({queryKey:H.userElasticConfig(),queryFn:oi,retry:!1,staleTime:1e4}),a=n.data?.collectors?.length??0,o=a>0;return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold`,children:`Integrations`}),(0,P.jsx)(`p`,{className:`mt-1 text-sm text-muted-foreground`,children:`Connect optional tools and accounts that enhance Skyforge workflows.`})]}),(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsx)(R,{children:(0,P.jsxs)(z,{className:`flex items-center gap-2`,children:[(0,P.jsx)(ke,{className:`h-5 w-5`}),`Forward collector`]})}),(0,P.jsxs)(V,{className:`space-y-3 text-sm`,children:[(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:n.isLoading?`Loading`:o?`${a} collector(s) configured`:`No collectors configured`}),(0,P.jsx)(`div`,{className:`flex gap-2`,children:(0,P.jsx)(F,{asChild:!0,size:`sm`,children:(0,P.jsx)(p,{to:`/dashboard/forward`,children:`Open`})})})]})]}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`ServiceNow`})}),(0,P.jsxs)(V,{className:`space-y-3 text-sm`,children:[(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:t.isLoading?`Loading`:t.data?.configured?`Configured (${t.data.instanceUrl??`instance`})`:`Not configured`}),(0,P.jsxs)(`div`,{className:`flex gap-2`,children:[(0,P.jsx)(F,{asChild:!0,size:`sm`,children:(0,P.jsx)(p,{to:`/dashboard/servicenow`,children:`Open`})}),(0,P.jsx)(F,{asChild:!0,size:`sm`,variant:`secondary`,children:(0,P.jsx)(p,{to:`/dashboard/docs/$slug`,params:{slug:`servicenow`},children:`Docs`})})]})]})]}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`AI (Gemini)`})}),(0,P.jsxs)(V,{className:`space-y-3 text-sm`,children:[(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:e.isLoading?`Loading`:e.data?.enabled?e.data?.configured?`Connected (${e.data.email??`account`})`:`Not connected`:`Disabled`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,P.jsx)(F,{asChild:!0,size:`sm`,children:(0,P.jsx)(p,{to:`/dashboard/gemini`,children:`Connect`})}),(0,P.jsx)(F,{asChild:!0,size:`sm`,variant:`secondary`,children:(0,P.jsx)(p,{to:`/dashboard/ai`,children:`AI Templates`})}),(0,P.jsx)(F,{asChild:!0,size:`sm`,variant:`secondary`,children:(0,P.jsx)(p,{to:`/dashboard/docs/$slug`,params:{slug:`ai-templates`},children:`Docs`})})]})]})]}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Elastic`})}),(0,P.jsxs)(V,{className:`space-y-3 text-sm`,children:[(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:r.isLoading?`Loading`:r.data?.enabled?r.data?.configured?`Configured (${r.data.url??`endpoint`})`:`Not configured`:`Disabled`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,P.jsx)(F,{asChild:!0,size:`sm`,children:(0,P.jsx)(p,{to:`/dashboard/elastic`,children:`Open`})}),(0,P.jsx)(F,{asChild:!0,size:`sm`,variant:`secondary`,children:(0,P.jsxs)(`a`,{href:`/kibana/`,children:[`Kibana `,(0,P.jsx)(te,{className:`ml-1 inline h-4 w-4`})]})})]})]})]}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Advanced settings`})}),(0,P.jsxs)(V,{className:`space-y-3 text-sm`,children:[(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:`Cloud creds, BYOL servers, defaults, and external template repos.`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,P.jsx)(F,{asChild:!0,size:`sm`,variant:`secondary`,children:(0,P.jsx)(p,{to:`/dashboard/settings`,children:`Open My Settings`})}),(0,P.jsx)(F,{asChild:!0,size:`sm`,variant:`secondary`,children:(0,P.jsxs)(`a`,{href:`/dashboard/docs/getting-started`,children:[`Getting started`,` `,(0,P.jsx)(te,{className:`ml-1 inline h-4 w-4`})]})})]})]})]})]})]})}const Pl=t(`/dashboard/gemini`)({component:Fl});function Fl(){let e=n();return(0,M.useEffect)(()=>{e({to:`/dashboard/ai`,replace:!0})},[e]),null}const Il=t(`/dashboard/forward`)({component:Rl});function Ll(e,t){if(e===`cloud`)return`https://fwd.app`;let n=t.trim();return n?/^https?:\/\//i.test(n)?n:`https://${n}`:``}function Rl(){let e=c(),t=H.userForwardCollectorConfigs(),n=i({queryKey:t,queryFn:Wa,refetchInterval:5e3,staleTime:1e4,retry:!1}),a=(0,M.useMemo)(()=>n.data?.collectors??[],[n.data?.collectors]),[o,s]=(0,M.useState)(``),l=i({queryKey:H.userForwardCollectorConfigLogs(o),queryFn:async()=>qa(o,300),enabled:!!o,refetchInterval:o?3e3:!1,retry:!1}),[u,d]=(0,M.useState)(`cloud`),[f,p]=(0,M.useState)(``),[m,h]=(0,M.useState)(!0),[g,ee]=(0,M.useState)(``),[_,v]=(0,M.useState)(!1),[te,ne]=(0,M.useState)(``),[re,ie]=(0,M.useState)(``),[ae,y]=(0,M.useState)(!0),b=i({queryKey:H.userGitCredentials(),queryFn:_i,staleTime:6e4,retry:!1});(0,M.useEffect)(()=>{h(u!==`cloud`)},[u]),(0,M.useEffect)(()=>{if(_||g.trim())return;let e=(b.data?.username??``).trim();e&&ee(`skyforge-${e}`)},[_,g,b.data?.username]);let x=r({mutationFn:async()=>{let e=g.trim();if(!e)throw Error(`Collector name is required`);let t=Ll(u,f);if(!t)throw Error(`Forward URL is required`);if(!te.trim()||!re.trim())throw Error(`Forward username/password are required`);return Ga({name:e,baseUrl:t,skipTlsVerify:u===`onprem`?m:!1,username:te.trim(),password:re,setDefault:ae})},onSuccess:async()=>{j.success(`Collector created`),ie(``),await e.invalidateQueries({queryKey:t})},onError:e=>j.error(`Failed to create collector`,{description:e.message})}),S=r({mutationFn:async e=>Ja(e),onSuccess:async()=>{j.success(`Collector restarted`),await e.invalidateQueries({queryKey:t})},onError:e=>j.error(`Failed to restart collector`,{description:e.message})}),oe=r({mutationFn:async e=>Ka(e),onSuccess:async(n,r)=>{j.success(`Collector deleted`),s(``),e.setQueryData(t,e=>{let t=e?.collectors??[];return{...e??{},collectors:t.filter(e=>String(e?.id??``)!==String(r))}}),await e.invalidateQueries({queryKey:t})},onError:e=>j.error(`Failed to delete collector`,{description:e.message})}),se=r({mutationFn:async e=>{for(let t of e)await Ka(t)},onSuccess:async()=>{j.success(`Collectors deleted`),s(``),e.setQueryData(t,e=>({...e??{},collectors:[]})),await e.invalidateQueries({queryKey:t})},onError:e=>j.error(`Failed to delete collectors`,{description:e.message})});return(0,P.jsxs)(`div`,{className:`p-6 space-y-6`,children:[(0,P.jsx)(`div`,{className:`flex items-start justify-between gap-4`,children:(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold`,children:`Collector`}),(0,P.jsx)(`p`,{className:`text-sm text-muted-foreground mt-1`,children:`Create one or more per-user in-cluster Forward collectors. Select a collector per deployment.`})]})}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Create collector`}),(0,P.jsx)(B,{children:`Creates a Forward collector and deploys a matching in-cluster Deployment. Deleting here only deletes the in-cluster Deployment and the saved credentials; it does not delete the Forward-side collector.`})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Collector name`}),(0,P.jsx)(K,{value:g,onChange:e=>{v(!0),ee(e.target.value)},placeholder:`skyforge-yourname`})]}),(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Forward target`}),(0,P.jsxs)(q,{value:u,onValueChange:e=>d(e),children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`cloud`,children:`fwd.app (cloud)`}),(0,P.jsx)(Z,{value:`onprem`,children:`on-prem`})]})]})]}),u===`onprem`?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`On-prem host`}),(0,P.jsx)(K,{value:f,onChange:e=>p(e.target.value),placeholder:`forward.example.com (:port)`})]}):null]}),u===`onprem`?(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(jc,{checked:m,onCheckedChange:e=>h(!!e)}),(0,P.jsx)(G,{className:`text-sm`,children:`Skip TLS verification`})]}):null,(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Forward username`}),(0,P.jsx)(K,{value:te,onChange:e=>ne(e.target.value),placeholder:`you@company.com`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Forward password`}),(0,P.jsx)(K,{type:`password`,value:re,onChange:e=>ie(e.target.value),placeholder:``})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(jc,{checked:ae,onCheckedChange:e=>y(!!e)}),(0,P.jsx)(G,{className:`text-sm`,children:`Make default`})]}),(0,P.jsx)(F,{onClick:()=>x.mutate(),disabled:x.isPending,children:x.isPending?`Creating`:`Create`})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-4`,children:[(0,P.jsx)(z,{children:`Configured collectors`}),a.length>0?(0,P.jsx)(F,{variant:`destructive`,size:`sm`,disabled:se.isPending,onClick:()=>{let e=a.map(e=>String(e.id)).filter(Boolean);e.length!==0&&confirm(`Delete ${e.length} collector(s)? This removes in-cluster Deployments and saved credentials.`)&&se.mutate(e)},children:se.isPending?`Deleting`:`Delete all`}):null]}),(0,P.jsx)(B,{children:`Each entry maps to one in-cluster Deployment and one Forward collector.`})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[n.isLoading?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading`}):null,n.isError?(0,P.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load collectors.`}):a.length===0?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No collectors configured yet.`}):null,a.map(e=>{let t=!!e.runtime?.ready,n=typeof e.forwardCollector?.connected==`boolean`?e.forwardCollector.connected:void 0;return(0,P.jsxs)(`div`,{className:`rounded-md border p-3 space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2 min-w-0`,children:[(0,P.jsx)(`div`,{className:`font-medium truncate`,children:e.name}),e.isDefault?(0,P.jsx)(W,{variant:`secondary`,children:`default`}):null,e.decryptionFailed?(0,P.jsx)(W,{variant:`destructive`,children:`re-save creds`}):null]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:e.id})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>s(t=>t===e.id?``:e.id),children:o===e.id?`Hide logs`:`Logs`}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>S.mutate(e.id),disabled:S.isPending,children:`Restart`}),(0,P.jsx)(F,{variant:`destructive`,size:`sm`,onClick:()=>{confirm(`Delete collector "${e.name}"?`)&&oe.mutate(e.id)},disabled:oe.isPending,children:`Delete`})]})]}),(0,P.jsxs)(`div`,{className:`text-sm`,children:[`Status:`,` `,(0,P.jsx)(`span`,{className:t?`text-emerald-600`:`text-muted-foreground`,children:t?`Running`:`Starting`})]}),(0,P.jsxs)(`div`,{className:`text-sm`,children:[`Forward:`,` `,typeof n==`boolean`?(0,P.jsx)(`span`,{className:n?`text-emerald-600`:`text-muted-foreground`,children:n?`Connected`:`Not connected`}):(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:`Unknown`})]}),e.forwardCollector?.version?(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Version:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:String(e.forwardCollector.version)})]}):null,e.forwardCollector?.updateStatus?(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Update:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:String(e.forwardCollector.updateStatus)})]}):null,e.forwardCollector?.externalIp?(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`External IP:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:String(e.forwardCollector.externalIp)})]}):null,Array.isArray(e.forwardCollector?.internalIps)&&(e.forwardCollector?.internalIps??[]).length>0?(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Internal IPs:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:(e.forwardCollector?.internalIps??[]).filter(Boolean).join(`, `)})]}):null,e.runtime?.podName?(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Pod:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:String(e.runtime.podName)}),` `,`(`,String(e.runtime.podPhase??``),`)`]}):null,o===e.id?(0,P.jsx)(`pre`,{className:`bg-muted p-3 rounded-md overflow-auto font-mono text-xs whitespace-pre-wrap`,children:l.isLoading?`Loading`:(l.data?.logs??``).trim()||`No logs yet.`}):null]},e.id)})]})]})]})}const zl=t(`/dashboard/elastic`)({component:Ul});function Bl(e,t){return e?.services?.find(e=>String(e.id)===t)}function Vl(e){let t=Bl(e,`elasticsearch`),n=Bl(e,`kibana`);return(t?.desiredReplicas??0)===0&&(n?.desiredReplicas??0)===0}function Hl(e){let t=Bl(e,`elasticsearch`);return(t?.desiredReplicas??0)>0&&(t?.availableReplicas??0)>0}function Ul(){let e=c(),t=i({queryKey:H.userElasticConfig(),queryFn:oi,retry:!1,staleTime:1e4}),n=t.data,a=n?.enabled??!1,o=n?.defaultUrl??``,s=n?.defaultIndexPrefix??``,l=i({queryKey:H.elasticToolsStatus(),queryFn:ui,retry:!1,staleTime:5e3,enabled:a}),[u,d]=(0,M.useState)(``),[f,m]=(0,M.useState)(``),[h,g]=(0,M.useState)(`none`),[_,v]=(0,M.useState)(``),[ne,re]=(0,M.useState)(``),[ie,ae]=(0,M.useState)(``),[y,b]=(0,M.useState)(!1);(0,M.useEffect)(()=>{if(!n)return;d(n.url??n.defaultUrl??``),m(n.indexPrefix??n.defaultIndexPrefix??``);let e=String(n.authType??`none`).toLowerCase();g(e===`basic`||e===`api_key`?e:`none`),re(n.basicUsername??``),v(``),ae(``)},[n]);let x=(0,M.useMemo)(()=>({url:u,indexPrefix:f,authType:h,apiKey:_,basicUsername:ne,basicPassword:ie,verifyTls:!0}),[_,h,ie,ne,f,u]),S=(0,M.useMemo)(()=>!(!u.trim()&&!o.trim()||!f.trim()&&!s.trim()||h===`api_key`&&!_.trim()&&!n?.hasApiKey||h===`basic`&&!ne.trim()||h===`basic`&&!ie.trim()&&!n?.hasBasicPassword),[_,h,ie,ne,s,o,f,n,u]),oe=r({mutationFn:async()=>di(),onSuccess:async()=>{await e.invalidateQueries({queryKey:H.elasticToolsStatus()})}}),se=async()=>{let e;try{e=await ui()}catch{return}if(!e?.autosleepEnabled||!Vl(e))return;try{await di()}catch{return}let t=Date.now()+6e4;for(;Date.now()<t;){try{let e=await ui();if(!Vl(e)&&Hl(e))return}catch{}await new Promise(e=>setTimeout(e,2e3))}},ce=r({mutationFn:async()=>si(x),onSuccess:async()=>{j.success(`Elastic config saved`),await e.invalidateQueries({queryKey:H.userElasticConfig()})},onError:e=>j.error(`Failed to save Elastic config`,{description:e.message})}),le=r({mutationFn:async()=>ci(),onSuccess:async()=>{j.success(`Elastic config cleared`),await e.invalidateQueries({queryKey:H.userElasticConfig()})},onError:e=>j.error(`Failed to clear Elastic config`,{description:e.message})}),C=r({mutationFn:async()=>(await se(),li()),onSuccess:e=>{String(e.status).toLowerCase()===`ok`?j.success(`Elastic reachable`):j.error(`Elastic test failed`,{description:e.detail??`unknown error`})},onError:e=>j.error(`Failed to test Elastic`,{description:e.message})});return(0,M.useEffect)(()=>{a&&l.data?.autosleepEnabled&&Vl(l.data)&&(oe.isPending||y||(b(!0),oe.mutate()))},[a,l.data,y]),(0,P.jsxs)(`div`,{className:`space-y-6 p-6 pb-20`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(p,{to:`/dashboard/integrations`,className:Cr({variant:`outline`,size:`icon`,className:`h-9 w-9`}),children:(0,P.jsx)(ee,{className:`h-4 w-4`})}),(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Elastic`}),(0,P.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Optional per-user Elasticsearch settings for indexing Skyforge events.`})]})]}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsx)(R,{children:(0,P.jsxs)(z,{className:`flex items-center gap-2`,children:[(0,P.jsx)(Ie,{className:`h-5 w-5`}),`Integration Status`]})}),(0,P.jsxs)(V,{className:`space-y-3 text-sm`,children:[t.isLoading?(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:`Loading`}):t.isError?(0,P.jsxs)(`div`,{className:`text-destructive`,children:[`Failed to load:`,` `,t.error instanceof Error?t.error.message:String(t.error)]}):a?(0,P.jsxs)(`div`,{className:`space-y-1 text-muted-foreground`,children:[(0,P.jsxs)(`div`,{children:[t.data?.configured?`Configured`:`Not configured`,`  Default: `,(0,P.jsx)(`span`,{className:`font-mono`,children:o||``})]}),l.isLoading?(0,P.jsx)(`div`,{children:`Tools: loading`}):l.isError?(0,P.jsx)(`div`,{children:`Tools: status unavailable`}):l.data?(0,P.jsxs)(`div`,{children:[`Tools:`,` `,Vl(l.data)?oe.isPending?`waking`:`asleep`:Hl(l.data)?`ready`:`starting`,l.data.autosleepEnabled?`  autosleep ${l.data.idleMinutes}m`:``]}):null]}):(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:"Elastic is disabled on this Skyforge instance. Ask an admin to enable `skyforge.elastic.enabled` in the Helm values."}),(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,P.jsxs)(F,{size:`sm`,variant:`secondary`,disabled:t.isLoading||t.isError||C.isPending||oe.isPending,onClick:()=>C.mutate(),children:[(0,P.jsx)(Ot,{className:`mr-2 h-4 w-4`}),`Test`]}),(0,P.jsx)(F,{size:`sm`,variant:`secondary`,asChild:!0,children:(0,P.jsxs)(`a`,{href:`/kibana/`,target:`_blank`,rel:`noreferrer noopener`,children:[`Open Kibana `,(0,P.jsx)(te,{className:`ml-1 inline h-4 w-4`})]})}),(0,P.jsxs)(F,{size:`sm`,variant:`outline`,disabled:le.isPending||t.isLoading||t.isError,onClick:()=>le.mutate(),children:[(0,P.jsx)(tt,{className:`mr-2 h-4 w-4`}),`Clear`]})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Configuration`})}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{htmlFor:`elastic-url`,children:`Elasticsearch URL`}),(0,P.jsx)(K,{id:`elastic-url`,value:u,onChange:e=>d(e.target.value),placeholder:o||`http://elasticsearch:9200`}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Leave blank to use the instance default`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:o||`http://elasticsearch:9200`}),`.`]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{htmlFor:`elastic-index`,children:`Index prefix`}),(0,P.jsx)(K,{id:`elastic-index`,value:f,onChange:e=>m(e.target.value),placeholder:s||`skyforge`}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Leave blank to use the instance default`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:s||`skyforge`}),`.`]})]}),(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Auth`}),(0,P.jsxs)(q,{value:h,onValueChange:e=>g(e),children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select auth`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`none`,children:`None`}),(0,P.jsx)(Z,{value:`api_key`,children:`API key`}),(0,P.jsx)(Z,{value:`basic`,children:`Basic auth`})]})]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:h===`api_key`&&t.data?.hasApiKey?`API key stored. Leave blank to keep.`:h===`basic`&&t.data?.hasBasicPassword?`Password stored. Leave blank to keep.`:`Secrets are stored encrypted; they are not shown again.`})]}),h===`api_key`?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{htmlFor:`elastic-api-key`,children:`API key`}),(0,P.jsx)(K,{id:`elastic-api-key`,value:_,onChange:e=>v(e.target.value),placeholder:t.data?.hasApiKey?`(stored)`:`ApiKey ...`})]}):h===`basic`?(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{htmlFor:`elastic-basic-user`,children:`Username`}),(0,P.jsx)(K,{id:`elastic-basic-user`,value:ne,onChange:e=>re(e.target.value),placeholder:`elastic`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{htmlFor:`elastic-basic-pass`,children:`Password`}),(0,P.jsx)(K,{id:`elastic-basic-pass`,value:ie,onChange:e=>ae(e.target.value),placeholder:t.data?.hasBasicPassword?`(stored)`:``})]})]}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No auth headers will be sent.`})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,P.jsx)(F,{disabled:!S||ce.isPending,onClick:()=>ce.mutate(),children:`Save`}),(0,P.jsx)(F,{variant:`secondary`,disabled:C.isPending||oe.isPending||t.isLoading||t.isError,onClick:()=>C.mutate(),children:`Test`})]})]})]})]})}var Wl=M.forwardRef(({className:e,value:t,...n},r)=>(0,P.jsx)(Pt,{ref:r,className:N(`relative h-4 w-full overflow-hidden rounded-full bg-secondary`,e),...n,children:(0,P.jsx)(Lt,{className:`h-full w-full flex-1 bg-primary transition-all`,style:{transform:`translateX(-${100-(t||0)}%)`}})}));Wl.displayName=Pt.displayName;function Gl(e,t){let n=c(),r=(0,M.useMemo)(()=>`${Ir}/runs/${encodeURIComponent(e)}/events`,[e]);(0,M.useEffect)(()=>{if(!t||!e)return;let i=Ks(r,{output:t=>{try{console.log(`Run event:`,t.data);let r=JSON.parse(t.data);if(!r||!Array.isArray(r.entries))return;n.setQueryData(H.runLogs(e),e=>{let t=(e?.entries??[]).concat(r.entries);return{cursor:Number(r.cursor??e?.cursor??0),entries:t}})}catch{}}});return()=>{i.close()}},[t,n,e,r])}const Kl=t(`/dashboard/ai`)({component:$l});function ql(e){return e.match(/(https:\/\/console\.cloud\.google\.com\/apis\/library\/aiplatform\.googleapis\.com\?project=[^)\s]+)/)?.[1]??null}var Jl={generate:`Generate`,save:`Save`,validate:`Validate`,autofix:`Auto-fix`,disconnect:`Disconnect`},Yl={generate:{phase:`idle`},save:{phase:`idle`},validate:{phase:`idle`},autofix:{phase:`idle`},disconnect:{phase:`idle`}};function Xl(e){if(!e||e<0)return`0s`;let t=Math.floor(e/1e3),n=Math.floor(t/60),r=t%60;return n===0?`${r}s`:`${String(n).padStart(2,`0`)}:${String(r).padStart(2,`0`)}`}function Zl(e){return e.split(/\r?\n/)[0]||e}function Ql(e){return e.trim().replace(/\s+/g,`-`)}function $l(){let e=c(),[t,n]=(0,M.useState)(`netlab`),[a,o]=(0,M.useState)(``),[s,l]=(0,M.useState)(``),[u,d]=(0,M.useState)(``),[f,m]=(0,M.useState)(``),h=(0,M.useRef)(null),[g,ee]=(0,M.useState)(``),[_,v]=(0,M.useState)(``),[te,ne]=(0,M.useState)(``),[re,ie]=(0,M.useState)(`template`),[ae,y]=(0,M.useState)(Yl),[b,x]=(0,M.useState)(null),[S,oe]=(0,M.useState)([]),[se,ce]=(0,M.useState)(!1),[le,C]=(0,M.useState)(Date.now()),[ue,w]=(0,M.useState)(``),T=e=>{oe(t=>[e,...t].slice(0,5))},de=(e,t,n)=>{let r=Date.now();C(r),x(e),ce(!1),y(i=>({...i,[e]:{phase:`running`,startedAt:r,summary:t,requestMeta:n}}))},fe=(e,t,n,r)=>{let i=null;y(a=>{let o=a[e],s=Date.now(),c=o.startedAt??s,l=Math.max(0,s-c);return i={action:e,phase:t,startedAt:c,endedAt:s,durationMs:l,summary:n,detail:r},{...a,[e]:{...o,phase:t,endedAt:s,durationMs:l,summary:n,detail:r}}}),i&&T(i),x(t=>t===e?null:t)};(0,M.useEffect)(()=>{if(!b)return;let e=window.setInterval(()=>C(Date.now()),1e3);return()=>window.clearInterval(e)},[b]);let E=i({queryKey:H.userGeminiConfig(),queryFn:ii,refetchInterval:1e4}),pe=i({queryKey:H.userAIHistory(),queryFn:pi,refetchInterval:15e3});Gl(te,!!te);let me=i({queryKey:H.runLogs(te),queryFn:async()=>({cursor:0,entries:[]}),enabled:!!te,retry:!1,staleTime:1/0}),he=(E.data?.enabled??!1)&&(E.data?.aiEnabled??!1)&&(E.data?.oauthConfigured??!1)&&(E.data?.vertexConfigured??!1)&&(E.data?.configured??!1),ge=r({mutationFn:async()=>ai(),onMutate:()=>{de(`disconnect`,`Disconnecting Gemini integration`)},onSuccess:async()=>{fe(`disconnect`,`succeeded`,`Gemini disconnected`),j.success(`Disconnected Gemini`),await e.invalidateQueries({queryKey:H.userGeminiConfig()})},onError:e=>{let t=e instanceof Error?e.message:String(e);fe(`disconnect`,`failed`,`Disconnect failed: ${Zl(t)}`,t),j.error(`Failed to disconnect Gemini`,{description:t})}}),_e=r({mutationFn:async()=>{let e={provider:`gemini`,kind:t,prompt:a,seedTemplate:s||void 0,constraints:[`single-file`,t===`netlab`?`provider=clab`:``,`no external files`].filter(Boolean)},n=new AbortController;return h.current=n,fi(e,{signal:n.signal})},onMutate:()=>{de(`generate`,`Generating ${t} template with Gemini`,{kind:t,provider:`gemini`}),d(``),m(``),v(``)},onSuccess:t=>{d(t.content??``),m(``),v(``),w(t.id),fe(`generate`,`succeeded`,`Template generated: ${t.filename}`,(t.warnings??[]).join(`
`)||void 0),e.invalidateQueries({queryKey:H.userAIHistory()}),j.success(`Template generated`,{description:t.filename}),h.current=null},onError:e=>{h.current=null;let t=e instanceof DOMException&&e.name===`AbortError`||e instanceof Error&&e.name===`AbortError`,n=e instanceof Error?e.message:String(e);if(t){v(``),m(``),fe(`generate`,`failed`,`Generation canceled`);return}if(v(n),m(``),e instanceof Error&&`bodyText`in e){let t=e.bodyText;if(typeof t==`string`&&t.trim())try{let e=(JSON.parse(t)?.details?.meta??{}).rawOutput;typeof e==`string`&&e.trim()&&m(e)}catch{}}fe(`generate`,`failed`,`Generation failed: ${Zl(n)}`,n),j.error(`Failed to generate template`,{description:n})},onSettled:()=>{h.current=null}}),ve=r({mutationFn:async()=>{if(!u.trim())throw Error(`No output to save`);return mi({kind:t,content:u,pathHint:`ai/generated`,filename:g.trim()?g.trim():void 0})},onMutate:()=>{de(`save`,`Saving template to repository`,{kind:t,pathHint:`ai/generated`})},onSuccess:async t=>{v(``),m(``),fe(`save`,`succeeded`,`Saved to repo: ${t.path}`,`${t.repo}:${t.path}@${t.branch}`),j.success(`Saved to repo`,{description:`${t.repo}:${t.path}@${t.branch}`}),await e.invalidateQueries({queryKey:[`workspaceTemplates`]})},onError:e=>{let t=e instanceof Error?e.message:String(e);v(t),fe(`save`,`failed`,`Save failed: ${Zl(t)}`,t),j.error(`Failed to save template`,{description:t})}}),ye=r({mutationFn:async()=>{if(!u.trim())throw Error(`No output to validate`);return hi({kind:t,content:u})},onMutate:()=>{t===`netlab`&&ie(`validate`),de(`validate`,t===`netlab`?`Starting netlab validation run`:`Validating containerlab template`,{kind:t})},onSuccess:n=>{if(v(``),m(``),t===`netlab`){let t=n.task?.id==null?``:String(n.task.id);ne(t),t&&e.setQueryData(H.runLogs(t),{cursor:0,entries:[]}),fe(`validate`,`succeeded`,t?`Validation run started: ${t}`:`Validation run started`,void 0),j.success(`Validation started`,{description:t?`Run: ${t}`:`Run created`});return}let r=n.task?.ok===!0,i=Array.isArray(n.task?.errors)&&n.task.errors.length>0?n.task.errors.map(e=>typeof e==`string`?e:JSON.stringify(e)).join(`
`):``;if(r){fe(`validate`,`succeeded`,`Containerlab template is valid`),j.success(`Containerlab template is valid`),ne(``);return}v(i||`Containerlab template is invalid`),m(``),fe(`validate`,`failed`,`Containerlab validation failed: ${Zl(i||`schema error`)}`,i||`Containerlab template is invalid`),j.error(`Containerlab template is invalid`,{description:i?i.split(`
`)[0]:`Schema validation failed`})},onError:e=>{let t=e instanceof Error?e.message:String(e);v(t),m(``),fe(`validate`,`failed`,`Validate failed: ${Zl(t)}`,t),j.error(`Failed to validate template`,{description:t})}}),be=r({mutationFn:async()=>{if(t!==`containerlab`)throw Error(`Autofix is only supported for containerlab templates`);if(!u.trim())throw Error(`No output to autofix`);return gi({kind:`containerlab`,content:u,maxIterations:3})},onMutate:()=>{de(`autofix`,`Autofix iteration loop started (max 3)`,{kind:`containerlab`})},onSuccess:e=>{if(d(e.content??``),e.ok){v(``),m(``),fe(`autofix`,`succeeded`,`Autofix succeeded in ${e.iterations} iteration(s)`),j.success(`Autofix succeeded`,{description:`Iterations: ${e.iterations}`});return}let t=(e.errors??[]).slice(0,10).join(`
`);v(t||`Autofix failed`),m(``),fe(`autofix`,`failed`,`Autofix failed: ${Zl(t||`did not converge`)}`,t||`Autofix failed`),j.error(`Autofix did not converge`,{description:t?t.split(`
`)[0]:`Schema validation failed`})},onError:e=>{let t=e instanceof Error?e.message:String(e);v(t),m(``),fe(`autofix`,`failed`,`Autofix failed: ${Zl(t)}`,t),j.error(`Failed to autofix template`,{description:t})}}),xe=(0,M.useMemo)(()=>pe.data?.items??[],[pe.data?.items]),Se=_e.isPending||ve.isPending||ye.isPending||be.isPending||ge.isPending,D=b?ae[b]:null,Ce=D?.startedAt?le-D.startedAt:0,we=_e.isPending?`Generating template`:u.trim()?`Generated template output`:`No output yet`,Te=_e.isPending?`Generating template...`:`No output yet. Enter a prompt and click Generate.`,Ee=t===`containerlab`?`.clab.yml`:`.yml`,De=g.trim()?`${Ql(g)}${g.trim().endsWith(Ee)?``:Ee}`:`generated-${t}${Ee}`,Oe=b&&D?.phase===`running`?Math.min(95,Math.max(5,Math.floor(Ce/9e4*100))):0;return(0,P.jsxs)(`div`,{className:`mx-auto w-full max-w-5xl space-y-4 p-4`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold`,children:`AI`}),(0,P.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Connect Gemini and generate Netlab or Containerlab templates.`})]}),b&&D?.phase===`running`?(0,P.jsx)(L,{children:(0,P.jsxs)(V,{className:`flex flex-col gap-2 pt-6`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center justify-between gap-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(Et,{className:`h-4 w-4 animate-spin text-muted-foreground`}),(0,P.jsxs)(`div`,{className:`text-sm`,children:[(0,P.jsx)(`span`,{className:`font-medium`,children:Jl[b]}),` `,(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:D.summary})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(W,{variant:`secondary`,children:Xl(Ce)}),b===`generate`?(0,P.jsxs)(F,{size:`sm`,variant:`outline`,disabled:!h.current||!_e.isPending,onClick:()=>{let e=h.current;e&&(e.abort(),h.current=null,j.message(`Generation canceled`))},children:[(0,P.jsx)(it,{className:`mr-2 h-4 w-4`}),`Cancel`]}):null]})]}),(0,P.jsx)(Wl,{value:Oe}),D.requestMeta?(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:Object.entries(D.requestMeta).map(([e,t])=>`${e}=${t}`).join(`  `)}):null]})}):null,(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Gemini Connection`})}),(0,P.jsxs)(V,{className:`space-y-2 text-sm`,children:[E.isLoading?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading`}):E.isError?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`text-sm text-destructive`,children:[`Failed to load Gemini configuration:`,` `,E.error instanceof Error?E.error.message:String(E.error)]}),(0,P.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,P.jsx)(F,{variant:`secondary`,onClick:()=>E.refetch(),children:`Retry`})})]}):E.data?.enabled?E.data?.aiEnabled?E.data?.oauthConfigured?E.data?.vertexConfigured?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(`dl`,{className:`grid grid-cols-[96px_1fr] gap-x-3 gap-y-2`,children:[(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Status`}),(0,P.jsx)(`dd`,{className:`text-right`,children:E.data?.configured?`Connected`:`Not connected`}),(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Email`}),(0,P.jsx)(`dd`,{className:`text-right break-all`,children:E.data?.email??``}),(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Scopes`}),(0,P.jsx)(`dd`,{className:`text-right break-words`,children:E.data?.scopes??``}),(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Model`}),(0,P.jsx)(`dd`,{className:`text-right break-all font-mono text-xs`,children:E.data?.model??``}),(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Fallback`}),(0,P.jsx)(`dd`,{className:`text-right break-all font-mono text-xs`,children:E.data?.fallbackModel??``}),(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Location`}),(0,P.jsx)(`dd`,{className:`text-right break-all font-mono text-xs`,children:E.data?.location??``}),(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Updated`}),(0,P.jsx)(`dd`,{className:`text-right`,children:E.data?.updatedAt??``})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2 pt-1`,children:[(0,P.jsx)(F,{disabled:!E.data?.enabled||!E.data?.oauthConfigured,onClick:()=>{window.location.assign(`${Ir}/user/integrations/gemini/connect`)},children:E.data?.configured?`Reconnect`:`Connect`}),(0,P.jsx)(F,{variant:`secondary`,disabled:!E.data?.configured||ge.isPending,onClick:()=>ge.mutate(),children:`Disconnect`})]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Redirect URL:`,` `,(0,P.jsx)(`span`,{className:`font-mono break-all`,children:E.data?.redirectUrl??``})]})]}):(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:"Vertex AI is not configured (missing `skyforge.gemini.projectId`). You can connect Gemini, but generation will fail until the project is set."}),(0,P.jsxs)(`dl`,{className:`grid grid-cols-[96px_1fr] gap-x-3 gap-y-2`,children:[(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Model`}),(0,P.jsx)(`dd`,{className:`text-right break-all font-mono text-xs`,children:E.data?.model??``}),(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Fallback`}),(0,P.jsx)(`dd`,{className:`text-right break-all font-mono text-xs`,children:E.data?.fallbackModel??``}),(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Location`}),(0,P.jsx)(`dd`,{className:`text-right break-all font-mono text-xs`,children:E.data?.location??``})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2 pt-1`,children:[(0,P.jsx)(F,{disabled:!E.data?.enabled||!E.data?.oauthConfigured,onClick:()=>{window.location.assign(`${Ir}/user/integrations/gemini/connect`)},children:E.data?.configured?`Reconnect`:`Connect`}),(0,P.jsx)(F,{variant:`secondary`,disabled:!E.data?.configured||ge.isPending,onClick:()=>ge.mutate(),children:`Disconnect`})]})]}):(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:"Gemini OAuth is not configured (missing OAuth client ID/secret and/or redirect URL). Ask an admin to set `skyforge.gemini.clientID` and ensure the secret referenced by `skyforge.gemini.clientSecretSecretName` is populated."}),(0,P.jsxs)(`dl`,{className:`grid grid-cols-[96px_1fr] gap-x-3 gap-y-2`,children:[(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Model`}),(0,P.jsx)(`dd`,{className:`text-right break-all font-mono text-xs`,children:E.data?.model??``}),(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Fallback`}),(0,P.jsx)(`dd`,{className:`text-right break-all font-mono text-xs`,children:E.data?.fallbackModel??``}),(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Location`}),(0,P.jsx)(`dd`,{className:`text-right break-all font-mono text-xs`,children:E.data?.location??``})]})]}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:"AI template generation is disabled on this Skyforge instance. Ask an admin to enable `skyforge.ai.enabled` in the Helm values."}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:"Gemini integration is disabled on this Skyforge instance. Ask an admin to enable `skyforge.gemini.enabled` in the Helm values."}),_?(0,P.jsxs)(`div`,{className:`rounded-md border bg-muted/40 p-3 text-xs`,children:[(0,P.jsx)(`div`,{className:`font-medium`,children:`Last error`}),(0,P.jsx)(`div`,{className:`mt-1 whitespace-pre-wrap break-words text-muted-foreground`,children:_}),ql(_)?(0,P.jsx)(`div`,{className:`mt-2`,children:(0,P.jsx)(`a`,{className:`underline`,href:ql(_)??`#`,target:`_blank`,rel:`noreferrer noopener`,children:`Enable Vertex AI API`})}):null]}):null]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Activity`})}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsx)(`div`,{className:`flex flex-wrap items-center gap-2`,children:b&&D?.phase===`running`?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(W,{children:[Jl[b],` running`]}),(0,P.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Elapsed: `,Xl(Ce)]})]}):(0,P.jsx)(W,{variant:`secondary`,children:`Idle`})}),b&&D?.phase===`running`?(0,P.jsx)(Wl,{value:Oe}):null,b&&D?.phase===`running`?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:D.summary}):null,S.length>0?(0,P.jsx)(`div`,{className:`space-y-2`,children:S.map((e,t)=>(0,P.jsxs)(`div`,{className:`rounded-md border p-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2 text-sm`,children:[(0,P.jsxs)(`div`,{className:`font-medium`,children:[Jl[e.action],`  `,e.phase]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:Xl(e.durationMs)})]}),(0,P.jsx)(`div`,{className:`mt-1 text-xs text-muted-foreground`,children:e.summary})]},`${e.action}-${e.endedAt}-${t}`))}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No activity yet.`}),_?(0,P.jsxs)(`div`,{className:`rounded-md border bg-muted/40 p-3 text-xs`,children:[(0,P.jsx)(`div`,{className:`font-medium`,children:`Latest error`}),(0,P.jsx)(`div`,{className:`mt-1 text-muted-foreground`,children:Zl(_)}),(0,P.jsxs)(`div`,{className:`mt-2 flex flex-wrap gap-2`,children:[(0,P.jsx)(F,{size:`sm`,variant:`outline`,onClick:()=>ce(e=>!e),children:se?`Hide details`:`View details`}),ql(_)?(0,P.jsx)(F,{size:`sm`,variant:`outline`,asChild:!0,children:(0,P.jsx)(`a`,{href:ql(_)??`#`,target:`_blank`,rel:`noreferrer noopener`,children:`Enable Vertex AI API`})}):null]}),se?(0,P.jsxs)(`div`,{className:`mt-2 space-y-2`,children:[(0,P.jsx)(`div`,{className:`whitespace-pre-wrap break-words text-muted-foreground`,children:_}),f?(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`div`,{className:`mb-1 font-medium`,children:`Raw AI output`}),(0,P.jsx)(`div`,{className:`max-h-48 overflow-auto whitespace-pre-wrap break-words text-muted-foreground`,children:f})]}):null]}):null]}):null]})]}),(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Generate`})}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{htmlFor:`ai-kind`,children:`Template kind`}),(0,P.jsxs)(q,{value:t,onValueChange:e=>n(e),children:[(0,P.jsx)(Y,{id:`ai-kind`,"aria-label":`Template kind`,children:(0,P.jsx)(J,{placeholder:`Select kind`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`netlab`,children:`Netlab`}),(0,P.jsx)(Z,{value:`containerlab`,children:`Containerlab`})]})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{htmlFor:`ai-prompt`,children:`Prompt`}),(0,P.jsx)(ul,{id:`ai-prompt`,name:`ai-prompt`,value:a,onChange:e=>o(e.target.value),placeholder:`Describe the topology you want (nodes, links, protocols, constraints)`,className:`min-h-[120px]`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{htmlFor:`ai-seed`,children:`Seed template (optional)`}),(0,P.jsx)(ul,{id:`ai-seed`,name:`ai-seed`,value:s,onChange:e=>l(e.target.value),placeholder:`Paste a starting YAML file here to modify`,className:`min-h-[120px] font-mono text-xs`})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsx)(F,{disabled:!he||_e.isPending||Se||a.trim().length===0,onClick:()=>_e.mutate(),children:_e.isPending?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Et,{className:`mr-2 h-4 w-4 animate-spin`}),`Generating`]}):`Generate`}),(0,P.jsx)(F,{variant:`outline`,disabled:!u.trim()||ye.isPending||Se,onClick:()=>ye.mutate(),children:ye.isPending?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Et,{className:`mr-2 h-4 w-4 animate-spin`}),`Validating`]}):`Validate`}),(0,P.jsx)(F,{variant:`outline`,disabled:t!==`containerlab`||!u.trim()||be.isPending||Se,onClick:()=>be.mutate(),children:be.isPending?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Et,{className:`mr-2 h-4 w-4 animate-spin`}),`Auto-fixing`]}):`Auto-fix`}),te?(0,P.jsx)(F,{variant:`outline`,asChild:!0,children:(0,P.jsx)(p,{to:`/dashboard/runs/$runId`,params:{runId:te},children:`Open run`})}):null,(0,P.jsx)(F,{variant:`secondary`,disabled:u.trim().length===0,onClick:()=>{navigator.clipboard.writeText(u),j.success(`Copied to clipboard`)},children:`Copy`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{htmlFor:`ai-save-name`,children:`Save name (optional)`}),(0,P.jsx)(K,{id:`ai-save-name`,value:g,onChange:e=>ee(Ql(e.target.value)),placeholder:`e.g. bgp-5node${Ee}`,disabled:Se}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Saves to`,` `,(0,P.jsxs)(`span`,{className:`font-mono`,children:[`blueprints/`,t,`/ai/generated/`]}),` `,`as `,(0,P.jsx)(`span`,{className:`font-mono`,children:De}),`.`]}),(0,P.jsx)(F,{variant:`outline`,disabled:!u.trim()||ve.isPending||Se,onClick:()=>ve.mutate(),children:ve.isPending?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Et,{className:`mr-2 h-4 w-4 animate-spin`}),`Saving`]}):`Save to Repo`})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Output`})}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(Bc,{value:re,onValueChange:e=>ie(e),children:[(0,P.jsxs)(Vc,{children:[(0,P.jsx)(Hc,{value:`template`,children:`Template`}),(0,P.jsx)(Hc,{value:`request`,children:`Request`}),te?(0,P.jsx)(Hc,{value:`validate`,children:`Validation Log`}):null]}),(0,P.jsxs)(Uc,{value:`template`,className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:we}),(0,P.jsx)(G,{className:`sr-only`,htmlFor:`ai-output`,children:`Generated template output`}),(0,P.jsx)(ul,{id:`ai-output`,name:`ai-output`,value:u,readOnly:!0,placeholder:Te,className:`min-h-[420px] font-mono text-xs`})]}),(0,P.jsxs)(Uc,{value:`request`,className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`rounded-md border p-3 text-xs`,children:[(0,P.jsx)(`div`,{className:`font-medium`,children:`Current request`}),(0,P.jsxs)(`dl`,{className:`mt-2 grid grid-cols-[96px_1fr] gap-x-3 gap-y-2`,children:[(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Kind`}),(0,P.jsx)(`dd`,{className:`text-right font-mono`,children:t}),(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Provider`}),(0,P.jsx)(`dd`,{className:`text-right font-mono`,children:`gemini`}),(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Model`}),(0,P.jsx)(`dd`,{className:`text-right break-all font-mono`,children:E.data?.model??``}),(0,P.jsx)(`dt`,{className:`text-muted-foreground`,children:`Fallback`}),(0,P.jsx)(`dd`,{className:`text-right break-all font-mono`,children:E.data?.fallbackModel??``})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Prompt`}),(0,P.jsx)(ul,{readOnly:!0,value:a,placeholder:`Prompt will appear here`,className:`min-h-[140px]`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Seed (optional)`}),(0,P.jsx)(ul,{readOnly:!0,value:s,placeholder:`Seed template will appear here`,className:`min-h-[140px] font-mono text-xs`})]})]}),(0,P.jsxs)(Uc,{value:`validate`,className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Run`}),(0,P.jsx)(`div`,{className:`break-all font-mono text-xs`,children:te||``})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[te?(0,P.jsx)(F,{variant:`outline`,size:`sm`,asChild:!0,children:(0,P.jsx)(p,{to:`/dashboard/runs/$runId`,params:{runId:te},children:`Open run`})}):null,(0,P.jsx)(F,{variant:`outline`,size:`sm`,disabled:!te,onClick:()=>{te&&e.setQueryData(H.runLogs(te),{cursor:0,entries:[]})},children:`Clear`}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Cursor: `,String(me.data?.cursor??0)]})]})]}),(0,P.jsx)(`div`,{className:`rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100`,children:(0,P.jsx)(eu,{entries:me.data?.entries??[]})})]})]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Validate runs an in-cluster netlab validation job (netlab templates) or containerlab schema validation (containerlab templates).`})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`History`})}),(0,P.jsxs)(V,{className:`space-y-2 text-sm`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`History updates every 15s and may lag active operations.`}),pe.isLoading?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading`}):xe.length===0?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No generations yet.`}):(0,P.jsx)(`div`,{className:`space-y-1`,children:xe.slice(0,10).map(e=>(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2 rounded-md border px-3 py-2 ${e.id===ue?`border-primary/60 bg-primary/5`:``}`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsxs)(`div`,{className:`font-medium`,children:[e.kind,`  `,e.provider]}),(0,P.jsx)(`div`,{className:`truncate font-mono text-xs text-muted-foreground`,children:e.id})]}),(0,P.jsx)(`div`,{className:`shrink-0 text-xs text-muted-foreground`,children:e.createdAt})]},e.id))})]})]})]})}function eu(e){let t=(0,M.useRef)(null);return(0,M.useEffect)(()=>{let e=t.current;e&&(e.scrollTop=e.scrollHeight)},[e.entries.length]),e.entries.length===0?(0,P.jsx)(`div`,{className:`text-zinc-500`,children:`Waiting for output`}):(0,P.jsx)(`div`,{ref:t,className:`max-h-[65vh] overflow-auto whitespace-pre-wrap`,children:e.entries.map((e,t)=>(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`span`,{className:`select-none text-zinc-500`,children:e.time?`${e.time} `:``}),(0,P.jsx)(`span`,{children:e.output})]},`${e.time}-${t}`))})}const tu=t(`/admin/settings`)({component:nu});function nu(){let e=i({queryKey:H.session(),queryFn:Br,staleTime:3e4,retry:!1}),t=!!e.data?.isAdmin,[n,a]=(0,M.useState)(`200`),o=i({queryKey:H.adminAudit(n),queryFn:()=>lo({limit:n}),enabled:t,staleTime:15e3,retry:!1}),s=i({queryKey:H.adminConfig(),queryFn:co,enabled:t,staleTime:15e3,retry:!1}),c=i({queryKey:H.adminImpersonateStatus(),queryFn:uo,enabled:t,staleTime:5e3,retry:!1}),l=r({mutationFn:async e=>mo({limit:e}),onSuccess:e=>{j.success(`Reconciled queued tasks`,{description:`Considered ${e.consideredTasks}, republished ${e.republished}, errors ${e.publishErrors}`})},onError:e=>{j.error(`Failed to reconcile queued tasks`,{description:e.message})}}),u=r({mutationFn:async e=>ho({limit:e.limit,hardMaxRuntimeMinutes:e.hardMaxRuntimeMinutes,maxIdleMinutes:e.maxIdleMinutes}),onSuccess:e=>{j.success(`Reconciled running tasks`,{description:`Considered ${e.consideredTasks}, marked failed ${e.markedFailed}, errors ${e.finishErrors}`})},onError:e=>{j.error(`Failed to reconcile running tasks`,{description:e.message})}}),[d,f]=(0,M.useState)(``),p=r({mutationFn:async()=>fo({username:d}),onSuccess:()=>{j.success(`Impersonation started`),c.refetch(),window.location.reload()},onError:e=>{j.error(`Failed to impersonate`,{description:e.message})}}),m=r({mutationFn:async()=>po(),onSuccess:()=>{j.success(`Impersonation stopped`),c.refetch(),window.location.reload()},onError:e=>{j.error(`Failed to stop impersonation`,{description:e.message})}}),[h,g]=(0,M.useState)(``),ee=r({mutationFn:async()=>go({username:h,confirm:h}),onSuccess:e=>{j.success(`User purged`,{description:`Deleted workspaces: ${e.deletedWorkspaces}`})},onError:e=>{j.error(`Failed to purge user`,{description:e.message})}}),_=(0,M.useMemo)(()=>[{id:`createdAt`,header:`Time`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:e.createdAt}),width:220},{id:`actor`,header:`Actor`,cell:e=>(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`span`,{className:`font-medium`,children:e.actorUsername}),e.actorIsAdmin?(0,P.jsx)(W,{variant:`secondary`,children:`admin`}):null,e.impersonatedUsername?(0,P.jsxs)(W,{variant:`outline`,children:[`as `,e.impersonatedUsername]}):null]}),width:260},{id:`action`,header:`Action`,cell:e=>e.action,width:260},{id:`workspaceId`,header:`Workspace`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:e.workspaceId}),width:220},{id:`details`,header:`Details`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.details})}],[]);return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`System settings`}),(0,P.jsx)(B,{children:`Admin-only settings for Skyforge.`})]})}),!t&&(0,P.jsx)(L,{variant:`danger`,children:(0,P.jsx)(V,{className:`pt-6`,children:(0,P.jsx)(`div`,{className:`text-center font-medium`,children:`Admin access required.`})})}),t&&(0,P.jsxs)(Bc,{defaultValue:`overview`,children:[(0,P.jsxs)(Vc,{children:[(0,P.jsx)(Hc,{value:`overview`,children:`Overview`}),(0,P.jsx)(Hc,{value:`audit`,children:`Audit`}),(0,P.jsx)(Hc,{value:`tasks`,children:`Tasks`}),(0,P.jsx)(Hc,{value:`users`,children:`Users`})]}),(0,P.jsxs)(Uc,{value:`overview`,className:`space-y-6`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Effective config`}),(0,P.jsx)(B,{children:`Read-only view of the running server's non-secret Encore config.`})]}),(0,P.jsx)(V,{children:s.isLoading?(0,P.jsx)(U,{className:`h-40 w-full`}):s.data?(0,P.jsxs)(`div`,{className:`space-y-3`,children:[s.data.missing?.length?(0,P.jsxs)(`div`,{className:`rounded-md border border-destructive/40 bg-destructive/10 p-3 text-sm`,children:[(0,P.jsx)(`div`,{className:`font-medium`,children:`Missing config`}),(0,P.jsx)(`ul`,{className:`list-disc pl-5 text-muted-foreground`,children:s.data.missing.map(e=>(0,P.jsx)(`li`,{children:e},e))})]}):null,(0,P.jsx)(`pre`,{className:`max-h-[420px] overflow-auto rounded-md border bg-muted/50 p-3 text-xs`,children:JSON.stringify(s.data,null,2)})]}):(0,P.jsx)(ec,{title:`No config`,description:`Could not load effective config.`})})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Impersonation`}),(0,P.jsx)(B,{children:`Impersonate another user to reproduce issues or verify UX.`})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(Ce,{className:`h-5 w-5 text-muted-foreground`}),(0,P.jsxs)(`div`,{className:`text-sm`,children:[(0,P.jsx)(`span`,{className:`font-medium`,children:c.data?.actorUsername||e.data?.username||``}),c.data?.impersonating?(0,P.jsxs)(P.Fragment,{children:[` `,``,` `,(0,P.jsx)(`span`,{className:`font-medium`,children:c.data.effectiveUsername}),(0,P.jsx)(W,{className:`ml-2`,variant:`secondary`,children:`impersonating`})]}):(0,P.jsx)(W,{className:`ml-2`,variant:`outline`,children:`not impersonating`})]})]}),(0,P.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center`,children:[(0,P.jsx)(K,{placeholder:`user@example.com`,value:d,onChange:e=>f(e.target.value)}),(0,P.jsxs)(F,{onClick:()=>p.mutate(),disabled:p.isPending||!d.trim()||c.data?.impersonating,children:[(0,P.jsx)(Ee,{className:`mr-2 h-4 w-4`}),`Impersonate`]}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>m.mutate(),disabled:m.isPending||!c.data?.impersonating,children:`Stop`})]})]})]})]}),(0,P.jsx)(Uc,{value:`audit`,className:`space-y-6`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Audit log`}),(0,P.jsx)(B,{children:`Recent admin and user actions.`})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`Limit`}),(0,P.jsx)(K,{className:`w-28`,value:n,onChange:e=>a(e.target.value)})]}),(0,P.jsx)(W,{variant:`outline`,children:o.data?.timestamp??``})]}),(0,P.jsx)($s,{rows:o.data?.events??[],columns:_,getRowId:e=>String(e.id),isLoading:o.isLoading,emptyText:`No audit events.`,minWidthClassName:`min-w-[1100px]`})]})]})}),(0,P.jsx)(Uc,{value:`tasks`,className:`space-y-6`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Task reconciliation`}),(0,P.jsx)(B,{children:`Manual guardrails for stuck queued/running jobs.`})]}),(0,P.jsxs)(V,{className:`space-y-6`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`div`,{className:`font-medium`,children:`Queued tasks`}),(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Republish missing queue events.`})]}),(0,P.jsx)(F,{variant:`outline`,disabled:l.isPending,onClick:()=>l.mutate(200),children:l.isPending?`Running`:`Reconcile queued`})]}),(0,P.jsxs)(`div`,{className:`flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`div`,{className:`font-medium`,children:`Running tasks`}),(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Mark long-running/no-log tasks failed.`})]}),(0,P.jsx)(F,{variant:`outline`,disabled:u.isPending,onClick:()=>u.mutate({limit:50,hardMaxRuntimeMinutes:720,maxIdleMinutes:120}),children:u.isPending?`Running`:`Reconcile running`})]})]})]})}),(0,P.jsx)(Uc,{value:`users`,className:`space-y-6`,children:(0,P.jsxs)(L,{variant:`danger`,children:[(0,P.jsxs)(R,{children:[(0,P.jsxs)(z,{className:`flex items-center gap-2`,children:[(0,P.jsx)(T,{className:`h-5 w-5`}),`Purge user (dev-only)`]}),(0,P.jsx)(B,{children:`Removes user state and associated workspaces to rerun first-login bootstrap.`})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsx)(K,{placeholder:`user@example.com`,value:h,onChange:e=>g(e.target.value)}),(0,P.jsx)(F,{variant:`destructive`,disabled:!h.trim()||ee.isPending,onClick:()=>ee.mutate(),children:ee.isPending?`Purging`:`Purge user`})]})]})})]})]})}function ru(e){let t=Number(e);if(!Number.isFinite(t)||t<=0)return``;if(t<60)return`${Math.round(t)}s`;let n=Math.round(t/60);if(n<60)return`${n}m`;let r=Math.round(n/60);return r<48?`${r}h`:`${Math.round(r/24)}d`}var iu=Qn({q:qn().optional().catch(``),tab:Xn([`policy`,`resources`,`costs`,`usage`]).optional().catch(`policy`)});const au=t(`/admin/governance`)({validateSearch:e=>iu.parse(e),loaderDeps:({search:{q:e,tab:t}})=>({q:e,tab:t}),loader:async({context:{queryClient:e}})=>{(await e.ensureQueryData({queryKey:H.session(),queryFn:Br,staleTime:3e4,retry:!1}))?.isAdmin&&await Promise.all([e.ensureQueryData({queryKey:H.governancePolicy(),queryFn:_o}),e.ensureQueryData({queryKey:H.governanceSummary(),queryFn:ro}),e.ensureQueryData({queryKey:H.governanceResources(`500`),queryFn:()=>io({limit:`500`})}),e.ensureQueryData({queryKey:H.governanceCosts(`50`),queryFn:()=>ao({limit:`50`})}),e.ensureQueryData({queryKey:H.governanceUsage(`500`),queryFn:()=>oo({limit:`500`})})])},component:ou});function ou(){let e=c(),t=au.useNavigate(),{q:n,tab:a}=au.useSearch(),o=!!i({queryKey:H.session(),queryFn:Br,staleTime:3e4,retry:!1}).data?.isAdmin,s=i({queryKey:H.governanceSummary(),queryFn:ro,staleTime:3e4,enabled:o}),l=i({queryKey:H.governancePolicy(),queryFn:_o,staleTime:3e4,enabled:o,retry:!1}),u=i({queryKey:H.governanceResources(`500`),queryFn:()=>io({limit:`500`}),staleTime:3e4,enabled:o}),d=i({queryKey:H.governanceCosts(`50`),queryFn:()=>ao({limit:`50`}),staleTime:3e4,enabled:o}),f=i({queryKey:H.governanceUsage(`500`),queryFn:()=>oo({limit:`500`}),staleTime:3e4,enabled:o}),p=f.data?.usage??[],m=(0,M.useMemo)(()=>{let e=new Map;for(let t of p){if(t.scopeType!==`cluster`)continue;let n=String(t.metric??``);if(!n)continue;let r=e.get(n);if(!r){e.set(n,t);continue}new Date(String(t.collectedAt)).getTime()>new Date(String(r.collectedAt)).getTime()&&e.set(n,t)}return e},[p]),h=(0,M.useMemo)(()=>{let e=new Map;for(let t of p){if(t.scopeType!==`user`)continue;let n=String(t.scopeId??``).trim();if(!n)continue;let r=String(t.metric??``).trim();if(!r)continue;let i=Number(t.value??0),a=String(t.collectedAt??``),o=e.get(n)??{user:n,deploymentsActive:0,deploymentsTotal:0,collectorsTotal:0,tasksRunning:0,lastSeenAt:a};switch(r){case`deployments.active`:o.deploymentsActive=i;break;case`deployments.total`:o.deploymentsTotal=i;break;case`collectors.total`:o.collectorsTotal=i;break;case`tasks.running`:o.tasksRunning=i;break;default:break}new Date(a).getTime()>new Date(o.lastSeenAt).getTime()&&(o.lastSeenAt=a),e.set(n,o)}return Array.from(e.values()).sort((e,t)=>t.deploymentsActive===e.deploymentsActive?t.tasksRunning===e.tasksRunning?e.user.localeCompare(t.user):t.tasksRunning-e.tasksRunning:t.deploymentsActive-e.deploymentsActive)},[p]),g=(0,M.useMemo)(()=>{let e=u.data?.resources??[],t=n?.trim().toLowerCase()||``;return t?e.filter(e=>[e.name,e.resourceId,e.resourceType,e.workspaceName,e.owner,e.provider].filter(Boolean).join(` `).toLowerCase().includes(t)):e},[u.data?.resources,n]),ee=r({mutationFn:async()=>{await so()},onSuccess:async()=>{j.success(`Governance sources synced`,{description:`Resource inventory updated.`}),await Promise.all([e.invalidateQueries({queryKey:H.governanceSummary()}),e.invalidateQueries({queryKey:H.governanceResources(`500`)}),e.invalidateQueries({queryKey:H.governanceCosts(`50`)}),e.invalidateQueries({queryKey:H.governanceUsage(`500`)})])},onError:e=>{j.error(`Failed to sync governance sources`,{description:e.message})}}),[_,v]=(0,M.useState)({maxDeploymentsPerUser:0,maxCollectorsPerUser:0,allowUserByosNetlabServers:!0,allowUserByosContainerlabServers:!0,allowUserExternalTemplateRepos:!0,allowCustomTemplateRepos:!0});(0,M.useEffect)(()=>{l.data?.policy&&v({maxDeploymentsPerUser:l.data.policy.maxDeploymentsPerUser??0,maxCollectorsPerUser:l.data.policy.maxCollectorsPerUser??0,allowUserByosNetlabServers:l.data.policy.allowUserByosNetlabServers??!0,allowUserByosContainerlabServers:l.data.policy.allowUserByosContainerlabServers??!0,allowUserExternalTemplateRepos:l.data.policy.allowUserExternalTemplateRepos??!0,allowCustomTemplateRepos:l.data.policy.allowCustomTemplateRepos??!0})},[l.data?.policy?.maxDeploymentsPerUser,l.data?.policy?.maxCollectorsPerUser,l.data?.policy?.allowUserByosNetlabServers,l.data?.policy?.allowUserByosContainerlabServers,l.data?.policy?.allowUserExternalTemplateRepos,l.data?.policy?.allowCustomTemplateRepos]);let te=r({mutationFn:async()=>vo({policy:{maxDeploymentsPerUser:Math.max(0,_.maxDeploymentsPerUser),maxCollectorsPerUser:Math.max(0,_.maxCollectorsPerUser),allowUserByosNetlabServers:!!_.allowUserByosNetlabServers,allowUserByosContainerlabServers:!!_.allowUserByosContainerlabServers,allowUserExternalTemplateRepos:!!_.allowUserExternalTemplateRepos,allowCustomTemplateRepos:!!_.allowCustomTemplateRepos}}),onSuccess:async()=>{j.success(`Governance policy saved`),await e.invalidateQueries({queryKey:H.governancePolicy()})},onError:e=>{j.error(`Failed to save governance policy`,{description:e.message})}}),ne=s.data,re=e=>{t({search:t=>({...t,q:e}),replace:!0})};return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(z,{children:`Governance`}),(0,P.jsx)(B,{children:`Admin-only guardrails, inventory, cost, and usage telemetry.`})]}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,disabled:ee.isPending||!o,onClick:()=>ee.mutate(),children:[(0,P.jsx)(Sn,{className:`mr-2 h-4 w-4 ${ee.isPending?`animate-spin`:``}`}),ee.isPending?`Syncing`:`Sync sources`]})]})})}),!o&&(0,P.jsx)(L,{variant:`danger`,children:(0,P.jsx)(V,{className:`pt-6`,children:(0,P.jsx)(`div`,{className:`text-center font-medium text-destructive`,children:`Admin access required.`})})}),(l.isError||s.isError||u.isError||d.isError||f.isError)&&(0,P.jsx)(L,{variant:`danger`,children:(0,P.jsx)(V,{className:`pt-6`,children:(0,P.jsx)(`div`,{className:`text-center font-medium`,children:`Failed to load governance data.`})})}),s.isLoading?(0,P.jsx)(lc,{children:[1,2,3,4].map(e=>(0,P.jsxs)(uc,{className:`h-32`,children:[(0,P.jsx)(U,{className:`h-4 w-24 mb-4`}),(0,P.jsx)(U,{className:`h-8 w-16`})]},e))}):(0,P.jsxs)(lc,{children:[(0,P.jsx)(dc,{title:`Resources tracked`,value:String(ne?.resourceCount??``),icon:(0,P.jsx)(Ie,{className:`h-5 w-5`}),gradient:`blue`}),(0,P.jsx)(dc,{title:`Active resources`,value:String(ne?.activeResources??``),icon:(0,P.jsx)(Cn,{className:`h-5 w-5`}),gradient:`green`}),(0,P.jsx)(dc,{title:`Workspaces tracked`,value:String(ne?.workspacesTracked??``),icon:(0,P.jsx)(Rt,{className:`h-5 w-5`}),gradient:`purple`}),(0,P.jsx)(dc,{title:`Last 30d spend`,value:ne?`${ne.costLast30Days} ${ne.costCurrency}`:``,icon:(0,P.jsx)(je,{className:`h-5 w-5`}),gradient:`orange`})]}),(0,P.jsxs)(Bc,{value:a,onValueChange:e=>{t({search:t=>({...t,tab:e}),replace:!0})},className:`space-y-6`,children:[(0,P.jsxs)(Vc,{children:[(0,P.jsxs)(Hc,{value:`policy`,className:`gap-2`,children:[(0,P.jsx)(kn,{className:`h-4 w-4`}),`Policy`]}),(0,P.jsxs)(Hc,{value:`resources`,className:`gap-2`,children:[(0,P.jsx)(Ie,{className:`h-4 w-4`}),`Resources`]}),(0,P.jsxs)(Hc,{value:`costs`,className:`gap-2`,children:[(0,P.jsx)(w,{className:`h-4 w-4`}),`Financials`]}),(0,P.jsxs)(Hc,{value:`usage`,className:`gap-2`,children:[(0,P.jsx)(be,{className:`h-4 w-4`}),`Telemetry`]})]}),(0,P.jsx)(Uc,{value:`policy`,className:`space-y-6 animate-in fade-in-50`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Policy`}),(0,P.jsx)(B,{children:`Optional guardrails. Use 0 for unlimited.`})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Max deployments per user`}),(0,P.jsx)(K,{inputMode:`numeric`,value:String(_.maxDeploymentsPerUser),onChange:e=>v(t=>({...t,maxDeploymentsPerUser:Number.parseInt(e.target.value||`0`,10)||0}))}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Applies when creating new deployment definitions.`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Max collectors per user`}),(0,P.jsx)(K,{inputMode:`numeric`,value:String(_.maxCollectorsPerUser),onChange:e=>v(t=>({...t,maxCollectorsPerUser:Number.parseInt(e.target.value||`0`,10)||0}))}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Applies when creating in-cluster Forward collectors.`})]})]}),(0,P.jsxs)(`div`,{className:`rounded-md border p-3 space-y-3`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Feature access`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Global toggles for user-scoped integrations. Admin users are not restricted by these flags.`}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`User BYOS Netlab servers`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:"Allows using user-scoped Netlab BYOS servers (serverRef = `user:...`)."})]}),(0,P.jsx)(Nc,{checked:_.allowUserByosNetlabServers,onCheckedChange:e=>v(t=>({...t,allowUserByosNetlabServers:!!e})),disabled:!o})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`User BYOS Containerlab servers`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:"Allows using user-scoped Containerlab BYOS servers (serverRef = `user:...`)."})]}),(0,P.jsx)(Nc,{checked:_.allowUserByosContainerlabServers,onCheckedChange:e=>v(t=>({...t,allowUserByosContainerlabServers:!!e})),disabled:!o})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`User external template repos`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:"Allows `templateSource=external` using repos configured in user settings."})]}),(0,P.jsx)(Nc,{checked:_.allowUserExternalTemplateRepos,onCheckedChange:e=>v(t=>({...t,allowUserExternalTemplateRepos:!!e})),disabled:!o})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Custom template repos`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:"Allows `templateSource=custom`. Keep disabled unless you trust users to reference safe repos."})]}),(0,P.jsx)(Nc,{checked:_.allowCustomTemplateRepos,onCheckedChange:e=>v(t=>({...t,allowCustomTemplateRepos:!!e})),disabled:!o})]})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:l.data?.retrievedAt?`Loaded ${l.data.retrievedAt}`:``}),(0,P.jsx)(F,{onClick:()=>te.mutate(),disabled:te.isPending||!o,children:te.isPending?`Saving`:`Save policy`})]})]})]})}),(0,P.jsx)(Uc,{value:`resources`,className:`space-y-6 animate-in fade-in-50`,children:(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,P.jsx)(z,{children:`Resource Inventory`}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(`div`,{className:`relative`,children:[(0,P.jsx)(k,{className:`absolute left-2 top-2.5 h-4 w-4 text-muted-foreground`}),(0,P.jsx)(K,{className:`pl-8 w-full sm:w-[300px]`,placeholder:`Search resources`,value:n||``,onChange:e=>re(e.target.value)})]}),!u.isLoading&&(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground whitespace-nowrap hidden sm:block`,children:[g.length,` shown`]})]})]})}),(0,P.jsx)(V,{children:u.isLoading?(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsx)(U,{className:`h-10 w-full`}),(0,P.jsx)(U,{className:`h-10 w-full`}),(0,P.jsx)(U,{className:`h-10 w-full`})]}):g.length===0?(0,P.jsx)(ec,{icon:kn,title:`No resources found`,description:`No resources match your search criteria.`}):(0,P.jsx)($s,{columns:[{id:`name`,header:`Name`,width:`minmax(220px, 1fr)`,cell:e=>(0,P.jsx)(`span`,{className:`font-medium`,children:e.name})},{id:`provider`,header:`Provider`,width:140,cell:e=>e.provider},{id:`type`,header:`Type`,width:160,cell:e=>e.resourceType},{id:`workspace`,header:`Workspace`,width:200,cell:e=>e.workspaceName},{id:`owner`,header:`Owner`,width:160,cell:e=>e.owner},{id:`status`,header:`Status`,width:120,cell:e=>(0,P.jsx)(W,{variant:e.status===`active`?`default`:`secondary`,children:e.status??`unknown`})}],rows:g.slice(0,500),getRowId:e=>String(e.resourceId),maxHeightClassName:`max-h-[60vh]`,minWidthClassName:`min-w-[1100px]`})})]})}),(0,P.jsx)(Uc,{value:`costs`,className:`space-y-6 animate-in fade-in-50`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Cost Snapshots`}),(0,P.jsx)(B,{children:`Historical spend data per provider.`})]}),(0,P.jsx)(V,{children:d.isLoading?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(U,{className:`h-12 w-full`}),(0,P.jsx)(U,{className:`h-12 w-full`})]}):(d.data?.costs??[]).length===0?(0,P.jsx)(ec,{icon:w,title:`No cost data`,description:`No financial snapshots available.`}):(0,P.jsx)($s,{columns:[{id:`provider`,header:`Provider`,width:180,cell:e=>(0,P.jsx)(`span`,{className:`font-medium`,children:e.provider})},{id:`currency`,header:`Currency`,width:120,cell:e=>e.currency},{id:`amount`,header:`Amount`,width:140,cell:e=>e.amount},{id:`periodEnd`,header:`Period End`,width:200,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:e.periodEnd})}],rows:(d.data?.costs??[]).slice(0,50),getRowId:e=>`${e.provider}:${e.periodEnd}:${e.amount}`,maxHeightClassName:`max-h-[50vh]`,minWidthClassName:`min-w-[900px]`})})]})}),(0,P.jsx)(Uc,{value:`usage`,className:`space-y-6 animate-in fade-in-50`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Usage Telemetry`}),(0,P.jsx)(B,{children:`Lightweight snapshots of cluster load and user activity (no Prometheus).`})]}),(0,P.jsx)(V,{children:f.isLoading?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(U,{className:`h-12 w-full`}),(0,P.jsx)(U,{className:`h-12 w-full`})]}):(f.data?.usage??[]).length===0?(0,P.jsx)(ec,{icon:be,title:`No usage data`,description:`No telemetry snapshots available.`}):(0,P.jsxs)(`div`,{className:`space-y-6`,children:[(0,P.jsxs)(lc,{children:[(0,P.jsx)(dc,{title:`CPU p95`,value:m.get(`node.cpu_active.p95`)?.value??``,subtitle:`Last snapshot`,icon:(0,P.jsx)(Cn,{className:`h-4 w-4`})}),(0,P.jsx)(dc,{title:`Mem p95`,value:m.get(`node.mem_used.p95`)?.value??``,subtitle:`Last snapshot`,icon:(0,P.jsx)(Rt,{className:`h-4 w-4`})}),(0,P.jsx)(dc,{title:`Disk p95`,value:m.get(`node.disk_used.p95`)?.value??``,subtitle:`Last snapshot`,icon:(0,P.jsx)(Ie,{className:`h-4 w-4`})}),(0,P.jsx)(dc,{title:`Active users (24h)`,value:m.get(`users.active_24h`)?.value??``,subtitle:`Distinct users`,icon:(0,P.jsx)(kn,{className:`h-4 w-4`})}),(0,P.jsx)(dc,{title:`Active deployments`,value:m.get(`deployments.active`)?.value??``,subtitle:`Last snapshot`,icon:(0,P.jsx)(Cn,{className:`h-4 w-4`}),gradient:`green`}),(0,P.jsx)(dc,{title:`Queued tasks`,value:m.get(`tasks.queued`)?.value??``,subtitle:`Oldest: ${ru(m.get(`tasks.oldest_queued_age_seconds`)?.value)}`,icon:(0,P.jsx)(Vn,{className:`h-4 w-4`}),gradient:`orange`}),(0,P.jsx)(dc,{title:`Pods`,value:m.get(`k8s.pods.total`)?.value??``,subtitle:`Pending: ${m.get(`k8s.pods.pending`)?.value??``}`,icon:(0,P.jsx)(lt,{className:`h-4 w-4`}),gradient:`purple`}),(0,P.jsx)(dc,{title:`Workspace pods`,value:m.get(`k8s.pods.ws.total`)?.value??``,subtitle:`Pending: ${m.get(`k8s.pods.ws.pending`)?.value??``}`,icon:(0,P.jsx)(lt,{className:`h-4 w-4`}),gradient:`purple`}),(0,P.jsx)(dc,{title:`Workspace namespaces`,value:m.get(`k8s.namespaces.ws`)?.value??``,subtitle:`All namespaces: ${m.get(`k8s.namespaces.total`)?.value??``}`,icon:(0,P.jsx)(lt,{className:`h-4 w-4`}),gradient:`purple`})]}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{className:`text-base`,children:`Top Users`}),(0,P.jsx)(B,{children:`Latest per-user activity snapshots (sorted by active deployments).`})]}),(0,P.jsx)(V,{children:h.length===0?(0,P.jsx)(ec,{icon:be,title:`No user activity`,description:`No per-user snapshots available yet.`}):(0,P.jsx)($s,{columns:[{id:`user`,header:`User`,width:240,cell:e=>(0,P.jsx)(`span`,{className:`font-medium`,children:e.user})},{id:`deploymentsActive`,header:`Active Deployments`,width:180,cell:e=>e.deploymentsActive},{id:`tasksRunning`,header:`Running Tasks`,width:160,cell:e=>e.tasksRunning},{id:`collectorsTotal`,header:`Collectors`,width:140,cell:e=>e.collectorsTotal},{id:`deploymentsTotal`,header:`Total Deployments`,width:170,cell:e=>e.deploymentsTotal},{id:`lastSeenAt`,header:`Last Updated`,align:`right`,width:220,cell:e=>(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:e.lastSeenAt})}],rows:h.slice(0,50),getRowId:e=>e.user,maxHeightClassName:`max-h-[45vh]`,minWidthClassName:`min-w-[1000px]`})})]}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{className:`text-base`,children:`Raw Snapshots`}),(0,P.jsx)(B,{children:`Most recent usage snapshot records (for debugging).`})]}),(0,P.jsx)(V,{children:(0,P.jsx)($s,{columns:[{id:`scope`,header:`Scope`,width:180,cell:e=>e.scopeType===`user`?`user:${e.scopeId??``}`:e.scopeType},{id:`metric`,header:`Metric`,cell:e=>e.metric},{id:`value`,header:`Value`,width:160,cell:e=>typeof e.value==`number`?e.value:String(e.value)},{id:`collectedAt`,header:`Collected At`,width:220,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:e.collectedAt})}],rows:(f.data?.usage??[]).slice(0,200),getRowId:e=>`${e.provider}:${e.scopeType}:${e.scopeId??``}:${e.metric}:${e.collectedAt}`,maxHeightClassName:`max-h-[50vh]`,minWidthClassName:`min-w-[900px]`})})]})]})})]})})]})]})}const su=t(`/dashboard/workspaces/`)({component:cu});function cu(){let e=n(),t=c(),[a,o]=(0,M.useState)(!1),[s,l]=(0,M.useState)(``),[u,d]=(0,M.useState)(``),f=i({queryKey:H.workspaces(),queryFn:Hr,staleTime:3e4}).data?.workspaces??[],m=r({mutationFn:async()=>{let e=String(s??``).trim();if(!e)throw Error(`Workspace name is required`);return Ra({name:e,slug:String(u??``).trim()||void 0})},onSuccess:async n=>{j.success(`Workspace created`),o(!1),l(``),d(``),await t.invalidateQueries({queryKey:H.workspaces()}),n?.id&&e({to:`/dashboard/workspaces/$workspaceId`,params:{workspaceId:n.id}})},onError:e=>j.error(`Failed to create workspace`,{description:e.message})});return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between border-b pb-6`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Workspaces`}),(0,P.jsx)(`p`,{className:`text-muted-foreground text-sm`,children:`Manage workspace access (owners/editors/viewers).`})]}),(0,P.jsx)(F,{onClick:()=>o(!0),size:`sm`,children:`Add workspace`})]}),f.length===0?(0,P.jsx)(ec,{title:`No workspaces`,description:`Create a deployment to generate a workspace, or ask an admin to add you.`,icon:T}):(0,P.jsx)(`div`,{className:`grid gap-4 md:grid-cols-2 lg:grid-cols-3`,children:f.map(e=>(0,P.jsxs)(L,{className:`hover:border-foreground/20 transition-colors`,children:[(0,P.jsx)(R,{className:`pb-3`,children:(0,P.jsxs)(z,{className:`flex items-center justify-between gap-2 text-base`,children:[(0,P.jsx)(`span`,{className:`truncate`,children:e.name}),(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.slug})]})}),(0,P.jsx)(V,{className:`pt-0`,children:(0,P.jsx)(p,{to:`/dashboard/workspaces/$workspaceId`,params:{workspaceId:e.id},className:`text-sm text-primary underline hover:no-underline`,children:`Manage access`})})]},e.id))}),(0,P.jsx)(tr,{open:a,onOpenChange:o,children:(0,P.jsxs)(ir,{className:`max-w-lg`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Create workspace`}),(0,P.jsx)(cr,{children:`Create a new workspace and its backing Git repo.`})]}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1.5`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Name`}),(0,P.jsx)(K,{value:s,onChange:e=>l(e.target.value),placeholder:`Customer demo`})]}),(0,P.jsxs)(`div`,{className:`space-y-1.5`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Slug (optional)`}),(0,P.jsx)(K,{value:u,onChange:e=>d(e.target.value),placeholder:`customer-demo`}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Leave blank to auto-generate from name.`})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-end gap-2 pt-2`,children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>o(!1),disabled:m.isPending,children:`Cancel`}),(0,P.jsx)(F,{onClick:()=>m.mutate(),disabled:m.isPending,children:m.isPending?`Creating`:`Create`})]})]})]})})]})}function lu(e){let t=c(),n=(0,M.useMemo)(()=>`${Ir}/dashboard/events`,[]);(0,M.useEffect)(()=>{if(!e)return;let r=Ks(n,{snapshot:e=>{try{let n=JSON.parse(e.data);t.setQueryData(H.dashboardSnapshot(),n)}catch{}}});return()=>{r.close()}},[e,t,n])}const uu=t(`/dashboard/runs/`)({component:du});function du(){lu(!0);let e=c(),t=i({queryKey:H.dashboardSnapshot(),queryFn:Ur,initialData:()=>e.getQueryData(H.dashboardSnapshot())??null,retry:!1,staleTime:1/0}),n=t.data?.runs??[],[r,a]=(0,M.useState)(``),o=(0,M.useMemo)(()=>{let e=r.trim().toLowerCase();return e?n.filter(t=>JSON.stringify(t).toLowerCase().includes(e)):n},[r,n]);return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Runs`}),(0,P.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Recent task runs across all deployments.`})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(K,{placeholder:`Filter runs`,value:r,onChange:e=>a(e.target.value)}),(0,P.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[o.length,` shown`]})]}),t.data?o.length===0?(0,P.jsx)(L,{className:`border-dashed`,children:(0,P.jsx)(V,{className:`pt-6 text-sm text-muted-foreground`,children:`No runs match your filter.`})}):(0,P.jsx)(`div`,{className:`space-y-3`,children:o.map(e=>{let t=String(e.id??``),n=String(e.status??``),r=String(e.workspaceId??``),i=String(e.tpl_alias??e.type??``),a=String(e.created??``),o=String(e.start??``),s=String(e.end??``);return(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(z,{className:`truncate`,children:(0,P.jsxs)(p,{className:`underline`,to:`/dashboard/runs/$runId`,params:{runId:t},children:[`Run `,t]})}),(0,P.jsxs)(B,{className:`truncate`,children:[i||`run`,`  ws `,r||``]})]}),(0,P.jsx)(W,{variant:fu(n),children:n||`unknown`})]})}),(0,P.jsxs)(V,{className:`grid gap-2 text-sm text-muted-foreground md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`truncate`,children:[`Created: `,a||``]}),(0,P.jsxs)(`div`,{className:`truncate`,children:[`Started: `,o||``]}),(0,P.jsxs)(`div`,{className:`truncate`,children:[`Finished: `,s||``]})]})]},t)})}):(0,P.jsx)(L,{className:`border-dashed`,children:(0,P.jsx)(V,{className:`pt-6 text-sm text-muted-foreground`,children:`Loading dashboard`})})]})}function fu(e){let t=e.toLowerCase();return t===`success`||t===`succeeded`||t===`complete`?`default`:t===`failed`||t===`error`?`destructive`:t===`running`?`default`:`secondary`}var pu=Qn({workspace:qn().optional().catch(``)});const mu=t(`/dashboard/forward-networks/`)({validateSearch:e=>pu.parse(e),loaderDeps:({search:{workspace:e}})=>({workspace:e}),loader:async({context:{queryClient:e}})=>{await e.ensureQueryData({queryKey:H.workspaces(),queryFn:Hr,staleTime:3e4})},component:hu});function hu(){let e=n(),t=c(),{workspace:a}=mu.useSearch(),o=i({queryKey:H.workspaces(),queryFn:Hr,staleTime:3e4,retry:!1}),s=(0,M.useMemo)(()=>o.data?.workspaces??[],[o.data?.workspaces]),[l,u]=(0,M.useState)(String(a??``));(0,M.useEffect)(()=>{l||s.length!==0&&u(String(s[0]?.id??``))},[l,s]),(0,M.useEffect)(()=>{let e=String(a??``);e!==l&&u(e)},[a,l]);let d=t=>{e({search:{workspace:t===`__none__`?``:t},replace:!0})},f=i({queryKey:H.workspaceForwardNetworks(l),queryFn:()=>Uo(l),enabled:!!l,staleTime:1e4,retry:!1}),m=(0,M.useMemo)(()=>f.data?.networks??[],[f.data?.networks]),h=i({queryKey:H.workspaceForwardNetworkCapacityPortfolio(l),queryFn:()=>aa(l),enabled:!!l,staleTime:1e4,retry:!1}),g=(0,M.useMemo)(()=>h.data?.items??[],[h.data?.items]),ee=i({queryKey:H.userForwardCollectorConfigs(),queryFn:Wa,staleTime:3e4,retry:!1}),_=(0,M.useMemo)(()=>ee.data?.collectors??[],[ee.data?.collectors]),[v,te]=(0,M.useState)(``),[ne,re]=(0,M.useState)(``),[ie,ae]=(0,M.useState)(``),[y,b]=(0,M.useState)(`__default__`),x=r({mutationFn:async()=>{let e=l.trim();if(!e)throw Error(`Select a workspace`);let t=v.trim(),n=ne.trim();if(!t)throw Error(`Name is required`);if(!n)throw Error(`Forward Network ID is required`);return Ho(e,{name:t,forwardNetworkId:n,description:ie.trim()||void 0,collectorConfigId:y&&y!==`__default__`?y:void 0})},onSuccess:async()=>{j.success(`Forward network saved`),te(``),re(``),ae(``),b(`__default__`),await t.invalidateQueries({queryKey:H.workspaceForwardNetworks(l)})},onError:e=>j.error(`Failed to save network`,{description:e.message})}),S=r({mutationFn:async e=>{let t=l.trim();if(!t)throw Error(`Select a workspace`);return Wo(t,e)},onSuccess:async()=>{j.success(`Forward network deleted`),await t.invalidateQueries({queryKey:H.workspaceForwardNetworks(l)})},onError:e=>j.error(`Failed to delete network`,{description:e.message})});return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between border-b pb-6`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Forward Networks`}),(0,P.jsx)(`p`,{className:`text-muted-foreground text-sm`,children:`Save one or more Forward Network IDs per workspace, then open Capacity views against them.`})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(`div`,{className:`flex items-center gap-2 bg-muted/50 p-1 rounded-lg border`,children:(0,P.jsxs)(q,{value:l||`__none__`,onValueChange:d,children:[(0,P.jsx)(Y,{className:`w-[240px] h-8 bg-transparent border-0 focus:ring-0 shadow-none`,children:(0,P.jsx)(J,{placeholder:`Select workspace`})}),(0,P.jsx)(X,{children:s.map(e=>(0,P.jsxs)(Z,{value:e.id,children:[e.name,` (`,e.slug,`)`]},e.id))})]})}),(0,P.jsx)(F,{variant:`outline`,size:`icon`,className:`h-8 w-8`,disabled:!l,onClick:()=>{l&&e({to:`/dashboard/workspaces/$workspaceId`,params:{workspaceId:l}})},children:(0,P.jsx)(ut,{className:`h-4 w-4`})})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Add Forward network`}),(0,P.jsx)(B,{children:`These networks are used as the scope for capacity rollups and live perf drilldowns.`})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Name`}),(0,P.jsx)(K,{value:v,onChange:e=>te(e.target.value),placeholder:`prod-edge`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Forward Network ID`}),(0,P.jsx)(K,{value:ne,onChange:e=>re(e.target.value),placeholder:`abc123...`})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Description (optional)`}),(0,P.jsx)(K,{value:ie,onChange:e=>ae(e.target.value),placeholder:`Notes for humans`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(G,{children:`Forward collector config (optional)`}),(0,P.jsxs)(q,{value:y,onValueChange:e=>b(e),children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Use my default Forward config`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`__default__`,children:`Use my default`}),_.map(e=>(0,P.jsx)(Z,{value:String(e.id),children:String(e.name??e.id)},String(e.id)))]})]})]}),(0,P.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,P.jsxs)(F,{onClick:()=>x.mutate(),disabled:!l||x.isPending,children:[(0,P.jsx)(gn,{className:`h-4 w-4 mr-2`}),`Save network`]})})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Saved networks`}),(0,P.jsx)(B,{children:`Open Capacity to compute rollups and explore inventory/perf data.`})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[m.length===0?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No saved networks yet.`}):null,m.map(e=>(0,P.jsxs)(`div`,{className:`flex flex-col md:flex-row md:items-center md:justify-between gap-3 rounded-lg border p-3`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(`div`,{className:`font-medium truncate`,children:e.name}),(0,P.jsxs)(`div`,{className:`text-sm text-muted-foreground truncate`,children:[(0,P.jsx)(`span`,{className:`font-mono`,children:e.forwardNetworkId}),e.description?`  ${e.description}`:``]})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{asChild:!0,variant:`outline`,size:`sm`,children:(0,P.jsx)(p,{to:`/dashboard/forward-networks/$networkRef/capacity`,params:{networkRef:e.id},search:{workspace:l},children:`Capacity`})}),(0,P.jsx)(F,{asChild:!0,variant:`outline`,size:`sm`,children:(0,P.jsx)(p,{to:`/dashboard/forward-networks/$networkRef/assurance-studio`,params:{networkRef:e.id},search:{workspace:l},children:`Assurance Studio`})}),(0,P.jsx)(F,{asChild:!0,variant:`outline`,size:`sm`,children:(0,P.jsx)(p,{to:`/dashboard/forward-networks/$networkRef/assurance`,params:{networkRef:e.id},search:{workspace:l},children:`Assurance`})}),(0,P.jsx)(F,{asChild:!0,variant:`outline`,size:`sm`,children:(0,P.jsx)(p,{to:`/dashboard/forward-networks/$networkRef/traffic-scenarios`,params:{networkRef:e.id},search:{workspace:l},children:`Traffic Scenarios`})}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>S.mutate(e.id),disabled:S.isPending,children:[(0,P.jsx)(tt,{className:`h-4 w-4 mr-2`}),`Delete`]})]})]},e.id))]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Capacity portfolio`}),(0,P.jsx)(B,{children:`Quick cross-network view (util_* max >= 85%).`})]}),(0,P.jsx)(V,{className:`space-y-3`,children:l?h.isLoading?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading`}):h.isError?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Unable to load portfolio.`}):g.length===0?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No portfolio data yet. Save a network and run a Capacity refresh.`}):(0,P.jsx)(`div`,{className:`overflow-x-auto`,children:(0,P.jsxs)(`table`,{className:`w-full text-sm`,children:[(0,P.jsx)(`thead`,{className:`text-xs text-muted-foreground`,children:(0,P.jsxs)(`tr`,{className:`text-left border-b`,children:[(0,P.jsx)(`th`,{className:`py-2 pr-3`,children:`Network`}),(0,P.jsx)(`th`,{className:`py-2 pr-3`,children:`As of`}),(0,P.jsx)(`th`,{className:`py-2 pr-3`,children:`Hot ifaces`}),(0,P.jsx)(`th`,{className:`py-2 pr-3`,children:`Soonest`}),(0,P.jsx)(`th`,{className:`py-2 pr-3`,children:`Max max`}),(0,P.jsx)(`th`,{className:`py-2 pr-3`,children:`Max p95`})]})}),(0,P.jsx)(`tbody`,{children:g.map(e=>{let t=String(e.asOf??``).trim()||``,n=String(e.soonestForecast??``).trim()||``,r=e=>{let t=Number(e);return Number.isFinite(t)?`${(t*100).toFixed(1)}%`:``};return(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsxs)(`td`,{className:`py-2 pr-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{asChild:!0,variant:`link`,className:`p-0 h-auto`,children:(0,P.jsx)(p,{to:`/dashboard/forward-networks/$networkRef/capacity`,params:{networkRef:String(e.networkRef)},search:{workspace:l},children:String(e.name??e.networkRef)})}),e.stale?(0,P.jsx)(W,{variant:`destructive`,children:`Stale`}):(0,P.jsx)(W,{variant:`secondary`,children:`Fresh`})]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:String(e.forwardNetworkId??``)})]}),(0,P.jsx)(`td`,{className:`py-2 pr-3 font-mono text-xs`,children:t}),(0,P.jsx)(`td`,{className:`py-2 pr-3`,children:Number(e.hotInterfaces??0)}),(0,P.jsx)(`td`,{className:`py-2 pr-3 font-mono text-xs`,children:n}),(0,P.jsx)(`td`,{className:`py-2 pr-3`,children:r(e.maxUtilMax)}),(0,P.jsx)(`td`,{className:`py-2 pr-3`,children:r(e.maxUtilP95)})]},String(e.networkRef))})})]})}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Select a workspace to see portfolio rollups.`})})]})]})}var gu=[{slug:`getting-started`,title:`Getting started`,description:`First-time flow: configure settings, select templates, deploy.`,tags:[`start`,`deployments`,`settings`]},{slug:`my-settings`,title:`My Settings`,description:`Per-user defaults, external repos, BYOL servers, credentials.`,tags:[`settings`,`repos`,`byol`,`cloud`]},{slug:`deployments`,title:`Deployments`,description:`Create deployments, validate templates, and understand statuses.`,tags:[`deployments`,`templates`,`validate`]},{slug:`servicenow`,title:`ServiceNow demo workflow`,description:`Install and configure the Forward Connectivity Ticket demo into a ServiceNow PDI.`,tags:[`servicenow`,`forward`,`workflow`]},{slug:`ai-templates`,title:`AI templates (Gemini)`,description:`Generate Netlab/Containerlab templates from a prompt using your connected Gemini account.`,tags:[`ai`,`gemini`,`netlab`,`containerlab`]}];const _u=t(`/dashboard/docs/`)({component:vu});function vu(){let[e,t]=(0,M.useState)(``),n=(0,M.useMemo)(()=>{let t=e.trim().toLowerCase();return t?gu.filter(e=>`${e.title} ${e.description} ${e.tags.join(` `)}`.toLowerCase().includes(t)):gu},[e]);return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsx)(R,{children:(0,P.jsxs)(z,{className:`flex items-center gap-2`,children:[(0,P.jsx)(ft,{className:`h-5 w-5`}),`Docs & Workflows`]})}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Practical guides for first-time users and repeatable workflows.`}),(0,P.jsx)(K,{placeholder:`Search docs`,value:e,onChange:e=>t(e.target.value)})]})]}),(0,P.jsx)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:n.map(e=>(0,P.jsx)(p,{to:`/dashboard/docs/$slug`,params:{slug:e.slug},className:`group`,children:(0,P.jsxs)(L,{className:`h-full transition-colors hover:bg-accent/40`,children:[(0,P.jsx)(R,{children:(0,P.jsxs)(z,{className:`flex items-center justify-between gap-2 text-base`,children:[(0,P.jsx)(`span`,{className:`truncate`,children:e.title}),(0,P.jsx)(rt,{className:`h-4 w-4 text-muted-foreground group-hover:text-foreground`})]})}),(0,P.jsxs)(V,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:e.description}),(0,P.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:e.tags.slice(0,4).map(e=>(0,P.jsx)(`span`,{className:`rounded border px-2 py-0.5 text-[10px] text-muted-foreground`,children:e},e))})]})]})},e.slug))})]})}var yu=Qn({workspace:qn().optional().catch(``)});const bu=t(`/dashboard/deployments/`)({validateSearch:e=>yu.parse(e),loaderDeps:({search:{workspace:e}})=>({workspace:e}),loader:async({context:{queryClient:e}})=>{await e.ensureQueryData({queryKey:H.workspaces(),queryFn:Hr,staleTime:3e4})},component:xu});function xu(){lu(!0);let e=n(),t=c(),{workspace:a}=bu.useSearch(),o=i({queryKey:H.dashboardSnapshot(),queryFn:Ur,initialData:()=>t.getQueryData(H.dashboardSnapshot())??null,retry:!1,staleTime:1/0}),[s,l]=(0,M.useState)(null),[u,d]=(0,M.useState)(!1),[f,m]=(0,M.useState)(!1);i({queryKey:H.session(),queryFn:Br,staleTime:3e4,retry:!1});let[h,g]=(0,M.useState)(``),[ee,_]=(0,M.useState)(`all`),[v,te]=(0,M.useState)(`all`),[ne,re]=(0,M.useState)(!0),[ie,ae]=(0,M.useState)(!1),[y,b]=(0,M.useState)(``),[x,S]=(0,M.useState)(``),[oe,se]=(0,M.useState)(!1),[ce,le]=(0,M.useState)(``),C=i({queryKey:H.workspaces(),queryFn:Hr,staleTime:3e4}).data?.workspaces??[],ue=`skyforge.lastWorkspaceId.deployments`,w=(0,M.useMemo)(()=>{if(a&&C.some(e=>e.id===a))return a;let e=typeof window<`u`?window.localStorage.getItem(ue)??``:``;return e&&C.some(t=>t.id===e)?e:C[0]?.id??``},[a,C]);(0,M.useEffect)(()=>{w&&(typeof window<`u`&&window.localStorage.setItem(ue,w),a!==w&&e({search:{workspace:w},replace:!0}))},[w]);let de=(0,M.useMemo)(()=>C.find(e=>e.id===w)??null,[C,w]),E=r({mutationFn:async()=>{let e=String(y??``).trim();if(!e)throw Error(`Workspace name is required`);return Ra({name:e,slug:String(x??``).trim()||void 0})},onSuccess:async n=>{j.success(`Workspace created`),ae(!1),b(``),S(``),await t.invalidateQueries({queryKey:H.workspaces()}),n?.id&&e({search:{workspace:n.id},replace:!0})},onError:e=>j.error(`Failed to create workspace`,{description:e.message})}),pe=r({mutationFn:async()=>{let e=String(ce??``).trim();if(!e)throw Error(`Type the workspace slug (${de?.slug??``}) to confirm`);return Ua(w,{confirm:e})},onSuccess:async()=>{j.success(`Workspace deleted`),se(!1),le(``),await t.invalidateQueries({queryKey:H.workspaces()}),e({search:{workspace:``},replace:!0})},onError:e=>j.error(`Failed to delete workspace`,{description:e.message})}),me=t=>{if(t===`__create__`){ae(!0);return}typeof window<`u`&&window.localStorage.setItem(ue,t),e({search:{workspace:t},replace:!0})},he=(0,M.useMemo)(()=>{let e=o.data?.deployments??[];return w?e.filter(e=>e.workspaceId===w):e},[w,o.data?.deployments]),ge=(0,M.useMemo)(()=>he.filter(e=>{if(h&&!e.name.toLowerCase().includes(h.toLowerCase()))return!1;if(ee!==`all`){let t=(e.activeTaskStatus??e.lastStatus??`unknown`).toLowerCase();if(ee===`running`&&![`running`,`active`,`healthy`].includes(t)||ee===`stopped`&&![`created`,`stopped`,`success`,`succeeded`,`ready`].includes(t)||ee===`failed`&&![`failed`,`error`,`crashloopbackoff`].includes(t))return!1}return!(v!==`all`&&(v===`netlab`&&!e.type.startsWith(`netlab`)||v===`containerlab`&&![`containerlab`,`clabernetes`].includes(e.type)||v===`terraform`&&e.type!==`terraform`))}),[he,h,ee,v]),_e=async e=>{try{await yo(e.workspaceId,e.id),j.success(`Deployment starting`,{description:`${e.name} is queued to start.`})}catch(e){j.error(`Failed to start`,{description:e.message})}},ve=async e=>{try{await bo(e.workspaceId,e.id),j.success(`Deployment stopping`,{description:`${e.name} is queued to stop.`})}catch(e){j.error(`Failed to stop`,{description:e.message})}},ye=(0,M.useMemo)(()=>[{id:`name`,header:`Name`,width:`minmax(240px, 1fr)`,cell:e=>(0,P.jsx)(p,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e.id},className:`hover:underline flex items-center gap-2 font-medium text-foreground`,children:e.name})},{id:`type`,header:`Type`,width:160,cell:e=>(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:D(e.type)})},{id:`status`,header:`Status`,width:150,cell:e=>(0,P.jsx)(Su,{status:e.activeTaskStatus??e.lastStatus??`unknown`})},{id:`actions`,header:`Actions`,width:120,align:`right`,cell:t=>{let n=(t.activeTaskStatus??t.lastStatus??`unknown`).toLowerCase(),r=[`running`,`active`,`healthy`].includes(n),i=!!t.activeTaskId;return(0,P.jsxs)(wr,{children:[(0,P.jsx)(Tr,{asChild:!0,children:(0,P.jsxs)(F,{variant:`ghost`,size:`icon`,className:`h-8 w-8`,children:[(0,P.jsx)(Ut,{className:`h-4 w-4`}),(0,P.jsx)(`span`,{className:`sr-only`,children:`Open menu`})]})}),(0,P.jsxs)(Or,{align:`end`,children:[(0,P.jsx)(Mr,{children:`Actions`}),(0,P.jsxs)(kr,{onClick:()=>e({to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:t.id}}),children:[(0,P.jsx)(mt,{className:`mr-2 h-4 w-4`}),`Details`]}),(0,P.jsx)(Nr,{}),(0,P.jsxs)(kr,{onClick:()=>_e(t),disabled:i||r,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),`Start`]}),(0,P.jsxs)(kr,{onClick:()=>ve(t),disabled:i||!r,children:[(0,P.jsx)(et,{className:`mr-2 h-4 w-4`}),`Stop`]}),(0,P.jsx)(Nr,{}),(0,P.jsxs)(kr,{onClick:()=>{l(t),d(!0)},className:`text-destructive focus:text-destructive`,disabled:i,children:[(0,P.jsx)(tt,{className:`mr-2 h-4 w-4`}),`Delete`]})]})]})}}],[_e,ve,e]),be=(0,M.useMemo)(()=>{let e=o.data?.runs??[];return w?e.filter(e=>String(e.workspaceId??``)===w):e},[w,o.data?.runs]),xe=Lr(window.location.pathname+window.location.search),Se=async()=>{if(s)try{await xo(s.workspaceId,s.id,{forwardDelete:f}),j.success(`Deployment deleted`,{description:`${s.name} has been removed.`}),await t.invalidateQueries({queryKey:H.dashboardSnapshot()}),d(!1),l(null),m(!1)}catch(e){j.error(`Failed to delete`,{description:e.message})}},D=e=>{switch(e){case`netlab`:return`Netlab (BYOS)`;case`netlab-c9s`:return`Netlab`;case`containerlab`:return`Containerlab (BYOS)`;case`clabernetes`:return`Containerlab`;default:return e}},Ce=!!s?.config?.forwardNetworkId;return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between border-b pb-6`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Deployments`}),(0,P.jsx)(`p`,{className:`text-muted-foreground text-sm`,children:`Manage deployments and monitor activity.`})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(`div`,{className:`flex items-center gap-2 bg-muted/50 p-1 rounded-lg border`,children:(0,P.jsxs)(q,{value:w,onValueChange:me,disabled:!1,children:[(0,P.jsx)(Y,{className:`w-[200px] h-8 bg-transparent border-0 focus:ring-0 shadow-none`,children:(0,P.jsx)(J,{placeholder:`Select workspace`})}),(0,P.jsxs)(X,{children:[C.map(e=>(0,P.jsxs)(Z,{value:e.id,children:[e.name,` (`,e.slug,`)`]},e.id)),(0,P.jsx)(Z,{value:`__create__`,children:(0,P.jsxs)(`span`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(gn,{className:`h-4 w-4`}),`Add workspace`]})})]})]})}),(0,P.jsxs)(wr,{children:[(0,P.jsx)(Tr,{asChild:!0,children:(0,P.jsx)(F,{variant:`outline`,size:`icon`,className:`h-8 w-8`,disabled:!w,children:(0,P.jsx)(ut,{className:`h-4 w-4`})})}),(0,P.jsxs)(Or,{align:`end`,children:[(0,P.jsx)(Mr,{children:`Workspace`}),(0,P.jsxs)(kr,{onClick:()=>e({to:`/dashboard/workspaces/$workspaceId`,params:{workspaceId:w}}),children:[(0,P.jsx)(T,{className:`mr-2 h-4 w-4`}),`Workspace access`]}),(0,P.jsxs)(kr,{onClick:()=>e({to:`/dashboard/workspaces`}),children:[(0,P.jsx)(kn,{className:`mr-2 h-4 w-4`}),`All workspaces`]}),(0,P.jsx)(Nr,{}),(0,P.jsxs)(kr,{className:`text-destructive focus:text-destructive`,onClick:()=>{se(!0),le(``)},children:[(0,P.jsx)(tt,{className:`mr-2 h-4 w-4`}),`Delete workspace`]})]})]})]})]}),(0,P.jsx)(tr,{open:ie,onOpenChange:ae,children:(0,P.jsxs)(ir,{className:`max-w-lg`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Create workspace`}),(0,P.jsx)(cr,{children:`Create a new workspace and its backing Git repo.`})]}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1.5`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Name`}),(0,P.jsx)(K,{value:y,onChange:e=>b(e.target.value),placeholder:`Customer demo`})]}),(0,P.jsxs)(`div`,{className:`space-y-1.5`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Slug (optional)`}),(0,P.jsx)(K,{value:x,onChange:e=>S(e.target.value),placeholder:`customer-demo`,className:`font-mono`}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Leave blank to auto-generate from name.`})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-end gap-2 pt-2`,children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>ae(!1),disabled:E.isPending,children:`Cancel`}),(0,P.jsx)(F,{onClick:()=>E.mutate(),disabled:E.isPending,children:E.isPending?`Creating`:`Create`})]})]})]})}),(0,P.jsx)(tr,{open:oe,onOpenChange:se,children:(0,P.jsxs)(ir,{className:`max-w-lg`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Delete workspace`}),(0,P.jsx)(cr,{children:`This deletes the workspace and its backing resources (Git repo, artifacts, and state). This cannot be undone.`})]}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`text-sm`,children:[`Type`,` `,(0,P.jsx)(`span`,{className:`font-mono font-semibold`,children:de?.slug??``}),` `,`to confirm.`]}),(0,P.jsx)(K,{value:ce,onChange:e=>le(e.target.value),placeholder:de?.slug??``,className:`font-mono`}),(0,P.jsxs)(`div`,{className:`flex items-center justify-end gap-2 pt-2`,children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>se(!1),disabled:pe.isPending,children:`Cancel`}),(0,P.jsx)(F,{variant:`destructive`,onClick:()=>pe.mutate(),disabled:pe.isPending,children:pe.isPending?`Deleting`:`Delete`})]})]})]})}),!o.data&&(0,P.jsx)(L,{className:`border-dashed`,children:(0,P.jsx)(V,{className:`pt-6`,children:(0,P.jsxs)(`div`,{className:`flex flex-col items-center justify-center space-y-4 py-8`,children:[(0,P.jsx)(U,{className:`h-4 w-64`}),(0,P.jsxs)(`div`,{className:`text-center text-muted-foreground`,children:[`Loading dashboard`,(0,P.jsxs)(`div`,{className:`mt-2 text-xs`,children:[`If you are logged out,`,` `,(0,P.jsx)(`a`,{className:`text-primary underline hover:no-underline`,href:xe,onClick:e=>{e.preventDefault(),(async()=>{if(!await Bs({loginHref:xe})){window.location.href=xe;return}await t.invalidateQueries({queryKey:H.session()})})()},children:`login`}),`.`]})]})]})})}),(0,P.jsxs)(`div`,{className:`flex flex-col lg:flex-row gap-6 relative items-start`,children:[(0,P.jsxs)(`div`,{className:`flex-1 min-w-0 space-y-4 w-full`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col sm:flex-row gap-3`,children:[(0,P.jsxs)(`div`,{className:`relative flex-1`,children:[(0,P.jsx)(k,{className:`absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground`}),(0,P.jsx)(K,{placeholder:`Search deployments...`,className:`pl-9`,value:h,onChange:e=>g(e.target.value)})]}),(0,P.jsxs)(q,{value:ee,onValueChange:_,children:[(0,P.jsxs)(Y,{className:`w-[140px]`,children:[(0,P.jsx)(Ge,{className:`mr-2 h-4 w-4 text-muted-foreground`}),(0,P.jsx)(J,{placeholder:`Status`})]}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All Status`}),(0,P.jsx)(Z,{value:`running`,children:`Running`}),(0,P.jsx)(Z,{value:`stopped`,children:`Stopped`}),(0,P.jsx)(Z,{value:`failed`,children:`Failed`})]})]}),(0,P.jsxs)(q,{value:v,onValueChange:te,children:[(0,P.jsxs)(Y,{className:`w-[140px]`,children:[(0,P.jsx)(ot,{className:`mr-2 h-4 w-4 text-muted-foreground`}),(0,P.jsx)(J,{placeholder:`Type`})]}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All Types`}),(0,P.jsx)(Z,{value:`netlab`,children:`Netlab`}),(0,P.jsx)(Z,{value:`containerlab`,children:`Containerlab`}),(0,P.jsx)(Z,{value:`terraform`,children:`Terraform`})]})]}),(0,P.jsxs)(p,{to:`/dashboard/deployments/new`,search:{workspace:w},className:Cr({variant:`default`}),children:[(0,P.jsx)(gn,{className:`mr-2 h-4 w-4`}),` Create`]})]}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-0`,children:o.data?ge.length===0?(0,P.jsx)(ec,{icon:kn,title:`No deployments found`,description:h||ee!==`all`?`Try adjusting your filters.`:`You haven't created any deployments in this workspace yet.`,action:!h&&ee===`all`?{label:`Create deployment`,onClick:()=>e({to:`/dashboard/deployments/new`,search:{workspace:w}})}:void 0}):(0,P.jsx)($s,{columns:ye,rows:ge,getRowId:e=>e.id,minWidthClassName:`min-w-0`,scrollable:!1}):(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(U,{className:`h-10 w-full`}),(0,P.jsx)(U,{className:`h-10 w-full`}),(0,P.jsx)(U,{className:`h-10 w-full`})]})})})]}),(0,P.jsxs)(`div`,{className:N(`transition-all duration-300 ease-in-out border-l space-y-4 shrink-0`,ne?`w-full lg:w-80 xl:w-96 pl-6 opacity-100`:`w-0 lg:w-12 pl-0 opacity-100 border-none lg:border-l`),children:[(0,P.jsx)(`div`,{className:N(`flex items-center gap-2 h-[40px]`,!ne&&`justify-center`),children:ne?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Cn,{className:`h-4 w-4 text-muted-foreground`}),(0,P.jsx)(`h3`,{className:`flex-1 text-sm font-semibold text-muted-foreground uppercase tracking-wider`,children:`Activity Feed`}),(0,P.jsx)(F,{variant:`ghost`,size:`icon`,className:`h-6 w-6 text-muted-foreground hover:text-foreground`,onClick:()=>re(!1),title:`Collapse feed`,children:(0,P.jsx)(rt,{className:`h-4 w-4`})})]}):(0,P.jsx)(F,{variant:`ghost`,size:`icon`,className:`h-8 w-8 text-muted-foreground hover:text-foreground`,onClick:()=>re(!0),title:`Expand activity feed`,children:(0,P.jsx)(fe,{className:`h-4 w-4`})})}),(0,P.jsx)(`div`,{className:N(`space-y-3`,!ne&&`hidden`),children:o.data?be.length===0?(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-6 text-center text-sm text-muted-foreground`,children:`No recent activity.`})}):(0,P.jsx)(`div`,{className:`space-y-3`,children:be.slice(0,15).map(e=>([`success`,`failed`,`canceled`,`error`].includes(String(e.status??``).toLowerCase()),(0,P.jsx)(p,{to:`/dashboard/runs/$runId`,params:{runId:String(e.id??``)},className:`block group`,children:(0,P.jsx)(L,{className:`hover:border-primary/50 transition-colors`,children:(0,P.jsxs)(V,{className:`p-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-start justify-between gap-2`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col gap-1 min-w-0`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(`span`,{className:`font-mono text-xs font-medium text-foreground`,children:[`#`,String(e.id??``)]}),(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground truncate max-w-[120px]`,children:String(e.tpl_alias??e.type??`Run`)})]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground truncate`,children:String(e.message||`No message`)})]}),(0,P.jsx)(Su,{status:String(e.status??``),size:`xs`})]}),(0,P.jsxs)(`div`,{className:`mt-2 flex items-center justify-between text-[10px] text-muted-foreground`,children:[(0,P.jsx)(`span`,{children:String(e.user_name??`system`)}),(0,P.jsx)(`span`,{children:new Date(String(e.created)).toLocaleString(void 0,{month:`short`,day:`numeric`,hour:`numeric`,minute:`numeric`})})]})]})})},String(e.id??Math.random()))))}):(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsx)(U,{className:`h-20 w-full`}),(0,P.jsx)(U,{className:`h-20 w-full`})]})})]})]}),(0,P.jsx)(xc,{open:u,onOpenChange:d,children:(0,P.jsxs)(wc,{children:[(0,P.jsxs)(Tc,{children:[(0,P.jsx)(Dc,{children:`Delete deployment?`}),(0,P.jsxs)(Oc,{children:[`This will remove "`,s?.name,`" from Skyforge and trigger provider cleanup. This action cannot be undone.`]})]}),Ce&&(0,P.jsxs)(`div`,{className:`flex items-start gap-3 rounded-md border p-3`,children:[(0,P.jsx)(jc,{checked:f,onCheckedChange:e=>m(!!e),id:`delete-forward-network`}),(0,P.jsx)(`label`,{htmlFor:`delete-forward-network`,className:`text-sm leading-tight cursor-pointer`,children:`Also delete the Forward network associated with this deployment.`})]}),(0,P.jsxs)(Ec,{children:[(0,P.jsx)(Ac,{children:`Cancel`}),(0,P.jsx)(kc,{onClick:Se,className:Cr({variant:`destructive`}),children:`Delete`})]})]})})]})}function Su({status:e,size:t=`default`}){let n=`secondary`,r=e.toLowerCase(),i=r===`success`||r===`succeeded`?`ready`:r===`crashloopbackoff`?`crashloop`:e;return[`running`,`active`,`healthy`].includes(r)&&(n=`default`),[`failed`,`error`,`crashloopbackoff`].includes(r)&&(n=`destructive`),(0,P.jsx)(W,{variant:n,className:`capitalize ${t===`xs`?`px-1.5 py-0 text-[10px] h-5`:``}`,children:i})}const Cu=t(`/dashboard/workspaces/$workspaceId`)({component:Tu});function wu(e){return e.split(/[\n,]+/g).map(e=>e.trim()).filter(Boolean)}function Tu(){let{workspaceId:e}=Cu.useParams(),t=c(),a=n(),[o,s]=(0,M.useState)(!1),[l,u]=(0,M.useState)(``),d=i({queryKey:H.workspaces(),queryFn:Hr,staleTime:3e4}),f=(0,M.useMemo)(()=>d.data?.workspaces?.find(t=>t.id===e),[d.data,e]),[p,m]=(0,M.useState)(f?.isPublic??!1),[h,g]=(0,M.useState)((f?.owners??[]).join(`
`)),[ee,_]=(0,M.useState)((f?.editors??[]).join(`
`)),[v,te]=(0,M.useState)((f?.viewers??[]).join(`
`)),[ne,re]=(0,M.useState)((f?.ownerGroups??[]).join(`
`)),[ie,ae]=(0,M.useState)((f?.editorGroups??[]).join(`
`)),[y,b]=(0,M.useState)((f?.viewerGroups??[]).join(`
`)),x=(0,M.useMemo)(()=>f?`${f.id}:${f.isPublic}:${f.owners?.length??0}:${f.editors?.length??0}:${f.viewers?.length??0}`:``,[f]),[S,oe]=(0,M.useState)(``);f&&x!==S&&(oe(x),m(f.isPublic),g((f.owners??[]).join(`
`)),_((f.editors??[]).join(`
`)),te((f.viewers??[]).join(`
`)),re((f.ownerGroups??[]).join(`
`)),ae((f.editorGroups??[]).join(`
`)),b((f.viewerGroups??[]).join(`
`)));let se=r({mutationFn:async()=>za(e,{isPublic:p,owners:wu(h),editors:wu(ee),viewers:wu(v),ownerGroups:wu(ne),editorGroups:wu(ie),viewerGroups:wu(y)}),onSuccess:async()=>{j.success(`Workspace updated`),await t.invalidateQueries({queryKey:H.workspaces()})},onError:e=>j.error(`Failed to update workspace`,{description:e.message})}),ce=r({mutationFn:async()=>{let t=String(l??``).trim();if(!t)throw Error(`Type the workspace slug (${f?.slug??``}) to confirm`);return Ua(e,{confirm:t})},onSuccess:async()=>{j.success(`Workspace deleted`),s(!1),u(``),await t.invalidateQueries({queryKey:H.workspaces()}),a({to:`/dashboard/deployments`})},onError:e=>j.error(`Failed to delete workspace`,{description:e.message})});return d.isLoading?(0,P.jsx)(`div`,{className:`space-y-6 p-6`,children:(0,P.jsxs)(`div`,{className:`flex items-center gap-2 text-muted-foreground`,children:[(0,P.jsx)(T,{className:`h-4 w-4`}),`Loading workspace`]})}):f?(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between border-b pb-6`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:f.name}),(0,P.jsx)(`p`,{className:`text-muted-foreground text-sm`,children:f.slug})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>a({to:`/dashboard/deployments`}),children:`Back to deployments`}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>a({to:`/dashboard/workspaces/$workspaceId/policy-reports`,params:{workspaceId:e}}),children:`Policy Reports`}),(0,P.jsx)(F,{variant:`destructive`,onClick:()=>s(!0),disabled:se.isPending||ce.isPending,children:`Delete workspace`}),(0,P.jsx)(F,{onClick:()=>se.mutate(),disabled:se.isPending,children:`Save`})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Visibility`})}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2 text-sm`,children:[(0,P.jsx)(jc,{checked:p,onCheckedChange:e=>m(!!e)}),(0,P.jsx)(`span`,{children:`Public workspace (any authenticated user can view)`})]}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Use this for demo workspaces. For customer demos, keep it private and add specific users/groups.`})]})]}),(0,P.jsxs)(`div`,{className:`grid gap-4 lg:grid-cols-2`,children:[(0,P.jsx)(Eu,{title:`Owners`,description:`Full control: can manage access and delete resources.`,value:h,onChange:g,placeholder:`user1@forwardnetworks.com
user2@forwardnetworks.com`}),(0,P.jsx)(Eu,{title:`Owner Groups`,description:`Group identities that should be owners.`,value:ne,onChange:re,placeholder:`forwardnetworks.com:team-platform
forwardnetworks.com:team-se`}),(0,P.jsx)(Eu,{title:`Editors`,description:`Can create, start, and stop deployments.`,value:ee,onChange:_,placeholder:`user1@forwardnetworks.com
user2@forwardnetworks.com`}),(0,P.jsx)(Eu,{title:`Editor Groups`,description:`Group identities that should be editors.`,value:ie,onChange:ae,placeholder:`forwardnetworks.com:team-se`}),(0,P.jsx)(Eu,{title:`Viewers`,description:`Read-only access to deployments and runs.`,value:v,onChange:te,placeholder:`user1@forwardnetworks.com
user2@forwardnetworks.com`}),(0,P.jsx)(Eu,{title:`Viewer Groups`,description:`Group identities that should be viewers.`,value:y,onChange:b,placeholder:`forwardnetworks.com:all`})]}),(0,P.jsx)(tr,{open:o,onOpenChange:s,children:(0,P.jsxs)(ir,{className:`max-w-lg`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Delete workspace`}),(0,P.jsx)(cr,{children:`This deletes the workspace and its backing resources (Git repo, artifacts, and state). This cannot be undone.`})]}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`text-sm`,children:[`Type`,` `,(0,P.jsx)(`span`,{className:`font-mono font-semibold`,children:f.slug}),` `,`to confirm.`]}),(0,P.jsx)(K,{value:l,onChange:e=>u(e.target.value),placeholder:f.slug,className:`font-mono`}),(0,P.jsxs)(`div`,{className:`flex items-center justify-end gap-2 pt-2`,children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>s(!1),disabled:ce.isPending,children:`Cancel`}),(0,P.jsx)(F,{variant:`destructive`,onClick:()=>ce.mutate(),disabled:ce.isPending,children:ce.isPending?`Deleting`:`Delete`})]})]})]})})]}):(0,P.jsx)(`div`,{className:`space-y-6 p-6`,children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between border-b pb-6`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Workspace`}),(0,P.jsx)(`p`,{className:`text-muted-foreground text-sm`,children:`Workspace not found.`})]}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>a({to:`/dashboard/workspaces`}),children:`Back`})]})})}function Eu(e){return(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`pb-3`,children:[(0,P.jsx)(z,{className:`text-base`,children:e.title}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:e.description})]}),(0,P.jsxs)(V,{className:`pt-0`,children:[(0,P.jsx)(ul,{value:e.value,onChange:t=>e.onChange(t.target.value),placeholder:e.placeholder,className:`min-h-[140px] whitespace-pre-wrap font-mono text-xs`}),(0,P.jsx)(`p`,{className:`mt-2 text-xs text-muted-foreground`,children:`One per line (or comma-separated).`})]})]})}const Du=t(`/dashboard/runs/$runId`)({component:Ou});function Ou(){let{runId:e}=Du.useParams();Gl(e,!0);let t=c(),r=n(),a=i({queryKey:H.dashboardSnapshot(),queryFn:Ur,initialData:()=>t.getQueryData(H.dashboardSnapshot())??null,retry:!1,staleTime:1/0}),o=(a.data?.runs??[]).find(t=>String(t.id??``)===e),s=String(o?.status??``).toLowerCase(),l=s===`queued`||s===`running`,u=i({queryKey:H.runLogs(e),queryFn:async()=>({cursor:0,entries:[]}),retry:!1,staleTime:1/0}),d=Lr(window.location.pathname+window.location.search);return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,P.jsx)(`div`,{children:(0,P.jsxs)(z,{children:[`Run `,e]})}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(p,{className:Cr({variant:`outline`,size:`sm`}),to:`/dashboard/deployments`,children:`Back`}),(0,P.jsx)(F,{variant:`destructive`,size:`sm`,disabled:!o||!l,onClick:()=>{if(!o)return;let n=String(o.workspaceId??``);if(!n){j.error(`Cannot cancel run`,{description:`Missing workspace ID.`});return}(async()=>{try{await wo(e,n),j.success(`Run canceled`),await t.invalidateQueries({queryKey:H.dashboardSnapshot()}),r({to:`/dashboard/deployments`,search:{workspace:n}})}catch(e){j.error(`Cancel failed`,{description:e.message})}})()},children:`Cancel`}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>t.setQueryData(H.runLogs(e),{cursor:0,entries:[]}),children:`Clear`})]})]})})}),!a.data&&(0,P.jsx)(L,{className:`border-dashed`,children:(0,P.jsxs)(V,{className:`pt-6 text-center text-muted-foreground`,children:[`Loading dashboard`,(0,P.jsxs)(`div`,{className:`mt-2 text-xs`,children:[`If you are logged out,`,` `,(0,P.jsx)(`a`,{className:`text-primary underline hover:no-underline`,href:d,onClick:e=>{e.preventDefault(),(async()=>{if(!await Bs({loginHref:d})){window.location.href=d;return}await t.invalidateQueries({queryKey:H.session()})})()},children:`login`}),`.`]})]})}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(z,{children:`Metadata`}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Cursor: `,String(u.data?.cursor??0)]})]})}),(0,P.jsx)(V,{children:(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-4 md:grid-cols-3`,children:[(0,P.jsx)(ku,{label:`Type`,value:String(o?.tpl_alias??``)}),(0,P.jsx)(ku,{label:`Status`,value:String(o?.status??``)}),(0,P.jsx)(ku,{label:`Workspace`,value:String(o?.workspaceId??``)}),(0,P.jsx)(ku,{label:`Created`,value:String(o?.created??``)}),(0,P.jsx)(ku,{label:`Started`,value:String(o?.start??``)}),(0,P.jsx)(ku,{label:`Finished`,value:String(o?.end??``)})]})})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Output`})}),(0,P.jsx)(V,{children:(0,P.jsx)(`div`,{className:`rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100`,children:(0,P.jsx)(Au,{entries:u.data?.entries??[]})})})]})]})}function ku(e){return(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-[11px] uppercase tracking-wide text-muted-foreground`,children:e.label}),(0,P.jsx)(`div`,{className:`break-all font-medium text-sm`,children:e.value||``})]})}function Au(e){let t=(0,M.useRef)(null);return(0,M.useEffect)(()=>{let e=t.current;e&&(e.scrollTop=e.scrollHeight)},[e.entries.length]),e.entries.length===0?(0,P.jsx)(`div`,{className:`text-zinc-500`,children:`Waiting for output`}):(0,P.jsx)(`div`,{ref:t,className:`max-h-[65vh] overflow-auto whitespace-pre-wrap`,children:e.entries.map((e,t)=>(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`span`,{className:`text-zinc-500 select-none`,children:e.time?`${e.time} `:``}),(0,P.jsx)(`span`,{children:e.output})]},`${e.time}-${t}`))})}function ju({workspaceId:e,deploymentId:t,nodeId:n,nodeKind:r,nodeIp:a,onClose:o,className:s}){let c=(0,M.useMemo)(()=>{let e=[n];return r&&e.push(String(r)),e.join(`  `)},[n,r]),l=i({queryKey:[`deploymentNodeDescribe`,e,t,n],enabled:!!e&&!!t&&!!n,queryFn:async()=>wa(e,t,n),refetchOnWindowFocus:!1,retry:1});return(0,P.jsxs)(`div`,{className:`flex flex-col h-full w-full ${s??``}`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2 p-2 border-b bg-muted/40 text-xs`,children:[(0,P.jsxs)(`div`,{className:`truncate flex items-center gap-2`,children:[(0,P.jsx)(`span`,{className:`font-mono font-medium`,children:c}),a?(0,P.jsx)(`span`,{className:`font-mono text-muted-foreground`,children:a}):null]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(F,{variant:`outline`,size:`sm`,className:`h-7`,onClick:()=>l.refetch(),disabled:l.isFetching,children:[(0,P.jsx)(Ot,{className:l.isFetching?`mr-2 h-3 w-3 animate-spin`:`mr-2 h-3 w-3`}),`Refresh`]}),o?(0,P.jsx)(F,{variant:`ghost`,size:`sm`,className:`h-7`,onClick:o,children:`Close`}):null]})]}),(0,P.jsx)(`div`,{className:`flex-1 overflow-auto bg-muted/10 p-4`,children:(0,P.jsx)(`pre`,{className:`text-xs font-mono whitespace-pre-wrap`,children:l.isLoading?`Loading`:l.isError?`Failed to load node status: ${String(l.error)}`:JSON.stringify(l.data??{},null,2)})})]})}function Mu({open:e,onOpenChange:t,workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,nodeIp:o}){return(0,P.jsx)(tr,{open:e,onOpenChange:t,children:(0,P.jsxs)(ir,{className:`max-w-5xl h-[70vh] flex flex-col p-0 gap-0 overflow-hidden`,children:[(0,P.jsx)(ar,{className:`px-6 py-4 border-b`,children:(0,P.jsxs)(sr,{className:`flex items-center gap-2`,children:[(0,P.jsx)(he,{className:`h-4 w-4`}),`Node status`]})}),(0,P.jsx)(`div`,{className:`flex-1 min-h-0`,children:e?(0,P.jsx)(ju,{workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,nodeIp:o,onClose:()=>t(!1)}):null})]})})}function Nu({workspaceId:e,deploymentId:t,nodeId:n,nodeKind:r,nodeIp:a,onClose:o,className:s}){let c=(0,M.useMemo)(()=>{let e=[n];return r&&e.push(String(r)),e.join(`  `)},[n,r]),l=i({queryKey:[`deploymentNodeLogs`,e,t,n,400],enabled:!!e&&!!t&&!!n,queryFn:async()=>Ca(e,t,n,{tail:400,container:n}),refetchOnWindowFocus:!1,retry:1});return(0,P.jsxs)(`div`,{className:`flex flex-col h-full w-full ${s??``}`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2 p-2 border-b bg-muted/40 text-xs`,children:[(0,P.jsxs)(`div`,{className:`truncate flex items-center gap-2`,children:[(0,P.jsx)(`span`,{className:`font-mono font-medium`,children:c}),a?(0,P.jsx)(`span`,{className:`font-mono text-muted-foreground`,children:a}):null,l.data?.namespace&&l.data?.podName?(0,P.jsxs)(`span`,{className:`text-muted-foreground`,children:[l.data.namespace,`/`,l.data.podName]}):null]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(F,{variant:`outline`,size:`sm`,className:`h-7`,onClick:()=>l.refetch(),disabled:l.isFetching,children:[(0,P.jsx)(Ot,{className:l.isFetching?`mr-2 h-3 w-3 animate-spin`:`mr-2 h-3 w-3`}),`Refresh`]}),o?(0,P.jsx)(F,{variant:`ghost`,size:`sm`,className:`h-7`,onClick:o,children:`Close`}):null]})]}),(0,P.jsx)(`div`,{className:`flex-1 overflow-auto bg-muted/10 p-4`,children:(0,P.jsx)(`pre`,{className:`text-xs font-mono whitespace-pre-wrap`,children:l.isLoading?`Loading`:l.isError?`Failed to load logs: ${String(l.error)}`:l.data?.logs||``})})]})}function Pu({open:e,onOpenChange:t,workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,nodeIp:o}){return(0,P.jsx)(tr,{open:e,onOpenChange:t,children:(0,P.jsxs)(ir,{className:`max-w-5xl h-[70vh] flex flex-col p-0 gap-0 overflow-hidden`,children:[(0,P.jsx)(ar,{className:`px-6 py-4 border-b`,children:(0,P.jsxs)(sr,{className:`flex items-center gap-2`,children:[(0,P.jsx)(he,{className:`h-4 w-4`}),`Node logs`]})}),(0,P.jsx)(`div`,{className:`flex-1 min-h-0`,children:e?(0,P.jsx)(Nu,{workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,nodeIp:o,onClose:()=>t(!1)}):null})]})})}var Fu=Jn(),Iu=Zn();function Lu({workspaceId:e,deploymentId:t,nodeId:n,nodeKind:r,onClose:i,className:a}){let o=(0,M.useRef)(null),s=(0,M.useRef)(null),c=(0,M.useRef)(null),l=(0,M.useRef)(null),[u,d]=(0,M.useState)(`disconnected`),f=(0,M.useMemo)(()=>`cli`,[]),p=(0,M.useMemo)(()=>{if(!e||!t||!n)return``;let r=`${window.location.protocol===`https:`?`wss`:`ws`}://${window.location.host}/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/terminal/ws`,i=new URLSearchParams;return i.set(`node`,n),i.set(`command`,f),`${r}?${i.toString()}`},[f,t,n,e]);return(0,M.useEffect)(()=>{if(!o.current||!p)return;let e=new Iu.Terminal({convertEol:!0,cursorBlink:!0,fontFamily:`ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace`,fontSize:12,theme:{background:`#09090b`}}),t=new Fu.FitAddon;e.loadAddon(t),e.open(o.current),t.fit(),e.writeln(`\x1B[1mSkyforge Terminal\x1B[0m`),e.writeln(`Node: ${n}  Command: ${f}`),e.writeln(``),s.current=e,c.current=t;let r=new WebSocket(p);l.current=r,d(`connecting`);let i=()=>{let e=s.current;if(!e)return;let t=e.cols??80,n=e.rows??24;try{r.send(JSON.stringify({type:`resize`,cols:t,rows:n}))}catch{}};r.onopen=()=>{d(`connected`),i(),e.focus()},r.onmessage=t=>{let n=null;try{n=JSON.parse(String(t.data))}catch{e.write(String(t.data));return}if(n){if(n.type===`output`){e.write(n.data??``);return}if(n.type===`info`){e.writeln(`\r\n[info] ${n.data??``}`);return}if(n.type===`error`){e.writeln(`\r\n[error] ${n.data??``}`);return}}},r.onclose=t=>{d(`closed`);let n=typeof t.code==`number`?t.code:0,r=t.reason?` ${t.reason}`:``;e.writeln(`\r\n[disconnected]${n?` (code ${n})`:``}${r}`)},r.onerror=()=>{d(`error`),e.writeln(`\r
[error] websocket error (check browser console/network)`)};let a=e.onData(e=>{try{r.send(JSON.stringify({type:`stdin`,data:e}))}catch{}}),u=()=>{t.fit(),i()};return window.addEventListener(`resize`,u),()=>{window.removeEventListener(`resize`,u),a.dispose();try{r.close()}catch{}l.current=null,e.dispose(),s.current=null,c.current=null,d(`disconnected`)}},[f,n,p]),(0,P.jsxs)(`div`,{className:`flex flex-col h-full w-full ${a??``}`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2 p-2 text-xs text-muted-foreground bg-zinc-900 border-b border-zinc-800`,children:[(0,P.jsxs)(`div`,{className:`truncate`,children:[(0,P.jsx)(`span`,{className:`font-mono text-zinc-300`,children:n}),(0,P.jsx)(`span`,{className:`mx-2 text-zinc-600`,children:`/`}),(0,P.jsx)(`span`,{children:u})]}),i?(0,P.jsx)(F,{variant:`ghost`,size:`sm`,className:`h-6 px-2 text-xs`,onClick:()=>{let e=l.current;if(e&&e.readyState===WebSocket.OPEN)try{e.close()}catch{}i()},children:`Close`}):null]}),(0,P.jsx)(`div`,{className:`flex-1 bg-zinc-950 p-2 min-h-0`,children:(0,P.jsx)(`div`,{ref:o,className:`h-full w-full`})})]})}function Ru({open:e,onOpenChange:t,workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a}){let o=`${n}-${r}-${i}-${e}`;return(0,P.jsx)(tr,{open:e,onOpenChange:t,children:(0,P.jsxs)(ir,{className:`max-w-5xl h-[70vh] flex flex-col p-0 gap-0 overflow-hidden`,children:[(0,P.jsx)(ar,{className:`px-6 py-4 border-b`,children:(0,P.jsxs)(sr,{className:`flex items-center gap-2`,children:[(0,P.jsx)(he,{className:`h-4 w-4`}),`Terminal`]})}),(0,P.jsx)(`div`,{className:`flex-1 min-h-0`,children:e?(0,P.jsx)(Lu,{workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,onClose:()=>t(!1)},o):null})]})})}function zu(){return{downloadImage:(0,M.useCallback)((e,t)=>{e&&Yn(e,{cacheBust:!0,backgroundColor:`#18181b`}).then(e=>{let n=document.createElement(`a`);n.download=t,n.href=e,n.click()}).catch(e=>{console.error(`Failed to download image`,e)})},[])}}function Bu(e,t,n){let r=c(),i=(0,M.useMemo)(()=>`${Ir}/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/ui-events/events`,[t,e]);(0,M.useEffect)(()=>{if(!n||!e||!t)return;let a=n=>{try{let i=JSON.parse(n.data);if(!i||!Array.isArray(i.events))return;r.setQueryData(H.deploymentUIEvents(e,t),e=>{let t=(e?.events??[]).concat(i.events),n=t.slice(Math.max(0,t.length-300));return{cursor:Number(i.cursor??e?.cursor??0),events:n}})}catch{}},o=Ks(i,{"ui-events":a});return()=>o.close()},[t,n,r,i,e])}var Vu={custom:({data:e})=>{let t=e.icon===`switch`?yn:e.icon===`cloud`?He:e.icon===`client`?Ft:st,n=e.status===`running`?`default`:e.status===`stopped`?`secondary`:`destructive`,r=!!e?.highlight,i=String(e?.vendor??``);return(0,P.jsxs)(L,{className:`min-w-[180px] border-2 shadow-md ${r?`border-primary ring-2 ring-primary/30`:``}`,children:[(0,P.jsx)(R,{className:`p-3 pb-2`,children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(({vendor:e})=>{let t=String(e).toLowerCase();return t===`cisco`?(0,P.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center`,title:`Cisco`,style:{background:`rgba(0, 142, 204, 0.15)`,color:`rgb(0, 142, 204)`},children:(0,P.jsx)(`svg`,{viewBox:`0 0 24 24`,width:`16`,height:`16`,"aria-hidden":`true`,children:[{x:4,h:8},{x:7,h:10},{x:10,h:12},{x:13,h:10},{x:16,h:8}].map(e=>(0,P.jsx)(`rect`,{x:e.x,y:14-e.h,width:`2`,height:e.h,rx:`1`,fill:`currentColor`},e.x))})}):t===`arista`?(0,P.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center`,title:`Arista`,style:{background:`rgba(232, 43, 44, 0.14)`,color:`rgb(232, 43, 44)`},children:(0,P.jsx)(`svg`,{viewBox:`0 0 24 24`,width:`16`,height:`16`,"aria-hidden":`true`,children:(0,P.jsx)(`path`,{d:`M12 3 4.5 21h3.6l1.6-4h4.6l1.6 4h3.6L12 3zm-1 11 1-2.6 1 2.6h-2z`,fill:`currentColor`})})}):t===`linux`?(0,P.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center`,title:`Linux`,style:{background:`rgba(34, 197, 94, 0.12)`,color:`rgb(34, 197, 94)`},children:(0,P.jsxs)(`svg`,{viewBox:`0 0 24 24`,width:`16`,height:`16`,"aria-hidden":`true`,children:[(0,P.jsx)(`circle`,{cx:`12`,cy:`9`,r:`4`,fill:`#111827`}),(0,P.jsx)(`ellipse`,{cx:`12`,cy:`16`,rx:`5`,ry:`6`,fill:`#111827`}),(0,P.jsx)(`ellipse`,{cx:`12`,cy:`17`,rx:`3.3`,ry:`4.2`,fill:`#ffffff`}),(0,P.jsx)(`path`,{d:`M12 10l2 1-2 1-2-1 2-1z`,fill:`#f59e0b`})]})}):(0,P.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center bg-muted text-[11px] font-bold`,title:`Unknown`,children:`?`})},{vendor:i}),(0,P.jsx)(`div`,{className:`p-1.5 bg-muted rounded-md`,title:String(e?.kind??``),children:(0,P.jsx)(t,{className:`w-4 h-4`})})]}),(0,P.jsx)(W,{variant:n,className:`text-[10px] h-5`,children:String(e.status)})]})}),(0,P.jsxs)(V,{className:`p-3 pt-0`,children:[(0,P.jsx)(z,{className:`text-sm font-bold truncate`,children:String(e.label)}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground mt-1 truncate font-mono`,children:String(e.ip||`10.0.0.x`)}),(0,P.jsx)(vn,{type:`target`,position:ln.Top,className:`!bg-muted-foreground`}),(0,P.jsx)(vn,{type:`source`,position:ln.Bottom,className:`!bg-muted-foreground`})]})]})}};function Hu({topology:e,workspaceId:t,deploymentId:n,enableTerminal:a,fullHeight:o,className:s}){let c=(0,M.useCallback)(e=>{let t=String(e??``).toLowerCase();return t?t.includes(`arista`)||t.includes(`eos`)||t.includes(`ceos`)||t.includes(`veos`)?`arista`:t.includes(`cisco`)||t.includes(`ios`)||t.includes(`nxos`)||t.includes(`csr`)||t.includes(`c8k`)||t.includes(`iosxr`)?`cisco`:t.includes(`linux`)||t.includes(`ubuntu`)||t.includes(`debian`)||t.includes(`alpine`)||t.includes(`rocky`)||t.includes(`centos`)?`linux`:`unknown`:`unknown`},[]),l=(0,M.useMemo)(()=>{if(!e||!Array.isArray(e.nodes)||e.nodes.length===0)return{nodes:[],edges:[]};let t=Math.max(1,Math.ceil(Math.sqrt(e.nodes.length)));return{nodes:e.nodes.map((e,n)=>{let r=n%t,i=Math.floor(n/t),a=String(e.kind??``),o=c(a),s=o===`linux`?`client`:o===`arista`||o===`cisco`?`switch`:`server`,l=String(e.status??`unknown`),u=String(e.pingIp??e.mgmtIp??``),d=String(e.mgmtHost??``);return{id:String(e.id),position:{x:r*240,y:i*160},data:{label:String(e.label??e.id),icon:s,status:l,ip:u,mgmtHost:d,kind:a,vendor:o},type:`custom`}}),edges:(e.edges??[]).map(e=>({id:String(e.id),source:String(e.source),target:String(e.target),label:e.label?String(e.label):void 0,animated:!1}))}},[e,c]),[u,d,f]=jt(l.nodes),[p,m,h]=Tt(l.edges),g=(0,M.useRef)(null),{downloadImage:ee}=zu(),[_,v]=(0,M.useState)(null),[te,ne]=(0,M.useState)(null),[re,ie]=(0,M.useState)(null),[ae,y]=(0,M.useState)(null),[b,x]=(0,M.useState)(null),[S,oe]=(0,M.useState)(null),[se,ce]=(0,M.useState)(!1),[le,C]=(0,M.useState)(!1),[ue,w]=(0,M.useState)(!1),[T,de]=(0,M.useState)(null),[fe,E]=(0,M.useState)({}),pe=(0,M.useRef)(null),me=(0,M.useRef)({}),he=(0,M.useRef)(!1),[ge,_e]=(0,M.useState)(``),[ve,ye]=(0,M.useState)(`grid`),be=(0,M.useMemo)(()=>!t||!n?``:`skyforge.topology.positions.${t}.${n}`,[n,t]),[xe,Se]=(0,M.useState)(()=>({})),[D,Ce]=(0,M.useState)(null),[we,Te]=(0,M.useState)(!1),[Ee,De]=(0,M.useState)(null),[ke,Ae]=(0,M.useState)(!1),[je,Me]=(0,M.useState)(!1),[O,Ne]=(0,M.useState)(null),[Pe,Fe]=(0,M.useState)({side:`source`,duration:`10`,packets:`2500`,snaplen:`192`}),[Ie,Le]=(0,M.useState)(!1),[Re,ze]=(0,M.useState)(null),[Be,Ve]=(0,M.useState)({delayMs:``,jitterMs:``,lossPct:``,dupPct:``,corruptPct:``,reorderPct:``,rateKbps:``});(0,M.useEffect)(()=>{if(be)try{let e=window.localStorage.getItem(be);if(!e)return;let t=JSON.parse(e);t&&typeof t==`object`&&Se(t)}catch{}},[be]);let He=!!(t&&n);Bu(t??``,n??``,He);let Ue=i({queryKey:t&&n?H.deploymentUIEvents(t,n):[`deploymentUIEvents`,`none`],queryFn:async()=>({cursor:0,events:[]}),initialData:{cursor:0,events:[]},staleTime:1/0,enabled:He}),We=(0,M.useMemo)(()=>Gu(Ue.data?.events??[]),[Ue.data?.events]);(0,M.useEffect)(()=>{d(qu(l.nodes,ve,xe,ge)),me.current=Object.fromEntries(l.edges.map(e=>[String(e.id),typeof e.label==`string`?e.label:void 0])),m(Ku(l.edges,fe,ue,me.current,We))},[l.edges,l.nodes,We,fe,ve,xe,ge,m,d,ue]),(0,M.useEffect)(()=>{m(e=>Ku(e,fe,ue,me.current,We))},[We,fe,m,ue]),(0,M.useEffect)(()=>{if(!t||!n||he.current)return;let e=new URLSearchParams(window.location.search),r=e.get(`node`)?.trim(),i=e.get(`action`)?.trim();if(!r||!i){he.current=!0;return}i===`terminal`&&v({id:r}),i===`logs`&&ne({id:r}),i===`describe`&&ie({id:r}),i===`interfaces`&&(Ce({id:r}),Te(!0)),i===`running-config`&&(De({id:r}),Ae(!0)),he.current=!0,e.delete(`node`),e.delete(`action`);let a=e.toString(),o=`${window.location.pathname}${a?`?${a}`:``}${window.location.hash||``}`;window.history.replaceState(null,``,o)},[n,t]),(0,M.useEffect)(()=>{if(!ae)return;let e=()=>y(null),t=e=>{e.key===`Escape`&&y(null)};return window.addEventListener(`click`,e),window.addEventListener(`keydown`,t),()=>{window.removeEventListener(`click`,e),window.removeEventListener(`keydown`,t)}},[ae]);let Ge=r({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return Ta(t,n,e)},onSuccess:(e,t)=>{if(e?.skipped){j.message(`Save config skipped`,{description:e.message||`Node ${t}`});return}j.success(`Save config queued/applied`,{description:e.stdout||`Node ${t}`})},onError:e=>{j.error(`Save config failed`,{description:e?.message??String(e)})}}),Ke=r({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return va(t,n,e)},onSuccess:e=>{let t=e.results.filter(e=>e.error);if(t.length){j.error(`Link admin applied with errors`,{description:t.map(e=>`${e.node}: ${e.error}`).join(`; `)});return}j.success(`Link ${e.action} applied`)},onError:e=>j.error(`Link admin failed`,{description:e?.message??String(e)})}),qe=r({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return ya(t,n,e)},onSuccess:e=>{j.success(`Pcap captured`,{description:`${e.sizeBytes} bytes  ${e.artifactKey}`})},onError:e=>j.error(`Pcap capture failed`,{description:e?.message??String(e)})}),Je=r({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return ba(t,n,e)},onError:e=>j.error(`Failed to load interfaces`,{description:e?.message??String(e)})}),Ye=r({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return xa(t,n,e)},onError:e=>j.error(`Failed to load running config`,{description:e?.message??String(e)})}),Xe=(0,M.useCallback)(async e=>{if(!t)return;let n=await Xa(t,e),r=String(n?.fileData??``);if(!r)throw Error(`missing fileData`);let i=Uint8Array.from(atob(r),e=>e.charCodeAt(0)),a=new Blob([i],{type:`application/vnd.tcpdump.pcap`}),o=URL.createObjectURL(a),s=document.createElement(`a`);s.href=o,s.download=e.split(`/`).pop()||`capture.pcap`,s.click(),URL.revokeObjectURL(o)},[t]),Ze=(0,M.useCallback)(async()=>{if(!t||!n)return;let e=await Sa(t,n,`csv`),r=String(e.csv??``);if(!r.trim())throw Error(`empty inventory csv`);let i=new Blob([r],{type:`text/csv`}),a=URL.createObjectURL(i),o=document.createElement(`a`);o.href=a,o.download=`${n}-inventory.csv`,o.click(),URL.revokeObjectURL(a)},[n,t]);(0,M.useEffect)(()=>{if(!b)return;let e=()=>x(null),t=e=>{e.key===`Escape`&&x(null)};return window.addEventListener(`click`,e),window.addEventListener(`keydown`,t),()=>{window.removeEventListener(`click`,e),window.removeEventListener(`keydown`,t)}},[b]),(0,M.useEffect)(()=>{we&&D?.id&&Je.mutate(D.id)},[Je,D?.id,we]),(0,M.useEffect)(()=>{if(!we||!Ie||!D?.id)return;let e=window.setInterval(()=>{Je.mutate(D.id)},2e3);return()=>window.clearInterval(e)},[Je,Ie,D?.id,we]),(0,M.useEffect)(()=>{ke&&Ee?.id&&Ye.mutate(Ee.id)},[Ye,Ee?.id,ke]);let Qe=(0,M.useCallback)(e=>m(t=>Zt(e,t)),[m]),$e=(0,M.useCallback)((e,r)=>{if(e.preventDefault(),!t||!n)return;let i=g.current?.getBoundingClientRect();x({x:i?e.clientX-i.left:e.clientX,y:i?e.clientY-i.top:e.clientY,node:r})},[n,t]),et=(0,M.useCallback)((e,r)=>{if(!t||!n)return;e.preventDefault();let i=g.current?.getBoundingClientRect();y({x:i?e.clientX-i.left:e.clientX,y:i?e.clientY-i.top:e.clientY,edge:r})},[n,t]),tt=(0,M.useCallback)(async(e,r)=>{if(!(!t||!n))try{C(!0);let i={edgeId:r,action:e};if(e===`set`){let e=Be.delayMs.trim()?Number(Be.delayMs.trim()):void 0,t=Be.jitterMs.trim()?Number(Be.jitterMs.trim()):void 0,n=Be.lossPct.trim()?Number(Be.lossPct.trim()):void 0,r=Be.dupPct.trim()?Number(Be.dupPct.trim()):void 0,a=Be.corruptPct.trim()?Number(Be.corruptPct.trim()):void 0,o=Be.reorderPct.trim()?Number(Be.reorderPct.trim()):void 0,s=Be.rateKbps.trim()?Number(Be.rateKbps.trim()):void 0;Number.isFinite(e)&&(i.delayMs=e),Number.isFinite(t)&&(i.jitterMs=t),Number.isFinite(n)&&(i.lossPct=n),Number.isFinite(r)&&(i.dupPct=r),Number.isFinite(a)&&(i.corruptPct=a),Number.isFinite(o)&&(i.reorderPct=o),Number.isFinite(s)&&(i.rateKbps=s)}let a=(await _a(t,n,i)).results.filter(e=>e.error);a.length?j.error(`Link impairment applied with errors`,{description:a.map(e=>`${e.node}: ${e.error}`).join(`; `)}):j.success(e===`clear`?`Link impairment cleared`:`Link impairment applied`)}catch(e){j.error(`Failed to apply link impairment`,{description:e?.message??String(e)})}finally{C(!1)}},[n,Be.corruptPct,Be.delayMs,Be.dupPct,Be.jitterMs,Be.lossPct,Be.rateKbps,Be.reorderPct,t]);return(0,M.useEffect)(()=>{if(!ue||!t||!n)return;de(null),pe.current=null;let e=`/api/workspaces/${encodeURIComponent(t)}/deployments/${encodeURIComponent(n)}/links/stats/events`,r=new EventSource(e,{withCredentials:!0}),i=e=>{try{let t=JSON.parse(String(e.data??`{}`));if(t.type===`error`){de(t.error||`failed to stream link stats`);return}if(t.type!==`snapshot`||!t.snapshot)return;let n=t.snapshot,r=Date.parse(n.generatedAt||``);if(!Number.isFinite(r))return;let i={};for(let e of n.edges??[])i[String(e.edgeId)]=e;let a=pe.current;if(pe.current={atMs:r,byEdge:i},!a)return;let o=(r-a.atMs)/1e3;if(!(o>0))return;let s={};for(let[e,t]of Object.entries(i)){let n=a.byEdge[e];if(!n)continue;let r=(e,t)=>Math.max(0,e-t),i=r(t.sourceTxBytes,n.sourceTxBytes),c=r(t.sourceRxBytes,n.sourceRxBytes),l=r(t.targetTxBytes,n.targetTxBytes),u=r(t.targetRxBytes,n.targetRxBytes),d=Math.max(i,u)+Math.max(l,c),f=r(t.sourceTxPackets,n.sourceTxPackets),p=r(t.sourceRxPackets,n.sourceRxPackets),m=r(t.targetTxPackets,n.targetTxPackets),h=r(t.targetRxPackets,n.targetRxPackets),g=(Math.max(f,h)+Math.max(m,p))/o,ee=(r(t.sourceRxDropped,n.sourceRxDropped)+r(t.sourceTxDropped,n.sourceTxDropped)+r(t.targetRxDropped,n.targetRxDropped)+r(t.targetTxDropped,n.targetTxDropped))/o;s[e]={bps:d*8/o,pps:g,drops:ee}}E(s)}catch(e){de(e?.message??String(e))}};return r.addEventListener(`stats`,i),r.onerror=()=>de(`link stats stream disconnected`),Ea(t,n).catch(()=>{}),()=>{r.removeEventListener(`stats`,i),r.close()}},[n,ue,t]),(0,P.jsxs)(`div`,{className:`w-full bg-background/50 overflow-hidden relative ${o?`h-full`:`h-[600px]`} border rounded-xl ${s??``}`,ref:g,children:[(0,P.jsxs)(Tn,{nodes:u,edges:p,onNodesChange:f,onEdgesChange:h,onConnect:Qe,onNodeContextMenu:$e,onEdgeContextMenu:et,onEdgeMouseEnter:(e,t)=>{let n=g.current?.getBoundingClientRect(),r=n?e.clientX-n.left:e.clientX,i=n?e.clientY-n.top:e.clientY;ze({id:String(t.id),x:r,y:i})},onEdgeMouseMove:e=>{if(!Re)return;let t=g.current?.getBoundingClientRect(),n=t?e.clientX-t.left:e.clientX,r=t?e.clientY-t.top:e.clientY;ze(e=>e?{...e,x:n,y:r}:null)},onEdgeMouseLeave:()=>ze(null),onNodeDragStop:(e,t)=>{be&&Se(e=>{let n={...e,[String(t.id)]:{x:t.position.x,y:t.position.y}};try{window.localStorage.setItem(be,JSON.stringify(n))}catch{}return n})},nodeTypes:Vu,fitView:!0,className:`bg-muted/10`,children:[(0,P.jsx)(Jt,{position:`top-right`,children:(0,P.jsxs)(L,{className:`shadow-sm border bg-background/85 backdrop-blur`,children:[(0,P.jsx)(R,{className:`p-3 pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`Tools`})}),(0,P.jsxs)(V,{className:`p-3 pt-0 space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2 rounded-md border bg-background/70 px-2 py-1`,children:[(0,P.jsx)(k,{className:`h-4 w-4 text-muted-foreground`}),(0,P.jsx)(K,{value:ge,onChange:e=>_e(e.target.value),placeholder:`Search nodes`,className:`h-7 w-56 border-0 bg-transparent p-0 text-sm focus-visible:ring-0`}),ge.trim()?(0,P.jsx)(F,{variant:`ghost`,size:`sm`,className:`h-7 px-2`,onClick:()=>_e(``),children:`Clear`}):null]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsxs)(F,{variant:ue?`default`:`outline`,size:`sm`,onClick:()=>{w(e=>{let t=!e;return t||(de(null),E({}),pe.current=null),t})},disabled:!t||!n,title:`Show live link utilization (SSE)`,children:[(0,P.jsx)(Cn,{className:`mr-2 h-4 w-4`}),`Live stats`]}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>ye(e=>e===`grid`?`circle`:`grid`),title:`Toggle layout`,children:[(0,P.jsx)(un,{className:`mr-2 h-4 w-4`}),ve===`grid`?`Grid`:`Circle`]}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>{if(Se({}),be)try{window.localStorage.removeItem(be)}catch{}},title:`Reset pinned node positions`,children:`Reset`}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>Ze().catch(e=>j.error(`Failed to download inventory`,{description:e.message})),disabled:!t||!n,title:`Download inventory CSV`,children:`Inventory`}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>g.current&&ee(g.current,`topology.png`),children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`PNG`]})]}),(0,P.jsx)(`div`,{className:`text-[11px] text-muted-foreground`,children:`Tip: Right-click a node or link for actions.`})]})]})}),(0,P.jsx)(an,{}),(0,P.jsx)(St,{zoomable:!0,pannable:!0,className:`bg-background border rounded-lg`}),(0,P.jsx)(A,{gap:12,size:1})]}),ue&&T?(0,P.jsxs)(`div`,{className:`absolute bottom-2 left-2 z-40 rounded-md border bg-background/90 px-3 py-2 text-xs text-muted-foreground shadow-sm`,children:[`Live stats: `,T]}):null,Re&&ue&&fe[Re.id]?(0,P.jsxs)(`div`,{className:`absolute z-40 rounded-md border bg-background/90 px-3 py-2 text-xs shadow-sm`,style:{left:Re.x+12,top:Re.y+12},children:[(0,P.jsx)(`div`,{className:`font-mono`,children:Re.id}),(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[Uu(fe[Re.id].bps),` `,` `,Math.round(fe[Re.id].pps),` pps `,` `,fe[Re.id].drops.toFixed(1),` drops/s`]})]}):null,He&&(Ue.data?.events?.length??0)>0?(0,P.jsx)(`div`,{className:`absolute bottom-2 right-2 z-40 w-[420px] max-w-[92vw]`,children:(0,P.jsxs)(L,{className:`shadow-sm border bg-background/90 backdrop-blur`,children:[(0,P.jsx)(R,{className:`p-3 pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`Recent activity`})}),(0,P.jsx)(V,{className:`p-3 pt-0 space-y-2`,children:(Ue.data?.events??[]).slice(-8).reverse().map(e=>(0,P.jsxs)(`div`,{className:`flex items-start justify-between gap-2 text-xs`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(`div`,{className:`font-mono truncate`,children:e.eventType}),(0,P.jsx)(`div`,{className:`text-muted-foreground truncate`,children:e.createdAt})]}),(0,P.jsx)(`div`,{className:`text-muted-foreground font-mono truncate`,children:e.createdBy?e.createdBy:``})]},String(e.id)))})]})}):null,a&&t&&n?(0,P.jsx)(Ru,{open:!!_,onOpenChange:e=>{e||v(null)},workspaceId:t,deploymentId:n,nodeId:_?.id??``,nodeKind:_?.kind??``}):null,t&&n?(0,P.jsx)(Pu,{open:!!te,onOpenChange:e=>{e||ne(null)},workspaceId:t,deploymentId:n,nodeId:te?.id??``,nodeKind:te?.kind??``,nodeIp:te?.ip??``}):null,t&&n?(0,P.jsx)(Mu,{open:!!re,onOpenChange:e=>{e||ie(null)},workspaceId:t,deploymentId:n,nodeId:re?.id??``,nodeKind:re?.kind??``,nodeIp:re?.ip??``}):null,(0,P.jsx)(tr,{open:we,onOpenChange:e=>{Te(e),e||Ce(null)},children:(0,P.jsxs)(ir,{className:`max-w-3xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{children:`Interfaces`})}),(0,P.jsx)(Ju,{node:D?.id??``,data:Je.data,loading:Je.isPending,error:Je.isError?Je.error?.message??`failed`:``,autoRefresh:Ie,onToggleAutoRefresh:()=>Le(e=>!e)})]})}),(0,P.jsx)(tr,{open:ke,onOpenChange:e=>{Ae(e),e||De(null)},children:(0,P.jsxs)(ir,{className:`max-w-4xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{children:`Running config`})}),(0,P.jsx)(Yu,{node:Ee?.id??``,data:Ye.data,loading:Ye.isPending,error:Ye.isError?Ye.error?.message??`failed`:``})]})}),b&&t&&n?(0,P.jsx)(`div`,{className:`absolute z-50`,style:{left:b.x,top:b.y},onContextMenu:e=>e.preventDefault(),children:(0,P.jsxs)(L,{className:`w-64 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,P.jsxs)(R,{className:`p-3 pb-2`,children:[(0,P.jsx)(z,{className:`text-sm`,children:`Node Actions`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:String(b.node?.data?.label??b.node.id)})]}),(0,P.jsxs)(V,{className:`p-3 pt-0 space-y-2`,children:[(0,P.jsx)(F,{size:`sm`,className:`w-full`,disabled:!a,onClick:()=>{let e=String(b.node?.data?.kind??``);x(null),v({id:String(b.node.id),kind:e})},children:`Open terminal`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,className:`w-full`,disabled:!a,onClick:()=>{let e=String(b.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=terminal`;window.open(t,`_blank`,`noopener,noreferrer`),x(null)},children:`Open terminal (new tab)`}),(0,P.jsx)(F,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(b.node?.data?.kind??``),t=String(b.node?.data?.ip??``);x(null),ne({id:String(b.node.id),kind:e,ip:t})},children:`View logs`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(b.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=logs`;window.open(t,`_blank`,`noopener,noreferrer`),x(null)},children:`View logs (new tab)`}),(0,P.jsx)(F,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(b.node?.data?.kind??``),t=String(b.node?.data?.ip??``);x(null),ie({id:String(b.node.id),kind:e,ip:t})},children:`Describe`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(b.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=describe`;window.open(t,`_blank`,`noopener,noreferrer`),x(null)},children:`Describe (new tab)`}),(0,P.jsx)(F,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(b.node?.data?.kind??``),t=String(b.node?.data?.ip??``),n=String(b.node.id);x(null),Ce({id:n,kind:e,ip:t}),Te(!0)},children:`Interfaces`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(b.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=interfaces`;window.open(t,`_blank`,`noopener,noreferrer`),x(null)},children:`Interfaces (new tab)`}),(0,P.jsx)(F,{size:`sm`,variant:`secondary`,className:`w-full`,disabled:Ge.isPending,onClick:()=>{let e=String(b.node.id);x(null),Ge.mutate(e)},children:Ge.isPending?`Saving`:`Save config`}),(0,P.jsx)(F,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(b.node.id);x(null),De({id:e}),Ae(!0)},children:`Running config`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(b.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=running-config`;window.open(t,`_blank`,`noopener,noreferrer`),x(null)},children:`Running config (new tab)`}),(0,P.jsx)(F,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>{let e=String(b.node?.data?.ip??``).trim();if(!e){j.error(`No management IP available`);return}navigator.clipboard?.writeText(e),j.success(`Copied management IP`),x(null)},children:`Copy management IP`}),(0,P.jsx)(F,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>{let e=String(b.node.id);navigator.clipboard?.writeText(e),j.success(`Copied node name`),x(null)},children:`Copy node name`}),(0,P.jsx)(F,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>{let e=String(b.node?.data?.ip??``).trim();if(!e){j.error(`No management IP available`);return}let t=`ssh admin@${e}`;navigator.clipboard?.writeText(t),j.success(`Copied SSH command`),x(null)},children:`Copy SSH command`}),(0,P.jsx)(F,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>x(null),children:`Close`})]})]})}):null,ae&&t&&n?(0,P.jsx)(`div`,{className:`absolute z-50`,style:{left:ae.x,top:ae.y},onContextMenu:e=>e.preventDefault(),children:(0,P.jsxs)(L,{className:`w-64 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,P.jsxs)(R,{className:`p-3 pb-2`,children:[(0,P.jsx)(z,{className:`text-sm`,children:`Link Actions`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:String(ae.edge.label??ae.edge.id)})]}),(0,P.jsxs)(V,{className:`p-3 pt-0 space-y-2`,children:[(0,P.jsx)(F,{size:`sm`,variant:We.edgeDown.has(String(ae.edge.id))?`secondary`:`destructive`,className:`w-full`,disabled:Ke.isPending,onClick:()=>{let e=String(ae.edge.id),t=We.edgeDown.has(e);y(null),Ke.mutate({edgeId:e,action:t?`up`:`down`})},children:We.edgeDown.has(String(ae.edge.id))?`Bring link up`:`Bring link down`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,className:`w-full`,disabled:qe.isPending,onClick:()=>{Ne({id:String(ae.edge.id),label:String(ae.edge.label??``)}),y(null),Me(!0)},children:`Capture pcap`}),We.lastCaptureByEdge[String(ae.edge.id)]?(0,P.jsx)(F,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=We.lastCaptureByEdge[String(ae.edge.id)];y(null),Xe(e).catch(e=>j.error(`Failed to download pcap`,{description:e.message}))},children:`Download last pcap`}):null,(0,P.jsx)(F,{size:`sm`,className:`w-full`,onClick:()=>{oe({id:String(ae.edge.id),label:String(ae.edge.label??``)}),y(null),ce(!0)},children:`Configure impairment`}),(0,P.jsx)(F,{size:`sm`,variant:`secondary`,className:`w-full`,disabled:le,onClick:()=>{let e=String(ae.edge.id);y(null),tt(`clear`,e)},children:`Clear impairment`}),(0,P.jsx)(F,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>y(null),children:`Close`})]})]})}):null,(0,P.jsx)(tr,{open:je,onOpenChange:e=>{Me(e),e||Ne(null)},children:(0,P.jsxs)(ir,{className:`max-w-lg`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{children:`Capture pcap`})}),(0,P.jsxs)(`div`,{className:`space-y-4`,children:[O?.label?(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:O.label}):null,(0,P.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{htmlFor:`capSide`,children:`Side`}),(0,P.jsxs)(`select`,{id:`capSide`,className:`h-9 w-full rounded-md border bg-background px-3 text-sm`,value:Pe.side,onChange:e=>Fe(t=>({...t,side:e.target.value})),children:[(0,P.jsx)(`option`,{value:`source`,children:`Source`}),(0,P.jsx)(`option`,{value:`target`,children:`Target`})]})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{htmlFor:`capDuration`,children:`Duration (s)`}),(0,P.jsx)(K,{id:`capDuration`,inputMode:`numeric`,value:Pe.duration,onChange:e=>Fe(t=>({...t,duration:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{htmlFor:`capPackets`,children:`Max packets`}),(0,P.jsx)(K,{id:`capPackets`,inputMode:`numeric`,value:Pe.packets,onChange:e=>Fe(t=>({...t,packets:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{htmlFor:`capSnaplen`,children:`Snaplen`}),(0,P.jsx)(K,{id:`capSnaplen`,inputMode:`numeric`,value:Pe.snaplen,onChange:e=>Fe(t=>({...t,snaplen:e.target.value}))})]})]}),(0,P.jsxs)(`div`,{className:`flex gap-2 justify-end`,children:[(0,P.jsx)(F,{variant:`secondary`,onClick:()=>Me(!1),disabled:qe.isPending,children:`Cancel`}),(0,P.jsx)(F,{onClick:()=>{let e=String(O?.id??``);if(!e){j.error(`No link selected`);return}let t=Number(Pe.duration.trim()||`10`),n=Number(Pe.packets.trim()||`2500`),r=Number(Pe.snaplen.trim()||`192`);qe.mutateAsync({edgeId:e,side:Pe.side,durationSeconds:t,maxPackets:n,snaplen:r}).then(e=>(j.success(`Pcap ready`,{description:e.artifactKey}),Xe(e.artifactKey).catch(()=>{}))).finally(()=>Me(!1))},disabled:qe.isPending,children:qe.isPending?`Capturing`:`Capture`})]})]})]})}),(0,P.jsx)(tr,{open:se,onOpenChange:e=>{ce(e),e||oe(null)},children:(0,P.jsxs)(ir,{className:`max-w-lg`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{children:`Configure Link Impairment`})}),(0,P.jsxs)(`div`,{className:`space-y-4`,children:[S?.label?(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:S.label}):null,(0,P.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{htmlFor:`delayMs`,children:`Delay (ms)`}),(0,P.jsx)(K,{id:`delayMs`,inputMode:`numeric`,placeholder:`e.g. 50`,value:Be.delayMs,onChange:e=>Ve(t=>({...t,delayMs:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{htmlFor:`jitterMs`,children:`Jitter (ms)`}),(0,P.jsx)(K,{id:`jitterMs`,inputMode:`numeric`,placeholder:`e.g. 10`,value:Be.jitterMs,onChange:e=>Ve(t=>({...t,jitterMs:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{htmlFor:`lossPct`,children:`Loss (%)`}),(0,P.jsx)(K,{id:`lossPct`,inputMode:`decimal`,placeholder:`e.g. 1.0`,value:Be.lossPct,onChange:e=>Ve(t=>({...t,lossPct:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{htmlFor:`dupPct`,children:`Duplicate (%)`}),(0,P.jsx)(K,{id:`dupPct`,inputMode:`decimal`,placeholder:`e.g. 0.1`,value:Be.dupPct,onChange:e=>Ve(t=>({...t,dupPct:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{htmlFor:`corruptPct`,children:`Corrupt (%)`}),(0,P.jsx)(K,{id:`corruptPct`,inputMode:`decimal`,placeholder:`e.g. 0.05`,value:Be.corruptPct,onChange:e=>Ve(t=>({...t,corruptPct:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{htmlFor:`reorderPct`,children:`Reorder (%)`}),(0,P.jsx)(K,{id:`reorderPct`,inputMode:`decimal`,placeholder:`e.g. 0.2`,value:Be.reorderPct,onChange:e=>Ve(t=>({...t,reorderPct:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{htmlFor:`rateKbps`,children:`Rate (kbit/s)`}),(0,P.jsx)(K,{id:`rateKbps`,inputMode:`numeric`,placeholder:`e.g. 100000`,value:Be.rateKbps,onChange:e=>Ve(t=>({...t,rateKbps:e.target.value}))})]})]}),(0,P.jsxs)(`div`,{className:`flex gap-2 justify-end`,children:[(0,P.jsx)(F,{variant:`secondary`,onClick:()=>ce(!1),disabled:le,children:`Cancel`}),(0,P.jsx)(F,{onClick:()=>{let e=String(S?.id??``);if(!e){j.error(`No link selected`);return}tt(`set`,e).finally(()=>ce(!1))},disabled:le,children:`Apply`})]})]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Tip: Right-click a link in the topology to configure impairment.`})]})})]})}function Uu(e){return e>0?e>=1e9?`${(e/1e9).toFixed(2)} Gbps`:e>=1e6?`${(e/1e6).toFixed(1)} Mbps`:e>=1e3?`${(e/1e3).toFixed(0)} Kbps`:`${Math.round(e)} bps`:`0 bps`}function Wu(e){if(!Number.isFinite(e)||e<=0)return`0 B`;let t=[`B`,`KB`,`MB`,`GB`,`TB`],n=e,r=0;for(;n>=1024&&r<t.length-1;)n/=1024,r++;let i=r===0||r===1?0:1;return`${n.toFixed(i)} ${t[r]}`}function Gu(e){let t=new Set,n={};for(let r of e??[]){let e=String(r?.eventType??``),i=r?.payload??{},a=String(i?.edgeId??``).trim();if(a&&(e===`link.down`&&t.add(a),e===`link.up`&&t.delete(a),e===`link.capture`)){let e=String(i?.artifactKey??``).trim();e&&(n[a]=e)}}return{edgeDown:t,lastCaptureByEdge:n}}function Ku(e,t,n,r,i){return e.map(e=>{let a=String(e.id),o=r[a]??(typeof e.label==`string`?e.label:void 0),s=i.edgeDown.has(a);if(!n)return{...e,label:s?o?`${o}  DOWN`:`DOWN`:o,animated:!1,style:s?{stroke:`hsl(var(--destructive))`,strokeWidth:2,strokeDasharray:`6 6`}:void 0};let c=t[a];if(!c)return{...e,label:s?o?`${o}  DOWN`:`DOWN`:o,animated:!1,style:s?{stroke:`hsl(var(--destructive))`,strokeWidth:2,strokeDasharray:`6 6`}:void 0};let l=c.bps??0,u=1+Math.min(9,Math.log10(Math.max(1,l))/1.2),d=o?`${o}  ${Uu(l)}`:Uu(l),f=s?`${d}  DOWN`:d;return{...e,label:f,animated:!s&&l>0,style:{...e.style??{},strokeWidth:u,...s?{stroke:`hsl(var(--destructive))`,strokeDasharray:`6 6`}:{}}}})}function qu(e,t,n,r){let i=r.trim().toLowerCase(),a=new Set;if(i)for(let t of e){let e=String(t?.data?.label??t.id).toLowerCase(),n=String(t.id).toLowerCase(),r=String(t?.data?.ip??``).toLowerCase();(e.includes(i)||n.includes(i)||r.includes(i))&&a.add(String(t.id))}let o=e.length||1,s=Math.max(260,o*30);return e.map((e,r)=>{let c=String(e.id),l=n[c],u=l??e.position;if(!l&&t===`circle`){let e=r/o*Math.PI*2;u={x:Math.cos(e)*s,y:Math.sin(e)*s}}let d=i?a.has(c):!1,f=i?!a.has(c):!1;return{...e,position:u,data:{...e.data,highlight:d},style:f?{...e.style??{},opacity:.25}:e.style}})}function Ju(e){if(e.loading)return(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading`});if(e.error)return(0,P.jsx)(`div`,{className:`text-sm text-destructive`,children:e.error});let t=e.data?.interfaces??[];return t.length?(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:e.node}),(0,P.jsx)(F,{size:`sm`,variant:e.autoRefresh?`default`:`outline`,onClick:e.onToggleAutoRefresh,children:e.autoRefresh?`Auto refresh: on`:`Auto refresh: off`})]}),(0,P.jsx)(`div`,{className:`rounded-md border overflow-auto max-h-[60vh]`,children:(0,P.jsxs)(`table`,{className:`w-full text-xs`,children:[(0,P.jsx)(`thead`,{className:`bg-muted/50 sticky top-0`,children:(0,P.jsxs)(`tr`,{children:[(0,P.jsx)(`th`,{className:`text-left p-2`,children:`Interface`}),(0,P.jsx)(`th`,{className:`text-left p-2`,children:`Peer`}),(0,P.jsx)(`th`,{className:`text-left p-2`,children:`State`}),(0,P.jsx)(`th`,{className:`text-right p-2`,children:`RX`}),(0,P.jsx)(`th`,{className:`text-right p-2`,children:`TX`}),(0,P.jsx)(`th`,{className:`text-right p-2`,children:`Drops`})]})}),(0,P.jsx)(`tbody`,{children:t.map(e=>(0,P.jsxs)(`tr`,{className:`border-t`,children:[(0,P.jsx)(`td`,{className:`p-2 font-mono`,children:e.ifName}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-muted-foreground`,children:e.peerNode?`${e.peerNode}:${e.peerIf??``}`:``}),(0,P.jsx)(`td`,{className:`p-2`,children:e.operState??``}),(0,P.jsx)(`td`,{className:`p-2 text-right font-mono`,children:Wu(Number(e.rxBytes??0))}),(0,P.jsx)(`td`,{className:`p-2 text-right font-mono`,children:Wu(Number(e.txBytes??0))}),(0,P.jsx)(`td`,{className:`p-2 text-right font-mono`,children:Number(e.rxDropped??0)+Number(e.txDropped??0)})]},e.ifName))})]})})]}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No interfaces found.`})}function Yu(e){if(e.loading)return(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading`});if(e.error)return(0,P.jsx)(`div`,{className:`text-sm text-destructive`,children:e.error});if(e.data?.skipped)return(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:e.data.message||`Skipped`});let t=String(e.data?.stdout??``);return(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:e.node}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(t),j.success(`Copied running config`)},disabled:!t,children:`Copy`})]}),(0,P.jsx)(`pre`,{className:`max-h-[65vh] overflow-auto rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100 whitespace-pre-wrap`,children:t||`No output`}),e.data?.stderr?(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground whitespace-pre-wrap`,children:e.data.stderr}):null]})}const Xu=t(`/dashboard/labs/map`)({component:Qu});function Zu(e){let t=$n.parse(String(e??``))?.topology??{},n=t?.nodes??{},r=Object.entries(n).map(([e,t])=>{let n=String(t?.kind??``);return{id:String(e),label:String(e),kind:n,status:`unknown`,mgmtIp:``}}),i=[],a=Array.isArray(t?.links)?t.links:[];for(let e=0;e<a.length;e++){let t=a[e],n=Array.isArray(t?.endpoints)?t.endpoints:[];if(n.length!==2)continue;let r=String(n[0]??``),o=String(n[1]??``),s=r.split(`:`)[0],c=o.split(`:`)[0];!s||!c||i.push({id:`e${e+1}`,source:s,target:c,label:`${r}  ${o}`})}return{nodes:r,edges:i}}function Qu(){let e=Xu.useSearch(),t=String(e?.workspaceId??``),n=String(e?.source??`workspace`),r=String(e?.dir??`containerlab/designer`),a=String(e?.file??``),o=i({queryKey:H.workspaces(),queryFn:Hr,retry:!1,staleTime:3e4}),s=i({queryKey:t?[`containerlabTemplateMap`,t,n,r,a]:[`containerlabTemplateMap`,`none`],queryFn:async()=>{if(!t)throw Error(`workspaceId is required`);if(!a)throw Error(`file is required`);return Ma(t,{source:n,dir:r,file:a})},enabled:!!t&&!!a,retry:!1,staleTime:3e4}),c=(0,M.useMemo)(()=>{if(!s.data?.yaml)return null;try{return Zu(s.data.yaml)}catch{return null}},[s.data?.yaml]);return!t||!a?(0,P.jsx)(`div`,{className:`h-screen w-screen p-6`,children:(0,P.jsxs)(`div`,{className:`max-w-2xl space-y-4`,children:[(0,P.jsx)(`div`,{className:`text-2xl font-bold tracking-tight`,children:`Lab map`}),(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Open this page from the Lab Designer Open map button, or provide query params.`}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Parameters`})}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Workspace`}),(0,P.jsx)(K,{value:t,readOnly:!0,placeholder:o.isLoading?`Loading`:`workspaceId missing`})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`File`}),(0,P.jsx)(K,{value:a,readOnly:!0,placeholder:`file missing`})]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Example:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`/dashboard/labs/map?workspaceId=<id>&source=workspace&dir=containerlab/designer&file=lab.clab.yml`})]})]})]})]})}):s.isLoading||s.isFetching?(0,P.jsxs)(`div`,{className:`h-screen w-screen p-6`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(U,{className:`h-9 w-9`}),(0,P.jsx)(U,{className:`h-8 w-64`})]}),(0,P.jsx)(`div`,{className:`mt-6`,children:(0,P.jsx)(U,{className:`h-[75vh] w-full`})})]}):!s.data||!c?(0,P.jsx)(`div`,{className:`h-screen w-screen p-6`,children:(0,P.jsx)(ec,{title:`Map unavailable`,description:s.isError?`Failed to load template.`:`Template YAML could not be parsed into a topology.`,action:{label:`Close`,onClick:()=>window.close()}})}):(0,P.jsxs)(`div`,{className:`h-screen w-screen flex flex-col bg-background`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3 border-b px-4 py-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3 min-w-0`,children:[(0,P.jsx)(p,{to:`/dashboard/labs/designer`,search:{},className:Cr({variant:`outline`,size:`icon`,className:`h-9 w-9`}),title:`Back to designer`,children:(0,P.jsx)(ee,{className:`h-4 w-4`})}),(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(`div`,{className:`font-semibold truncate`,children:`Lab map`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:s.data.path})]})]}),(0,P.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>{navigator.clipboard?.writeText(s.data.yaml)},children:`Copy YAML`})})]}),(0,P.jsxs)(`div`,{className:`flex-1 min-h-0 grid grid-cols-1 lg:grid-cols-[1fr_520px]`,children:[(0,P.jsx)(`div`,{className:`min-h-0 p-3`,children:(0,P.jsx)(`div`,{className:`h-full rounded-xl border overflow-hidden`,children:(0,P.jsx)(Hu,{topology:c,workspaceId:t,enableTerminal:!1,fullHeight:!0})})}),(0,P.jsx)(`div`,{className:`min-h-0 border-l bg-background p-3`,children:(0,P.jsxs)(L,{className:`h-full`,children:[(0,P.jsx)(R,{className:`pb-3`,children:(0,P.jsx)(z,{children:`YAML`})}),(0,P.jsx)(V,{className:`h-[calc(100%-56px)]`,children:(0,P.jsx)(ul,{value:s.data.yaml,readOnly:!0,className:`h-full font-mono text-xs`})})]})})]})]})}function $u(e){let[t,n]=(0,M.useState)(``),[r,a]=(0,M.useState)(``),[o,s]=(0,M.useState)(``),c=i({queryKey:H.registryRepos(t),queryFn:async()=>Va({q:t,n:500}),retry:!1,staleTime:3e4}),l=i({queryKey:o?H.registryTags(o,r):[`registryTags`,`none`],queryFn:async()=>Ha(o,{q:r}),enabled:!!o,retry:!1,staleTime:3e4}),u=(0,M.useMemo)(()=>{let t=(e.value||``).trim(),n=t.lastIndexOf(`:`);return n<=0?{repo:t,tag:``}:{repo:t.slice(0,n),tag:t.slice(n+1)}},[e.value]);return(0,P.jsxs)(`div`,{className:`space-y-3 ${e.className??``}`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Image`}),(0,P.jsx)(K,{value:e.value,onChange:t=>e.onChange(t.target.value),placeholder:`repo:tag`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:"Registry-backed picker. Requires server env `SKYFORGE_REGISTRY_URL`."})]}),(0,P.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(G,{children:`Repository`}),(0,P.jsx)(F,{size:`sm`,variant:`ghost`,onClick:()=>{u.repo&&(s(u.repo),j.message(`Repository selected`,{description:u.repo}))},children:`Use current`})]}),(0,P.jsx)(K,{value:t,onChange:e=>n(e.target.value),placeholder:`Search repos`}),(0,P.jsx)(`div`,{className:`max-h-40 overflow-auto rounded-md border`,children:c.isError?(0,P.jsx)(`div`,{className:`p-2 text-xs text-destructive`,children:`Failed to load repos.`}):c.isLoading?(0,P.jsx)(`div`,{className:`p-2 text-xs text-muted-foreground`,children:`Loading`}):(0,P.jsx)(`div`,{className:`divide-y`,children:(c.data?.repositories??[]).slice(0,200).map(e=>(0,P.jsx)(`button`,{type:`button`,className:`w-full text-left px-2 py-1.5 text-xs font-mono hover:bg-accent ${o===e?`bg-accent`:``}`,onClick:()=>s(e),children:e},e))})})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(G,{children:`Tag`}),(0,P.jsx)(F,{size:`sm`,variant:`ghost`,onClick:()=>{if(!o)return;let t=`${o}:${u.tag||`latest`}`;e.onChange(t)},disabled:!o,children:`Set image`})]}),(0,P.jsx)(K,{value:r,onChange:e=>a(e.target.value),placeholder:`Search tags`,disabled:!o}),(0,P.jsx)(`div`,{className:`max-h-40 overflow-auto rounded-md border`,children:o?l.isError?(0,P.jsx)(`div`,{className:`p-2 text-xs text-destructive`,children:`Failed to load tags.`}):l.isLoading?(0,P.jsx)(`div`,{className:`p-2 text-xs text-muted-foreground`,children:`Loading`}):(0,P.jsx)(`div`,{className:`divide-y`,children:(l.data?.tags??[]).slice(0,300).map(t=>(0,P.jsx)(`button`,{type:`button`,className:`w-full text-left px-2 py-1.5 text-xs font-mono hover:bg-accent`,onClick:()=>e.onChange(`${o}:${t}`),children:t},t))}):(0,P.jsx)(`div`,{className:`p-2 text-xs text-muted-foreground`,children:`Select a repo`})})]})]})]})}function ed(e){let t=String(e??``).trim();return t&&t.toLowerCase().replace(/[^a-z0-9-]+/g,`-`).replace(/^-+|-+$/g,``).slice(0,48)||`node`}function td(e){let t=new Set,n=new Map;for(let r of e){let e=ed(r.id||r.label||`node`),i=e,a=2;for(;t.has(i);)i=`${e}-${a++}`;t.add(i),n.set(r.id,i)}return n}function nd(e){let t=[],n=ed(e.name||`lab`),r=td(e.nodes),i=new Map,a=e=>{let t=(i.get(e)??0)+1;return i.set(e,t),`eth${t}`},o={};for(let n of e.nodes){let e=r.get(n.id)||ed(n.id),i=String(n.id||n.label||``).trim();i&&ed(i)!==i&&t.push(`Node ${i}: name will be '${ed(i)}'`),i&&ed(i)!==e&&t.push(`Node ${i}: name adjusted to '${e}'`);let a=(n.kind||``).trim()||void 0,s=(n.image||``).trim()||void 0;s||t.push(`Node ${e}: missing image`),o[e]={...a?{kind:a}:{},...s?{image:s}:{},...n.env&&Object.keys(n.env).length?{env:n.env}:{},...n.mgmtIpv4?{mgmt_ipv4:n.mgmtIpv4}:{}}}let s=[];for(let n of e.links){let e=r.get(n.source),i=r.get(n.target);if(!e||!i){t.push(`Link ${n.id}: missing endpoint(s)`);continue}let o=a(n.source),c=a(n.target);s.push({endpoints:[`${e}:${o}`,`${i}:${c}`]})}let c={name:n,topology:{nodes:o,...s.length?{links:s}:{}}},l=(e,t=0)=>{let n=`  `.repeat(t);if(e==null)return`null`;if(typeof e==`string`)return JSON.stringify(e);if(typeof e==`number`||typeof e==`boolean`)return String(e);if(Array.isArray(e))return e.length===0?`[]`:e.map(e=>{if(typeof e==`object`&&e&&!Array.isArray(e)){let r=l(e,t+1).split(`
`);return`${n}- ${r[0].trimStart()}\n${r.slice(1).map(e=>`${n}  ${e}`).join(`
`)}`}return`${n}- ${l(e,0)}`}).join(`
`);if(typeof e==`object`){let r=Object.keys(e);return r.length===0?`{}`:r.map(r=>{let i=e[r];return i===void 0?``:typeof i==`object`&&i?`${n}${r}:\n${l(i,t+1)}`:`${n}${r}: ${l(i,0)}`}).filter(Boolean).join(`
`)}return JSON.stringify(String(e))};return{yaml:l(c,0)+`
`,warnings:t}}var rd=Qn({workspaceId:qn().optional().catch(``),importDeploymentId:qn().optional().catch(``)});const id=t(`/dashboard/labs/designer`)({validateSearch:e=>rd.parse(e),component:dd});var ad=`application/x-skyforge-palette-item`;function od(e){let t=String(e??``).trim();if(!t)return``;try{return new URL(t).hostname||t}catch{return t.replace(/^https?:\/\//,``).split(`/`)[0]??t}}function sd(e){let t=String(e??``).trim().replace(/^\/+|\/+$/g,``),n=t.toLowerCase(),r=t.split(`/`).pop()??t,i=e=>({id:`${e.kind}:${e.repo??``}`,...e});return n.includes(`endhost`)||n.includes(`linux`)||n.includes(`ubuntu`)||n.includes(`alpine`)?i({label:`Host  ${r}`,category:`Hosts`,kind:`linux`,repo:t,vendor:`Linux`,model:r,role:`host`}):r===`ceos`||n.endsWith(`/ceos`)||n.includes(`/ceos:`)?i({label:`Switch  Arista cEOS`,category:`Switches`,kind:`ceos`,repo:t,vendor:`Arista`,model:`cEOS`,role:`switch`}):n.includes(`vrnetlab/cisco_iol`)?i({label:`Router  Cisco IOL (IOS)`,category:`Routers`,kind:`cisco_iol`,repo:t,vendor:`Cisco`,model:`IOL`,role:`router`}):n.includes(`vrnetlab/cisco_viosl2`)?i({label:`Switch  Cisco vIOS L2`,category:`Switches`,kind:`cisco_viosl2`,repo:t,vendor:`Cisco`,model:`vIOS L2`,role:`switch`}):n.includes(`vrnetlab/vr-n9kv`)||n.includes(`vrnetlab/nxos`)?i({label:`Switch  Cisco NX-OSv (N9Kv)`,category:`Switches`,kind:`vr-n9kv`,repo:t,vendor:`Cisco`,model:`NX-OSv9k`,role:`switch`}):n.includes(`vrnetlab/vr-vmx`)||n.includes(`/vr-vmx`)?i({label:`Router  Juniper vMX`,category:`Routers`,kind:`vr-vmx`,repo:t,vendor:`Juniper`,model:`vMX`,role:`router`}):n.includes(`vrnetlab/juniper_vjunos-router`)?i({label:`Router  Juniper vJunos Router`,category:`Routers`,kind:`juniper_vjunos-router`,repo:t,vendor:`Juniper`,model:`vJunos-router`,role:`router`}):n.includes(`vrnetlab/juniper_vjunos-switch`)?i({label:`Switch  Juniper vJunos Switch`,category:`Switches`,kind:`juniper_vjunos-switch`,repo:t,vendor:`Juniper`,model:`vJunos-switch`,role:`switch`}):n.includes(`vrnetlab/juniper_vsrx`)||n.includes(`vr-vsrx`)||n.includes(`vsrx`)||n.includes(`/srx`)?i({label:`Firewall  Juniper SRX`,category:`Firewalls`,kind:`vr-vsrx`,repo:t,vendor:`Juniper`,model:`SRX`,role:`firewall`}):n.includes(`vrnetlab/vr-fortios`)||n.includes(`fortios`)?i({label:`Firewall  Fortinet FortiOS`,category:`Firewalls`,kind:`vr-fortios`,repo:t,vendor:`Fortinet`,model:`FortiOS`,role:`firewall`}):n.includes(`vrnetlab/vr-ftosv`)||n.includes(`os10`)?i({label:`Switch  Dell OS10`,category:`Switches`,kind:`vr-ftosv`,repo:t,vendor:`Dell`,model:`OS10`,role:`switch`}):n.includes(`vrnetlab/`)&&(n.includes(`asa`)||n.includes(`pan`)||n.includes(`palo`)||n.includes(`checkpoint`))?i({label:`Firewall  ${r}`,category:`Firewalls`,kind:r,repo:t,role:`firewall`}):i({label:`Node  ${r}`,category:`Other`,kind:r,repo:t,role:`other`})}function cd(e){let t=e.item,n=t.role===`firewall`?Ce:t.role===`host`?st:Le,r=t.vendor?`${t.vendor}${t.model?`  ${t.model}`:``}`:t.label,i=t.role===`router`?`Router`:t.role===`switch`?`Switch`:t.role===`firewall`?`Firewall`:t.role===`host`?`Host`:`Node`;return(0,P.jsx)(`div`,{className:`cursor-grab select-none rounded-lg border bg-background px-3 py-2 text-sm hover:bg-accent`,draggable:!0,onDragStart:e=>{e.dataTransfer.setData(ad,JSON.stringify(t)),e.dataTransfer.effectAllowed=`copy`},title:t.repo?`${t.label}\n${t.repo}`:t.label,children:(0,P.jsxs)(`div`,{className:`flex items-start gap-2`,children:[(0,P.jsx)(n,{className:`mt-0.5 h-4 w-4 text-muted-foreground`}),(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsxs)(`div`,{className:`truncate flex items-center gap-2`,children:[(0,P.jsx)(`span`,{className:`truncate`,children:r}),(0,P.jsx)(`span`,{className:`shrink-0 rounded-full bg-muted px-2 py-0.5 text-[10px] font-medium text-muted-foreground`,children:i})]}),(0,P.jsx)(`div`,{className:`truncate text-[11px] text-muted-foreground font-mono`,children:t.repo??t.kind})]})]})})}async function ld(e){let t=String(e.repo??``).trim().replace(/^\/+|\/+$/g,``);if(!t)return`latest`;try{let n=await e.queryClient.fetchQuery({queryKey:H.registryTags(t,``),queryFn:async()=>Ha(t,{q:``}),retry:!1,staleTime:3e4}),r=Array.isArray(n?.tags)?n.tags:[];return r.includes(`latest`)?`latest`:r.length>0?String(r[r.length-1]):`latest`}catch{return`latest`}}function ud(e){let t=String(e.data?.kind??``),n=String(e.data?.label??e.id),r=t.toLowerCase(),i=r.includes(`forti`)||r.includes(`vsrx`)||r.includes(`srx`)||r.includes(`asa`)||r.includes(`pan`),a=r.includes(`linux`)||r.includes(`host`),o=i?Ce:a?st:_e,s=i?`border-amber-500/60`:a?`border-emerald-500/60`:`border-sky-500/60`;return(0,P.jsxs)(`div`,{className:[`rounded-xl border bg-background/95 px-3 py-2 shadow-sm min-w-[140px]`,e.selected?`ring-2 ring-primary/60`:``,s].join(` `),children:[(0,P.jsx)(vn,{type:`target`,position:ln.Top}),(0,P.jsx)(vn,{type:`target`,position:ln.Left}),(0,P.jsx)(vn,{type:`source`,position:ln.Right}),(0,P.jsx)(vn,{type:`source`,position:ln.Bottom}),(0,P.jsxs)(`div`,{className:`flex items-start gap-2`,children:[(0,P.jsx)(`div`,{className:`mt-0.5 rounded-md border bg-muted p-1.5`,children:(0,P.jsx)(o,{className:`h-4 w-4`})}),(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(`div`,{className:`font-medium leading-tight truncate`,children:n}),(0,P.jsx)(`div`,{className:`text-[11px] text-muted-foreground truncate`,children:t||`node`})]})]})]})}function dd(){let e=id.useSearch(),t=String(e.importDeploymentId??``).trim(),n=`skyforge.labDesigner.v1`,a=(0,M.useRef)(null),o=c(),[s,l]=(0,M.useState)(`lab`),[u,d]=(0,M.useState)(``),[f,p]=(0,M.useState)(`clabernetes`),[m,h]=(0,M.useState)(``),[g,ee]=(0,M.useState)(!0),[v,ne]=(0,M.useState)(null),[re,ie]=(0,M.useState)(`containerlab/designer`),[ae,y]=(0,M.useState)(``),[b,x]=(0,M.useState)(!0),[S,oe]=(0,M.useState)(``),[se,ce]=(0,M.useState)(`all`),[le,C]=(0,M.useState)(`all`),[ue,w]=(0,M.useState)(null),[T,de]=(0,M.useState)(``),[fe,E]=(0,M.useState)(!1),[pe,me]=(0,M.useState)(``),[he,ge]=(0,M.useState)(`generated`),[_e,ve]=(0,M.useState)(``),[ye,be]=(0,M.useState)(!1),[xe,Se]=(0,M.useState)(`blueprints`),[D,Ce]=(0,M.useState)(`containerlab`),[we,Ee]=(0,M.useState)(``),[De,ke]=(0,M.useState)(!1),[Ae,je]=(0,M.useState)(`clos`),[Me,O]=(0,M.useState)(2),[Ne,Pe]=(0,M.useState)(4),[Fe,Ie]=(0,M.useState)(1),[Re,ze]=(0,M.useState)(`ceos`),[Ve,He]=(0,M.useState)(``),[Ue,We]=(0,M.useState)(`linux`),[Ge,Ke]=(0,M.useState)(``),[qe,Je]=(0,M.useState)(!0),[Ye,Xe]=(0,M.useState)(null),[Ze,Qe]=(0,M.useState)(null),[$e,et]=(0,M.useState)(null),[tt,nt]=(0,M.useState)(!1),[rt,it,at]=jt([{id:`r1`,position:{x:80,y:80},data:{label:`r1`,kind:`linux`,image:``},type:`designerNode`}]),[ot,st,ct]=Tt([]),lt=(0,M.useCallback)(()=>{nt(!0)},[]),ut=(0,M.useCallback)(e=>{e.some(e=>e.type!==`select`)&&lt(),at(e)},[lt,at]),dt=(0,M.useCallback)(e=>{e.some(e=>e.type!==`select`)&&lt(),ct(e)},[lt,ct]),ft=(0,M.useMemo)(()=>rt.find(e=>e.id===T)??null,[rt,T]),k=(0,M.useMemo)(()=>({name:s,nodes:rt.map(e=>({id:String(e.id),label:String(e.data?.label??e.id),kind:String(e.data?.kind??``),image:String(e.data?.image??``),position:{x:e.position.x,y:e.position.y}})),links:ot.map(e=>({id:String(e.id),source:String(e.source),target:String(e.target)}))}),[ot,s,rt]),{yaml:pt,warnings:mt}=(0,M.useMemo)(()=>nd(k),[k]),ht=(0,M.useMemo)(()=>mt.filter(e=>e.toLowerCase().includes(`missing image`)),[mt]),gt=(0,M.useMemo)(()=>mt.filter(e=>!e.toLowerCase().includes(`missing image`)),[mt]),_t=(0,M.useMemo)(()=>he===`custom`?String(_e??``):pt,[_e,pt,he]),vt=r({mutationFn:async()=>{if(!_t.trim())throw Error(`YAML is empty`);return hi({kind:`containerlab`,content:_t})}}),yt=r({mutationFn:async()=>{if(!_t.trim())throw Error(`YAML is empty`);return gi({kind:`containerlab`,content:_t,maxIterations:5})},onSuccess:e=>{ge(`custom`),ve(e.content??``),e.ok?j.success(`Auto-fix succeeded`,{description:`Iterations: ${e.iterations}`}):j.error(`Auto-fix still has errors`,{description:`Iterations: ${e.iterations}`})}}),bt=(0,M.useMemo)(()=>{let e=vt.data?.task,t=e?.ok===!0,n=e?.errors,r=[];if(Array.isArray(n))for(let e of n)r.push(String(e));else if(typeof n==`string`)r.push(n);else if(n!=null)try{r.push(JSON.stringify(n))}catch{r.push(String(n))}return{ok:t,errs:r}},[vt.data]),xt=(0,M.useMemo)(()=>({ok:yt.data?.ok===!0,errs:Array.isArray(yt.data?.errors)?(yt.data?.errors??[]).map(e=>String(e)):[]}),[yt.data]),Ct=(0,M.useMemo)(()=>String(re??``).trim().replace(/^\/+|\/+$/g,``)||`containerlab/designer`,[re]),wt=(0,M.useMemo)(()=>{let e=String(ae??``).trim()||`${s||`lab`}.clab.yml`;return e.endsWith(`.yml`)||e.endsWith(`.yaml`)?e:`${e}.yml`},[s,ae]);(0,M.useEffect)(()=>{if(!ye||!u)return;let e=`skyforge.labDesigner.importPrefs.${u}`;try{let t=window.localStorage.getItem(e);if(!t)return;let n=JSON.parse(t);(n?.source===`workspace`||n?.source===`blueprints`)&&Se(n.source),typeof n?.dir==`string`&&Ce(n.dir)}catch{}},[ye,u]),(0,M.useEffect)(()=>{if(!u)return;let e=`skyforge.labDesigner.importPrefs.${u}`;try{window.localStorage.setItem(e,JSON.stringify({source:xe,dir:D}))}catch{}},[D,xe,u]);let Et=()=>{let e=rt.length+1,t=`n${e}`,n=new Set(rt.map(e=>e.id));for(;n.has(t);)e++,t=`n${e}`;let r={x:120+rt.length*40,y:120+rt.length*30},i={id:t,position:r,data:{label:t,kind:`linux`,image:``},type:`designerNode`};it(e=>[...e,i]),de(t)},Dt=()=>{let e=Math.max(1,Math.min(16,Number.isFinite(Me)?Me:2)),t=Math.max(1,Math.min(64,Number.isFinite(Ne)?Ne:4)),n=Math.max(0,Math.min(16,Number.isFinite(Fe)?Fe:1));l((Ae||`clos`).trim()||`clos`);let r=(e,t,n,r,i)=>({id:e,position:{x:t,y:n},data:{label:e,kind:r,image:i},type:`designerNode`}),i=[],a=[],o=Array.from({length:e},(e,t)=>`s${t+1}`),s=Array.from({length:t},(e,t)=>`l${t+1}`);for(let e=0;e<o.length;e++)i.push(r(o[e],120+e*260,120,Re,Ve));for(let e=0;e<s.length;e++)i.push(r(s[e],120+e*260,320,Re,Ve));for(let e of s)for(let t of o)a.push({id:`e-${e}-${t}`,source:e,target:t});let c=1;for(let e=0;e<s.length;e++){let t=s[e];for(let o=0;o<n;o++){let n=`h${c++}`,s=120+e*260+o*70;i.push(r(n,s,520,Ue,Ge)),a.push({id:`e-${n}-${t}`,source:n,target:t})}}it(i),st(a),ge(`generated`),ve(``),de(``),ke(!1),requestAnimationFrame(()=>ue?.fitView({padding:.15,duration:250})),i.filter(e=>!String(e.data?.image??``).trim()).length?j.message(`Quickstart created (missing images)`,{description:`Pick images per-node (or use defaults) before deploying.`}):j.success(`Starter topology created`)},Ot=()=>{let e=rt.length;if(!e)return;let t=Math.max(1,Math.ceil(Math.sqrt(e)));it(e=>e.map((e,n)=>({...e,position:{x:120+n%t*260,y:120+Math.floor(n/t)*180}}))),requestAnimationFrame(()=>ue?.fitView({padding:.15,duration:300}))},kt=()=>{Xe(null),Qe(null),et(null)},At=e=>{if(!t)return;let n=new URLSearchParams;n.set(`action`,e.action),n.set(`node`,e.node);let r=`/dashboard/deployments/${encodeURIComponent(t)}?${n.toString()}`;window.open(r,`_blank`,`noopener,noreferrer`)},Nt=e=>{let t=rt.find(t=>String(t.id)===e);if(!t)return;let n=String(t.data?.label??t.id),r=window.prompt(`Node name`,n);if(r==null)return;let i=r.trim();if(!i)return;let a=new Set(rt.map(e=>String(e.id)));a.delete(e);let o=i,s=2;for(;a.has(o);)o=`${i}-${s++}`;it(t=>t.map(t=>String(t.id)===e?{...t,id:o,data:{...t.data,label:i}}:t)),st(t=>t.map(t=>({...t,source:String(t.source)===e?o:t.source,target:String(t.target)===e?o:t.target,label:String(t.source)===e||String(t.target)===e?`${String(t.source)===e?o:t.source}  ${String(t.target)===e?o:t.target}`:t.label}))),T===e&&de(o),Xe(t=>t&&t.nodeId===e?{...t,nodeId:o}:t)};(0,M.useEffect)(()=>{let e=e=>{e.key===`Escape`&&kt()};return window.addEventListener(`keydown`,e),()=>window.removeEventListener(`keydown`,e)},[]);let Pt=()=>{let e=new Blob([_t],{type:`text/yaml`}),t=document.createElement(`a`);t.href=URL.createObjectURL(e),t.download=`${s||`lab`}.clab.yml`,document.body.appendChild(t),t.click(),t.remove(),setTimeout(()=>URL.revokeObjectURL(t.href),5e3)};(0,M.useEffect)(()=>{let t=String(e.workspaceId??``).trim(),n=String(e.importDeploymentId??``).trim();if(!t||!n)return;d(t),ee(!1),ne(null);let r=!1;return(async()=>{try{let e=await Ba(t,n);if(r)return;let i=(e.nodes??[]).map((e,t)=>({id:String(e.id),position:{x:120+t%4*260,y:120+Math.floor(t/4)*180},data:{label:String(e.label||e.id),kind:String(e.kind||``),image:``},type:`designerNode`})),a=(e.edges??[]).map(e=>({id:String(e.id),source:String(e.source),target:String(e.target),label:e.label||`${e.source}  ${e.target}`}));if(!i.length)throw Error(`No nodes found in deployment topology`);it(i),st(a),de(String(i[0].id)),j.success(`Imported running topology`,{description:`Deployment ${n}`}),requestAnimationFrame(()=>ue?.fitView({padding:.15,duration:250}))}catch(e){if(r)return;j.error(`Failed to import deployment topology`,{description:e.message})}})(),()=>{r=!0}},[e.importDeploymentId,e.workspaceId]);let Ft=()=>{try{let e={labName:s,workspaceId:u,runtime:f,containerlabServer:m,useSavedConfig:g,lastSaved:v,nodes:rt,edges:ot};window.localStorage.setItem(n,JSON.stringify(e)),j.success(`Draft saved`)}catch(e){j.error(`Failed to save draft`,{description:e.message})}},It=()=>{try{let e=window.localStorage.getItem(n);if(!e){j.message(`No saved draft`);return}let t=JSON.parse(e);typeof t?.labName==`string`&&l(t.labName),typeof t?.workspaceId==`string`&&d(t.workspaceId),(t?.runtime===`clabernetes`||t?.runtime===`containerlab`)&&p(t.runtime),typeof t?.containerlabServer==`string`?h(t.containerlabServer):typeof t?.netlabServer==`string`&&h(t.netlabServer),typeof t?.useSavedConfig==`boolean`&&ee(t.useSavedConfig),t?.lastSaved&&typeof t.lastSaved==`object`&&ne(t.lastSaved),Array.isArray(t?.nodes)&&it(t.nodes),Array.isArray(t?.edges)&&st(t.edges),j.success(`Draft loaded`)}catch(e){j.error(`Failed to load draft`,{description:e.message})}},Lt=i({queryKey:H.workspaces(),queryFn:Hr,retry:!1,staleTime:3e4}),Rt=i({queryKey:H.registryRepos(``),queryFn:async()=>Va({q:``,n:2e3}),retry:!1,staleTime:6e4}),zt=i({queryKey:H.userContainerlabServers(),queryFn:Ui,enabled:f===`containerlab`,retry:!1,staleTime:3e4}),Bt=i({queryKey:u?[`containerlabTemplates`,u,xe,D]:[`containerlabTemplates`,`none`],queryFn:async()=>Aa(u,{source:xe,dir:D}),enabled:!!u&&ye,retry:!1,staleTime:3e4}),Vt=i({queryKey:u?[`containerlabTemplate`,u,xe,D,we]:[`containerlabTemplate`,`none`],queryFn:async()=>{if(!u)throw Error(`missing workspace`);return we?Ma(u,{source:xe,dir:D,file:we}):null},enabled:!!u&&ye&&!!we,retry:!1,staleTime:3e4}),Ht=r({mutationFn:async()=>{if(!u)throw Error(`Select a workspace`);if(!_t.trim())throw Error(`YAML is empty`);if(!/^\s*topology\s*:/m.test(_t))throw Error(`YAML must contain a top-level 'topology:' section`);if(Ct!==`containerlab`&&!Ct.startsWith(`containerlab/`))throw Error(`Repo path must be under containerlab/`);let e=g&&v?.workspaceId===u?v:await Fa(u,{name:s,topologyYAML:_t,templatesDir:Ct,template:wt}).then(e=>{let t={workspaceId:e.workspaceId,templatesDir:e.templatesDir,template:e.template,filePath:e.filePath,branch:e.branch};return ne(t),t});if(f===`containerlab`){if(!m)throw Error(`Select a containerlab server`);return La(u,{name:s,netlabServer:m,templateSource:`workspace`,templatesDir:e.templatesDir,template:e.template,autoDeploy:!0})}return Ia(u,{name:s,templateSource:`workspace`,templatesDir:e.templatesDir,template:e.template,autoDeploy:!0})},onSuccess:async e=>{j.success(`Deployment created`,{description:e.deployment?.name??s}),await o.invalidateQueries({queryKey:H.dashboardSnapshot()});let t=e.deployment?.id;qe&&t&&window.open(`/dashboard/deployments/${t}`,`_blank`,`noopener,noreferrer`)},onError:e=>j.error(`Create deployment failed`,{description:e.message})}),Ut=r({mutationFn:async()=>{if(!u)throw Error(`Select a workspace`);if(!_t.trim())throw Error(`YAML is empty`);if(!/^\s*topology\s*:/m.test(_t))throw Error(`YAML must contain a top-level 'topology:' section`);if(Ct!==`containerlab`&&!Ct.startsWith(`containerlab/`))throw Error(`Repo path must be under containerlab/`);return Fa(u,{name:s,topologyYAML:_t,templatesDir:Ct,template:wt})},onSuccess:e=>{ne({workspaceId:e.workspaceId,templatesDir:e.templatesDir,template:e.template,filePath:e.filePath,branch:e.branch}),j.success(`Saved to repo`,{description:`${e.filePath} (${e.branch})`})},onError:e=>j.error(`Save failed`,{description:e.message})}),Wt=r({mutationFn:async()=>{if(!u)throw Error(`Select a workspace`);let e=we.trim();if(!e)throw Error(`Select a template`);return Ma(u,{source:xe,dir:D,file:e})},onSuccess:e=>{ge(`custom`),ve(e.yaml),be(!1),j.success(`Template imported`,{description:e.path})},onError:e=>j.error(`Import failed`,{description:e.message})}),Gt=e=>{e.preventDefault(),e.dataTransfer.dropEffect=`move`},Kt=async e=>{if(e.preventDefault(),!a.current||!ue)return;let t=e.dataTransfer.getData(ad),n=e.dataTransfer.getData(`application/x-skyforge-kind`),r=t?(()=>{try{return JSON.parse(t)}catch{return null}})():null,i=r?.kind||n;if(!i)return;let s=a.current.getBoundingClientRect(),c=ue.screenToFlowPosition({x:e.clientX-s.left,y:e.clientY-s.top}),l=r?.role,u=l===`host`?`h`:l===`router`?`r`:l===`switch`?`s`:l===`firewall`?`f`:i===`linux`?`h`:`n`,d=rt.length+1,f=`${u}${d}`,p=new Set(rt.map(e=>e.id));for(;p.has(f);)d++,f=`${u}${d}`;let m=String(r?.repo??``).trim(),h=m?await ld({repo:m,queryClient:o}):``,g=m?`${m}:${h}`:``,ee={id:f,position:c,data:{label:f,kind:i,image:g},type:`designerNode`};lt(),it(e=>[...e,ee]),de(f)},qt=async()=>{if(!u){j.error(`Select a workspace first`);return}try{let e=v?.workspaceId===u?v:await Fa(u,{name:s,topologyYAML:_t,templatesDir:Ct,template:wt}).then(e=>{let t={workspaceId:e.workspaceId,templatesDir:e.templatesDir,template:e.template,filePath:e.filePath,branch:e.branch};return ne(t),t}),t=new URLSearchParams;t.set(`workspaceId`,u),t.set(`source`,`workspace`),t.set(`dir`,e.templatesDir),t.set(`file`,e.template);let n=`/dashboard/labs/map?${t.toString()}`;window.open(n,`_blank`,`noopener,noreferrer`)}catch(e){j.error(`Failed to open map`,{description:e.message})}},Jt=e=>{let t=e.target,n=t?.tagName?.toUpperCase?.()??``;if(n===`INPUT`||n===`TEXTAREA`||t?.isContentEditable)return;if(e.key===`Escape`){kt();return}if(e.key!==`Delete`&&e.key!==`Backspace`)return;let r=new Set(rt.filter(e=>e.selected).map(e=>String(e.id))),i=new Set(ot.filter(e=>e.selected).map(e=>String(e.id)));r.size===0&&i.size===0||(e.preventDefault(),it(e=>e.filter(e=>!r.has(String(e.id)))),st(e=>e.filter(e=>!(i.has(String(e.id))||r.has(String(e.source))||r.has(String(e.target))))))},Yt=(0,M.useMemo)(()=>({designerNode:ud}),[]),Xt=(0,M.useMemo)(()=>(Rt.isError?[]:Rt.data?.repositories??[]).map(sd),[Rt.data?.repositories,Rt.isError]),Qt=(0,M.useMemo)(()=>{let e=new Set;for(let t of Xt){let n=String(t.vendor??``).trim();n&&e.add(n)}return Array.from(e).sort((e,t)=>e.localeCompare(t))},[Xt]),$t=(0,M.useMemo)(()=>{let e=Xt,t=S.trim().toLowerCase(),n=e.filter(e=>se===`all`?!0:String(e.vendor??``)===se).filter(e=>le===`all`?!0:String(e.role??`other`)===le).filter(e=>t?`${e.label} ${e.kind} ${e.category} ${e.repo??``}`.toLowerCase().includes(t):!0),r={Hosts:0,Routers:1,Switches:2,Firewalls:3,Other:4};return n.sort((e,t)=>{let n=r[e.category]??99,i=r[t.category]??99;return n===i?e.label.localeCompare(t.label):n-i})},[Xt,le,S,se]),en=Xt.length>0&&$t.length===0,tn=Rt.isError?Rt.error?.message||`Registry unavailable.`:``;return(0,P.jsxs)(`div`,{className:`h-full w-full p-4 flex flex-col gap-4 min-h-0`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-2xl font-bold tracking-tight`,children:`Lab Designer (Containerlab)`}),(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Drag nodes, wire links, generate Containerlab YAML, and deploy.`})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>ke(!0),children:[(0,P.jsx)(Le,{className:`mr-2 h-4 w-4`}),`Get started`]}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>be(!0),disabled:!u,children:[(0,P.jsx)(Mn,{className:`mr-2 h-4 w-4`}),`Import template`]}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:It,children:`Load draft`}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:Ft,children:`Save draft`}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>Ut.mutate(),disabled:Ut.isPending,children:[(0,P.jsx)(Be,{className:`mr-2 h-4 w-4`}),`Save config`]}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:Pt,children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`Download YAML`]})]})]}),(0,P.jsxs)(`div`,{className:`grid gap-4 lg:grid-cols-[1fr_420px] flex-1 min-h-0`,children:[(0,P.jsxs)(L,{className:`flex flex-col min-h-0`,children:[(0,P.jsx)(R,{className:`pb-3`,children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsx)(z,{children:`Topology`}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{size:`sm`,variant:`outline`,onClick:()=>x(e=>!e),children:b?`Snap: on`:`Snap: off`}),(0,P.jsxs)(F,{size:`sm`,variant:fe?`default`:`outline`,onClick:()=>{E(e=>{let t=!e;return t||me(``),t})},title:`Create links by clicking a source node, then a target node`,children:[(0,P.jsx)(Mt,{className:`mr-2 h-4 w-4`}),fe?`Link: on`:`Link: off`]}),(0,P.jsxs)(F,{size:`sm`,variant:`outline`,onClick:Ot,disabled:rt.length<2,children:[(0,P.jsx)(un,{className:`mr-2 h-4 w-4`}),`Auto-layout`]}),(0,P.jsxs)(F,{size:`sm`,variant:`outline`,onClick:Et,children:[(0,P.jsx)(gn,{className:`mr-2 h-4 w-4`}),`Add node`]})]})]})}),(0,P.jsx)(V,{className:`flex-1 min-h-0`,children:(0,P.jsxs)(`div`,{className:`flex h-full w-full border rounded-xl overflow-hidden bg-background/50`,children:[(0,P.jsxs)(`div`,{className:`w-[180px] border-r bg-background p-3`,children:[(0,P.jsx)(`div`,{className:`text-xs font-semibold text-muted-foreground`,children:`Palette`}),(0,P.jsx)(`div`,{className:`mt-2`,children:(0,P.jsx)(K,{value:S,onChange:e=>oe(e.target.value),placeholder:`Search`,className:`h-8`})}),(0,P.jsxs)(`div`,{className:`mt-2 grid gap-2`,children:[(0,P.jsxs)(q,{value:se,onValueChange:ce,children:[(0,P.jsx)(Y,{className:`h-8`,children:(0,P.jsx)(J,{placeholder:`Vendor`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All vendors`}),Qt.map(e=>(0,P.jsx)(Z,{value:e,children:e},e))]})]}),(0,P.jsxs)(q,{value:le,onValueChange:C,children:[(0,P.jsx)(Y,{className:`h-8`,children:(0,P.jsx)(J,{placeholder:`Role`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All roles`}),(0,P.jsx)(Z,{value:`router`,children:`Routers`}),(0,P.jsx)(Z,{value:`switch`,children:`Switches`}),(0,P.jsx)(Z,{value:`firewall`,children:`Firewalls`}),(0,P.jsx)(Z,{value:`host`,children:`Hosts`}),(0,P.jsx)(Z,{value:`other`,children:`Other`})]})]})]}),(0,P.jsx)(`div`,{className:`mt-3 space-y-2`,children:Rt.isLoading?(0,P.jsx)(`div`,{className:`rounded-lg border bg-background px-3 py-2 text-xs text-muted-foreground`,children:`Loading images`}):$t.length===0?(0,P.jsx)(`div`,{className:`rounded-lg border bg-background px-3 py-2 text-xs text-muted-foreground`,children:Rt.isError?(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`font-medium text-foreground`,children:`Registry not available`}),(0,P.jsx)(`div`,{children:tn}),(0,P.jsx)(`div`,{children:`Set SKYFORGE_REGISTRY_URL (e.g. https://ghcr.io) and optional credentials.`})]}):en?(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`font-medium text-foreground`,children:`No matches`}),(0,P.jsx)(`div`,{children:`Try clearing filters or search terms.`})]}):(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`font-medium text-foreground`,children:`No images yet`}),(0,P.jsx)(`div`,{children:`Add container images to your registry (e.g. GHCR) or adjust registry repo prefixes.`})]})}):(0,P.jsx)(`div`,{className:`space-y-3`,children:[`Hosts`,`Routers`,`Switches`,`Firewalls`,`Other`].map(e=>({category:e,items:$t.filter(t=>t.category===e)})).filter(e=>e.items.length>0).map(e=>(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-[11px] font-semibold text-muted-foreground`,children:e.category}),(0,P.jsx)(`div`,{className:`space-y-2`,children:e.items.slice(0,60).map(e=>(0,P.jsx)(cd,{item:e},e.id))})]},e.category))})})]}),(0,P.jsxs)(`div`,{className:`flex-1 outline-none relative`,ref:a,onDrop:Kt,onDragOver:Gt,tabIndex:0,onKeyDown:Jt,onMouseDown:e=>{e.currentTarget.focus(),kt()},onContextMenu:e=>e.preventDefault(),children:[fe?(0,P.jsx)(`div`,{className:`absolute z-10 m-3 rounded-lg border bg-background/80 px-3 py-2 text-xs text-muted-foreground backdrop-blur`,children:pe?(0,P.jsxs)(P.Fragment,{children:[`Link mode: select target for`,` `,(0,P.jsx)(`span`,{className:`font-mono text-foreground`,children:pe})]}):(0,P.jsx)(P.Fragment,{children:`Link mode: click a source node, then click a target node`})}):null,(0,P.jsxs)(Tn,{nodes:rt,edges:ot,onNodesChange:ut,onEdgesChange:dt,onConnect:e=>{let t=e.source&&e.target?`${e.source}  ${e.target}`:void 0;st(n=>Zt({...e,label:t},n))},fitView:!0,onNodeClick:(e,t)=>{let n=String(t.id);if(fe){if(!pe){me(n);return}if(pe===n){me(``);return}let e=`e-${pe}-${n}-${Date.now()}`;st(t=>Zt({id:e,source:pe,target:n,label:`${pe}  ${n}`},t)),me(``);return}de(n)},onNodeContextMenu:(e,t)=>{e.preventDefault();let n=a.current?.getBoundingClientRect();Xe({x:n?e.clientX-n.left:e.clientX,y:n?e.clientY-n.top:e.clientY,nodeId:String(t.id)}),Qe(null),et(null)},onEdgeContextMenu:(e,t)=>{e.preventDefault();let n=a.current?.getBoundingClientRect();Qe({x:n?e.clientX-n.left:e.clientX,y:n?e.clientY-n.top:e.clientY,edgeId:String(t.id)}),Xe(null),et(null)},onPaneContextMenu:e=>{e.preventDefault();let t=a.current?.getBoundingClientRect();et({x:t?e.clientX-t.left:e.clientX,y:t?e.clientY-t.top:e.clientY}),Xe(null),Qe(null)},onInit:w,snapToGrid:b,snapGrid:[12,12],nodeTypes:Yt,children:[(0,P.jsx)(an,{}),(0,P.jsx)(St,{zoomable:!0,pannable:!0,className:`bg-background border rounded-lg`}),(0,P.jsx)(A,{gap:12,size:1})]}),Ye?(0,P.jsx)(`div`,{className:`absolute z-50`,style:{left:Ye.x,top:Ye.y},onContextMenu:e=>e.preventDefault(),children:(0,P.jsxs)(L,{className:`w-64 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,P.jsxs)(R,{className:`p-3 pb-2`,children:[(0,P.jsx)(z,{className:`text-sm`,children:`Node`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:String(rt.find(e=>String(e.id)===Ye.nodeId)?.data?.label??Ye.nodeId)})]}),(0,P.jsxs)(V,{className:`p-3 pt-0 space-y-2`,children:[(0,P.jsx)(F,{size:`sm`,className:`w-full`,onClick:()=>{de(Ye.nodeId),kt()},children:`Edit`}),t?(0,P.jsxs)(`div`,{className:`grid grid-cols-3 gap-2`,children:[(0,P.jsx)(F,{size:`sm`,variant:`outline`,onClick:()=>{At({action:`terminal`,node:Ye.nodeId}),kt()},children:`Terminal`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,onClick:()=>{At({action:`logs`,node:Ye.nodeId}),kt()},children:`Logs`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,onClick:()=>{At({action:`describe`,node:Ye.nodeId}),kt()},children:`Describe`})]}):null,(0,P.jsx)(F,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{Nt(Ye.nodeId),kt()},children:`Rename`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=rt.find(e=>String(e.id)===Ye.nodeId);if(!e)return;let t=new Set(rt.map(e=>String(e.id))),n=rt.length+1,r=`${String(e.id)}-${n}`;for(;t.has(r);)n++,r=`${String(e.id)}-${n}`;let i={...e,id:r,position:{x:e.position.x+32,y:e.position.y+32},data:{...e.data,label:r}};it(e=>[...e,i]),de(r),kt()},children:`Duplicate`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{E(!0),me(Ye.nodeId),kt()},children:`Start link`}),(0,P.jsx)(F,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=rt.find(e=>String(e.id)===Ye.nodeId)?.data?.label??Ye.nodeId;navigator.clipboard?.writeText(String(e)),j.success(`Copied`),kt()},children:`Copy name`}),(0,P.jsx)(F,{size:`sm`,variant:`destructive`,className:`w-full`,onClick:()=>{let e=Ye.nodeId;it(t=>t.filter(t=>String(t.id)!==e)),st(t=>t.filter(t=>String(t.source)!==e&&String(t.target)!==e)),T===e&&de(``),kt()},children:`Delete`})]})]})}):null,Ze?(0,P.jsx)(`div`,{className:`absolute z-50`,style:{left:Ze.x,top:Ze.y},onContextMenu:e=>e.preventDefault(),children:(0,P.jsxs)(L,{className:`w-60 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,P.jsxs)(R,{className:`p-3 pb-2`,children:[(0,P.jsx)(z,{className:`text-sm`,children:`Link`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:ot.find(e=>String(e.id)===Ze.edgeId)?.label??Ze.edgeId})]}),(0,P.jsxs)(V,{className:`p-3 pt-0 space-y-2`,children:[(0,P.jsx)(F,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=ot.find(e=>String(e.id)===Ze.edgeId);if(!e)return;let t=window.prompt(`Link label`,String(e.label??``));t!=null&&(st(e=>e.map(e=>String(e.id)===Ze.edgeId?{...e,label:t}:e)),kt())},children:`Rename`}),(0,P.jsx)(F,{size:`sm`,variant:`destructive`,className:`w-full`,onClick:()=>{st(e=>e.filter(e=>String(e.id)!==Ze.edgeId)),kt()},children:`Delete`})]})]})}):null,$e?(0,P.jsx)(`div`,{className:`absolute z-50`,style:{left:$e.x,top:$e.y},onContextMenu:e=>e.preventDefault(),children:(0,P.jsxs)(L,{className:`w-60 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,P.jsx)(R,{className:`p-3 pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`Canvas`})}),(0,P.jsxs)(V,{className:`p-3 pt-0 space-y-2`,children:[(0,P.jsx)(F,{size:`sm`,className:`w-full`,onClick:()=>{Et(),kt()},children:`Add node`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{Ot(),kt()},disabled:rt.length<2,children:`Auto-layout`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{ue?.fitView({padding:.15,duration:250}),kt()},disabled:!ue,children:`Fit view`})]})]})}):null]})]})})]}),(0,P.jsxs)(`div`,{className:`space-y-6`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Lab`})}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Lab name`}),(0,P.jsx)(K,{value:s,onChange:e=>l(e.target.value)})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Workspace`}),(0,P.jsxs)(q,{value:u,onValueChange:e=>d(e),children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:Lt.isLoading?`Loading`:`Select workspace`})}),(0,P.jsx)(X,{children:(Lt.data?.workspaces??[]).map(e=>(0,P.jsx)(Z,{value:String(e.id),children:String(e.name??e.slug??e.id)},String(e.id)))})]})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Runtime`}),(0,P.jsxs)(q,{value:f,onValueChange:e=>p(e),disabled:!u,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:u?`Select runtime`:`Select workspace first`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`clabernetes`,children:`Clabernetes (in-cluster)`}),(0,P.jsx)(Z,{value:`containerlab`,children:`Containerlab (BYOS)`})]})]})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Repo path`}),(0,P.jsxs)(`div`,{className:`grid grid-cols-2 gap-2`,children:[(0,P.jsx)(K,{value:re,onChange:e=>ie(e.target.value),placeholder:`containerlab/designer`}),(0,P.jsx)(K,{value:ae,onChange:e=>y(e.target.value),placeholder:`${s||`lab`}.clab.yml`})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsx)(F,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(`${Ct}/${wt}`),j.success(`Copied path`)},disabled:!u,children:`Copy path`}),(0,P.jsxs)(F,{size:`sm`,variant:`outline`,onClick:qt,disabled:!u,children:[(0,P.jsx)(te,{className:`mr-2 h-4 w-4`}),`Open map`]})]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:[Ct,`/`,wt]})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3 rounded-lg border p-3`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Use saved config`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground truncate`,children:v?.workspaceId===u?`${v.filePath} (${v.branch})`:`Auto-saves before deploy`})]}),(0,P.jsx)(Nc,{checked:g,onCheckedChange:e=>ee(!!e)})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Containerlab server`}),(0,P.jsxs)(q,{value:m,onValueChange:e=>h(e),disabled:!u||f!==`containerlab`,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:f===`containerlab`?u?zt.isLoading?`Loading`:`Select server`:`Select workspace first`:`Not required for clabernetes`})}),(0,P.jsx)(X,{children:(zt.data?.servers??[]).map(e=>(0,P.jsx)(Z,{value:`user:${String(e.id)}`,children:od(e.apiUrl)||e.name},String(e.id)))})]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Only required for Containerlab (BYOS). Configure in My Settings , then go to BYOL Servers.`})]}),(0,P.jsx)(`div`,{children:(0,P.jsxs)(F,{className:`w-full`,disabled:Ht.isPending,onClick:()=>Ht.mutate(),children:[(0,P.jsx)(_,{className:`mr-2 h-4 w-4`}),Ht.isPending?`Creating`:`Create deployment + deploy`]})}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between rounded-lg border px-3 py-2`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Open deployment on create`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Keeps the Designer open in this tab.`})]}),(0,P.jsx)(Nc,{checked:qe,onCheckedChange:e=>Je(!!e)})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Node`})}),(0,P.jsx)(V,{className:`space-y-4`,children:ft?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Name`}),(0,P.jsx)(K,{value:String(ft.data?.label??ft.id),onChange:e=>{let t=e.target.value;lt(),it(e=>e.map(e=>e.id===ft.id?{...e,data:{...e.data,label:t}}:e))}})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Kind`}),(0,P.jsx)(K,{value:String(ft.data?.kind??``),onChange:e=>{let t=e.target.value;it(e=>e.map(e=>e.id===ft.id?{...e,data:{...e.data,kind:t}}:e))},placeholder:`linux, ceos, ...`})]}),(0,P.jsx)($u,{value:String(ft.data?.image??``),onChange:e=>{lt(),it(t=>t.map(t=>t.id===ft.id?{...t,data:{...t.data,image:e}}:t))}})]}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Click a node to edit.`})})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-3`,children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsx)(z,{children:`YAML`}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{size:`sm`,variant:`outline`,onClick:()=>yt.mutate(),disabled:yt.isPending,children:yt.isPending?`Auto-fixing`:`Auto-fix`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,onClick:()=>vt.mutate(),disabled:vt.isPending,children:vt.isPending?`Validating`:`Validate`}),(0,P.jsxs)(F,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(_t),j.success(`Copied YAML`)},children:[(0,P.jsx)(Te,{className:`mr-2 h-4 w-4`}),`Copy`]})]})]})}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{size:`sm`,variant:he===`generated`?`default`:`outline`,onClick:()=>ge(`generated`),children:`Generated`}),(0,P.jsx)(F,{size:`sm`,variant:he===`custom`?`default`:`outline`,onClick:()=>{ge(`custom`),_e.trim()||ve(_t)},children:`Custom`})]}),gt.length||tt&&ht.length?(0,P.jsxs)(`div`,{className:`rounded-md border bg-amber-500/10 text-amber-900 dark:text-amber-200 px-3 py-2 text-xs`,children:[gt.slice(0,6).map(e=>(0,P.jsx)(`div`,{children:e},e)),tt?ht.slice(0,6).map(e=>(0,P.jsx)(`div`,{children:e},e)):null]}):null,vt.isError?(0,P.jsxs)(`div`,{className:`rounded-md border bg-red-500/10 text-red-900 dark:text-red-200 px-3 py-2 text-xs`,children:[`Validation failed: `,vt.error.message]}):vt.isSuccess&&bt.ok?(0,P.jsx)(`div`,{className:`rounded-md border bg-emerald-500/10 text-emerald-900 dark:text-emerald-200 px-3 py-2 text-xs`,children:`Valid Containerlab YAML`}):vt.isSuccess&&bt.errs.length?(0,P.jsxs)(`div`,{className:`rounded-md border bg-red-500/10 text-red-900 dark:text-red-200 px-3 py-2 text-xs space-y-1`,children:[(0,P.jsx)(`div`,{className:`font-medium`,children:`Invalid Containerlab YAML`}),bt.errs.slice(0,8).map(e=>(0,P.jsx)(`div`,{children:e},e)),bt.errs.length>8?(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[`+`,bt.errs.length-8,` more`]}):null]}):null,yt.isError?(0,P.jsxs)(`div`,{className:`rounded-md border bg-red-500/10 text-red-900 dark:text-red-200 px-3 py-2 text-xs`,children:[`Auto-fix failed: `,yt.error.message]}):yt.isSuccess&&!xt.ok&&xt.errs.length?(0,P.jsxs)(`div`,{className:`rounded-md border bg-amber-500/10 text-amber-900 dark:text-amber-200 px-3 py-2 text-xs space-y-1`,children:[(0,P.jsx)(`div`,{className:`font-medium`,children:`Auto-fix incomplete (still failing schema)`}),xt.errs.slice(0,6).map(e=>(0,P.jsx)(`div`,{children:e},e)),xt.errs.length>6?(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[`+`,xt.errs.length-6,` more`]}):null]}):null,(0,P.jsx)(ul,{value:he===`custom`?_e:pt,onChange:e=>ve(e.target.value),readOnly:he!==`custom`,className:`font-mono text-xs h-[320px]`})]})]})]})]}),(0,P.jsx)(tr,{open:ye,onOpenChange:e=>be(e),children:(0,P.jsxs)(ir,{children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Import template`}),(0,P.jsx)(cr,{children:`Load an existing containerlab YAML from templates/blueprints into the editor.`})]}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Source`}),(0,P.jsxs)(q,{value:xe,onValueChange:e=>{let t=e;Se(t),Ce(t===`workspace`?`containerlab/designer`:`containerlab`),Ee(``)},children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`blueprints`,children:`Blueprints`}),(0,P.jsx)(Z,{value:`workspace`,children:`Workspace repo`})]})]})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Directory`}),(0,P.jsx)(K,{value:D,onChange:e=>Ce(e.target.value)})]})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Template`}),(0,P.jsxs)(q,{value:we,onValueChange:e=>Ee(e),disabled:!u,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:Bt.isLoading?`Loading`:`Select template`})}),(0,P.jsx)(X,{children:(Bt.data?.templates??[]).map(e=>(0,P.jsx)(Z,{value:e,children:e},e))})]}),Bt.isError?(0,P.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to list templates`}):null]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Preview`}),(0,P.jsx)(ul,{value:Vt.data?.yaml??``,readOnly:!0,placeholder:we?Vt.isLoading?`Loading preview`:`No preview`:`Select a template to preview`,className:`font-mono text-xs h-[220px]`})]})]}),(0,P.jsxs)(or,{children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>be(!1),children:`Cancel`}),(0,P.jsx)(F,{onClick:()=>Wt.mutate(),disabled:Wt.isPending||!we,children:`Import`})]})]})}),(0,P.jsx)(tr,{open:De,onOpenChange:e=>ke(e),children:(0,P.jsxs)(ir,{children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Quickstart: Generate CLOS`}),(0,P.jsx)(cr,{children:"Generate a simple leaf/spine fabric (inspired by `clab generate`). This populates the designer canvas; you can edit nodes and YAML afterwards."})]}),(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Lab name`}),(0,P.jsx)(K,{value:Ae,onChange:e=>je(e.target.value)})]}),(0,P.jsxs)(`div`,{className:`grid grid-cols-3 gap-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Spines`}),(0,P.jsx)(K,{type:`number`,min:1,max:16,value:Me,onChange:e=>O(Number(e.target.value||0))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Leaves`}),(0,P.jsx)(K,{type:`number`,min:1,max:64,value:Ne,onChange:e=>Pe(Number(e.target.value||0))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Hosts/leaf`}),(0,P.jsx)(K,{type:`number`,min:0,max:16,value:Fe,onChange:e=>Ie(Number(e.target.value||0))})]})]}),(0,P.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-4`,children:[(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Switch kind`}),(0,P.jsx)(K,{value:Re,onChange:e=>ze(e.target.value),placeholder:`ceos`})]}),(0,P.jsx)($u,{value:Ve,onChange:He})]}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(G,{children:`Host kind`}),(0,P.jsx)(K,{value:Ue,onChange:e=>We(e.target.value),placeholder:`linux`})]}),(0,P.jsx)($u,{value:Ge,onChange:Ke})]})]})]}),(0,P.jsxs)(or,{children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>ke(!1),children:`Cancel`}),(0,P.jsx)(F,{onClick:Dt,children:`Generate`})]})]})})]})}var fd=[{slug:`getting-started`,title:`Getting started`,content:(0,P.jsxs)(`div`,{className:`space-y-4 text-sm`,children:[(0,P.jsx)(`p`,{children:`Skyforge is optimized for a happy path workflow. You can still run tools manually, but the goal is to make repeatable automation the default.`}),(0,P.jsxs)(`ol`,{className:`list-decimal pl-5 space-y-2`,children:[(0,P.jsxs)(`li`,{children:[`Go to`,` `,(0,P.jsx)(p,{className:`underline`,to:`/dashboard/settings`,children:`My Settings`}),` `,`and configure:`,(0,P.jsxs)(`ul`,{className:`list-disc pl-5 mt-2 space-y-1`,children:[(0,P.jsx)(`li`,{children:`External template repos (optional)`}),(0,P.jsx)(`li`,{children:`BYOL servers (optional)`}),(0,P.jsx)(`li`,{children:`Collector + integrations (optional)`})]})]}),(0,P.jsxs)(`li`,{children:[`Create a deployment from`,` `,(0,P.jsx)(p,{className:`underline`,to:`/dashboard/deployments/new`,children:`Create deployment`}),`.`]}),(0,P.jsxs)(`li`,{children:[`Use `,(0,P.jsx)(`span`,{className:`font-mono`,children:`Validate`}),` before starting, especially when overriding env vars.`]})]})]})},{slug:`my-settings`,title:`My Settings`,content:(0,P.jsxs)(`div`,{className:`space-y-4 text-sm`,children:[(0,P.jsxs)(`p`,{children:[`The current model is`,` `,(0,P.jsx)(`strong`,{children:`per-user settings applied to deployments`}),`. Workspaces are primarily for sharing and feature gates.`]}),(0,P.jsxs)(`ul`,{className:`list-disc pl-5 space-y-2`,children:[(0,P.jsxs)(`li`,{children:[(0,P.jsx)(`strong`,{children:`Defaults`}),`: environment variables applied to new deployments.`]}),(0,P.jsxs)(`li`,{children:[(0,P.jsx)(`strong`,{children:`External Template Repos`}),`: add Git repos once and reuse them across deployments.`]}),(0,P.jsxs)(`li`,{children:[(0,P.jsx)(`strong`,{children:`BYOL Servers`}),`: register Netlab / Containerlab / EVE-NG servers (using `,(0,P.jsx)(`span`,{className:`font-mono`,children:`user:`}),` `,`refs).`]}),(0,P.jsxs)(`li`,{children:[(0,P.jsx)(`strong`,{children:`Cloud credentials`}),`: stored per-user; UI only shows configured status.`]})]})]})},{slug:`deployments`,title:`Deployments`,content:(0,P.jsxs)(`div`,{className:`space-y-4 text-sm`,children:[(0,P.jsx)(`p`,{children:`Deployments are created from templates and then executed as runs. Template validation should use the same env overrides youll apply at runtime.`}),(0,P.jsxs)(`ul`,{className:`list-disc pl-5 space-y-2`,children:[(0,P.jsxs)(`li`,{children:[`Use the `,(0,P.jsx)(`span`,{className:`font-mono`,children:`View`}),` button to inspect a selected template.`]}),(0,P.jsxs)(`li`,{children:[`Use `,(0,P.jsx)(`span`,{className:`font-mono`,children:`Validate`}),` to catch obvious netlab errors early.`]})]})]})},{slug:`servicenow`,title:`ServiceNow demo workflow`,content:(0,P.jsxs)(`div`,{className:`space-y-4 text-sm`,children:[(0,P.jsx)(`p`,{children:`This workflow installs a demo app into a ServiceNow PDI. The demo app calls Forward SaaS directly; Skyforge only installs/configures ServiceNow resources.`}),(0,P.jsxs)(`ol`,{className:`list-decimal pl-5 space-y-2`,children:[(0,P.jsx)(`li`,{children:`Create (and wake) a PDI from ServiceNow developer portal.`}),(0,P.jsxs)(`li`,{children:[`In Skyforge, open`,` `,(0,P.jsx)(p,{className:`underline`,to:`/dashboard/servicenow`,children:`ServiceNow`}),` `,`and save your instance URL + admin credentials.`]}),(0,P.jsxs)(`li`,{children:[`Click `,(0,P.jsx)(`strong`,{children:`Install demo app`}),`.`]}),(0,P.jsx)(`li`,{children:`If schema setup is required, create the required tables in ServiceNow Studio (first time per PDI), then re-run install.`})]}),(0,P.jsxs)(`div`,{className:`rounded-md border p-3 text-xs text-muted-foreground`,children:[(0,P.jsx)(`div`,{className:`font-medium text-foreground`,children:`Where to find the demo`}),(0,P.jsxs)(`ul`,{className:`mt-2 list-disc space-y-1 pl-5`,children:[(0,P.jsxs)(`li`,{children:[`In ServiceNow App Navigator, search for`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`Forward Connectivity Ticket`}),`.`]}),(0,P.jsxs)(`li`,{children:[`Portal page:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`/sp?id=connectivity_ticket`})]}),(0,P.jsxs)(`li`,{children:[`Widget name:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`Connectivity Ticket Analyzer`})]})]})]}),(0,P.jsxs)(`div`,{className:`rounded-md border p-3 text-xs text-muted-foreground`,children:[(0,P.jsx)(`div`,{className:`font-medium text-foreground`,children:`Schema (tables)`}),(0,P.jsx)(`p`,{className:`mt-2`,children:`Skyforge prefers the simplest global table names. Create these two tables (once per PDI) and then re-run install:`}),(0,P.jsxs)(`ul`,{className:`mt-2 list-disc space-y-1 pl-5`,children:[(0,P.jsx)(`li`,{children:(0,P.jsx)(`span`,{className:`font-mono`,children:`u_forward_connectivity_ticket`})}),(0,P.jsx)(`li`,{children:(0,P.jsx)(`span`,{className:`font-mono`,children:`u_forward_connectivity_hop`})})]}),(0,P.jsx)(`p`,{className:`mt-2`,children:`To create the tables in ServiceNow:`}),(0,P.jsxs)(`ol`,{className:`mt-2 list-decimal space-y-1 pl-5`,children:[(0,P.jsxs)(`li`,{children:[`Open `,(0,P.jsx)(`span`,{className:`font-medium`,children:`App Navigator`}),` and search for `,(0,P.jsx)(`span`,{className:`font-mono`,children:`Tables`}),` (System Definition).`]}),(0,P.jsxs)(`li`,{children:[`Click `,(0,P.jsx)(`span`,{className:`font-medium`,children:`New`}),`.`]}),(0,P.jsxs)(`li`,{children:[`For the ticket table, set the`,` `,(0,P.jsx)(`span`,{className:`font-medium`,children:`Label`}),` to`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`Forward Connectivity Ticket`}),` `,`(leave the `,(0,P.jsx)(`span`,{className:`font-medium`,children:`Name`}),` blank so ServiceNow derives`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`u_forward_connectivity_ticket`}),`). Set `,(0,P.jsx)(`span`,{className:`font-medium`,children:`Extends table`}),` to`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`task`}),`.`]}),(0,P.jsxs)(`li`,{children:[`For the hop table, set the`,` `,(0,P.jsx)(`span`,{className:`font-medium`,children:`Label`}),` to`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`Forward Connectivity Hop`}),` (leave Name blank so it becomes`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`u_forward_connectivity_hop`}),`).`]})]}),(0,P.jsx)(`p`,{className:`mt-2`,children:`After the tables exist, Skyforge auto-creates required fields and choice lists via Table API.`})]})]})},{slug:`ai-templates`,title:`AI templates (Gemini)`,content:(0,P.jsxs)(`div`,{className:`space-y-4 text-sm`,children:[(0,P.jsx)(`p`,{children:`Skyforge can generate Netlab and Containerlab templates using your connected Gemini account. The workflow is intended to be safe and iterative: generate  save  validate  deploy.`}),(0,P.jsxs)(`ol`,{className:`list-decimal pl-5 space-y-2`,children:[(0,P.jsxs)(`li`,{children:[`Connect Gemini from`,` `,(0,P.jsx)(p,{className:`underline`,to:`/dashboard/gemini`,children:`AI  Gemini`}),`.`]}),(0,P.jsxs)(`li`,{children:[`Open`,` `,(0,P.jsx)(p,{className:`underline`,to:`/dashboard/ai`,children:`AI Templates`}),` `,`and generate a template from a prompt.`]}),(0,P.jsxs)(`li`,{children:[`Click `,(0,P.jsx)(`strong`,{children:`Save to Repo`}),` to store the generated file into your default workspace under `,(0,P.jsx)(`span`,{className:`font-mono`,children:`ai/`}),`.`]}),(0,P.jsxs)(`li`,{children:[`For Netlab templates, click `,(0,P.jsx)(`strong`,{children:`Validate (Netlab)`}),` and open the resulting run to see the netlab validation output.`]})]}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Note: The AI feature can be disabled by the instance admin. If the generate button is disabled, verify Gemini is connected and AI is enabled on the server.`}),(0,P.jsxs)(`div`,{className:`rounded-md border p-3 text-xs text-muted-foreground`,children:[(0,P.jsx)(`div`,{className:`font-medium text-foreground`,children:`Common issues`}),(0,P.jsxs)(`ul`,{className:`mt-2 list-disc space-y-1 pl-5`,children:[(0,P.jsxs)(`li`,{children:[`If you see an error about the`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`Vertex AI API`}),` being disabled, an admin must enable`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`aiplatform.googleapis.com`}),` for the configured project. Skyforge often includes a direct Enable API link in the error.`]}),(0,P.jsx)(`li`,{children:`If you see a permissions error, an admin must grant you Vertex AI access in the shared project (typically Vertex AI User).`})]})]})]})}];const pd=t(`/dashboard/docs/$slug`)({component:md});function md(){let{slug:e}=pd.useParams(),t=fd.find(t=>t.slug===e);return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(`div`,{className:`flex items-center gap-3`,children:(0,P.jsxs)(p,{to:`/dashboard/docs`,className:`inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground`,children:[(0,P.jsx)(ee,{className:`h-4 w-4`}),`Back to Docs`]})}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsx)(R,{children:(0,P.jsxs)(z,{className:`flex items-center gap-2`,children:[(0,P.jsx)(ft,{className:`h-5 w-5`}),t?.title??`Page not found`]})}),(0,P.jsx)(V,{children:t?t.content:(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`This doc page doesnt exist.`})})]})]})}var hd=en,gd=hn,_d=Bt,vd=M.forwardRef(({className:e,sideOffset:t=4,...n},r)=>(0,P.jsx)(xn,{ref:r,sideOffset:t,className:N(`z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,e),...n}));vd.displayName=xn.displayName;var yd=Qn({workspace:qn().optional().catch(``)});const bd=t(`/dashboard/deployments/new`)({validateSearch:e=>yd.parse(e),component:Cd});var xd=Qn({workspaceId:qn().min(1,`Workspace is required`),name:qn().min(1,`Deployment name is required`).max(100),kind:Xn([`netlab-c9s`,`netlab`,`containerlab`,`clabernetes`,`terraform`,`eve_ng`]),source:Xn([`workspace`,`blueprints`,`external`]),templateRepoId:qn().optional(),template:qn().min(1,`Template is required`),netlabServer:qn().optional(),eveServer:qn().optional(),forwardCollectorId:qn().optional(),variableGroupId:qn().optional(),env:Kn(Qn({key:qn(),value:qn()})).optional()});function Sd(e){let t=String(e??``).trim();if(!t)return``;try{return new URL(t).hostname||t}catch{return t.replace(/^https?:\/\//,``).split(`/`)[0]??t}}function Cd(){let e=n(),t=c(),{workspace:a}=bd.useSearch(),[o,s]=(0,M.useState)(!1),[l,u]=(0,M.useState)(!1),[d,f]=(0,M.useState)(`all`),[p,m]=(0,M.useState)(!1),[h,g]=(0,M.useState)(``),[ee,_]=(0,M.useState)(``),[v,te]=(0,M.useState)(``),[ne,re]=(0,M.useState)(!1),[ie,ae]=(0,M.useState)(``);lu(!0);let y=i({queryKey:H.dashboardSnapshot(),queryFn:Ur,initialData:()=>t.getQueryData(H.dashboardSnapshot())??null,retry:!1,staleTime:1/0}),b=i({queryKey:H.userSettings(),queryFn:vi,staleTime:3e4,retry:!1}),x=i({queryKey:H.workspaces(),queryFn:Hr,staleTime:3e4}).data?.workspaces??[],S=Pn({resolver:pt(xd),defaultValues:{workspaceId:a||``,name:``,kind:`netlab-c9s`,source:`workspace`,templateRepoId:``,template:``,netlabServer:``,eveServer:``,forwardCollectorId:`none`,variableGroupId:`none`,env:[]}}),{watch:oe,setValue:se,control:ce}=S,{fields:le,append:C,remove:ue}=yt({control:ce,name:`env`});(0,M.useEffect)(()=>{let e=b.data?.defaultEnv??[];e.length&&((S.getValues(`env`)??[]).length||se(`env`,e,{shouldDirty:!1,shouldTouch:!1,shouldValidate:!0}))},[b.data?.defaultEnv,S,se]);let w=oe(`workspaceId`),T=oe(`kind`),de=oe(`source`),fe=oe(`templateRepoId`),E=oe(`template`);oe(`name`);let pe=oe(`forwardCollectorId`);oe(`env`);let me=y.data?.templatesIndexUpdatedAt??``,he=`skyforge.lastWorkspaceId.deployments`;(0,M.useEffect)(()=>{if(w||x.length===0)return;let e=String(a??``).trim();if(e&&x.some(t=>t.id===e)){se(`workspaceId`,e);return}let t=typeof window<`u`?window.localStorage.getItem(he)??``:``;if(t&&x.some(e=>e.id===t)){se(`workspaceId`,t);return}se(`workspaceId`,x[0].id)},[w,x,se]),(0,M.useEffect)(()=>{if(w&&!(typeof window>`u`))try{window.localStorage.setItem(he,w)}catch{}},[w]),(0,M.useEffect)(()=>{se(`name`,`${(E||T).split(`/`).pop()||T}-${new Date().toISOString().replace(/[-:]/g,``).replace(/\..+/,``).slice(0,15)}`)},[E,T,se]);let ge=i({queryKey:H.userNetlabServers(),queryFn:Li,staleTime:3e4,retry:!1}),_e=i({queryKey:H.userContainerlabServers(),queryFn:Ui,staleTime:3e4,retry:!1}),ve=i({queryKey:H.userEveServers(),queryFn:Bi,staleTime:3e4,retry:!1}),ye=i({queryKey:H.workspaceEveLabs(w,h,``,!0),queryFn:()=>Jr(w,{server:h,recursive:!0}),enabled:!!(p&&w&&h),staleTime:3e4,retry:!1}),be=i({queryKey:H.userVariableGroups(),queryFn:To,staleTime:3e4}),xe=i({queryKey:H.userForwardCollectorConfigs(),queryFn:Wa,enabled:[`netlab-c9s`,`clabernetes`,`terraform`].includes(T),staleTime:3e4,retry:!1}),Se=(0,M.useMemo)(()=>(xe.data?.collectors??[]).filter(e=>e&&typeof e.id==`string`&&typeof e.name==`string`).filter(e=>!e.decryptionFailed),[xe.data?.collectors]);(0,M.useEffect)(()=>{if(![`netlab-c9s`,`clabernetes`,`terraform`].includes(T)){(pe??`none`)!==`none`&&se(`forwardCollectorId`,`none`);return}if((pe??`none`)!==`none`)return;let e=String(b.data?.defaultForwardCollectorConfigId??``).trim(),t=(e?Se.find(t=>t.id===e):null)??Se.find(e=>e.isDefault)??Se[0];t?.id&&se(`forwardCollectorId`,String(t.id))},[T,pe,Se,se,b.data?.defaultForwardCollectorConfigId]);let D=(0,M.useMemo)(()=>T===`netlab`||T===`netlab-c9s`?de===`workspace`?`workspace`:`blueprints`:T===`eve_ng`?`blueprints`:T===`containerlab`||T===`clabernetes`||T===`terraform`?de:`workspace`,[T,de]),Ce=i({queryKey:H.workspaceTemplates(w,T,D,fe||void 0,void 0),enabled:!!w,queryFn:async()=>{let e={source:D};switch(D===`external`&&fe&&(e.repo=fe),T){case`netlab`:case`netlab-c9s`:return Da(w,e);case`eve_ng`:return Na(w,e);case`containerlab`:case`clabernetes`:return Aa(w,e);case`terraform`:return ja(w,e);default:return Da(w,e)}},staleTime:5*6e4,refetchOnWindowFocus:!1});(0,M.useEffect)(()=>{me&&t.invalidateQueries({queryKey:[`workspaceTemplates`]})},[me,t]);let we=(0,M.useMemo)(()=>{let e=Ce.data?.templates??[];if(T!==`terraform`)return e;let t=String(d??`all`).trim().toLowerCase();return!t||t===`all`?e:e.filter(e=>String(e).toLowerCase().startsWith(`${t}/`)||String(e).toLowerCase()===t)},[Ce.data?.templates,d,T]),Te=(0,M.useMemo)(()=>{if(T!==`terraform`)return[];let e=Ce.data?.templates??[],t=new Set;for(let n of e){let e=String(n??``).split(`/`)[0]?.trim();e&&t.add(e)}return Array.from(t).sort((e,t)=>e.localeCompare(t))},[Ce.data?.templates,T]);(0,M.useEffect)(()=>{if(T!==`terraform`){f(`all`);return}d!==`all`&&!Te.includes(d)&&f(`all`)},[d,Te,T]);let Ee=i({queryKey:[`workspaceTemplate`,T,w,D,fe,Ce.data?.dir,E],queryFn:async()=>{if(!w)throw Error(`workspaceId is required`);if(!E)throw Error(`template is required`);let e={source:D};return D===`external`&&fe&&(e.repo=fe),Ce.data?.dir&&(e.dir=Ce.data.dir),T===`containerlab`||T===`clabernetes`?Ma(w,{...e,file:E}):Oa(w,{...e,template:E})},enabled:o&&!!w&&!!E&&(T===`netlab`||T===`netlab-c9s`||T===`containerlab`||T===`clabernetes`),retry:!1,staleTime:3e4}),De=(b.data?.externalTemplateRepos??[]).filter(e=>!!e&&typeof e.id==`string`&&typeof e.repo==`string`),ke=De.length>0,Ae=r({mutationFn:async e=>{let t={template:e.template};if(e.variableGroupId&&e.variableGroupId!==`none`&&(t.envGroupIds=[Number.parseInt(e.variableGroupId,10)],t.envGroupScope=`user`),e.env&&e.env.length>0){let n={};for(let t of e.env)t.key.trim()&&(n[t.key.trim()]=t.value);Object.keys(n).length>0&&(t.environment=n)}if([`netlab-c9s`,`clabernetes`,`terraform`].includes(e.kind)){let n=String(e.forwardCollectorId??`none`).trim();n&&n!==`none`&&(t.forwardEnabled=!0,t.forwardCollectorId=n)}if(e.kind===`netlab`||e.kind===`containerlab`){let n=(e.netlabServer||``).trim();if(!n)throw Error(`BYOS server is required`);t.netlabServer=n,t.templateSource=D,D===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),Ce.data?.dir&&(t.templatesDir=Ce.data.dir)}if(e.kind===`netlab-c9s`&&(t.templateSource=D,D===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),Ce.data?.dir&&(t.templatesDir=Ce.data.dir)),e.kind===`clabernetes`&&(t.templateSource=D,D===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),Ce.data?.dir&&(t.templatesDir=Ce.data.dir)),e.kind===`terraform`&&(t.templateSource=D,D===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),Ce.data?.dir&&(t.templatesDir=Ce.data.dir)),e.kind===`eve_ng`){t.templateSource=`blueprints`,Ce.data?.dir&&(t.templatesDir=Ce.data.dir);let n=(e.eveServer||``).trim();if(!n)throw Error(`EVE-NG server is required`);t.eveServer=n}let n={name:e.name,type:e.kind,config:t};return Pa(e.workspaceId,n)},onSuccess:async(n,r)=>{j.success(`Deployment created successfully`,{description:`${r.name} is now queued for provisioning.`}),await t.invalidateQueries({queryKey:H.dashboardSnapshot()}),await e({to:`/dashboard/deployments`,search:{workspace:r.workspaceId}})},onError:e=>{j.error(`Failed to create deployment`,{description:e.message})}}),je=r({mutationFn:async()=>{if(!w)throw Error(`Select a workspace first.`);let e=h.trim();if(!e)throw Error(`Select an EVE-NG server.`);let t=ee.trim();if(!t)throw Error(`Select an EVE-NG lab.`);return Yr(w,{server:e,labPath:t,deploymentName:v.trim()||void 0})},onSuccess:async n=>{j.success(`EVE-NG lab imported`,{description:n?.name??`Deployment created.`}),await t.invalidateQueries({queryKey:H.dashboardSnapshot()}),m(!1),await e({to:`/dashboard/deployments`,search:{workspace:w}})},onError:e=>{j.error(`Failed to import EVE-NG lab`,{description:e.message})}}),Me=r({mutationFn:async()=>{if(!w)throw Error(`Select a workspace first.`);let e=h.trim();if(!e)throw Error(`Select an EVE-NG server.`);let t=ee.trim();if(!t)throw Error(`Select an EVE-NG lab.`);let n=ne,r=ie.trim();if(n&&!r)throw Error(`Select a Containerlab server.`);return Xr(w,{server:e,labPath:t,createDeployment:n,containerlabServer:n?r:void 0})},onSuccess:async n=>{let r=n?.warnings??[];j.success(`Containerlab template created`,{description:n?.path??`Template saved.`}),r.length>0&&j.message(`Conversion warnings`,{description:r.slice(0,3).join(` | `)}),await t.invalidateQueries({queryKey:H.dashboardSnapshot()}),m(!1),n?.deployment&&await e({to:`/dashboard/deployments`,search:{workspace:w}})},onError:e=>{j.error(`Failed to convert EVE-NG lab`,{description:e.message})}}),O=r({mutationFn:async()=>{if(!w)throw Error(`Select a workspace first.`);if(!E)throw Error(`Select a template first.`);let e=new Map;for(let t of S.getValues(`env`)||[]){let n=(t?.key??``).trim();n&&e.set(n,String(t?.value??``))}let t=String(S.getValues(`variableGroupId`)??`none`),n=t===`none`?null:Number(t),r={...(n?Le.find(e=>e.id===n)?.variables:void 0)??{}};for(let[t,n]of e.entries())r[t]=n;let i={source:D,template:E,environment:r};return D===`external`&&fe&&(i.repo=fe),Ce.data?.dir&&(i.dir=Ce.data.dir),ka(w,i)},onSuccess:async t=>{let n=String(t?.task?.id??t?.task?.task_id??``).trim();j.success(`Validation queued`,{description:n?`Run ${n} started.`:`Validation run started.`}),n&&e({to:`/dashboard/runs/$runId`,params:{runId:n}})},onError:e=>{j.error(`Validation failed`,{description:String(e?.message??e)})}});function Ne(e){Ae.mutate(e)}let Pe=ge.data?.servers??[],Fe=_e.data?.servers??[],Ie=ve.data?.servers??[],Le=be.data?.groups??[],Re=Pe.length>0,ze=Fe.length>0,Be=Ie.length>0;(0,M.useEffect)(()=>{p&&!h&&Ie.length>0&&g(`user:${Ie[0].id}`)},[p,h,Ie]),(0,M.useEffect)(()=>{p&&_(``)},[p,h]),(0,M.useEffect)(()=>{!p||!ne||!ie&&Fe.length>0&&ae(`user:${Fe[0].id}`)},[p,ne,ie,Fe]);let Ve=(0,M.useMemo)(()=>Pe.filter(e=>!!e?.id).map(e=>({value:`user:${e.id}`,label:Sd(e.apiUrl)||e.name})),[Pe]),He=(0,M.useMemo)(()=>Fe.filter(e=>!!e?.id).map(e=>({value:`user:${e.id}`,label:Sd(e.apiUrl)||e.name})),[Fe]),Ue=(0,M.useMemo)(()=>(ye.data?.labs??[]).map(e=>({value:e.path,label:e.folder?`${e.folder}/${e.name}`:e.name})).sort((e,t)=>e.label.localeCompare(t.label)),[ye.data?.labs]),We=T===`netlab`?Ve:T===`containerlab`?He:[];return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(z,{children:`Create deployment`}),(0,P.jsx)(B,{children:`Configure and launch a new infrastructure deployment.`})]}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>e({to:`/dashboard/deployments`,search:{workspace:w}}),children:`Cancel`})]})})}),Be&&T===`eve_ng`&&(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Import from EVE-NG`}),(0,P.jsx)(B,{children:`Register an existing EVE-NG lab as a deployment or convert it into a Containerlab template.`})]}),(0,P.jsxs)(V,{className:`flex flex-wrap items-center justify-between gap-3`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Select an EVE-NG lab and import it into Skyforge without rebuilding the topology.`}),(0,P.jsxs)(F,{type:`button`,variant:`outline`,onClick:()=>m(!0),children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`Import EVE-NG lab`]})]})]}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`pt-6`,children:(0,P.jsx)(el,{...S,children:(0,P.jsxs)(`form`,{onSubmit:S.handleSubmit(Ne),className:`space-y-8`,children:[(0,P.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:[(0,P.jsx)(nl,{control:S.control,name:`workspaceId`,render:({field:e})=>(0,P.jsxs)(al,{children:[(0,P.jsx)(ol,{children:`Workspace`}),(0,P.jsxs)(q,{onValueChange:e.onChange,defaultValue:e.value,value:e.value,children:[(0,P.jsx)(sl,{children:(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select workspace`})})}),(0,P.jsx)(X,{children:x.map(e=>(0,P.jsxs)(Z,{value:e.id,children:[e.name,` (`,e.slug,`)`]},e.id))})]}),(0,P.jsx)(ll,{})]})}),(0,P.jsx)(nl,{control:S.control,name:`kind`,render:({field:e})=>(0,P.jsxs)(al,{children:[(0,P.jsx)(ol,{children:`Provider`}),(0,P.jsxs)(q,{onValueChange:t=>{e.onChange(t),S.setValue(`template`,``)},defaultValue:e.value,children:[(0,P.jsx)(sl,{children:(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select provider`})})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`netlab-c9s`,children:`Netlab`}),Re&&(0,P.jsx)(Z,{value:`netlab`,children:`Netlab (BYOS)`}),Be&&(0,P.jsx)(Z,{value:`eve_ng`,children:`EVE-NG`}),ze&&(0,P.jsx)(Z,{value:`containerlab`,children:`Containerlab (BYOS)`}),(0,P.jsx)(Z,{value:`clabernetes`,children:`Containerlab`}),(0,P.jsx)(Z,{value:`terraform`,children:`Terraform`})]})]}),(0,P.jsx)(ll,{})]})}),[`netlab-c9s`,`clabernetes`,`terraform`].includes(T)&&(0,P.jsx)(nl,{control:S.control,name:`forwardCollectorId`,render:({field:e})=>(0,P.jsxs)(al,{className:`rounded-md border p-3 md:col-span-2 space-y-2`,children:[(0,P.jsx)(ol,{children:`Forward collector`}),(0,P.jsxs)(cl,{children:[`Optional. Select a per-user in-cluster Collector. Configure collectors under`,` `,(0,P.jsx)(`code`,{className:`font-mono`,children:`Dashboard  Forward`}),`.`]}),xe.isError?(0,P.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to load collectors.`}):null,xe.data&&Se.length===0?(0,P.jsx)(`div`,{className:`text-xs text-destructive`,children:`No collectors configured yet.`}):null,(0,P.jsxs)(q,{value:String(e.value??`none`),onValueChange:t=>e.onChange(t),disabled:xe.isLoading,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select a collector (or None)`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`none`,children:`None`}),Se.map(e=>(0,P.jsx)(Z,{value:String(e.id),children:String(e.name)},String(e.id)))]})]})]})}),(0,P.jsx)(nl,{control:S.control,name:`source`,render:({field:e})=>(0,P.jsxs)(al,{children:[(0,P.jsxs)(ol,{className:`flex items-center gap-2`,children:[`Template source`,(0,P.jsx)(hd,{children:(0,P.jsxs)(gd,{children:[(0,P.jsx)(_d,{asChild:!0,children:(0,P.jsx)(mt,{className:`h-4 w-4 text-muted-foreground`})}),(0,P.jsx)(vd,{children:(0,P.jsx)(`p`,{children:`Git repository or URL containing deployment templates`})})]})})]}),(0,P.jsxs)(q,{onValueChange:t=>{e.onChange(t),S.setValue(`templateRepoId`,``),S.setValue(`template`,``)},defaultValue:e.value,children:[(0,P.jsx)(sl,{children:(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select source`})})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`workspace`,children:`Workspace repo`}),(0,P.jsx)(Z,{value:`blueprints`,children:`Blueprints`}),(0,P.jsx)(Z,{value:`external`,disabled:!ke||T!==`containerlab`&&T!==`clabernetes`&&T!==`terraform`,children:`External repo`})]})]}),!ke&&(T===`containerlab`||T===`clabernetes`||T===`terraform`)&&(0,P.jsx)(cl,{children:`No external repos configured in My Settings.`}),(0,P.jsx)(ll,{})]})}),D===`external`&&(0,P.jsx)(nl,{control:S.control,name:`templateRepoId`,render:({field:e})=>(0,P.jsxs)(al,{children:[(0,P.jsx)(ol,{children:`External repo`}),(0,P.jsxs)(q,{onValueChange:t=>{e.onChange(t),S.setValue(`template`,``)},defaultValue:e.value,children:[(0,P.jsx)(sl,{children:(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select repo`})})}),(0,P.jsx)(X,{children:De.map(e=>(0,P.jsxs)(Z,{value:e.id,children:[e.name,` (`,e.repo,`)`]},e.id))})]}),(0,P.jsx)(ll,{})]})}),(T===`netlab`||T===`containerlab`)&&(0,P.jsx)(nl,{control:S.control,name:`netlabServer`,render:({field:e})=>(0,P.jsxs)(al,{children:[(0,P.jsx)(ol,{children:`BYOS server`}),(0,P.jsxs)(q,{onValueChange:e.onChange,defaultValue:e.value||``,value:e.value||``,children:[(0,P.jsx)(sl,{children:(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select server`})})}),(0,P.jsx)(X,{children:We.map(e=>(0,P.jsx)(Z,{value:e.value,children:e.label},e.value))})]}),(ge.isLoading||_e.isLoading)&&(0,P.jsx)(cl,{children:`Loading servers`}),(0,P.jsxs)(cl,{children:[`Configure servers under`,` `,(0,P.jsx)(`code`,{className:`font-mono`,children:`Dashboard  Settings`}),`.`]}),(0,P.jsx)(ll,{})]})}),T===`eve_ng`&&(0,P.jsx)(nl,{control:S.control,name:`eveServer`,render:({field:e})=>(0,P.jsxs)(al,{children:[(0,P.jsx)(ol,{children:`EVE-NG server`}),(0,P.jsxs)(q,{onValueChange:e.onChange,defaultValue:e.value||``,value:e.value||``,children:[(0,P.jsx)(sl,{children:(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select server`})})}),(0,P.jsx)(X,{children:Ie.map(e=>(0,P.jsx)(Z,{value:`user:${e.id}`,children:Sd(e.apiUrl)||e.name},e.id))})]}),ve.isLoading&&(0,P.jsx)(cl,{children:`Loading servers`}),(0,P.jsxs)(cl,{children:[`Configure servers under`,` `,(0,P.jsx)(`code`,{className:`font-mono`,children:`Dashboard  Settings`}),`.`]}),(0,P.jsx)(ll,{})]})}),(0,P.jsx)(nl,{control:S.control,name:`template`,render:({field:e})=>(0,P.jsxs)(al,{children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsx)(ol,{children:`Template`}),(T===`netlab`||T===`netlab-c9s`||T===`containerlab`||T===`clabernetes`)&&(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{type:`button`,variant:`outline`,size:`sm`,disabled:!E,onClick:()=>s(!0),children:`View`}),T===`netlab`||T===`netlab-c9s`?(0,P.jsx)(F,{type:`button`,variant:`outline`,size:`sm`,disabled:!E||O.isPending,onClick:()=>O.mutate(),children:O.isPending?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Et,{className:`mr-2 h-3 w-3 animate-spin`}),` `,`Validating`]}):`Validate`}):null]})]}),T===`terraform`?(0,P.jsxs)(`div`,{className:`grid gap-2 rounded-md border p-3`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Terraform templates are grouped by provider (folder name). Select a provider to filter the template list.`}),(0,P.jsxs)(q,{value:d,onValueChange:e=>f(e),disabled:Ce.isLoading||Te.length===0&&we.length===0,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Provider filter`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All providers`}),Te.map(e=>(0,P.jsx)(Z,{value:e,children:e},e)),(0,P.jsx)(Z,{value:`ibm`,disabled:!0,children:`ibm (coming soon)`})]})]})]}):null,(0,P.jsxs)(q,{onValueChange:e.onChange,defaultValue:e.value,disabled:Ce.isLoading||we.length===0,children:[(0,P.jsx)(sl,{children:(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:Ce.isLoading?`Loading`:we.length?`Select template`:`No templates`})})}),(0,P.jsx)(X,{children:we.map(e=>(0,P.jsx)(Z,{value:e,children:e},e))})]}),Ce.isError&&(0,P.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to load templates.`}),(0,P.jsx)(ll,{})]})}),(0,P.jsx)(nl,{control:S.control,name:`name`,render:({field:e})=>(0,P.jsxs)(al,{children:[(0,P.jsx)(ol,{children:`Deployment name`}),(0,P.jsx)(sl,{children:(0,P.jsx)(K,{placeholder:`My Deployment`,...e})}),(0,P.jsx)(cl,{children:`Custom name for this specific deployment instance.`}),(0,P.jsx)(ll,{})]})})]}),(0,P.jsxs)(`div`,{className:`rounded-md border p-4 space-y-4`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(ol,{children:`Environment Variables`}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(T===`netlab-c9s`||T===`netlab`)&&(0,P.jsx)(F,{type:`button`,variant:`outline`,size:`sm`,onClick:()=>u(!0),children:`Supported NETLAB_ vars`}),(0,P.jsxs)(F,{type:`button`,variant:`outline`,size:`sm`,onClick:()=>C({key:``,value:``}),children:[(0,P.jsx)(gn,{className:`mr-2 h-3 w-3`}),` Add Variable`]})]})]}),(0,P.jsx)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:(0,P.jsx)(nl,{control:S.control,name:`variableGroupId`,render:({field:e})=>(0,P.jsxs)(al,{children:[(0,P.jsx)(ol,{className:`text-xs text-muted-foreground`,children:`Variable Group`}),(0,P.jsxs)(q,{onValueChange:e.onChange,defaultValue:e.value||`none`,value:e.value||`none`,children:[(0,P.jsx)(sl,{children:(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`None`})})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`none`,children:`None`}),Le.map(e=>(0,P.jsx)(Z,{value:String(e.id),children:e.name},e.id))]})]})]})})}),le.length>0&&(0,P.jsx)(`div`,{className:`space-y-2`,children:le.map((e,t)=>(0,P.jsxs)(`div`,{className:`flex gap-2 items-start`,children:[T===`netlab-c9s`||T===`netlab`?(0,P.jsx)(nl,{control:S.control,name:`env.${t}.key`,render:({field:e})=>{let t=String(e.value??``).trim(),n=yl.some(e=>e.key===t)?t:`__custom__`;return(0,P.jsxs)(al,{className:`flex-1 space-y-2`,children:[(0,P.jsx)(sl,{children:(0,P.jsxs)(q,{value:n,onValueChange:t=>{t===`__custom__`?e.onChange(``):e.onChange(t)},children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select env var`})}),(0,P.jsxs)(X,{children:[yl.map(e=>(0,P.jsx)(Z,{value:e.key,children:e.label},e.key)),(0,P.jsx)(Z,{value:`__custom__`,children:`Custom`})]})]})}),n===`__custom__`&&(0,P.jsx)(sl,{children:(0,P.jsx)(K,{...e,placeholder:`KEY`,className:`font-mono text-xs`})}),(0,P.jsx)(ll,{})]})}}):(0,P.jsx)(nl,{control:S.control,name:`env.${t}.key`,render:({field:e})=>(0,P.jsxs)(al,{className:`flex-1`,children:[(0,P.jsx)(sl,{children:(0,P.jsx)(K,{...e,placeholder:`KEY`,className:`font-mono text-xs`})}),(0,P.jsx)(ll,{})]})}),(0,P.jsx)(nl,{control:S.control,name:`env.${t}.value`,render:({field:e})=>(0,P.jsxs)(al,{className:`flex-1`,children:[(0,P.jsx)(sl,{children:(()=>{let n=String(S.getValues(`env.${t}.key`)??``).trim();if(xl(n))return(0,P.jsx)(ul,{...e,placeholder:`One \`key=value\` per line.
Example:
addressing.p2p.ipv4=198.18.0.0/16`,className:`font-mono text-xs min-h-[120px]`});let r=Sl(n);if(!r)return(0,P.jsx)(K,{...e,placeholder:`VALUE`,className:`font-mono text-xs`});let i=String(e.value??``).trim(),a=r.some(e=>e.value===i),o=i?a?i:`__custom__`:`none`;return(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(q,{value:o,onValueChange:t=>{t===`none`?e.onChange(``):t===`__custom__`?e.onChange(i&&!a?i:``):e.onChange(t)},children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select value`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`none`,children:`None`}),r.map(e=>(0,P.jsx)(Z,{value:e.value,children:e.label},e.value)),(0,P.jsx)(Z,{value:`__custom__`,children:`Custom`})]})]}),o===`__custom__`&&(0,P.jsx)(K,{...e,placeholder:`VALUE`,className:`font-mono text-xs`})]})})()}),(0,P.jsx)(ll,{})]})}),(0,P.jsx)(F,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>ue(t),className:`shrink-0`,children:(0,P.jsx)(tt,{className:`h-4 w-4 text-muted-foreground`})})]},e.id))})]}),(0,P.jsx)(tr,{open:l,onOpenChange:u,children:(0,P.jsxs)(ir,{className:`max-w-2xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Supported Netlab overrides`}),(0,P.jsxs)(cr,{children:[`These variables are passed into the Netlab generator. Use`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`NETLAB_*`}),` for native Netlab defaults, and`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`SKYFORGE_NETLAB_SET_OVERRIDES`}),` `,`for generator-only`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`netlab --set`}),` overrides.`]})]}),(0,P.jsx)(`div`,{className:`space-y-2 text-sm`,children:yl.map(e=>(0,P.jsx)(`div`,{className:`flex items-start justify-between gap-3 rounded-md border p-3`,children:(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(`div`,{className:`font-medium`,children:e.label}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono break-all`,children:e.key})]})},e.key))})]})}),Ae.isError&&(0,P.jsx)(`div`,{className:`rounded-md bg-destructive/15 p-3 text-sm text-destructive border border-destructive/20`,children:Ae.error?.message||`Create failed.`}),(0,P.jsxs)(`div`,{className:`flex gap-3`,children:[(0,P.jsxs)(F,{type:`submit`,disabled:Ae.isPending,children:[Ae.isPending&&(0,P.jsx)(Et,{className:`mr-2 h-4 w-4 animate-spin`}),Ae.isPending?`Creating`:`Create Deployment`]}),(0,P.jsx)(F,{type:`button`,variant:`secondary`,onClick:()=>{e({to:`/dashboard/deployments`,search:{workspace:w}})},disabled:Ae.isPending,children:`Back`})]})]})})})}),(0,P.jsx)(tr,{open:p,onOpenChange:m,children:(0,P.jsxs)(ir,{className:`max-w-2xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Import EVE-NG lab`}),(0,P.jsx)(cr,{children:`Pull an existing EVE-NG lab into Skyforge or convert it into a Containerlab template.`})]}),(0,P.jsxs)(`div`,{className:`grid gap-4`,children:[(0,P.jsxs)(`div`,{className:`grid gap-2`,children:[(0,P.jsx)(ol,{children:`EVE-NG server`}),(0,P.jsxs)(q,{value:h,onValueChange:g,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select EVE-NG server`})}),(0,P.jsx)(X,{children:Ie.map(e=>(0,P.jsx)(Z,{value:`user:${e.id}`,children:Sd(e.apiUrl)||e.name},e.id))})]}),(0,P.jsx)(cl,{children:`Configure EVE-NG servers in Settings if none appear.`})]}),(0,P.jsxs)(`div`,{className:`grid gap-2`,children:[(0,P.jsx)(ol,{children:`EVE-NG lab`}),(0,P.jsxs)(q,{value:ee,onValueChange:_,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select lab`})}),(0,P.jsxs)(X,{children:[ye.isLoading&&(0,P.jsx)(`div`,{className:`px-3 py-2 text-xs text-muted-foreground`,children:`Loading labs`}),!ye.isLoading&&Ue.length===0&&(0,P.jsx)(`div`,{className:`px-3 py-2 text-xs text-muted-foreground`,children:`No labs found.`}),Ue.map(e=>(0,P.jsx)(Z,{value:e.value,children:e.label},e.value))]})]}),ye.isError&&(0,P.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to load labs.`})]}),(0,P.jsxs)(`div`,{className:`grid gap-2`,children:[(0,P.jsx)(ol,{children:`Deployment name`}),(0,P.jsx)(K,{value:v,onChange:e=>te(e.target.value),placeholder:`Optional override`}),(0,P.jsx)(cl,{children:`Defaults to the EVE-NG lab name if left empty.`})]}),(0,P.jsxs)(`div`,{className:`flex items-start justify-between gap-3 rounded-md border p-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(ol,{className:`text-sm`,children:`Create Containerlab deployment`}),(0,P.jsx)(cl,{children:`Generate a Containerlab template and optionally create a deployment.`})]}),(0,P.jsx)(Nc,{checked:ne,onCheckedChange:re})]}),ne&&(0,P.jsxs)(`div`,{className:`grid gap-2`,children:[(0,P.jsx)(ol,{children:`Containerlab server`}),(0,P.jsxs)(q,{value:ie,onValueChange:ae,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select Containerlab server`})}),(0,P.jsx)(X,{children:He.map(e=>(0,P.jsx)(Z,{value:e.value,children:e.label},e.value))})]}),(0,P.jsx)(cl,{children:`Required to create a Containerlab deployment.`})]})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap justify-end gap-2 pt-2`,children:[(0,P.jsx)(F,{type:`button`,variant:`outline`,onClick:()=>m(!1),children:`Cancel`}),(0,P.jsxs)(F,{type:`button`,variant:`secondary`,onClick:()=>je.mutate(),disabled:je.isPending||Me.isPending,children:[je.isPending&&(0,P.jsx)(Et,{className:`mr-2 h-4 w-4 animate-spin`}),`Import EVE-NG`]}),(0,P.jsxs)(F,{type:`button`,onClick:()=>Me.mutate(),disabled:je.isPending||Me.isPending,children:[Me.isPending&&(0,P.jsx)(Et,{className:`mr-2 h-4 w-4 animate-spin`}),`Convert to Containerlab`]})]})]})}),(0,P.jsx)(tr,{open:o,onOpenChange:s,children:(0,P.jsxs)(ir,{className:`max-w-4xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Template`}),(0,P.jsx)(cr,{className:`font-mono text-xs truncate`,children:String(Ee.data?.path??E)})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[Ee.isError&&(0,P.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load template.`}),(0,P.jsx)(ul,{readOnly:!0,value:String(Ee.data?.yaml??``),className:`h-[60vh] font-mono text-xs`,placeholder:Ee.isLoading?`Loading`:`No template loaded.`})]})]})})]})}const wd=t(`/dashboard/deployments/$deploymentId/`)({component:Td,validateSearch:e=>{let t={};return typeof e.action==`string`&&e.action.trim()&&(t.action=e.action.trim()),typeof e.node==`string`&&e.node.trim()&&(t.node=e.node.trim()),t}});function Td(){let{deploymentId:e}=wd.useParams(),{action:t,node:a}=wd.useSearch(),o=n(),s=c();lu(!0);let[l,u]=(0,M.useState)(!1),[d,f]=(0,M.useState)(!1),[m,h]=(0,M.useState)(``),g=i({queryKey:H.dashboardSnapshot(),queryFn:async()=>null,initialData:null,retry:!1,staleTime:1/0}),_=(0,M.useMemo)(()=>(g.data?.deployments??[]).find(t=>t.id===e),[g.data?.deployments,e]),v=String(_?.workspaceId??``),ne=String(_?.type??``);(0,M.useEffect)(()=>{let e=!!(_?.config??{}).forwardEnabled,t=String((_?.config??{}).forwardCollectorId??``).trim();f(e),h(t)},[_?.id,_?.config]);let re=String(_?.activeTaskId??``);Gl(re,!!re);let ie=i({queryKey:H.runLogs(re),queryFn:async()=>({cursor:0,entries:[]}),retry:!1,staleTime:1/0,enabled:!!re}),ae=async()=>{try{if(!_)throw Error(`deployment not found`);await yo(_.workspaceId,_.id),j.success(`Deployment starting`,{description:`${_.name} is queued to start.`})}catch(e){j.error(`Failed to start`,{description:e.message})}},y=async()=>{try{if(!_)throw Error(`deployment not found`);await bo(_.workspaceId,_.id),j.success(`Deployment stopping`,{description:`${_.name} is queued to stop.`})}catch(e){j.error(`Failed to stop`,{description:e.message})}},b=async()=>{try{if(!_)throw Error(`deployment not found`);await xo(_.workspaceId,_.id),j.success(`Deployment deleted`),await s.invalidateQueries({queryKey:H.dashboardSnapshot()}),o({to:`/dashboard/deployments`,search:{workspace:_.workspaceId}})}catch(e){j.error(`Failed to delete`,{description:e.message})}},x=_?.activeTaskStatus??_?.lastStatus??`unknown`,S=!!_?.activeTaskId,oe=(0,M.useMemo)(()=>{if(!_)return[];let e=(g.data?.runs??[]).filter(e=>String(e.workspaceId??``)===_.workspaceId),t=e.filter(e=>String(e.deploymentId??``)===_.id);return t.length>0?t:e},[_,g.data?.runs]),se=i({queryKey:H.deploymentTopology(v,e),queryFn:async()=>{if(!_)throw Error(`deployment not found`);return Ba(_.workspaceId,_.id)},enabled:!!_&&[`containerlab`,`netlab-c9s`,`clabernetes`].includes(ne),retry:!1,staleTime:1e4}),ce=r({mutationFn:async e=>{if(!_)throw Error(`deployment not found`);return Ta(_.workspaceId,_.id,e)},onSuccess:(e,t)=>{if(e?.skipped){j.message(`Save config skipped`,{description:e.message||`Node ${t}`});return}j.success(`Save config queued/applied`,{description:e.stdout||`Node ${t}`})},onError:e=>j.error(`Save config failed`,{description:e.message})}),le=async()=>{if(!_)return;let e=se.data?.nodes??[];if(!e.length){j.message(`No nodes to save`);return}if(ce.isPending)return;j.message(`Saving configs`,{description:`Nodes: ${e.length}`});let t=e.map(e=>String(e.id)),n=0,r=0,i=0,a=0;if(await Promise.all(Array.from({length:Math.min(3,t.length)},async()=>{for(;n<t.length;){let e=t[n++];try{(await Ta(_.workspaceId,_.id,e))?.skipped?i++:r++}catch{a++}}})),a){j.error(`Save configs finished with errors`,{description:`ok=${r} skipped=${i} failed=${a}`});return}j.success(`Save configs finished`,{description:`ok=${r} skipped=${i}`})},C=()=>{try{if(!_){j.error(`Cannot download config`,{description:`Deployment not found.`});return}let e=new Blob([JSON.stringify(_.config??{},null,2)],{type:`application/json`}),t=document.createElement(`a`),n=String(_.name??`deployment`).replace(/[^a-zA-Z0-9._-]+/g,`_`);t.href=URL.createObjectURL(e),t.download=`${n}.config.json`,document.body.appendChild(t),t.click(),t.remove(),setTimeout(()=>URL.revokeObjectURL(t.href),5e3),j.success(`Downloaded config`)}catch(e){j.error(`Failed to download config`,{description:e.message})}},ue=i({queryKey:H.userForwardCollectorConfigs(),queryFn:Wa,enabled:d,retry:!1,staleTime:3e4}),w=ue.data?.collectors??[],T=r({mutationFn:async e=>{if(!_)throw Error(`deployment not found`);return Ki(_.workspaceId,_.id,e)},onSuccess:async()=>{j.success(`Forward settings updated`),await s.invalidateQueries({queryKey:H.dashboardSnapshot()})},onError:e=>j.error(`Failed to update Forward settings`,{description:e.message})}),de=r({mutationFn:async()=>{if(!_)throw Error(`deployment not found`);return qi(_.workspaceId,_.id)},onSuccess:async e=>{j.success(`Forward sync queued`,{description:`Run ${String(e.run?.id??``)}`}),await s.invalidateQueries({queryKey:H.dashboardSnapshot()})},onError:e=>j.error(`Failed to sync to Forward`,{description:e.message})});if(t&&a&&_){if(t===`terminal`)return(0,P.jsx)(`div`,{className:`h-screen w-screen bg-zinc-950 flex flex-col`,children:(0,P.jsx)(Lu,{workspaceId:v,deploymentId:e,nodeId:a,className:`flex-1`})});if(t===`logs`)return(0,P.jsx)(`div`,{className:`h-screen w-screen bg-background flex flex-col`,children:(0,P.jsx)(Nu,{workspaceId:v,deploymentId:e,nodeId:a,className:`flex-1`})});if(t===`describe`)return(0,P.jsx)(`div`,{className:`h-screen w-screen bg-background flex flex-col`,children:(0,P.jsx)(ju,{workspaceId:v,deploymentId:e,nodeId:a,className:`flex-1`})})}return _?(0,P.jsxs)(`div`,{className:`space-y-6 p-6 pb-20`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(p,{to:`/dashboard/deployments`,className:Cr({variant:`outline`,size:`icon`,className:`h-9 w-9`}),children:(0,P.jsx)(ee,{className:`h-4 w-4`})}),(0,P.jsxs)(`div`,{children:[(0,P.jsxs)(`h1`,{className:`text-2xl font-bold tracking-tight flex items-center gap-3`,children:[_.name,(0,P.jsx)(Ed,{status:x})]}),(0,P.jsxs)(`p`,{className:`text-sm text-muted-foreground flex items-center gap-2 mt-1`,children:[(0,P.jsx)(`span`,{className:`font-mono text-xs bg-muted px-1.5 py-0.5 rounded`,children:_.id}),(0,P.jsx)(`span`,{children:``}),(0,P.jsx)(`span`,{className:`capitalize`,children:_.type})]})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(p,{to:`/dashboard/deployments/$deploymentId/capacity`,params:{deploymentId:e},className:Cr({variant:`outline`,size:`sm`}),title:`Capacity rollups and forecasting`,children:[(0,P.jsx)(Hn,{className:`mr-2 h-4 w-4`}),` Capacity`]}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:ae,disabled:S,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),` Start`]}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:y,disabled:S,children:[(0,P.jsx)(et,{className:`mr-2 h-4 w-4`}),` Stop`]}),(0,P.jsxs)(F,{variant:`destructive`,size:`sm`,onClick:()=>u(!0),disabled:S,children:[(0,P.jsx)(tt,{className:`mr-2 h-4 w-4`}),` Delete`]})]})]}),(0,P.jsxs)(Bc,{defaultValue:`topology`,className:`space-y-6`,children:[(0,P.jsxs)(Vc,{children:[(0,P.jsxs)(Hc,{value:`topology`,className:`gap-2`,children:[(0,P.jsx)(yn,{className:`h-4 w-4`}),` Topology`]}),(0,P.jsxs)(Hc,{value:`logs`,className:`gap-2`,children:[(0,P.jsx)(he,{className:`h-4 w-4`}),` Logs & Events`]}),(0,P.jsxs)(Hc,{value:`config`,className:`gap-2`,children:[(0,P.jsx)(Ne,{className:`h-4 w-4`}),` Configuration`]})]}),(0,P.jsxs)(Uc,{value:`topology`,className:`space-y-6 animate-in fade-in-50`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-3`,children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(z,{children:`Network Topology`}),(0,P.jsx)(B,{children:_.type===`containerlab`?`Derived from containerlab after deploy (includes resolved mgmt IPs).`:_.type===`netlab-c9s`||_.type===`clabernetes`?`Derived from clabernetes after deploy (includes resolved mgmt IPs).`:`Topology is provider-dependent; not yet implemented for this deployment type.`})]}),(0,P.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>{let e=window.location.pathname,t=e.endsWith(`/`)?e.slice(0,-1):e;window.open(`${t}/map`,`_blank`,`noopener,noreferrer`)},title:`Open the full-screen map view in a new tab`,children:[(0,P.jsx)(te,{className:`mr-2 h-4 w-4`}),`Open map`]})})]})}),(0,P.jsx)(V,{children:(0,P.jsx)(Hu,{topology:se.data,workspaceId:_.workspaceId,deploymentId:_.id,enableTerminal:[`netlab-c9s`,`clabernetes`].includes(_.type)})})]}),se.data?.nodes?.length?(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-3`,children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(z,{children:`Nodes`}),(0,P.jsx)(B,{children:`Quick actions (opens in a new tab where applicable).`})]}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,disabled:ce.isPending,onClick:le,children:ce.isPending?`Saving`:`Save all configs`})]})}),(0,P.jsx)(V,{children:(0,P.jsx)(`div`,{className:`space-y-2`,children:se.data.nodes.map(e=>{let t=String(e.id),n=String(e.kind??``),r=String(e.mgmtIp??``),i=String(e.status??``),a=`${window.location.pathname}?node=${encodeURIComponent(t)}`;return(0,P.jsxs)(`div`,{className:`flex flex-col gap-2 rounded-md border p-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:t}),i?(0,P.jsx)(W,{variant:`secondary`,className:`capitalize`,children:i}):null,n?(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground truncate`,children:n}):null]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate mt-1`,children:r||``})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsx)(F,{size:`sm`,variant:`outline`,disabled:![`netlab-c9s`,`clabernetes`].includes(_.type),onClick:()=>window.open(`${a}&action=terminal`,`_blank`,`noopener,noreferrer`),children:`Terminal`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,onClick:()=>window.open(`${a}&action=logs`,`_blank`,`noopener,noreferrer`),children:`Logs`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,onClick:()=>window.open(`${a}&action=describe`,`_blank`,`noopener,noreferrer`),children:`Describe`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,disabled:ce.isPending,onClick:()=>ce.mutate(t),children:ce.isPending?`Saving`:`Save config`}),(0,P.jsx)(F,{size:`sm`,variant:`ghost`,onClick:()=>{if(!r.trim()){j.error(`No management IP available`);return}navigator.clipboard?.writeText(r),j.success(`Copied management IP`)},children:`Copy IP`})]})]},t)})})})]}):null]}),(0,P.jsx)(Uc,{value:`logs`,className:`space-y-6 animate-in fade-in-50`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Logs & Events`}),(0,P.jsx)(B,{children:`Live task output.`})]}),(0,P.jsxs)(V,{children:[_.activeTaskId?(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsxs)(`div`,{className:`text-sm font-medium`,children:[`Active run: `,String(_.activeTaskId)]}),(0,P.jsx)(p,{to:`/dashboard/runs/$runId`,params:{runId:String(_.activeTaskId)},className:Cr({variant:`outline`,size:`sm`}),children:`Open run details`})]}),(0,P.jsx)(`div`,{className:`rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100`,children:(0,P.jsx)(Dd,{entries:ie.data?.entries??[]})})]}):(0,P.jsxs)(`div`,{className:`flex flex-col items-center justify-center py-10 text-center text-muted-foreground border-2 border-dashed rounded-lg`,children:[(0,P.jsx)(he,{className:`h-10 w-10 mb-3 opacity-20`}),(0,P.jsx)(`p`,{children:`No active run.`}),(0,P.jsx)(`p`,{className:`text-xs mt-1`,children:`Start/stop/destroy will queue runs that appear here.`})]}),(0,P.jsxs)(`div`,{className:`mt-8 space-y-3`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Recent runs`}),(0,P.jsx)(`div`,{className:`space-y-2`,children:oe.length===0?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No runs yet.`}):oe.slice(0,10).map(e=>{let t=String(e.id??``);return(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3 rounded-md border p-3`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:t}),(0,P.jsx)(W,{variant:`secondary`,className:`capitalize`,children:String(e.status??``)}),(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground truncate`,children:String(e.tpl_alias??e.type??``)})]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground truncate mt-1`,children:String(e.status_text??e.message??``)})]}),(0,P.jsx)(p,{to:`/dashboard/runs/$runId`,params:{runId:t},className:Cr({variant:`outline`,size:`sm`}),children:`View`})]},t)})})]})]})]})}),(0,P.jsxs)(Uc,{value:`config`,className:`space-y-6 animate-in fade-in-50`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Forward Networks`}),(0,P.jsx)(B,{children:`Optional: sync device IPs into Forward for collection.`})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Enable Forward collection`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Requires configuring your Collector first.`})]}),(0,P.jsx)(Nc,{checked:d,disabled:T.isPending,onCheckedChange:e=>{f(e);let t=e?m.trim():``;T.mutate({enabled:e,collectorConfigId:t||void 0})}})]}),d?(0,P.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Collector`}),(0,P.jsxs)(q,{value:m,onValueChange:e=>{h(e),T.mutate({enabled:!0,collectorConfigId:e})},disabled:ue.isLoading||ue.isError||T.isPending,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:ue.isLoading?`Loading`:ue.isError?`Configure Collector first`:`Select collector`})}),(0,P.jsx)(X,{children:w.map(e=>(0,P.jsx)(Z,{value:e.id,children:e.name},e.id))})]})]}),(0,P.jsx)(`div`,{className:`flex items-end gap-2`,children:(0,P.jsx)(F,{variant:`outline`,onClick:()=>de.mutate(),disabled:!m.trim()||de.isPending||T.isPending,children:de.isPending?`Queueing`:`Sync now`})})]}):null]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(z,{children:`Configuration`}),(0,P.jsx)(B,{children:`Read-only view of the deployment parameters.`})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(F,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(JSON.stringify(_.config??{},null,2)),j.success(`Copied config JSON`)},children:[(0,P.jsx)(Te,{className:`mr-2 h-4 w-4`}),`Copy`]}),(0,P.jsxs)(F,{size:`sm`,variant:`outline`,onClick:C,children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`Download`]})]})]})}),(0,P.jsx)(V,{children:(0,P.jsx)(`pre`,{className:`bg-muted p-4 rounded-lg overflow-auto font-mono text-xs max-h-[500px]`,children:JSON.stringify(_.config,null,2)})})]})]})]}),(0,P.jsx)(xc,{open:l,onOpenChange:u,children:(0,P.jsxs)(wc,{children:[(0,P.jsxs)(Tc,{children:[(0,P.jsx)(Dc,{children:`Delete deployment?`}),(0,P.jsxs)(Oc,{children:[`This will remove `,(0,P.jsx)(`strong`,{children:_.name}),` from Skyforge and trigger provider cleanup. This action cannot be undone.`]})]}),(0,P.jsxs)(Ec,{children:[(0,P.jsx)(Ac,{children:`Cancel`}),(0,P.jsx)(kc,{onClick:b,className:Cr({variant:`destructive`}),children:`Delete Deployment`})]})]})})]}):g.isLoading||g.isFetching?(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,P.jsx)(U,{className:`h-10 w-32`}),(0,P.jsx)(U,{className:`h-10 w-48`})]}),(0,P.jsx)(U,{className:`h-[400px] w-full`})]}):(0,P.jsx)(`div`,{className:`p-6`,children:(0,P.jsx)(ec,{icon:ot,title:`Deployment not found`,description:`This deployment may have been deleted or you don't have access.`,action:{label:`Back to Deployments`,onClick:()=>o({to:`/dashboard/deployments`})}})})}function Ed({status:e}){let t=`secondary`,n=e.toLowerCase();return[`running`,`active`,`healthy`,`succeeded`,`success`].includes(n)&&(t=`default`),[`failed`,`error`,`stopped`,`crashloopbackoff`].includes(n)&&(t=`destructive`),(0,P.jsx)(W,{variant:t,className:`capitalize`,children:e})}function Dd(e){let t=(0,M.useRef)(null);return(0,M.useEffect)(()=>{let e=t.current;e&&(e.scrollTop=e.scrollHeight)},[e.entries.length]),e.entries.length===0?(0,P.jsx)(`div`,{className:`text-zinc-500`,children:`Waiting for output`}):(0,P.jsx)(`div`,{ref:t,className:`max-h-[65vh] overflow-auto whitespace-pre-wrap`,children:e.entries.map((e,t)=>(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`span`,{className:`text-zinc-500 select-none`,children:e.time?`${e.time} `:``}),(0,P.jsx)(`span`,{children:e.output})]},`${e.time}-${t}`))})}const Od=t(`/dashboard/workspaces/$workspaceId/policy-reports`)({validateSearch:e=>Qn({embed:qn().optional().catch(``),forwardNetworkId:qn().optional().catch(``),snapshotId:qn().optional().catch(``),flows:qn().optional().catch(``),tab:qn().optional().catch(``)}).parse(e),component:Bd});function kd(e){try{return JSON.stringify(e,null,2)}catch{return String(e)}}function Ad(e,t){let n=new Blob([JSON.stringify(t,null,2)],{type:`application/json`}),r=URL.createObjectURL(n);try{let t=document.createElement(`a`);t.href=r,t.download=e,t.click()}finally{URL.revokeObjectURL(r)}}function jd(e,t,n){let r=new Blob([n],{type:t}),i=URL.createObjectURL(r);try{let t=document.createElement(`a`);t.href=i,t.download=e,t.click()}finally{URL.revokeObjectURL(i)}}function Md(e){let t=e==null?``:String(e);return t.includes(`"`)||t.includes(`,`)||t.includes(`
`)||t.includes(`\r`)?`"${t.replaceAll(`"`,`""`)}"`:t}function Nd(e){if(!Array.isArray(e)||e.length===0)return``;let t=e.filter(e=>e&&typeof e==`object`);if(t.length===0)return``;let n=Array.from(new Set(t.flatMap(e=>Object.keys(e??{})))).sort();return[n.map(Md).join(`,`),...t.map(e=>n.map(t=>{let n=e[t];return n==null?``:Md(typeof n==`string`||typeof n==`number`||typeof n==`boolean`?n:JSON.stringify(n))}).join(`,`))].join(`
`)}function Pd(e){let t=e.split(/[\n,]+/g).map(e=>e.trim()).filter(Boolean),n=[],r=new Set;for(let e of t)r.has(e)||(r.add(e),n.push(e));return n}function Fd(e){let t=e.split(/[\n,]+/g).map(e=>e.trim()).filter(Boolean),n=[],r=new Set;for(let e of t){let t=Number(e);if(!Number.isFinite(t)||t<=0||t>65535)continue;let i=Math.trunc(t);r.has(i)||(r.add(i),n.push(i))}return n}function Id(e){let t=e.split(/\r?\n/g).map(e=>e.trim()),n=[];for(let e of t){if(!e||e.startsWith(`#`))continue;let t=e.split(/[,\s]+/g).map(e=>e.trim()).filter(Boolean);if(t.length<2)continue;let r=t[0]??``,i=t[1]??``,a=Number(t[2]??`6`),o=Number(t[3]??`443`);!r||!i||n.push({srcIp:r,dstIp:i,ipProto:Number.isFinite(a)?Math.trunc(a):6,dstPort:Number.isFinite(o)?Math.trunc(o):443})}return n}function Ld(e){let t=String(e??``).toLowerCase();return t===`high`||t===`critical`?`destructive`:t===`medium`?`default`:`secondary`}function Rd(e){let t={},n=e.params??[];for(let e of n){let n=String(e.name??``).trim();n&&e.default!==void 0&&(t[n]=e.default)}return t}function zd(e){let t=String(e??``).replaceAll(` `,``).toLowerCase();return t.startsWith(`list<`)||t.startsWith(`list[`)||t.endsWith(`[]`)}function Bd(){let{workspaceId:e}=Od.useParams(),{embed:t,forwardNetworkId:n,snapshotId:a,flows:o,tab:s}=Od.useSearch(),c=String(t??``).trim()===`1`||String(t??``).trim().toLowerCase()===`true`,[l,u]=(0,M.useState)(``),[d,f]=(0,M.useState)(``),[m,h]=(0,M.useState)(!1),[g,_]=(0,M.useState)(``),[v,te]=(0,M.useState)(!1),[ne,re]=(0,M.useState)(``),[ie,ae]=(0,M.useState)(``),[y,b]=(0,M.useState)(``),[x,S]=(0,M.useState)(!1),[oe,se]=(0,M.useState)(`https://fwd.app`),[ce,C]=(0,M.useState)(!1),[ue,w]=(0,M.useState)(``),[T,de]=(0,M.useState)(``),[fe,E]=(0,M.useState)(``),[pe,me]=(0,M.useState)(``),[he,ge]=(0,M.useState)(`6`),[_e,ve]=(0,M.useState)(`443`),[ye,be]=(0,M.useState)(!0),[Se,D]=(0,M.useState)(!1),[we,Te]=(0,M.useState)(``),[Ee,De]=(0,M.useState)([]),[ke,Ae]=(0,M.useState)(!1),[je,Me]=(0,M.useState)(null),[O,Ne]=(0,M.useState)(!0),[Pe,Fe]=(0,M.useState)(!1),[Ie,Le]=(0,M.useState)(!1),[Re,ze]=(0,M.useState)(!1),[Be,Ve]=(0,M.useState)(`fw, firewall`),[He,Ue]=(0,M.useState)(``),[We,Ge]=(0,M.useState)(!0),[Ke,qe]=(0,M.useState)(null),[Je,Ye]=(0,M.useState)(``),[Xe,Ze]=(0,M.useState)(``),[Qe,$e]=(0,M.useState)(``),[et,tt]=(0,M.useState)(`flow`);(0,M.useEffect)(()=>{if(!c)return;let e=String(n??``).trim(),t=String(a??``).trim(),r=String(o??``),i=String(s??``).trim().toLowerCase();e&&u(e),t&&f(t),r.trim()&&Te(r),i&&new Set([`flow`,`intent`,`segmentation`,`checks`,`packs`,`runs`,`presets`,`deltas`,`governance`,`change`]).has(i)?tt(i):tt(`intent`)},[c,n,a,o,s]);let[nt,rt]=(0,M.useState)({}),[it,at]=(0,M.useState)(null),[ot,st]=(0,M.useState)(null),[ct,lt]=(0,M.useState)(``),[ut,dt]=(0,M.useState)(!1),[ft,k]=(0,M.useState)(``),[pt,mt]=(0,M.useState)(``),[ht,A]=(0,M.useState)(null),[gt,_t]=(0,M.useState)(!1),[vt,yt]=(0,M.useState)(``),[bt,xt]=(0,M.useState)(!1),[St,Ct]=(0,M.useState)(``),[wt,Tt]=(0,M.useState)(!1),[Et,Dt]=(0,M.useState)(``),[kt,At]=(0,M.useState)(!1),[jt,Mt]=(0,M.useState)(null),[Nt,Pt]=(0,M.useState)(``),[Ft,It]=(0,M.useState)(!1),[Lt,zt]=(0,M.useState)(``),[Bt,Ht]=(0,M.useState)(``),[Ut,Wt]=(0,M.useState)(`policy-recert`),[Gt,Kt]=(0,M.useState)(``),[qt,Jt]=(0,M.useState)(``),[Yt,Xt]=(0,M.useState)(!1),[Zt,Qt]=(0,M.useState)(``),[$t,en]=(0,M.useState)(``),[tn,nn]=(0,M.useState)(``),[rn,an]=(0,M.useState)(``),[on,sn]=(0,M.useState)(``),[cn,ln]=(0,M.useState)(!1),[un,dn]=(0,M.useState)(`ATTEST`),[fn,pn]=(0,M.useState)(``),[mn,hn]=(0,M.useState)(``),[gn,_n]=(0,M.useState)(``),[vn,yn]=(0,M.useState)(`ADD`),[bn,xn]=(0,M.useState)(`0`),[Sn,Cn]=(0,M.useState)(`DENY`),[wn,Tn]=(0,M.useState)(`0.0.0.0/0`),[En,Dn]=(0,M.useState)(`0.0.0.0/0`),[On,kn]=(0,M.useState)(`6,17`),[An,jn]=(0,M.useState)(``),[Mn,Nn]=(0,M.useState)(``),[Pn,Fn]=(0,M.useState)(null),[In,Ln]=(0,M.useState)({}),[Rn,zn]=(0,M.useState)(``),[Bn,Vn]=(0,M.useState)({}),[Hn,Un]=(0,M.useState)({}),[Wn,Gn]=(0,M.useState)({}),[Kn,qn]=(0,M.useState)(!1),[Jn,Yn]=(0,M.useState)(``),[Xn,Zn]=(0,M.useState)(``),[Qn,$n]=(0,M.useState)(``),[er,N]=(0,M.useState)(``),[nr,rr]=(0,M.useState)(``),[or,lr]=(0,M.useState)(`22,23,3389,445,1433,1521,3306,5432,6379,9200,27017`),[ur,dr]=(0,M.useState)(null),[fr,pr]=(0,M.useState)(null),[mr,hr]=(0,M.useState)(null),[gr,_r]=(0,M.useState)(null),[vr,yr]=(0,M.useState)(null),[br,xr]=(0,M.useState)(!1),[Sr,wr]=(0,M.useState)(``),[Tr,Er]=(0,M.useState)(``),[Dr,Or]=(0,M.useState)(``),[kr,Ar]=(0,M.useState)(`PACK`),[jr,Mr]=(0,M.useState)(``),[Nr,Pr]=(0,M.useState)(`1440`),[Fr,Ir]=(0,M.useState)(!0),Lr=i({queryKey:H.policyReportsChecks(e),queryFn:()=>ko(e),staleTime:6e4}),Rr=i({queryKey:H.policyReportsPacks(e),queryFn:()=>jo(e),staleTime:6e4}),zr=i({queryKey:[`policyReportsForwardNetworks`,e],queryFn:()=>Ko(e),staleTime:1e4}),I=i({queryKey:H.policyReportsRecertCampaigns(e),queryFn:()=>Lo(e),staleTime:1e4}),Br=i({queryKey:H.policyReportsRecertAssignments(e,Nt),queryFn:()=>zo(e,Nt||void 0,void 0,void 0,200),enabled:!!Nt,staleTime:1e4}),Vr=i({queryKey:H.policyReportsExceptions(e,l.trim()),queryFn:()=>ps(e,l.trim()||void 0,void 0,500),enabled:l.trim().length>0,staleTime:1e4}),Hr=i({queryKey:H.policyReportsSnapshots(e,l.trim()),queryFn:async()=>Mo(e,l.trim(),25),enabled:l.trim().length>0,retry:!1,staleTime:1e4}),Ur=i({queryKey:[`policyReportsForwardCreds`,e,l.trim()],queryFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);return Jo(e,t)},enabled:l.trim().length>0,retry:!1,staleTime:1e4}),Wr=i({queryKey:H.policyReportsZones(e,l.trim()),queryFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);return Qo(e,t)},enabled:l.trim().length>0,retry:!1,staleTime:1e4}),Gr=i({queryKey:[`policyReportsPresets`,e,l.trim()],queryFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);return ts(e,t,void 0,200)},enabled:l.trim().length>0,retry:!1,staleTime:1e4}),Kr=i({queryKey:H.policyReportsRuns(e,l.trim()),queryFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);return cs(e,t,void 0,void 0,50)},enabled:l.trim().length>0,retry:!1,staleTime:1e4}),qr=i({queryKey:H.policyReportsRun(e,Sr),queryFn:()=>ls(e,Sr),enabled:br&&Sr.trim().length>0,retry:!1,staleTime:1e4}),Jr=i({queryKey:H.policyReportsRunFindings(e,Sr,Tr.trim()||void 0),queryFn:async()=>{let t=Sr.trim();if(!t)throw Error(`Run ID is required`);return us(e,t,Tr.trim()||void 0,500)},enabled:br&&Sr.trim().length>0,retry:!1,staleTime:1e4}),Yr=i({queryKey:H.policyReportsFindings(e,l.trim()),queryFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);return ds(e,t,void 0,`ACTIVE`,500)},enabled:l.trim().length>0,retry:!1,staleTime:1e4}),Xr=(0,M.useMemo)(()=>{let e=Hr.data?.body,t=e?.snapshots??e?.items??[];return Array.isArray(t)?t.map(e=>({id:String(e?.id??``),createdAt:String(e?.createdAt??e?.timestamp??``)})).filter(e=>e.id):[]},[Hr.data]),Zr=r({mutationFn:async t=>Ao(e,t),onError:e=>j.error(`Failed to load check`,{description:e.message})}),Qr=r({mutationFn:async t=>{let n=l.trim();if(!n)throw Error(`Network ID is required`);return No(e,{networkId:n,snapshotId:d.trim()||void 0,checkId:t,parameters:In[t]})},onSuccess:(e,t)=>{rt(n=>({...n,[t]:e})),j.success(`Check completed`,{description:t})},onError:e=>j.error(`Check failed`,{description:e.message})}),$r=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=fe.trim(),r=pe.trim();if(!n||!r)throw Error(`Source and destination IP are required`);let i=Number(he.trim()||`-1`),a=Number(_e.trim()||`-1`);return No(e,{networkId:t,snapshotId:d.trim()||void 0,checkId:`acl-flow-decision.nqe`,parameters:{srcIp:n,dstIp:r,ipProto:Number.isFinite(i)?i:-1,dstPort:Number.isFinite(a)?a:-1,firewallsOnly:ye,includeImplicitDefault:Se}})},onSuccess:e=>{rt(t=>({...t,"acl-flow-decision.nqe":e})),j.success(`Flow decision completed`)},onError:e=>j.error(`Flow decision failed`,{description:e.message})}),ei=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=fe.trim(),r=pe.trim();if(!n||!r)throw Error(`Source and destination IP are required`);let i=Number(he.trim()||`-1`),a=Number(_e.trim()||`-1`);return No(e,{networkId:t,snapshotId:d.trim()||void 0,checkId:`acl-flow-to-rules.nqe`,parameters:{srcIp:n,dstIp:r,ipProto:Number.isFinite(i)?i:-1,dstPort:Number.isFinite(a)?a:-1,firewallsOnly:ye,includeImplicitDefault:Se}})},onSuccess:e=>{A(e),j.success(`Flow matches completed`)},onError:e=>j.error(`Flow matches failed`,{description:e.message})}),ti=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=fe.trim(),r=pe.trim();if(!n||!r)throw Error(`Source and destination IP are required`);let i=Number(he.trim()||`-1`),a=Number(_e.trim()||`-1`);return No(e,{networkId:t,snapshotId:d.trim()||void 0,checkId:`nat-flow-matches.nqe`,parameters:{srcIp:n,dstIp:r,ipProto:Number.isFinite(i)?i:-1,dstPort:Number.isFinite(a)?a:-1}})},onSuccess:e=>{rt(t=>({...t,"nat-flow-matches.nqe":e})),j.success(`NAT matches completed`)},onError:e=>j.error(`NAT matches failed`,{description:e.message})}),ni=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=Id(we);if(n.length===0)throw Error(`Add at least one flow (srcIp dstIp [ipProto] [dstPort])`);let r=[];for(let i of n){let n=await No(e,{networkId:t,snapshotId:d.trim()||void 0,checkId:`acl-flow-decision.nqe`,parameters:{srcIp:i.srcIp,dstIp:i.dstIp,ipProto:i.ipProto,dstPort:i.dstPort,firewallsOnly:ye,includeImplicitDefault:Se}}),a=ji(n?.results),o=0,s=0,c=0;for(let e of a){let t=String(e?.decision??``);t===`PERMIT`?o++:t===`DENY`?s++:c++}r.push({flow:i,permits:o,denies:s,noMatch:c,resp:n})}return r},onSuccess:e=>{De(e),j.success(`Intent suite completed`,{description:`${e.length} flows`})},onError:e=>j.error(`Intent suite failed`,{description:e.message})}),ri=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=Id(we);if(n.length===0)throw Error(`Add at least one flow (srcIp dstIp [ipProto] [dstPort])`);if(n.length>20)throw Error(`Limit is 20 flows for stored runs`);let r=[];for(let i of n){let n=`${i.srcIp} -> ${i.dstIp} proto=${i.ipProto} port=${i.dstPort}`,a=await ss(e,{forwardNetworkId:t,snapshotId:d.trim()||void 0,packId:`intent`,title:n,checks:[{checkId:`acl-flow-decision.nqe`,parameters:{srcIp:i.srcIp,dstIp:i.dstIp,ipProto:i.ipProto,dstPort:i.dstPort,firewallsOnly:ye,includeImplicitDefault:Se}},{checkId:`nat-flow-matches.nqe`,parameters:{srcIp:i.srcIp,dstIp:i.dstIp,ipProto:i.ipProto,dstPort:i.dstPort}}]});r.push(a.run.id)}return r},onSuccess:async e=>{j.success(`Stored intent runs`,{description:`${e.length} runs`}),await Kr.refetch()},onError:e=>j.error(`Store intent runs failed`,{description:e.message})}),ii=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=Id(we);if(n.length===0)throw Error(`Add at least one flow (srcIp dstIp [ipProto] [dstPort])`);if(n.length>200)throw Error(`Limit is 200 flows`);let r=n.map(e=>({srcIp:e.srcIp,dstIp:e.dstIp,ipProto:e.ipProto>=0?e.ipProto:void 0,dstPort:e.dstPort>=0?String(e.dstPort):void 0})),i=Be.split(`,`).map(e=>e.trim()).filter(Boolean),a=He.split(`,`).map(e=>e.trim()).filter(Boolean);return is(e,{forwardNetworkId:t,snapshotId:d.trim()||void 0,queries:r,requireEnforcement:O,requireSymmetricDelivery:Pe?Ie:void 0,requireReturnEnforcement:Pe?Re:void 0,enforcementDeviceNameParts:i.length>0?i:void 0,enforcementTagParts:a.length>0?a:void 0,intent:`PREFER_DELIVERED`,includeTags:!0,includeNetworkFunctions:We,maxCandidates:5e3,maxResults:1,maxReturnPathResults:Pe?1:0,maxSeconds:30,maxOverallSeconds:300})},onSuccess:e=>{qe(e),j.success(`Paths assurance completed`,{description:`${e.total} violation(s)`})},onError:e=>j.error(`Paths assurance failed`,{description:e.message})}),ai=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=Id(we);if(n.length===0)throw Error(`Add at least one flow (srcIp dstIp [ipProto] [dstPort])`);if(n.length>200)throw Error(`Limit is 200 flows`);let r=n.map(e=>({srcIp:e.srcIp,dstIp:e.dstIp,ipProto:e.ipProto>=0?e.ipProto:void 0,dstPort:e.dstPort>=0?String(e.dstPort):void 0})),i=Be.split(`,`).map(e=>e.trim()).filter(Boolean),a=He.split(`,`).map(e=>e.trim()).filter(Boolean);return as(e,{title:`Paths assurance (${r.length} flows)`,forwardNetworkId:t,snapshotId:d.trim()||void 0,queries:r,requireEnforcement:O,requireSymmetricDelivery:Pe?Ie:void 0,requireReturnEnforcement:Pe?Re:void 0,enforcementDeviceNameParts:i.length>0?i:void 0,enforcementTagParts:a.length>0?a:void 0,intent:`PREFER_DELIVERED`,includeTags:!0,includeNetworkFunctions:We,maxCandidates:5e3,maxResults:1,maxReturnPathResults:Pe?1:0,maxSeconds:30,maxOverallSeconds:300})},onSuccess:async e=>{j.success(`Paths assurance stored`,{description:e.run.id}),await Kr.refetch()},onError:e=>j.error(`Store paths assurance failed`,{description:e.message})}),oi=r({mutationFn:async t=>{let n=l.trim();if(!n)throw Error(`Network ID is required`);return Po(e,{networkId:n,snapshotId:d.trim()||void 0,packId:t})},onSuccess:e=>{rt(t=>({...t,...e.results})),at(e),j.success(`Pack completed`,{description:e.packId})},onError:e=>j.error(`Pack failed`,{description:e.message})}),si=r({mutationFn:async t=>{let n=l.trim();if(!n)throw Error(`Network ID is required`);if(!t.trim())throw Error(`Pack is required`);return os(e,{forwardNetworkId:n,snapshotId:d.trim()||void 0,packId:t.trim()})},onSuccess:async e=>{e.results&&(rt(t=>({...t,...e.results})),at({packId:e.run.packId,networkId:e.run.forwardNetworkId,snapshotId:e.run.snapshotId,results:e.results})),j.success(`Pack stored`,{description:e.run.id}),await Kr.refetch()},onError:e=>j.error(`Pack store failed`,{description:e.message})}),ci=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=Qe.trim();if(!n)throw Error(`Pack is required`);let r=Je.trim(),i=Xe.trim();if(!r||!i)throw Error(`Baseline and compare snapshots required`);return Fo(e,{networkId:t,packId:n,baselineSnapshotId:r,compareSnapshotId:i,maxSamplesPerBucket:20})},onSuccess:e=>{st(e),j.success(`Delta completed`,{description:e.packId})},onError:e=>j.error(`Delta failed`,{description:e.message})}),li=r({mutationFn:async()=>{let t=ne.trim(),n=ie.trim();if(!t)throw Error(`Forward Network ID is required`);if(!n)throw Error(`Name is required`);return Go(e,{forwardNetworkId:t,name:n,description:y.trim()||void 0})},onSuccess:async e=>{j.success(`Network saved`,{description:e.forwardNetworkId}),te(!1),re(``),ae(``),b(``),await zr.refetch()},onError:e=>j.error(`Save network failed`,{description:e.message})}),ui=r({mutationFn:async t=>{if(!t.trim())throw Error(`Select a saved network`);return qo(e,t.trim())},onSuccess:async()=>{j.success(`Network deleted`),_(``),await zr.refetch()},onError:e=>j.error(`Delete network failed`,{description:e.message})}),di=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=oe.trim();if(!n)throw Error(`Forward URL is required`);let r=ue.trim();if(!r)throw Error(`Forward username is required`);return Yo(e,t,{baseUrl:n,skipTlsVerify:ce,username:r,password:T.trim()||void 0})},onSuccess:async()=>{j.success(`Credentials saved`),de(``),S(!1),await Ur.refetch()},onError:e=>j.error(`Save credentials failed`,{description:e.message})}),fi=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);return Xo(e,t)},onSuccess:async()=>{j.success(`Credentials cleared`),de(``),await Ur.refetch()},onError:e=>j.error(`Clear credentials failed`,{description:e.message})}),pi=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=Jn.trim();if(!n)throw Error(`Zone name is required`);let r=Pd(Qn);if(r.length===0)throw Error(`At least one subnet is required`);return Zo(e,t,{name:n,description:Xn.trim()||void 0,subnets:r})},onSuccess:async e=>{j.success(`Zone created`,{description:e.name}),qn(!1),Yn(``),Zn(``),$n(``),await Wr.refetch()},onError:e=>j.error(`Create zone failed`,{description:e.message})}),mi=r({mutationFn:async t=>{let n=l.trim();if(!n)throw Error(`Network ID is required`);return $o(e,n,t)},onSuccess:async()=>{j.success(`Zone deleted`),await Wr.refetch()},onError:e=>j.error(`Delete zone failed`,{description:e.message})}),hi=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=Wr.data?.zones??[],r=n.find(e=>e.id===er),i=n.find(e=>e.id===nr);if(!r||!i)throw Error(`Select source and destination zones`);return No(e,{networkId:t,snapshotId:d.trim()||void 0,checkId:`acl-zone-to-zone-any-service.nqe`,parameters:{srcSubnets:r.subnets,dstSubnets:i.subnets,firewallsOnly:!0,includeImplicitDefault:!1}})},onSuccess:e=>{dr(e),j.success(`Segmentation check completed`)},onError:e=>j.error(`Segmentation check failed`,{description:e.message})}),gi=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=Wr.data?.zones??[],r=n.find(e=>e.id===er),i=n.find(e=>e.id===nr);if(!r||!i)throw Error(`Select source and destination zones`);let a=Fd(or);if(a.length===0)throw Error(`Sensitive ports is required`);return No(e,{networkId:t,snapshotId:d.trim()||void 0,checkId:`acl-zone-to-zone-sensitive-ports.nqe`,parameters:{srcSubnets:r.subnets,dstSubnets:i.subnets,sensitivePorts:a,firewallsOnly:!0,includeImplicitDefault:!1}})},onSuccess:e=>{pr(e),j.success(`Sensitive ports check completed`)},onError:e=>j.error(`Sensitive ports check failed`,{description:e.message})}),_i=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=Wr.data?.zones??[],r=n.find(e=>e.id===er),i=n.find(e=>e.id===nr);if(!r||!i)throw Error(`Select source and destination zones`);let a=Fd(or);if(a.length===0)throw Error(`Sensitive ports is required`);let o=`${r.name} -> ${i.name}`;return ss(e,{forwardNetworkId:t,snapshotId:d.trim()||void 0,packId:`segmentation`,title:o,checks:[{checkId:`acl-zone-to-zone-any-service.nqe`,parameters:{srcSubnets:r.subnets,dstSubnets:i.subnets,firewallsOnly:!0,includeImplicitDefault:!1}},{checkId:`acl-zone-to-zone-sensitive-ports.nqe`,parameters:{srcSubnets:r.subnets,dstSubnets:i.subnets,sensitivePorts:a,firewallsOnly:!0,includeImplicitDefault:!1}}]})},onSuccess:async e=>{yr(e.run),j.success(`Segmentation report stored`,{description:e.run.id}),await Kr.refetch()},onError:e=>j.error(`Store segmentation report failed`,{description:e.message})}),vi=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=Dr.trim();if(!n)throw Error(`Preset name is required`);let r=Number(Nr.trim()||`0`);if(!Number.isFinite(r)||r<=0)throw Error(`Interval minutes must be > 0`);if(kr===`PACK`){let i=jr.trim();if(!i)throw Error(`Pack is required`);return es(e,{forwardNetworkId:t,name:n,kind:`PACK`,packId:i,snapshotId:d.trim()||void 0,enabled:Fr,intervalMinutes:r})}if(kr===`PATHS`){let i=Id(we);if(i.length===0)throw Error(`Add at least one flow (srcIp dstIp [ipProto] [dstPort])`);if(i.length>200)throw Error(`Limit is 200 flows`);let a=i.map(e=>({srcIp:e.srcIp,dstIp:e.dstIp,...e.ipProto>=0?{ipProto:e.ipProto}:{},...e.dstPort>=0?{dstPort:String(e.dstPort)}:{}})),o=Be.split(`,`).map(e=>e.trim()).filter(Boolean),s=He.split(`,`).map(e=>e.trim()).filter(Boolean);return es(e,{forwardNetworkId:t,name:n,kind:`PATHS`,snapshotId:d.trim()||void 0,enabled:Fr,intervalMinutes:r,checks:[{checkId:`paths-enforcement-bypass`,parameters:{queries:a,requireEnforcement:O,...Pe?{requireSymmetricDelivery:Ie,requireReturnEnforcement:Re}:{},...o.length>0?{enforcementDeviceNameParts:o}:{},...s.length>0?{enforcementTagParts:s}:{},intent:`PREFER_DELIVERED`,includeTags:!0,includeNetworkFunctions:We,maxCandidates:5e3,maxResults:1,maxReturnPathResults:Pe?1:0,maxSeconds:30,maxOverallSeconds:300}}]})}throw Error(`Unsupported preset kind: ${kr}`)},onSuccess:async()=>{j.success(`Preset created`),Or(``),Ar(`PACK`),Mr(``),Pr(`1440`),Ir(!0),await Gr.refetch()},onError:e=>j.error(`Create preset failed`,{description:e.message})}),yi=r({mutationFn:async t=>ns(e,t),onSuccess:async()=>{j.success(`Preset deleted`),await Gr.refetch()},onError:e=>j.error(`Delete preset failed`,{description:e.message})}),bi=r({mutationFn:async t=>rs(e,t),onSuccess:async e=>{j.success(`Preset run stored`,{description:e.run.id}),await Kr.refetch(),await Gr.refetch()},onError:e=>j.error(`Preset run failed`,{description:e.message})}),xi=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=(Wr.data?.zones??[]).find(e=>e.id===nr);if(!n)throw Error(`Select a destination zone`);return No(e,{networkId:t,snapshotId:d.trim()||void 0,checkId:`acl-any-to-zone-any-service.nqe`,parameters:{dstSubnets:n.subnets,firewallsOnly:!0,includeImplicitDefault:!1}})},onSuccess:e=>{hr(e),j.success(`Any-to-zone any-service check completed`)},onError:e=>j.error(`Any-to-zone any-service failed`,{description:e.message})}),Si=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=(Wr.data?.zones??[]).find(e=>e.id===nr);if(!n)throw Error(`Select a destination zone`);let r=Fd(or);if(r.length===0)throw Error(`Sensitive ports is required`);return No(e,{networkId:t,snapshotId:d.trim()||void 0,checkId:`acl-any-to-zone-sensitive-ports.nqe`,parameters:{dstSubnets:n.subnets,sensitivePorts:r,firewallsOnly:!0,includeImplicitDefault:!1}})},onSuccess:e=>{_r(e),j.success(`Any-to-zone sensitive ports check completed`)},onError:e=>j.error(`Any-to-zone sensitive ports failed`,{description:e.message})}),Ci=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=Lt.trim();if(!n)throw Error(`Campaign name is required`);let r=Ut.trim();if(!r)throw Error(`Pack is required`);let i=Gt.trim();return Io(e,{name:n,description:Bt.trim()||void 0,forwardNetworkId:t,snapshotId:d.trim()||void 0,packId:r,dueAt:i||void 0})},onSuccess:async e=>{j.success(`Campaign created`),It(!1),Pt(e.campaign.id),zt(``),Ht(``),await I.refetch()},onError:e=>j.error(`Create campaign failed`,{description:e.message})}),wi=r({mutationFn:async()=>{if(!Nt)throw Error(`Select a campaign`);return Ro(e,Nt,{assigneeUsername:qt.trim()||void 0,maxPerCheck:500,maxTotal:5e3})},onSuccess:async e=>{j.success(`Assignments generated`,{description:`${e.created} stored`}),await I.refetch(),await Br.refetch()},onError:e=>j.error(`Generate assignments failed`,{description:e.message})}),Ti=r({mutationFn:async t=>{let n=t.justification.trim();if(!n)throw Error(`Justification is required`);return Bo(e,t.assignmentId,{justification:n})},onSuccess:async()=>{j.success(`Assignment attested`),ln(!1),pn(``),hn(``),await Br.refetch(),await I.refetch()},onError:e=>j.error(`Attest failed`,{description:e.message})}),Ei=r({mutationFn:async t=>{let n=t.justification.trim();if(!n)throw Error(`Justification is required`);return Vo(e,t.assignmentId,{justification:n})},onSuccess:async()=>{j.success(`Assignment waived`),ln(!1),pn(``),hn(``),await Br.refetch(),await I.refetch()},onError:e=>j.error(`Waive failed`,{description:e.message})}),Di=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=Zt.trim(),r=$t.trim(),i=tn.trim();if(!n||!r||!i)throw Error(`findingId, checkId, and justification are required`);return fs(e,{forwardNetworkId:t,findingId:n,checkId:r,justification:i,ticketUrl:rn.trim()||void 0,expiresAt:on.trim()||void 0})},onSuccess:async()=>{j.success(`Exception proposed`),Xt(!1),Qt(``),en(``),nn(``),an(``),sn(``),await Vr.refetch()},onError:e=>j.error(`Create exception failed`,{description:e.message})}),Oi=r({mutationFn:async t=>ms(e,t),onSuccess:async()=>{j.success(`Exception approved`),await Vr.refetch()},onError:e=>j.error(`Approve failed`,{description:e.message})}),ki=r({mutationFn:async t=>hs(e,t),onSuccess:async()=>{j.success(`Exception rejected`),await Vr.refetch()},onError:e=>j.error(`Reject failed`,{description:e.message})}),Ai=r({mutationFn:async()=>{let t=l.trim();if(!t)throw Error(`Network ID is required`);let n=e=>e.split(/[\n,]+/g).map(e=>e.trim()).filter(Boolean),r=e=>n(e).map(e=>Number(e)).filter(e=>Number.isFinite(e)).map(e=>Math.trunc(e)),i=[],a=Mn.split(`
`).map(e=>e.trim()).filter(Boolean);if(a.length===0){let e=fe.trim(),t=pe.trim();if(!e||!t)throw Error(`Provide flows (textarea) or set Source/Destination in Flow tab`);i.push({srcIp:e,dstIp:t,ipProto:Number(he.trim()||`-1`),dstPort:Number(_e.trim()||`-1`)})}else for(let e of a){let t=e.split(/[,\s]+/g).filter(Boolean);if(t.length<2)continue;let n=t[0],r=t[1],a=t.length>=3?Number(t[2]):-1,o=t.length>=4?Number(t[3]):-1;i.push({srcIp:n,dstIp:r,ipProto:Number.isFinite(a)?a:-1,dstPort:Number.isFinite(o)?o:-1})}let o=Number(bn.trim()||`0`);if(!Number.isFinite(o)||o<0)throw Error(`Invalid rule index`);return gs(e,{networkId:t,snapshotId:d.trim()||void 0,deviceName:gn.trim()||void 0,firewallsOnly:!0,includeImplicitDefault:Se,flows:i,change:{op:vn.trim()||`ADD`,rule:{index:Math.trunc(o),action:Sn.trim()||`PERMIT`,ipv4Src:n(wn),ipv4Dst:n(En),ipProto:r(On),tpDst:n(An)}}})},onSuccess:e=>{Fn(e),j.success(`Simulation completed`)},onError:e=>j.error(`Simulation failed`,{description:e.message})});function ji(e){return Array.isArray(e)?e:[]}function Mi(e){if(!e||typeof e!=`object`)return[];let t=[];for(let[n,r]of Object.entries(e))if(n===`evidence`||n.endsWith(`Evidence`)){let e=typeof r==`string`?r:``;e&&t.push({key:n,value:e})}return t}function Ni(e){let t=[`findingId`,`riskScore`,`device`,`rule`,`action`,`decision`,`severity`,`category`,`reason`,`ruleIndex`,`firstRuleIndex`,`shadowedRuleIndex`,`shadowingRuleIndex`,`partiallyShadowedRuleIndex`,`earlierRuleIndex`,`laterRuleIndex`,`unreachableRuleIndex`,`coveringRuleIndex`,`ospfProcess`,`os`],n=new Set;for(let t of e)if(!(!t||typeof t!=`object`))for(let e of Object.keys(t))n.add(e);return t.filter(e=>n.has(e))}function Pi(e){if(e==null)return``;if(typeof e==`string`)return e;if(typeof e==`number`||typeof e==`boolean`)return String(e);try{return JSON.stringify(e)}catch{return String(e)}}function Fi(e,t){let n=e&&typeof e==`object`?e:{},r=t&&typeof t==`object`?t:{},i=new Set([...Object.keys(n),...Object.keys(r)]);i.delete(`findingId`);let a=[];for(let e of Array.from(i).sort()){let t=Pi(n[e]),i=Pi(r[e]);t!==i&&a.push({key:e,baseline:t,compare:i})}return a}let Ii=Lr.data?.checks??[],Li=Rr.data?.packs??[],Ri=zr.data?.networks??[],zi=Ur.data??null,Bi=(0,M.useMemo)(()=>{let e=Date.now(),t=new Map;for(let n of Vr.data?.exceptions??[]){if(String(n?.status??``).toUpperCase()!==`APPROVED`)continue;let r=String(n?.checkId??``).trim(),i=String(n?.findingId??``).trim();if(!r||!i)continue;let a=String(n?.expiresAt??``).trim();if(a){let t=Date.parse(a);if(Number.isFinite(t)&&t<=e)continue}t.set(`${r}|${i}`,n)}return t},[Vr.data]);function Vi(e,t){if(!m||Bi.size===0||!Array.isArray(t))return{applicable:!1,suppressed:0,results:t};let n=!1,r=0,i=[];for(let a of t){if(!a||typeof a!=`object`){i.push(a);continue}let t=String(a?.findingId??``).trim();if(!t){i.push(a);continue}n=!0;let o=`${e}|${t}`;if(Bi.has(o)){r++;continue}i.push(a)}return n?{applicable:!0,suppressed:r,results:i}:{applicable:!1,suppressed:0,results:t}}function Hi(e){let t=[];for(let[n,r]of Object.entries(e.results??{})){let e=ji(r?.results),i=Vi(n,e),a=i.applicable?ji(i.results):e;for(let e of a)e&&typeof e==`object`&&!Array.isArray(e)?t.push({checkId:n,...e}):t.push({checkId:n,value:e})}return t}function Ui(e,t,n){let r=String(t.networkId??``).trim()||`(unknown)`,i=String(t.snapshotId??``).trim()||`latest`,a=n.reduce((e,t)=>(e[t.id]=t,e),{}),o=new Map,s=new Map,c=[];for(let[e,n]of Object.entries(t.results??{})){let t=ji(n?.results),r=Number(n?.total??t.length??0),i=Vi(e,t),l=i.applicable?ji(i.results):t;c.push({checkId:e,title:a[e]?.title??``,rawTotal:r,suppressed:i.applicable?i.suppressed:0,remaining:l.length});for(let e of l){let t=typeof e?.device==`string`?e.device:typeof e?.Device==`string`?e.Device:``;if(!t)continue;o.set(t,(o.get(t)??0)+1);let n=Number(e?.riskScore??0);Number.isFinite(n)&&n>0&&s.set(t,(s.get(t)??0)+n)}}c.sort((e,t)=>t.remaining-e.remaining);let l=Array.from(o.entries()).sort((e,t)=>t[1]-e[1]).slice(0,15),u=Array.from(s.entries()).sort((e,t)=>t[1]-e[1]).slice(0,15),d=[];d.push(`# Policy Pack Report: ${e.title??e.id}`),d.push(``),d.push(`- Pack ID: \`${e.id}\``),d.push(`- Network ID: \`${r}\``),d.push(`- Snapshot: \`${i}\``),d.push(`- Exception suppression: \`${m?`ON`:`OFF`}\``),d.push(`- Generated: \`${new Date().toISOString()}\``),d.push(``),d.push(`## By Check`),d.push(``),d.push(`| Check | Title | Total | Suppressed | Remaining |`),d.push(`|---|---|---:|---:|---:|`);for(let e of c)d.push(`| \`${e.checkId}\` | ${e.title||``} | ${e.rawTotal} | ${e.suppressed} | ${e.remaining} |`);d.push(``),d.push(`## Top Devices (By Findings)`),d.push(``),d.push(`| Device | Findings |`),d.push(`|---|---:|`);for(let[e,t]of l)d.push(`| \`${e}\` | ${t} |`);d.push(``),d.push(`## Top Devices (By Risk Sum)`),d.push(``),d.push(`| Device | Risk Sum |`),d.push(`|---|---:|`);for(let[e,t]of u)d.push(`| \`${e}\` | ${Math.round(t)} |`);return d.push(``),d.push(`## Notes`),d.push(``),d.push(`- This report is generated from Forward-modeled data via NQE.`),d.push(`- Totals reflect returned items; some checks are analytics (not strictly 'violations').`),d.push(``),d.join(`
`)}function Wi(e){let t=[];t.push(`# Policy Pack Delta: ${e.packId}`),t.push(``),t.push(`- Network ID: \`${e.networkId}\``),t.push(`- Baseline snapshot: \`${e.baselineSnapshotId}\``),t.push(`- Compare snapshot: \`${e.compareSnapshotId}\``),t.push(`- Generated: \`${new Date().toISOString()}\``),t.push(``),t.push(`| Check | Baseline | Compare | New | Resolved | Changed |`),t.push(`|---|---:|---:|---:|---:|---:|`);for(let n of e.checks??[])t.push(`| \`${n.checkId}\` | ${n.baselineTotal} | ${n.compareTotal} | ${n.newCount} | ${n.resolvedCount} | ${n.changedCount??0} |`);return t.push(``),t.join(`
`)}let Gi=(0,M.useMemo)(()=>Rn?Ii.find(e=>e.id===Rn)??null:null,[Ii,Rn]);return(0,P.jsxs)(`div`,{className:c?`space-y-6`:`space-y-6 p-6`,children:[c?null:(0,P.jsxs)(`div`,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between border-b pb-6`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(Ce,{className:`h-5 w-5 text-muted-foreground`}),(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Policy Reports`}),(0,P.jsx)(W,{variant:`secondary`,children:`Demo`})]}),(0,P.jsx)(`p`,{className:`text-muted-foreground text-sm`,children:`Run parameterized NQE checks and packs against a Forward network and snapshot. Export findings as JSON for lightweight reporting.`})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(p,{to:`/dashboard/workspaces/$workspaceId`,params:{workspaceId:e},className:Cr({variant:`outline`}),children:[(0,P.jsx)(ee,{className:`mr-2 h-4 w-4`}),`Workspace`]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2 rounded-md border px-3 py-2`,children:[(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Suppress approved exceptions`,Bi.size>0?` (${Bi.size} active)`:``]}),(0,P.jsx)(Nc,{checked:m,onCheckedChange:h})]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>{let t=l.trim();Ad(`policy-reports_${e}_${t||`network`}_${d.trim()||`latest`}.json`,{workspaceId:e,networkId:t,snapshotId:d.trim()||void 0,generatedAt:new Date().toISOString(),resultsByCheck:nt,lastPackRun:it,paramsByCheck:In})},disabled:Object.keys(nt).length===0,children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`Export results`]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>{let t=l.trim(),n=e=>String(e??``).replaceAll(`&`,`&amp;`).replaceAll(`<`,`&lt;`).replaceAll(`>`,`&gt;`).replaceAll(`"`,`&quot;`).replaceAll(`'`,`&#39;`),r=(e,t)=>{let n=String(e??``);return n.length<=t?n:`${n.slice(0,t)}`},i=t||``,a=d.trim()||`latest`,o=new Date().toISOString(),s=m,c=Ii.reduce((e,t)=>(e[t.id]=t,e),{}),u=Object.entries(nt).map(([e,t])=>{let n=Number(t?.total??0),r=Vi(e,ji(t?.results));return{id:e,total:r.applicable?ji(r.results).length:n}});u.sort((e,t)=>t.total-e.total);let f=Bi,p=(e,t,i)=>{let a=String(t?.findingId??``).trim(),o=a?`${e}|${a}`:``,s=o?f.get(o):null,c=s?`<div><div class="mono">${n(String(s.status??``))}</div>${s.expiresAt?`<div class="hint">expires ${n(String(s.expiresAt).slice(0,10))}</div>`:``}</div>`:``,l=Mi(t)[0]?.value??``,u=l?`<details><summary>Evidence</summary><pre>${n(r(l,4e3))}</pre></details>`:``;return`<tr>${i.map(e=>`<td class=\"mono\">${n(Pi(t?.[e]))}</td>`).join(``)}<td>${c}</td><td>${u}</td></tr>`},h=``;for(let{id:e}of u.slice(0,30)){let t=nt[e],r=ji(t?.results),i=Number(t?.total??r.length??0),a=Vi(e,r),o=a.applicable?ji(a.results):r,s=Ni(o).slice(0,10),l=c[e],u=a.applicable?`${o.length} (suppressed ${a.suppressed} of ${i})`:String(i);h+=`<section class=\"card\">
  <div class=\"h2\">${n(l?.title??e)}</div>
  <div class=\"sub\">checkId=<span class=\"mono\">${n(e)}</span>  category=${n(l?.category??``)}  severity=${n(l?.severity??``)}  total=${n(u)}</div>
  ${o.length?`<table>
    <thead><tr>${s.map(e=>`<th>${n(e)}</th>`).join(``)}<th>Exception</th><th>Evidence</th></tr></thead>
    <tbody>
      ${o.slice(0,15).map(t=>p(e,t,s)).join(``)}
    </tbody>
  </table>
  <div class=\"hint\">Showing 15 of ${o.length} findings.</div>`:`<div class="hint">No findings.</div>`}
</section>`}let g=`<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Policy Reports</title>
  <style>
    :root { --fg:#0b1020; --muted:#5b6477; --border:#d7dbe5; --bg:#ffffff; --chip:#f3f5fa; }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 28px; color: var(--fg); background: var(--bg); }
    h1 { margin: 0 0 6px 0; font-size: 22px; }
    .meta { color: var(--muted); margin-bottom: 14px; font-size: 12px; line-height: 1.5; }
    .chip { display:inline-block; background: var(--chip); border:1px solid var(--border); border-radius: 999px; padding: 2px 10px; font-size: 11px; margin-right: 6px; }
    .card { border: 1px solid var(--border); border-radius: 12px; padding: 14px; margin: 14px 0; }
    .h2 { font-weight: 700; margin-bottom: 4px; }
    .sub { font-size: 12px; color: var(--muted); margin-bottom: 10px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border-top: 1px solid var(--border); padding: 8px 8px; font-size: 12px; vertical-align: top; }
    th { text-align: left; color: var(--muted); font-weight: 600; background: #fbfcfe; }
    pre { background: #0b1020; color: #e9edf7; padding: 10px; border-radius: 10px; overflow-x: auto; font-size: 11px; }
    details summary { cursor: pointer; color: var(--muted); font-size: 12px; }
    .hint { color: var(--muted); font-size: 11px; margin-top: 8px; }
  </style>
</head>
<body>
  <h1>Policy Reports</h1>
  <div class="meta">
    <span class="chip">workspaceId=<span class="mono">${n(e)}</span></span>
    <span class="chip">networkId=<span class="mono">${n(i)}</span></span>
    <span class="chip">snapshotId=<span class="mono">${n(a)}</span></span>
    <span class="chip">generatedAt=<span class="mono">${n(o)}</span></span>
    <span class="chip">suppressApprovedExceptions=<span class="mono">${n(String(s))}</span></span>
  </div>

  <div class="card">
    <div class="h2">Summary</div>
    <div class="sub">Totals by check (top 30)</div>
    <table>
      <thead><tr><th>Check</th><th>Total</th></tr></thead>
      <tbody>
        ${u.slice(0,30).map(({id:e,total:t})=>`<tr><td class="mono">${n(e)}</td><td class="mono">${n(t)}</td></tr>`).join(``)}
      </tbody>
    </table>
  </div>

  ${h}
</body>
</html>`;jd(`policy-reports_${e}_${t||`network`}_${d.trim()||`latest`}.html`,`text/html`,g)},disabled:Object.keys(nt).length===0,children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`Export HTML`]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Target`})}),(0,P.jsxs)(V,{className:`grid gap-4 md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Saved networks`}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>zr.refetch(),disabled:zr.isFetching,children:[(0,P.jsx)(Ot,{className:`mr-2 h-4 w-4`}),`Refresh`]}),(0,P.jsx)(F,{size:`sm`,onClick:()=>{re(l.trim()),ae(``),b(``),te(!0)},children:`Add`})]})]}),(0,P.jsxs)(q,{value:g,onValueChange:e=>{_(e);let t=Ri.find(t=>t.id===e);t&&(u(t.forwardNetworkId),f(``))},children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Pick a saved network`})}),(0,P.jsx)(X,{children:Ri.map(e=>(0,P.jsxs)(Z,{value:e.id,children:[e.name,` (`,e.forwardNetworkId,`)`]},e.id))})]}),(0,P.jsx)(`div`,{className:`flex justify-end`,children:(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>ui.mutate(g),disabled:!g||ui.isPending,children:`Delete`})}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border px-3 py-2`,children:[(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Your Forward credentials for this network:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:l.trim()?Ur.isLoading?`loading`:zi?.configured?`configured`:`not set`:`n/a`})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>{let e=zi;se(e?.baseUrl??`https://fwd.app`),C(!!(e?.skipTlsVerify??!1)),w(e?.username??``),de(``),S(!0)},disabled:!l.trim(),children:`Configure`}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>fi.mutate(),disabled:!l.trim()||fi.isPending||!zi?.configured,children:`Clear`})]})]}),zr.isError?(0,P.jsxs)(`p`,{className:`text-xs text-destructive`,children:[`Failed to load saved networks:`,` `,zr.error.message]}):null]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Forward Network ID`}),(0,P.jsx)(K,{value:l,onChange:e=>{c&&String(n??``).trim()||u(e.target.value)},readOnly:c&&!!String(n??``).trim(),placeholder:`e.g. 235216`}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`This is the Forward network id (not the name). Policy Reports uses the workspace Forward credentials on the server.`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Snapshot`}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>Hr.refetch(),disabled:!l.trim()||Hr.isFetching,children:[(0,P.jsx)(Ot,{className:`mr-2 h-4 w-4`}),`Refresh`]})]}),(0,P.jsxs)(q,{value:d,onValueChange:e=>f(e),children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Latest or choose one`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:``,children:`(Let Forward choose)`}),Xr.map(e=>(0,P.jsxs)(Z,{value:e.id,children:[e.id,e.createdAt?` (${e.createdAt})`:``]},e.id))]})]}),Hr.isError?(0,P.jsxs)(`p`,{className:`text-xs text-destructive`,children:[`Failed to load snapshots: `,Hr.error.message]}):null]})]})]}),(0,P.jsxs)(Bc,{value:et,onValueChange:e=>tt(e),children:[(0,P.jsxs)(Vc,{children:[(0,P.jsx)(Hc,{value:`flow`,children:`Flow`}),(0,P.jsx)(Hc,{value:`intent`,children:`Intent`}),(0,P.jsx)(Hc,{value:`segmentation`,children:`Segmentation`}),(0,P.jsx)(Hc,{value:`checks`,children:`Checks`}),(0,P.jsx)(Hc,{value:`packs`,children:`Packs`}),(0,P.jsx)(Hc,{value:`runs`,children:`Runs`}),(0,P.jsx)(Hc,{value:`presets`,children:`Presets`}),(0,P.jsx)(Hc,{value:`deltas`,children:`Deltas`}),(0,P.jsx)(Hc,{value:`governance`,children:`Governance`}),(0,P.jsx)(Hc,{value:`change`,children:`Change Planning`})]}),(0,P.jsxs)(Uc,{value:`flow`,className:`space-y-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Flow Analyzer (First Match)`})}),(0,P.jsxs)(V,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Source IP`}),(0,P.jsx)(K,{value:fe,onChange:e=>E(e.target.value),placeholder:`e.g. 10.0.0.10`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Destination IP`}),(0,P.jsx)(K,{value:pe,onChange:e=>me(e.target.value),placeholder:`e.g. 10.0.0.20`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`IP Protocol`}),(0,P.jsx)(K,{value:he,onChange:e=>ge(e.target.value),placeholder:`6 (TCP), 17 (UDP), or -1`}),(0,P.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[`Use `,(0,P.jsx)(`span`,{className:`font-mono`,children:`-1`}),` to ignore.`]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Destination Port`}),(0,P.jsx)(K,{value:_e,onChange:e=>ve(e.target.value),placeholder:`443 or -1`}),(0,P.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[`Use `,(0,P.jsx)(`span`,{className:`font-mono`,children:`-1`}),` to ignore.`]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Firewalls Only`}),(0,P.jsxs)(q,{value:ye?`true`:`false`,onValueChange:e=>be(e===`true`),children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`true`,children:`true`}),(0,P.jsx)(Z,{value:`false`,children:`false`})]})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Include Implicit/Default Rules`}),(0,P.jsxs)(q,{value:Se?`true`:`false`,onValueChange:e=>D(e===`true`),children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`false`,children:`false`}),(0,P.jsx)(Z,{value:`true`,children:`true`})]})]})]})]}),(0,P.jsxs)(V,{className:`flex items-center gap-2 pt-0`,children:[(0,P.jsxs)(F,{onClick:()=>$r.mutate(),disabled:$r.isPending,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),`Decide`]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>ei.mutate(),disabled:ei.isPending,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),`Matching rules`]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>ti.mutate(),disabled:ti.isPending,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),`NAT matches`]}),(0,P.jsx)(F,{variant:`outline`,onClick:async()=>{lt(`acl-flow-decision.nqe`),await Zr.mutateAsync(`acl-flow-decision.nqe`)},children:`View query`}),(0,P.jsx)(F,{variant:`outline`,onClick:async()=>{lt(`acl-flow-to-rules.nqe`),await Zr.mutateAsync(`acl-flow-to-rules.nqe`)},children:`View matches query`}),(0,P.jsx)(F,{variant:`outline`,onClick:async()=>{lt(`nat-flow-matches.nqe`),await Zr.mutateAsync(`nat-flow-matches.nqe`)},children:`View NAT query`})]})]}),nt[`acl-flow-decision.nqe`]?(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Decision Results`})}),(0,P.jsx)(V,{className:`space-y-3`,children:(()=>{let e=nt[`acl-flow-decision.nqe`],t=e?.results??[],n=Array.isArray(t)?t:[],r=n.filter(e=>e?.matchCount>0),i=n.filter(e=>!e||e?.matchCount<=0);return(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2 text-sm`,children:[(0,P.jsxs)(W,{variant:`secondary`,children:[`Devices: `,n.length]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Matched: `,r.length]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`No match: `,i.length]})]}),(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Device`}),(0,P.jsx)(Q,{children:`Decision`}),(0,P.jsx)(Q,{children:`First Rule`}),(0,P.jsx)(Q,{className:`text-right`,children:`Matches`}),(0,P.jsx)(Q,{className:`text-right`,children:`Index`}),(0,P.jsx)(Q,{className:`text-right`,children:`Evidence`})]})}),(0,P.jsx)(pl,{children:n.map(e=>{let t=String(e?.decision??``),n=Number(e?.matchCount??0)>0,r=String(e?.device??``);return(0,P.jsxs)(hl,{className:`cursor-pointer`,onClick:()=>{r&&mt(r)},children:[(0,P.jsx)($,{className:`font-medium`,children:r}),(0,P.jsx)($,{children:(0,P.jsx)(W,{variant:t===`PERMIT`?`default`:t===`DENY`?`destructive`:`secondary`,children:t||`UNKNOWN`})}),(0,P.jsx)($,{className:`max-w-[520px] truncate`,children:n?String(e?.firstRule??``):`(none)`}),(0,P.jsx)($,{className:`text-right`,children:Number(e?.matchCount??0)}),(0,P.jsx)($,{className:`text-right`,children:n?Number(e?.firstRuleIndex??-1):`-`}),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsx)(F,{variant:`outline`,size:`sm`,disabled:!n||!e?.firstRuleEvidence,onClick:()=>{k(String(e?.firstRuleEvidence??``)),dt(!0)},children:`View`})})]},r||String(Math.random()))})})]}),(0,P.jsxs)(`details`,{className:`pt-2`,children:[(0,P.jsx)(`summary`,{className:`cursor-pointer text-xs text-muted-foreground`,children:`Show raw JSON`}),(0,P.jsx)(`div`,{className:`pt-2`,children:(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:10,value:kd(e)})})]})]})})()})]}):null,nt[`nat-flow-matches.nqe`]?(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`NAT Matches`}),(0,P.jsx)(B,{children:`Modeled NAT entries that match the flow tuple.`})]}),(0,P.jsx)(V,{className:`space-y-3`,children:(()=>{let e=nt[`nat-flow-matches.nqe`],t=e?.results??[],n=Array.isArray(t)?t:[];return(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsx)(`div`,{className:`flex flex-wrap items-center gap-2 text-sm`,children:(0,P.jsxs)(W,{variant:`secondary`,children:[`Matches: `,n.length]})}),(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Device`}),(0,P.jsx)(Q,{children:`Rule`}),(0,P.jsx)(Q,{className:`text-right`,children:`Index`}),(0,P.jsx)(Q,{className:`text-right`,children:`Evidence`})]})}),(0,P.jsx)(pl,{children:n.map((e,t)=>{let n=String(e?.device??``),r=String(e?.rule??``),i=Number(e?.ruleIndex??t);return(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{className:`font-medium`,children:n}),(0,P.jsx)($,{className:`max-w-[520px] truncate`,children:r||`(unnamed)`}),(0,P.jsx)($,{className:`text-right`,children:i}),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsx)(F,{variant:`outline`,size:`sm`,disabled:!e?.evidence&&!e?.rewrites,onClick:()=>{let t=String(e?.evidence??``),n=e?.rewrites?kd(e?.rewrites):``;Ct([t?`Evidence:
`+t:``,n?`Rewrites:
`+n:``].filter(Boolean).join(`

`)||`(no evidence)`),xt(!0)},children:`View`})})]},`${n}:${r}:${i}:${t}`)})})]}),(0,P.jsxs)(`details`,{className:`pt-2`,children:[(0,P.jsx)(`summary`,{className:`cursor-pointer text-xs text-muted-foreground`,children:`Show raw JSON`}),(0,P.jsx)(`div`,{className:`pt-2`,children:(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:10,value:kd(e)})})]})]})})()})]}):null,ht?(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Matching Rules`})}),(0,P.jsx)(V,{className:`space-y-3`,children:(()=>{let e=ht.results??[],t=Array.isArray(e)?e:[],n=Array.from(new Set(t.map(e=>String(e?.device??``)).filter(Boolean))).sort(),r=pt?t.filter(e=>String(e?.device??``)===pt):t;return(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Device filter`}),(0,P.jsxs)(q,{value:pt,onValueChange:mt,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`All devices`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:``,children:`(All)`}),n.map(e=>(0,P.jsx)(Z,{value:e,children:e},e))]})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>mt(``),disabled:!pt,children:`Clear filter`}),pt?(0,P.jsxs)(`span`,{className:`text-xs text-muted-foreground`,children:[`Filtered to`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:pt})]}):null]}),(0,P.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[r.length,` matching rules`]})]}),(0,P.jsxs)(`div`,{className:`flex items-end justify-end gap-2`,children:[(0,P.jsxs)(F,{variant:`outline`,onClick:()=>{Ad(`flow-matching-rules_${l.trim()||`network`}_${d.trim()||`latest`}.json`,ht)},children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`Export JSON`]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>{let e=Nd(ht.results);if(!e){j.error(`CSV export only supports array-of-object results`);return}jd(`flow-matching-rules_${l.trim()||`network`}_${d.trim()||`latest`}.csv`,`text/csv`,e)},children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`CSV`]})]})]}),(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Device`}),(0,P.jsx)(Q,{className:`text-right`,children:`Index`}),(0,P.jsx)(Q,{children:`Action`}),(0,P.jsx)(Q,{children:`Rule`}),(0,P.jsx)(Q,{className:`text-right`,children:`Hits`}),(0,P.jsx)(Q,{className:`text-right`,children:`Evidence`})]})}),(0,P.jsx)(pl,{children:r.slice().sort((e,t)=>String(e?.device??``).localeCompare(String(t?.device??``))||Number(e?.ruleIndex??0)-Number(t?.ruleIndex??0)).map((e,t)=>{let n=String(e?.action??``);return(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{className:`font-medium`,children:String(e?.device??``)}),(0,P.jsx)($,{className:`text-right`,children:Number(e?.ruleIndex??-1)}),(0,P.jsx)($,{children:(0,P.jsx)(W,{variant:n===`PERMIT`?`default`:n===`DENY`?`destructive`:`secondary`,children:n||`UNKNOWN`})}),(0,P.jsx)($,{className:`max-w-[520px] truncate`,children:String(e?.rule??``)}),(0,P.jsx)($,{className:`text-right`,children:e?.hitCount??`-`}),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsx)(F,{variant:`outline`,size:`sm`,disabled:!e?.evidence,onClick:()=>{yt(String(e?.evidence??``)),_t(!0)},children:`View`})})]},`${String(e?.device??``)}:${Number(e?.ruleIndex??0)}:${t}`)})})]}),(0,P.jsxs)(`details`,{className:`pt-2`,children:[(0,P.jsx)(`summary`,{className:`cursor-pointer text-xs text-muted-foreground`,children:`Show raw JSON`}),(0,P.jsx)(`div`,{className:`pt-2`,children:(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:10,value:kd(ht)})})]})]})})()})]}):null]}),(0,P.jsxs)(Uc,{value:`intent`,className:`space-y-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Connectivity Intent Suite`}),(0,P.jsxs)(B,{children:[`Run a batch of flow intents using`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`acl-flow-decision.nqe`}),`.`]})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Flows`}),(0,P.jsx)(ul,{value:we,onChange:e=>Te(e.target.value),rows:6,placeholder:`# srcIp dstIp ipProto dstPort
10.0.0.10 10.0.0.20 6 443
10.0.0.10 10.0.0.30 6 22`,className:`font-mono text-xs`}),(0,P.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[`Format per line:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`srcIp dstIp [ipProto] [dstPort]`}),`. Separators: spaces or commas.`]})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsxs)(F,{onClick:()=>ni.mutate(),disabled:ni.isPending,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),`Run suite`]}),(0,P.jsxs)(F,{variant:`secondary`,onClick:()=>ri.mutate(),disabled:ri.isPending,children:[(0,P.jsx)(le,{className:`mr-2 h-4 w-4`}),`Store as runs (per flow)`]}),(0,P.jsxs)(W,{variant:`outline`,children:[`Firewalls only:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:ye?`true`:`false`})]}),(0,P.jsxs)(W,{variant:`outline`,children:[`Include implicit/default:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:Se?`true`:`false`})]})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Paths Assurance (Enforcement Bypass)`}),(0,P.jsx)(B,{children:`Uses Forward Paths API to detect when flows dont traverse expected enforcement points (or Forward reports delivery anomalies). This highlights Forwards topology-aware value rather than re-implementing paths.`})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-4`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Require enforcement`}),(0,P.jsxs)(q,{value:O?`true`:`false`,onValueChange:e=>Ne(e===`true`),children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`true`,children:`true`}),(0,P.jsx)(Z,{value:`false`,children:`false`})]})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Return path`}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2 rounded-md border px-3 py-2`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Include return path`}),(0,P.jsx)(Nc,{checked:Pe,onCheckedChange:Fe})]}),Pe?(0,P.jsxs)(`div`,{className:`flex flex-col gap-2 pt-1`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(Nc,{checked:Ie,onCheckedChange:Le}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Require symmetric delivery`})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(Nc,{checked:Re,onCheckedChange:ze}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Require return enforcement`})]})]}):null]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Enforcement device name parts (comma-separated)`}),(0,P.jsx)(K,{value:Be,onChange:e=>Ve(e.target.value),placeholder:`fw, firewall`}),(0,P.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[`Matched against hop`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`deviceName`}),` and`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`displayName`}),`.`]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Enforcement tag parts (comma-separated)`}),(0,P.jsx)(K,{value:He,onChange:e=>Ue(e.target.value),placeholder:`enforcement, inspection`})]})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsxs)(F,{onClick:()=>ii.mutate(),disabled:ii.isPending,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),`Run Paths Assurance`]}),(0,P.jsxs)(F,{variant:`secondary`,onClick:()=>ai.mutate(),disabled:ai.isPending,children:[(0,P.jsx)(le,{className:`mr-2 h-4 w-4`}),`Store as run`]}),(0,P.jsxs)(W,{variant:`outline`,children:[`Include networkFunctions:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:We?`true`:`false`})]}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>Ge(e=>!e),children:`Toggle networkFunctions`})]}),Ke?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`text-sm`,children:[`Violations:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:Ke.total})]}),(()=>{let e=ji(Ke?.results).filter(e=>e?.violation===!0);if(e.length===0)return null;let t=new Map;for(let n of e){let e=Array.isArray(n?.riskReasons)?n.riskReasons:[];if(e.length===0){t.set(`(no reason)`,(t.get(`(no reason)`)??0)+1);continue}for(let n of e){let e=String(n||`(empty)`);t.set(e,(t.get(e)??0)+1)}}return(0,P.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:Array.from(t.entries()).sort((e,t)=>t[1]-e[1]).slice(0,8).map(([e,t])=>(0,P.jsxs)(W,{variant:`secondary`,children:[(0,P.jsx)(`span`,{className:`font-mono`,children:t}),` `,(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:e})]},e))})})(),(()=>{let e=ji(Ke?.results).filter(e=>e?.violation===!0).slice(0,20);return e.length===0?null:(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Flow`}),(0,P.jsx)(Q,{children:`Outcome`}),(0,P.jsx)(Q,{children:`Return`}),(0,P.jsx)(Q,{children:`Enforced`}),(0,P.jsx)(Q,{children:`Termination`}),(0,P.jsx)(Q,{children:`Reason`})]})}),(0,P.jsx)(pl,{children:e.map((e,t)=>{let n=String(e?.srcIp??``),r=String(e?.dstIp??``),i=e?.ipProto,a=String(e?.dstPort??``),o=String(e?.forwardingOutcome??``),s=String(e?.returnForwardingOutcome??``),c=!!e?.enforced,l=e?.termination,u=l&&typeof l==`object`?String(l?.deviceName??``):``,d=Array.isArray(e?.riskReasons)?e.riskReasons:[];return(0,P.jsxs)(hl,{children:[(0,P.jsxs)($,{className:`font-mono text-xs`,children:[n,`  `,r,` `,i==null?``:`p=${String(i)}`,` `,a?`dport=${a}`:``]}),(0,P.jsx)($,{className:`font-mono text-xs`,children:o||``}),(0,P.jsx)($,{className:`font-mono text-xs`,children:s||``}),(0,P.jsx)($,{className:`font-mono text-xs`,children:c?`true`:`false`}),(0,P.jsx)($,{className:`font-mono text-xs`,children:u||``}),(0,P.jsx)($,{className:`text-xs text-muted-foreground`,children:d.length>0?d[0]:``})]},`${n}->${r}:${t}`)})})]})})})(),(0,P.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>{Ad(`paths-assurance_${l.trim()||`network`}_${d.trim()||`latest`}.json`,Ke)},children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`Export JSON`]})}),(0,P.jsxs)(`details`,{children:[(0,P.jsx)(`summary`,{className:`cursor-pointer text-xs text-muted-foreground`,children:`Show raw JSON`}),(0,P.jsx)(`div`,{className:`pt-2`,children:(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:10,value:kd(Ke)})})]})]}):null]})]}),Ee.length>0?(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-2 md:flex-row md:items-start md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Suite Results`}),(0,P.jsx)(B,{children:`Click a row to view the raw decision results.`})]}),(0,P.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>{Ad(`intent-suite_${l.trim()||`network`}_${d.trim()||`latest`}.json`,Ee)},children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`Export`]})})]}),(0,P.jsx)(V,{className:`space-y-3`,children:(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Flow`}),(0,P.jsx)(Q,{className:`text-right`,children:`PERMIT`}),(0,P.jsx)(Q,{className:`text-right`,children:`DENY`}),(0,P.jsx)(Q,{className:`text-right`,children:`NO_MATCH`})]})}),(0,P.jsx)(pl,{children:Ee.map((e,t)=>{let n=e.flow,r=`${n.srcIp} -> ${n.dstIp} proto=${n.ipProto} port=${n.dstPort}`;return(0,P.jsxs)(hl,{className:`cursor-pointer`,onClick:()=>{Me({flow:n,summary:e,raw:e.resp}),Ae(!0)},children:[(0,P.jsx)($,{className:`font-mono text-xs`,children:r}),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsx)(W,{variant:e.permits>0?`default`:`secondary`,children:e.permits})}),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsx)(W,{variant:e.denies>0?`destructive`:`secondary`,children:e.denies})}),(0,P.jsx)($,{className:`text-right`,children:e.noMatch})]},`${r}:${t}`)})})]})})})]}):null,(0,P.jsx)(tr,{open:ke,onOpenChange:Ae,children:(0,P.jsxs)(ir,{className:`max-w-4xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Intent details`}),(0,P.jsx)(cr,{children:je?.flow?(0,P.jsxs)(`span`,{className:`font-mono`,children:[je.flow.srcIp,` -> `,je.flow.dstIp,` `,`proto=`,je.flow.ipProto,` port=`,je.flow.dstPort]}):null})]}),(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:18,value:kd(je?.raw??{})})]})})]}),(0,P.jsxs)(Uc,{value:`segmentation`,className:`space-y-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-2 md:flex-row md:items-start md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsxs)(z,{className:`flex items-center gap-2`,children:[(0,P.jsx)(Rt,{className:`h-5 w-5`}),`Zones`]}),(0,P.jsx)(B,{children:`Define zones (CIDR sets) to drive zone-to-zone policy checks.`})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{onClick:()=>qn(!0),disabled:!l.trim(),children:`Add zone`}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>Wr.refetch(),disabled:!l.trim()||Wr.isFetching,children:[(0,P.jsx)(Ot,{className:`mr-2 h-4 w-4`}),`Refresh`]})]})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[Wr.isLoading?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading zones`}):null,Wr.isError?(0,P.jsxs)(`div`,{className:`text-sm text-destructive`,children:[`Failed to load zones: `,Wr.error.message]}):null,(()=>{let e=Wr.data?.zones??[];return e.length===0?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No zones yet.`}):(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Name`}),(0,P.jsx)(Q,{children:`Subnets`}),(0,P.jsx)(Q,{className:`text-right`,children:`Actions`})]})}),(0,P.jsx)(pl,{children:e.map(e=>(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{className:`font-medium`,children:e.name}),(0,P.jsx)($,{className:`font-mono text-xs`,children:(e.subnets??[]).join(`, `)}),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsx)(F,{variant:`outline`,size:`sm`,disabled:mi.isPending,onClick:()=>{confirm(`Delete zone "${e.name}"?`)&&mi.mutate(e.id)},children:`Delete`})})]},e.id))})]})})})()]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsxs)(z,{className:`flex items-center gap-2`,children:[(0,P.jsx)(Ce,{className:`h-5 w-5`}),`Zone-to-Zone Checks`]}),(0,P.jsx)(B,{children:`Run segmentation checks using the modeled firewall ACL view.`})]}),(0,P.jsx)(V,{className:`space-y-4`,children:(()=>{let e=Wr.data?.zones??[];return(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Source zone`}),(0,P.jsxs)(q,{value:er,onValueChange:N,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select source zone`})}),(0,P.jsx)(X,{children:e.map(e=>(0,P.jsx)(Z,{value:e.id,children:e.name},e.id))})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Destination zone`}),(0,P.jsxs)(q,{value:nr,onValueChange:rr,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select destination zone`})}),(0,P.jsx)(X,{children:e.map(e=>(0,P.jsx)(Z,{value:e.id,children:e.name},e.id))})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2 md:col-span-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Sensitive ports`}),(0,P.jsx)(K,{value:or,onChange:e=>lr(e.target.value),placeholder:`22,3389,445,`}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Comma or newline separated.`})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-2 md:col-span-2`,children:[(0,P.jsxs)(F,{variant:`outline`,onClick:()=>hi.mutate(),disabled:hi.isPending,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),`Any-service permits`]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>gi.mutate(),disabled:gi.isPending,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),`Sensitive ports`]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>xi.mutate(),disabled:xi.isPending,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),`Any to dst (any-service)`]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>Si.mutate(),disabled:Si.isPending,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),`Any to dst (sensitive ports)`]}),(0,P.jsxs)(F,{onClick:()=>_i.mutate(),disabled:_i.isPending,children:[(0,P.jsx)(le,{className:`mr-2 h-4 w-4`}),`Run and store report`]}),vr?(0,P.jsxs)(W,{variant:`secondary`,children:[`Stored run:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:vr.id})]}):null]})]})})()})]}),ur?(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-2 md:flex-row md:items-start md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Zone-to-zone any-service permits`}),(0,P.jsxs)(B,{children:[`Check:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`acl-zone-to-zone-any-service.nqe`})]})]}),(0,P.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>{Ad(`segmentation_any-service_${l.trim()||`network`}_${d.trim()||`latest`}.json`,ur)},children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`Export`]})})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2 text-sm`,children:[(0,P.jsxs)(W,{variant:`secondary`,children:[`Total: `,Number(ur.total??0)]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Snapshot:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:ur.snapshotId??`(unknown)`})]})]}),(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:10,value:kd(ur)})]})]}):null,fr?(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-2 md:flex-row md:items-start md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Zone-to-zone sensitive ports permits`}),(0,P.jsxs)(B,{children:[`Check:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`acl-zone-to-zone-sensitive-ports.nqe`})]})]}),(0,P.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>{Ad(`segmentation_sensitive-ports_${l.trim()||`network`}_${d.trim()||`latest`}.json`,fr)},children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`Export`]})})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2 text-sm`,children:[(0,P.jsxs)(W,{variant:`secondary`,children:[`Total: `,Number(fr.total??0)]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Snapshot:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:fr.snapshotId??`(unknown)`})]})]}),(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:10,value:kd(fr)})]})]}):null,mr?(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{className:`text-base`,children:`Any source to destination zone (any-service)`}),(0,P.jsxs)(B,{children:[`Check:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`acl-any-to-zone-any-service.nqe`})]})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2 text-sm`,children:[(0,P.jsxs)(W,{variant:`secondary`,children:[`Total: `,Number(mr.total??0)]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Snapshot:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:mr.snapshotId??`(unknown)`})]})]}),(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:10,value:kd(mr)})]})]}):null,gr?(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{className:`text-base`,children:`Any source to destination zone (sensitive ports)`}),(0,P.jsxs)(B,{children:[`Check:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`acl-any-to-zone-sensitive-ports.nqe`})]})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2 text-sm`,children:[(0,P.jsxs)(W,{variant:`secondary`,children:[`Total: `,Number(gr.total??0)]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Snapshot:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:gr.snapshotId??`(unknown)`})]})]}),(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:10,value:kd(gr)})]})]}):null]}),(0,P.jsxs)(Uc,{value:`runs`,className:`space-y-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-2 md:flex-row md:items-start md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsxs)(z,{className:`flex items-center gap-2`,children:[(0,P.jsx)(le,{className:`h-5 w-5`}),`Runs`]}),(0,P.jsx)(B,{children:`Stored Policy Report runs for this Forward network.`})]}),(0,P.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,P.jsxs)(F,{variant:`outline`,onClick:()=>Kr.refetch(),disabled:!l.trim()||Kr.isFetching,children:[(0,P.jsx)(Ot,{className:`mr-2 h-4 w-4`}),`Refresh`]})})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[Kr.isLoading?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading runs`}):null,Kr.isError?(0,P.jsxs)(`div`,{className:`text-sm text-destructive`,children:[`Failed to load runs: `,Kr.error.message]}):null,(()=>{let e=Kr.data?.runs??[];return e.length===0?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No stored runs yet.`}):(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Started`}),(0,P.jsx)(Q,{children:`Pack`}),(0,P.jsx)(Q,{children:`Status`}),(0,P.jsx)(Q,{children:`Snapshot`}),(0,P.jsx)(Q,{children:`Run ID`}),(0,P.jsx)(Q,{className:`text-right`,children:`Actions`})]})}),(0,P.jsx)(pl,{children:e.map(e=>(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{className:`text-xs text-muted-foreground`,children:String(e.startedAt??``)}),(0,P.jsx)($,{children:(0,P.jsx)(W,{variant:`secondary`,children:e.packId})}),(0,P.jsx)($,{children:(0,P.jsx)(W,{variant:String(e.status).toUpperCase()===`FAILED`?`destructive`:`secondary`,children:e.status})}),(0,P.jsx)($,{className:`font-mono text-xs`,children:e.snapshotId||`latest`}),(0,P.jsx)($,{className:`font-mono text-xs`,children:e.id}),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>{wr(e.id),Er(``),xr(!0)},children:`View`})})]},e.id))})]})})})()]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-2 md:flex-row md:items-start md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Active Findings`}),(0,P.jsx)(B,{children:`Aggregated posture findings across stored runs (violation-style checks only).`})]}),(0,P.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,P.jsxs)(F,{variant:`outline`,onClick:()=>Yr.refetch(),disabled:!l.trim()||Yr.isFetching,children:[(0,P.jsx)(Ot,{className:`mr-2 h-4 w-4`}),`Refresh`]})})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[Yr.isLoading?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading`}):null,Yr.isError?(0,P.jsxs)(`div`,{className:`text-sm text-destructive`,children:[`Failed: `,Yr.error.message]}):null,(()=>{let e=Yr.data?.findings??[];if(!Array.isArray(e)||e.length===0)return(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No active findings.`});let t=e.slice().sort((e,t)=>Number(t?.riskScore??0)-Number(e?.riskScore??0)).slice(0,200);return(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Risk`}),(0,P.jsx)(Q,{children:`Check`}),(0,P.jsx)(Q,{children:`Asset`}),(0,P.jsx)(Q,{children:`Last seen`}),(0,P.jsx)(Q,{className:`text-right`,children:`Details`})]})}),(0,P.jsx)(pl,{children:t.map(e=>(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{className:`text-right`,children:(0,P.jsx)(W,{variant:Number(e?.riskScore??0)>=80?`destructive`:Number(e?.riskScore??0)>=50?`default`:`secondary`,children:Number(e?.riskScore??0)})}),(0,P.jsx)($,{className:`font-mono text-xs`,children:String(e?.checkId??``)}),(0,P.jsx)($,{className:`font-mono text-xs`,children:String(e?.assetKey??``)||``}),(0,P.jsx)($,{className:`text-xs text-muted-foreground`,children:String(e?.lastSeenAt??``)}),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>{Ct(kd(e?.finding??{})),xt(!0)},children:`View`})})]},`${String(e?.checkId??``)}:${String(e?.findingId??``)}`))})]})})})(),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Showing up to 200 findings (sorted by riskScore).`})]})]}),(0,P.jsx)(tr,{open:br,onOpenChange:e=>{xr(e),e||(wr(``),Er(``))},children:(0,P.jsxs)(ir,{className:`max-w-4xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Run details`}),(0,P.jsx)(cr,{children:(0,P.jsx)(`span`,{className:`font-mono`,children:Sr})})]}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[qr.isLoading?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading`}):null,qr.isError?(0,P.jsxs)(`div`,{className:`text-sm text-destructive`,children:[`Failed to load run: `,qr.error.message]}):null,qr.data?(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2 text-sm`,children:[(0,P.jsxs)(W,{variant:`secondary`,children:[`Pack: `,qr.data.run.packId]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Status: `,qr.data.run.status]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Snapshot:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:qr.data.run.snapshotId||`latest`})]})]}),(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Checks`}),(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Check`}),(0,P.jsx)(Q,{className:`text-right`,children:`Total`})]})}),(0,P.jsx)(pl,{children:(qr.data.checks??[]).map(e=>(0,P.jsxs)(hl,{className:`cursor-pointer`,onClick:()=>Er(e.checkId),children:[(0,P.jsx)($,{className:`font-mono text-xs`,children:e.checkId}),(0,P.jsx)($,{className:`text-right`,children:e.total})]},e.checkId))})]})}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Click a check to load run findings.`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Findings`}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Check filter:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:Tr||`(all)`})]}),(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:10,value:kd(Jr.data?.findings??[])})]})]}),(0,P.jsxs)(`details`,{className:`pt-2`,children:[(0,P.jsx)(`summary`,{className:`cursor-pointer text-xs text-muted-foreground`,children:`Show request JSON`}),(0,P.jsx)(`div`,{className:`pt-2`,children:(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:10,value:kd(qr.data.run.request)})})]})]}):null]})]})})]}),(0,P.jsxs)(Uc,{value:`checks`,className:`space-y-4`,children:[Lr.isLoading?(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-6 text-sm text-muted-foreground`,children:`Loading checks`})}):null,Lr.isError?(0,P.jsx)(L,{children:(0,P.jsxs)(V,{className:`p-6 text-sm text-destructive`,children:[`Failed to load checks: `,Lr.error.message]})}):null,Ii.map(t=>{let n=t.id,r=nt[n],i=(t.params??[]).length>0,a=In[n],o=r?Vi(n,r?.results):{applicable:!1,suppressed:0,results:null},s=r&&o.applicable?o.results:r?.results,c=r&&o.applicable?ji(s).length:r?.total;return(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-2 md:flex-row md:items-start md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(z,{className:`text-base`,children:t.title??n}),t.severity?(0,P.jsx)(W,{variant:Ld(t.severity),children:t.severity}):null,t.category?(0,P.jsx)(W,{variant:`secondary`,children:t.category}):null,i?(0,P.jsx)(W,{variant:`outline`,children:`params`}):null,a&&Object.keys(a).length>0?(0,P.jsx)(W,{variant:`outline`,children:`customized`}):null]}),t.description?(0,P.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:t.description}):null,(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:n})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[i?(0,P.jsxs)(F,{variant:`outline`,onClick:()=>{zn(n);let e=In[n]??Rd(t);Vn(e);let r={};for(let n of t.params??[]){let t=String(n.name??``).trim();if(!t||!zd(n.type))continue;let i=e[t]??n.default??[];r[t]=JSON.stringify(i,null,0)}Un(r),Gn({})},children:[(0,P.jsx)(xe,{className:`mr-2 h-4 w-4`}),`Parameters`]}):null,(0,P.jsx)(F,{variant:`outline`,onClick:async()=>{lt(n),await Zr.mutateAsync(n)},children:`View query`}),(0,P.jsxs)(F,{onClick:()=>Qr.mutate(n),disabled:Qr.isPending,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),`Run`]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>{let t=l.trim();Ad(`policy-report_${n}_${t||`network`}_${d.trim()||`latest`}.json`,{workspaceId:e,networkId:t,snapshotId:d.trim()||void 0,checkId:n,parameters:In[n],result:r})},disabled:!r,children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`Export`]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>{let e=l.trim(),t=Nd(s);if(!t){j.error(`CSV export only supports array-of-object results`);return}jd(`policy-report_${n}_${e||`network`}_${d.trim()||`latest`}.csv`,`text/csv`,t)},disabled:!r,children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`CSV`]})]})]}),r?(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`text-sm`,children:[(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:`Total`}),(0,P.jsxs)(`div`,{className:`font-medium`,children:[c,o.applicable?(0,P.jsxs)(`span`,{className:`text-muted-foreground text-xs`,children:[` `,`(of `,r.total,`)`]}):null]})]}),(0,P.jsxs)(`div`,{className:`text-sm`,children:[(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:`Suppressed`}),(0,P.jsx)(`div`,{className:`font-medium`,children:o.applicable?o.suppressed:``})]}),(0,P.jsxs)(`div`,{className:`text-sm`,children:[(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:`Snapshot`}),(0,P.jsx)(`div`,{className:`font-medium`,children:r.snapshotId??`(unknown)`})]})]}),(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:10,value:kd(s)})]}):null]},n)})]}),(0,P.jsxs)(Uc,{value:`packs`,className:`space-y-4`,children:[Rr.isLoading?(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-6 text-sm text-muted-foreground`,children:`Loading packs`})}):null,Rr.isError?(0,P.jsx)(L,{children:(0,P.jsxs)(V,{className:`p-6 text-sm text-destructive`,children:[`Failed to load packs: `,Rr.error.message]})}):null,Li.map(t=>(0,P.jsx)(L,{children:(0,P.jsxs)(R,{className:`flex flex-col gap-2 md:flex-row md:items-start md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(z,{className:`text-base`,children:t.title??t.id}),t.description?(0,P.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:t.description}):null,(0,P.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[(t.checks??[]).length,` checks`]})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(F,{onClick:()=>oi.mutate(t.id),disabled:oi.isPending,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),`Run pack`]}),(0,P.jsxs)(F,{variant:`secondary`,onClick:()=>si.mutate(t.id),disabled:si.isPending,children:[(0,P.jsx)(le,{className:`mr-2 h-4 w-4`}),`Run and store`]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>{let n=l.trim();Ad(`policy-pack_${t.id}_${n||`network`}_${d.trim()||`latest`}.json`,{workspaceId:e,networkId:n,snapshotId:d.trim()||void 0,pack:t,lastPackRun:it?.packId===t.id?it:null})},disabled:!it||it.packId!==t.id,children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`Export pack`]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>{if(!it||it.packId!==t.id)return;let e=l.trim(),n=Ui(t,it,Ii);jd(`policy-pack_${t.id}_${e||`network`}_${d.trim()||`latest`}.md`,`text/markdown`,n)},disabled:!it||it.packId!==t.id,children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`MD`]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>{if(!it||it.packId!==t.id)return;let e=l.trim(),n=Nd(Hi(it));if(!n){j.error(`CSV export only supports array-of-object results`);return}jd(`policy-pack_${t.id}_${e||`network`}_${d.trim()||`latest`}.csv`,`text/csv`,n)},disabled:!it||it.packId!==t.id,children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`CSV`]})]})]})},t.id)),it?(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Pack Results`}),(0,P.jsxs)(B,{children:[`Last run:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:it.packId}),` `,`(snapshot`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:it.snapshotId??`latest`}),`)`]})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(()=>{let e=new Map,t=new Map,n=[];for(let[r,i]of Object.entries(it.results??{})){let a=ji(i?.results),o=Number(i?.total??a.length??0),s=Vi(r,a),c=s.applicable?ji(s.results):a;n.push({checkId:r,rawTotal:o,suppressed:s.applicable?s.suppressed:0,remaining:c.length});for(let n of c){let r=typeof n?.device==`string`?n.device:typeof n?.Device==`string`?n.Device:``;if(!r)continue;e.set(r,(e.get(r)??0)+1);let i=Number(n?.riskScore??0);Number.isFinite(i)&&i>0&&t.set(r,(t.get(r)??0)+i)}}n.sort((e,t)=>t.remaining-e.remaining);let r=Array.from(e.entries()).sort((e,t)=>t[1]-e[1]).slice(0,12),i=Array.from(t.entries()).sort((e,t)=>t[1]-e[1]).slice(0,12);return(0,P.jsxs)(`div`,{className:`grid gap-4 lg:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`By check`}),(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Check`}),(0,P.jsx)(Q,{className:`text-right`,children:`Total`}),m?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Q,{className:`text-right`,children:`Suppressed`}),(0,P.jsx)(Q,{className:`text-right`,children:`Remaining`})]}):null]})}),(0,P.jsx)(pl,{children:n.map(e=>(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{className:`font-mono text-xs`,children:e.checkId}),(0,P.jsx)($,{className:`text-right tabular-nums`,children:e.rawTotal}),m?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)($,{className:`text-right tabular-nums`,children:e.suppressed}),(0,P.jsx)($,{className:`text-right tabular-nums`,children:e.remaining})]}):null]},e.checkId))})]})})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Top devices`}),(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Device`}),(0,P.jsx)(Q,{className:`text-right`,children:`Findings`})]})}),(0,P.jsx)(pl,{children:r.length===0?(0,P.jsx)(hl,{children:(0,P.jsx)($,{colSpan:2,className:`text-sm text-muted-foreground`,children:`No device field present in pack outputs.`})}):r.map(([e,t])=>(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{className:`font-medium`,children:e}),(0,P.jsx)($,{className:`text-right tabular-nums`,children:t})]},e))})]})})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Top risk devices`}),(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Device`}),(0,P.jsx)(Q,{className:`text-right`,children:`Risk sum`})]})}),(0,P.jsx)(pl,{children:i.length===0?(0,P.jsx)(hl,{children:(0,P.jsx)($,{colSpan:2,className:`text-sm text-muted-foreground`,children:`No riskScore present in pack outputs.`})}):i.map(([e,t])=>(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{className:`font-medium`,children:e}),(0,P.jsx)($,{className:`text-right tabular-nums`,children:Math.round(t)})]},e))})]})})]})]})})(),(0,P.jsxs)(`details`,{children:[(0,P.jsx)(`summary`,{className:`cursor-pointer text-xs text-muted-foreground`,children:`Show raw JSON`}),(0,P.jsx)(`div`,{className:`pt-2`,children:(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:12,value:kd(it)})})]})]})]}):null]}),(0,P.jsxs)(Uc,{value:`presets`,className:`space-y-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Presets (Schedules)`}),(0,P.jsx)(B,{children:`Save a recurring pack run (NQE) or Paths Assurance suite for this Forward network. The server cron will execute due presets automatically and store runs.`})]}),(0,P.jsxs)(V,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Name`}),(0,P.jsx)(K,{value:Dr,onChange:e=>Or(e.target.value),placeholder:`e.g. Daily Hygiene`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Kind`}),(0,P.jsxs)(q,{value:kr,onValueChange:Ar,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`PACK`,children:`PACK (NQE pack)`}),(0,P.jsx)(Z,{value:`PATHS`,children:`PATHS (Paths Assurance)`})]})]}),kr===`PATHS`?(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Uses the current flow suite from the Intent Suite section plus the Paths Assurance toggles.`}):null]}),kr===`PACK`?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Pack`}),(0,P.jsxs)(q,{value:jr,onValueChange:Mr,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Choose a pack`})}),(0,P.jsx)(X,{children:Li.map(e=>(0,P.jsx)(Z,{value:e.id,children:e.title??e.id},e.id))})]})]}):(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Pack`}),(0,P.jsx)(K,{value:`(not applicable)`,readOnly:!0})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Interval (minutes)`}),(0,P.jsx)(K,{value:Nr,onChange:e=>Pr(e.target.value),placeholder:`1440`}),(0,P.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[`Default is daily (`,(0,P.jsx)(`span`,{className:`font-mono`,children:`1440`}),`).`]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Enabled`}),(0,P.jsxs)(q,{value:Fr?`true`:`false`,onValueChange:e=>Ir(e===`true`),children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`true`,children:`true`}),(0,P.jsx)(Z,{value:`false`,children:`false`})]})]})]}),(0,P.jsxs)(`div`,{className:`md:col-span-2 flex items-center gap-2`,children:[(0,P.jsx)(F,{onClick:()=>vi.mutate(),disabled:vi.isPending,children:vi.isPending?`Creating`:`Create Preset`}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>Gr.refetch(),disabled:!l.trim()||Gr.isFetching,children:[(0,P.jsx)(Ot,{className:`mr-2 h-4 w-4`}),`Refresh`]})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{className:`text-base`,children:`Configured Presets`})}),(0,P.jsxs)(V,{className:`space-y-3`,children:[Gr.isLoading?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading presets`}):null,Gr.isError?(0,P.jsxs)(`div`,{className:`text-sm text-destructive`,children:[`Failed to load presets: `,Gr.error.message]}):null,(()=>{let e=Gr.data?.presets??[];return e.length===0?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No presets yet.`}):(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Name`}),(0,P.jsx)(Q,{children:`Pack`}),(0,P.jsx)(Q,{children:`Enabled`}),(0,P.jsx)(Q,{children:`Interval`}),(0,P.jsx)(Q,{children:`Next`}),(0,P.jsx)(Q,{children:`Last Run`}),(0,P.jsx)(Q,{className:`text-right`,children:`Actions`})]})}),(0,P.jsx)(pl,{children:e.map(e=>(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{className:`font-medium`,children:e.name}),(0,P.jsx)($,{children:(0,P.jsx)(W,{variant:`secondary`,children:e.packId||e.kind})}),(0,P.jsx)($,{children:(0,P.jsx)(W,{variant:e.enabled?`secondary`:`outline`,children:String(e.enabled)})}),(0,P.jsxs)($,{className:`font-mono text-xs`,children:[e.intervalMinutes,`m`]}),(0,P.jsx)($,{className:`text-xs text-muted-foreground`,children:e.nextRunAt||``}),(0,P.jsx)($,{className:`text-xs text-muted-foreground`,children:e.lastRunAt||``}),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[(0,P.jsx)(F,{size:`sm`,variant:`outline`,onClick:()=>bi.mutate(e.id),disabled:bi.isPending,children:`Run Now`}),(0,P.jsx)(F,{size:`sm`,variant:`destructive`,onClick:()=>{confirm(`Delete preset "${e.name}"?`)&&yi.mutate(e.id)},disabled:yi.isPending,children:`Delete`})]})})]},e.id))})]})})})()]})]})]}),(0,P.jsxs)(Uc,{value:`deltas`,className:`space-y-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Snapshot Delta`})}),(0,P.jsxs)(V,{className:`grid gap-4 md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Pack`}),(0,P.jsxs)(q,{value:Qe,onValueChange:$e,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Choose a pack`})}),(0,P.jsx)(X,{children:Li.map(e=>(0,P.jsx)(Z,{value:e.id,children:e.title??e.id},e.id))})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Baseline snapshot`}),(0,P.jsxs)(q,{value:Je,onValueChange:Ye,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select baseline`})}),(0,P.jsx)(X,{children:Xr.map(e=>(0,P.jsxs)(Z,{value:e.id,children:[e.id,e.createdAt?` (${e.createdAt})`:``]},e.id))})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Compare snapshot`}),(0,P.jsxs)(q,{value:Xe,onValueChange:Ze,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select compare`})}),(0,P.jsx)(X,{children:Xr.map(e=>(0,P.jsxs)(Z,{value:e.id,children:[e.id,e.createdAt?` (${e.createdAt})`:``]},e.id))})]})]})]}),(0,P.jsxs)(V,{className:`flex items-center gap-2 pt-0`,children:[(0,P.jsxs)(F,{onClick:()=>ci.mutate(),disabled:ci.isPending,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),`Run delta`]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>{if(!ot)return;let e=l.trim(),t=Wi(ot);jd(`policy-pack-delta_${ot.packId}_${e||`network`}_${ot.baselineSnapshotId}_to_${ot.compareSnapshotId}.md`,`text/markdown`,t)},disabled:!ot,children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`MD`]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>{if(!ot)return;let e=l.trim();Ad(`policy-pack-delta_${ot.packId}_${e||`network`}_${ot.baselineSnapshotId}_to_${ot.compareSnapshotId}.json`,ot)},disabled:!ot,children:[(0,P.jsx)(Oe,{className:`mr-2 h-4 w-4`}),`Export delta`]})]})]}),ot?(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Delta Results`})}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Check`}),(0,P.jsx)(Q,{className:`text-right`,children:`Baseline`}),(0,P.jsx)(Q,{className:`text-right`,children:`Compare`}),(0,P.jsx)(Q,{className:`text-right`,children:`New`}),(0,P.jsx)(Q,{className:`text-right`,children:`Resolved`}),(0,P.jsx)(Q,{className:`text-right`,children:`Changed`}),(0,P.jsx)(Q,{className:`text-right`,children:`Details`})]})}),(0,P.jsx)(pl,{children:(ot.checks??[]).map(e=>(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{className:`font-mono text-xs`,children:e.checkId}),(0,P.jsx)($,{className:`text-right tabular-nums`,children:e.baselineTotal}),(0,P.jsx)($,{className:`text-right tabular-nums`,children:e.compareTotal}),(0,P.jsx)($,{className:`text-right tabular-nums`,children:e.newCount}),(0,P.jsx)($,{className:`text-right tabular-nums`,children:e.resolvedCount}),(0,P.jsx)($,{className:`text-right tabular-nums`,children:e.changedCount??0}),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>{Dt(e.checkId),Tt(!0)},children:`View`})})]},e.checkId))})]})}),(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:14,value:kd(ot)})]})]}):null]}),(0,P.jsxs)(Uc,{value:`governance`,className:`space-y-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-2 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(z,{children:`Recert Campaigns`}),(0,P.jsx)(B,{children:`Persisted review workflows (no config push): generate assignments, attest, waive, and export evidence.`})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(F,{variant:`outline`,onClick:()=>I.refetch(),disabled:I.isFetching,children:[(0,P.jsx)(Ot,{className:`mr-2 h-4 w-4`}),`Refresh`]}),(0,P.jsx)(F,{onClick:()=>It(!0),children:`New campaign`})]})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[I.isError?(0,P.jsxs)(`p`,{className:`text-xs text-destructive`,children:[`Failed to load campaigns: `,I.error.message]}):null,(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Name`}),(0,P.jsx)(Q,{children:`Pack`}),(0,P.jsx)(Q,{children:`Status`}),(0,P.jsx)(Q,{className:`text-right`,children:`Pending`}),(0,P.jsx)(Q,{className:`text-right`,children:`Attested`}),(0,P.jsx)(Q,{className:`text-right`,children:`Waived`})]})}),(0,P.jsx)(pl,{children:(I.data?.campaigns??[]).length===0?(0,P.jsx)(hl,{children:(0,P.jsx)($,{colSpan:6,className:`text-sm text-muted-foreground`,children:`No campaigns yet.`})}):(I.data?.campaigns??[]).map(e=>(0,P.jsxs)(hl,{className:`cursor-pointer`,onClick:()=>Pt(e.campaign.id),children:[(0,P.jsxs)($,{className:`font-medium`,children:[e.campaign.name,Nt===e.campaign.id?(0,P.jsx)(W,{className:`ml-2`,variant:`secondary`,children:`selected`}):null]}),(0,P.jsx)($,{className:`font-mono text-xs`,children:e.campaign.packId}),(0,P.jsx)($,{children:(0,P.jsx)(W,{variant:`secondary`,children:e.campaign.status})}),(0,P.jsx)($,{className:`text-right tabular-nums`,children:e.counts.pending}),(0,P.jsx)($,{className:`text-right tabular-nums`,children:e.counts.attested}),(0,P.jsx)($,{className:`text-right tabular-nums`,children:e.counts.waived})]},e.campaign.id))})]})})]})]}),Nt?(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Assignments`}),(0,P.jsx)(B,{children:`Generate (or regenerate) assignments from the campaign pack results.`})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Default assignee`}),(0,P.jsx)(K,{value:qt,onChange:e=>Jt(e.target.value),placeholder:`optional (username)`})]}),(0,P.jsxs)(`div`,{className:`space-y-2 md:col-span-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Actions`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsxs)(F,{onClick:()=>wi.mutate(),disabled:wi.isPending,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),`Generate assignments`]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>Br.refetch(),disabled:Br.isFetching,children:[(0,P.jsx)(Ot,{className:`mr-2 h-4 w-4`}),`Refresh`]})]}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Generation replaces existing assignments for the campaign.`})]})]}),Br.isError?(0,P.jsxs)(`p`,{className:`text-xs text-destructive`,children:[`Failed to load assignments:`,` `,Br.error.message]}):null,(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Asset`}),(0,P.jsx)(Q,{children:`Check`}),(0,P.jsx)(Q,{children:`Status`}),(0,P.jsx)(Q,{className:`text-right`,children:`Risk`}),(0,P.jsx)(Q,{className:`text-right`,children:`Details`}),(0,P.jsx)(Q,{className:`text-right`,children:`Actions`})]})}),(0,P.jsx)(pl,{children:(Br.data?.assignments??[]).length===0?(0,P.jsx)(hl,{children:(0,P.jsx)($,{colSpan:6,className:`text-sm text-muted-foreground`,children:`No assignments yet.`})}):(Br.data?.assignments??[]).map(e=>(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{className:`font-mono text-xs`,children:e.findingAssetKey||``}),(0,P.jsxs)($,{className:`max-w-[420px] truncate`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:e.checkTitle||e.checkId}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono`,children:e.checkId})]}),(0,P.jsx)($,{children:(0,P.jsx)(W,{variant:`secondary`,children:e.status})}),(0,P.jsx)($,{className:`text-right tabular-nums`,children:typeof e.findingRiskScore==`number`?e.findingRiskScore:``}),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>{Ct(kd({findingId:e.findingId,checkId:e.checkId,finding:e.finding})),xt(!0)},children:`View`})}),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[(0,P.jsx)(F,{size:`sm`,onClick:()=>{dn(`ATTEST`),pn(e.id),hn(``),ln(!0)},disabled:Ti.isPending,children:`Attest`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,onClick:()=>{dn(`WAIVE`),pn(e.id),hn(``),ln(!0)},disabled:Ei.isPending,children:`Waive`})]})})]},e.id))})]})})]})]}):null,(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-2 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(z,{children:`Exceptions`}),(0,P.jsx)(B,{children:`Propose exceptions for specific findings (with expiry and audit trail).`})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(F,{variant:`outline`,onClick:()=>Vr.refetch(),disabled:Vr.isFetching,children:[(0,P.jsx)(Ot,{className:`mr-2 h-4 w-4`}),`Refresh`]}),(0,P.jsx)(F,{onClick:()=>Xt(!0),children:`New exception`})]})]}),(0,P.jsx)(V,{className:`space-y-3`,children:(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Status`}),(0,P.jsx)(Q,{children:`Check`}),(0,P.jsx)(Q,{children:`Finding`}),(0,P.jsx)(Q,{children:`Justification`}),(0,P.jsx)(Q,{children:`Ticket`}),(0,P.jsx)(Q,{children:`Created`}),(0,P.jsx)(Q,{className:`text-right`,children:`Expires`}),(0,P.jsx)(Q,{className:`text-right`,children:`Actions`})]})}),(0,P.jsx)(pl,{children:(Vr.data?.exceptions??[]).length===0?(0,P.jsx)(hl,{children:(0,P.jsx)($,{colSpan:8,className:`text-sm text-muted-foreground`,children:`No exceptions yet.`})}):(Vr.data?.exceptions??[]).map(e=>(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{children:(0,P.jsx)(W,{variant:`secondary`,children:e.status})}),(0,P.jsx)($,{className:`font-mono text-xs`,children:e.checkId}),(0,P.jsx)($,{className:`font-mono text-xs max-w-[520px] truncate`,children:e.findingId}),(0,P.jsx)($,{className:`max-w-[420px] truncate text-xs`,children:e.justification}),(0,P.jsx)($,{className:`max-w-[240px] truncate text-xs`,children:e.ticketUrl?(0,P.jsx)(`a`,{href:e.ticketUrl,target:`_blank`,rel:`noreferrer`,className:`underline`,children:e.ticketUrl}):``}),(0,P.jsxs)($,{className:`text-xs`,children:[(0,P.jsx)(`div`,{className:`font-mono`,children:e.createdBy}),e.approvedBy?(0,P.jsxs)(`div`,{className:`text-muted-foreground font-mono`,children:[`approved `,e.approvedBy]}):null]}),(0,P.jsx)($,{className:`text-right text-xs font-mono`,children:e.expiresAt?String(e.expiresAt).slice(0,10):``}),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[(0,P.jsx)(F,{size:`sm`,variant:`outline`,onClick:()=>{Ct(kd(e)),xt(!0)},children:`View`}),(0,P.jsx)(F,{size:`sm`,onClick:()=>Oi.mutate(e.id),disabled:Oi.isPending||String(e.status??``).toUpperCase()!==`PROPOSED`,children:`Approve`}),(0,P.jsx)(F,{size:`sm`,variant:`outline`,onClick:()=>ki.mutate(e.id),disabled:ki.isPending||String(e.status??``).toUpperCase()!==`PROPOSED`,children:`Reject`})]})})]},e.id))})]})})})]})]}),(0,P.jsxs)(Uc,{value:`change`,className:`space-y-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Change Planning (Simulation)`}),(0,P.jsx)(B,{children:`Demo-grade what-if: simulate an ADD/MODIFY/REMOVE against first-match decisions for a list of flows (no config push).`})]}),(0,P.jsxs)(V,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Device (optional)`}),(0,P.jsx)(K,{value:gn,onChange:e=>_n(e.target.value),placeholder:`Exact device name (optional)`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Operation`}),(0,P.jsxs)(q,{value:vn,onValueChange:yn,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`ADD`,children:`ADD`}),(0,P.jsx)(Z,{value:`MODIFY`,children:`MODIFY`}),(0,P.jsx)(Z,{value:`REMOVE`,children:`REMOVE`})]})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Rule index`}),(0,P.jsx)(K,{value:bn,onChange:e=>xn(e.target.value),placeholder:`0`,inputMode:`numeric`,className:`font-mono text-xs`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Action`}),(0,P.jsxs)(q,{value:Sn,onValueChange:Cn,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`PERMIT`,children:`PERMIT`}),(0,P.jsx)(Z,{value:`DENY`,children:`DENY`})]})]})]})]}),(0,P.jsxs)(V,{className:`space-y-4 pt-0`,children:[(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`ipv4Src (CIDRs, comma/newline; empty = any)`}),(0,P.jsx)(ul,{value:wn,onChange:e=>Tn(e.target.value),rows:3,className:`font-mono text-xs`,placeholder:`10.0.0.0/8`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`ipv4Dst (CIDRs, comma/newline; empty = any)`}),(0,P.jsx)(ul,{value:En,onChange:e=>Dn(e.target.value),rows:3,className:`font-mono text-xs`,placeholder:`10.1.0.0/16`})]})]}),(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`ipProto (comma/newline ints; empty = any)`}),(0,P.jsx)(K,{value:On,onChange:e=>kn(e.target.value),placeholder:`6,17`,className:`font-mono text-xs`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`tpDst (e.g. 443, 80-81; empty = any)`}),(0,P.jsx)(K,{value:An,onChange:e=>jn(e.target.value),placeholder:`443, 8443`,className:`font-mono text-xs`})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Flows (one per line: srcIp dstIp [ipProto] [dstPort])`}),(0,P.jsx)(ul,{value:Mn,onChange:e=>Nn(e.target.value),rows:6,className:`font-mono text-xs`,placeholder:`10.0.0.1 10.0.0.2 6 443`})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(F,{onClick:()=>Ai.mutate(),disabled:Ai.isPending,children:[(0,P.jsx)(Vt,{className:`mr-2 h-4 w-4`}),`Simulate`]}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>Fn(null),disabled:!Pn,children:`Clear`})]})]})]}),Pn?(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Impact`})}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2 text-sm`,children:[(0,P.jsxs)(W,{variant:`secondary`,children:[`Flows: `,Pn.totalFlows]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Devices: `,Pn.totalDevices]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Changed: `,Pn.changedCount]})]}),(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Device`}),(0,P.jsx)(Q,{children:`Flow`}),(0,P.jsx)(Q,{children:`Before`}),(0,P.jsx)(Q,{children:`After`}),(0,P.jsx)(Q,{children:`Reason`})]})}),(0,P.jsx)(pl,{children:(Pn.impacts??[]).filter(e=>e?.changed).slice(0,200).map((e,t)=>(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{className:`font-mono text-xs`,children:e.device}),(0,P.jsxs)($,{className:`font-mono text-xs`,children:[e.flow?.srcIp,`  `,e.flow?.dstIp,` `,e.flow?.ipProto??``,` `,e.flow?.dstPort??``]}),(0,P.jsxs)($,{className:`font-mono text-xs`,children:[e.beforeDecision,` `,e.beforeRule?`(${e.beforeRule})`:``]}),(0,P.jsxs)($,{className:`font-mono text-xs`,children:[e.afterDecision,` `,e.afterRule?`(${e.afterRule})`:``]}),(0,P.jsx)($,{className:`text-xs text-muted-foreground`,children:e.reason||``})]},`${e.device}:${t}`))})]})}),(0,P.jsxs)(`details`,{children:[(0,P.jsx)(`summary`,{className:`cursor-pointer text-xs text-muted-foreground`,children:`Show raw JSON`}),(0,P.jsx)(`div`,{className:`pt-2`,children:(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:14,value:kd(Pn)})})]})]})]}):null]})]}),(0,P.jsx)(tr,{open:!!ct,onOpenChange:e=>{e||lt(``)},children:(0,P.jsxs)(ir,{className:`max-w-3xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Check Query`}),(0,P.jsx)(cr,{children:ct})]}),(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:18,value:Zr.data?.content??(Zr.isPending?`Loading`:``)})]})}),(0,P.jsx)(tr,{open:ut,onOpenChange:dt,children:(0,P.jsxs)(ir,{className:`max-w-4xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`First Match Evidence`}),(0,P.jsx)(cr,{children:`sourceConfigText(...) output`})]}),(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:18,value:ft})]})}),(0,P.jsx)(tr,{open:gt,onOpenChange:_t,children:(0,P.jsxs)(ir,{className:`max-w-4xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Rule Evidence`}),(0,P.jsx)(cr,{children:`sourceConfigText(...) output`})]}),(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:18,value:vt})]})}),(0,P.jsx)(tr,{open:bt,onOpenChange:xt,children:(0,P.jsxs)(ir,{className:`max-w-4xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Evidence`}),(0,P.jsx)(cr,{children:`sourceConfigText(...) output`})]}),(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:18,value:St})]})}),(0,P.jsx)(tr,{open:wt,onOpenChange:Tt,children:(0,P.jsxs)(ir,{className:`max-w-6xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Delta Check Details`}),(0,P.jsx)(cr,{children:Et})]}),(()=>{let e=(ot?.checks??[]).find(e=>e.checkId===Et);if(!e)return(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No data for this check.`});let t=ji(e.newSamples),n=ji(e.oldSamples),r=ji(e.changedSamples),i=e=>{let t=Ni(e);return(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[t.map(e=>(0,P.jsx)(Q,{children:e},e)),(0,P.jsx)(Q,{className:`text-right`,children:`Evidence`})]})}),(0,P.jsx)(pl,{children:e.slice(0,50).map((e,n)=>{let r=Mi(e);return(0,P.jsxs)(hl,{children:[t.map(t=>(0,P.jsx)($,{className:`max-w-[360px] truncate font-mono text-xs`,children:typeof e?.[t]==`string`||typeof e?.[t]==`number`?String(e?.[t]):e?.[t]==null?``:JSON.stringify(e?.[t])},t)),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsx)(F,{variant:`outline`,size:`sm`,disabled:r.length===0,onClick:()=>{Ct(r[0]?.value??``),xt(!0)},children:`View`})})]},n)})})]})})};return(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`text-sm`,children:[(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:`New`}),(0,P.jsx)(`div`,{className:`font-medium`,children:e.newCount})]}),(0,P.jsxs)(`div`,{className:`text-sm`,children:[(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:`Resolved`}),(0,P.jsx)(`div`,{className:`font-medium`,children:e.resolvedCount})]}),(0,P.jsxs)(`div`,{className:`text-sm`,children:[(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:`Changed`}),(0,P.jsx)(`div`,{className:`font-medium`,children:e.changedCount??0})]})]}),t.length?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`New samples`}),i(t)]}):null,n.length?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Resolved samples`}),i(n)]}):null,r.length?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Changed samples`}),(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`findingId`}),(0,P.jsx)(Q,{className:`text-right`,children:`Baseline/Compare`})]})}),(0,P.jsx)(pl,{children:r.slice(0,50).map((e,t)=>(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{className:`font-mono text-xs`,children:String(e?.findingId??``)}),(0,P.jsx)($,{className:`text-right`,children:(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>{Mt({findingId:String(e?.findingId??``),baseline:e?.baseline,compare:e?.compare}),At(!0)},children:`View`})})]},t))})]})})]}):null]})})()]})}),(0,P.jsx)(tr,{open:kt,onOpenChange:At,children:(0,P.jsxs)(ir,{className:`max-w-6xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Changed Finding`}),(0,P.jsx)(cr,{children:jt?.findingId??``})]}),(()=>{let e=Fi(jt?.baseline,jt?.compare);return e.length?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Top-level differences`}),(0,P.jsx)(`div`,{className:`rounded-md border`,children:(0,P.jsxs)(dl,{children:[(0,P.jsx)(fl,{children:(0,P.jsxs)(hl,{children:[(0,P.jsx)(Q,{children:`Field`}),(0,P.jsx)(Q,{children:`Baseline`}),(0,P.jsx)(Q,{children:`Compare`})]})}),(0,P.jsx)(pl,{children:e.slice(0,30).map(e=>(0,P.jsxs)(hl,{children:[(0,P.jsx)($,{className:`font-mono text-xs`,children:e.key}),(0,P.jsx)($,{className:`max-w-[360px] truncate font-mono text-xs`,children:e.baseline}),(0,P.jsx)($,{className:`max-w-[360px] truncate font-mono text-xs`,children:e.compare})]},e.key))})]})}),e.length>30?(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Showing 30 of `,e.length,` differing fields.`]}):null]}):(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`No top-level differences detected (the change may be nested).`})})(),(0,P.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Baseline`}),(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:16,value:kd(jt?.baseline)})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Compare`}),(0,P.jsx)(ul,{readOnly:!0,className:`font-mono text-xs`,rows:16,value:kd(jt?.compare)})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2 pt-2`,children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>{let e=Mi(jt?.baseline),t=Mi(jt?.compare);Ct(e[0]?.value??t[0]?.value??``),xt(!0)},disabled:Mi(jt?.baseline).length===0&&Mi(jt?.compare).length===0,children:`View evidence`}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>{Ct(Mi(jt?.baseline)[0]?.value??``),xt(!0)},disabled:Mi(jt?.baseline).length===0,children:`Baseline evidence`}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>{Ct(Mi(jt?.compare)[0]?.value??``),xt(!0)},disabled:Mi(jt?.compare).length===0,children:`Compare evidence`})]})]})}),(0,P.jsx)(tr,{open:!!Rn,onOpenChange:e=>{e||zn(``)},children:(0,P.jsxs)(ir,{className:`max-w-3xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Check Parameters`}),(0,P.jsx)(cr,{children:Rn})]}),Gi?(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(Gi.params??[]).map(e=>{let t=String(e.name??``).trim();if(!t)return null;let n=String(e.type??``).replaceAll(` `,``),r=Wn[t];if(zd(n)){let i=Hn[t]??JSON.stringify(Bn[t]??e.default??[],null,0);return(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:t}),(0,P.jsx)(W,{variant:`secondary`,children:n||`List`})]}),e.description?(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:e.description}):null,(0,P.jsx)(ul,{className:`font-mono text-xs`,rows:4,value:i,onChange:e=>{let n=e.target.value;Un(e=>({...e,[t]:n}));try{let e=JSON.parse(n);Vn(n=>({...n,[t]:e})),Gn(e=>{let n={...e};return delete n[t],n})}catch(e){Gn(n=>({...n,[t]:e.message}))}}}),r?(0,P.jsxs)(`p`,{className:`text-xs text-destructive`,children:[`Invalid JSON: `,r]}):null]},t)}if(n.toLowerCase()===`bool`){let n=!!(Bn[t]??e.default??!1);return(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:t}),(0,P.jsx)(W,{variant:`secondary`,children:`Bool`})]}),e.description?(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:e.description}):null,(0,P.jsxs)(q,{value:n?`true`:`false`,onValueChange:e=>Vn(n=>({...n,[t]:e===`true`})),children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`true`,children:`true`}),(0,P.jsx)(Z,{value:`false`,children:`false`})]})]})]},t)}if(n.toLowerCase()===`integer`){let n=Bn[t],r=typeof n==`number`?String(n):n===void 0?String(e.default??``):String(n);return(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:t}),(0,P.jsx)(W,{variant:`secondary`,children:`Integer`})]}),e.description?(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:e.description}):null,(0,P.jsx)(K,{inputMode:`numeric`,value:r,onChange:e=>{let n=e.target.value,r=Number(n);Vn(e=>({...e,[t]:Number.isFinite(r)?r:n}))}})]},t)}let i=Bn[t]??e.default??``;return(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:t}),(0,P.jsx)(W,{variant:`secondary`,children:n||`String`})]}),e.description?(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:e.description}):null,(0,P.jsx)(K,{value:String(i),onChange:e=>Vn(n=>({...n,[t]:e.target.value}))})]},t)}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2 pt-2`,children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>{Vn(Rd(Gi)),Un({}),Gn({})},children:`Reset to defaults`}),(0,P.jsx)(F,{onClick:()=>{if(Object.keys(Wn).length>0){j.error(`Fix parameter errors before saving`);return}let e=Rn;Ln(t=>({...t,[e]:Bn})),zn(``),j.success(`Parameters saved`,{description:e})},children:`Save`})]})]}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No parameters.`})]})}),(0,P.jsx)(tr,{open:v,onOpenChange:te,children:(0,P.jsxs)(ir,{className:`max-w-2xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Add Forward Network`}),(0,P.jsx)(cr,{children:`Save one or more Forward Network IDs so Policy Reports is organized per network.`})]}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Forward Network ID`}),(0,P.jsx)(K,{value:ne,onChange:e=>re(e.target.value),placeholder:`e.g. 235216`,className:`font-mono text-xs`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Name`}),(0,P.jsx)(K,{value:ie,onChange:e=>ae(e.target.value),placeholder:`Prod Branch WAN`})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Description (optional)`}),(0,P.jsx)(ul,{value:y,onChange:e=>b(e.target.value),rows:3,placeholder:`Optional notes`})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-end gap-2 pt-2`,children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>te(!1),disabled:li.isPending,children:`Cancel`}),(0,P.jsx)(F,{onClick:()=>li.mutate(),disabled:li.isPending,children:`Save`})]})]})]})}),(0,P.jsx)(tr,{open:Kn,onOpenChange:qn,children:(0,P.jsxs)(ir,{className:`max-w-2xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Add Zone`}),(0,P.jsx)(cr,{children:`A zone is a named set of CIDRs used for segmentation-style checks.`})]}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Name`}),(0,P.jsx)(K,{value:Jn,onChange:e=>Yn(e.target.value),placeholder:`mgmt, prod, dmz, pci`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Description (optional)`}),(0,P.jsx)(K,{value:Xn,onChange:e=>Zn(e.target.value),placeholder:`Optional notes`})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Subnets (CIDRs)`}),(0,P.jsx)(ul,{value:Qn,onChange:e=>$n(e.target.value),rows:6,placeholder:`10.0.0.0/8
192.168.10.0/24`,className:`font-mono text-xs`}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`One per line or comma-separated.`})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-end gap-2 pt-2`,children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>qn(!1),disabled:pi.isPending,children:`Cancel`}),(0,P.jsx)(F,{onClick:()=>pi.mutate(),disabled:pi.isPending,children:`Save`})]})]})]})}),(0,P.jsx)(tr,{open:x,onOpenChange:S,children:(0,P.jsxs)(ir,{className:`max-w-2xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`Forward Credentials (Per User)`}),(0,P.jsx)(cr,{children:`Stored encrypted. Leave password empty to keep the existing stored password.`})]}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Forward URL`}),(0,P.jsx)(K,{value:oe,onChange:e=>se(e.target.value),placeholder:`https://fwd.app`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Skip TLS Verify`}),(0,P.jsxs)(q,{value:ce?`true`:`false`,onValueChange:e=>C(e===`true`),children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`false`,children:`false`}),(0,P.jsx)(Z,{value:`true`,children:`true`})]})]})]})]}),(0,P.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Username`}),(0,P.jsx)(K,{value:ue,onChange:e=>w(e.target.value),placeholder:`Forward username`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Password`}),(0,P.jsx)(K,{type:`password`,value:T,onChange:e=>de(e.target.value),placeholder:zi?.hasPassword?`(stored)`:``}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Password is never shown again once stored.`})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-end gap-2 pt-2`,children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>S(!1),disabled:di.isPending,children:`Cancel`}),(0,P.jsx)(F,{onClick:()=>di.mutate(),disabled:di.isPending,children:`Save`})]})]})]})}),(0,P.jsx)(tr,{open:Ft,onOpenChange:It,children:(0,P.jsxs)(ir,{className:`max-w-2xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`New Recert Campaign`}),(0,P.jsx)(cr,{children:`Uses the current Network ID and Snapshot selection at the top of the page.`})]}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Name`}),(0,P.jsx)(K,{value:Lt,onChange:e=>zt(e.target.value),placeholder:`Q1 Policy Recert`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Pack`}),(0,P.jsxs)(q,{value:Ut,onValueChange:Wt,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Pick a pack`})}),(0,P.jsx)(X,{children:Li.map(e=>(0,P.jsx)(Z,{value:e.id,children:e.title??e.id},e.id))})]})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Description`}),(0,P.jsx)(ul,{value:Bt,onChange:e=>Ht(e.target.value),rows:3,placeholder:`optional`})]}),(0,P.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Due At (RFC3339, optional)`}),(0,P.jsx)(K,{value:Gt,onChange:e=>Kt(e.target.value),placeholder:`2026-03-31T23:59:59Z`,className:`font-mono text-xs`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Default assignee (optional)`}),(0,P.jsx)(K,{value:qt,onChange:e=>Jt(e.target.value),placeholder:`username`})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-end gap-2 pt-2`,children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>It(!1),disabled:Ci.isPending,children:`Cancel`}),(0,P.jsx)(F,{onClick:()=>Ci.mutate(),disabled:Ci.isPending,children:`Create`})]})]})]})}),(0,P.jsx)(tr,{open:Yt,onOpenChange:Xt,children:(0,P.jsxs)(ir,{className:`max-w-2xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:`New Exception`}),(0,P.jsx)(cr,{children:`Attach to a specific findingId + checkId (copy from report JSON).`})]}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Check ID`}),(0,P.jsx)(K,{value:$t,onChange:e=>en(e.target.value),placeholder:`acl-any-any-permit.nqe`,className:`font-mono text-xs`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Finding ID`}),(0,P.jsx)(K,{value:Zt,onChange:e=>Qt(e.target.value),placeholder:`sha256...`,className:`font-mono text-xs`})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Justification`}),(0,P.jsx)(ul,{value:tn,onChange:e=>nn(e.target.value),rows:4,placeholder:`Explain compensating controls and why this is acceptable.`})]}),(0,P.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Ticket URL (optional)`}),(0,P.jsx)(K,{value:rn,onChange:e=>an(e.target.value),placeholder:`https://jira/... or https://servicenow/...`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Expires At (RFC3339, optional)`}),(0,P.jsx)(K,{value:on,onChange:e=>sn(e.target.value),placeholder:`2026-06-30T23:59:59Z`,className:`font-mono text-xs`})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-end gap-2 pt-2`,children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>Xt(!1),disabled:Di.isPending,children:`Cancel`}),(0,P.jsx)(F,{onClick:()=>Di.mutate(),disabled:Di.isPending,children:`Propose`})]})]})]})}),(0,P.jsx)(tr,{open:cn,onOpenChange:ln,children:(0,P.jsxs)(ir,{className:`max-w-xl`,children:[(0,P.jsxs)(ar,{children:[(0,P.jsx)(sr,{children:un===`ATTEST`?`Attest Assignment`:`Waive Assignment`}),(0,P.jsx)(cr,{children:`Record an audit-friendly justification (no config push).`})]}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Justification`}),(0,P.jsx)(ul,{value:mn,onChange:e=>hn(e.target.value),rows:4,placeholder:`Why is this acceptable? Reference tickets / compensating controls.`})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-end gap-2 pt-2`,children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>ln(!1),disabled:Ti.isPending||Ei.isPending,children:`Cancel`}),(0,P.jsx)(F,{onClick:()=>{let e=fn;if(!e){j.error(`Missing assignment id`);return}let t=mn.trim();if(!t){j.error(`Justification is required`);return}un===`ATTEST`?Ti.mutate({assignmentId:e,justification:t}):Ei.mutate({assignmentId:e,justification:t})},disabled:Ti.isPending||Ei.isPending,children:un===`ATTEST`?`Attest`:`Waive`})]})]})]})})]})}async function Vd(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/assurance/traffic/seeds`,{method:`POST`,body:JSON.stringify(n??{})})}async function Hd(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/assurance/traffic/evaluate`,{method:`POST`,body:JSON.stringify(n??{})})}var Ud=Qn({workspace:qn().optional().catch(``)});const Wd=t(`/dashboard/forward-networks/$networkRef/traffic-scenarios`)({validateSearch:e=>Ud.parse(e),component:Yd});function Gd(e){return String(e??``).split(`,`).map(e=>e.trim()).filter(Boolean)}function Kd(e){let t=[`from,srcIp,dstIp,ipProto,srcPort,dstPort,bandwidthGbps,label`];for(let n of e??[]){let e=String(n.from??``).replaceAll(`,`,` `).trim(),r=String(n.srcIp??``).replaceAll(`,`,` `).trim(),i=String(n.dstIp??``).replaceAll(`,`,` `).trim(),a=n.ipProto===void 0?``:String(n.ipProto),o=String(n.srcPort??``).replaceAll(`,`,` `).trim(),s=String(n.dstPort??``).replaceAll(`,`,` `).trim(),c=n.bandwidthGbps===void 0?``:String(n.bandwidthGbps),l=String(n.label??``).replaceAll(`,`,` `).trim();t.push([e,r,i,a,o,s,c,l].join(`,`))}return t.join(`
`)+`
`}function qd(e){return String(e??``).split(`,`).map(e=>e.trim())}function Jd(e){let t=[],n=String(e??``).split(/\r?\n/).map(e=>e.trim()).filter(Boolean);if(!n.length)return t;let r=n[0].toLowerCase(),i=r.includes(`dstip`)||r.includes(`bandwidth`)||r.includes(`ipproto`),a=new Map,o=0;if(i){let e=qd(n[0]);for(let t=0;t<e.length;t++){let n=String(e[t]??``).trim().toLowerCase();n&&a.set(n,t)}o=1}let s=(e,t,n)=>{let r=a.get(t);return r===void 0?String(e[n]??``).trim():String(e[r]??``).trim()};for(let e=o;e<n.length;e++){let r=qd(n[e]),a=!i&&r.length>=7,o=s(r,`from`,0),c=i||a?s(r,`srcip`,1):``,l=i||a?s(r,`dstip`,2):s(r,`dstip`,1);if(!l)continue;let u=i||a?s(r,`ipproto`,3):``,d=i||a?s(r,`srcport`,4):``,f=i||a?s(r,`dstport`,5):``,p=i||a?s(r,`bandwidthgbps`,6):s(r,`bandwidthgbps`,2),m=i||a?s(r,`label`,7):s(r,`label`,3),h=p?Number(p):NaN,g=u?Number(u):NaN;t.push({from:o||void 0,srcIp:c||void 0,dstIp:l,ipProto:Number.isFinite(g)?g:void 0,srcPort:d||void 0,dstPort:f||void 0,bandwidthGbps:Number.isFinite(h)?h:void 0,label:m||void 0})}return t}function Yd(){let{networkRef:e}=Wd.useParams(),{workspace:t}=Wd.useSearch(),n=String(t??``).trim(),[a,o]=(0,M.useState)(`mesh`),[s,c]=(0,M.useState)(!0),[l,u]=(0,M.useState)(``),[d,f]=(0,M.useState)(``),[m,h]=(0,M.useState)(``),[g,_]=(0,M.useState)(``),[v,te]=(0,M.useState)(``),[ne,re]=(0,M.useState)(``),[ie,ae]=(0,M.useState)(``),[y,b]=(0,M.useState)(``),[x,S]=(0,M.useState)(``),[oe,se]=(0,M.useState)(`30`),[ce,le]=(0,M.useState)(`200`),[C,ue]=(0,M.useState)(``),[w,T]=(0,M.useState)(`7d`),[de,fe]=(0,M.useState)(`0.8`),[pe,me]=(0,M.useState)(``),[he,ge]=(0,M.useState)(!1),[_e,ve]=(0,M.useState)(!0),[ye,be]=(0,M.useState)(!1),[xe,Se]=(0,M.useState)(`3`),[D,Ce]=(0,M.useState)(!0),we=i({queryKey:H.workspaceForwardNetworks(n),queryFn:()=>Uo(n),enabled:!!n,retry:!1,staleTime:3e4}),Te=(0,M.useMemo)(()=>{let t=(we.data?.networks??[]).find(t=>String(t?.id??``)===String(e));return String(t?.name??``)},[we.data?.networks,e]),Ee=r({mutationFn:async()=>{let t=String(a??`mesh`),r={snapshotId:C.trim()||void 0,maxDevices:Number(oe)||30,maxDemands:Number(ce)||200,mode:t,includeGroups:s};return t===`cross`?(r.srcTagParts=Gd(g),r.srcNameParts=Gd(v),r.srcDeviceTypes=Gd(ne),r.dstTagParts=Gd(ie),r.dstNameParts=Gd(y),r.dstDeviceTypes=Gd(x)):(r.tagParts=Gd(l),r.nameParts=Gd(d),r.deviceTypes=Gd(m)),Vd(n,e,r)},onSuccess:e=>{me(Kd(e.demands??[]));let t=String(a??`mesh`),n=t===`cross`?e.srcEndpoints?.length??0:e.endpoints?.length??0,r=t===`cross`?e.dstEndpoints?.length??0:e.endpoints?.length??0;j.success(`Seeded src=${n}, dst=${r}, demands=${e.demands?.length??0}`)},onError:e=>{j.error(String(e?.message??e??`seed failed`))}}),De=r({mutationFn:async()=>{let t=Jd(pe);if(!t.length)throw Error(`no demands parsed from CSV`);let r=Number(de),i=Number(xe);return Hd(n,e,{snapshotId:C.trim()||void 0,window:w,thresholdUtil:Number.isFinite(r)?r:.8,forward:{maxResults:Number.isFinite(i)&&i>0?i:3},enforcement:{requireEnforcement:D},demands:t,includeHops:he,includeAcl:ye,projectLoad:_e})},onError:e=>{j.error(String(e?.message??e??`evaluate failed`))}});return(0,P.jsxs)(`div`,{className:`space-y-6`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(F,{asChild:!0,variant:`ghost`,size:`sm`,children:(0,P.jsxs)(p,{to:`/dashboard/forward-networks`,search:{workspace:n},children:[(0,P.jsx)(ee,{className:`h-4 w-4`}),(0,P.jsx)(`span`,{className:`ml-2`,children:`Forward Networks`})]})}),(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Traffic Scenarios`}),(0,P.jsx)(`div`,{className:`text-lg font-semibold`,children:Te||e})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(W,{variant:`secondary`,children:`Forward Paths + NQE`}),(0,P.jsx)(F,{asChild:!0,variant:`outline`,size:`sm`,children:(0,P.jsx)(p,{to:`/dashboard/forward-networks/$networkRef/assurance-studio`,params:{networkRef:e},search:{workspace:n},children:`Assurance Studio`})}),we.isLoading?(0,P.jsx)(U,{className:`h-6 w-24`}):null]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Scenario Inputs`})}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Workspace`}),(0,P.jsx)(K,{value:n,readOnly:!0})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Forward snapshotId (optional)`}),(0,P.jsx)(K,{value:C,onChange:e=>ue(e.target.value),placeholder:`latest processed`})]})]}),(0,P.jsxs)(Bc,{defaultValue:`seed`,children:[(0,P.jsxs)(Vc,{children:[(0,P.jsxs)(Hc,{value:`seed`,children:[(0,P.jsx)(E,{className:`h-4 w-4`}),(0,P.jsx)(`span`,{className:`ml-2`,children:`Seed`})]}),(0,P.jsxs)(Hc,{value:`demands`,children:[(0,P.jsx)(Vt,{className:`h-4 w-4`}),(0,P.jsx)(`span`,{className:`ml-2`,children:`Demands`})]})]}),(0,P.jsxs)(Uc,{value:`seed`,className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Mode`}),(0,P.jsxs)(q,{value:a,onValueChange:o,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`mesh`,children:`Mesh (src=dst set)`}),(0,P.jsx)(Z,{value:`cross`,children:`Cross (separate src and dst sets)`})]})]})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Include groups in tag matching`}),(0,P.jsxs)(`div`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:s,onChange:e=>c(e.target.checked)}),(0,P.jsxs)(`span`,{className:`text-sm text-muted-foreground`,children:[`Match `,(0,P.jsx)(`span`,{className:`font-mono`,children:`tagParts`}),` against group names too`]})]})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Seed behavior`}),(0,P.jsx)(`div`,{className:`rounded-md border bg-muted/20 p-3 text-xs text-muted-foreground`,children:`Seeds demands from device management IPs discovered via NQE against the Forward snapshot.`})]})]}),a===`cross`?(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2 rounded-md border p-3`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Source endpoints`}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Src tag parts`}),(0,P.jsx)(K,{value:g,onChange:e=>_(e.target.value),placeholder:`core,bng`})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Src name parts`}),(0,P.jsx)(K,{value:v,onChange:e=>te(e.target.value),placeholder:`nyc,den`})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Src device types`}),(0,P.jsx)(K,{value:ne,onChange:e=>re(e.target.value),placeholder:`ROUTER,SWITCH`})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2 rounded-md border p-3`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Destination endpoints`}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Dst tag parts`}),(0,P.jsx)(K,{value:ie,onChange:e=>ae(e.target.value),placeholder:`peering,edge`})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Dst name parts`}),(0,P.jsx)(K,{value:y,onChange:e=>b(e.target.value),placeholder:`sjc,iad`})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Dst device types`}),(0,P.jsx)(K,{value:x,onChange:e=>S(e.target.value),placeholder:`ROUTER`})]})]})]}):(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Tag parts (comma-separated)`}),(0,P.jsx)(K,{value:l,onChange:e=>u(e.target.value),placeholder:`core,bng,peering`})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Name parts (comma-separated)`}),(0,P.jsx)(K,{value:d,onChange:e=>f(e.target.value),placeholder:`nyc,den`})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Device types (comma-separated)`}),(0,P.jsx)(K,{value:m,onChange:e=>h(e.target.value),placeholder:`ROUTER,SWITCH`})]})]}),(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Max devices`}),(0,P.jsx)(K,{value:oe,onChange:e=>se(e.target.value)})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Max demands`}),(0,P.jsx)(K,{value:ce,onChange:e=>le(e.target.value)})]}),(0,P.jsx)(`div`,{className:`flex items-end`,children:(0,P.jsx)(F,{disabled:!n||Ee.isPending,onClick:()=>Ee.mutate(),children:`Seed demands`})})]})]}),(0,P.jsxs)(Uc,{value:`demands`,className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-4`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Window`}),(0,P.jsxs)(q,{value:w,onValueChange:T,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`24h`,children:`24h`}),(0,P.jsx)(Z,{value:`7d`,children:`7d`}),(0,P.jsx)(Z,{value:`30d`,children:`30d`})]})]})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Threshold util (0-1)`}),(0,P.jsx)(K,{value:de,onChange:e=>fe(e.target.value)})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Max results`}),(0,P.jsx)(K,{value:xe,onChange:e=>Se(e.target.value)})]}),(0,P.jsxs)(`div`,{className:`flex items-end gap-2`,children:[(0,P.jsx)(F,{disabled:!n||De.isPending,onClick:()=>De.mutate(),children:`Evaluate`}),(0,P.jsx)(F,{variant:`secondary`,onClick:()=>me(``),children:`Clear`})]})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Demands CSV:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`from,srcIp,dstIp,ipProto,srcPort,dstPort,bandwidthGbps,label`})]}),(0,P.jsx)(`textarea`,{className:`min-h-[220px] w-full rounded-md border bg-background p-3 font-mono text-sm`,value:pe,onChange:e=>me(e.target.value),placeholder:`from,srcIp,dstIp,ipProto,srcPort,dstPort,bandwidthGbps,label\\ncore-r1,,10.0.0.1,,,,2.5,svc-a`}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2 text-sm text-muted-foreground`,children:[(0,P.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:he,onChange:e=>ge(e.target.checked)}),`Include hops`]}),(0,P.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:_e,onChange:e=>{let t=e.target.checked;ve(t),t&&ge(!0)}}),`Project load (needs bandwidthGbps; turns on hops)`]}),(0,P.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:D,onChange:e=>Ce(e.target.checked)}),`Require enforcement traversal`]}),(0,P.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:ye,onChange:e=>be(e.target.checked)}),`Include ACL/NF details (slower)`]})]})]})]})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Results`})}),(0,P.jsxs)(V,{className:`space-y-3`,children:[De.isPending?(0,P.jsx)(U,{className:`h-20 w-full`}):null,De.data?(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,P.jsxs)(W,{variant:`secondary`,children:[`Demands: `,De.data.summary.totalDemands]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Delivered: `,De.data.summary.delivered]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Timed out: `,De.data.summary.timedOut]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Missing enforcement:`,` `,De.data.summary.missingEnforcement]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Crosses threshold:`,` `,De.data.summary.crossesThreshold]})]}),(De.data.interfaceImpacts??[]).length>0?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Interface impacts`}),(0,P.jsx)(`div`,{className:`overflow-x-auto`,children:(0,P.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,P.jsx)(`thead`,{children:(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Device`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Interface`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Dir`}),(0,P.jsx)(`th`,{className:`p-2 text-right`,children:`Base p95`}),(0,P.jsx)(`th`,{className:`p-2 text-right`,children:`Added (Gbps)`}),(0,P.jsx)(`th`,{className:`p-2 text-right`,children:`Projected`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Crosses`})]})}),(0,P.jsx)(`tbody`,{children:[...De.data.interfaceImpacts??[]].sort((e,t)=>Number(t.projectedUtil??0)-Number(e.projectedUtil??0)).slice(0,50).map(e=>(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.deviceName}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.interfaceName}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.direction}),(0,P.jsx)(`td`,{className:`p-2 text-right font-mono text-xs`,children:e.baseP95Util===void 0?``:e.baseP95Util.toFixed(3)}),(0,P.jsx)(`td`,{className:`p-2 text-right font-mono text-xs`,children:e.addedGbps===void 0?``:e.addedGbps.toFixed(3)}),(0,P.jsx)(`td`,{className:`p-2 text-right font-mono text-xs`,children:e.projectedUtil===void 0?``:e.projectedUtil.toFixed(3)}),(0,P.jsx)(`td`,{className:`p-2`,children:e.crossesThreshold?(0,P.jsx)(`span`,{className:`text-amber-600`,children:`yes`}):(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:`no`})})]},`${e.deviceName}:${e.interfaceName}:${e.direction}`))})]})}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Showing top 50 by projected utilization.`})]}):null,(0,P.jsx)(`div`,{className:`overflow-x-auto`,children:(0,P.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,P.jsx)(`thead`,{children:(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`#`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Demand`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Forward`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Recommended`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Outcome`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Bottleneck`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Candidates`})]})}),(0,P.jsx)(`tbody`,{children:De.data.items.map(e=>{let t=e.candidates?.[e.recommended],n=t?.bottleneck;return(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`td`,{className:`p-2 text-muted-foreground`,children:e.index+1}),(0,P.jsxs)(`td`,{className:`p-2`,children:[(0,P.jsxs)(`div`,{className:`font-mono`,children:[String(e.demand.from??``),` ->`,` `,e.demand.dstIp]}),e.demand.bandwidthGbps===void 0?null:(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[`bw=`,e.demand.bandwidthGbps,`G`]}),e.demand.label?(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:e.demand.label}):null]}),(0,P.jsx)(`td`,{className:`p-2`,children:e.queryUrl?(0,P.jsx)(`a`,{className:`text-primary underline`,href:e.queryUrl,target:`_blank`,rel:`noreferrer noopener`,children:`query`}):(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:``})}),(0,P.jsx)(`td`,{className:`p-2`,children:e.recommended}),(0,P.jsxs)(`td`,{className:`p-2`,children:[(0,P.jsx)(`div`,{children:t?.forwardingOutcome??e.error??``}),t&&!t.enforced?(0,P.jsx)(`div`,{className:`text-amber-600`,children:`missing enforcement`}):null]}),(0,P.jsx)(`td`,{className:`p-2`,children:n?(0,P.jsxs)(`div`,{className:`font-mono`,children:[n.deviceName,`:`,n.interfaceName,` (`,n.direction,`)`,n.headroomGbps===void 0?``:` headroom=${n.headroomGbps.toFixed(2)}G`,n.crossesThreshold?` crosses`:``]}):(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:``})}),(0,P.jsx)(`td`,{className:`p-2`,children:(0,P.jsxs)(`details`,{children:[(0,P.jsx)(`summary`,{className:`cursor-pointer text-muted-foreground`,children:e.candidates?.length??0}),(0,P.jsx)(`div`,{className:`mt-2 space-y-2`,children:(e.candidates??[]).map(e=>(0,P.jsxs)(`div`,{className:`rounded-md border p-2`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center justify-between gap-2`,children:[(0,P.jsxs)(`div`,{className:`font-mono text-xs`,children:[`cand=`,e.index]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[e.enforced?`enforced`:`not enforced`,e.timedOut?`  timeout`:``]})]}),(0,P.jsxs)(`div`,{className:`mt-1 text-xs`,children:[(0,P.jsx)(`span`,{className:`font-medium`,children:`fwd:`}),` `,(0,P.jsx)(`span`,{className:`font-mono`,children:e.forwardingOutcome??``})]}),e.securityOutcome?(0,P.jsxs)(`div`,{className:`mt-1 text-xs`,children:[(0,P.jsx)(`span`,{className:`font-medium`,children:`sec:`}),` `,(0,P.jsx)(`span`,{className:`font-mono`,children:e.securityOutcome})]}):null,e.bottleneck?(0,P.jsxs)(`div`,{className:`mt-1 text-xs font-mono text-muted-foreground`,children:[e.bottleneck.deviceName,`:`,e.bottleneck.interfaceName,` (`,e.bottleneck.direction,`)`]}):null,(e.hops??[]).length?(0,P.jsxs)(`div`,{className:`mt-1 text-xs text-muted-foreground`,children:[`hops=`,e.hops?.length??0]}):null]},e.index))})]})})]},e.index)})})]})})]}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Seed demands and evaluate to see ranked path candidates.`})]})]})]})}function Xd(e,t,n){return Math.max(t,Math.min(n,e))}function Zd({points:e,className:t,strokeClassName:n=`stroke-foreground`,fillClassName:r=`fill-muted/30`}){let{path:i,area:a}=(0,M.useMemo)(()=>{if(!e.length)return{path:``,area:``};let t=e.map(e=>e.y).filter(e=>Number.isFinite(e)),n=t.length?Math.min(...t):0,r=(t.length?Math.max(...t):1)-n||1,i=e.map((t,i)=>({x:e.length<=1?0:i/(e.length-1)*100,y:Xd(40-(t.y-n)/r*40,0,40)})).map((e,t)=>`${t===0?`M`:`L`} ${e.x.toFixed(2)} ${e.y.toFixed(2)}`).join(` `);return{path:i,area:`${i} L 100 40 L 0 40 Z`}},[e]);return e.length?(0,P.jsxs)(`svg`,{viewBox:`0 0 100 40`,preserveAspectRatio:`none`,className:N(`h-24 w-full rounded-md border bg-background`,t),role:`img`,"aria-label":`Trend chart`,children:[(0,P.jsx)(`title`,{children:`Trend chart`}),(0,P.jsx)(`path`,{d:a,className:N(r)}),(0,P.jsx)(`path`,{d:i,className:N(`fill-none stroke-[1.25]`,n),vectorEffect:`non-scaling-stroke`})]}):(0,P.jsx)(`div`,{className:N(`flex h-24 items-center justify-center rounded-md border text-xs text-muted-foreground`,t),children:`No data`})}var Qd=Qn({workspace:qn().optional().catch(``),embed:qn().optional().catch(``)});const $d=t(`/dashboard/forward-networks/$networkRef/capacity`)({validateSearch:e=>Qd.parse(e),component:bf});function ef(e){try{return JSON.stringify(e,null,2)}catch{return String(e)}}function tf(e,t,n){let r=new Blob([n],{type:t}),i=URL.createObjectURL(r);try{let t=document.createElement(`a`);t.href=i,t.download=e,t.click()}finally{URL.revokeObjectURL(i)}}async function nf(e){try{if(typeof navigator<`u`&&navigator.clipboard&&typeof navigator.clipboard.writeText==`function`)return await navigator.clipboard.writeText(e),!0}catch{}return!1}function rf(){try{let e=globalThis.crypto;if(e&&typeof e.randomUUID==`function`)return e.randomUUID()}catch{}return`id_${Date.now()}_${Math.floor(Math.random()*1e9)}`}function af(e){let t=e==null?``:String(e);return t.includes(`"`)||t.includes(`,`)||t.includes(`
`)||t.includes(`\r`)?`"${t.replaceAll(`"`,`""`)}"`:t}function of(e,t){let n=[e.map(af).join(`,`)];for(let e of t)n.push(e.map(af).join(`,`));return n.join(`
`)+`
`}function sf(e){let t=Number(e??NaN);return Number.isFinite(t)?t===6?`tcp`:t===17?`udp`:t===1?`icmp`:String(t):``}function cf(e){if(!e)return null;let t=Date.parse(e);return Number.isFinite(t)?new Date(t):null}function lf(e){return e===void 0||!Number.isFinite(e)?``:`${(e*100).toFixed(1)}%`}function uf(e,t=3){return e===void 0||!Number.isFinite(e)?``:e.toFixed(t)}function df(e){let t=Number(e??0);return!Number.isFinite(t)||t<=0?``:t>=1e5||t>=1e4?`${(t/1e3).toFixed(0)}G`:t>=1e3?`${(t/1e3).toFixed(1)}G`:`${t}M`}function ff(e,t){if(!e.length)return null;let n=[...e].filter(e=>Number.isFinite(e)).sort((e,t)=>e-t);if(!n.length)return null;if(t<=0)return n[0];if(t>=1)return n[n.length-1];let r=t*(n.length-1),i=Math.floor(r),a=Math.ceil(r);if(i===a)return n[i];let o=r-i;return n[i]*(1-o)+n[a]*o}function pf(e){let t=String(e??``).trim().toLowerCase();if(!t)return``;t=t.replaceAll(` `,``);for(let[e,n]of[[`port-channel`,`po`],[`portchannel`,`po`],[`bundle-ether`,`be`],[`bundleether`,`be`],[`gigabitethernet`,`gi`],[`tengigabitethernet`,`te`],[`twentyfivegigabitethernet`,`twe`],[`fortygigabitethernet`,`fo`],[`hundredgigabitethernet`,`hu`],[`tengige`,`te`],[`twentyfivegige`,`twe`],[`fortygige`,`fo`],[`hundredgige`,`hu`],[`twohundredgige`,`twohu`],[`fourhundredgige`,`fourhu`],[`managementethernet`,`mgmt`],[`mgmtethernet`,`mgmt`],[`management`,`mgmt`],[`fastethernet`,`fa`],[`ethernet`,`eth`],[`loopback`,`lo`],[`vlan`,`vl`]])if(t.startsWith(e)){t=n+t.slice(e.length);break}return t.endsWith(`.0`)&&(t=t.slice(0,-2)),t}function mf(e){return e.startsWith(`util_`)?`UTILIZATION`:e.includes(`packet_loss`)?`PACKET_LOSS`:`ERROR`}function hf(e){return e.includes(`memory`)?`MEMORY`:`CPU`}function gf(e){let t=String(e??``).trim();if(!t)return{queries:[],error:`Enter at least one flow or JSON payload.`};if(t.startsWith(`{`)||t.startsWith(`[`))try{let e=JSON.parse(t);return Array.isArray(e)?{queries:e.filter(e=>String(e?.dstIp??``).trim())}:e&&Array.isArray(e.queries)?{queries:e.queries.filter(e=>String(e?.dstIp??``).trim())}:{queries:[],error:`JSON must be an array of queries or an object with { queries: [...] }.`}}catch(e){return{queries:[],error:e instanceof Error?`Invalid JSON: ${e.message}`:`Invalid JSON.`}}let n=[];for(let e of t.split(/\r?\n/g)){let t=e.trim();if(!t||t.startsWith(`#`))continue;let r=t.replaceAll(`	`,` `).replaceAll(`->`,` `),i=(r.includes(`,`)&&!r.includes(` `)?r.split(`,`):r.replaceAll(`,`,` `).split(/\s+/g)).map(e=>e.trim()).filter(Boolean);if(!i.length)continue;let a=e=>{let t=String(e??``).trim(),n=t.match(/^([^:]+):([^:]+)$/);return n?{host:n[1],port:n[2]}:{host:t}};if(i.length===1){let e=a(i[0]),t={dstIp:e.host};e.port&&(t.dstPort=e.port),n.push(t);continue}let o=null,s=null,c=i[0],l=i[1];c===`-`||c===`*`||c.toLowerCase()===`any`||(o=a(c)),s=a(l);let u,d=s?.port,f=o?.port;(e=>{let t=String(e??``).trim().toLowerCase();if(t){if(t.includes(`/`)){let[e,n]=t.split(`/`,2);e===`tcp`?u=6:e===`udp`?u=17:e===`icmp`?u=1:/^\d+$/.test(e)&&(u=Number(e)),n&&(d=n);return}t===`tcp`?u=6:t===`udp`?u=17:t===`icmp`?u=1:/^\d+$/.test(t)?u=Number(t):/^\d+(-\d+)?$/.test(t)&&(d=t)}})(i[2]??``),i[3]&&(d=String(i[3]).trim()||d);let p={dstIp:s?.host??``};o?.host&&(p.srcIp=o.host),f&&(p.srcPort=f),u!==void 0&&Number.isFinite(u)&&(p.ipProto=u),d&&(p.dstPort=d),String(p.dstIp??``).trim()&&n.push(p)}return n.length?{queries:n}:{queries:[],error:`No valid flows parsed. Try JSON or lines like: 10.0.0.1 10.0.0.2 tcp 443`}}function _f(e,t){return`skyforge:capacity:path-batches:${encodeURIComponent(e)}:${encodeURIComponent(t)}`}function vf(e,t){try{let n=localStorage.getItem(_f(e,t));if(!n)return[];let r=JSON.parse(n);return Array.isArray(r)?r.map(e=>({id:String(e?.id??``).trim(),name:String(e?.name??``).trim(),text:String(e?.text??``),createdAt:String(e?.createdAt??``).trim()})).filter(e=>e.id&&e.name&&e.text):[]}catch{return[]}}function yf(e,t,n){try{localStorage.setItem(_f(e,t),JSON.stringify(n))}catch{}}function bf(){let{networkRef:e}=$d.useParams(),{workspace:t,embed:n}=$d.useSearch(),a=String(n??``).trim()===`1`||String(n??``).trim().toLowerCase()===`true`,o=c(),[s,l]=(0,M.useState)(`24h`),[u,d]=(0,M.useState)(`util_ingress`),[f,m]=(0,M.useState)(`device_cpu`),[h,g]=(0,M.useState)(``),[_,v]=(0,M.useState)(``),[te,ne]=(0,M.useState)(`all`),[re,ie]=(0,M.useState)(`all`),[ae,y]=(0,M.useState)(`all`),[b,x]=(0,M.useState)(`all`),[S,oe]=(0,M.useState)(`none`),[se,ce]=(0,M.useState)(168),[le,C]=(0,M.useState)(`util_ingress`),[ue,w]=(0,M.useState)(`device_cpu`),[T,de]=(0,M.useState)(null),[fe,E]=(0,M.useState)(null),[pe,me]=(0,M.useState)(null),[he,ge]=(0,M.useState)(!1),[_e,ve]=(0,M.useState)(``),[ye,be]=(0,M.useState)(!1),[xe,Se]=(0,M.useState)(``),[D,Ce]=(0,M.useState)(`all`),[we,Te]=(0,M.useState)(`all`),[Ee,De]=(0,M.useState)(!1),[Oe,ke]=(0,M.useState)(``),[Ae,je]=(0,M.useState)(``),[Me,O]=(0,M.useState)(!1),[Ne,Pe]=(0,M.useState)(null),[Fe,Ie]=(0,M.useState)(``),[Le,Re]=(0,M.useState)(``),[ze,Be]=(0,M.useState)(!1),[Ve,He]=(0,M.useState)(!1),[Ue,We]=(0,M.useState)(null),[Ge,Ke]=(0,M.useState)(``),[qe,Je]=(0,M.useState)([]),[Ye,Xe]=(0,M.useState)(!1),[Ze,Qe]=(0,M.useState)(null),[$e,et]=(0,M.useState)(!1),[tt,nt]=(0,M.useState)(!1),[rt,it]=(0,M.useState)(!1),[at,ot]=(0,M.useState)(null),[st,ct]=(0,M.useState)(!1),[lt,ut]=(0,M.useState)(null),[dt,ft]=(0,M.useState)([]),k=String(t??``).trim();(0,M.useEffect)(()=>{!k||!e||Je(vf(k,e))},[k,e]);let pt=i({queryKey:H.workspaceForwardNetworks(k),queryFn:()=>Uo(k),enabled:!!k,retry:!1,staleTime:3e4}),mt=(0,M.useMemo)(()=>{let t=(pt.data?.networks??[]).find(t=>String(t?.id??``)===String(e));return String(t?.name??``)},[pt.data?.networks,e]),ht=i({queryKey:H.forwardNetworkCapacitySummary(k,e),queryFn:()=>Xi(k,e),enabled:!!(k&&e),retry:!1,staleTime:3e4}),A=i({queryKey:H.forwardNetworkCapacityInventory(k,e),queryFn:()=>sa(k,e),enabled:!!(k&&e),retry:!1,staleTime:3e4}),gt=i({queryKey:H.forwardNetworkCapacityCoverage(k,e),queryFn:()=>na(k,e),enabled:!!(k&&e),retry:!1,staleTime:3e4}),_t=i({queryKey:H.forwardNetworkCapacitySnapshotDelta(k,e),queryFn:()=>ra(k,e),enabled:!!(k&&e),retry:!1,staleTime:3e4}),vt=i({queryKey:H.forwardNetworkCapacityUpgradeCandidates(k,e,s),queryFn:()=>ia(k,e,{window:s}),enabled:!!(k&&e),retry:!1,staleTime:3e4}),yt=String(ht.data?.forwardNetworkId??A.data?.forwardNetworkId??``),bt=(0,M.useMemo)(()=>{let e=new Map;for(let t of A.data?.interfaces??[]){let n=String(t.deviceName??``).trim(),r=String(t.interfaceName??``).trim();if(!n||!r)continue;let i=String(t.aggregateId??``).trim(),a=String(t.interfaceType??``).trim();e.set(`${n}|${r}`,{aggregateId:i||void 0,interfaceType:a||void 0})}return e},[A.data?.interfaces]),xt=(0,M.useMemo)(()=>{let e=A.data?.interfaces??[],t=ht.data?.rollups??[],n=new Map;for(let t of e){let e=String(t.deviceName??``).trim(),r=String(t.interfaceName??``).trim();if(!e||!r)continue;let i=Number(t.speedMbps??0);i>0&&n.set(`${e}|${r}`,i)}let r=new Map,i=(e,t,n)=>{let i=String(e??``).trim(),a=String(t??``).trim(),o=String(n??``).trim();if(!i||!a||!o)return;let s=`${i}|${a}`,c=r.get(s)??{deviceName:i,lagName:a,members:new Set};c.members.add(o),r.set(s,c)};for(let t of e){let e=String(t.deviceName??``).trim(),n=String(t.interfaceName??``).trim();if(!e||!n)continue;let r=String(t.aggregateId??``).trim();r&&i(e,r,n);let a=(t.aggregationConfiguredMemberNames?.length?t.aggregationConfiguredMemberNames:t.aggregationMemberNames)??[];for(let t of a)i(e,n,String(t??``).trim())}let a=new Map;for(let e of t){if(String(e?.objectType??``)!==`interface`||String(e?.window??``)!==s)continue;let t=String(e?.metric??``);if(t!==`util_ingress`&&t!==`util_egress`)continue;let r=e?.details??{},i=String(r?.deviceName??``).trim(),o=String(r?.interfaceName??``).trim(),c=String(r?.direction??``).trim();if(!i||!o){let t=String(e?.objectId??``).split(`:`);i=String(t[0]??``).trim(),o=String(t[1]??``).trim(),c||=String(t[2]??``).trim()}if(!i||!o)continue;let l=`${i}|${o}`,u=Number(e?.max??0),d=Number(e?.p95??0),f=Number(r?.speedMbps??0)||n.get(l),p=String(e?.forecastCrossingTs??``).trim(),m=String(c||(t===`util_egress`?`EGRESS`:`INGRESS`)).toUpperCase().trim()||``,h=a.get(l);(!h||u>h.maxUtil)&&a.set(l,{maxUtil:u,p95Util:d,worstDirection:m,speedMbps:f||void 0,forecast:p||void 0})}let o=[];for(let e of r.values()){let t=Array.from(e.members).filter(Boolean).sort();if(t.length<2)continue;let r=t.map(t=>{let r=`${e.deviceName}|${t}`,i=a.get(r);return{interfaceName:t,speedMbps:n.get(r)||i?.speedMbps,worstDirection:i?.worstDirection,p95Util:i?.p95Util,maxUtil:i?.maxUtil,forecast:i?.forecast}}),i=r.map(e=>Number(e.maxUtil??0)).filter(e=>Number.isFinite(e));if(!i.length)continue;let s=Math.max(...i),c=[...i].sort((e,t)=>e-t),l=s-c[Math.floor(c.length/2)],u=r.filter(e=>Number(e.maxUtil??0)>=.85).length,d=``;for(let e of r){let t=String(e.forecast??``).trim();t&&(!d||t<d)&&(d=t)}let f=r.reduce((e,t)=>e+Number(t.speedMbps??0),0);(s>=.85||l>=.25)&&o.push({id:`${e.deviceName}|${e.lagName}`,deviceName:e.deviceName,lagName:e.lagName,memberCount:t.length,totalSpeedMbps:f||void 0,worstMemberMaxUtil:s,spread:l,hotMembers:u,soonestForecast:d||void 0,members:r})}return o.sort((e,t)=>{let n=Number(e.worstMemberMaxUtil??0),r=Number(t.worstMemberMaxUtil??0);if(n!==r)return r-n;let i=Number(e.spread??0),a=Number(t.spread??0);return i===a?e.deviceName===t.deviceName?e.lagName.localeCompare(t.lagName):e.deviceName.localeCompare(t.deviceName):a-i}),o.slice(0,50)},[A.data?.interfaces,ht.data?.rollups,s]),St=r({mutationFn:async()=>{if(!k)throw Error(`workspace not found`);return Zi(k,e)},onSuccess:async t=>{j.success(`Refresh queued`,{description:`Run ${String(t.run?.id??``)}`.trim()}),await o.invalidateQueries({queryKey:H.forwardNetworkCapacitySummary(k,e)}),await o.invalidateQueries({queryKey:H.forwardNetworkCapacityInventory(k,e)}),await o.invalidateQueries({queryKey:H.forwardNetworkCapacityCoverage(k,e)}),await o.invalidateQueries({queryKey:H.forwardNetworkCapacitySnapshotDelta(k,e)}),await o.invalidateQueries({queryKey:[`forwardNetworkCapacityUpgradeCandidates`,k,e]}),await o.invalidateQueries({queryKey:H.workspaceForwardNetworkCapacityPortfolio(k)}),await o.invalidateQueries({queryKey:[`forwardNetworkCapacityGrowth`,k,e]})},onError:e=>j.error(`Failed to refresh`,{description:e.message})}),Ct=r({mutationFn:async()=>ha(k,e,{}),onSuccess:e=>me(e.body),onError:e=>j.error(`Failed to load unhealthy devices`,{description:e.message})}),wt=r({mutationFn:async t=>{if(!k)throw Error(`workspace not found`);return ga(k,e,t)},onSuccess:e=>We(e),onError:e=>j.error(`Failed to compute paths`,{description:e.message})}),Tt=(0,M.useMemo)(()=>{let e=A.data?.devices??[],t=A.data?.interfaceVrfs??[],n=new Set,r=new Set,i=new Set,a=new Set;for(let t of e){for(let e of t.tagNames??[]){let t=String(e??``).trim();t&&n.add(t)}for(let e of t.groupNames??[]){let t=String(e??``).trim();t&&r.add(t)}let e=String(t.locationName??``).trim();e&&i.add(e)}for(let e of t){let t=String(e.vrf??``).trim();t&&a.add(t)}return{tags:Array.from(n).sort(),groups:Array.from(r).sort(),locations:Array.from(i).sort(),vrfs:Array.from(a).sort()}},[A.data?.devices,A.data?.interfaceVrfs]),Et=s===`24h`?1:s===`7d`?7:30,Dt=ht.data?.rollups??[],kt=(0,M.useMemo)(()=>gf(Fe),[Fe]),At=(0,M.useMemo)(()=>{if(kt.error||!kt.queries.length)return``;let e=Le.trim(),t={queries:kt.queries,intent:`PREFER_DELIVERED`,maxCandidates:5e3,maxResults:1,maxReturnPathResults:0,maxSeconds:30,maxOverallSeconds:300,includeTags:!1,includeNetworkFunctions:!1};return ef({method:`POST`,path:`/networks/${yt||`{networkId}`}/paths-bulk`,query:e?{snapshotId:e}:{},body:t})},[kt.error,kt.queries,Le,yt]),jt=(0,M.useMemo)(()=>{let e=Ue?.items??[],t=new Map;for(let n of e){let e=n?.bottleneck??null;if(!e)continue;let r=`${String(e.deviceName??``)}|${String(e.interfaceName??``)}|${String(e.direction??``)}`,i=t.get(r)??{id:r,deviceName:String(e.deviceName??``),interfaceName:String(e.interfaceName??``),direction:String(e.direction??``),count:0};i.count+=1;let a=Number(e.headroomGbps??NaN);Number.isFinite(a)&&(i.minHeadroomGbps===void 0?i.minHeadroomGbps=a:i.minHeadroomGbps=Math.min(i.minHeadroomGbps,a));let o=Number(e.headroomUtil??NaN);Number.isFinite(o)&&(i.minHeadroomUtil===void 0?i.minHeadroomUtil=o:i.minHeadroomUtil=Math.min(i.minHeadroomUtil,o));let s=Number(e.maxUtil??NaN);Number.isFinite(s)&&(i.worstMaxUtil===void 0?i.worstMaxUtil=s:i.worstMaxUtil=Math.max(i.worstMaxUtil,s));let c=String(e.forecastCrossingTs??``).trim();c&&(i.soonestForecast?Date.parse(c)<Date.parse(i.soonestForecast)&&(i.soonestForecast=c):i.soonestForecast=c),t.set(r,i)}let n=Array.from(t.values());return n.sort((e,t)=>{if(e.count!==t.count)return t.count-e.count;let n=e.minHeadroomGbps??1/0,r=t.minHeadroomGbps??1/0;if(n!==r)return n-r;let i=e.minHeadroomUtil??1/0,a=t.minHeadroomUtil??1/0;return i===a?e.id.localeCompare(t.id):i-a}),n},[Ue?.items]),Mt=(0,M.useMemo)(()=>{let e=vt.data?.items??[];if(!jt.length||!e.length)return[];let t=new Map;for(let n of e){let e=String(n.device??``).trim(),r=String(n.name??``).trim(),i=String(n.worstDirection??``).trim().toUpperCase();if(!e||!r)continue;let a=`${e.toLowerCase()}|${pf(r)}|${i}`;t.has(a)||t.set(a,n)}let n=[];for(let e of jt){let r=String(e.deviceName??``).trim(),i=String(e.interfaceName??``).trim(),a=String(e.direction??``).trim().toUpperCase();if(!r||!i)continue;let o=`${r.toLowerCase()}|${pf(i)}|${a}`,s=t.get(o);s&&n.push({id:o,deviceName:r,interfaceName:i,direction:a||String(s.worstDirection??``).trim(),flows:e.count,minHeadroomGbps:e.minHeadroomGbps,minHeadroomUtil:e.minHeadroomUtil,recommendedSpeedMbps:s.recommendedSpeedMbps??null,requiredSpeedMbps:s.requiredSpeedMbps??null,reason:String(s.reason??``).trim()||void 0})}return n.sort((e,t)=>{if(e.flows!==t.flows)return t.flows-e.flows;let n=e.minHeadroomGbps??1/0,r=t.minHeadroomGbps??1/0;if(n!==r)return n-r;let i=e.minHeadroomUtil??1/0,a=t.minHeadroomUtil??1/0;return i===a?e.id.localeCompare(t.id):i-a}),n},[jt,vt.data?.items]);(0,M.useEffect)(()=>{dt.length||Mt.length&&ft(Mt.slice(0,3).map(e=>e.id))},[Mt.length]);let Nt=(0,M.useMemo)(()=>{let e=Ue?.items??[],t=new Set(dt),n=new Map;for(let e of Mt)n.set(e.id,e);let r=[],i=0,a=0,o=0,s=0,c=0,l=0;for(let u of e){let e=u.bottleneck??null,d=e?.headroomGbps??null,f=e?.headroomUtil??null,p={index:u.index,beforeHeadroomGbps:d,beforeHeadroomUtil:f,afterHeadroomGbps:d,afterHeadroomUtil:f};e&&(i+=1);let m=Number(f??NaN);if(Number.isFinite(m)&&m<0&&(s+=1),!e){r.push(p);continue}let h=`${String(e.deviceName??``).trim().toLowerCase()}|${pf(String(e.interfaceName??``))}|${String(e.direction??``).trim().toUpperCase()}`;if(!t.has(h)){r.push(p);let e=Number(p.afterHeadroomUtil??NaN);Number.isFinite(e)&&e<0&&(c+=1);continue}let g=n.get(h),ee=Number(g?.recommendedSpeedMbps??g?.requiredSpeedMbps??NaN),_=Number(e?.threshold??.85),v=Number(e?.speedMbps??NaN),te=Number(e?.p95Gbps??NaN),ne=Number(e?.p95Util??NaN);if(!Number.isFinite(ee)||ee<=0){p.reason=`upgrade missing recommended speed`,o+=1,r.push(p);let e=Number(p.afterHeadroomUtil??NaN);Number.isFinite(e)&&e<0&&(c+=1);continue}let re=NaN;if(Number.isFinite(te)?re=te:Number.isFinite(ne)&&Number.isFinite(v)&&v>0&&(re=ne*v/1e3),!Number.isFinite(re)){p.reason=`missing speed/util (cannot estimate traffic)`,o+=1,r.push(p);let e=Number(p.afterHeadroomUtil??NaN);Number.isFinite(e)&&e<0&&(c+=1);continue}let ie=ee/1e3,ae=_-(ie>0?re/ie:NaN),y=_*ie-re;p.afterHeadroomUtil=Number.isFinite(ae)?ae:p.afterHeadroomUtil,p.afterHeadroomGbps=Number.isFinite(y)?y:p.afterHeadroomGbps,p.appliedUpgradeId=h,p.appliedSpeedMbps=ee,p.reason=`simulated using constant traffic (p95)`,a+=1;let b=Number(p.afterHeadroomUtil??NaN);Number.isFinite(b)&&b<0&&(c+=1);let x=Number(f??NaN);Number.isFinite(x)&&Number.isFinite(b)&&b>x&&(l+=1),r.push(p)}return{summary:{totalFlows:e.length,withBottleneck:i,simulated:a,cannotSimulate:o,atRiskBefore:s,atRiskAfter:c,improved:l},items:r}},[Ue?.items,dt,Mt]),Pt=(0,M.useMemo)(()=>{if(!Ue)return``;let t=[],n=mt?`${mt} (${e})`:e;if(t.push(`# Capacity Memo (Art of the Possible)`),t.push(``),t.push(`- Network: \`${n}\``),t.push(`- Forward Network ID: \`${yt||``}\``),t.push(`- Window: \`${s}\``),t.push(`- Paths snapshot: \`${Ue.snapshotId||`latest`}\``),t.push(`- Rollups as-of: \`${ht.data?.asOf??``}\`${ht.data?.stale?` (stale)`:``}`),t.push(`- Inventory as-of: \`${A.data?.asOf??``}\``),t.push(``),t.push(`## Guardrails / Non-Goals`),t.push(``),t.push(`- This is capacity-only. No alerting/on-call, no ticketing, no event correlation.`),t.push(`- This does not replicate Forward path workflows; each flow links back to Forward for deeper analysis.`),t.push(``),t.push(`## Coverage`),t.push(``),Ue.coverage){let e=Ue.coverage;if(t.push(`- hop-keys: ${e.hopInterfaceKeys}`),t.push(`- rollup matched: ${e.rollupMatched}`),t.push(`- perf fallback used: ${e.perfFallbackUsed}`),t.push(`- unknown: ${e.unknown}`),t.push(`- fallback truncated: ${e.truncated?`yes`:`no`}`),t.push(``),(e.unmatchedHopInterfacesSample??[]).length){t.push(`Unmatched hop interfaces (sample):`),t.push("```");for(let n of e.unmatchedHopInterfacesSample??[])t.push(String(n));t.push("```"),t.push(``)}}else t.push(`- (no coverage data)`),t.push(``);t.push(`## Top Bottlenecks (Batch)`),t.push(``),t.push(`| device | interface | dir | flows | min headroom | soonest forecast |`),t.push(`|---|---|---:|---:|---:|---:|`);for(let e of jt.slice(0,20)){let n=e.minHeadroomGbps===void 0?e.minHeadroomUtil===void 0?``:`${lf(Number(e.minHeadroomUtil))} util`:`${Number(e.minHeadroomGbps).toFixed(2)}G`;t.push(`| \`${e.deviceName}\` | \`${e.interfaceName}\` | \`${e.direction}\` | ${e.count} | ${n} | \`${(e.soonestForecast??``).slice(0,10)||``}\` |`)}if(t.push(``),Mt.length){t.push(`## Implied Upgrades (From This Batch)`),t.push(``),t.push(`| device | interface | dir | flows | rec | reason |`),t.push(`|---|---|---:|---:|---:|---|`);for(let e of Mt.slice(0,10))t.push(`| \`${e.deviceName}\` | \`${e.interfaceName}\` | \`${e.direction}\` | ${e.flows} | \`${df(e.recommendedSpeedMbps)}\` | ${e.reason?`\`${e.reason}\``:``} |`);t.push(``)}return t.push(`## Notes`),t.push(``),t.push(`- Forward paths are computed against a (possibly older) snapshot; perf/rollups are time-windowed and may reflect more recent utilization.`),t.push(`- Unknown coverage usually indicates missing rollups and/or missing perf for hop interfaces; use Coverage details to see samples.`),t.push(``),t.join(`
`)},[Ue,jt,Mt,mt,e,yt,s,ht.data?.asOf,ht.data?.stale,A.data?.asOf]),Ft=(0,M.useMemo)(()=>{let e=h.trim().toLowerCase(),t=Dt.filter(e=>e.objectType===`interface`&&e.window===s&&e.metric===u).map(e=>{let t=e.details??{},n=String(t.deviceName??``).trim(),r=String(t.interfaceName??``).trim(),i=String(t.direction??``).trim(),a=String(t.vrf??``).trim()||void 0,o=Array.isArray(t.vrfNames)?t.vrfNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,s=String(t.locationName??``).trim()||void 0,c=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,l=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,u=bt.get(`${n}|${r}`),d=u?.aggregateId,f=u?.interfaceType===`IF_AGGREGATE`;return{id:`${n}:${r}:${i}:${e.metric}:${e.window}`,device:n,iface:r,dir:i,aggregateId:d,isAggregate:f,vrf:a,vrfNames:o,locationName:s,tagNames:c,groupNames:l,speedMbps:t.speedMbps??null,admin:String(t.adminStatus??``).trim()||void 0,oper:String(t.operStatus??``).trim()||void 0,p95:e.p95,p99:e.p99,max:e.max,slopePerDay:e.slopePerDay,forecastCrossingTs:e.forecastCrossingTs,threshold:e.threshold,samples:e.samples,raw:e}}),n=(e?t.filter(t=>t.device.toLowerCase().includes(e)||t.iface.toLowerCase().includes(e)||(t.dir||``).toLowerCase().includes(e)):t).filter(e=>{if(ae!==`all`&&(e.locationName??``)!==ae)return!1;if(b!==`all`){let t=b;if(e.vrf!==t&&!(e.vrfNames??[]).includes(t))return!1}return!(te!==`all`&&!(e.tagNames??[]).includes(te)||re!==`all`&&!(e.groupNames??[]).includes(re))});return n.sort((e,t)=>(t.max??0)-(e.max??0)),n},[Dt,s,u,h,ae,b,te,re]),It=(0,M.useMemo)(()=>{let e=_.trim().toLowerCase(),t=Dt.filter(e=>e.objectType===`device`&&e.window===s&&e.metric===f).map(e=>{let t=e.details??{},n=String(t.deviceName??``).trim(),r=String(t.locationName??``).trim()||void 0,i=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,a=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0;return{id:`${n}:${e.metric}:${e.window}`,device:n,metric:e.metric,locationName:r,tagNames:i,groupNames:a,vendor:String(t.vendor??``).trim()||void 0,os:String(t.os??``).trim()||void 0,model:String(t.model??``).trim()||void 0,p95:e.p95,p99:e.p99,max:e.max,slopePerDay:e.slopePerDay,forecastCrossingTs:e.forecastCrossingTs,threshold:e.threshold,samples:e.samples,raw:e}}),n=(e?t.filter(t=>t.device.toLowerCase().includes(e)||(t.vendor||``).toLowerCase().includes(e)||(t.os||``).toLowerCase().includes(e)||(t.model||``).toLowerCase().includes(e)):t).filter(e=>!(ae!==`all`&&(e.locationName??``)!==ae||te!==`all`&&!(e.tagNames??[]).includes(te)||re!==`all`&&!(e.groupNames??[]).includes(re)));return n.sort((e,t)=>(t.max??0)-(e.max??0)),n},[Dt,s,f,_,ae,te,re]),Lt=(0,M.useMemo)(()=>{if(S===`none`)return[];let e=new Map,t=new Map,n=(n,r)=>{let i=e.get(n)??{group:n,count:0,hotCount:0,sumSpeedGbps:0,sumP95Gbps:0,sumMaxGbps:0,p95Count:0};i.count+=1,t.has(n)||t.set(n,new Set),t.get(n).add(r.device);let a=r.max??0,o=r.p95??void 0;if(i.maxMax=Math.max(i.maxMax??0,a),o!==void 0&&(i.maxP95=Math.max(i.maxP95??0,o),u.startsWith(`util_`))){let e=Number(r.speedMbps??0);if(e>0){let t=o*e/1e3;i.maxP95Gbps=Math.max(i.maxP95Gbps??0,t)}}if(u.startsWith(`util_`)){let e=Number(r.speedMbps??0);if(e>0&&(i.sumSpeedGbps=(i.sumSpeedGbps??0)+e/1e3,o!==void 0&&Number.isFinite(o)&&(i.sumP95Gbps=(i.sumP95Gbps??0)+o*e/1e3,i.p95Count=(i.p95Count??0)+1),r.max!==void 0&&r.max!==null&&Number.isFinite(r.max)&&(i.sumMaxGbps=(i.sumMaxGbps??0)+Number(r.max)*e/1e3)),r.forecastCrossingTs){let e=r.forecastCrossingTs;i.soonestForecast?Date.parse(e)<Date.parse(i.soonestForecast)&&(i.soonestForecast=e):i.soonestForecast=e}}u.startsWith(`util_`)&&a>=(r.threshold??.85)&&(i.hotCount+=1),e.set(n,i)};for(let e of Ft)if(S===`location`)n(e.locationName??`unknown`,e);else if(S===`tag`){let t=e.tagNames?.length?e.tagNames:[`untagged`];for(let r of t)n(r,e)}else if(S===`group`){let t=e.groupNames?.length?e.groupNames:[`ungrouped`];for(let r of t)n(r,e)}else S===`vrf`&&n(e.vrf??e.vrfNames?.[0]??`unknown`,e);let r=Array.from(e.values());if(S===`vrf`){let e=A.data?.routeScale??[],n=A.data?.bgpNeighbors??[];for(let i of r){let r=t.get(i.group)??new Set,a=0,o=0,s=0,c=0;for(let t of e)t.vrf===i.group&&r.has(t.deviceName)&&(a+=Number(t.ipv4Routes??0),o+=Number(t.ipv6Routes??0));for(let e of n)e.vrf===i.group&&r.has(e.deviceName)&&(s+=1,String(e.sessionState??``).toUpperCase().includes(`ESTABLISHED`)&&(c+=1));i.ipv4RoutesSum=a,i.ipv6RoutesSum=o,i.bgpNeighbors=s,i.bgpEstablished=c}}return r.sort((e,t)=>(t.maxP95Gbps??t.maxP95??0)-(e.maxP95Gbps??e.maxP95??0)),r},[Ft,S,u,A.data?.routeScale,A.data?.bgpNeighbors]),Rt=(0,M.useMemo)(()=>{if(S===`none`)return[];let e=new Map,t=(t,n)=>{let r=e.get(t)??{group:t,count:0,hotCount:0};r.count+=1;let i=n.max??0,a=n.p95??void 0;r.maxMax=Math.max(r.maxMax??0,i),a!==void 0&&(r.maxP95=Math.max(r.maxP95??0,a)),i>=(n.threshold??.85)&&(r.hotCount+=1),e.set(t,r)};for(let e of It)if(S===`location`)t(e.locationName??`unknown`,e);else if(S===`tag`){let n=e.tagNames?.length?e.tagNames:[`untagged`];for(let r of n)t(r,e)}else if(S===`group`){let n=e.groupNames?.length?e.groupNames:[`ungrouped`];for(let r of n)t(r,e)}let n=Array.from(e.values());return n.sort((e,t)=>(t.maxP95??0)-(e.maxP95??0)),n},[It,S]),zt=(0,M.useMemo)(()=>{let e=Dt.filter(e=>e.metric.startsWith(`util_`));return{above:e.filter(e=>(e.max??0)>=.85).length,soonest:e.map(e=>({ts:e.forecastCrossingTs??``,r:e})).filter(e=>e.ts).sort((e,t)=>Date.parse(e.ts)-Date.parse(t.ts))[0]?.r}},[Dt]),Bt=i({queryKey:[`capacityIfaceHistory`,k,e,s,u,T?.id??``],queryFn:async()=>T?(await da(k,e,{type:mf(u),days:Et,maxSamples:400,interfaces:[{deviceName:T.device,interfaceName:T.iface,direction:T.dir}]})).body:null,enabled:!!(T&&k&&yt),retry:!1,staleTime:1e4}),Vt=i({queryKey:[`capacityDeviceHistory`,k,e,s,f,fe?.id??``],queryFn:async()=>fe?(await pa(k,e,{type:hf(f),days:Et,maxSamples:400,devices:[fe.device]})).body:null,enabled:!!(fe&&k&&yt),retry:!1,staleTime:1e4}),Ht=(0,M.useMemo)(()=>{let e=Bt.data?.metrics?.[0];return(Array.isArray(e?.data)?e.data:[]).map(e=>({x:String(e?.instant??``),y:Number(e?.value??NaN)})).filter(e=>e.x&&Number.isFinite(e.y))},[Bt.data]),Ut=(0,M.useMemo)(()=>{let e=Vt.data?.metrics?.[0];return(Array.isArray(e?.data)?e.data:[]).map(e=>({x:String(e?.instant??``),y:Number(e?.value??NaN)})).filter(e=>e.x&&Number.isFinite(e.y))},[Vt.data]),Wt=(0,M.useMemo)(()=>{let e=Ht.map(e=>e.y);return{p95:ff(e,.95),p99:ff(e,.99),max:e.length?Math.max(...e):null}},[Ht]),Gt=(0,M.useMemo)(()=>{let e=Ut.map(e=>e.y);return{p95:ff(e,.95),p99:ff(e,.99),max:e.length?Math.max(...e):null}},[Ut]),Kt=(0,M.useMemo)(()=>[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:200},{id:`iface`,header:`Interface`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.iface}),width:220},{id:`lag`,header:`LAG`,cell:e=>e.isAggregate?(0,P.jsx)(W,{variant:`secondary`,children:`aggregate`}):e.aggregateId?(0,P.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:e.aggregateId}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}),width:170},{id:`dir`,header:`Dir`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.dir||``}),width:90},{id:`vrf`,header:`VRF`,cell:e=>{let t=e.vrf??e.vrfNames?.[0]??``;if(!t)return(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let n=(e.vrfNames??[]).length;return(0,P.jsxs)(`div`,{className:`text-xs`,children:[(0,P.jsx)(`div`,{className:`font-mono`,children:t}),n>1?(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[n,` vrfs`]}):null]})},width:160},{id:`speed`,header:`Speed`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:df(e.speedMbps??null)}),width:90,align:`right`},{id:`state`,header:`State`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:[e.admin,e.oper].filter(Boolean).join(` / `)||``}),width:140},{id:`p95`,header:`p95`,align:`right`,cell:e=>u.startsWith(`util_`)?lf(e.p95):uf(e.p95),width:90},...u.startsWith(`util_`)?[{id:`p95Gbps`,header:`p95 (Gbps)`,align:`right`,cell:e=>{let t=Number(e.speedMbps??0),n=Number(e.p95??NaN);return!t||!Number.isFinite(n)?(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,P.jsx)(`span`,{className:`text-xs`,children:(n*t/1e3).toFixed(2)})},width:110}]:[],{id:`max`,header:`Max`,align:`right`,cell:e=>{let t=u.startsWith(`util_`)?lf(e.max):uf(e.max),n=e.threshold??(u.startsWith(`util_`)?.85:void 0);return(0,P.jsx)(`span`,{className:n!==void 0&&(e.max??0)>=n?`text-destructive font-medium`:``,children:t})},width:90},...u.startsWith(`util_`)?[{id:`maxGbps`,header:`Max (Gbps)`,align:`right`,cell:e=>{let t=Number(e.speedMbps??0),n=Number(e.max??NaN);return!t||!Number.isFinite(n)?(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,P.jsx)(`span`,{className:`text-xs`,children:(n*t/1e3).toFixed(2)})},width:110},{id:`headroom85`,header:`Headroom@85 (Gbps)`,align:`right`,cell:e=>{let t=Number(e.speedMbps??0),n=Number(e.p95??NaN),r=Number(e.threshold??.85);return!t||!Number.isFinite(n)||!Number.isFinite(r)?(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,P.jsx)(`span`,{className:`text-xs`,children:(Math.max(0,(r-n)*t)/1e3).toFixed(2)})},width:150},{id:`days85`,header:`Days@85`,align:`right`,cell:e=>{if(!e.forecastCrossingTs)return(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let t=cf(e.forecastCrossingTs);return t?(0,P.jsx)(`span`,{className:`text-xs`,children:Math.round((t.getTime()-Date.now())/(24*3600*1e3))}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90}]:[],{id:`slope`,header:`Slope/d`,align:`right`,cell:e=>u.startsWith(`util_`)?lf(e.slopePerDay):uf(e.slopePerDay),width:100},{id:`forecast`,header:`Forecast`,cell:e=>{if(!e.forecastCrossingTs)return(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let t=cf(e.forecastCrossingTs),n=t?Math.round((t.getTime()-Date.now())/(24*3600*1e3)):null;return(0,P.jsxs)(`div`,{className:`text-xs`,children:[(0,P.jsx)(`div`,{className:`font-mono`,children:e.forecastCrossingTs.slice(0,10)}),n===null?null:(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[n,`d`]})]})},width:120},{id:`samples`,header:`N`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.samples||0}),width:70}],[u]),qt=(0,M.useMemo)(()=>[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:240},{id:`meta`,header:`Meta`,cell:e=>(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[(0,P.jsx)(`div`,{children:[e.vendor,e.os].filter(Boolean).join(`  `)||``}),(0,P.jsx)(`div`,{className:`font-mono`,children:e.model||``})]}),width:240},{id:`p95`,header:`p95`,align:`right`,cell:e=>lf(e.p95),width:90},{id:`max`,header:`Max`,align:`right`,cell:e=>{let t=e.threshold??.85;return(0,P.jsx)(`span`,{className:(e.max??0)>=t?`text-destructive font-medium`:``,children:lf(e.max)})},width:90},{id:`slope`,header:`Slope/d`,align:`right`,cell:e=>lf(e.slopePerDay),width:100},{id:`forecast`,header:`Forecast`,cell:e=>{if(!e.forecastCrossingTs)return(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let t=cf(e.forecastCrossingTs),n=t?Math.round((t.getTime()-Date.now())/(24*3600*1e3)):null;return(0,P.jsxs)(`div`,{className:`text-xs`,children:[(0,P.jsx)(`div`,{className:`font-mono`,children:e.forecastCrossingTs.slice(0,10)}),n===null?null:(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[n,`d`]})]})},width:120},{id:`samples`,header:`N`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.samples||0}),width:70}],[]),Jt=i({queryKey:H.forwardNetworkCapacityGrowth(k,e,s,le,se,`interface`),queryFn:()=>la(k,e,{metric:le,window:s,objectType:`interface`,compareHours:se,limit:50}),enabled:!!(k&&e&&yt),retry:!1,staleTime:3e4}),Yt=i({queryKey:H.forwardNetworkCapacityGrowth(k,e,s,ue,se,`device`),queryFn:()=>la(k,e,{metric:ue,window:s,objectType:`device`,compareHours:se,limit:50}),enabled:!!(k&&e&&yt),retry:!1,staleTime:3e4}),Xt=(0,M.useMemo)(()=>(Jt.data?.rows??[]).map(e=>{let t=e?.now?.details??{},n=String(t.deviceName??e.objectId??``).trim(),r=String(t.interfaceName??``).trim(),i=String(t.direction??``).trim(),a=String(t.locationName??``).trim()||void 0,o=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,s=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0;return{id:String(e?.objectId??`${n}:${r}:${i}`),device:n,iface:r,dir:i,locationName:a,tagNames:o,groupNames:s,speedMbps:t.speedMbps??null,nowP95:e?.now?.p95,prevP95:e?.prev?.p95??null,deltaP95:e?.deltaP95??null,deltaP95Gbps:e?.deltaP95Gbps??null,nowMax:e?.now?.max,prevMax:e?.prev?.max??null,deltaMax:e?.deltaMax??null,nowForecast:e?.now?.forecastCrossingTs??void 0,raw:e}}).filter(e=>!(ae!==`all`&&(e.locationName??``)!==ae||te!==`all`&&!(e.tagNames??[]).includes(te)||re!==`all`&&!(e.groupNames??[]).includes(re))),[Jt.data?.rows,ae,te,re]),Zt=(0,M.useMemo)(()=>(Yt.data?.rows??[]).map(e=>{let t=e?.now?.details??{},n=String(t.deviceName??e.objectId??``).trim(),r=String(t.locationName??``).trim()||void 0,i=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,a=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0;return{id:String(e?.objectId??n),device:n,locationName:r,tagNames:i,groupNames:a,vendor:String(t.vendor??``).trim()||void 0,os:String(t.os??``).trim()||void 0,model:String(t.model??``).trim()||void 0,nowP95:e?.now?.p95,prevP95:e?.prev?.p95??null,deltaP95:e?.deltaP95??null,nowMax:e?.now?.max,prevMax:e?.prev?.max??null,deltaMax:e?.deltaMax??null,nowForecast:e?.now?.forecastCrossingTs??void 0,raw:e}}).filter(e=>!(ae!==`all`&&(e.locationName??``)!==ae||te!==`all`&&!(e.tagNames??[]).includes(te)||re!==`all`&&!(e.groupNames??[]).includes(re))),[Yt.data?.rows,ae,te,re]),Qt=(0,M.useMemo)(()=>{let e=new Set,t=new Set;for(let n of A.data?.routeScale??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();r&&e.add(r),i&&t.add(i)}for(let n of A.data?.bgpNeighbors??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();r&&e.add(r),i&&t.add(i)}return{devices:Array.from(e).sort(),vrfs:Array.from(t).sort()}},[A.data?.routeScale,A.data?.bgpNeighbors]),$t=(0,M.useMemo)(()=>(A.data?.routeScale??[]).filter(e=>!(D!==`all`&&e.deviceName!==D||we!==`all`&&e.vrf!==we)),[A.data?.routeScale,D,we]),en=(0,M.useMemo)(()=>(A.data?.bgpNeighbors??[]).filter(e=>!(D!==`all`&&e.deviceName!==D||we!==`all`&&e.vrf!==we)),[A.data?.bgpNeighbors,D,we]),tn=(0,M.useMemo)(()=>(A.data?.hardwareTcam??[]).filter(e=>!(D!==`all`&&e.deviceName!==D)),[A.data?.hardwareTcam,D]),nn=(0,M.useMemo)(()=>{let e=new Map,t=(e,t)=>`${e}||${t}`;for(let n of A.data?.routeScale??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();if(!r||!i)continue;let a=t(r,i),o=e.get(a)??{id:a,deviceName:r,vrf:i,ipv4Routes:0,ipv6Routes:0,bgpNeighbors:0,bgpEstablished:0};o.ipv4Routes=Number(n.ipv4Routes??0),o.ipv6Routes=Number(n.ipv6Routes??0),e.set(a,o)}for(let n of A.data?.bgpNeighbors??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();if(!r||!i)continue;let a=t(r,i),o=e.get(a)??{id:a,deviceName:r,vrf:i,ipv4Routes:0,ipv6Routes:0,bgpNeighbors:0,bgpEstablished:0};o.bgpNeighbors+=1,String(n.sessionState??``).toUpperCase().includes(`ESTABLISHED`)&&(o.bgpEstablished+=1),e.set(a,o)}for(let n of Dt){if(n.objectType!==`interface`||n.window!==s||!n.metric.startsWith(`util_`))continue;let r=n.details??{},i=String(r.deviceName??``).trim(),a=String(r.vrf??``).trim();if(!i||!a)continue;let o=t(i,a),c=e.get(o)??{id:o,deviceName:i,vrf:a,ipv4Routes:0,ipv6Routes:0,bgpNeighbors:0,bgpEstablished:0};c.maxIfaceMax=Math.max(c.maxIfaceMax??0,n.max??0),n.p95!==void 0&&n.p95!==null&&(c.maxIfaceP95=Math.max(c.maxIfaceP95??0,n.p95??0));let l=n.forecastCrossingTs??``;l&&(c.soonestForecast?Date.parse(l)<Date.parse(c.soonestForecast)&&(c.soonestForecast=l):c.soonestForecast=l),e.set(o,c)}let n=Array.from(e.values());return n.sort((e,t)=>(t.maxIfaceMax??0)-(e.maxIfaceMax??0)),n},[A.data?.routeScale,A.data?.bgpNeighbors,Dt,s]);return k?(0,P.jsxs)(`div`,{className:a?`space-y-6`:`space-y-6 p-6 pb-20`,children:[a?null:(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(p,{to:`/dashboard/forward-networks`,search:{workspace:k},className:Cr({variant:`outline`,size:`icon`,className:`h-9 w-9`}),title:`Back to Forward networks`,children:(0,P.jsx)(ee,{className:`h-4 w-4`})}),(0,P.jsxs)(`div`,{children:[(0,P.jsxs)(`h1`,{className:`text-2xl font-bold tracking-tight flex items-center gap-2`,children:[(0,P.jsx)(Hn,{className:`h-5 w-5`}),` Capacity`]}),(0,P.jsxs)(`p`,{className:`text-sm text-muted-foreground mt-1`,children:[`Forward network:`,` `,(0,P.jsx)(`span`,{className:`font-medium`,children:mt||e}),yt?(0,P.jsx)(`span`,{className:`ml-2 font-mono text-xs`,children:yt}):null]})]})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsxs)(q,{value:s,onValueChange:e=>l(e),children:[(0,P.jsx)(Y,{className:`w-[110px]`,children:(0,P.jsx)(J,{placeholder:`Window`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`24h`,children:`24h`}),(0,P.jsx)(Z,{value:`7d`,children:`7d`}),(0,P.jsx)(Z,{value:`30d`,children:`30d`})]})]}),(0,P.jsxs)(q,{value:ae,onValueChange:y,children:[(0,P.jsx)(Y,{className:`w-[190px]`,children:(0,P.jsx)(J,{placeholder:`Location`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All locations`}),Tt.locations.map(e=>(0,P.jsx)(Z,{value:e,children:e},e))]})]}),(0,P.jsxs)(q,{value:b,onValueChange:x,children:[(0,P.jsx)(Y,{className:`w-[170px]`,children:(0,P.jsx)(J,{placeholder:`VRF`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All VRFs`}),Tt.vrfs.map(e=>(0,P.jsx)(Z,{value:e,children:e},e))]})]}),(0,P.jsxs)(q,{value:te,onValueChange:ne,children:[(0,P.jsx)(Y,{className:`w-[170px]`,children:(0,P.jsx)(J,{placeholder:`Tag`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All tags`}),Tt.tags.map(e=>(0,P.jsx)(Z,{value:e,children:e},e))]})]}),(0,P.jsxs)(q,{value:re,onValueChange:ie,children:[(0,P.jsx)(Y,{className:`w-[170px]`,children:(0,P.jsx)(J,{placeholder:`Group`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All groups`}),Tt.groups.map(e=>(0,P.jsx)(Z,{value:e,children:e},e))]})]}),(0,P.jsxs)(q,{value:S,onValueChange:e=>oe(e),children:[(0,P.jsx)(Y,{className:`w-[140px]`,children:(0,P.jsx)(J,{placeholder:`Group by`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`none`,children:`No grouping`}),(0,P.jsx)(Z,{value:`location`,children:`Location`}),(0,P.jsx)(Z,{value:`tag`,children:`Tag`}),(0,P.jsx)(Z,{value:`group`,children:`Group`}),(0,P.jsx)(Z,{value:`vrf`,children:`VRF`})]})]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>St.mutate(),disabled:St.isPending||!yt,title:yt?`Enqueue a background rollup task`:`Load the saved Forward network first`,children:[(0,P.jsx)(Ot,{className:`mr-2 h-4 w-4`}),St.isPending?`Queueing`:`Refresh`]})]})]}),(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-4 md:grid-cols-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`As Of`})}),(0,P.jsxs)(V,{className:`text-sm`,children:[(0,P.jsx)(`div`,{className:`font-mono text-xs`,children:ht.data?.asOf??A.data?.asOf??``}),(0,P.jsxs)(`div`,{className:`mt-2 flex items-center gap-2`,children:[ht.data?.stale?(0,P.jsx)(W,{variant:`destructive`,children:`Stale`}):(0,P.jsx)(W,{variant:`secondary`,children:`Fresh`}),(0,P.jsx)(W,{variant:`outline`,className:`font-mono text-xs`,children:yt||`no-forward`})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`Hot Interfaces`})}),(0,P.jsxs)(V,{className:`text-sm`,children:[(0,P.jsx)(`div`,{className:`text-2xl font-semibold`,children:zt.above}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground mt-1`,children:`util_* max >= 85%`})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`Soonest Saturation`})}),(0,P.jsx)(V,{className:`text-sm`,children:zt.soonest?.forecastCrossingTs?(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`font-mono text-xs`,children:zt.soonest.forecastCrossingTs}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[String(zt.soonest.details?.deviceName??``),` `,String(zt.soonest.details?.interfaceName??``),` `,String(zt.soonest.details?.direction??``)]})]}):(0,P.jsx)(`div`,{className:`text-muted-foreground text-sm`,children:``})})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`Coverage`})}),(0,P.jsx)(V,{className:`text-sm space-y-1`,children:(()=>{let e=gt.data,t=(e,t)=>t?`${(e/t*100).toFixed(0)}%`:``,n=e?t(e.ifacesWithSpeed,e.ifacesTotal):``,r=e?e.rollupsInterfaceTotal+e.rollupsDeviceTotal:0,i=e?t(e.rollupsWithSamples,r):``;return(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Ifaces w/speed`}),(0,P.jsxs)(`div`,{className:`font-medium`,children:[n,` `,(0,P.jsxs)(`span`,{className:`text-xs text-muted-foreground`,children:[`(`,e?`${e.ifacesWithSpeed}/${e.ifacesTotal}`:``,`)`]})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Rollups w/samples`}),(0,P.jsxs)(`div`,{className:`font-medium`,children:[i,` `,(0,P.jsxs)(`span`,{className:`text-xs text-muted-foreground`,children:[`(`,e?`${e.rollupsWithSamples}/${r}`:``,`)`]})]})]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Inv:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:e?.asOfInventory??``}),`  `,`Rollups:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:e?.asOfRollups??``})]})]})})()})]})]}),(0,P.jsxs)(Bc,{defaultValue:`interfaces`,className:`space-y-4`,children:[(0,P.jsxs)(Vc,{children:[(0,P.jsx)(Hc,{value:`scorecard`,children:`Scorecard`}),(0,P.jsx)(Hc,{value:`interfaces`,children:`Interfaces`}),(0,P.jsx)(Hc,{value:`devices`,children:`Devices`}),(0,P.jsx)(Hc,{value:`growth`,children:`Growth`}),(0,P.jsx)(Hc,{value:`plan`,children:`Plan`}),(0,P.jsx)(Hc,{value:`paths`,children:`Paths (Capacity)`}),(0,P.jsx)(Hc,{value:`routing`,children:`Routing/BGP`}),(0,P.jsx)(Hc,{value:`changes`,children:`Changes`}),(0,P.jsx)(Hc,{value:`health`,children:`Health`}),(0,P.jsx)(Hc,{value:`raw`,children:`Raw`})]}),(0,P.jsx)(Uc,{value:`scorecard`,className:`space-y-4`,children:(()=>{let e=A.data?.interfaces??[],t=e.filter(e=>String(e.interfaceType??``)===`IF_AGGREGATE`),n=e.filter(e=>String(e.aggregateId??``).trim()),r=vt.data?.items??[],i=r.slice(0,10),a=(()=>{let e=null;for(let t of r){let n=String(t.forecastCrossingTs??``).trim();n&&(!e||Date.parse(n)<Date.parse(e))&&(e=n)}return e})();return(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-4 md:grid-cols-3`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`Collection`})}),(0,P.jsxs)(V,{className:`text-sm space-y-1`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`As of`}),(0,P.jsx)(`div`,{className:`font-mono text-xs`,children:ht.data?.asOf??A.data?.asOf??``})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Status`}),(0,P.jsx)(`div`,{children:ht.data?.stale?(0,P.jsx)(W,{variant:`destructive`,children:`Stale`}):(0,P.jsx)(W,{variant:`secondary`,children:`Fresh`})})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Ifaces w/speed`}),(0,P.jsx)(`div`,{className:`font-medium text-xs`,children:gt.data?`${gt.data.ifacesWithSpeed}/${gt.data.ifacesTotal}`:``})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Rollups w/samples`}),(0,P.jsx)(`div`,{className:`font-medium text-xs`,children:gt.data?`${gt.data.rollupsWithSamples}/${gt.data.rollupsInterfaceTotal+gt.data.rollupsDeviceTotal}`:``})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`LAGs`})}),(0,P.jsxs)(V,{className:`text-sm space-y-1`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Aggregate ifaces`}),(0,P.jsx)(`div`,{className:`text-2xl font-semibold`,children:t.length})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Member ifaces`}),(0,P.jsx)(`div`,{className:`text-2xl font-semibold`,children:n.length})]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`LAG membership from NQE (ethernet.aggregateId + aggregation.memberNames).`})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`Upgrade Risk`})}),(0,P.jsxs)(V,{className:`text-sm space-y-1`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Candidates`}),(0,P.jsx)(`div`,{className:`text-2xl font-semibold`,children:r.length})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Soonest forecast`}),(0,P.jsx)(`div`,{className:`font-mono text-xs`,children:a?a.slice(0,10):``})]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Based on util_* rollups (window `,s,`).`]})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{className:`text-base`,children:`Top Upgrade Candidates`})}),(0,P.jsx)(V,{children:(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:220},{id:`name`,header:`Link`,cell:e=>(0,P.jsxs)(`div`,{className:`text-xs`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`span`,{className:`font-mono`,children:e.name}),e.scopeType===`lag`?(0,P.jsx)(W,{variant:`secondary`,children:`LAG`}):null]}),e.recommendedSpeedMbps?(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[`Rec: `,df(e.recommendedSpeedMbps)]}):null]}),width:260},{id:`max`,header:`Max`,align:`right`,cell:e=>lf(e.maxUtil),width:90},{id:`forecast`,header:`Forecast`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.forecastCrossingTs?String(e.forecastCrossingTs).slice(0,10):``}),width:120},{id:`reason`,header:`Reason`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.reason||``}),width:140}],rows:i,getRowId:e=>`${e.scopeType}:${e.device}:${e.name}`,emptyText:`No upgrade candidates yet. Click Refresh to enqueue rollups.`,maxHeightClassName:`max-h-[320px]`,minWidthClassName:`min-w-0`})})]})]})})()}),(0,P.jsx)(Uc,{value:`interfaces`,className:`space-y-4`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Interface Capacity`}),(0,P.jsxs)(`div`,{className:`flex flex-col gap-2 md:flex-row md:items-center`,children:[(0,P.jsx)(K,{placeholder:`Filter (device / interface)`,value:h,onChange:e=>g(e.target.value),className:`w-[260px]`}),(0,P.jsxs)(q,{value:u,onValueChange:e=>d(e),children:[(0,P.jsx)(Y,{className:`w-[240px]`,children:(0,P.jsx)(J,{placeholder:`Metric`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`util_ingress`,children:`Utilization (ingress)`}),(0,P.jsx)(Z,{value:`util_egress`,children:`Utilization (egress)`}),(0,P.jsx)(Z,{value:`if_error_ingress`,children:`Errors (ingress)`}),(0,P.jsx)(Z,{value:`if_error_egress`,children:`Errors (egress)`}),(0,P.jsx)(Z,{value:`if_packet_loss_ingress`,children:`Packet loss (ingress)`}),(0,P.jsx)(Z,{value:`if_packet_loss_egress`,children:`Packet loss (egress)`})]})]}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>{let t=[`device`,`interface`,`direction`,`window`,`metric`,`speedMbps`,`adminStatus`,`operStatus`,`p95`,`p99`,`max`,`slopePerDay`,`forecastCrossingTs`,`samples`],n=Ft.map(e=>[e.device,e.iface,e.dir,s,u,e.speedMbps??``,e.admin??``,e.oper??``,e.p95??``,e.p99??``,e.max??``,e.slopePerDay??``,e.forecastCrossingTs??``,e.samples??0]);tf(`capacity_interfaces_${e}_${s}_${u}.csv`,`text/csv`,of(t,n))},disabled:Ft.length===0,children:`Export CSV`}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>ge(!0),disabled:A.isLoading||A.isError,title:`Pick any interface from NQE inventory and load trend from Forward perf history`,children:`Pick interface`})]})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[S===`none`?null:(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Group summary (`,S,`)`]}),(0,P.jsx)($s,{columns:u.startsWith(`util_`)?[{id:`group`,header:`Group`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.group}),width:220},...S===`vrf`?[{id:`routes`,header:`Routes (v4/v6)`,align:`right`,cell:e=>(0,P.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[Number(e.ipv4RoutesSum??0),`/`,Number(e.ipv6RoutesSum??0)]}),width:130},{id:`bgp`,header:`BGP`,align:`right`,cell:e=>(0,P.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[Number(e.bgpNeighbors??0),` (`,Number(e.bgpEstablished??0),`)`]}),width:100}]:[],{id:`count`,header:`Ifaces`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.count}),width:80},{id:`speed`,header:` Speed (Gbps)`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.sumSpeedGbps===void 0?``:e.sumSpeedGbps.toFixed(1)}),width:120},{id:`p95sum`,header:` p95 (Gbps)`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.sumP95Gbps===void 0?``:e.sumP95Gbps.toFixed(2)}),width:120},{id:`maxsum`,header:` Max (Gbps)`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.sumMaxGbps===void 0?``:e.sumMaxGbps.toFixed(2)}),width:120},{id:`utilp95`,header:`Util@p95`,align:`right`,cell:e=>{let t=Number(e.sumSpeedGbps??0),n=Number(e.sumP95Gbps??0);return t?(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:lf(n/t)}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90},{id:`utilmax`,header:`Util@max`,align:`right`,cell:e=>{let t=Number(e.sumSpeedGbps??0),n=Number(e.sumMaxGbps??0);return t?(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:lf(n/t)}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90},{id:`headroom`,header:`Headroom@85 (Gbps)`,align:`right`,cell:e=>{let t=Number(e.sumSpeedGbps??0),n=Number(e.sumP95Gbps??0);return t?(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:Math.max(0,t*.85-n).toFixed(2)}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:150},{id:`p95cov`,header:`p95 cov`,align:`right`,cell:e=>(0,P.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[Number(e.p95Count??0),`/`,e.count]}),width:90},{id:`soonest`,header:`Soonest`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.soonestForecast?e.soonestForecast.slice(0,10):``}),width:110}]:[{id:`group`,header:`Group`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.group}),width:260},{id:`count`,header:`Count`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.count}),width:90},{id:`hot`,header:`Hot`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.hotCount}),width:90},{id:`p95`,header:`Max p95`,align:`right`,cell:e=>uf(e.maxP95),width:100}],rows:Lt,getRowId:e=>e.group,onRowClick:e=>{S===`location`?y(e.group):S===`tag`?ne(e.group===`untagged`?`all`:e.group):S===`group`?ie(e.group===`ungrouped`?`all`:e.group):S===`vrf`&&x(e.group===`unknown`?`all`:e.group)},emptyText:`No groups.`,maxHeightClassName:`max-h-[260px]`,minWidthClassName:`min-w-0`})]}),ht.isLoading?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(U,{className:`h-5 w-56`}),(0,P.jsx)(U,{className:`h-32 w-full`})]}):ht.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load summary:`,` `,ht.error instanceof Error?ht.error.message:String(ht.error)]}):(0,P.jsx)($s,{columns:Kt,rows:Ft,getRowId:e=>e.id,onRowClick:e=>de(e),emptyText:`No rollups for this window/metric yet. Click Refresh to enqueue.`})]})]})}),(0,P.jsx)(Uc,{value:`devices`,className:`space-y-4`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Device Capacity`}),(0,P.jsxs)(`div`,{className:`flex flex-col gap-2 md:flex-row md:items-center`,children:[(0,P.jsx)(K,{placeholder:`Filter (device / vendor / os)`,value:_,onChange:e=>v(e.target.value),className:`w-[260px]`}),(0,P.jsxs)(q,{value:f,onValueChange:e=>m(e),children:[(0,P.jsx)(Y,{className:`w-[220px]`,children:(0,P.jsx)(J,{placeholder:`Metric`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`device_cpu`,children:`CPU`}),(0,P.jsx)(Z,{value:`device_memory`,children:`Memory`})]})]}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>{let t=[`device`,`window`,`metric`,`vendor`,`os`,`model`,`p95`,`p99`,`max`,`slopePerDay`,`forecastCrossingTs`,`samples`],n=It.map(e=>[e.device,s,f,e.vendor??``,e.os??``,e.model??``,e.p95??``,e.p99??``,e.max??``,e.slopePerDay??``,e.forecastCrossingTs??``,e.samples??0]);tf(`capacity_devices_${e}_${s}_${f}.csv`,`text/csv`,of(t,n))},disabled:It.length===0,children:`Export CSV`}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>be(!0),disabled:A.isLoading||A.isError,title:`Pick any device from NQE inventory and load trend from Forward perf history`,children:`Pick device`})]})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[S===`none`?null:(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Group summary (`,S,`)`]}),(0,P.jsx)($s,{columns:[{id:`group`,header:`Group`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.group}),width:260},{id:`count`,header:`Count`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.count}),width:90},{id:`hot`,header:`Hot`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.hotCount}),width:90},{id:`p95`,header:`Max p95`,align:`right`,cell:e=>lf(e.maxP95),width:100}],rows:Rt,getRowId:e=>e.group,emptyText:`No groups.`,maxHeightClassName:`max-h-[260px]`,minWidthClassName:`min-w-0`})]}),ht.isLoading?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(U,{className:`h-5 w-56`}),(0,P.jsx)(U,{className:`h-32 w-full`})]}):ht.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load summary:`,` `,ht.error instanceof Error?ht.error.message:String(ht.error)]}):(0,P.jsx)($s,{columns:qt,rows:It,getRowId:e=>e.id,onRowClick:e=>E(e),emptyText:`No rollups for this window/metric yet. Click Refresh to enqueue.`})]})]})}),(0,P.jsxs)(Uc,{value:`growth`,className:`space-y-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Growth (Delta vs Prior)`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsxs)(q,{value:String(se),onValueChange:e=>ce(Number(e)),children:[(0,P.jsx)(Y,{className:`w-[150px]`,children:(0,P.jsx)(J,{placeholder:`Compare`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`24`,children:`24h`}),(0,P.jsx)(Z,{value:`168`,children:`7d`}),(0,P.jsx)(Z,{value:`720`,children:`30d`}),(0,P.jsx)(Z,{value:`2160`,children:`90d`})]})]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`As of`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:Jt.data?.asOf??Yt.data?.asOf??ht.data?.asOf??``}),`  `,`Compared to`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:Jt.data?.compareAsOf??Yt.data?.compareAsOf??``})]})]})]}),(0,P.jsx)(V,{className:`text-sm text-muted-foreground`,children:`Top growers computed from Skyforge rollups (no Forward time-series pull). Use Refresh to enqueue rollup recomputation.`})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Interfaces`}),(0,P.jsxs)(q,{value:le,onValueChange:e=>C(e),children:[(0,P.jsx)(Y,{className:`w-[240px]`,children:(0,P.jsx)(J,{placeholder:`Metric`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`util_ingress`,children:`Utilization (ingress)`}),(0,P.jsx)(Z,{value:`util_egress`,children:`Utilization (egress)`})]})]})]}),(0,P.jsx)(V,{children:Jt.isLoading?(0,P.jsx)(U,{className:`h-32 w-full`}):Jt.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load growth:`,` `,Jt.error instanceof Error?Jt.error.message:String(Jt.error)]}):(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:220},{id:`iface`,header:`Interface`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.iface}),width:220},{id:`dir`,header:`Dir`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.dir}),width:90},{id:`speed`,header:`Speed`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:df(e.speedMbps??null)}),width:90},{id:`nowP95`,header:`Now p95`,align:`right`,cell:e=>lf(e.nowP95),width:100},{id:`prevP95`,header:`Prev p95`,align:`right`,cell:e=>lf(e.prevP95??void 0),width:100},{id:`deltaP95`,header:` p95`,align:`right`,cell:e=>{let t=e.deltaP95;return t==null?(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,P.jsxs)(`span`,{className:t>0?`text-foreground font-medium`:`text-muted-foreground`,children:[t>=0?`+`:``,lf(t)]})},width:90},{id:`deltaGbps`,header:` p95 (Gbps)`,align:`right`,cell:e=>e.deltaP95Gbps!==null&&e.deltaP95Gbps!==void 0?(0,P.jsxs)(`span`,{className:`text-xs`,children:[e.deltaP95Gbps>=0?`+`:``,e.deltaP95Gbps.toFixed(2)]}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}),width:120},{id:`forecast`,header:`Forecast`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.nowForecast?e.nowForecast.slice(0,10):``}),width:120}],rows:Xt,getRowId:e=>e.id,onRowClick:e=>{d(le),de({id:`${e.device}:${e.iface}:${e.dir}:growth`,device:e.device,iface:e.iface,dir:e.dir||`INGRESS`,speedMbps:e.speedMbps??null,samples:0})},emptyText:`No growth rows yet. Click Refresh to enqueue.`})})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Devices`}),(0,P.jsxs)(q,{value:ue,onValueChange:e=>w(e),children:[(0,P.jsx)(Y,{className:`w-[220px]`,children:(0,P.jsx)(J,{placeholder:`Metric`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`device_cpu`,children:`CPU`}),(0,P.jsx)(Z,{value:`device_memory`,children:`Memory`})]})]})]}),(0,P.jsx)(V,{children:Yt.isLoading?(0,P.jsx)(U,{className:`h-32 w-full`}):Yt.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load growth:`,` `,Yt.error instanceof Error?Yt.error.message:String(Yt.error)]}):(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:240},{id:`meta`,header:`Meta`,cell:e=>(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[(0,P.jsx)(`div`,{children:[e.vendor,e.os].filter(Boolean).join(`  `)||``}),(0,P.jsx)(`div`,{className:`font-mono`,children:e.model||``})]}),width:240},{id:`nowP95`,header:`Now p95`,align:`right`,cell:e=>lf(e.nowP95),width:100},{id:`prevP95`,header:`Prev p95`,align:`right`,cell:e=>lf(e.prevP95??void 0),width:100},{id:`deltaP95`,header:` p95`,align:`right`,cell:e=>{let t=e.deltaP95;return t==null?(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,P.jsxs)(`span`,{className:t>0?`text-foreground font-medium`:`text-muted-foreground`,children:[t>=0?`+`:``,lf(t)]})},width:90},{id:`forecast`,header:`Forecast`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.nowForecast?e.nowForecast.slice(0,10):``}),width:120}],rows:Zt,getRowId:e=>e.id,onRowClick:e=>{m(ue),E({id:`${e.device}:growth`,device:e.device,metric:ue,vendor:e.vendor,os:e.os,model:e.model,samples:0})},emptyText:`No growth rows yet. Click Refresh to enqueue.`})})]})]}),(0,P.jsx)(Uc,{value:`plan`,className:`space-y-4`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Upgrade Candidates`}),(0,P.jsxs)(`div`,{className:`flex flex-col gap-2 md:flex-row md:items-center`,children:[(0,P.jsx)(K,{placeholder:`Filter (device / link)`,value:Ae,onChange:e=>je(e.target.value),className:`w-[260px]`}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>{let t=vt.data?.items??[],n=Ae.trim().toLowerCase(),r=n?t.filter(e=>`${e.device} ${e.name} ${(e.members??[]).join(` `)}`.toLowerCase().includes(n)):t,i=[`scopeType`,`device`,`name`,`members`,`speedMbps`,`worstDirection`,`p95Util`,`maxUtil`,`p95Gbps`,`maxGbps`,`forecastCrossingTs`,`requiredSpeedMbps`,`recommendedSpeedMbps`,`reason`,`worstMemberMaxUtil`],a=r.map(e=>[e.scopeType??``,e.device??``,e.name??``,(e.members??[]).join(` `),e.speedMbps??``,e.worstDirection??``,e.p95Util??``,e.maxUtil??``,e.p95Gbps??``,e.maxGbps??``,e.forecastCrossingTs??``,e.requiredSpeedMbps??``,e.recommendedSpeedMbps??``,e.reason??``,e.worstMemberMaxUtil??``]);tf(`upgrade-candidates-${e}-${s}.csv`,`text/csv`,of(i,a))},disabled:vt.isLoading,children:`Export CSV`})]})]}),(0,P.jsx)(V,{children:vt.isLoading?(0,P.jsx)(U,{className:`h-24 w-full`}):vt.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load upgrade candidates:`,` `,vt.error instanceof Error?vt.error.message:String(vt.error)]}):(()=>{let e=vt.data?.items??[],t=Ae.trim().toLowerCase();return(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:220},{id:`link`,header:`Link`,cell:e=>(0,P.jsxs)(`div`,{className:`text-xs`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`span`,{className:`font-mono`,children:e.name}),e.scopeType===`lag`?(0,P.jsx)(W,{variant:`secondary`,children:`LAG`}):null,e.recommendedSpeedMbps?(0,P.jsx)(W,{variant:`destructive`,children:`upgrade`}):null]}),(e.members??[]).length?(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[(e.members??[]).length,` members`]}):null]}),width:240},{id:`speed`,header:`Speed`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:df(e.speedMbps)}),width:90},{id:`dir`,header:`Worst`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.worstDirection||``}),width:90},{id:`max`,header:`Max`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:e.maxUtil>=.85?`text-destructive font-medium`:``,children:lf(e.maxUtil)}),width:90},{id:`p95`,header:`p95`,align:`right`,cell:e=>lf(e.p95Util),width:90},{id:`maxGbps`,header:`Max (Gbps)`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:Number(e.maxGbps??0).toFixed(2)}),width:110},{id:`forecast`,header:`Forecast`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.forecastCrossingTs?String(e.forecastCrossingTs).slice(0,10):``}),width:120},{id:`req`,header:`Req`,align:`right`,cell:e=>e.requiredSpeedMbps?(0,P.jsx)(`span`,{className:`text-xs`,children:df(e.requiredSpeedMbps)}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}),width:90},{id:`rec`,header:`Rec`,align:`right`,cell:e=>e.recommendedSpeedMbps?(0,P.jsx)(`span`,{className:`text-xs font-medium text-destructive`,children:df(e.recommendedSpeedMbps)}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}),width:90},{id:`imb`,header:`Worst member`,align:`right`,cell:e=>e.worstMemberMaxUtil?(0,P.jsx)(`span`,{className:`text-xs`,children:lf(e.worstMemberMaxUtil)}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}),width:120},{id:`reason`,header:`Reason`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.reason||``}),width:140}],rows:t?e.filter(e=>`${e.device} ${e.name} ${(e.members??[]).join(` `)}`.toLowerCase().includes(t)):e,getRowId:e=>`${e.scopeType}:${e.device}:${e.name}`,emptyText:`No upgrade candidates for this window (no hot links / no near-term forecasts).`,maxHeightClassName:`max-h-[520px]`,minWidthClassName:`min-w-0`})})()})]})}),(0,P.jsx)(Uc,{value:`paths`,className:`space-y-4`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Path Bottlenecks (Capacity)`}),(0,P.jsxs)(`div`,{className:`flex flex-col gap-2 md:flex-row md:items-center`,children:[(0,P.jsx)(K,{placeholder:`snapshotId (optional)`,value:Le,onChange:e=>Re(e.target.value),className:`w-[260px] font-mono text-xs`}),(0,P.jsxs)(`label`,{className:`flex items-center gap-2 text-xs text-muted-foreground`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:ze,onChange:e=>Be(e.target.checked)}),`include hops`]}),(0,P.jsxs)(`label`,{className:`flex items-center gap-2 text-xs text-muted-foreground`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:Ve,onChange:e=>He(e.target.checked)}),`demo mode`]}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>nt(!0),disabled:!!kt.error||!kt.queries.length,children:`Payload`}),(0,P.jsx)(F,{onClick:()=>{let e=kt;if(e.error){j.error(`Invalid path input`,{description:e.error});return}We(null),wt.mutate({window:s,snapshotId:Le.trim()||void 0,includeHops:ze,queries:e.queries})},disabled:wt.isPending,children:`Run`}),(0,P.jsx)(F,{variant:`outline`,disabled:!Ue?.items?.length,onClick:()=>{let t=[`index`,`srcIp`,`dstIp`,`ipProto`,`dstPort`,`forwardingOutcome`,`securityOutcome`,`forwardQueryUrl`,`bottleneckDevice`,`bottleneckInterface`,`direction`,`source`,`speedMbps`,`headroomGbps`,`headroomUtil`,`p95Util`,`maxUtil`,`forecastCrossingTs`,`error`],n=(Ue?.items??[]).map(e=>{let t=e.query??{},n=e.bottleneck??null;return[e.index,t.srcIp??``,t.dstIp??``,t.ipProto??``,t.dstPort??``,e.forwardingOutcome??``,e.securityOutcome??``,e.forwardQueryUrl??``,n?.deviceName??``,n?.interfaceName??``,n?.direction??``,n?.source??``,n?.speedMbps??``,n?.headroomGbps??``,n?.headroomUtil??``,n?.p95Util??``,n?.maxUtil??``,n?.forecastCrossingTs??``,e.error??``]});tf(`path_bottlenecks_${e}_${s}.csv`,`text/csv`,of(t,n))},children:`Export CSV`}),(0,P.jsx)(F,{variant:`outline`,disabled:!Ue?.items?.length,onClick:()=>{Pt&&tf(`capacity_memo_${e}_${s}.md`,`text/markdown`,Pt)},children:`Report`})]})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`This uses Forward bulk paths to find candidate paths, then joins hop interfaces to Skyforge capacity rollups (window`,` `,s,`) to highlight the tightest headroom along each flow.`]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Guardrails: this is not a Forward path-analysis UI. It only returns a capacity bottleneck per flow (plus optional minimal hops).`}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Input formats:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`srcIp dstIp tcp 443`}),`  `,(0,P.jsx)(`span`,{className:`font-mono`,children:`dstIp`}),`  `,(0,P.jsx)(`span`,{className:`font-mono`,children:`{ queries: [...] }`})]}),Ve?(0,P.jsxs)(`div`,{className:`rounded-md border p-3 space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Demo templates`}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Forward network:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:yt||``})]})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,P.jsx)(F,{variant:`secondary`,size:`sm`,onClick:()=>Ie([`10.10.10.10 10.10.10.64/28 tcp 80`,`10.10.20.10 10.10.30.10 tcp 443`,`- 10.10.40.0/24 udp 53`].join(`\\n`)),children:`Load basic (lines)`}),(0,P.jsx)(F,{variant:`secondary`,size:`sm`,onClick:()=>Ie(ef({queries:[{srcIp:`10.10.10.10`,dstIp:`10.10.10.64/28`,ipProto:6,dstPort:`8080-8088`,appId:`ssh`,url:`*.example.com`},{srcIp:`10.10.20.10`,dstIp:`10.10.30.10`,ipProto:6,dstPort:`443`}]})),children:`Load advanced (JSON)`}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>{Ie(``),Ke(``),We(null)},children:`Clear input`})]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Tip: use JSON input to set`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`appId`}),`,`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`url`}),`,`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:`userId`}),`, etc.`]})]}):null,(0,P.jsxs)(`div`,{className:`flex flex-col gap-2 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col gap-2 md:flex-row md:items-center`,children:[(0,P.jsx)(K,{placeholder:`Save batch name`,value:Ge,onChange:e=>Ke(e.target.value),className:`w-[260px]`}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>{let t=Ge.trim();if(!t){j.error(`Batch name required`);return}if(!k||!e){j.error(`Workspace/network missing`);return}let n=[{id:rf(),name:t,text:Fe,createdAt:new Date().toISOString()},...qe??[]].slice(0,25);Je(n),yf(k,e,n),j.success(`Saved batch`,{description:t})},disabled:!Fe.trim(),children:`Save`})]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground flex items-center gap-3`,children:[(0,P.jsx)(`span`,{children:kt.queries.length?`${kt.queries.length} flows parsed`:kt.error?kt.error:``}),(0,P.jsx)(`span`,{children:`Saved batches are stored in your browser for this workspace/network.`})]})]}),qe.length?(0,P.jsxs)(`div`,{className:`rounded-md border p-3 space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Saved batches`}),(0,P.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:qe.map(t=>(0,P.jsxs)(`div`,{className:`flex items-center gap-2 rounded-md border px-2 py-1`,children:[(0,P.jsx)(`button`,{type:`button`,className:`text-xs font-mono hover:underline`,onClick:()=>{Ie(t.text),Ke(t.name),j.success(`Loaded batch`,{description:t.name})},children:t.name}),(0,P.jsx)(`button`,{type:`button`,className:`text-xs text-muted-foreground hover:underline`,onClick:()=>{if(!k||!e)return;let n=qe.filter(e=>e.id!==t.id);Je(n),yf(k,e,n)},children:`delete`})]},t.id))})]}):null,(0,P.jsx)(`textarea`,{className:`min-h-[140px] w-full rounded-md border bg-background px-3 py-2 font-mono text-xs`,placeholder:`10.0.0.1 10.0.0.2 tcp 443
10.0.0.3 10.0.0.4 udp 53
10.0.0.0/24`,value:Fe,onChange:e=>Ie(e.target.value)}),wt.isPending?(0,P.jsx)(U,{className:`h-24 w-full`}):Ue?(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Results`}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>We(null),children:`Clear`})]}),Ue.coverage?(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground flex flex-wrap items-center gap-3`,children:[(0,P.jsxs)(`span`,{className:`font-mono`,children:[`snapshot`,` `,String(Ue.snapshotId??``).trim()||`latest`]}),(0,P.jsxs)(`span`,{className:`font-mono`,children:[`hop-keys`,` `,Number(Ue.coverage.hopInterfaceKeys??0)]}),(0,P.jsxs)(`span`,{className:`font-mono`,children:[`rollup `,Number(Ue.coverage.rollupMatched??0)]}),(0,P.jsxs)(`span`,{className:`font-mono`,children:[`perf`,` `,Number(Ue.coverage.perfFallbackUsed??0)]}),(0,P.jsxs)(`span`,{className:`font-mono`,children:[`unknown `,Number(Ue.coverage.unknown??0)]}),Ue.coverage.truncated?(0,P.jsx)(W,{variant:`destructive`,children:`truncated`}):null,(0,P.jsx)(`button`,{type:`button`,className:`text-xs text-muted-foreground hover:underline`,onClick:()=>et(!0),children:`details`})]}):null,(0,P.jsx)($s,{columns:[{id:`flow`,header:`Flow`,cell:e=>{let t=e.query??{},n=String(t.srcIp??``).trim(),r=String(t.dstIp??``).trim(),i=Number(t.ipProto??NaN),a=i===6?`tcp`:i===17?`udp`:i===1?`icmp`:Number.isFinite(i)?String(i):``,o=String(t.dstPort??``).trim();return(0,P.jsxs)(`div`,{className:`text-xs`,children:[(0,P.jsxs)(`div`,{className:`font-mono`,children:[n?`${n} -> `:``,r||``]}),(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:[a,o].filter(Boolean).join(` `)})]})},width:320},{id:`outcome`,header:`Outcome`,cell:e=>{let t=String(e.forwardingOutcome??``).trim(),n=String(e.securityOutcome??``).trim();return(0,P.jsxs)(`div`,{className:`text-xs`,children:[(0,P.jsx)(`div`,{className:t===`DELIVERED`&&n!==`DENIED`?`text-muted-foreground`:`text-destructive font-medium`,children:[t,n].filter(Boolean).join(` / `)||``}),e.timedOut?(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:`timed out`}):null]})},width:200},{id:`forward`,header:`Forward`,cell:e=>{let t=String(e.forwardQueryUrl??``).trim();return t?(0,P.jsx)(`a`,{href:t,target:`_blank`,rel:`noreferrer`,className:`text-xs text-muted-foreground hover:underline`,onClick:e=>e.stopPropagation(),children:`open`}):(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:``})},width:90},{id:`hops`,header:`Hops`,cell:e=>{let t=Array.isArray(e?.hops)?e.hops:[];return t.length?(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:n=>{n.preventDefault(),n.stopPropagation();let r=e.query??{},i=String(r.srcIp??``).trim(),a=String(r.dstIp??``).trim();Qe({title:`${i?`${i} -> `:``}${a||``}`,hops:t}),Xe(!0)},children:t.length}):(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:``})},width:90},{id:`bottleneck`,header:`Bottleneck`,cell:e=>{let t=e.bottleneck??null;if(!t)return(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:``});let n=String(t.source??``).trim();return(0,P.jsxs)(`div`,{className:`text-xs`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(`div`,{className:`font-mono`,children:[t.deviceName,` `,t.interfaceName]}),n?(0,P.jsx)(W,{variant:`secondary`,className:`text-[10px]`,children:n===`perf_fallback`?`perf`:n}):null]}),(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[t.direction,` `,` `,df(t.speedMbps??null)]})]})},width:320},{id:`headroom`,header:`Headroom`,align:`right`,cell:e=>{let t=e.bottleneck??null;if(!t)return(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:``});if(t.headroomGbps!==void 0&&t.headroomGbps!==null){let e=Number(t.headroomGbps);return(0,P.jsxs)(`span`,{className:e<0?`text-xs font-medium text-destructive tabular-nums`:`text-xs tabular-nums`,children:[e.toFixed(2),`G`]})}if(t.headroomUtil!==void 0&&t.headroomUtil!==null){let e=Number(t.headroomUtil);return(0,P.jsxs)(`span`,{className:e<0?`text-xs font-medium text-destructive tabular-nums`:`text-xs tabular-nums`,children:[lf(e),` `,(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:`util`})]})}return(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:``})},width:110},{id:`util`,header:`p95 / max`,align:`right`,cell:e=>{let t=e.bottleneck??null;return t?(0,P.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[lf(t.p95Util??void 0),` /`,` `,lf(t.maxUtil??void 0)]}):(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:``})},width:130},{id:`forecast`,header:`Forecast`,cell:e=>{let t=e.bottleneck??null,n=String(t?.forecastCrossingTs??``).trim();return(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:n?n.slice(0,10):``})},width:120},{id:`err`,header:`Notes`,cell:e=>{let t=(Array.isArray(e?.notes)?e.notes:[]).map(e=>String(e?.message??``).trim()).filter(Boolean),n=String(e?.error??``).trim(),r=[...t,n].filter(Boolean).join(`  `),i=Array.isArray(e?.unmatchedHopInterfacesSample)?e.unmatchedHopInterfacesSample.map(e=>String(e??``).trim()).filter(Boolean):[],a=String(e?.forwardQueryUrl??``).trim()||void 0;return(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:r||``}),i.length?(0,P.jsx)(`button`,{type:`button`,className:`text-xs text-muted-foreground hover:underline`,onClick:t=>{t.preventDefault(),t.stopPropagation();let n=e.query??{},o=String(n.srcIp??``).trim(),s=String(n.dstIp??``).trim();ut({title:`${o?`${o} -> `:``}${s||``}`,unmatched:i,notesText:r,forwardQueryUrl:a}),ct(!0)},children:`why`}):null]})},width:260}],rows:Ue.items??[],getRowId:e=>String(e.index),onRowClick:e=>{let t=e.bottleneck??null;t&&(d(t.direction===`EGRESS`?`util_egress`:`util_ingress`),de({id:`${t.deviceName}:${t.interfaceName}:${t.direction}:paths`,device:t.deviceName,iface:t.interfaceName,dir:t.direction,speedMbps:t.speedMbps??null,p95:t.p95Util??void 0,max:t.maxUtil??void 0,threshold:t.threshold??void 0,forecastCrossingTs:t.forecastCrossingTs??void 0,samples:0}))},emptyText:`No results.`,maxHeightClassName:`max-h-[520px]`,minWidthClassName:`min-w-0`}),jt.length?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Top bottlenecks in this batch`}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>{let t=[`deviceName`,`interfaceName`,`direction`,`flows`,`minHeadroomGbps`,`minHeadroomUtil`,`worstMaxUtil`,`soonestForecast`],n=jt.map(e=>[e.deviceName,e.interfaceName,e.direction,e.count,e.minHeadroomGbps??``,e.minHeadroomUtil??``,e.worstMaxUtil??``,e.soonestForecast??``]);tf(`path_bottlenecks_summary_${e}_${s}.csv`,`text/csv`,of(t,n))},children:`Export summary CSV`})]}),(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:240},{id:`iface`,header:`Interface`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.interfaceName}),width:220},{id:`dir`,header:`Dir`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.direction}),width:90},{id:`count`,header:`Flows`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.count}),width:80},{id:`headroom`,header:`Min headroom`,align:`right`,cell:e=>{let t=Number(e.minHeadroomGbps??NaN);if(Number.isFinite(t))return(0,P.jsxs)(`span`,{className:t<0?`text-xs font-medium text-destructive tabular-nums`:`text-xs tabular-nums`,children:[t.toFixed(2),`G`]});let n=Number(e.minHeadroomUtil??NaN);return Number.isFinite(n)?(0,P.jsxs)(`span`,{className:n<0?`text-xs font-medium text-destructive tabular-nums`:`text-xs tabular-nums`,children:[lf(n),` `,(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:`util`})]}):(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:``})},width:130},{id:`worst`,header:`Worst max`,align:`right`,cell:e=>lf(e.worstMaxUtil??void 0),width:110},{id:`forecast`,header:`Soonest`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.soonestForecast?e.soonestForecast.slice(0,10):``}),width:120}],rows:jt.slice(0,20),getRowId:e=>e.id,onRowClick:e=>{d(e.direction===`EGRESS`?`util_egress`:`util_ingress`),de({id:`${e.deviceName}:${e.interfaceName}:${e.direction}:paths-sum`,device:e.deviceName,iface:e.interfaceName,dir:e.direction,samples:0})},emptyText:``,maxHeightClassName:`max-h-[260px]`,minWidthClassName:`min-w-0`})]}):null,Mt.length?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Upgrade opportunities implied by this batch`}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>{let t=[`deviceName`,`interfaceName`,`direction`,`flows`,`minHeadroomGbps`,`minHeadroomUtil`,`requiredSpeedMbps`,`recommendedSpeedMbps`,`reason`],n=Mt.map(e=>[e.deviceName,e.interfaceName,e.direction,e.flows,e.minHeadroomGbps??``,e.minHeadroomUtil??``,e.requiredSpeedMbps??``,e.recommendedSpeedMbps??``,e.reason??``]);tf(`path_bottlenecks_upgrades_${e}_${s}.csv`,`text/csv`,of(t,n))},children:`Export upgrades CSV`})]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Derived by joining bottleneck interfaces to existing Upgrade Candidates (window `,s,`); this does not replace Forward workflows.`]}),(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:240},{id:`iface`,header:`Interface`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.interfaceName}),width:220},{id:`dir`,header:`Dir`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.direction}),width:90},{id:`flows`,header:`Flows`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.flows}),width:80},{id:`headroom`,header:`Min headroom`,align:`right`,cell:e=>{let t=Number(e.minHeadroomGbps??NaN);if(Number.isFinite(t))return(0,P.jsxs)(`span`,{className:t<0?`text-xs font-medium text-destructive tabular-nums`:`text-xs tabular-nums`,children:[t.toFixed(2),`G`]});let n=Number(e.minHeadroomUtil??NaN);return Number.isFinite(n)?(0,P.jsxs)(`span`,{className:n<0?`text-xs font-medium text-destructive tabular-nums`:`text-xs tabular-nums`,children:[lf(n),` `,(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:`util`})]}):(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:``})},width:130},{id:`rec`,header:`Rec`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:df(e.recommendedSpeedMbps)}),width:90},{id:`reason`,header:`Reason`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.reason||``}),width:220}],rows:Mt.slice(0,10),getRowId:e=>e.id,onRowClick:e=>{let t=Ue?.items??[],n=String(e.deviceName??``).trim().toLowerCase(),r=pf(String(e.interfaceName??``)),i=String(e.direction??``).trim().toUpperCase(),a=[];for(let e of t){let t=e.bottleneck??null;if(!t)continue;let o=String(t.deviceName??``).trim().toLowerCase(),s=pf(String(t.interfaceName??``)),c=String(t.direction??``).trim().toUpperCase();if(o!==n||s!==r||c!==i)continue;let l=e.query??{},u=String(l.srcIp??``).trim(),d=String(l.dstIp??``).trim(),f=sf(l.ipProto??void 0),p=String(l.dstPort??``).trim(),m=String(e.forwardingOutcome??``).trim(),h=String(e.securityOutcome??``).trim();a.push({id:String(e.index),index:e.index,src:u,dst:d,proto:f,port:p,outcome:[m,h].filter(Boolean).join(` / `),headroomGbps:t.headroomGbps??null,headroomUtil:t.headroomUtil??null,forwardQueryUrl:e.forwardQueryUrl})}ot({title:`${e.deviceName} ${e.interfaceName} ${e.direction}`,upgrade:e,flows:a}),it(!0)},emptyText:``,maxHeightClassName:`max-h-[260px]`,minWidthClassName:`min-w-0`})]}):null,Mt.length&&Ue?.items?.length?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Plan impact (simulation)`}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>ft(Mt.slice(0,3).map(e=>e.id)),children:`Select top 3`}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>ft([]),children:`Clear`}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>{let t=[`index`,`beforeHeadroomGbps`,`beforeHeadroomUtil`,`afterHeadroomGbps`,`afterHeadroomUtil`,`appliedSpeedMbps`,`reason`],n=Nt.items.map(e=>[e.index,e.beforeHeadroomGbps??``,e.beforeHeadroomUtil??``,e.afterHeadroomGbps??``,e.afterHeadroomUtil??``,e.appliedSpeedMbps??``,e.reason??``]);tf(`path_plan_sim_${e}_${s}.csv`,`text/csv`,of(t,n))},children:`Export sim CSV`})]})]}),(0,P.jsxs)(`div`,{className:`rounded-md border p-3 space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Assumption: keep traffic constant (estimate traffic from p95 util and speed), then recompute utilization/headroom at the upgraded speed. This is a planning approximation.`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-3 text-xs`,children:[(0,P.jsxs)(`div`,{children:[`Selected upgrades:`,` `,(0,P.jsx)(`span`,{className:`font-medium tabular-nums`,children:dt.length})]}),(0,P.jsxs)(`div`,{children:[`Simulated:`,` `,(0,P.jsx)(`span`,{className:`font-medium tabular-nums`,children:Nt.summary.simulated}),`  `,(0,P.jsxs)(`span`,{className:`text-muted-foreground`,children:[`cannot simulate:`,` `,Nt.summary.cannotSimulate]})]}),(0,P.jsxs)(`div`,{children:[`At-risk (headroom util < 0):`,` `,(0,P.jsx)(`span`,{className:`font-medium tabular-nums`,children:Nt.summary.atRiskBefore}),` `,(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:`before`}),` `,(0,P.jsx)(`span`,{className:`font-medium tabular-nums`,children:Nt.summary.atRiskAfter}),` `,(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:`after`})]})]}),(0,P.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:Mt.slice(0,10).map(e=>(0,P.jsxs)(`label`,{className:`flex items-center gap-2 rounded-md border px-2 py-1`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:dt.includes(e.id),onChange:t=>{let n=t.target.checked;ft(t=>{let r=new Set(t);return n?r.add(e.id):r.delete(e.id),Array.from(r.values())})}}),(0,P.jsxs)(`span`,{className:`text-xs font-mono`,children:[e.deviceName,` `,e.interfaceName,` `,e.direction]}),(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:df(e.recommendedSpeedMbps)}),(0,P.jsxs)(`span`,{className:`text-xs text-muted-foreground`,children:[`(`,e.flows,` flows)`]})]},e.id))})]})]}):null]}):(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Run a batch to see bottlenecks. If everything is "", click Refresh to compute rollups first.`})]})]})}),(0,P.jsxs)(Uc,{value:`routing`,className:`space-y-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{className:`text-base`,children:`VRF Summary (Perf + Scale)`})}),(0,P.jsx)(V,{children:A.isLoading?(0,P.jsx)(U,{className:`h-28 w-full`}):A.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,A.error instanceof Error?A.error.message:String(A.error)]}):(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:240},{id:`vrf`,header:`VRF`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:180},{id:`v4`,header:`IPv4`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.ipv4Routes}),width:90},{id:`v6`,header:`IPv6`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.ipv6Routes}),width:90},{id:`bgp`,header:`BGP`,align:`right`,cell:e=>(0,P.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[e.bgpNeighbors,` (`,e.bgpEstablished,`)`]}),width:110},{id:`max`,header:`Max util`,align:`right`,cell:e=>lf(e.maxIfaceMax),width:100},{id:`forecast`,header:`Soonest`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.soonestForecast?e.soonestForecast.slice(0,10):``}),width:120}],rows:nn,getRowId:e=>e.id,onRowClick:e=>{Ce(e.deviceName),Te(e.vrf),x(e.vrf)},emptyText:`No VRF summary available yet. Click Refresh to enqueue.`,maxHeightClassName:`max-h-[360px]`,minWidthClassName:`min-w-0`})})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-2 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Hardware Capacity (TCAM)`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Derived from Forward CUSTOM command outputs. Configure a TCAM command collection to populate.`})]}),(0,P.jsx)(V,{children:A.isLoading?(0,P.jsx)(U,{className:`h-28 w-full`}):A.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,A.error instanceof Error?A.error.message:String(A.error)]}):(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:240},{id:`meta`,header:`Meta`,cell:e=>(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[(0,P.jsx)(`div`,{children:[e.vendor??``,e.os??``].filter(Boolean).join(`  `)||``}),(0,P.jsx)(`div`,{className:`font-mono`,children:String(e.model??``)})]}),width:240},{id:`used`,header:`Used`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:Number(e.tcamUsed??0)}),width:90},{id:`total`,header:`Total`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:Number(e.tcamTotal??0)}),width:90},{id:`util`,header:`Util`,align:`right`,cell:e=>{let t=Number(e.tcamUsed??0),n=Number(e.tcamTotal??0);return n?(0,P.jsx)(`span`,{className:`text-xs`,children:lf(t/n)}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90},{id:`cmd`,header:`Command`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:String(e.commandText??``).slice(0,48)||``}),width:260},{id:`evidence`,header:`Evidence`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:String(e.evidence??``).slice(0,60)||``}),width:320}],rows:tn,getRowId:e=>e.deviceName,onRowClick:e=>{Ce(e.deviceName),ke([`device: ${String(e.deviceName??``)}`,`command: ${String(e.commandText??``)}`,`used/total: ${Number(e.tcamUsed??0)}/${Number(e.tcamTotal??0)}`,``,String(e.evidence??``)].join(`
`)),De(!0)},emptyText:`No TCAM rows cached yet. Click Refresh after enabling custom commands.`,maxHeightClassName:`max-h-[320px]`,minWidthClassName:`min-w-0`})})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Routing Scale`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsxs)(q,{value:D,onValueChange:Ce,children:[(0,P.jsx)(Y,{className:`w-[220px]`,children:(0,P.jsx)(J,{placeholder:`Device`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All devices`}),Qt.devices.map(e=>(0,P.jsx)(Z,{value:e,children:e},e))]})]}),(0,P.jsxs)(q,{value:we,onValueChange:Te,children:[(0,P.jsx)(Y,{className:`w-[170px]`,children:(0,P.jsx)(J,{placeholder:`VRF`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All VRFs`}),Qt.vrfs.map(e=>(0,P.jsx)(Z,{value:e,children:e},e))]})]}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>{Ce(`all`),Te(`all`)},disabled:D===`all`&&we===`all`,children:`Clear`})]})]}),(0,P.jsx)(V,{children:A.isLoading?(0,P.jsx)(U,{className:`h-28 w-full`}):A.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,A.error instanceof Error?A.error.message:String(A.error)]}):(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:240},{id:`vrf`,header:`VRF`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:180},{id:`v4`,header:`IPv4`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.ipv4Routes}),width:90},{id:`v6`,header:`IPv6`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.ipv6Routes}),width:90}],rows:$t,getRowId:e=>`${e.deviceName}:${e.vrf}`,emptyText:`No routing scale cached yet. Click Refresh to enqueue.`})})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{className:`text-base`,children:`BGP Neighbors`})}),(0,P.jsx)(V,{children:A.isLoading?(0,P.jsx)(U,{className:`h-28 w-full`}):A.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,A.error instanceof Error?A.error.message:String(A.error)]}):(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:220},{id:`vrf`,header:`VRF`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:160},{id:`nbr`,header:`Neighbor`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.neighborAddress}),width:220},{id:`state`,header:`State`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.sessionState??``}),width:120},{id:`rx`,header:`Rx`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.receivedPrefixes??``}),width:90},{id:`tx`,header:`Tx`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.advertisedPrefixes??``}),width:90}],rows:en,getRowId:e=>`${e.deviceName}:${e.vrf}:${e.neighborAddress}`,emptyText:`No BGP cache yet. Click Refresh to enqueue.`})})]})]}),(0,P.jsxs)(Uc,{value:`changes`,className:`space-y-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{className:`text-base`,children:`Snapshot Delta`})}),(0,P.jsx)(V,{className:`space-y-2`,children:_t.isLoading?(0,P.jsx)(U,{className:`h-24 w-full`}):_t.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load snapshot delta:`,` `,_t.error instanceof Error?_t.error.message:String(_t.error)]}):(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Latest:`,` `,(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:_t.data?.latestSnapshotId??``}),`  `,`Prev:`,` `,(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:_t.data?.prevSnapshotId??``})]}),(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`Route Scale Changes`})}),(0,P.jsx)(V,{children:(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:220},{id:`vrf`,header:`VRF`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:160},{id:`v4`,header:`IPv4 `,align:`right`,cell:e=>{let t=Number(e.ipv4Delta??0);return(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:t>0?`+${t}`:String(t)})},width:90},{id:`v6`,header:`IPv6 `,align:`right`,cell:e=>{let t=Number(e.ipv6Delta??0);return(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:t>0?`+${t}`:String(t)})},width:90}],rows:_t.data?.routeDelta??[],getRowId:e=>`${e.deviceName}:${e.vrf}`,emptyText:`No route scale deltas between last two snapshots.`,maxHeightClassName:`max-h-[320px]`,minWidthClassName:`min-w-0`})})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`BGP Neighbor Changes`})}),(0,P.jsx)(V,{children:(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:220},{id:`vrf`,header:`VRF`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:160},{id:`nbr`,header:`Nbrs `,align:`right`,cell:e=>{let t=Number(e.neighborsDelta??0);return(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:t>0?`+${t}`:String(t)})},width:80},{id:`est`,header:`Est `,align:`right`,cell:e=>{let t=Number(e.establishedDelta??0);return(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:t>0?`+${t}`:String(t)})},width:80}],rows:_t.data?.bgpDelta??[],getRowId:e=>`${e.deviceName}:${e.vrf}`,emptyText:`No BGP scale deltas between last two snapshots.`,maxHeightClassName:`max-h-[320px]`,minWidthClassName:`min-w-0`})})]})]})]})})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{className:`text-base`,children:`Inventory Changes`})}),(0,P.jsx)(V,{className:`space-y-4`,children:_t.isLoading?(0,P.jsx)(U,{className:`h-24 w-full`}):_t.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory delta:`,` `,_t.error instanceof Error?_t.error.message:String(_t.error)]}):(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-4 md:grid-cols-2`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`Devices`})}),(0,P.jsx)(V,{children:(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:220},{id:`type`,header:`Change`,cell:e=>(0,P.jsx)(W,{variant:e.changeType===`added`?`secondary`:e.changeType===`removed`?`destructive`:`outline`,children:String(e.changeType||`changed`)}),width:110},{id:`changes`,header:`Details`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:(e.changes??[]).length?(e.changes??[]).join(`, `):``}),width:420}],rows:_t.data?.deviceDelta??[],getRowId:e=>`${e.deviceName}:${e.changeType}`,emptyText:`No device inventory changes between last two snapshots.`,maxHeightClassName:`max-h-[360px]`,minWidthClassName:`min-w-0`})})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`Interfaces`})}),(0,P.jsx)(V,{children:(0,P.jsx)($s,{columns:[{id:`iface`,header:`Interface`,cell:e=>(0,P.jsxs)(`div`,{className:`space-y-0.5`,children:[(0,P.jsxs)(`div`,{className:`font-mono text-xs`,children:[e.deviceName,`:`,e.interfaceName]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:(e.changes??[]).length?(e.changes??[]).join(`, `):``})]}),width:420},{id:`type`,header:`Change`,cell:e=>(0,P.jsx)(W,{variant:e.changeType===`added`?`secondary`:e.changeType===`removed`?`destructive`:`outline`,children:String(e.changeType||`changed`)}),width:110}],rows:_t.data?.interfaceDelta??[],getRowId:e=>`${e.deviceName}:${e.interfaceName}:${e.changeType}`,emptyText:`No interface inventory changes between last two snapshots.`,maxHeightClassName:`max-h-[360px]`,minWidthClassName:`min-w-0`})})]})]})})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{className:`text-base`,children:`LAG Member Imbalance`})}),(0,P.jsxs)(V,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Highlights port-channels / LAGs where one member is running hot or disproportionately loaded (based on rollups for `,s,`).`]}),A.isLoading||ht.isLoading?(0,P.jsx)(U,{className:`h-24 w-full`}):A.isError||ht.isError?(0,P.jsx)(`div`,{className:`text-destructive text-sm`,children:`Failed to compute LAG imbalance.`}):(0,P.jsx)($s,{columns:[{id:`lag`,header:`LAG`,cell:e=>(0,P.jsxs)(`div`,{className:`space-y-0.5`,children:[(0,P.jsxs)(`div`,{className:`font-mono text-xs`,children:[e.deviceName,`:`,e.lagName]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[e.memberCount,` members`,e.totalSpeedMbps?`  ${df(e.totalSpeedMbps)}`:``]})]}),width:360},{id:`worst`,header:`Worst member`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:Number(e.worstMemberMaxUtil??0)>=.85?`text-destructive font-medium`:`text-foreground`,children:lf(Number(e.worstMemberMaxUtil??0))}),width:120},{id:`spread`,header:`Spread`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:lf(Number(e.spread??0))}),width:90},{id:`hot`,header:`Hot`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:Number(e.hotMembers??0)}),width:70},{id:`forecast`,header:`Soonest`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.soonestForecast?String(e.soonestForecast).slice(0,10):``}),width:110}],rows:xt,getRowId:e=>e.id,onRowClick:e=>{Pe({deviceName:String(e.deviceName??``),lagName:String(e.lagName??``),totalSpeedMbps:e.totalSpeedMbps,members:e.members??[]}),O(!0)},emptyText:`No LAG imbalance signals in this window.`,maxHeightClassName:`max-h-[420px]`,minWidthClassName:`min-w-0`})]})]})]}),(0,P.jsx)(Uc,{value:`health`,className:`space-y-4`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Health Issues`}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>Ct.mutate(),disabled:Ct.isPending,children:Ct.isPending?`Loading`:`Load unhealthy devices`})]}),(0,P.jsx)(V,{className:`space-y-2`,children:pe?(0,P.jsx)(`pre`,{className:`max-h-[60vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:ef(pe)}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loads Forward health signals (including high utilization) around the latest processed snapshot.`})})]})}),(0,P.jsxs)(Uc,{value:`raw`,className:`space-y-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{className:`text-base`,children:`Raw Rollups`})}),(0,P.jsx)(V,{className:`space-y-2`,children:ht.isLoading?(0,P.jsx)(U,{className:`h-32 w-full`}):ht.isError?(0,P.jsx)(`div`,{className:`text-destructive text-sm`,children:ht.error instanceof Error?ht.error.message:String(ht.error)}):(0,P.jsx)(`pre`,{className:`max-h-[65vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:ef(ht.data?.rollups??[])})})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{className:`text-base`,children:`Raw Inventory`})}),(0,P.jsx)(V,{className:`space-y-2`,children:A.isLoading?(0,P.jsx)(U,{className:`h-32 w-full`}):A.isError?(0,P.jsx)(`div`,{className:`text-destructive text-sm`,children:A.error instanceof Error?A.error.message:String(A.error)}):(0,P.jsx)(`pre`,{className:`max-h-[65vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:ef(A.data??{})})})]})]})]}),(0,P.jsx)(tr,{open:!!T,onOpenChange:e=>!e&&de(null),children:(0,P.jsxs)(ir,{className:`max-w-3xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-base`,children:`Interface Trend`})}),T?(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`text-sm`,children:[(0,P.jsxs)(`span`,{className:`font-mono text-xs`,children:[T.device,` `,T.iface,` `,T.dir]}),` `,(0,P.jsx)(W,{variant:`outline`,className:`ml-2`,children:s}),(0,P.jsx)(W,{variant:`secondary`,className:`ml-2`,children:u}),(0,P.jsxs)(q,{value:T.dir,onValueChange:e=>de(t=>t&&{...t,dir:String(e)}),children:[(0,P.jsx)(Y,{className:`ml-2 inline-flex h-7 w-[140px]`,children:(0,P.jsx)(J,{placeholder:`Direction`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`INGRESS`,children:`INGRESS`}),(0,P.jsx)(Z,{value:`EGRESS`,children:`EGRESS`})]})]}),T.vrf||T.vrfNames?.length?(0,P.jsxs)(`div`,{className:`mt-2 flex flex-wrap items-center gap-2 text-xs`,children:[(0,P.jsx)(W,{variant:`outline`,className:`font-mono text-xs`,children:`VRF`}),(0,P.jsxs)(`span`,{className:`font-mono text-xs`,children:[T.vrf??(T.vrfNames??[]).slice(0,3).join(`, `),(T.vrfNames??[]).length>3?``:``]}),(0,P.jsx)(F,{variant:`outline`,className:`h-7 px-2`,onClick:()=>{Ce(T.device),Te(T.vrf??T.vrfNames?.[0]??`all`)},title:`Filter Routing/BGP tables to this device/VRF`,children:`Filter routing`})]}):null]}),Bt.isLoading?(0,P.jsx)(U,{className:`h-24 w-full`}):Bt.isError?(0,P.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load history`}):(0,P.jsx)(Zd,{points:Ht}),(()=>{let e=T.vrfNames?.length?T.vrfNames:T.vrf?[T.vrf]:[];if(!e.length)return null;let t=(A.data?.routeScale??[]).filter(t=>t.deviceName===T.device&&e.includes(t.vrf)),n=(A.data?.bgpNeighbors??[]).filter(t=>t.deviceName===T.device&&e.includes(t.vrf)),r=t.reduce((e,t)=>e+Number(t.ipv4Routes??0),0),i=t.reduce((e,t)=>e+Number(t.ipv6Routes??0),0),a=n.filter(e=>String(e.sessionState??``).toUpperCase().includes(`ESTABLISHED`)).length;return(0,P.jsxs)(`div`,{className:`rounded-md border bg-muted/20 p-3 text-xs`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center justify-between gap-2`,children:[(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[`Routing context for`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:e.slice(0,3).join(`, `)}),e.length>3?``:``]}),(0,P.jsx)(F,{variant:`outline`,className:`h-7 px-2`,onClick:()=>{Ce(T.device),Te(e[0]??`all`)},children:`View in Routing tab`})]}),(0,P.jsxs)(`div`,{className:`mt-2 grid grid-cols-2 gap-2`,children:[(0,P.jsxs)(`div`,{children:[`FIB routes (sum):`,` `,(0,P.jsxs)(`span`,{className:`font-mono`,children:[`v4=`,r,` v6=`,i]})]}),(0,P.jsxs)(`div`,{className:`text-right`,children:[`BGP neighbors:`,` `,(0,P.jsxs)(`span`,{className:`font-mono`,children:[n.length,` (`,a,` established)`]})]})]})]})})(),(0,P.jsxs)(`div`,{className:`grid grid-cols-2 gap-3 text-xs text-muted-foreground`,children:[(0,P.jsxs)(`div`,{children:[`p95:`,` `,u.startsWith(`util_`)?lf(T.p95??Wt.p95??void 0):uf(T.p95??Wt.p95??void 0)]}),(0,P.jsxs)(`div`,{className:`text-right`,children:[`max:`,` `,u.startsWith(`util_`)?lf(T.max??Wt.max??void 0):uf(T.max??Wt.max??void 0)]}),(0,P.jsxs)(`div`,{children:[`slope/day:`,` `,u.startsWith(`util_`)?lf(T.slopePerDay):uf(T.slopePerDay)]}),(0,P.jsxs)(`div`,{className:`text-right`,children:[`forecast:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:T.forecastCrossingTs??``})]}),(0,P.jsxs)(`div`,{children:[`speed: `,df(T.speedMbps??null)]}),(0,P.jsxs)(`div`,{className:`text-right`,children:[`p95 (Gbps): `,(()=>{if(!u.startsWith(`util_`))return``;let e=Number(T.speedMbps??0),t=Number(T.p95??Wt.p95??NaN);return!e||!Number.isFinite(t)?``:(t*e/1e3).toFixed(2)})()]})]})]}):null]})}),(0,P.jsx)(tr,{open:!!fe,onOpenChange:e=>!e&&E(null),children:(0,P.jsxs)(ir,{className:`max-w-3xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-base`,children:`Device Trend`})}),fe?(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`text-sm`,children:[(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:fe.device}),` `,(0,P.jsx)(W,{variant:`outline`,className:`ml-2`,children:s}),(0,P.jsx)(W,{variant:`secondary`,className:`ml-2`,children:f})]}),Vt.isLoading?(0,P.jsx)(U,{className:`h-24 w-full`}):Vt.isError?(0,P.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load history`}):(0,P.jsx)(Zd,{points:Ut}),(0,P.jsxs)(`div`,{className:`grid grid-cols-2 gap-3 text-xs text-muted-foreground`,children:[(0,P.jsxs)(`div`,{children:[`p95:`,` `,lf(fe.p95??Gt.p95??void 0)]}),(0,P.jsxs)(`div`,{className:`text-right`,children:[`max:`,` `,lf(fe.max??Gt.max??void 0)]}),(0,P.jsxs)(`div`,{children:[`slope/day: `,lf(fe.slopePerDay)]}),(0,P.jsxs)(`div`,{className:`text-right`,children:[`forecast:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:fe.forecastCrossingTs??``})]})]})]}):null]})}),(0,P.jsx)(tr,{open:he,onOpenChange:e=>!e&&ge(!1),children:(0,P.jsxs)(ir,{className:`max-w-2xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-base`,children:`Pick Interface`})}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsx)(K,{placeholder:`Search device/interface`,value:_e,onChange:e=>ve(e.target.value)}),(0,P.jsx)(`div`,{className:`max-h-[55vh] overflow-auto rounded-md border`,children:(()=>{let e=A.data?.interfaces??[],t=_e.trim().toLowerCase(),n=(t?e.filter(e=>{let n=String(e.deviceName??``).toLowerCase(),r=String(e.interfaceName??``).toLowerCase();return n.includes(t)||r.includes(t)}):e).slice(0,200);return n.length?(0,P.jsx)(`div`,{className:`divide-y`,children:n.map(e=>{let t=String(e.deviceName??``),n=String(e.interfaceName??``),r=df(e.speedMbps??null);return(0,P.jsx)(`button`,{type:`button`,className:`w-full px-3 py-2 text-left hover:bg-muted/40`,onClick:()=>{de({id:`${t}:${n}:INGRESS:pick`,device:t,iface:n,dir:`INGRESS`,speedMbps:e.speedMbps??null,admin:e.adminStatus??void 0,oper:e.operStatus??void 0,samples:0}),ge(!1)},children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsxs)(`div`,{className:`font-mono text-xs`,children:[t,` `,n]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:r})]})},`${t}:${n}`)})}):(0,P.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:`No matches.`})})()}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Loads a trend directly from Forward perf history (not limited to the top-50 rollups).`})]})]})}),(0,P.jsx)(tr,{open:Ee,onOpenChange:e=>!e&&De(!1),children:(0,P.jsxs)(ir,{className:`max-w-4xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-base`,children:`TCAM Evidence`})}),(0,P.jsx)(`pre`,{className:`max-h-[70vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:Oe||``})]})}),(0,P.jsx)(tr,{open:ye,onOpenChange:e=>!e&&be(!1),children:(0,P.jsxs)(ir,{className:`max-w-2xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-base`,children:`Pick Device`})}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsx)(K,{placeholder:`Search device`,value:xe,onChange:e=>Se(e.target.value)}),(0,P.jsx)(`div`,{className:`max-h-[55vh] overflow-auto rounded-md border`,children:(()=>{let e=A.data?.devices??[],t=xe.trim().toLowerCase(),n=(t?e.filter(e=>{let n=String(e.deviceName??``).toLowerCase(),r=String(e.vendor??``).toLowerCase(),i=String(e.os??``).toLowerCase();return n.includes(t)||r.includes(t)||i.includes(t)}):e).slice(0,200);return n.length?(0,P.jsx)(`div`,{className:`divide-y`,children:n.map(e=>{let t=String(e.deviceName??``);return(0,P.jsx)(`button`,{type:`button`,className:`w-full px-3 py-2 text-left hover:bg-muted/40`,onClick:()=>{E({id:`${t}:pick`,device:t,metric:f,vendor:e.vendor??void 0,os:e.os??void 0,model:e.model??void 0,samples:0}),be(!1)},children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsx)(`div`,{className:`font-mono text-xs`,children:t}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:[e.vendor??``,e.os??``].filter(Boolean).join(`  `)||``})]})},t)})}):(0,P.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:`No matches.`})})()}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Loads a trend directly from Forward perf history.`})]})]})}),(0,P.jsx)(tr,{open:Me,onOpenChange:e=>!e&&O(!1),children:(0,P.jsxs)(ir,{className:`max-w-3xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-base`,children:`LAG Details`})}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`text-sm`,children:[(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:Ne?`${Ne.deviceName}:${Ne.lagName}`:``}),Ne?.totalSpeedMbps?(0,P.jsxs)(`span`,{className:`text-muted-foreground text-xs`,children:[` `,`  `,` speed `,df(Ne.totalSpeedMbps)]}):null]}),(0,P.jsx)($s,{columns:[{id:`iface`,header:`Member`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:String(e.interfaceName??``)}),width:240},{id:`speed`,header:`Speed`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:df(Number(e.speedMbps??0)||null)}),width:90},{id:`dir`,header:`Worst`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:String(e.worstDirection??``)}),width:90},{id:`max`,header:`Max`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:Number(e.maxUtil??0)>=.85?`text-destructive font-medium`:``,children:lf(Number(e.maxUtil??0))}),width:90},{id:`p95`,header:`p95`,align:`right`,cell:e=>lf(Number(e.p95Util??0)),width:90},{id:`forecast`,header:`Forecast`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.forecast?String(e.forecast).slice(0,10):``}),width:110}],rows:Ne?.members??[],getRowId:e=>String(e.interfaceName??``),emptyText:`No member rows.`,maxHeightClassName:`max-h-[55vh]`,minWidthClassName:`min-w-0`})]})]})}),(0,P.jsx)(tr,{open:$e,onOpenChange:et,children:(0,P.jsxs)(ir,{className:`max-w-3xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-sm`,children:`Paths Coverage`})}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Paths are computed against a Forward snapshot (can be older than perf). Interface utilization is joined from Skyforge rollups, with bounded on-demand perf fallback when rollups are missing.`}),(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-2 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`rounded-md border p-3 space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Snapshot`}),(0,P.jsx)(`div`,{className:`font-mono text-xs`,children:String(Ue?.snapshotId??``).trim()||`latest`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground mt-2`,children:`Window`}),(0,P.jsx)(`div`,{className:`font-mono text-xs`,children:String(Ue?.window??s)}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground mt-2`,children:`Rollups as-of`}),(0,P.jsxs)(`div`,{className:`font-mono text-xs`,children:[String(ht.data?.asOf??``),ht.data?.stale?(0,P.jsx)(`span`,{className:`ml-2`,children:(0,P.jsx)(W,{variant:`destructive`,children:`stale`})}):null]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground mt-2`,children:`Inventory as-of`}),(0,P.jsx)(`div`,{className:`font-mono text-xs`,children:String(A.data?.asOf??``)})]}),(0,P.jsxs)(`div`,{className:`rounded-md border p-3 space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Hop interface keys`}),(0,P.jsx)(`div`,{className:`font-mono text-xs`,children:Number(Ue?.coverage?.hopInterfaceKeys??0)}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground mt-2`,children:`Rollup matched / Perf fallback / Unknown`}),(0,P.jsxs)(`div`,{className:`font-mono text-xs`,children:[Number(Ue?.coverage?.rollupMatched??0),` /`,` `,Number(Ue?.coverage?.perfFallbackUsed??0),` /`,` `,Number(Ue?.coverage?.unknown??0)]}),Ue?.coverage?.truncated?(0,P.jsx)(`div`,{className:`mt-2`,children:(0,P.jsx)(W,{variant:`destructive`,children:`fallback truncated`})}):null]})]}),(Ue?.coverage?.unmatchedHopInterfacesSample??[]).length?(0,P.jsxs)(`div`,{className:`rounded-md border p-3 space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Unmatched hop interfaces (sample)`}),(0,P.jsx)(`pre`,{className:`max-h-[260px] overflow-auto whitespace-pre-wrap break-words rounded-md bg-muted p-2 font-mono text-xs`,children:(Ue?.coverage?.unmatchedHopInterfacesSample??[]).map(String).join(`
`)})]}):null]})]})}),(0,P.jsx)(tr,{open:tt,onOpenChange:nt,children:(0,P.jsxs)(ir,{className:`max-w-3xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-sm`,children:`Forward /paths-bulk Payload`})}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`This is the exact bulk-path request shape Skyforge uses (guardrails applied). Use it to reproduce results or hand off deeper analysis to Forward without duplicating Forward UI.`}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(F,{size:`sm`,onClick:async()=>{let t=At;if(!t){j.error(`Nothing to copy`,{description:`Enter/parse at least one flow first.`});return}await nf(t)?j.success(`Copied payload`):(tf(`forward_paths_bulk_payload_${e}.json`,`application/json`,t),j.message(`Clipboard not available`,{description:`Downloaded JSON instead.`}))},children:`Copy`}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>{let t=At;t&&tf(`forward_paths_bulk_payload_${e}.json`,`application/json`,t)},disabled:!At,children:`Download`})]}),(0,P.jsx)(`pre`,{className:`max-h-[55vh] overflow-auto whitespace-pre rounded-md border bg-muted p-3 font-mono text-xs`,children:At||`Enter at least one flow (or JSON with { queries: [...] }).`})]})]})}),(0,P.jsx)(tr,{open:rt,onOpenChange:it,children:(0,P.jsxs)(ir,{className:`max-w-4xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-sm`,children:`Upgrade Impact (Batch)`})}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:at?.title??``}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-3`,children:[(0,P.jsxs)(`div`,{className:`text-xs`,children:[`Flows:`,` `,(0,P.jsx)(`span`,{className:`font-medium tabular-nums`,children:at?.flows.length??0})]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Rec:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:df(at?.upgrade.recommendedSpeedMbps)})]}),at?.upgrade.reason?(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Reason:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:at.upgrade.reason})]}):null,(0,P.jsx)(F,{variant:`outline`,size:`sm`,disabled:!at?.flows.length,onClick:()=>{let t=at?.upgrade,n=at?.flows??[];if(!t||!n.length)return;let r=[`deviceName`,`interfaceName`,`direction`,`index`,`srcIp`,`dstIp`,`proto`,`dstPort`,`outcome`,`headroomGbps`,`headroomUtil`,`forwardQueryUrl`],i=n.map(e=>[t.deviceName,t.interfaceName,t.direction,e.index,e.src,e.dst,e.proto,e.port,e.outcome,e.headroomGbps??``,e.headroomUtil??``,e.forwardQueryUrl??``]);tf(`upgrade_impact_flows_${e}_${s}.csv`,`text/csv`,of(r,i))},children:`Export flows CSV`})]}),(0,P.jsx)($s,{columns:[{id:`flow`,header:`Flow`,cell:e=>(0,P.jsxs)(`div`,{className:`text-xs`,children:[(0,P.jsxs)(`div`,{className:`font-mono`,children:[e.src?`${e.src} -> `:``,e.dst||``]}),(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:[e.proto,e.port].filter(Boolean).join(` `)})]}),width:360},{id:`outcome`,header:`Outcome`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.outcome||``}),width:200},{id:`headroom`,header:`Headroom`,align:`right`,cell:e=>{let t=Number(e.headroomGbps??NaN);if(Number.isFinite(t))return(0,P.jsxs)(`span`,{className:t<0?`text-xs font-medium text-destructive tabular-nums`:`text-xs tabular-nums`,children:[t.toFixed(2),`G`]});let n=Number(e.headroomUtil??NaN);return Number.isFinite(n)?(0,P.jsxs)(`span`,{className:n<0?`text-xs font-medium text-destructive tabular-nums`:`text-xs tabular-nums`,children:[lf(n),` `,(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:`util`})]}):(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:``})},width:120},{id:`forward`,header:`Forward`,cell:e=>{let t=String(e.forwardQueryUrl??``).trim();return t?(0,P.jsx)(`a`,{href:t,target:`_blank`,rel:`noreferrer`,className:`text-xs text-muted-foreground hover:underline`,children:`open`}):(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:``})},width:90}],rows:at?.flows??[],getRowId:e=>e.id,emptyText:`No matching flows (this can happen if interface naming differs).`,maxHeightClassName:`max-h-[55vh]`,minWidthClassName:`min-w-0`})]})]})}),(0,P.jsx)(tr,{open:st,onOpenChange:ct,children:(0,P.jsxs)(ir,{className:`max-w-3xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-sm`,children:`Why Unknown?`})}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:lt?.title??``}),lt?.notesText?(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:lt.notesText}):null,lt?.forwardQueryUrl?(0,P.jsx)(`div`,{children:(0,P.jsx)(`a`,{href:lt.forwardQueryUrl,target:`_blank`,rel:`noreferrer`,className:`text-xs text-muted-foreground hover:underline`,children:`Open in Forward`})}):null,(0,P.jsxs)(`div`,{className:`rounded-md border p-3 space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Hop interfaces missing utilization stats (sample)`}),(0,P.jsx)(`pre`,{className:`max-h-[320px] overflow-auto whitespace-pre-wrap break-words rounded-md bg-muted p-2 font-mono text-xs`,children:(lt?.unmatched??[]).join(`
`)||``})]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Common causes: missing rollups (run Refresh), interface naming mismatches (vendor quirks), or Forward perf history unavailable for the hop interface.`})]})]})}),(0,P.jsx)(tr,{open:Ye,onOpenChange:Xe,children:(0,P.jsxs)(ir,{className:`max-w-3xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-sm`,children:`Hops`})}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:Ze?.title??``}),(0,P.jsx)(`div`,{className:`max-h-[420px] overflow-auto rounded-md border`,children:(0,P.jsxs)(`table`,{className:`w-full text-xs`,children:[(0,P.jsx)(`thead`,{className:`sticky top-0 bg-background border-b`,children:(0,P.jsxs)(`tr`,{children:[(0,P.jsx)(`th`,{className:`text-left p-2 w-[60px]`,children:`#`}),(0,P.jsx)(`th`,{className:`text-left p-2`,children:`Device`}),(0,P.jsx)(`th`,{className:`text-left p-2`,children:`Ingress`}),(0,P.jsx)(`th`,{className:`text-left p-2`,children:`Egress`})]})}),(0,P.jsxs)(`tbody`,{children:[(Ze?.hops??[]).map((e,t)=>(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`td`,{className:`p-2 text-muted-foreground`,children:t+1}),(0,P.jsx)(`td`,{className:`p-2 font-mono`,children:String(e.deviceName??``)}),(0,P.jsx)(`td`,{className:`p-2 font-mono`,children:String(e.ingressInterface??``)||``}),(0,P.jsx)(`td`,{className:`p-2 font-mono`,children:String(e.egressInterface??``)||``})]},`${t}:${e.deviceName??``}`)),(Ze?.hops??[]).length===0?(0,P.jsx)(`tr`,{children:(0,P.jsx)(`td`,{className:`p-3 text-muted-foreground`,colSpan:4,children:`No hops in response. Enable include hops and re-run.`})}):null]})]})})]})})]}):(0,P.jsxs)(`div`,{className:a?`space-y-6`:`space-y-6 p-6`,children:[a?null:(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(p,{to:`/dashboard/forward-networks`,search:{workspace:``},className:Cr({variant:`outline`,size:`icon`,className:`h-9 w-9`}),children:(0,P.jsx)(ee,{className:`h-4 w-4`})}),(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Capacity`})]}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`pt-6 text-sm text-muted-foreground`,children:`Workspace is required.`})})]})}async function xf(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/assurance/studio/scenarios`)}async function Sf(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/assurance/studio/scenarios`,{method:`POST`,body:JSON.stringify(n??{})})}async function Cf(e,t,n,r){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/assurance/studio/scenarios/${encodeURIComponent(n)}`,{method:`PUT`,body:JSON.stringify(r??{})})}async function wf(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/assurance/studio/scenarios/${encodeURIComponent(n)}`,{method:`DELETE`})}async function Tf(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/assurance/studio/evaluate`,{method:`POST`,body:JSON.stringify(n??{})})}async function Ef(e,t){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/assurance/studio/runs`)}async function Df(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/assurance/studio/runs`,{method:`POST`,body:JSON.stringify(n??{})})}async function Of(e,t,n){return I(`/api/workspaces/${encodeURIComponent(e)}/forward-networks/${encodeURIComponent(t)}/assurance/studio/runs/${encodeURIComponent(n)}`)}var kf=Qn({workspace:qn().optional().catch(``),scenario:qn().optional().catch(``),tab:qn().optional().catch(`routing`)});const Af=t(`/dashboard/forward-networks/$networkRef/assurance-studio`)({validateSearch:e=>kf.parse(e),component:Rf});function jf(e){let t=String(e??``).trim();if(!t)return``;let n=Date.parse(t);return Number.isFinite(n)?new Date(n).toISOString():t}function Mf(e){let t=Number(e??NaN);if(!Number.isFinite(t)||t<0)return``;let n=Math.floor(t/60),r=Math.floor(n/60);return r>0?`${r}h ${n%60}m`:n>0?`${n}m`:`${Math.floor(t)}s`}function Nf(e){return String(e??``).split(`,`).map(e=>e.trim()).filter(Boolean)}function Pf(e,t,n){let r=new Blob([n],{type:t}),i=URL.createObjectURL(r);try{let t=document.createElement(`a`);t.href=i,t.download=e,t.click()}finally{URL.revokeObjectURL(i)}}function Ff(e){let t=[`from,srcIp,dstIp,ipProto,srcPort,dstPort,bandwidthGbps,label`];for(let n of e??[]){let e=String(n.from??``).replaceAll(`,`,` `).trim(),r=String(n.srcIp??``).replaceAll(`,`,` `).trim(),i=String(n.dstIp??``).replaceAll(`,`,` `).trim(),a=n.ipProto===void 0?``:String(n.ipProto),o=String(n.srcPort??``).replaceAll(`,`,` `).trim(),s=String(n.dstPort??``).replaceAll(`,`,` `).trim(),c=n.bandwidthGbps===void 0?``:String(n.bandwidthGbps),l=String(n.label??``).replaceAll(`,`,` `).trim();t.push([e,r,i,a,o,s,c,l].join(`,`))}return t.join(`
`)+`
`}function If(e){let t=[],n=String(e??``).split(/\r?\n/).map(e=>e.trim()).filter(Boolean);if(!n.length)return t;let r=n[0].toLowerCase(),i=r.includes(`dstip`)||r.includes(`bandwidth`)||r.includes(`ipproto`),a=i?1:0;for(let e=a;e<n.length;e++){let r=n[e].split(`,`).map(e=>e.trim());if(!r.length)continue;let a=!i&&r.length<=4,o=(r[0]??``).trim(),s=a?``:(r[1]??``).trim(),c=a?(r[1]??``).trim():(r[2]??``).trim();if(!c)continue;let l=a?``:(r[3]??``).trim(),u=a?``:(r[4]??``).trim(),d=a?``:(r[5]??``).trim(),f=a?(r[2]??``).trim():(r[6]??``).trim(),p=a?(r[3]??``).trim():(r[7]??``).trim(),m=f?Number(f):NaN,h=l?Number(l):NaN;t.push({from:o||void 0,srcIp:s||void 0,dstIp:c,ipProto:Number.isFinite(h)?h:void 0,srcPort:u||void 0,dstPort:d||void 0,bandwidthGbps:Number.isFinite(m)?m:void 0,label:p||void 0})}return t}function Lf(e){let t=[];for(let n of e??[]){let e=String(n.srcIp??``).trim(),r=String(n.dstIp??``).trim();if(!e||!r)continue;let i=n.ipProto===void 0?``:String(n.ipProto),a=String(n.dstPort??``).trim(),o=[e,r];i&&o.push(i),a&&o.push(a),t.push(o.join(` `))}return t.join(`
`)}function Rf(){let{networkRef:e}=Af.useParams(),{workspace:t,scenario:n,tab:a}=Af.useSearch(),o=Af.useNavigate(),s=c(),l=String(t??``).trim(),u=String(n??``).trim(),d=String(a??`routing`)||`routing`,f=!!i({queryKey:H.session(),queryFn:Br,staleTime:3e4,retry:!1}).data?.isAdmin,[m,h]=(0,M.useState)(!1),[g,_]=(0,M.useState)(``),[v,te]=(0,M.useState)(``),[ne,re]=(0,M.useState)(``),[ie,ae]=(0,M.useState)(``),[y,b]=(0,M.useState)(``),[x,S]=(0,M.useState)(``),[oe,se]=(0,M.useState)(!1),[ce,le]=(0,M.useState)(`7d`),[C,ue]=(0,M.useState)(`0.8`),[w,T]=(0,M.useState)(``),[de,fe]=(0,M.useState)(!1),[E,pe]=(0,M.useState)(`mesh`),[me,he]=(0,M.useState)(!0),[ge,_e]=(0,M.useState)(``),[ve,ye]=(0,M.useState)(``),[be,xe]=(0,M.useState)(``),[Se,D]=(0,M.useState)(`30`),[Ce,we]=(0,M.useState)(`200`),[Te,Ee]=(0,M.useState)(!1),[De,Oe]=(0,M.useState)(!0),[ke,Ae]=(0,M.useState)(!1),[je,Me]=(0,M.useState)(`3`),[O,Ne]=(0,M.useState)(!0),[Pe,Fe]=(0,M.useState)(!0),[Ie,Le]=(0,M.useState)(!1),[Re,ze]=(0,M.useState)(``),[Ve,He]=(0,M.useState)(`ALL`),[Ue,We]=(0,M.useState)({routing:`idle`,capacity:`idle`,security:`idle`}),[Ge,Ke]=(0,M.useState)(!1),[qe,Je]=(0,M.useState)(!0),[Ye,Xe]=(0,M.useState)(!1),[Ze,Qe]=(0,M.useState)(!1),[$e,et]=(0,M.useState)(!1),[nt,rt]=(0,M.useState)(!1),[it,at]=(0,M.useState)(`fw, firewall`),[ot,st]=(0,M.useState)(``),ct=i({queryKey:H.workspaceForwardNetworks(l),queryFn:()=>Uo(l),enabled:!!l,retry:!1,staleTime:3e4}),lt=(0,M.useMemo)(()=>(ct.data?.networks??[]).find(t=>String(t?.id??``)===String(e)),[ct.data?.networks,e]),ut=String(lt?.forwardNetworkId??``),dt=String(lt?.name??``)||String(e),ft=i({queryKey:H.forwardNetworkAssuranceSummary(l,e),queryFn:()=>Qi(l,e),enabled:!!(l&&e),staleTime:5e3,retry:!1}),k=ft.data,pt=r({mutationFn:()=>$i(l,e),onSuccess:async t=>{j.success(`Assurance refreshed`),s.setQueryData(H.forwardNetworkAssuranceSummary(l,e),t),await s.invalidateQueries({queryKey:H.forwardNetworkAssuranceHistory(l,e)})},onError:e=>j.error(`Assurance refresh failed`,{description:String(e?.message??e??`unknown error`)})}),mt=r({mutationFn:()=>ta(l,e),onSuccess:async t=>{j.success(`Seeded demo signals`,{description:`syslog CIDR ${t.syslogCidr}`}),await s.invalidateQueries({queryKey:H.forwardNetworkAssuranceSummary(l,e)})},onError:e=>j.error(`Seed failed`,{description:String(e?.message??e??`unknown error`)})}),ht=i({queryKey:H.assuranceStudioScenarios(l,e),queryFn:()=>xf(l,e),enabled:!!(l&&e),retry:!1,staleTime:1e4}),A=(0,M.useMemo)(()=>ht.data?.scenarios??[],[ht.data?.scenarios]),gt=(0,M.useMemo)(()=>A.find(e=>e.id===u)??null,[A,u]),_t=i({queryKey:H.assuranceStudioRuns(l,e),queryFn:()=>Ef(l,e),enabled:!!(l&&e),retry:!1,staleTime:1e4}),vt=(0,M.useMemo)(()=>{let e=_t.data?.runs??[];return Ve===`ALL`?e:e.filter(e=>String(e.status)===Ve)},[_t.data?.runs,Ve]),yt=i({queryKey:H.assuranceStudioRun(l,e,Re),queryFn:()=>Of(l,e,Re),enabled:!!(Ie&&l&&e&&Re),retry:!1,staleTime:3e4});(0,M.useEffect)(()=>{l&&e&&(u||A.length!==0&&o({search:e=>({...e,scenario:A[0].id}),replace:!0}))},[l,e,u,A,o]),(0,M.useEffect)(()=>{if(!gt)return;re(String(gt.name??``)),ae(String(gt.description??``)),b(String(gt.spec?.snapshotId??``)),le(String(gt.spec?.window??`7d`)||`7d`),ue(gt.spec?.thresholdUtil===void 0?`0.8`:String(gt.spec.thresholdUtil)),T(Ff(gt.spec?.demands??[]));let e=gt.spec?.routing??{};e.includeHops!==void 0&&Ee(!!e.includeHops),e.projectLoad!==void 0&&Oe(!!e.projectLoad),e.includeAcl!==void 0&&Ae(!!e.includeAcl),e.maxResults!==void 0&&Me(String(e.maxResults));{let t=e.baselineSnapshotId===void 0?``:String(e.baselineSnapshotId??``);S(t),se(!!t.trim())}e.requireEnforcement!==void 0&&Ne(!!e.requireEnforcement);let t=gt.spec?.capacity??{};t.includeHops!==void 0&&Ke(!!t.includeHops);let n=gt.spec?.security??{};n.requireEnforcement!==void 0&&Je(!!n.requireEnforcement),n.includeNetworkFunctions!==void 0&&Xe(!!n.includeNetworkFunctions),n.includeReturnPath!==void 0&&Qe(!!n.includeReturnPath),n.requireSymmetricDelivery!==void 0&&et(!!n.requireSymmetricDelivery),n.requireReturnEnforcement!==void 0&&rt(!!n.requireReturnEnforcement),Array.isArray(n.enforcementDeviceNameParts)&&at(n.enforcementDeviceNameParts.join(`, `)),Array.isArray(n.enforcementTagParts)&&st(n.enforcementTagParts.join(`, `)),fe(!1)},[gt?.id]);let bt=r({mutationFn:async()=>{let t=g.trim();if(!t)throw Error(`name is required`);let n=Number(C),r={snapshotId:y.trim()||void 0,window:ce,thresholdUtil:Number.isFinite(n)?n:void 0,demands:If(w)};return Sf(l,e,{name:t,description:v.trim()||void 0,spec:r})},onSuccess:async t=>{await s.invalidateQueries({queryKey:H.assuranceStudioScenarios(l,e)}),h(!1),_(``),te(``),j.success(`Scenario created`),o({search:e=>({...e,scenario:t.id})})},onError:e=>j.error(String(e?.message??e??`create failed`))}),xt=r({mutationFn:async()=>{if(!l)throw Error(`workspace is required`);if(!u)throw Error(`select a scenario first`);let t=(ne.trim()||`Scenario`)+` copy`,n=Number(C),r={snapshotId:y.trim()||void 0,window:ce,thresholdUtil:Number.isFinite(n)?n:void 0,demands:If(w),routing:{includeHops:Te,projectLoad:De,includeAcl:ke,maxResults:Number(je)||3,baselineSnapshotId:x.trim()||void 0,requireEnforcement:O},capacity:{includeHops:Ge},security:{requireEnforcement:qe,includeNetworkFunctions:Ye,includeReturnPath:Ze,requireSymmetricDelivery:$e,requireReturnEnforcement:nt,enforcementDeviceNameParts:Nf(it),enforcementTagParts:Nf(ot)}};return Sf(l,e,{name:t,description:ie.trim()||void 0,spec:r})},onSuccess:async t=>{await s.invalidateQueries({queryKey:H.assuranceStudioScenarios(l,e)}),j.success(`Scenario duplicated`,{description:t.id}),o({search:e=>({...e,scenario:t.id})})},onError:e=>j.error(String(e?.message??e??`duplicate failed`))}),St=r({mutationFn:async()=>{if(!u)throw Error(`select a scenario first`);let t=If(w),n=Number(C),r={snapshotId:y.trim()||void 0,window:ce,thresholdUtil:Number.isFinite(n)?n:void 0,demands:t,routing:{includeHops:Te,projectLoad:De,includeAcl:ke,maxResults:Number(je)||3,baselineSnapshotId:x.trim()||void 0,requireEnforcement:O},capacity:{includeHops:Ge},security:{requireEnforcement:qe,includeNetworkFunctions:Ye,includeReturnPath:Ze,requireSymmetricDelivery:$e,requireReturnEnforcement:nt,enforcementDeviceNameParts:Nf(it),enforcementTagParts:Nf(ot)}};return Cf(l,e,u,{name:ne.trim()||void 0,description:ie.trim()===``?null:ie.trim(),spec:r})},onSuccess:async()=>{await s.invalidateQueries({queryKey:H.assuranceStudioScenarios(l,e)}),fe(!1),j.success(`Scenario saved`)},onError:e=>j.error(String(e?.message??e??`save failed`))}),Ct=r({mutationFn:async()=>{if(!u)throw Error(`select a scenario first`);return wf(l,e,u)},onSuccess:async()=>{await s.invalidateQueries({queryKey:H.assuranceStudioScenarios(l,e)}),j.success(`Scenario deleted`),o({search:e=>({...e,scenario:``}),replace:!0})},onError:e=>j.error(String(e?.message??e??`delete failed`))}),wt=r({mutationFn:async()=>Vd(l,e,{snapshotId:y.trim()||void 0,mode:E,includeGroups:me,tagParts:Nf(ge),nameParts:Nf(ve),deviceTypes:Nf(be),maxDevices:Number(Se)||30,maxDemands:Number(Ce)||200}),onSuccess:e=>{T(Ff(e.demands??[])),fe(!0),j.success(`Seeded demands=${e.demands?.length??0}`)},onError:e=>j.error(String(e?.message??e??`seed failed`))}),Tt=r({mutationFn:async()=>{let t=If(w);if(!t.length)throw Error(`no demands parsed from CSV`);if(oe&&!x.trim())throw Error(`baselineSnapshotId is required when compareToBaseline is enabled`);let n=Number(C),r=Number(je),i=await Tf(l,e,{snapshotId:y.trim()||void 0,baselineSnapshotId:oe&&x.trim()?x.trim():void 0,window:ce,demands:t,phases:{routing:!0,capacity:!1,security:!1},routing:{thresholdUtil:Number.isFinite(n)?n:.8,forward:{maxResults:Number.isFinite(r)&&r>0?r:3},enforcement:{requireEnforcement:O},includeHops:Te,includeAcl:ke,projectLoad:De}});if(i?.routing)return i;throw Error(i?.errors?.routing??`routing evaluation failed`)},onError:e=>j.error(String(e?.message??e??`evaluate failed`))}),Et=(0,M.useMemo)(()=>If(w),[w]),Dt=(0,M.useMemo)(()=>Lf(If(w)),[w]),kt=(0,M.useMemo)(()=>{if(!l||!ut)return``;let e=new URLSearchParams;return e.set(`embed`,`1`),e.set(`forwardNetworkId`,ut),y.trim()&&e.set(`snapshotId`,y.trim()),Dt.trim()&&e.set(`flows`,Dt),`/dashboard/workspaces/${encodeURIComponent(l)}/policy-reports?${e.toString()}`},[l,ut,y,Dt]),At=(0,M.useMemo)(()=>{if(!l||!ut)return``;let e=new URLSearchParams;return e.set(`embed`,`1`),e.set(`tab`,`intent`),e.set(`forwardNetworkId`,ut),y.trim()&&e.set(`snapshotId`,y.trim()),Dt.trim()&&e.set(`flows`,Dt),`/dashboard/workspaces/${encodeURIComponent(l)}/policy-reports?${e.toString()}`},[l,ut,y,Dt]),jt=(0,M.useMemo)(()=>{if(!l||!ut)return``;let e=new URLSearchParams;return e.set(`embed`,`1`),e.set(`tab`,`segmentation`),e.set(`forwardNetworkId`,ut),y.trim()&&e.set(`snapshotId`,y.trim()),`/dashboard/workspaces/${encodeURIComponent(l)}/policy-reports?${e.toString()}`},[l,ut,y]),Mt=(0,M.useMemo)(()=>{if(!l)return``;let t=new URLSearchParams;return t.set(`workspace`,l),t.set(`embed`,`1`),`/dashboard/forward-networks/${encodeURIComponent(e)}/capacity?${t.toString()}`},[l,e]),Nt=r({mutationFn:async()=>{if(!l)throw Error(`workspace is required`);if(!u)throw Error(`select a scenario first`);if(oe&&!x.trim())throw Error(`baselineSnapshotId is required when compareToBaseline is enabled`);let t=Et.slice(0,200);if(!t.length)throw Error(`no demands parsed from CSV`);let n=Number(C),r=Number(je);We({routing:`running`,capacity:`running`,security:Pe&&ut?`running`:`skipped`});let i={snapshotId:y.trim()||void 0,window:ce,thresholdUtil:Number.isFinite(n)?n:void 0,demands:t,routing:{includeHops:Te,projectLoad:De,includeAcl:ke,maxResults:Number.isFinite(r)&&r>0?r:3,baselineSnapshotId:x.trim()||void 0,requireEnforcement:O},capacity:{includeHops:Ge},security:{requireEnforcement:qe,includeNetworkFunctions:Ye,includeReturnPath:Ze,requireSymmetricDelivery:$e,requireReturnEnforcement:nt,enforcementDeviceNameParts:Nf(it),enforcementTagParts:Nf(ot)}},a=await Tf(l,e,{snapshotId:y.trim()||void 0,baselineSnapshotId:oe&&x.trim()?x.trim():void 0,window:ce,demands:t,phases:{routing:!0,capacity:!0,security:Pe},routing:{thresholdUtil:Number.isFinite(n)?n:.8,forward:{maxResults:Number.isFinite(r)&&r>0?r:3},enforcement:{requireEnforcement:O},includeHops:Te,includeAcl:ke,projectLoad:De},capacity:{includeHops:Ge},security:Pe?{requireEnforcement:qe,includeReturnPath:Ze,requireSymmetricDelivery:Ze?$e:void 0,requireReturnEnforcement:Ze?nt:void 0,enforcementDeviceNameParts:Nf(it),enforcementTagParts:Nf(ot),intent:`PREFER_DELIVERED`,includeTags:!0,includeNetworkFunctions:Ye,maxCandidates:5e3,maxResults:1,maxReturnPathResults:Ze?1:0,maxSeconds:30,maxOverallSeconds:300}:void 0}),o={...a.errors??{}},s={};a.routing?s.routingEval=a.routing:o.routingEval=o.routingEval??o.routing??`routing failed`,a.routingBaseline&&(s.routingBaseline=a.routingBaseline),a.routingDiff&&(s.routingDiff=a.routingDiff),a.capacity?s.capacityBottlenecks=a.capacity:o.capacityBottlenecks=o.capacityBottlenecks??o.capacity??`capacity failed`,a.capacityUpgradeCandidates&&(s.capacityUpgradeCandidates=a.capacityUpgradeCandidates),Pe&&(a.security?s.securityPathsAssurance=a.security:o.securityPathsAssurance=o.securityPathsAssurance??o.security??`security failed`),Object.keys(o).length&&(s.errors=o),We({routing:a.routing&&!a.errors?.routing?`succeeded`:`failed`,capacity:a.capacity&&!a.errors?.capacity?`succeeded`:`failed`,security:Pe?a.security&&!a.errors?.security?`succeeded`:`failed`:`skipped`});let c=[`routingEval`,`capacityBottlenecks`,`securityPathsAssurance`].filter(e=>e in s).length,d=c===0?`FAILED`:c===(Pe?3:2)?`SUCCEEDED`:`PARTIAL`;return{run:await Df(l,e,{scenarioId:u,title:`${ne.trim()||`Scenario`} (${new Date().toISOString()})`,status:d,error:Object.keys(o).length?JSON.stringify(o):void 0,request:i,results:s}),results:s}},onSuccess:async t=>{j.success(`Scenario run stored`,{description:t.run.id}),await s.invalidateQueries({queryKey:H.assuranceStudioRuns(l,e)}),ze(t.run.id),Le(!0)},onError:e=>j.error(String(e?.message??e??`run failed`))}),Pt=r({mutationFn:async()=>{if(!l)throw Error(`workspace is required`);let t=Et.filter(e=>String(e.dstIp??``).trim()).slice(0,200);if(t.length===0)throw Error(`no valid demands to evaluate`);let n=await Tf(l,e,{window:ce,snapshotId:y.trim()||void 0,demands:t,phases:{routing:!1,capacity:!0,security:!1},capacity:{includeHops:Ge}});if(n?.capacity)return{bottlenecks:n.capacity,upgradeCandidates:n.capacityUpgradeCandidates};throw Error(n?.errors?.capacity??`capacity evaluation failed`)},onError:e=>j.error(String(e?.message??e??`capacity bottlenecks failed`))});function Ft(e){try{let t=e?.results;return t?Array.isArray(t)?t:typeof t==`string`?JSON.parse(t):JSON.parse(String(t)):[]}catch{return[]}}let It=r({mutationFn:async()=>{if(!l)throw Error(`workspace is required`);let t=Et.filter(e=>String(e.dstIp??``).trim()).slice(0,200);if(t.length===0)throw Error(`no valid demands to evaluate`);let n=await Tf(l,e,{snapshotId:y.trim()||void 0,window:ce,demands:t,phases:{routing:!1,capacity:!1,security:!0},security:{requireEnforcement:qe,includeReturnPath:Ze,requireSymmetricDelivery:Ze?$e:void 0,requireReturnEnforcement:Ze?nt:void 0,enforcementDeviceNameParts:Nf(it),enforcementTagParts:Nf(ot),intent:`PREFER_DELIVERED`,includeTags:!0,includeNetworkFunctions:Ye,maxCandidates:5e3,maxResults:1,maxReturnPathResults:Ze?1:0,maxSeconds:30,maxOverallSeconds:300}});if(n?.security)return n.security;throw Error(n?.errors?.security??`security evaluation failed`)},onError:e=>j.error(String(e?.message??e??`paths assurance failed`))}),Lt=r({mutationFn:async()=>{if(!l)throw Error(`workspace is required`);if(!ut)throw Error(`forwardNetworkId is required`);let e=Et.filter(e=>String(e.dstIp??``).trim()).slice(0,200).map(e=>({from:e.from,srcIp:e.srcIp,dstIp:e.dstIp,ipProto:e.ipProto,srcPort:e.srcPort,dstPort:e.dstPort}));if(e.length===0)throw Error(`no valid demands to evaluate`);return as(l,{title:`Assurance Studio Paths Assurance (${e.length} flows)`,forwardNetworkId:ut,snapshotId:y.trim()||void 0,queries:e,requireEnforcement:qe,requireSymmetricDelivery:Ze?$e:void 0,requireReturnEnforcement:Ze?nt:void 0,enforcementDeviceNameParts:Nf(it),enforcementTagParts:Nf(ot),intent:`PREFER_DELIVERED`,includeTags:!0,includeNetworkFunctions:Ye,maxCandidates:5e3,maxResults:1,maxReturnPathResults:Ze?1:0,maxSeconds:30,maxOverallSeconds:300})},onSuccess:e=>j.success(`Stored as Policy Report run`,{description:e.run.id}),onError:e=>j.error(String(e?.message??e??`store paths assurance failed`))});return(0,P.jsxs)(`div`,{className:`space-y-6`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(F,{asChild:!0,variant:`ghost`,size:`sm`,children:(0,P.jsxs)(p,{to:`/dashboard/forward-networks`,search:{workspace:l},children:[(0,P.jsx)(ee,{className:`h-4 w-4`}),(0,P.jsx)(`span`,{className:`ml-2`,children:`Forward Networks`})]})}),(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Assurance Studio`}),(0,P.jsx)(`div`,{className:`text-lg font-semibold`,children:dt})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(W,{variant:`secondary`,children:`Forward Paths + NQE`}),ct.isLoading?(0,P.jsx)(U,{className:`h-6 w-24`}):null,(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>pt.mutate(),disabled:!l||pt.isPending,children:[(0,P.jsx)(Ot,{className:`h-4 w-4 mr-2`}),pt.isPending?`Refreshing`:`Refresh Assurance`]}),f?(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>mt.mutate(),disabled:!l||mt.isPending,children:mt.isPending?`Seeding`:`Seed demo signals`}):null,(0,P.jsx)(F,{asChild:!0,variant:`outline`,size:`sm`,children:(0,P.jsx)(p,{to:`/dashboard/forward-networks/$networkRef/assurance`,params:{networkRef:e},search:{workspace:l},children:`Assurance page`})})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-2 md:flex-row md:items-start md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(z,{children:`Assurance Summary`}),(0,P.jsx)(B,{children:`Live Forward snapshot health, vulnerabilities, capacity cache, and inbox signals.`})]}),(0,P.jsx)(`div`,{className:`flex flex-wrap items-center gap-2`,children:ft.isLoading?(0,P.jsx)(U,{className:`h-9 w-36`}):ft.isError?(0,P.jsx)(W,{variant:`destructive`,children:`summary unavailable`}):k?(0,P.jsxs)(W,{variant:`outline`,className:`font-mono text-xs`,children:[`as of `,jf(k.generatedAt)]}):null})]}),(0,P.jsxs)(V,{className:`grid gap-3 md:grid-cols-2 xl:grid-cols-3 text-sm`,children:[(0,P.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Snapshot`}),(0,P.jsx)(`div`,{className:`font-mono text-xs mt-1 truncate`,children:k?.snapshot.snapshotId||``}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground mt-1`,children:[`age `,Mf(k?.snapshot.ageSeconds),`  state`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:k?.snapshot.state||``})]})]}),(0,P.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Indexing`}),(0,P.jsx)(`div`,{className:`mt-1`,children:(0,P.jsx)(W,{variant:k?.indexingHealth.overall===`ok`?`default`:k?.indexingHealth.overall===`warn`?`secondary`:`outline`,children:k?.indexingHealth.overall||`unknown`})}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground mt-1 font-mono`,children:[`pathSearch=`,k?.indexingHealth.pathSearchIndexingStatus||``]})]}),(0,P.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Vulnerabilities`}),(0,P.jsxs)(`div`,{className:`mt-1`,children:[(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:k?.vulnerabilities.total??``}),k?.vulnerabilities.partial?(0,P.jsx)(W,{variant:`secondary`,className:`ml-2`,children:`partial`}):null]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground mt-1`,children:[`known exploit`,` `,(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:k?.vulnerabilities.knownExploitCount??``})]})]}),(0,P.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Capacity cache`}),(0,P.jsxs)(`div`,{className:`mt-1 text-xs`,children:[`hot ifaces (`,`>=`,`85% max):`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:k?.capacity.hotInterfaces??0})]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground mt-1`,children:[`stale`,` `,(0,P.jsx)(W,{variant:k?.capacity.stale?`secondary`:`default`,children:k?.capacity.stale?`yes`:`no`})]})]}),(0,P.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Live signals (60m)`}),(0,P.jsxs)(`div`,{className:`mt-1 text-xs text-muted-foreground`,children:[`syslog`,` `,(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:k?.liveSignals.syslog.total??0}),` `,`(crit`,` `,(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:k?.liveSignals.syslog.critical??0}),`)`]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`snmp`,` `,(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:k?.liveSignals.snmpTraps.total??0}),` `,`webhooks`,` `,(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:k?.liveSignals.webhooks.total??0})]})]}),(0,P.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Notes`}),(k?.missing??[]).length>0?(0,P.jsx)(`div`,{className:`mt-1 flex flex-wrap gap-2`,children:(k?.missing??[]).slice(0,6).map(e=>(0,P.jsxs)(W,{variant:`secondary`,children:[`missing:`,e]},e))}):(0,P.jsx)(`div`,{className:`mt-1 text-xs text-muted-foreground`,children:`No missing evidence detected.`}),(k?.warnings??[]).length>0?(0,P.jsx)(`div`,{className:`mt-2 text-xs text-muted-foreground`,children:(k?.warnings??[]).slice(0,3).join(`  `)}):null]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-2 md:flex-row md:items-start md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(z,{children:`Scenario`}),(0,P.jsx)(B,{children:`One saved scenario feeds Routing, Capacity, and Security tabs.`})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>ht.refetch(),disabled:ht.isFetching,children:[(0,P.jsx)(Ot,{className:`h-4 w-4 mr-2`}),`Refresh`]}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>h(!0),children:[(0,P.jsx)(gn,{className:`h-4 w-4 mr-2`}),`New`]}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,disabled:!l||!u||xt.isPending,onClick:()=>xt.mutate(),children:`Duplicate`}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,disabled:!u||Ct.isPending,onClick:()=>{u&&confirm(`Delete this scenario?`)&&Ct.mutate()},children:[(0,P.jsx)(tt,{className:`h-4 w-4 mr-2`}),`Delete`]}),(0,P.jsxs)(F,{size:`sm`,disabled:!l||!u||St.isPending||!de,onClick:()=>St.mutate(),children:[(0,P.jsx)(Be,{className:`h-4 w-4 mr-2`}),`Save`]}),(0,P.jsxs)(F,{size:`sm`,disabled:!l||!u||Nt.isPending,onClick:()=>Nt.mutate(),children:[(0,P.jsx)(Vt,{className:`h-4 w-4 mr-2`}),`Run scenario`]})]})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[Nt.isPending||Ue.routing!==`idle`?(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2 text-sm`,children:[(0,P.jsx)(W,{variant:`secondary`,children:`Run phases`}),(0,P.jsxs)(W,{variant:`secondary`,children:[`routing:`,` `,(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:Ue.routing})]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`capacity:`,` `,(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:Ue.capacity})]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`security:`,` `,(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:Ue.security})]})]}):null,(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Scenario`}),(0,P.jsxs)(q,{value:u,onValueChange:e=>{fe(!1),o({search:t=>({...t,scenario:String(e??``)})})},children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{placeholder:`Select scenario`})}),(0,P.jsx)(X,{children:A.map(e=>(0,P.jsx)(Z,{value:e.id,children:e.name},e.id))})]})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Name`}),(0,P.jsx)(K,{value:ne,onChange:e=>{re(e.target.value),fe(!0)},placeholder:`Scenario name`})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`SnapshotId (optional)`}),(0,P.jsx)(K,{value:y,onChange:e=>{b(e.target.value),fe(!0)},placeholder:`latest processed`})]})]}),(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1 md:col-span-2`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Baseline SnapshotId (optional)`}),(0,P.jsx)(K,{value:x,onChange:e=>{S(e.target.value),fe(!0)},placeholder:`for routing regressions`})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Compare routing`}),(0,P.jsxs)(`label`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:oe,onChange:e=>{let t=e.target.checked;se(t),t&&Ee(!0)}}),(0,P.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`vs baseline`})]})]})]}),(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1 md:col-span-2`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Description`}),(0,P.jsx)(K,{value:ie,onChange:e=>{ae(e.target.value),fe(!0)},placeholder:`Optional notes`})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Window`}),(0,P.jsxs)(q,{value:ce,onValueChange:e=>{le(e),fe(!0)},children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`24h`,children:`24h`}),(0,P.jsx)(Z,{value:`7d`,children:`7d`}),(0,P.jsx)(Z,{value:`30d`,children:`30d`})]})]})]})]}),(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-4`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Threshold util (0-1)`}),(0,P.jsx)(K,{value:C,onChange:e=>{ue(e.target.value),fe(!0)}})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Max results`}),(0,P.jsx)(K,{value:je,onChange:e=>Me(e.target.value)})]}),(0,P.jsxs)(`div`,{className:`flex items-end gap-2 md:col-span-2`,children:[(0,P.jsxs)(F,{disabled:!l||Tt.isPending,onClick:()=>Tt.mutate(),children:[(0,P.jsx)(Vt,{className:`h-4 w-4 mr-2`}),`Evaluate routing`]}),(0,P.jsx)(F,{variant:`secondary`,onClick:()=>T(``),children:`Clear demands`}),(0,P.jsxs)(`label`,{className:`ml-2 flex items-center gap-2 text-sm text-muted-foreground`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:Pe,onChange:e=>Fe(e.target.checked)}),`Include security in run`]})]})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Recent runs`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsxs)(q,{value:Ve,onValueChange:e=>He(e===`SUCCEEDED`||e===`PARTIAL`||e===`FAILED`?e:`ALL`),children:[(0,P.jsx)(Y,{className:`h-8 w-[160px]`,children:(0,P.jsx)(J,{placeholder:`Filter`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`ALL`,children:`All`}),(0,P.jsx)(Z,{value:`SUCCEEDED`,children:`SUCCEEDED`}),(0,P.jsx)(Z,{value:`PARTIAL`,children:`PARTIAL`}),(0,P.jsx)(Z,{value:`FAILED`,children:`FAILED`})]})]}),(0,P.jsxs)(F,{variant:`outline`,size:`sm`,onClick:()=>_t.refetch(),disabled:_t.isFetching,children:[(0,P.jsx)(Ot,{className:`h-4 w-4 mr-2`}),`Refresh`]})]})]}),_t.isLoading?(0,P.jsx)(U,{className:`h-14 w-full`}):vt.length===0?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No stored runs yet.`}):(0,P.jsx)(`div`,{className:`overflow-x-auto rounded-md border`,children:(0,P.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,P.jsx)(`thead`,{className:`border-b text-xs text-muted-foreground`,children:(0,P.jsxs)(`tr`,{children:[(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Started`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Status`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Title`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Run ID`}),(0,P.jsx)(`th`,{className:`p-2 text-right`,children:`Actions`})]})}),(0,P.jsx)(`tbody`,{children:vt.slice(0,10).map(e=>(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.startedAt}),(0,P.jsx)(`td`,{className:`p-2`,children:(0,P.jsx)(W,{variant:e.status===`FAILED`?`destructive`:`secondary`,children:e.status})}),(0,P.jsx)(`td`,{className:`p-2`,children:e.title}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.id}),(0,P.jsx)(`td`,{className:`p-2 text-right`,children:(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>{ze(e.id),Le(!0)},children:`View`})})]},e.id))})]})})]}),(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(L,{className:`border-dashed`,children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{className:`text-base`,children:`Seed demands`}),(0,P.jsx)(B,{children:`Uses NQE to discover device endpoints, then generates a demand set.`})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Mode`}),(0,P.jsxs)(q,{value:E,onValueChange:pe,children:[(0,P.jsx)(Y,{children:(0,P.jsx)(J,{})}),(0,P.jsx)(X,{children:(0,P.jsx)(Z,{value:`mesh`,children:`Mesh`})})]})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Include groups`}),(0,P.jsxs)(`div`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:me,onChange:e=>he(e.target.checked)}),(0,P.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`match tagParts to groups too`})]})]})]}),(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Tag parts`}),(0,P.jsx)(K,{value:ge,onChange:e=>_e(e.target.value)})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Name parts`}),(0,P.jsx)(K,{value:ve,onChange:e=>ye(e.target.value)})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Device types`}),(0,P.jsx)(K,{value:be,onChange:e=>xe(e.target.value),placeholder:`ROUTER,SWITCH`})]})]}),(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Max devices`}),(0,P.jsx)(K,{value:Se,onChange:e=>D(e.target.value)})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Max demands`}),(0,P.jsx)(K,{value:Ce,onChange:e=>we(e.target.value)})]}),(0,P.jsx)(`div`,{className:`flex items-end`,children:(0,P.jsx)(F,{variant:`outline`,disabled:!l||wt.isPending,onClick:()=>wt.mutate(),children:`Seed`})})]})]})]}),(0,P.jsxs)(L,{className:`border-dashed`,children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{className:`text-base`,children:`Demands CSV`}),(0,P.jsxs)(B,{children:[`Canonical schema:`,` `,(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:`from,srcIp,dstIp,ipProto,srcPort,dstPort,bandwidthGbps,label`})]})]}),(0,P.jsxs)(V,{className:`space-y-2`,children:[(0,P.jsx)(ul,{className:`min-h-[260px] font-mono text-xs`,value:w,onChange:e=>{T(e.target.value),fe(!0)},placeholder:`from,srcIp,dstIp,ipProto,srcPort,dstPort,bandwidthGbps,label`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-3 text-sm text-muted-foreground`,children:[(0,P.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:Te,onChange:e=>Ee(e.target.checked)}),`Include hops`]}),(0,P.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:De,onChange:e=>{let t=e.target.checked;Oe(t),t&&Ee(!0)}}),`Project load`]}),(0,P.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:O,onChange:e=>Ne(e.target.checked)}),`Require enforcement traversal`]}),(0,P.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:ke,onChange:e=>Ae(e.target.checked)}),`Include ACL/NF details`]})]})]})]})]})]})]}),(0,P.jsxs)(Bc,{value:d,onValueChange:e=>void o({search:t=>({...t,tab:e})}),children:[(0,P.jsxs)(Vc,{children:[(0,P.jsx)(Hc,{value:`routing`,children:`Routing`}),(0,P.jsx)(Hc,{value:`capacity`,children:`Capacity`}),(0,P.jsx)(Hc,{value:`security`,children:`Security`}),(0,P.jsx)(Hc,{value:`actions`,children:`Actions`})]}),(0,P.jsx)(Uc,{value:`routing`,className:`space-y-3`,children:(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Routing Results`})}),(0,P.jsxs)(V,{className:`space-y-3`,children:[Tt.isPending?(0,P.jsx)(U,{className:`h-20 w-full`}):null,Tt.data?.routing?(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,P.jsxs)(W,{variant:`secondary`,children:[`Demands: `,Tt.data.routing.summary.totalDemands]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Delivered: `,Tt.data.routing.summary.delivered]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Timed out: `,Tt.data.routing.summary.timedOut]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Missing enforcement:`,` `,Tt.data.routing.summary.missingEnforcement]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Crosses threshold:`,` `,Tt.data.routing.summary.crossesThreshold]})]}),Tt.data.routingDiff?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Regression vs baseline`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,P.jsxs)(W,{variant:`secondary`,children:[`Baseline:`,` `,(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:Tt.data.routingDiff.baselineSnapshotId??Tt.data.baselineSnapshotId??``})]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Compare:`,` `,(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:Tt.data.routingDiff.compareSnapshotId??Tt.data.snapshotId??`latest`})]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Changed: `,Tt.data.routingDiff.summary.changed,`/`,Tt.data.routingDiff.summary.totalDemands]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Regressions:`,` `,Tt.data.routingDiff.summary.deliveryRegression]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Improvements:`,` `,Tt.data.routingDiff.summary.deliveryImprovement]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Path changed:`,` `,Tt.data.routingDiff.summary.pathChanged]})]}),(0,P.jsx)(`div`,{className:`overflow-x-auto`,children:(0,P.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,P.jsx)(`thead`,{children:(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`#`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Flow`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Reasons`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Baseline`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Compare`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Evidence`})]})}),(0,P.jsx)(`tbody`,{children:(Tt.data.routingDiff.items??[]).filter(e=>!!e.changed).slice(0,50).map(e=>(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`td`,{className:`p-2 text-muted-foreground`,children:e.index+1}),(0,P.jsxs)(`td`,{className:`p-2 font-mono text-xs`,children:[String(e.demand.srcIp??e.demand.from??``),` `,`-> `,e.demand.dstIp]}),(0,P.jsx)(`td`,{className:`p-2 text-xs`,children:(e.reasons??[]).includes(`delivery_regression`)?(0,P.jsx)(`span`,{className:`text-amber-600`,children:`delivery_regression`}):(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:(e.reasons??[]).join(`, `)||``})}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.baselineForwardingOutcome??``}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.compareForwardingOutcome??``}),(0,P.jsx)(`td`,{className:`p-2 text-xs`,children:(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[e.baselineQueryUrl?(0,P.jsx)(`a`,{href:e.baselineQueryUrl,target:`_blank`,rel:`noreferrer noopener`,className:`underline text-muted-foreground`,children:`baseline`}):null,e.compareQueryUrl?(0,P.jsx)(`a`,{href:e.compareQueryUrl,target:`_blank`,rel:`noreferrer noopener`,className:`underline text-muted-foreground`,children:`compare`}):null]})})]},e.index))})]})}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Showing first 50 changed flows.`})]}):null,(Tt.data.routing.interfaceImpacts??[]).length?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Interface impacts`}),(0,P.jsx)(`div`,{className:`overflow-x-auto`,children:(0,P.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,P.jsx)(`thead`,{children:(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Device`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Interface`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Dir`}),(0,P.jsx)(`th`,{className:`p-2 text-right`,children:`Base p95`}),(0,P.jsx)(`th`,{className:`p-2 text-right`,children:`Added (Gbps)`}),(0,P.jsx)(`th`,{className:`p-2 text-right`,children:`Projected`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Crosses`})]})}),(0,P.jsx)(`tbody`,{children:[...Tt.data.routing.interfaceImpacts??[]].sort((e,t)=>Number(t.projectedUtil??0)-Number(e.projectedUtil??0)).slice(0,25).map(e=>(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.deviceName}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.interfaceName}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.direction}),(0,P.jsx)(`td`,{className:`p-2 text-right font-mono text-xs`,children:e.baseP95Util===void 0?``:e.baseP95Util.toFixed(3)}),(0,P.jsx)(`td`,{className:`p-2 text-right font-mono text-xs`,children:e.addedGbps===void 0?``:e.addedGbps.toFixed(3)}),(0,P.jsx)(`td`,{className:`p-2 text-right font-mono text-xs`,children:e.projectedUtil===void 0?``:e.projectedUtil.toFixed(3)}),(0,P.jsx)(`td`,{className:`p-2`,children:e.crossesThreshold?(0,P.jsx)(`span`,{className:`text-amber-600`,children:`yes`}):(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:`no`})})]},`${e.deviceName}:${e.interfaceName}:${e.direction}`))})]})}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Showing top 25 by projected utilization.`})]}):null,(0,P.jsx)(`div`,{className:`overflow-x-auto`,children:(0,P.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,P.jsx)(`thead`,{children:(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`#`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Demand`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Recommended`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Outcome`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Bottleneck`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Forward`})]})}),(0,P.jsx)(`tbody`,{children:Tt.data.routing.items.slice(0,50).map(e=>{let t=e.candidates?.[e.recommended],n=t?.bottleneck;return(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`td`,{className:`p-2 text-muted-foreground`,children:e.index+1}),(0,P.jsxs)(`td`,{className:`p-2`,children:[(0,P.jsxs)(`div`,{className:`font-mono`,children:[String(e.demand.srcIp??e.demand.from??``),` `,`-> `,e.demand.dstIp]}),e.demand.label?(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:e.demand.label}):null]}),(0,P.jsx)(`td`,{className:`p-2`,children:e.recommended}),(0,P.jsxs)(`td`,{className:`p-2`,children:[(0,P.jsx)(`div`,{children:t?.forwardingOutcome??e.error??``}),t&&!t.enforced?(0,P.jsx)(`div`,{className:`text-amber-600`,children:`missing enforcement`}):null]}),(0,P.jsx)(`td`,{className:`p-2`,children:n?(0,P.jsxs)(`div`,{className:`font-mono`,children:[n.deviceName,`:`,n.interfaceName,` (`,n.direction,`)`,n.headroomGbps===void 0?``:` headroom=${n.headroomGbps.toFixed(2)}G`,n.crossesThreshold?` crosses`:``]}):(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:``})}),(0,P.jsx)(`td`,{className:`p-2 text-xs`,children:e.queryUrl?(0,P.jsx)(`a`,{href:e.queryUrl,target:`_blank`,rel:`noreferrer noopener`,className:`underline text-muted-foreground`,children:`open`}):(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:``})})]},e.index)})})]})}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Showing first 50 demands.`})]}):(0,P.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Click `,(0,P.jsx)(`span`,{className:`font-medium`,children:`Evaluate routing`}),` to run Forward paths-bulk and rank candidates.`]})]})]})}),(0,P.jsx)(Uc,{value:`capacity`,className:`space-y-3`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Capacity (Scenario Lens)`}),(0,P.jsx)(B,{children:`Run capacity path-bottleneck analysis for the scenario demand set.`})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsx)(F,{disabled:!l||Pt.isPending,onClick:()=>Pt.mutate(),children:`Evaluate capacity bottlenecks`}),(0,P.jsx)(F,{asChild:!0,variant:`outline`,children:(0,P.jsx)(`a`,{href:Mt||`#`,target:`_blank`,rel:`noreferrer noopener`,children:`Open full Capacity`})}),(0,P.jsxs)(`label`,{className:`flex items-center gap-2 text-sm text-muted-foreground`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:Ge,onChange:e=>Ke(e.target.checked)}),`Include hops`]})]}),Pt.isPending?(0,P.jsx)(U,{className:`h-20 w-full`}):null,Pt.data?(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`asOf=`,Pt.data.bottlenecks.asOf??``,` `,`coverage=`,Pt.data.bottlenecks.coverage?`${Pt.data.bottlenecks.coverage.rollupMatched}/${Pt.data.bottlenecks.coverage.hopInterfaceKeys} matched`:``]}),(()=>{let e=Pt.data.upgradeCandidates;return e?.items?.length?(0,P.jsxs)(`div`,{className:`rounded-md border p-3 space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Upgrade candidates`}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`asOf=`,e.asOf??``]})]}),(0,P.jsx)(`div`,{className:`overflow-x-auto`,children:(0,P.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,P.jsx)(`thead`,{children:(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Scope`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Target`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Speed`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Worst`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Max`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`P95`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Recommend`})]})}),(0,P.jsx)(`tbody`,{children:e.items.slice(0,5).map((e,t)=>(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.scopeType}),(0,P.jsxs)(`td`,{className:`p-2 font-mono text-xs`,children:[e.device,`:`,e.name,e.members?.length?(0,P.jsxs)(`span`,{className:`text-muted-foreground`,children:[` `,`(`,e.members.length,` members)`]}):null]}),(0,P.jsxs)(`td`,{className:`p-2 font-mono text-xs`,children:[Math.round(e.speedMbps/1e3),`G`]}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.worstDirection}),(0,P.jsxs)(`td`,{className:`p-2 font-mono text-xs`,children:[(e.maxUtil*100).toFixed(0),`%`]}),(0,P.jsxs)(`td`,{className:`p-2 font-mono text-xs`,children:[(e.p95Util*100).toFixed(0),`%`]}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.recommendedSpeedMbps?(0,P.jsxs)(`span`,{children:[Math.round(e.recommendedSpeedMbps/1e3),`G`,` `,(0,P.jsxs)(`span`,{className:`text-muted-foreground`,children:[`(`,e.reason??`upgrade`,`)`]})]}):(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:``})})]},t))})]})}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Showing top 5 candidates.`})]}):null})(),(()=>{let e=Pt.data.bottlenecks,t=new Map;for(let n of e.items??[]){let e=n.bottleneck;if(!e)continue;let r=`${e.deviceName}:${e.interfaceName}:${e.direction}`;t.set(r,(t.get(r)??0)+1)}let n=Array.from(t.entries()).sort((e,t)=>t[1]-e[1]).slice(0,10);return n.length?(0,P.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:n.map(([e,t])=>(0,P.jsxs)(W,{variant:`secondary`,children:[(0,P.jsx)(`span`,{className:`font-mono`,children:t}),` `,(0,P.jsx)(`span`,{className:`text-muted-foreground`,children:e})]},e))}):null})(),(0,P.jsx)(`div`,{className:`overflow-x-auto`,children:(0,P.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,P.jsx)(`thead`,{children:(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`#`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Flow`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Outcome`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Bottleneck`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Headroom`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Forecast`})]})}),(0,P.jsx)(`tbody`,{children:Pt.data.bottlenecks.items.slice(0,50).map(e=>{let t=e.bottleneck;return(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`td`,{className:`p-2 text-muted-foreground`,children:e.index+1}),(0,P.jsxs)(`td`,{className:`p-2 font-mono text-xs`,children:[String(e.query.srcIp??e.query.from??``),` `,`-> `,e.query.dstIp]}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.forwardingOutcome??e.error??``}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:t?`${t.deviceName}:${t.interfaceName} (${t.direction})`:``}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:t?.headroomGbps!==null&&t?.headroomGbps!==void 0?`${Number(t.headroomGbps).toFixed(2)}G`:``}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:String(t?.forecastCrossingTs??``)})]},e.index)})})]})}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Showing first 50 flows.`})]}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Click Evaluate to compute bottlenecks from Forward paths + capacity rollups.`})]})]})}),(0,P.jsx)(Uc,{value:`security`,className:`space-y-3`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Security (Paths Assurance)`}),(0,P.jsx)(B,{children:`Run enforcement-bypass detection against the scenario demand set.`})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Require enforcement`}),(0,P.jsxs)(`label`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:qe,onChange:e=>Je(e.target.checked)}),(0,P.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`violate if not enforced`})]})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Include return path`}),(0,P.jsxs)(`label`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:Ze,onChange:e=>Qe(e.target.checked)}),(0,P.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`also evaluate return path`})]})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Include networkFunctions`}),(0,P.jsxs)(`label`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:Ye,onChange:e=>Xe(e.target.checked)}),(0,P.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`ACL/NAT evidence (slower)`})]})]})]}),Ze?(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Require symmetric delivery`}),(0,P.jsxs)(`label`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:$e,onChange:e=>et(e.target.checked)}),(0,P.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`delivered both ways`})]})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Require return enforcement`}),(0,P.jsxs)(`label`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,P.jsx)(`input`,{type:`checkbox`,checked:nt,onChange:e=>rt(e.target.checked)}),(0,P.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`enforced on return path`})]})]})]}):null,(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Enforcement device name parts`}),(0,P.jsx)(K,{value:it,onChange:e=>at(e.target.value),placeholder:`fw, firewall`})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Enforcement tag parts`}),(0,P.jsx)(K,{value:ot,onChange:e=>st(e.target.value),placeholder:`enforcement, inspection`})]})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsx)(F,{disabled:!l||It.isPending||!ut,onClick:()=>It.mutate(),children:`Run Paths Assurance`}),(0,P.jsx)(F,{variant:`secondary`,disabled:!l||Lt.isPending||!ut,onClick:()=>Lt.mutate(),children:`Store as run`}),(0,P.jsx)(F,{asChild:!0,variant:`outline`,children:(0,P.jsx)(`a`,{href:kt||`#`,target:`_blank`,rel:`noreferrer noopener`,children:`Open full Policy Reports`})}),(0,P.jsx)(F,{asChild:!0,variant:`outline`,children:(0,P.jsx)(`a`,{href:jt||`#`,target:`_blank`,rel:`noreferrer noopener`,children:`Segmentation posture`})}),(0,P.jsx)(F,{asChild:!0,variant:`outline`,children:(0,P.jsx)(`a`,{href:At||`#`,target:`_blank`,rel:`noreferrer noopener`,children:`Intent suite`})}),ut?null:(0,P.jsx)(`span`,{className:`text-sm text-amber-600`,children:`missing forwardNetworkId for this saved network`})]}),It.isPending?(0,P.jsx)(U,{className:`h-20 w-full`}):null,It.data?(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,P.jsxs)(W,{variant:`secondary`,children:[`Total: `,It.data.total]}),(0,P.jsxs)(W,{variant:`secondary`,children:[`Snapshot: `,It.data.snapshotId??`latest`]})]}),(()=>{let e=Ft(It.data).filter(e=>!!e?.violation);return e.length?(0,P.jsx)(`div`,{className:`overflow-x-auto`,children:(0,P.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,P.jsx)(`thead`,{children:(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Flow`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Outcome`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Enforced`}),(0,P.jsx)(`th`,{className:`p-2 text-left`,children:`Reason`})]})}),(0,P.jsx)(`tbody`,{children:e.slice(0,50).map((e,t)=>(0,P.jsxs)(`tr`,{className:`border-b`,children:[(0,P.jsxs)(`td`,{className:`p-2 font-mono text-xs`,children:[String(e?.srcIp??``),` ->`,` `,String(e?.dstIp??``),` `,e?.ipProto===void 0?``:`p=${String(e?.ipProto)}`,e?.dstPort?` dport=${String(e?.dstPort)}`:``]}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:String(e?.forwardingOutcome??``)}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:String(e?.enforced??``)}),(0,P.jsx)(`td`,{className:`p-2 text-xs text-muted-foreground`,children:Array.isArray(e?.riskReasons)&&e.riskReasons.length?String(e.riskReasons[0]):``})]},t))})]})}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No violations detected.`})})()]}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Run Paths Assurance to detect enforcement bypass and delivery anomalies.`})]})]})}),(0,P.jsx)(Uc,{value:`actions`,className:`space-y-3`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Actions`}),(0,P.jsx)(B,{children:`Demo artifacts and future closed-loop hooks.`})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`V1: export/copy artifacts; future: Ansible/tickets/change planning integrations.`}),(0,P.jsx)(F,{variant:`outline`,onClick:async()=>{let e=If(w),t=Number(C),n={snapshotId:y.trim()||void 0,window:ce,thresholdUtil:Number.isFinite(t)?t:void 0,demands:e};await navigator.clipboard.writeText(JSON.stringify(n,null,2)),j.success(`Copied scenario spec JSON to clipboard`)},disabled:!w.trim(),children:`Copy scenario spec JSON`})]})]})})]}),(0,P.jsx)(tr,{open:m,onOpenChange:h,children:(0,P.jsxs)(ir,{children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{children:`New Scenario`})}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Name`}),(0,P.jsx)(K,{value:g,onChange:e=>_(e.target.value)})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Description`}),(0,P.jsx)(K,{value:v,onChange:e=>te(e.target.value)})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-end gap-2 pt-2`,children:[(0,P.jsx)(F,{variant:`outline`,onClick:()=>h(!1),children:`Cancel`}),(0,P.jsx)(F,{onClick:()=>bt.mutate(),disabled:bt.isPending,children:`Create`})]})]})]})}),(0,P.jsx)(tr,{open:Ie,onOpenChange:e=>{Le(e),e||ze(``)},children:(0,P.jsxs)(ir,{className:`max-w-4xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{children:`Run Detail`})}),yt.isLoading?(0,P.jsx)(U,{className:`h-24 w-full`}):yt.isError?(0,P.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load run.`}):yt.data?(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,P.jsx)(W,{variant:`secondary`,children:yt.data.run.status}),(0,P.jsx)(W,{variant:`secondary`,children:(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:yt.data.run.id})})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:async()=>{await navigator.clipboard.writeText(JSON.stringify(yt.data,null,2)),j.success(`Copied run JSON to clipboard`)},children:`Copy JSON`}),(0,P.jsx)(F,{variant:`outline`,size:`sm`,onClick:()=>{let e=yt.data.run.id;Pf(`assurance-studio-run-${e}.json`,`application/json`,JSON.stringify(yt.data,null,2)+`
`)},children:`Download JSON`})]}),(0,P.jsx)(ul,{readOnly:!0,className:`min-h-[420px] font-mono text-xs`,value:JSON.stringify(yt.data,null,2)})]}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:``})]})})]})}var zf=Qn({workspace:qn().optional().catch(``)});const Bf=t(`/dashboard/forward-networks/$networkRef/assurance`)({validateSearch:e=>zf.parse(e),component:Wf});function Vf(e){let t=String(e??``).trim();if(!t)return``;let n=Date.parse(t);return Number.isFinite(n)?new Date(n).toISOString():t}function Hf(e){let t=Number(e??NaN);if(!Number.isFinite(t)||t<0)return``;let n=Math.floor(t/60),r=Math.floor(n/60);return r>0?`${r}h ${n%60}m`:n>0?`${n}m`:`${Math.floor(t)}s`}function Uf(e){let t=Number(e??NaN);return Number.isFinite(t)?`${(t*100).toFixed(1)}%`:``}function Wf(){let e=c(),{networkRef:t}=Bf.useParams(),{workspace:n}=Bf.useSearch(),a=String(n??``).trim(),o=i({queryKey:H.forwardNetworkAssuranceSummary(a,t),queryFn:()=>Qi(a,t),enabled:!!(a&&t),staleTime:5e3,retry:!1}),s=o.data,l=(0,M.useMemo)(()=>s?.missing??[],[s?.missing]),u=(0,M.useMemo)(()=>s?.warnings??[],[s?.warnings]),d=r({mutationFn:async()=>$i(a,t),onSuccess:async n=>{j.success(`Assurance refreshed`),e.setQueryData(H.forwardNetworkAssuranceSummary(a,t),n),await e.invalidateQueries({queryKey:H.forwardNetworkAssuranceHistory(a,t)})},onError:e=>j.error(`Refresh failed`,{description:e.message})}),f=i({queryKey:H.forwardNetworkAssuranceHistory(a,t),queryFn:()=>ea(a,t,`20`),enabled:!!(a&&t),staleTime:1e4,retry:!1}),m=(0,M.useMemo)(()=>f.data?.items??[],[f.data?.items]);return(0,P.jsxs)(`div`,{className:`space-y-6 p-6 pb-20`,children:[(0,P.jsxs)(`div`,{className:`flex items-start justify-between gap-4`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3 min-w-0`,children:[(0,P.jsx)(p,{to:`/dashboard/forward-networks`,search:{workspace:a},className:Cr({variant:`outline`,size:`icon`,className:`h-9 w-9`}),children:(0,P.jsx)(ee,{className:`h-4 w-4`})}),(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Assurance`}),(0,P.jsxs)(`p`,{className:`text-sm text-muted-foreground truncate`,children:[`Network ref: `,(0,P.jsx)(`span`,{className:`font-mono`,children:t})]})]})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsxs)(F,{onClick:()=>d.mutate(),disabled:!a||d.isPending,children:[(0,P.jsx)(Ot,{className:`h-4 w-4 mr-2`}),d.isPending?`Refreshing`:`Refresh from Forward`]}),(0,P.jsx)(F,{asChild:!0,variant:`outline`,children:(0,P.jsx)(p,{to:`/dashboard/forward-networks/$networkRef/assurance-studio`,params:{networkRef:t},search:{workspace:a},children:`Assurance Studio`})}),(0,P.jsx)(F,{asChild:!0,variant:`outline`,children:(0,P.jsx)(p,{to:`/dashboard/forward-networks/$networkRef/capacity`,params:{networkRef:t},search:{workspace:a},children:`Capacity`})})]})]}),a?o.isLoading?(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`pt-6 text-sm text-muted-foreground`,children:`Loading`})}):o.isError?(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`pt-6 text-sm text-destructive`,children:`Failed to load assurance summary.`})}):null:(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`pt-6 text-sm text-muted-foreground`,children:`Select a workspace first (open this page from the Forward Networks list).`})}),l.length>0?(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Missing Evidence`})}),(0,P.jsxs)(V,{className:`space-y-2 text-sm`,children:[(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:`Some Forward evidence has not been collected yet.`}),(0,P.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:l.map(e=>(0,P.jsx)(W,{variant:`secondary`,children:e},e))})]})]}):null,u.length>0?(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Warnings`})}),(0,P.jsx)(V,{className:`space-y-1 text-sm`,children:u.map(e=>(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:e},e))})]}):null,s?(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2 xl:grid-cols-3`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Snapshot Freshness`})}),(0,P.jsxs)(V,{className:`space-y-1 text-sm`,children:[(0,P.jsxs)(`div`,{children:[`Snapshot:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:s.snapshot.snapshotId||``})]}),(0,P.jsxs)(`div`,{children:[`Processed:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:Vf(s.snapshot.processedAt)})]}),(0,P.jsxs)(`div`,{children:[`Age:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:Hf(s.snapshot.ageSeconds)})]}),(0,P.jsxs)(`div`,{children:[`State:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:s.snapshot.state||``})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Indexing Health`})}),(0,P.jsxs)(V,{className:`space-y-1 text-sm`,children:[(0,P.jsxs)(`div`,{children:[`Overall:`,` `,(0,P.jsx)(W,{variant:s.indexingHealth.overall===`ok`?`default`:s.indexingHealth.overall===`warn`?`secondary`:`outline`,children:s.indexingHealth.overall})]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground pt-1`,children:[`pathSearch=`,s.indexingHealth.pathSearchIndexingStatus||``]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`search=`,s.indexingHealth.searchIndexingStatus||``,` l2=`,s.indexingHealth.l2IndexingStatus||``]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`host=`,s.indexingHealth.hostComputationStatus||``,` ipLoc=`,s.indexingHealth.ipLocationIndexingStatus||``]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Vulnerabilities`})}),(0,P.jsxs)(V,{className:`space-y-1 text-sm`,children:[(0,P.jsxs)(`div`,{children:[`Total:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:s.vulnerabilities.total??``}),` `,s.vulnerabilities.partial?(0,P.jsx)(W,{variant:`secondary`,className:`ml-2`,children:`partial`}):null]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Known exploit:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:s.vulnerabilities.knownExploitCount??``})]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Index created:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:Vf(s.vulnerabilities.indexCreatedAt)})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Capacity Cache`})}),(0,P.jsxs)(V,{className:`space-y-1 text-sm`,children:[(0,P.jsxs)(`div`,{children:[`As of:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:Vf(s.capacity.asOf)})]}),(0,P.jsxs)(`div`,{children:[`Hot ifaces (`,`>=`,`85% max):`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:s.capacity.hotInterfaces})]}),(0,P.jsxs)(`div`,{children:[`Max util max:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:Uf(s.capacity.maxUtilMax)})]}),(0,P.jsxs)(`div`,{children:[`Stale:`,` `,(0,P.jsx)(W,{variant:s.capacity.stale?`secondary`:`default`,children:s.capacity.stale?`yes`:`no`})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsxs)(z,{children:[`Live Signals (Last `,s.liveSignals.windowMinutes,`m)`]})}),(0,P.jsxs)(V,{className:`space-y-1 text-sm`,children:[(0,P.jsxs)(`div`,{children:[`Syslog:`,` `,(0,P.jsxs)(`span`,{className:`font-mono`,children:[s.liveSignals.syslog.total,` (crit`,` `,s.liveSignals.syslog.critical,`)`]})]}),(0,P.jsxs)(`div`,{children:[`SNMP traps:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:s.liveSignals.snmpTraps.total})]}),(0,P.jsxs)(`div`,{children:[`Webhooks:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:s.liveSignals.webhooks.total})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`History`})}),(0,P.jsx)(V,{className:`space-y-2 text-sm`,children:f.isLoading?(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:`Loading`}):f.isError?(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:`No history (migration not applied yet).`}):m.length===0?(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:`No stored summaries yet. Click Refresh.`}):(0,P.jsx)(`div`,{className:`space-y-1`,children:m.slice(0,8).map(e=>(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:Vf(String(e.generatedAt??``))}),(0,P.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:String(e.snapshotId??``).trim()||``})]},String(e.id)))})})]})]}):null]})}const Gf=t(`/dashboard/deployments/$deploymentId/map`)({component:Kf});function Kf(){let{deploymentId:e}=Gf.useParams();lu(!0);let t=i({queryKey:H.dashboardSnapshot(),queryFn:async()=>null,initialData:null,retry:!1,staleTime:1/0}),n=(0,M.useMemo)(()=>(t.data?.deployments??[]).find(t=>t.id===e),[e,t.data?.deployments]),r=String(n?.workspaceId??``),a=String(n?.type??``),o=n?.activeTaskStatus??n?.lastStatus??`unknown`,s=i({queryKey:H.deploymentTopology(r,e),queryFn:async()=>{if(!n)throw Error(`deployment not found`);return Ba(n.workspaceId,n.id)},enabled:!!n&&[`containerlab`,`netlab-c9s`,`clabernetes`].includes(a),retry:!1,staleTime:1e4});return n?(0,P.jsxs)(`div`,{className:`h-screen w-screen flex flex-col bg-background`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3 border-b px-4 py-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3 min-w-0`,children:[(0,P.jsx)(p,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e},className:Cr({variant:`outline`,size:`icon`,className:`h-9 w-9`}),title:`Back to deployment`,children:(0,P.jsx)(ee,{className:`h-4 w-4`})}),(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2 min-w-0`,children:[(0,P.jsx)(`div`,{className:`font-semibold truncate`,children:n.name}),(0,P.jsx)(W,{variant:`secondary`,className:`capitalize`,children:o}),(0,P.jsx)(W,{variant:`outline`,className:`capitalize`,children:a||`unknown`})]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:n.id})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(`a`,{href:`/dashboard/labs/designer?workspaceId=${encodeURIComponent(r)}&importDeploymentId=${encodeURIComponent(e)}`,target:`_blank`,rel:`noreferrer noopener`,className:Cr({variant:`outline`,size:`sm`}),title:`Open this running topology in the Lab Designer (new tab)`,children:[(0,P.jsx)(Rn,{className:`mr-2 h-4 w-4`}),`Edit in Designer`]}),(0,P.jsxs)(p,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e},className:Cr({variant:`outline`,size:`sm`}),title:`Open the deployment page`,children:[(0,P.jsx)(te,{className:`mr-2 h-4 w-4`}),`Details`]})]})]}),(0,P.jsx)(`div`,{className:`flex-1 min-h-0 p-3`,children:(0,P.jsx)(`div`,{className:`h-full`,children:(0,P.jsx)(Hu,{topology:s.data,workspaceId:n.workspaceId,deploymentId:n.id,enableTerminal:[`netlab-c9s`,`clabernetes`].includes(n.type),fullHeight:!0})})})]}):t.isLoading||t.isFetching?(0,P.jsxs)(`div`,{className:`h-screen w-screen p-6`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(U,{className:`h-9 w-9`}),(0,P.jsx)(U,{className:`h-8 w-64`})]}),(0,P.jsx)(`div`,{className:`mt-6`,children:(0,P.jsx)(U,{className:`h-[75vh] w-full`})})]}):(0,P.jsx)(`div`,{className:`h-screen w-screen p-6`,children:(0,P.jsx)(ec,{title:`Deployment not found`,description:`This deployment may have been deleted or you don't have access.`,action:{label:`Back`,onClick:()=>window.close()}})})}const qf=t(`/dashboard/deployments/$deploymentId/capacity`)({component:ap});function Jf(e){try{return JSON.stringify(e,null,2)}catch{return String(e)}}function Yf(e,t,n){let r=new Blob([n],{type:t}),i=URL.createObjectURL(r);try{let t=document.createElement(`a`);t.href=i,t.download=e,t.click()}finally{URL.revokeObjectURL(i)}}function Xf(e){let t=e==null?``:String(e);return t.includes(`"`)||t.includes(`,`)||t.includes(`
`)||t.includes(`\r`)?`"${t.replaceAll(`"`,`""`)}"`:t}function Zf(e,t){let n=[e.map(Xf).join(`,`)];for(let e of t)n.push(e.map(Xf).join(`,`));return n.join(`
`)+`
`}function Qf(e){if(!e)return null;let t=Date.parse(e);return Number.isFinite(t)?new Date(t):null}function $f(e){return e===void 0||!Number.isFinite(e)?``:`${(e*100).toFixed(1)}%`}function ep(e,t=3){return e===void 0||!Number.isFinite(e)?``:e.toFixed(t)}function tp(e){let t=Number(e??0);return!Number.isFinite(t)||t<=0?``:t>=1e5||t>=1e4?`${(t/1e3).toFixed(0)}G`:t>=1e3?`${(t/1e3).toFixed(1)}G`:`${t}M`}function np(e,t){if(!e.length)return null;let n=[...e].filter(e=>Number.isFinite(e)).sort((e,t)=>e-t);if(!n.length)return null;if(t<=0)return n[0];if(t>=1)return n[n.length-1];let r=t*(n.length-1),i=Math.floor(r),a=Math.ceil(r);if(i===a)return n[i];let o=r-i;return n[i]*(1-o)+n[a]*o}function rp(e){return e.startsWith(`util_`)?`UTILIZATION`:e.includes(`packet_loss`)?`PACKET_LOSS`:`ERROR`}function ip(e){return e.includes(`memory`)?`MEMORY`:`CPU`}function ap(){let{deploymentId:e}=qf.useParams(),t=c(),[n,a]=(0,M.useState)(`24h`),[o,s]=(0,M.useState)(`util_ingress`),[l,u]=(0,M.useState)(`device_cpu`),[d,f]=(0,M.useState)(``),[m,h]=(0,M.useState)(``),[g,_]=(0,M.useState)(`all`),[v,te]=(0,M.useState)(`all`),[ne,re]=(0,M.useState)(`all`),[ie,ae]=(0,M.useState)(`all`),[y,b]=(0,M.useState)(`none`),[x,S]=(0,M.useState)(168),[oe,se]=(0,M.useState)(`util_ingress`),[ce,le]=(0,M.useState)(`device_cpu`),[C,ue]=(0,M.useState)(null),[w,T]=(0,M.useState)(null),[de,fe]=(0,M.useState)(null),[E,pe]=(0,M.useState)(!1),[me,he]=(0,M.useState)(``),[ge,_e]=(0,M.useState)(!1),[ve,ye]=(0,M.useState)(``),[be,xe]=(0,M.useState)(`all`),[Se,D]=(0,M.useState)(`all`),[Ce,we]=(0,M.useState)(!1),[Te,Ee]=(0,M.useState)(``),De=i({queryKey:H.dashboardSnapshot(),queryFn:async()=>null,initialData:null,retry:!1,staleTime:1/0}),Oe=(0,M.useMemo)(()=>(De.data?.deployments??[]).find(t=>t.id===e),[De.data?.deployments,e]),ke=String(Oe?.workspaceId??``),Ae=String((Oe?.config??{}).forwardNetworkId??``),je=!!(Oe?.config??{}).forwardEnabled,Me=i({queryKey:H.deploymentCapacitySummary(ke,e),queryFn:()=>Ji(ke,e),enabled:!!(ke&&e&&je&&Ae),retry:!1,staleTime:3e4}),O=i({queryKey:H.deploymentCapacityInventory(ke,e),queryFn:()=>oa(ke,e),enabled:!!(ke&&e&&je&&Ae),retry:!1,staleTime:3e4}),Ne=r({mutationFn:async()=>{if(!ke)throw Error(`workspace not found`);return Yi(ke,e)},onSuccess:async n=>{j.success(`Refresh queued`,{description:`Run ${String(n.run?.id??``)}`.trim()}),await t.invalidateQueries({queryKey:H.deploymentCapacitySummary(ke,e)}),await t.invalidateQueries({queryKey:H.deploymentCapacityInventory(ke,e)}),await t.invalidateQueries({queryKey:[`deploymentCapacityGrowth`,ke,e]})},onError:e=>j.error(`Failed to refresh`,{description:e.message})}),Pe=r({mutationFn:async()=>ma(ke,e,{}),onSuccess:e=>fe(e.body),onError:e=>j.error(`Failed to load unhealthy devices`,{description:e.message})}),Fe=(0,M.useMemo)(()=>{let e=O.data?.devices??[],t=O.data?.interfaceVrfs??[],n=new Set,r=new Set,i=new Set,a=new Set;for(let t of e){for(let e of t.tagNames??[]){let t=String(e??``).trim();t&&n.add(t)}for(let e of t.groupNames??[]){let t=String(e??``).trim();t&&r.add(t)}let e=String(t.locationName??``).trim();e&&i.add(e)}for(let e of t){let t=String(e.vrf??``).trim();t&&a.add(t)}return{tags:Array.from(n).sort(),groups:Array.from(r).sort(),locations:Array.from(i).sort(),vrfs:Array.from(a).sort()}},[O.data?.devices,O.data?.interfaceVrfs]),Ie=n===`24h`?1:n===`7d`?7:30,Le=Me.data?.rollups??[],Re=(0,M.useMemo)(()=>{let e=d.trim().toLowerCase(),t=Le.filter(e=>e.objectType===`interface`&&e.window===n&&e.metric===o).map(e=>{let t=e.details??{},n=String(t.deviceName??``).trim(),r=String(t.interfaceName??``).trim(),i=String(t.direction??``).trim(),a=String(t.vrf??``).trim()||void 0,o=Array.isArray(t.vrfNames)?t.vrfNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,s=String(t.locationName??``).trim()||void 0,c=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,l=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0;return{id:`${n}:${r}:${i}:${e.metric}:${e.window}`,device:n,iface:r,dir:i,vrf:a,vrfNames:o,locationName:s,tagNames:c,groupNames:l,speedMbps:t.speedMbps??null,admin:String(t.adminStatus??``).trim()||void 0,oper:String(t.operStatus??``).trim()||void 0,p95:e.p95,p99:e.p99,max:e.max,slopePerDay:e.slopePerDay,forecastCrossingTs:e.forecastCrossingTs,threshold:e.threshold,samples:e.samples,raw:e}}),r=(e?t.filter(t=>t.device.toLowerCase().includes(e)||t.iface.toLowerCase().includes(e)||(t.dir||``).toLowerCase().includes(e)):t).filter(e=>{if(ne!==`all`&&(e.locationName??``)!==ne)return!1;if(ie!==`all`){let t=ie;if(e.vrf!==t&&!(e.vrfNames??[]).includes(t))return!1}return!(g!==`all`&&!(e.tagNames??[]).includes(g)||v!==`all`&&!(e.groupNames??[]).includes(v))});return r.sort((e,t)=>(t.max??0)-(e.max??0)),r},[Le,n,o,d,ne,ie,g,v]),ze=(0,M.useMemo)(()=>{let e=m.trim().toLowerCase(),t=Le.filter(e=>e.objectType===`device`&&e.window===n&&e.metric===l).map(e=>{let t=e.details??{},n=String(t.deviceName??``).trim(),r=String(t.locationName??``).trim()||void 0,i=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,a=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0;return{id:`${n}:${e.metric}:${e.window}`,device:n,metric:e.metric,locationName:r,tagNames:i,groupNames:a,vendor:String(t.vendor??``).trim()||void 0,os:String(t.os??``).trim()||void 0,model:String(t.model??``).trim()||void 0,p95:e.p95,p99:e.p99,max:e.max,slopePerDay:e.slopePerDay,forecastCrossingTs:e.forecastCrossingTs,threshold:e.threshold,samples:e.samples,raw:e}}),r=(e?t.filter(t=>t.device.toLowerCase().includes(e)||(t.vendor||``).toLowerCase().includes(e)||(t.os||``).toLowerCase().includes(e)||(t.model||``).toLowerCase().includes(e)):t).filter(e=>!(ne!==`all`&&(e.locationName??``)!==ne||g!==`all`&&!(e.tagNames??[]).includes(g)||v!==`all`&&!(e.groupNames??[]).includes(v)));return r.sort((e,t)=>(t.max??0)-(e.max??0)),r},[Le,n,l,m,ne,g,v]),Be=(0,M.useMemo)(()=>{if(y===`none`)return[];let e=new Map,t=new Map,n=(n,r)=>{let i=e.get(n)??{group:n,count:0,hotCount:0,sumSpeedGbps:0,sumP95Gbps:0,sumMaxGbps:0,p95Count:0};i.count+=1,t.has(n)||t.set(n,new Set),t.get(n).add(r.device);let a=r.max??0,s=r.p95??void 0;if(i.maxMax=Math.max(i.maxMax??0,a),s!==void 0&&(i.maxP95=Math.max(i.maxP95??0,s),o.startsWith(`util_`))){let e=Number(r.speedMbps??0);if(e>0){let t=s*e/1e3;i.maxP95Gbps=Math.max(i.maxP95Gbps??0,t)}}if(o.startsWith(`util_`)){let e=Number(r.speedMbps??0);if(e>0&&(i.sumSpeedGbps=(i.sumSpeedGbps??0)+e/1e3,s!==void 0&&Number.isFinite(s)&&(i.sumP95Gbps=(i.sumP95Gbps??0)+s*e/1e3,i.p95Count=(i.p95Count??0)+1),r.max!==void 0&&r.max!==null&&Number.isFinite(r.max)&&(i.sumMaxGbps=(i.sumMaxGbps??0)+Number(r.max)*e/1e3)),r.forecastCrossingTs){let e=r.forecastCrossingTs;i.soonestForecast?Date.parse(e)<Date.parse(i.soonestForecast)&&(i.soonestForecast=e):i.soonestForecast=e}}o.startsWith(`util_`)&&a>=(r.threshold??.85)&&(i.hotCount+=1),e.set(n,i)};for(let e of Re)if(y===`location`)n(e.locationName??`unknown`,e);else if(y===`tag`){let t=e.tagNames?.length?e.tagNames:[`untagged`];for(let r of t)n(r,e)}else if(y===`group`){let t=e.groupNames?.length?e.groupNames:[`ungrouped`];for(let r of t)n(r,e)}else y===`vrf`&&n(e.vrf??e.vrfNames?.[0]??`unknown`,e);let r=Array.from(e.values());if(y===`vrf`){let e=O.data?.routeScale??[],n=O.data?.bgpNeighbors??[];for(let i of r){let r=t.get(i.group)??new Set,a=0,o=0,s=0,c=0;for(let t of e)t.vrf===i.group&&r.has(t.deviceName)&&(a+=Number(t.ipv4Routes??0),o+=Number(t.ipv6Routes??0));for(let e of n)e.vrf===i.group&&r.has(e.deviceName)&&(s+=1,String(e.sessionState??``).toUpperCase().includes(`ESTABLISHED`)&&(c+=1));i.ipv4RoutesSum=a,i.ipv6RoutesSum=o,i.bgpNeighbors=s,i.bgpEstablished=c}}return r.sort((e,t)=>(t.maxP95Gbps??t.maxP95??0)-(e.maxP95Gbps??e.maxP95??0)),r},[Re,y,o,O.data?.routeScale,O.data?.bgpNeighbors]),Ve=(0,M.useMemo)(()=>{if(y===`none`)return[];let e=new Map,t=(t,n)=>{let r=e.get(t)??{group:t,count:0,hotCount:0};r.count+=1;let i=n.max??0,a=n.p95??void 0;r.maxMax=Math.max(r.maxMax??0,i),a!==void 0&&(r.maxP95=Math.max(r.maxP95??0,a)),i>=(n.threshold??.85)&&(r.hotCount+=1),e.set(t,r)};for(let e of ze)if(y===`location`)t(e.locationName??`unknown`,e);else if(y===`tag`){let n=e.tagNames?.length?e.tagNames:[`untagged`];for(let r of n)t(r,e)}else if(y===`group`){let n=e.groupNames?.length?e.groupNames:[`ungrouped`];for(let r of n)t(r,e)}let n=Array.from(e.values());return n.sort((e,t)=>(t.maxP95??0)-(e.maxP95??0)),n},[ze,y]),He=(0,M.useMemo)(()=>{let e=Le.filter(e=>e.metric.startsWith(`util_`));return{above:e.filter(e=>(e.max??0)>=.85).length,soonest:e.map(e=>({ts:e.forecastCrossingTs??``,r:e})).filter(e=>e.ts).sort((e,t)=>Date.parse(e.ts)-Date.parse(t.ts))[0]?.r}},[Le]),Ue=i({queryKey:[`capacityIfaceHistory`,ke,e,n,o,C?.id??``],queryFn:async()=>C?(await ua(ke,e,{type:rp(o),days:Ie,maxSamples:400,interfaces:[{deviceName:C.device,interfaceName:C.iface,direction:C.dir}]})).body:null,enabled:!!(C&&ke&&e&&je&&Ae),retry:!1,staleTime:1e4}),We=i({queryKey:[`capacityDeviceHistory`,ke,e,n,l,w?.id??``],queryFn:async()=>w?(await fa(ke,e,{type:ip(l),days:Ie,maxSamples:400,devices:[w.device]})).body:null,enabled:!!(w&&ke&&e&&je&&Ae),retry:!1,staleTime:1e4}),Ge=(0,M.useMemo)(()=>{let e=Ue.data?.metrics?.[0];return(Array.isArray(e?.data)?e.data:[]).map(e=>({x:String(e?.instant??``),y:Number(e?.value??NaN)})).filter(e=>e.x&&Number.isFinite(e.y))},[Ue.data]),Ke=(0,M.useMemo)(()=>{let e=We.data?.metrics?.[0];return(Array.isArray(e?.data)?e.data:[]).map(e=>({x:String(e?.instant??``),y:Number(e?.value??NaN)})).filter(e=>e.x&&Number.isFinite(e.y))},[We.data]),qe=(0,M.useMemo)(()=>{let e=Ge.map(e=>e.y);return{p95:np(e,.95),p99:np(e,.99),max:e.length?Math.max(...e):null}},[Ge]),Je=(0,M.useMemo)(()=>{let e=Ke.map(e=>e.y);return{p95:np(e,.95),p99:np(e,.99),max:e.length?Math.max(...e):null}},[Ke]),Ye=(0,M.useMemo)(()=>[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:200},{id:`iface`,header:`Interface`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.iface}),width:220},{id:`dir`,header:`Dir`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.dir||``}),width:90},{id:`vrf`,header:`VRF`,cell:e=>{let t=e.vrf??e.vrfNames?.[0]??``;if(!t)return(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let n=(e.vrfNames??[]).length;return(0,P.jsxs)(`div`,{className:`text-xs`,children:[(0,P.jsx)(`div`,{className:`font-mono`,children:t}),n>1?(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[n,` vrfs`]}):null]})},width:160},{id:`speed`,header:`Speed`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:tp(e.speedMbps??null)}),width:90,align:`right`},{id:`state`,header:`State`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:[e.admin,e.oper].filter(Boolean).join(` / `)||``}),width:140},{id:`p95`,header:`p95`,align:`right`,cell:e=>o.startsWith(`util_`)?$f(e.p95):ep(e.p95),width:90},...o.startsWith(`util_`)?[{id:`p95Gbps`,header:`p95 (Gbps)`,align:`right`,cell:e=>{let t=Number(e.speedMbps??0),n=Number(e.p95??NaN);return!t||!Number.isFinite(n)?(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,P.jsx)(`span`,{className:`text-xs`,children:(n*t/1e3).toFixed(2)})},width:110}]:[],{id:`max`,header:`Max`,align:`right`,cell:e=>{let t=o.startsWith(`util_`)?$f(e.max):ep(e.max),n=e.threshold??(o.startsWith(`util_`)?.85:void 0);return(0,P.jsx)(`span`,{className:n!==void 0&&(e.max??0)>=n?`text-destructive font-medium`:``,children:t})},width:90},...o.startsWith(`util_`)?[{id:`maxGbps`,header:`Max (Gbps)`,align:`right`,cell:e=>{let t=Number(e.speedMbps??0),n=Number(e.max??NaN);return!t||!Number.isFinite(n)?(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,P.jsx)(`span`,{className:`text-xs`,children:(n*t/1e3).toFixed(2)})},width:110},{id:`headroom85`,header:`Headroom@85 (Gbps)`,align:`right`,cell:e=>{let t=Number(e.speedMbps??0),n=Number(e.p95??NaN),r=Number(e.threshold??.85);return!t||!Number.isFinite(n)||!Number.isFinite(r)?(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,P.jsx)(`span`,{className:`text-xs`,children:(Math.max(0,(r-n)*t)/1e3).toFixed(2)})},width:150},{id:`days85`,header:`Days@85`,align:`right`,cell:e=>{if(!e.forecastCrossingTs)return(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let t=Qf(e.forecastCrossingTs);return t?(0,P.jsx)(`span`,{className:`text-xs`,children:Math.round((t.getTime()-Date.now())/(24*3600*1e3))}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90}]:[],{id:`slope`,header:`Slope/d`,align:`right`,cell:e=>o.startsWith(`util_`)?$f(e.slopePerDay):ep(e.slopePerDay),width:100},{id:`forecast`,header:`Forecast`,cell:e=>{if(!e.forecastCrossingTs)return(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let t=Qf(e.forecastCrossingTs),n=t?Math.round((t.getTime()-Date.now())/(24*3600*1e3)):null;return(0,P.jsxs)(`div`,{className:`text-xs`,children:[(0,P.jsx)(`div`,{className:`font-mono`,children:e.forecastCrossingTs.slice(0,10)}),n===null?null:(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[n,`d`]})]})},width:120},{id:`samples`,header:`N`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.samples||0}),width:70}],[o]),Xe=(0,M.useMemo)(()=>[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:240},{id:`meta`,header:`Meta`,cell:e=>(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[(0,P.jsx)(`div`,{children:[e.vendor,e.os].filter(Boolean).join(`  `)||``}),(0,P.jsx)(`div`,{className:`font-mono`,children:e.model||``})]}),width:240},{id:`p95`,header:`p95`,align:`right`,cell:e=>$f(e.p95),width:90},{id:`max`,header:`Max`,align:`right`,cell:e=>{let t=e.threshold??.85;return(0,P.jsx)(`span`,{className:(e.max??0)>=t?`text-destructive font-medium`:``,children:$f(e.max)})},width:90},{id:`slope`,header:`Slope/d`,align:`right`,cell:e=>$f(e.slopePerDay),width:100},{id:`forecast`,header:`Forecast`,cell:e=>{if(!e.forecastCrossingTs)return(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let t=Qf(e.forecastCrossingTs),n=t?Math.round((t.getTime()-Date.now())/(24*3600*1e3)):null;return(0,P.jsxs)(`div`,{className:`text-xs`,children:[(0,P.jsx)(`div`,{className:`font-mono`,children:e.forecastCrossingTs.slice(0,10)}),n===null?null:(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[n,`d`]})]})},width:120},{id:`samples`,header:`N`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.samples||0}),width:70}],[]),Ze=i({queryKey:H.deploymentCapacityGrowth(ke,e,n,oe,x,`interface`),queryFn:()=>ca(ke,e,{metric:oe,window:n,objectType:`interface`,compareHours:x,limit:50}),enabled:!!(ke&&e&&je&&Ae),retry:!1,staleTime:3e4}),Qe=i({queryKey:H.deploymentCapacityGrowth(ke,e,n,ce,x,`device`),queryFn:()=>ca(ke,e,{metric:ce,window:n,objectType:`device`,compareHours:x,limit:50}),enabled:!!(ke&&e&&je&&Ae),retry:!1,staleTime:3e4}),$e=(0,M.useMemo)(()=>(Ze.data?.rows??[]).map(e=>{let t=e?.now?.details??{},n=String(t.deviceName??e.objectId??``).trim(),r=String(t.interfaceName??``).trim(),i=String(t.direction??``).trim(),a=String(t.locationName??``).trim()||void 0,o=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,s=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0;return{id:String(e?.objectId??`${n}:${r}:${i}`),device:n,iface:r,dir:i,locationName:a,tagNames:o,groupNames:s,speedMbps:t.speedMbps??null,nowP95:e?.now?.p95,prevP95:e?.prev?.p95??null,deltaP95:e?.deltaP95??null,deltaP95Gbps:e?.deltaP95Gbps??null,nowMax:e?.now?.max,prevMax:e?.prev?.max??null,deltaMax:e?.deltaMax??null,nowForecast:e?.now?.forecastCrossingTs??void 0,raw:e}}).filter(e=>!(ne!==`all`&&(e.locationName??``)!==ne||g!==`all`&&!(e.tagNames??[]).includes(g)||v!==`all`&&!(e.groupNames??[]).includes(v))),[Ze.data?.rows,ne,g,v]),et=(0,M.useMemo)(()=>(Qe.data?.rows??[]).map(e=>{let t=e?.now?.details??{},n=String(t.deviceName??e.objectId??``).trim(),r=String(t.locationName??``).trim()||void 0,i=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,a=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0;return{id:String(e?.objectId??n),device:n,locationName:r,tagNames:i,groupNames:a,vendor:String(t.vendor??``).trim()||void 0,os:String(t.os??``).trim()||void 0,model:String(t.model??``).trim()||void 0,nowP95:e?.now?.p95,prevP95:e?.prev?.p95??null,deltaP95:e?.deltaP95??null,nowMax:e?.now?.max,prevMax:e?.prev?.max??null,deltaMax:e?.deltaMax??null,nowForecast:e?.now?.forecastCrossingTs??void 0,raw:e}}).filter(e=>!(ne!==`all`&&(e.locationName??``)!==ne||g!==`all`&&!(e.tagNames??[]).includes(g)||v!==`all`&&!(e.groupNames??[]).includes(v))),[Qe.data?.rows,ne,g,v]),tt=(0,M.useMemo)(()=>{let e=new Set,t=new Set;for(let n of O.data?.routeScale??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();r&&e.add(r),i&&t.add(i)}for(let n of O.data?.bgpNeighbors??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();r&&e.add(r),i&&t.add(i)}return{devices:Array.from(e).sort(),vrfs:Array.from(t).sort()}},[O.data?.routeScale,O.data?.bgpNeighbors]),nt=(0,M.useMemo)(()=>(O.data?.routeScale??[]).filter(e=>!(be!==`all`&&e.deviceName!==be||Se!==`all`&&e.vrf!==Se)),[O.data?.routeScale,be,Se]),rt=(0,M.useMemo)(()=>(O.data?.bgpNeighbors??[]).filter(e=>!(be!==`all`&&e.deviceName!==be||Se!==`all`&&e.vrf!==Se)),[O.data?.bgpNeighbors,be,Se]),it=(0,M.useMemo)(()=>(O.data?.hardwareTcam??[]).filter(e=>!(be!==`all`&&e.deviceName!==be)),[O.data?.hardwareTcam,be]),at=(0,M.useMemo)(()=>{let e=new Map,t=(e,t)=>`${e}||${t}`;for(let n of O.data?.routeScale??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();if(!r||!i)continue;let a=t(r,i),o=e.get(a)??{id:a,deviceName:r,vrf:i,ipv4Routes:0,ipv6Routes:0,bgpNeighbors:0,bgpEstablished:0};o.ipv4Routes=Number(n.ipv4Routes??0),o.ipv6Routes=Number(n.ipv6Routes??0),e.set(a,o)}for(let n of O.data?.bgpNeighbors??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();if(!r||!i)continue;let a=t(r,i),o=e.get(a)??{id:a,deviceName:r,vrf:i,ipv4Routes:0,ipv6Routes:0,bgpNeighbors:0,bgpEstablished:0};o.bgpNeighbors+=1,String(n.sessionState??``).toUpperCase().includes(`ESTABLISHED`)&&(o.bgpEstablished+=1),e.set(a,o)}for(let r of Le){if(r.objectType!==`interface`||r.window!==n||!r.metric.startsWith(`util_`))continue;let i=r.details??{},a=String(i.deviceName??``).trim(),o=String(i.vrf??``).trim();if(!a||!o)continue;let s=t(a,o),c=e.get(s)??{id:s,deviceName:a,vrf:o,ipv4Routes:0,ipv6Routes:0,bgpNeighbors:0,bgpEstablished:0};c.maxIfaceMax=Math.max(c.maxIfaceMax??0,r.max??0),r.p95!==void 0&&r.p95!==null&&(c.maxIfaceP95=Math.max(c.maxIfaceP95??0,r.p95??0));let l=r.forecastCrossingTs??``;l&&(c.soonestForecast?Date.parse(l)<Date.parse(c.soonestForecast)&&(c.soonestForecast=l):c.soonestForecast=l),e.set(s,c)}let r=Array.from(e.values());return r.sort((e,t)=>(t.maxIfaceMax??0)-(e.maxIfaceMax??0)),r},[O.data?.routeScale,O.data?.bgpNeighbors,Le,n]);return Oe?(0,P.jsxs)(`div`,{className:`space-y-6 p-6 pb-20`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(p,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e},className:Cr({variant:`outline`,size:`icon`,className:`h-9 w-9`}),title:`Back to deployment`,children:(0,P.jsx)(ee,{className:`h-4 w-4`})}),(0,P.jsxs)(`div`,{children:[(0,P.jsxs)(`h1`,{className:`text-2xl font-bold tracking-tight flex items-center gap-2`,children:[(0,P.jsx)(Hn,{className:`h-5 w-5`}),` Capacity`]}),(0,P.jsxs)(`p`,{className:`text-sm text-muted-foreground mt-1`,children:[`Deployment: `,(0,P.jsx)(`span`,{className:`font-medium`,children:Oe.name})]})]})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsxs)(q,{value:n,onValueChange:e=>a(e),children:[(0,P.jsx)(Y,{className:`w-[110px]`,children:(0,P.jsx)(J,{placeholder:`Window`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`24h`,children:`24h`}),(0,P.jsx)(Z,{value:`7d`,children:`7d`}),(0,P.jsx)(Z,{value:`30d`,children:`30d`})]})]}),(0,P.jsxs)(q,{value:ne,onValueChange:re,children:[(0,P.jsx)(Y,{className:`w-[190px]`,children:(0,P.jsx)(J,{placeholder:`Location`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All locations`}),Fe.locations.map(e=>(0,P.jsx)(Z,{value:e,children:e},e))]})]}),(0,P.jsxs)(q,{value:ie,onValueChange:ae,children:[(0,P.jsx)(Y,{className:`w-[170px]`,children:(0,P.jsx)(J,{placeholder:`VRF`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All VRFs`}),Fe.vrfs.map(e=>(0,P.jsx)(Z,{value:e,children:e},e))]})]}),(0,P.jsxs)(q,{value:g,onValueChange:_,children:[(0,P.jsx)(Y,{className:`w-[170px]`,children:(0,P.jsx)(J,{placeholder:`Tag`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All tags`}),Fe.tags.map(e=>(0,P.jsx)(Z,{value:e,children:e},e))]})]}),(0,P.jsxs)(q,{value:v,onValueChange:te,children:[(0,P.jsx)(Y,{className:`w-[170px]`,children:(0,P.jsx)(J,{placeholder:`Group`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All groups`}),Fe.groups.map(e=>(0,P.jsx)(Z,{value:e,children:e},e))]})]}),(0,P.jsxs)(q,{value:y,onValueChange:e=>b(e),children:[(0,P.jsx)(Y,{className:`w-[140px]`,children:(0,P.jsx)(J,{placeholder:`Group by`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`none`,children:`No grouping`}),(0,P.jsx)(Z,{value:`location`,children:`Location`}),(0,P.jsx)(Z,{value:`tag`,children:`Tag`}),(0,P.jsx)(Z,{value:`group`,children:`Group`}),(0,P.jsx)(Z,{value:`vrf`,children:`VRF`})]})]}),(0,P.jsxs)(F,{variant:`outline`,onClick:()=>Ne.mutate(),disabled:Ne.isPending||!je||!Ae,title:!je||!Ae?`Enable Forward and run sync first`:`Enqueue a background rollup task`,children:[(0,P.jsx)(Ot,{className:`mr-2 h-4 w-4`}),Ne.isPending?`Queueing`:`Refresh`]})]})]}),(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-4 md:grid-cols-3`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`As Of`})}),(0,P.jsxs)(V,{className:`text-sm`,children:[(0,P.jsx)(`div`,{className:`font-mono text-xs`,children:Me.data?.asOf??O.data?.asOf??``}),(0,P.jsxs)(`div`,{className:`mt-2 flex items-center gap-2`,children:[Me.data?.stale?(0,P.jsx)(W,{variant:`destructive`,children:`Stale`}):(0,P.jsx)(W,{variant:`secondary`,children:`Fresh`}),(0,P.jsx)(W,{variant:`outline`,className:`font-mono text-xs`,children:Ae||`no-forward`})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`Hot Interfaces`})}),(0,P.jsxs)(V,{className:`text-sm`,children:[(0,P.jsx)(`div`,{className:`text-2xl font-semibold`,children:He.above}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground mt-1`,children:`util_* max >= 85%`})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`Soonest Saturation`})}),(0,P.jsx)(V,{className:`text-sm`,children:He.soonest?.forecastCrossingTs?(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`font-mono text-xs`,children:He.soonest.forecastCrossingTs}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[String(He.soonest.details?.deviceName??``),` `,String(He.soonest.details?.interfaceName??``),` `,String(He.soonest.details?.direction??``)]})]}):(0,P.jsx)(`div`,{className:`text-muted-foreground text-sm`,children:``})})]})]}),(0,P.jsxs)(Bc,{defaultValue:`interfaces`,className:`space-y-4`,children:[(0,P.jsxs)(Vc,{children:[(0,P.jsx)(Hc,{value:`interfaces`,children:`Interfaces`}),(0,P.jsx)(Hc,{value:`devices`,children:`Devices`}),(0,P.jsx)(Hc,{value:`growth`,children:`Growth`}),(0,P.jsx)(Hc,{value:`routing`,children:`Routing/BGP`}),(0,P.jsx)(Hc,{value:`health`,children:`Health`}),(0,P.jsx)(Hc,{value:`raw`,children:`Raw`})]}),(0,P.jsx)(Uc,{value:`interfaces`,className:`space-y-4`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Interface Capacity`}),(0,P.jsxs)(`div`,{className:`flex flex-col gap-2 md:flex-row md:items-center`,children:[(0,P.jsx)(K,{placeholder:`Filter (device / interface)`,value:d,onChange:e=>f(e.target.value),className:`w-[260px]`}),(0,P.jsxs)(q,{value:o,onValueChange:e=>s(e),children:[(0,P.jsx)(Y,{className:`w-[240px]`,children:(0,P.jsx)(J,{placeholder:`Metric`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`util_ingress`,children:`Utilization (ingress)`}),(0,P.jsx)(Z,{value:`util_egress`,children:`Utilization (egress)`}),(0,P.jsx)(Z,{value:`if_error_ingress`,children:`Errors (ingress)`}),(0,P.jsx)(Z,{value:`if_error_egress`,children:`Errors (egress)`}),(0,P.jsx)(Z,{value:`if_packet_loss_ingress`,children:`Packet loss (ingress)`}),(0,P.jsx)(Z,{value:`if_packet_loss_egress`,children:`Packet loss (egress)`})]})]}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>{let t=[`device`,`interface`,`direction`,`window`,`metric`,`speedMbps`,`adminStatus`,`operStatus`,`p95`,`p99`,`max`,`slopePerDay`,`forecastCrossingTs`,`samples`],r=Re.map(e=>[e.device,e.iface,e.dir,n,o,e.speedMbps??``,e.admin??``,e.oper??``,e.p95??``,e.p99??``,e.max??``,e.slopePerDay??``,e.forecastCrossingTs??``,e.samples??0]);Yf(`capacity_interfaces_${e}_${n}_${o}.csv`,`text/csv`,Zf(t,r))},disabled:Re.length===0,children:`Export CSV`}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>pe(!0),disabled:O.isLoading||O.isError,title:`Pick any interface from NQE inventory and load trend from Forward perf history`,children:`Pick interface`})]})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[y===`none`?null:(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Group summary (`,y,`)`]}),(0,P.jsx)($s,{columns:o.startsWith(`util_`)?[{id:`group`,header:`Group`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.group}),width:220},...y===`vrf`?[{id:`routes`,header:`Routes (v4/v6)`,align:`right`,cell:e=>(0,P.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[Number(e.ipv4RoutesSum??0),`/`,Number(e.ipv6RoutesSum??0)]}),width:130},{id:`bgp`,header:`BGP`,align:`right`,cell:e=>(0,P.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[Number(e.bgpNeighbors??0),` (`,Number(e.bgpEstablished??0),`)`]}),width:100}]:[],{id:`count`,header:`Ifaces`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.count}),width:80},{id:`speed`,header:` Speed (Gbps)`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.sumSpeedGbps===void 0?``:e.sumSpeedGbps.toFixed(1)}),width:120},{id:`p95sum`,header:` p95 (Gbps)`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.sumP95Gbps===void 0?``:e.sumP95Gbps.toFixed(2)}),width:120},{id:`maxsum`,header:` Max (Gbps)`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.sumMaxGbps===void 0?``:e.sumMaxGbps.toFixed(2)}),width:120},{id:`utilp95`,header:`Util@p95`,align:`right`,cell:e=>{let t=Number(e.sumSpeedGbps??0),n=Number(e.sumP95Gbps??0);return t?(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:$f(n/t)}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90},{id:`utilmax`,header:`Util@max`,align:`right`,cell:e=>{let t=Number(e.sumSpeedGbps??0),n=Number(e.sumMaxGbps??0);return t?(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:$f(n/t)}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90},{id:`headroom`,header:`Headroom@85 (Gbps)`,align:`right`,cell:e=>{let t=Number(e.sumSpeedGbps??0),n=Number(e.sumP95Gbps??0);return t?(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:Math.max(0,t*.85-n).toFixed(2)}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:150},{id:`p95cov`,header:`p95 cov`,align:`right`,cell:e=>(0,P.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[Number(e.p95Count??0),`/`,e.count]}),width:90},{id:`soonest`,header:`Soonest`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.soonestForecast?e.soonestForecast.slice(0,10):``}),width:110}]:[{id:`group`,header:`Group`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.group}),width:260},{id:`count`,header:`Count`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.count}),width:90},{id:`hot`,header:`Hot`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.hotCount}),width:90},{id:`p95`,header:`Max p95`,align:`right`,cell:e=>ep(e.maxP95),width:100}],rows:Be,getRowId:e=>e.group,onRowClick:e=>{y===`location`?re(e.group):y===`tag`?_(e.group===`untagged`?`all`:e.group):y===`group`?te(e.group===`ungrouped`?`all`:e.group):y===`vrf`&&ae(e.group===`unknown`?`all`:e.group)},emptyText:`No groups.`,maxHeightClassName:`max-h-[260px]`,minWidthClassName:`min-w-0`})]}),Me.isLoading?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(U,{className:`h-5 w-56`}),(0,P.jsx)(U,{className:`h-32 w-full`})]}):Me.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load summary:`,` `,Me.error instanceof Error?Me.error.message:String(Me.error)]}):(0,P.jsx)($s,{columns:Ye,rows:Re,getRowId:e=>e.id,onRowClick:e=>ue(e),emptyText:`No rollups for this window/metric yet. Click Refresh to enqueue.`})]})]})}),(0,P.jsx)(Uc,{value:`devices`,className:`space-y-4`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Device Capacity`}),(0,P.jsxs)(`div`,{className:`flex flex-col gap-2 md:flex-row md:items-center`,children:[(0,P.jsx)(K,{placeholder:`Filter (device / vendor / os)`,value:m,onChange:e=>h(e.target.value),className:`w-[260px]`}),(0,P.jsxs)(q,{value:l,onValueChange:e=>u(e),children:[(0,P.jsx)(Y,{className:`w-[220px]`,children:(0,P.jsx)(J,{placeholder:`Metric`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`device_cpu`,children:`CPU`}),(0,P.jsx)(Z,{value:`device_memory`,children:`Memory`})]})]}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>{let t=[`device`,`window`,`metric`,`vendor`,`os`,`model`,`p95`,`p99`,`max`,`slopePerDay`,`forecastCrossingTs`,`samples`],r=ze.map(e=>[e.device,n,l,e.vendor??``,e.os??``,e.model??``,e.p95??``,e.p99??``,e.max??``,e.slopePerDay??``,e.forecastCrossingTs??``,e.samples??0]);Yf(`capacity_devices_${e}_${n}_${l}.csv`,`text/csv`,Zf(t,r))},disabled:ze.length===0,children:`Export CSV`}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>_e(!0),disabled:O.isLoading||O.isError,title:`Pick any device from NQE inventory and load trend from Forward perf history`,children:`Pick device`})]})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[y===`none`?null:(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Group summary (`,y,`)`]}),(0,P.jsx)($s,{columns:[{id:`group`,header:`Group`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.group}),width:260},{id:`count`,header:`Count`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.count}),width:90},{id:`hot`,header:`Hot`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.hotCount}),width:90},{id:`p95`,header:`Max p95`,align:`right`,cell:e=>$f(e.maxP95),width:100}],rows:Ve,getRowId:e=>e.group,emptyText:`No groups.`,maxHeightClassName:`max-h-[260px]`,minWidthClassName:`min-w-0`})]}),Me.isLoading?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(U,{className:`h-5 w-56`}),(0,P.jsx)(U,{className:`h-32 w-full`})]}):Me.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load summary:`,` `,Me.error instanceof Error?Me.error.message:String(Me.error)]}):(0,P.jsx)($s,{columns:Xe,rows:ze,getRowId:e=>e.id,onRowClick:e=>T(e),emptyText:`No rollups for this window/metric yet. Click Refresh to enqueue.`})]})]})}),(0,P.jsxs)(Uc,{value:`growth`,className:`space-y-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Growth (Delta vs Prior)`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsxs)(q,{value:String(x),onValueChange:e=>S(Number(e)),children:[(0,P.jsx)(Y,{className:`w-[150px]`,children:(0,P.jsx)(J,{placeholder:`Compare`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`24`,children:`24h`}),(0,P.jsx)(Z,{value:`168`,children:`7d`}),(0,P.jsx)(Z,{value:`720`,children:`30d`}),(0,P.jsx)(Z,{value:`2160`,children:`90d`})]})]}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`As of`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:Ze.data?.asOf??Qe.data?.asOf??Me.data?.asOf??``}),`  `,`Compared to`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:Ze.data?.compareAsOf??Qe.data?.compareAsOf??``})]})]})]}),(0,P.jsx)(V,{className:`text-sm text-muted-foreground`,children:`Top growers computed from Skyforge rollups (no Forward time-series pull). Use Refresh to enqueue rollup recomputation.`})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Interfaces`}),(0,P.jsxs)(q,{value:oe,onValueChange:e=>se(e),children:[(0,P.jsx)(Y,{className:`w-[240px]`,children:(0,P.jsx)(J,{placeholder:`Metric`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`util_ingress`,children:`Utilization (ingress)`}),(0,P.jsx)(Z,{value:`util_egress`,children:`Utilization (egress)`})]})]})]}),(0,P.jsx)(V,{children:Ze.isLoading?(0,P.jsx)(U,{className:`h-32 w-full`}):Ze.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load growth:`,` `,Ze.error instanceof Error?Ze.error.message:String(Ze.error)]}):(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:220},{id:`iface`,header:`Interface`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.iface}),width:220},{id:`dir`,header:`Dir`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.dir}),width:90},{id:`speed`,header:`Speed`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:tp(e.speedMbps??null)}),width:90},{id:`nowP95`,header:`Now p95`,align:`right`,cell:e=>$f(e.nowP95),width:100},{id:`prevP95`,header:`Prev p95`,align:`right`,cell:e=>$f(e.prevP95??void 0),width:100},{id:`deltaP95`,header:` p95`,align:`right`,cell:e=>{let t=e.deltaP95;return t==null?(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,P.jsxs)(`span`,{className:t>0?`text-foreground font-medium`:`text-muted-foreground`,children:[t>=0?`+`:``,$f(t)]})},width:90},{id:`deltaGbps`,header:` p95 (Gbps)`,align:`right`,cell:e=>e.deltaP95Gbps!==null&&e.deltaP95Gbps!==void 0?(0,P.jsxs)(`span`,{className:`text-xs`,children:[e.deltaP95Gbps>=0?`+`:``,e.deltaP95Gbps.toFixed(2)]}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}),width:120},{id:`forecast`,header:`Forecast`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.nowForecast?e.nowForecast.slice(0,10):``}),width:120}],rows:$e,getRowId:e=>e.id,onRowClick:e=>{s(oe),ue({id:`${e.device}:${e.iface}:${e.dir}:growth`,device:e.device,iface:e.iface,dir:e.dir||`INGRESS`,speedMbps:e.speedMbps??null,samples:0})},emptyText:`No growth rows yet. Click Refresh to enqueue.`})})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Devices`}),(0,P.jsxs)(q,{value:ce,onValueChange:e=>le(e),children:[(0,P.jsx)(Y,{className:`w-[220px]`,children:(0,P.jsx)(J,{placeholder:`Metric`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`device_cpu`,children:`CPU`}),(0,P.jsx)(Z,{value:`device_memory`,children:`Memory`})]})]})]}),(0,P.jsx)(V,{children:Qe.isLoading?(0,P.jsx)(U,{className:`h-32 w-full`}):Qe.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load growth:`,` `,Qe.error instanceof Error?Qe.error.message:String(Qe.error)]}):(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:240},{id:`meta`,header:`Meta`,cell:e=>(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[(0,P.jsx)(`div`,{children:[e.vendor,e.os].filter(Boolean).join(`  `)||``}),(0,P.jsx)(`div`,{className:`font-mono`,children:e.model||``})]}),width:240},{id:`nowP95`,header:`Now p95`,align:`right`,cell:e=>$f(e.nowP95),width:100},{id:`prevP95`,header:`Prev p95`,align:`right`,cell:e=>$f(e.prevP95??void 0),width:100},{id:`deltaP95`,header:` p95`,align:`right`,cell:e=>{let t=e.deltaP95;return t==null?(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,P.jsxs)(`span`,{className:t>0?`text-foreground font-medium`:`text-muted-foreground`,children:[t>=0?`+`:``,$f(t)]})},width:90},{id:`forecast`,header:`Forecast`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.nowForecast?e.nowForecast.slice(0,10):``}),width:120}],rows:et,getRowId:e=>e.id,onRowClick:e=>{u(ce),T({id:`${e.device}:growth`,device:e.device,metric:ce,vendor:e.vendor,os:e.os,model:e.model,samples:0})},emptyText:`No growth rows yet. Click Refresh to enqueue.`})})]})]}),(0,P.jsxs)(Uc,{value:`routing`,className:`space-y-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{className:`text-base`,children:`VRF Summary (Perf + Scale)`})}),(0,P.jsx)(V,{children:O.isLoading?(0,P.jsx)(U,{className:`h-28 w-full`}):O.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,O.error instanceof Error?O.error.message:String(O.error)]}):(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:240},{id:`vrf`,header:`VRF`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:180},{id:`v4`,header:`IPv4`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.ipv4Routes}),width:90},{id:`v6`,header:`IPv6`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.ipv6Routes}),width:90},{id:`bgp`,header:`BGP`,align:`right`,cell:e=>(0,P.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[e.bgpNeighbors,` (`,e.bgpEstablished,`)`]}),width:110},{id:`max`,header:`Max util`,align:`right`,cell:e=>$f(e.maxIfaceMax),width:100},{id:`forecast`,header:`Soonest`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.soonestForecast?e.soonestForecast.slice(0,10):``}),width:120}],rows:at,getRowId:e=>e.id,onRowClick:e=>{xe(e.deviceName),D(e.vrf),ae(e.vrf)},emptyText:`No VRF summary available yet. Click Refresh to enqueue.`,maxHeightClassName:`max-h-[360px]`,minWidthClassName:`min-w-0`})})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-2 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Hardware Capacity (TCAM)`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Derived from Forward CUSTOM command outputs. Configure a TCAM command collection to populate.`})]}),(0,P.jsx)(V,{children:O.isLoading?(0,P.jsx)(U,{className:`h-28 w-full`}):O.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,O.error instanceof Error?O.error.message:String(O.error)]}):(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:240},{id:`meta`,header:`Meta`,cell:e=>(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[(0,P.jsx)(`div`,{children:[e.vendor??``,e.os??``].filter(Boolean).join(`  `)||``}),(0,P.jsx)(`div`,{className:`font-mono`,children:String(e.model??``)})]}),width:240},{id:`used`,header:`Used`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:Number(e.tcamUsed??0)}),width:90},{id:`total`,header:`Total`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs tabular-nums`,children:Number(e.tcamTotal??0)}),width:90},{id:`util`,header:`Util`,align:`right`,cell:e=>{let t=Number(e.tcamUsed??0),n=Number(e.tcamTotal??0);return n?(0,P.jsx)(`span`,{className:`text-xs`,children:$f(t/n)}):(0,P.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90},{id:`cmd`,header:`Command`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:String(e.commandText??``).slice(0,48)||``}),width:260},{id:`evidence`,header:`Evidence`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:String(e.evidence??``).slice(0,60)||``}),width:320}],rows:it,getRowId:e=>e.deviceName,onRowClick:e=>{xe(e.deviceName),Ee([`device: ${String(e.deviceName??``)}`,`command: ${String(e.commandText??``)}`,`used/total: ${Number(e.tcamUsed??0)}/${Number(e.tcamTotal??0)}`,``,String(e.evidence??``)].join(`
`)),we(!0)},emptyText:`No TCAM rows cached yet. Click Refresh after enabling custom commands.`,maxHeightClassName:`max-h-[320px]`,minWidthClassName:`min-w-0`})})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Routing Scale`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsxs)(q,{value:be,onValueChange:xe,children:[(0,P.jsx)(Y,{className:`w-[220px]`,children:(0,P.jsx)(J,{placeholder:`Device`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All devices`}),tt.devices.map(e=>(0,P.jsx)(Z,{value:e,children:e},e))]})]}),(0,P.jsxs)(q,{value:Se,onValueChange:D,children:[(0,P.jsx)(Y,{className:`w-[170px]`,children:(0,P.jsx)(J,{placeholder:`VRF`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`all`,children:`All VRFs`}),tt.vrfs.map(e=>(0,P.jsx)(Z,{value:e,children:e},e))]})]}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>{xe(`all`),D(`all`)},disabled:be===`all`&&Se===`all`,children:`Clear`})]})]}),(0,P.jsx)(V,{children:O.isLoading?(0,P.jsx)(U,{className:`h-28 w-full`}):O.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,O.error instanceof Error?O.error.message:String(O.error)]}):(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:240},{id:`vrf`,header:`VRF`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:180},{id:`v4`,header:`IPv4`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.ipv4Routes}),width:90},{id:`v6`,header:`IPv6`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.ipv6Routes}),width:90}],rows:nt,getRowId:e=>`${e.deviceName}:${e.vrf}`,emptyText:`No routing scale cached yet. Click Refresh to enqueue.`})})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{className:`text-base`,children:`BGP Neighbors`})}),(0,P.jsx)(V,{children:O.isLoading?(0,P.jsx)(U,{className:`h-28 w-full`}):O.isError?(0,P.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,O.error instanceof Error?O.error.message:String(O.error)]}):(0,P.jsx)($s,{columns:[{id:`device`,header:`Device`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:220},{id:`vrf`,header:`VRF`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:160},{id:`nbr`,header:`Neighbor`,cell:e=>(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:e.neighborAddress}),width:220},{id:`state`,header:`State`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.sessionState??``}),width:120},{id:`rx`,header:`Rx`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.receivedPrefixes??``}),width:90},{id:`tx`,header:`Tx`,align:`right`,cell:e=>(0,P.jsx)(`span`,{className:`text-xs`,children:e.advertisedPrefixes??``}),width:90}],rows:rt,getRowId:e=>`${e.deviceName}:${e.vrf}:${e.neighborAddress}`,emptyText:`No BGP cache yet. Click Refresh to enqueue.`})})]})]}),(0,P.jsx)(Uc,{value:`health`,className:`space-y-4`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsx)(z,{className:`text-base`,children:`Health Issues`}),(0,P.jsx)(F,{variant:`outline`,onClick:()=>Pe.mutate(),disabled:Pe.isPending,children:Pe.isPending?`Loading`:`Load unhealthy devices`})]}),(0,P.jsx)(V,{className:`space-y-2`,children:de?(0,P.jsx)(`pre`,{className:`max-h-[60vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:Jf(de)}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loads Forward health signals (including high utilization) around the latest processed snapshot.`})})]})}),(0,P.jsxs)(Uc,{value:`raw`,className:`space-y-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{className:`text-base`,children:`Raw Rollups`})}),(0,P.jsx)(V,{className:`space-y-2`,children:Me.isLoading?(0,P.jsx)(U,{className:`h-32 w-full`}):Me.isError?(0,P.jsx)(`div`,{className:`text-destructive text-sm`,children:Me.error instanceof Error?Me.error.message:String(Me.error)}):(0,P.jsx)(`pre`,{className:`max-h-[65vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:Jf(Me.data?.rollups??[])})})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{className:`text-base`,children:`Raw Inventory`})}),(0,P.jsx)(V,{className:`space-y-2`,children:O.isLoading?(0,P.jsx)(U,{className:`h-32 w-full`}):O.isError?(0,P.jsx)(`div`,{className:`text-destructive text-sm`,children:O.error instanceof Error?O.error.message:String(O.error)}):(0,P.jsx)(`pre`,{className:`max-h-[65vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:Jf(O.data??{})})})]})]})]}),(0,P.jsx)(tr,{open:!!C,onOpenChange:e=>!e&&ue(null),children:(0,P.jsxs)(ir,{className:`max-w-3xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-base`,children:`Interface Trend`})}),C?(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`text-sm`,children:[(0,P.jsxs)(`span`,{className:`font-mono text-xs`,children:[C.device,` `,C.iface,` `,C.dir]}),` `,(0,P.jsx)(W,{variant:`outline`,className:`ml-2`,children:n}),(0,P.jsx)(W,{variant:`secondary`,className:`ml-2`,children:o}),(0,P.jsxs)(q,{value:C.dir,onValueChange:e=>ue(t=>t&&{...t,dir:String(e)}),children:[(0,P.jsx)(Y,{className:`ml-2 inline-flex h-7 w-[140px]`,children:(0,P.jsx)(J,{placeholder:`Direction`})}),(0,P.jsxs)(X,{children:[(0,P.jsx)(Z,{value:`INGRESS`,children:`INGRESS`}),(0,P.jsx)(Z,{value:`EGRESS`,children:`EGRESS`})]})]}),C.vrf||C.vrfNames?.length?(0,P.jsxs)(`div`,{className:`mt-2 flex flex-wrap items-center gap-2 text-xs`,children:[(0,P.jsx)(W,{variant:`outline`,className:`font-mono text-xs`,children:`VRF`}),(0,P.jsxs)(`span`,{className:`font-mono text-xs`,children:[C.vrf??(C.vrfNames??[]).slice(0,3).join(`, `),(C.vrfNames??[]).length>3?``:``]}),(0,P.jsx)(F,{variant:`outline`,className:`h-7 px-2`,onClick:()=>{xe(C.device),D(C.vrf??C.vrfNames?.[0]??`all`)},title:`Filter Routing/BGP tables to this device/VRF`,children:`Filter routing`})]}):null]}),Ue.isLoading?(0,P.jsx)(U,{className:`h-24 w-full`}):Ue.isError?(0,P.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load history`}):(0,P.jsx)(Zd,{points:Ge}),(()=>{let e=C.vrfNames?.length?C.vrfNames:C.vrf?[C.vrf]:[];if(!e.length)return null;let t=(O.data?.routeScale??[]).filter(t=>t.deviceName===C.device&&e.includes(t.vrf)),n=(O.data?.bgpNeighbors??[]).filter(t=>t.deviceName===C.device&&e.includes(t.vrf)),r=t.reduce((e,t)=>e+Number(t.ipv4Routes??0),0),i=t.reduce((e,t)=>e+Number(t.ipv6Routes??0),0),a=n.filter(e=>String(e.sessionState??``).toUpperCase().includes(`ESTABLISHED`)).length;return(0,P.jsxs)(`div`,{className:`rounded-md border bg-muted/20 p-3 text-xs`,children:[(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center justify-between gap-2`,children:[(0,P.jsxs)(`div`,{className:`text-muted-foreground`,children:[`Routing context for`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:e.slice(0,3).join(`, `)}),e.length>3?``:``]}),(0,P.jsx)(F,{variant:`outline`,className:`h-7 px-2`,onClick:()=>{xe(C.device),D(e[0]??`all`)},children:`View in Routing tab`})]}),(0,P.jsxs)(`div`,{className:`mt-2 grid grid-cols-2 gap-2`,children:[(0,P.jsxs)(`div`,{children:[`FIB routes (sum):`,` `,(0,P.jsxs)(`span`,{className:`font-mono`,children:[`v4=`,r,` v6=`,i]})]}),(0,P.jsxs)(`div`,{className:`text-right`,children:[`BGP neighbors:`,` `,(0,P.jsxs)(`span`,{className:`font-mono`,children:[n.length,` (`,a,` established)`]})]})]})]})})(),(0,P.jsxs)(`div`,{className:`grid grid-cols-2 gap-3 text-xs text-muted-foreground`,children:[(0,P.jsxs)(`div`,{children:[`p95:`,` `,o.startsWith(`util_`)?$f(C.p95??qe.p95??void 0):ep(C.p95??qe.p95??void 0)]}),(0,P.jsxs)(`div`,{className:`text-right`,children:[`max:`,` `,o.startsWith(`util_`)?$f(C.max??qe.max??void 0):ep(C.max??qe.max??void 0)]}),(0,P.jsxs)(`div`,{children:[`slope/day:`,` `,o.startsWith(`util_`)?$f(C.slopePerDay):ep(C.slopePerDay)]}),(0,P.jsxs)(`div`,{className:`text-right`,children:[`forecast:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:C.forecastCrossingTs??``})]}),(0,P.jsxs)(`div`,{children:[`speed: `,tp(C.speedMbps??null)]}),(0,P.jsxs)(`div`,{className:`text-right`,children:[`p95 (Gbps): `,(()=>{if(!o.startsWith(`util_`))return``;let e=Number(C.speedMbps??0),t=Number(C.p95??qe.p95??NaN);return!e||!Number.isFinite(t)?``:(t*e/1e3).toFixed(2)})()]})]})]}):null]})}),(0,P.jsx)(tr,{open:!!w,onOpenChange:e=>!e&&T(null),children:(0,P.jsxs)(ir,{className:`max-w-3xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-base`,children:`Device Trend`})}),w?(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`text-sm`,children:[(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:w.device}),` `,(0,P.jsx)(W,{variant:`outline`,className:`ml-2`,children:n}),(0,P.jsx)(W,{variant:`secondary`,className:`ml-2`,children:l})]}),We.isLoading?(0,P.jsx)(U,{className:`h-24 w-full`}):We.isError?(0,P.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load history`}):(0,P.jsx)(Zd,{points:Ke}),(0,P.jsxs)(`div`,{className:`grid grid-cols-2 gap-3 text-xs text-muted-foreground`,children:[(0,P.jsxs)(`div`,{children:[`p95:`,` `,$f(w.p95??Je.p95??void 0)]}),(0,P.jsxs)(`div`,{className:`text-right`,children:[`max:`,` `,$f(w.max??Je.max??void 0)]}),(0,P.jsxs)(`div`,{children:[`slope/day: `,$f(w.slopePerDay)]}),(0,P.jsxs)(`div`,{className:`text-right`,children:[`forecast:`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:w.forecastCrossingTs??``})]})]})]}):null]})}),(0,P.jsx)(tr,{open:E,onOpenChange:e=>!e&&pe(!1),children:(0,P.jsxs)(ir,{className:`max-w-2xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-base`,children:`Pick Interface`})}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsx)(K,{placeholder:`Search device/interface`,value:me,onChange:e=>he(e.target.value)}),(0,P.jsx)(`div`,{className:`max-h-[55vh] overflow-auto rounded-md border`,children:(()=>{let e=O.data?.interfaces??[],t=me.trim().toLowerCase(),n=(t?e.filter(e=>{let n=String(e.deviceName??``).toLowerCase(),r=String(e.interfaceName??``).toLowerCase();return n.includes(t)||r.includes(t)}):e).slice(0,200);return n.length?(0,P.jsx)(`div`,{className:`divide-y`,children:n.map(e=>{let t=String(e.deviceName??``),n=String(e.interfaceName??``),r=tp(e.speedMbps??null);return(0,P.jsx)(`button`,{type:`button`,className:`w-full px-3 py-2 text-left hover:bg-muted/40`,onClick:()=>{ue({id:`${t}:${n}:INGRESS:pick`,device:t,iface:n,dir:`INGRESS`,speedMbps:e.speedMbps??null,admin:e.adminStatus??void 0,oper:e.operStatus??void 0,samples:0}),pe(!1)},children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsxs)(`div`,{className:`font-mono text-xs`,children:[t,` `,n]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:r})]})},`${t}:${n}`)})}):(0,P.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:`No matches.`})})()}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Loads a trend directly from Forward perf history (not limited to the top-50 rollups).`})]})]})}),(0,P.jsx)(tr,{open:Ce,onOpenChange:e=>!e&&we(!1),children:(0,P.jsxs)(ir,{className:`max-w-4xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-base`,children:`TCAM Evidence`})}),(0,P.jsx)(`pre`,{className:`max-h-[70vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:Te||``})]})}),(0,P.jsx)(tr,{open:ge,onOpenChange:e=>!e&&_e(!1),children:(0,P.jsxs)(ir,{className:`max-w-2xl`,children:[(0,P.jsx)(ar,{children:(0,P.jsx)(sr,{className:`text-base`,children:`Pick Device`})}),(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsx)(K,{placeholder:`Search device`,value:ve,onChange:e=>ye(e.target.value)}),(0,P.jsx)(`div`,{className:`max-h-[55vh] overflow-auto rounded-md border`,children:(()=>{let e=O.data?.devices??[],t=ve.trim().toLowerCase(),n=(t?e.filter(e=>{let n=String(e.deviceName??``).toLowerCase(),r=String(e.vendor??``).toLowerCase(),i=String(e.os??``).toLowerCase();return n.includes(t)||r.includes(t)||i.includes(t)}):e).slice(0,200);return n.length?(0,P.jsx)(`div`,{className:`divide-y`,children:n.map(e=>{let t=String(e.deviceName??``);return(0,P.jsx)(`button`,{type:`button`,className:`w-full px-3 py-2 text-left hover:bg-muted/40`,onClick:()=>{T({id:`${t}:pick`,device:t,metric:l,vendor:e.vendor??void 0,os:e.os??void 0,model:e.model??void 0,samples:0}),_e(!1)},children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,P.jsx)(`div`,{className:`font-mono text-xs`,children:t}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:[e.vendor??``,e.os??``].filter(Boolean).join(`  `)||``})]})},t)})}):(0,P.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:`No matches.`})})()}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Loads a trend directly from Forward perf history.`})]})]})})]}):(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(p,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e},className:Cr({variant:`outline`,size:`icon`,className:`h-9 w-9`}),children:(0,P.jsx)(ee,{className:`h-4 w-4`})}),(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Capacity`})]}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`pt-6 text-sm text-muted-foreground`,children:`Deployment not found.`})})]})}var op=nc.update({id:`/webhooks`,path:`/webhooks`,getParentRoute:()=>Js}),sp=ac.update({id:`/syslog`,path:`/syslog`,getParentRoute:()=>Js}),cp=gc.update({id:`/status`,path:`/status`,getParentRoute:()=>Js}),lp=yc.update({id:`/snmp`,path:`/snmp`,getParentRoute:()=>Js}),up=Pc.update({id:`/notifications`,path:`/notifications`,getParentRoute:()=>Js}),dp=Wc.update({id:`/design`,path:`/design`,getParentRoute:()=>Js}),fp=Kc.update({id:`/`,path:`/`,getParentRoute:()=>Js}),pp=Jc.update({id:`/docs/`,path:`/docs/`,getParentRoute:()=>Js}),mp=Yc.update({id:`/dashboard/`,path:`/dashboard/`,getParentRoute:()=>Js}),hp=Zc.update({id:`/admin/`,path:`/admin/`,getParentRoute:()=>Js}),gp=$c.update({id:`/docs/$slug`,path:`/docs/$slug`,getParentRoute:()=>Js}),_p=Cl.update({id:`/dashboard/settings`,path:`/dashboard/settings`,getParentRoute:()=>Js}),vp=El.update({id:`/dashboard/servicenow`,path:`/dashboard/servicenow`,getParentRoute:()=>Js}),yp=Ol.update({id:`/dashboard/s3`,path:`/dashboard/s3`,getParentRoute:()=>Js}),bp=Al.update({id:`/dashboard/policy-reports`,path:`/dashboard/policy-reports`,getParentRoute:()=>Js}),xp=Ml.update({id:`/dashboard/integrations`,path:`/dashboard/integrations`,getParentRoute:()=>Js}),Sp=Pl.update({id:`/dashboard/gemini`,path:`/dashboard/gemini`,getParentRoute:()=>Js}),Cp=Il.update({id:`/dashboard/forward`,path:`/dashboard/forward`,getParentRoute:()=>Js}),wp=zl.update({id:`/dashboard/elastic`,path:`/dashboard/elastic`,getParentRoute:()=>Js}),Tp=Kl.update({id:`/dashboard/ai`,path:`/dashboard/ai`,getParentRoute:()=>Js}),Ep=tu.update({id:`/admin/settings`,path:`/admin/settings`,getParentRoute:()=>Js}),Dp=au.update({id:`/admin/governance`,path:`/admin/governance`,getParentRoute:()=>Js}),Op=su.update({id:`/dashboard/workspaces/`,path:`/dashboard/workspaces/`,getParentRoute:()=>Js}),kp=uu.update({id:`/dashboard/runs/`,path:`/dashboard/runs/`,getParentRoute:()=>Js}),Ap=mu.update({id:`/dashboard/forward-networks/`,path:`/dashboard/forward-networks/`,getParentRoute:()=>Js}),jp=_u.update({id:`/dashboard/docs/`,path:`/dashboard/docs/`,getParentRoute:()=>Js}),Mp=bu.update({id:`/dashboard/deployments/`,path:`/dashboard/deployments/`,getParentRoute:()=>Js}),Np=Cu.update({id:`/dashboard/workspaces/$workspaceId`,path:`/dashboard/workspaces/$workspaceId`,getParentRoute:()=>Js}),Pp=Du.update({id:`/dashboard/runs/$runId`,path:`/dashboard/runs/$runId`,getParentRoute:()=>Js}),Fp=Xu.update({id:`/dashboard/labs/map`,path:`/dashboard/labs/map`,getParentRoute:()=>Js}),Ip=id.update({id:`/dashboard/labs/designer`,path:`/dashboard/labs/designer`,getParentRoute:()=>Js}),Lp=pd.update({id:`/dashboard/docs/$slug`,path:`/dashboard/docs/$slug`,getParentRoute:()=>Js}),Rp=bd.update({id:`/dashboard/deployments/new`,path:`/dashboard/deployments/new`,getParentRoute:()=>Js}),zp=wd.update({id:`/dashboard/deployments/$deploymentId/`,path:`/dashboard/deployments/$deploymentId/`,getParentRoute:()=>Js}),Bp=Od.update({id:`/policy-reports`,path:`/policy-reports`,getParentRoute:()=>Np}),Vp=Wd.update({id:`/dashboard/forward-networks/$networkRef/traffic-scenarios`,path:`/dashboard/forward-networks/$networkRef/traffic-scenarios`,getParentRoute:()=>Js}),Hp=$d.update({id:`/dashboard/forward-networks/$networkRef/capacity`,path:`/dashboard/forward-networks/$networkRef/capacity`,getParentRoute:()=>Js}),Up=Af.update({id:`/dashboard/forward-networks/$networkRef/assurance-studio`,path:`/dashboard/forward-networks/$networkRef/assurance-studio`,getParentRoute:()=>Js}),Wp=Bf.update({id:`/dashboard/forward-networks/$networkRef/assurance`,path:`/dashboard/forward-networks/$networkRef/assurance`,getParentRoute:()=>Js}),Gp=Gf.update({id:`/dashboard/deployments/$deploymentId/map`,path:`/dashboard/deployments/$deploymentId/map`,getParentRoute:()=>Js}),Kp=qf.update({id:`/dashboard/deployments/$deploymentId/capacity`,path:`/dashboard/deployments/$deploymentId/capacity`,getParentRoute:()=>Js}),qp={DashboardWorkspacesWorkspaceIdPolicyReportsRoute:Bp},Jp={IndexRoute:fp,DesignRoute:dp,NotificationsRoute:up,SnmpRoute:lp,StatusRoute:cp,SyslogRoute:sp,WebhooksRoute:op,AdminGovernanceRoute:Dp,AdminSettingsRoute:Ep,DashboardAiRoute:Tp,DashboardElasticRoute:wp,DashboardForwardRoute:Cp,DashboardGeminiRoute:Sp,DashboardIntegrationsRoute:xp,DashboardPolicyReportsRoute:bp,DashboardS3Route:yp,DashboardServicenowRoute:vp,DashboardSettingsRoute:_p,DocsSlugRoute:gp,AdminIndexRoute:hp,DashboardIndexRoute:mp,DocsIndexRoute:pp,DashboardDeploymentsNewRoute:Rp,DashboardDocsSlugRoute:Lp,DashboardLabsDesignerRoute:Ip,DashboardLabsMapRoute:Fp,DashboardRunsRunIdRoute:Pp,DashboardWorkspacesWorkspaceIdRoute:Np._addFileChildren(qp),DashboardDeploymentsIndexRoute:Mp,DashboardDocsIndexRoute:jp,DashboardForwardNetworksIndexRoute:Ap,DashboardRunsIndexRoute:kp,DashboardWorkspacesIndexRoute:Op,DashboardDeploymentsDeploymentIdCapacityRoute:Kp,DashboardDeploymentsDeploymentIdMapRoute:Gp,DashboardForwardNetworksNetworkRefAssuranceRoute:Wp,DashboardForwardNetworksNetworkRefAssuranceStudioRoute:Up,DashboardForwardNetworksNetworkRefCapacityRoute:Hp,DashboardForwardNetworksNetworkRefTrafficScenariosRoute:Vp,DashboardDeploymentsDeploymentIdIndexRoute:zp};const Yp=f({routeTree:Js._addFileChildren(Jp)._addFileTypes(),defaultPreload:`intent`,defaultPreloadDelay:50,context:{queryClient:void 0}});var Xp=new a({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1,staleTime:1e4}}});er.createRoot(document.getElementById(`root`)).render((0,P.jsx)(M.StrictMode,{children:(0,P.jsx)(d,{client:Xp,children:(0,P.jsx)(l,{router:Yp,context:{queryClient:Xp}})})}));