import{a as e}from"./rolldown-runtime-DAKAggwm.js";import{$ as t,$t as n,A as r,An as i,At as a,B as o,Bn as s,Bt as c,C as l,Cn as u,Ct as d,D as f,Dn as p,Dt as m,E as h,En as ee,Et as g,F as _,Fn as v,Ft as y,G as b,Gt as x,H as S,Ht as te,I as ne,It as re,J as ie,Jt as ae,K as oe,Kt as se,L as ce,Ln as le,Lt as ue,M as de,Mn as fe,Mt as pe,N as me,Nn as he,Nt as ge,O as _e,On as ve,Ot as ye,P as be,Pn as xe,Pt as Se,Q as Ce,Qt as we,R as Te,Rn as Ee,Rt as De,S as Oe,Sn as ke,St as Ae,T as je,Tn as Me,Tt as Ne,U as Pe,Ut as Fe,V as Ie,Vt as Le,W as C,Wt as Re,X as ze,Xt as Be,Y as Ve,Yt as He,Z as Ue,Zt as We,_ as Ge,_n as Ke,_t as qe,a as Je,an as Ye,at as Xe,b as Ze,bn as Qe,bt as $e,c as et,cn as tt,ct as nt,d as rt,dn as it,dt as at,en as ot,et as st,f as ct,fn as lt,ft as ut,g as dt,gn as ft,gt as pt,h as mt,hn as ht,ht as gt,i as _t,in as vt,it as yt,j as bt,jn as xt,jt as St,k as Ct,kn as wt,kt as Tt,l as Et,ln as Dt,lt as Ot,m as kt,mn as At,mt as jt,n as Mt,nn as Nt,nt as Pt,o as Ft,on as It,ot as Lt,p as Rt,pn as zt,pt as Bt,q as Vt,qt as Ht,r as Ut,rn as Wt,rt as Gt,s as Kt,sn as qt,st as Jt,t as Yt,tn as Xt,tt as w,u as Zt,un as Qt,ut as $t,v as en,vn as tn,vt as nn,w as rn,wn as an,wt as on,x as sn,xn as cn,xt as ln,y as un,yn as dn,yt as fn,z as pn,zt as mn}from"./react-DIlYB89i.js";import{a as hn,c as gn,d as T,f as _n,i as E,l as D,n as O,o as vn,p as yn,r as bn,s as xn,t as k,u as Sn}from"./tanstack-C3VjbIov.js";import{n as Cn,r as wn,t as Tn}from"./ui-utils-l2x0dF3k.js";import{a as En,c as Dn,i as On,n as kn,o as An,r as jn,s as A,t as Mn}from"./vendor-5pt8clUA.js";(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var Nn=e(Ee(),1),j=e(s(),1);const Pn=`/api/skyforge`,Fn=`${Pn}/api`;function In(e){let t=e.startsWith(`/`)?e:`/`;return`${Fn}/oidc/login?next=${encodeURIComponent(t)}`}var Ln=class extends Error{status;bodyText;constructor(e,t,n){super(e),this.name=`ApiError`,this.status=t,this.bodyText=n}};async function M(e,t){let n=(t?.method??`GET`).toUpperCase(),r=await fetch(`${Pn}${e}`,{credentials:`include`,...t,headers:{"Content-Type":`application/json`,...t?.headers??{}}});if(r.status===401){let e=await r.text().catch(()=>``);if(n===`GET`&&typeof window<`u`){let e=window.location.pathname+(window.location.search??``);window.location.href=In(e)}throw new Ln(`unauthorized`,r.status,e)}if(r.status===403){let e=await r.text().catch(()=>``);throw new Ln(`forbidden`,r.status,e)}if(!r.ok){let e=await r.text().catch(()=>``);throw new Ln(`request failed (${r.status})`,r.status,e)}return r.status===204?{}:await r.json()}async function Rn(){return M(`/api/session`)}async function zn(){let e=await fetch(`${Pn}/auth/logout`,{method:`POST`,credentials:`include`,headers:{"Content-Type":`application/json`},body:`{}`});if(!e.ok){let t=await e.text().catch(()=>``);throw Error(`logout failed (${e.status}): ${t}`)}}async function Bn(){return M(`/api/workspaces`)}async function Vn(e,t){let n=new URLSearchParams;t?.include_read&&n.set(`include_read`,t.include_read),t?.limit&&n.set(`limit`,t.limit);let r=n.toString();return M(`/notifications/for-user/${encodeURIComponent(e)}${r?`?${r}`:``}`)}async function Hn(e){return M(`/notifications/for-user/${encodeURIComponent(e)}/read-all`,{method:`PUT`})}async function Un(e){return M(`/notifications/single/${encodeURIComponent(e)}/read`,{method:`PUT`})}async function Wn(e){return M(`/notifications/single/${encodeURIComponent(e)}`,{method:`DELETE`})}async function Gn(e){return M(`/api/workspaces/${encodeURIComponent(e)}/netlab/servers`)}async function Kn(){return M(`/api/forward/collectors`)}async function qn(e,t,n){return M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/forward`,{method:`PUT`,body:JSON.stringify(n)})}async function Jn(e,t){return M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/forward/sync`,{method:`POST`,body:`{}`})}async function Yn(e,t,n){return M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/impair`,{method:`POST`,body:JSON.stringify(n)})}async function Xn(e,t,n){return M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/admin`,{method:`POST`,body:JSON.stringify(n)})}async function Zn(e,t,n){return M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/capture`,{method:`POST`,body:JSON.stringify(n)})}async function Qn(e,t,n){return M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/interfaces`)}async function $n(e,t,n){return M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/running-config`)}async function er(e,t,n=`json`){let r=new URLSearchParams;return r.set(`format`,n),M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/inventory?${r.toString()}`)}async function tr(e,t,n,r){let i=new URLSearchParams;r?.tail&&i.set(`tail`,String(r.tail)),r?.container&&i.set(`container`,r.container);let a=i.toString();return M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/logs${a?`?${a}`:``}`)}async function nr(e,t,n){return M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/describe`)}async function rr(e,t,n){return M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/save-config`,{method:`POST`,body:`{}`})}async function ir(e,t){return M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/stats`)}async function ar(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return M(`/api/workspaces/${encodeURIComponent(e)}/netlab/templates${r?`?${r}`:``}`)}async function or(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return M(`/api/workspaces/${encodeURIComponent(e)}/containerlab/templates${r?`?${r}`:``}`)}async function sr(e,t){return M(`/api/workspaces/${encodeURIComponent(e)}/deployments`,{method:`POST`,body:JSON.stringify(t)})}async function cr(e){return M(`/api/workspaces`,{method:`POST`,body:JSON.stringify(e)})}async function lr(e,t){return M(`/api/workspaces/${encodeURIComponent(e)}/members`,{method:`PUT`,body:JSON.stringify(t)})}async function ur(e,t){return M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/topology`)}async function dr(e,t){let n=new URLSearchParams;return n.set(`confirm`,t.confirm),t.force&&n.set(`force`,`true`),M(`/api/workspaces/${encodeURIComponent(e)}?${n.toString()}`,{method:`DELETE`})}async function fr(){return M(`/api/forward/collector`)}async function pr(e){return M(`/api/forward/collector`,{method:`PUT`,body:JSON.stringify(e)})}async function mr(){return M(`/api/forward/collector/reset`,{method:`POST`,body:`{}`})}async function hr(){await M(`/api/forward/collector`,{method:`DELETE`})}async function gr(){return M(`/api/forward/collector/runtime`)}async function _r(e){let t=new URLSearchParams;e&&e>0&&t.set(`tail`,String(e));let n=t.toString();return M(`/api/forward/collector/logs${n?`?${n}`:``}`)}async function vr(){return M(`/api/forward/collector/restart`,{method:`POST`,body:`{}`})}async function yr(e,t){return M(`/api/workspaces/${encodeURIComponent(e)}/settings`,{method:`PUT`,body:JSON.stringify(t)})}async function br(e,t){let n=new URLSearchParams;t?.prefix&&n.set(`prefix`,t.prefix),t?.limit&&n.set(`limit`,t.limit);let r=n.toString();return M(`/api/workspaces/${encodeURIComponent(e)}/artifacts${r?`?${r}`:``}`)}async function xr(e,t){let n=new URLSearchParams({key:t});return M(`/api/workspaces/${encodeURIComponent(e)}/artifacts/download?${n.toString()}`)}async function Sr(){return M(`/api/pki/root`)}async function Cr(){return M(`/api/pki/ssh/root`)}async function wr(){return M(`/api/pki/certs`)}async function Tr(){return M(`/api/pki/ssh/certs`)}async function Er(e){return M(`/api/pki/issue`,{method:`POST`,body:JSON.stringify(e)})}async function Dr(e){return M(`/api/pki/ssh/issue`,{method:`POST`,body:JSON.stringify(e)})}async function Or(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit),e?.before_id&&t.set(`before_id`,e.before_id);let n=t.toString();return M(`/api/webhooks/events${n?`?${n}`:``}`)}async function kr(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit),e?.before_id&&t.set(`before_id`,e.before_id),e?.source_ip&&t.set(`source_ip`,e.source_ip),e?.unassigned&&t.set(`unassigned`,e.unassigned);let n=t.toString();return M(`/api/syslog/events${n?`?${n}`:``}`)}async function Ar(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit),e?.before_id&&t.set(`before_id`,e.before_id);let n=t.toString();return M(`/api/snmp/traps/events${n?`?${n}`:``}`)}async function jr(){return M(`/api/admin/governance/summary`)}async function Mr(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString();return M(`/api/admin/governance/resources${n?`?${n}`:``}`)}async function Nr(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString();return M(`/api/admin/governance/costs${n?`?${n}`:``}`)}async function Pr(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString();return M(`/api/admin/governance/usage${n?`?${n}`:``}`)}async function Fr(){await M(`/api/admin/governance/sync`,{method:`POST`,body:`{}`})}async function Ir(e,t){return M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/start`,{method:`POST`,body:`{}`})}async function Lr(e,t){return M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/stop`,{method:`POST`,body:`{}`})}async function Rr(e,t){return M(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}`,{method:`DELETE`})}async function zr(){return M(`/api/ui/config`)}async function Br(){return M(`/status/summary`)}async function Vr(){try{let e=await fetch(`${Pn}/api/session`,{credentials:`include`,headers:{"Content-Type":`application/json`}});return e.ok?await e.json():null}catch{return null}}async function Hr(e){if(typeof window>`u`)return!1;let t=e.pollIntervalMs??750,n=e.timeoutMs??2*6e4;if((await Vr())?.authenticated)return!0;let r=Math.max(0,Math.floor((window.screen.width-520)/2)),i=Math.max(0,Math.floor((window.screen.height-720)/2)),a=[`popup=yes`,`width=520`,`height=720`,`left=${r}`,`top=${i}`].join(`,`),o=window.open(e.loginHref,`skyforge_login`,a);if(!o)return!1;try{o.focus()}catch{}return await new Promise(e=>{let r=Date.now(),i=window.setInterval(async()=>{try{if(o.closed){window.clearInterval(i),e(!1);return}if(Date.now()-r>n){window.clearInterval(i);try{o.close()}catch{}e(!1);return}if((await Vr())?.authenticated){window.clearInterval(i);try{o.close()}catch{}e(!0)}}catch{}},t)})}function N(...e){return Cn(wn(e))}var P=le(),Ur=ln,Wr=g,Gr=j.forwardRef(({className:e,inset:t,children:n,...r},i)=>(0,P.jsxs)(Ne,{ref:i,className:N(`flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent`,t&&`pl-8`,e),...r,children:[n,(0,P.jsx)(Me,{className:`ml-auto h-4 w-4`})]}));Gr.displayName=Ne.displayName;var Kr=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(on,{ref:n,className:N(`z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,e),...t}));Kr.displayName=on.displayName;var qr=j.forwardRef(({className:e,sideOffset:t=4,...n},r)=>(0,P.jsx)(nn,{children:(0,P.jsx)(Bt,{ref:r,sideOffset:t,className:N(`z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,e),...n})}));qr.displayName=Bt.displayName;var Jr=j.forwardRef(({className:e,inset:t,...n},r)=>(0,P.jsx)(gt,{ref:r,className:N(`relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,t&&`pl-8`,e),...n}));Jr.displayName=gt.displayName;var Yr=j.forwardRef(({className:e,children:t,checked:n,...r},i)=>(0,P.jsxs)(ut,{ref:i,className:N(`relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),checked:n,...r,children:[(0,P.jsx)(`span`,{className:`absolute left-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,P.jsx)(pt,{children:(0,P.jsx)(ve,{className:`h-4 w-4`})})}),t]}));Yr.displayName=ut.displayName;var Xr=j.forwardRef(({className:e,children:t,...n},r)=>(0,P.jsxs)($e,{ref:r,className:N(`relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...n,children:[(0,P.jsx)(`span`,{className:`absolute left-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,P.jsx)(pt,{children:(0,P.jsx)(cn,{className:`h-2 w-2 fill-current`})})}),t]}));Xr.displayName=$e.displayName;var Zr=j.forwardRef(({className:e,inset:t,...n},r)=>(0,P.jsx)(qe,{ref:r,className:N(`px-2 py-1.5 text-sm font-semibold`,t&&`pl-8`,e),...n}));Zr.displayName=qe.displayName;var Qr=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Ae,{ref:n,className:N(`-mx-1 my-1 h-px bg-muted`,e),...t}));Qr.displayName=Ae.displayName;var $r=({className:e,...t})=>(0,P.jsx)(`span`,{className:N(`ml-auto text-xs tracking-widest opacity-60`,e),...t});$r.displayName=`DropdownMenuShortcut`;var ei=[{label:`Dashboard`,href:`/`,icon:Nt},{label:`Deployments`,href:`/dashboard/deployments`,icon:lt},{label:`Workspaces`,href:`/dashboard/workspaces`,icon:lt},{label:`Collector`,href:`/dashboard/forward`,icon:x},{label:`S3`,href:`/dashboard/s3`,icon:Le},{label:`SSOT`,href:``,icon:tn,children:[{label:`NetBox`,href:`/netbox/`,icon:He,external:!0},{label:`Nautobot`,href:`/nautobot/`,icon:He,external:!0}]},{label:`PKI`,href:`/dashboard/pki`,icon:It},{label:`Webhooks`,href:`/webhooks`,icon:a},{label:`Syslog`,href:`/syslog`,icon:tt},{label:`SNMP`,href:`/snmp`,icon:mn},{label:`Git`,href:`/git/`,icon:Qt,external:!0},{label:`DNS`,href:`${Fn}/dns/sso?next=/dns/`,icon:He,external:!0},{label:`Coder`,href:`/workspaces`,icon:Qe,external:!0},{label:`API Testing`,href:`${Fn}/yaade/sso`,icon:ae,external:!0},{label:`Docs`,href:`/docs/`,icon:xt,external:!0},{label:`Settings`,href:`/admin/settings`,icon:c,adminOnly:!0},{label:`Governance`,href:`/admin/governance`,icon:mn,adminOnly:!0}];function ti(e){let t=yn({select:e=>e.location.pathname}),[n,r]=(0,j.useState)({SSOT:!0}),i=`_blank`,a=`noreferrer noopener`,o=e=>e?e===`/`?t===`/`:e.endsWith(`/`)?t.startsWith(e):t===e||t.startsWith(`${e}/`):!1,s=e=>{r(t=>({...t,[e]:!t[e]}))};return(0,P.jsx)(`nav`,{className:`grid items-start gap-2`,children:(0,P.jsxs)(`div`,{className:`space-y-2`,children:[e.collapsed?null:(0,P.jsx)(`h4`,{className:`px-3 text-xs font-semibold uppercase tracking-wide text-muted-foreground`,children:`Overview`}),(0,P.jsx)(`div`,{className:`grid gap-1`,children:ei.filter(t=>t.adminOnly?!!e.isAdmin:!0).map(t=>{let r=t.icon;if(t.children){let c=t.children.some(e=>o(e.href)),l=n[t.label];return e.collapsed?(0,P.jsxs)(Ur,{children:[(0,P.jsx)(Wr,{asChild:!0,children:(0,P.jsx)(`button`,{className:N(`group flex items-center justify-center rounded-md px-2 py-2 text-sm font-medium transition-colors w-full`,`hover:bg-accent hover:text-accent-foreground`,c?`bg-accent text-accent-foreground`:`transparent`),title:t.label,children:(0,P.jsx)(r,{className:`h-5 w-5`})})}),(0,P.jsxs)(qr,{side:`right`,align:`start`,sideOffset:10,children:[(0,P.jsx)(Zr,{children:t.label}),(0,P.jsx)(Qr,{}),t.children.map(e=>(0,P.jsx)(Jr,{asChild:!0,children:e.external?(0,P.jsxs)(`a`,{href:e.href,target:i,rel:a,className:`flex items-center gap-2 cursor-pointer w-full`,children:[(0,P.jsx)(e.icon,{className:`h-4 w-4 mr-2`}),e.label]}):(0,P.jsxs)(T,{to:e.href,className:`flex items-center gap-2 cursor-pointer w-full`,children:[(0,P.jsx)(e.icon,{className:`h-4 w-4 mr-2`}),e.label]})},e.href))]})]},t.label):(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsxs)(`button`,{onClick:()=>s(t.label),className:N(`group flex w-full items-center justify-between rounded-md px-3 py-2 text-sm font-medium transition-colors`,`hover:bg-accent hover:text-accent-foreground`,c?`text-foreground font-semibold`:`text-muted-foreground`),children:[(0,P.jsxs)(`div`,{className:`flex items-center`,children:[(0,P.jsx)(r,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:t.label})]}),l?(0,P.jsx)(p,{className:`h-4 w-4 opacity-50`}):(0,P.jsx)(Me,{className:`h-4 w-4 opacity-50`})]}),l&&(0,P.jsx)(`div`,{className:`grid gap-1 pl-4 border-l ml-4 border-border/50`,children:t.children.map(e=>{let t=o(e.href),n=e.icon,r=N(`group flex items-center rounded-md px-3 py-2 text-sm font-medium transition-colors`,`hover:bg-accent hover:text-accent-foreground`,t?`bg-accent text-accent-foreground`:`text-muted-foreground`);return e.external?(0,P.jsxs)(`a`,{href:e.href,target:i,rel:a,className:r,children:[(0,P.jsx)(n,{className:`mr-2 h-4 w-4 opacity-70 group-hover:opacity-100`}),(0,P.jsx)(`span`,{children:e.label})]},e.href):(0,P.jsxs)(T,{to:e.href,className:r,children:[(0,P.jsx)(n,{className:`mr-2 h-4 w-4 opacity-70 group-hover:opacity-100`}),(0,P.jsx)(`span`,{children:e.label})]},e.href)})})]},t.label)}let c=N(`group flex items-center rounded-md px-3 py-2 text-sm font-medium transition-colors`,`hover:bg-accent hover:text-accent-foreground`,o(t.href)?`bg-accent`:`transparent`,e.collapsed&&`justify-center px-2`),l=N(`transition-transform duration-200 group-hover:scale-110 group-hover:text-primary`,e.collapsed?`h-5 w-5`:`mr-2 h-4 w-4`);return t.external?(0,P.jsxs)(`a`,{href:t.href,target:i,rel:a,className:c,title:e.collapsed?t.label:void 0,children:[(0,P.jsx)(r,{className:l}),e.collapsed?null:(0,P.jsx)(`span`,{children:t.label})]},t.href):(0,P.jsxs)(T,{to:t.href,className:c,title:e.collapsed?t.label:void 0,children:[(0,P.jsx)(r,{className:l}),e.collapsed?null:(0,P.jsx)(`span`,{children:t.label})]},t.href)})})]})})}var ni=Ot,ri=nt,ii=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Jt,{ref:n,className:N(`fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t}));ii.displayName=Jt.displayName;var ai=j.forwardRef(({className:e,children:t,...n},r)=>(0,P.jsxs)(ri,{children:[(0,P.jsx)(ii,{}),(0,P.jsxs)(Xe,{ref:r,className:N(`fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg`,e),...n,children:[t,(0,P.jsxs)(yt,{className:`absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground`,children:[(0,P.jsx)(ye,{className:`h-4 w-4`}),(0,P.jsx)(`span`,{className:`sr-only`,children:`Close`})]})]})]}));ai.displayName=Xe.displayName;var oi=({className:e,...t})=>(0,P.jsx)(`div`,{className:N(`flex flex-col space-y-1.5 text-center sm:text-left`,e),...t});oi.displayName=`DialogHeader`;var si=({className:e,...t})=>(0,P.jsx)(`div`,{className:N(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});si.displayName=`DialogFooter`;var ci=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)($t,{ref:n,className:N(`text-lg font-semibold leading-none tracking-tight`,e),...t}));ci.displayName=$t.displayName;var li=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Lt,{ref:n,className:N(`text-sm text-muted-foreground`,e),...t}));li.displayName=Lt.displayName;var ui=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Pt,{ref:n,className:N(`flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground`,e),...t}));ui.displayName=Pt.displayName;var di=({children:e,...t})=>(0,P.jsx)(ni,{...t,children:(0,P.jsx)(ai,{className:`overflow-hidden p-0 shadow-lg`,children:(0,P.jsx)(ui,{className:`[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5`,children:e})})}),fi=j.forwardRef(({className:e,...t},n)=>(0,P.jsxs)(`div`,{className:`flex items-center border-b px-3`,"cmdk-input-wrapper":``,children:[(0,P.jsx)(te,{className:`mr-2 h-4 w-4 shrink-0 opacity-50`}),(0,P.jsx)(Pt.Input,{ref:n,className:N(`flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50`,e),...t})]}));fi.displayName=Pt.Input.displayName;var pi=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Pt.List,{ref:n,className:N(`max-h-[300px] overflow-y-auto overflow-x-hidden`,e),...t}));pi.displayName=Pt.List.displayName;var mi=j.forwardRef((e,t)=>(0,P.jsx)(Pt.Empty,{ref:t,className:`py-6 text-center text-sm`,...e}));mi.displayName=Pt.Empty.displayName;var hi=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Pt.Group,{ref:n,className:N(`overflow-hidden p-1 text-popover-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground`,e),...t}));hi.displayName=Pt.Group.displayName;var gi=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Pt.Separator,{ref:n,className:N(`-mx-1 h-px bg-border`,e),...t}));gi.displayName=Pt.Separator.displayName;var _i=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Pt.Item,{ref:n,className:N(`relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...t}));_i.displayName=Pt.Item.displayName;var vi=({className:e,...t})=>(0,P.jsx)(`span`,{className:N(`ml-auto text-xs tracking-widest text-muted-foreground`,e),...t});vi.displayName=`CommandShortcut`;function yi(){let[e,t]=j.useState(!1),n=_n();j.useEffect(()=>{let e=e=>{e.key===`k`&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),t(e=>!e))};return document.addEventListener(`keydown`,e),()=>document.removeEventListener(`keydown`,e)},[]);let r=j.useCallback(e=>{t(!1),e()},[]);return(0,P.jsxs)(di,{open:e,onOpenChange:t,children:[(0,P.jsx)(fi,{placeholder:`Type a command or search...`}),(0,P.jsxs)(pi,{children:[(0,P.jsx)(mi,{children:`No results found.`}),(0,P.jsxs)(hi,{heading:`Suggestions`,children:[(0,P.jsxs)(_i,{onSelect:()=>r(()=>n({to:`/`})),children:[(0,P.jsx)(Nt,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Dashboard`})]}),(0,P.jsxs)(_i,{onSelect:()=>r(()=>n({to:`/dashboard/deployments`})),children:[(0,P.jsx)(lt,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Deployments`})]}),(0,P.jsxs)(_i,{onSelect:()=>r(()=>n({to:`/status`})),children:[(0,P.jsx)(v,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Platform Status`})]})]}),(0,P.jsx)(gi,{}),(0,P.jsxs)(hi,{heading:`Infrastructure`,children:[(0,P.jsxs)(_i,{onSelect:()=>r(()=>n({to:`/dashboard/s3`})),children:[(0,P.jsx)(Le,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`S3 Storage`})]}),(0,P.jsxs)(_i,{onSelect:()=>r(()=>n({to:`/dashboard/pki`})),children:[(0,P.jsx)(It,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`PKI Management`})]})]}),(0,P.jsx)(gi,{}),(0,P.jsxs)(hi,{heading:`Events & Monitoring`,children:[(0,P.jsxs)(_i,{onSelect:()=>r(()=>n({to:`/notifications`})),children:[(0,P.jsx)(fe,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Notifications`})]}),(0,P.jsxs)(_i,{onSelect:()=>r(()=>n({to:`/webhooks`})),children:[(0,P.jsx)(a,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Webhooks`})]}),(0,P.jsxs)(_i,{onSelect:()=>r(()=>n({to:`/syslog`})),children:[(0,P.jsx)(tt,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Syslog`})]}),(0,P.jsxs)(_i,{onSelect:()=>r(()=>n({to:`/snmp`})),children:[(0,P.jsx)(mn,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`SNMP Traps`})]})]})]})]})}const F={session:()=>[`session`],uiConfig:()=>[`uiConfig`],dashboardSnapshot:()=>[`dashboardSnapshot`],statusSummary:()=>[`statusSummary`],runLogs:e=>[`runLogs`,e],deploymentTopology:(e,t)=>[`deploymentTopology`,e,t],deploymentUIEvents:(e,t)=>[`deploymentUIEvents`,e,t],workspaces:()=>[`workspaces`],workspaceForwardConfig:e=>[`workspaceForwardConfig`,e],workspaceForwardCollectors:e=>[`workspaceForwardCollectors`,e],forwardCollectors:()=>[`forwardCollectors`],userForwardCollector:()=>[`userForwardCollector`],userCollectorRuntime:()=>[`userCollectorRuntime`],userCollectorLogs:()=>[`userCollectorLogs`],storageFiles:()=>[`storageFiles`],workspaceArtifacts:e=>[`workspaceArtifacts`,e],workspaceEveServers:e=>[`workspaceEveServers`,e],workspaceNetlabServers:e=>[`workspaceNetlabServers`,e],notifications:(e,t)=>[`notifications`,e?`1`:`0`,t??``],syslogEvents:e=>[`syslogEvents`,e??``],snmpTrapEvents:e=>[`snmpTrapEvents`,e??``],workspaceTemplates:(e,t,n,r,i)=>[`workspaceTemplates`,e,t,n,r??``,i??``],pkiRoot:()=>[`pkiRoot`],pkiCerts:()=>[`pkiCerts`],pkiSshRoot:()=>[`pkiSshRoot`],pkiSshCerts:()=>[`pkiSshCerts`],webhookEvents:e=>[`webhookEvents`,e??``],notificationSettings:()=>[`notificationSettings`],governanceSummary:()=>[`governanceSummary`],governanceResources:e=>[`governanceResources`,e??``],governanceCosts:e=>[`governanceCosts`,e??``],governanceUsage:e=>[`governanceUsage`,e??``]};var bi=({...e})=>(0,P.jsx)(st,{className:`toaster group`,toastOptions:{classNames:{toast:`group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg`,description:`group-[.toast]:text-muted-foreground`,actionButton:`group-[.toast]:bg-primary group-[.toast]:text-primary-foreground`,cancelButton:`group-[.toast]:bg-muted group-[.toast]:text-muted-foreground`}},...e}),xi=Tn(`inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0`,{variants:{variant:{default:`bg-primary text-primary-foreground hover:bg-primary/90`,destructive:`bg-destructive text-destructive-foreground hover:bg-destructive/90`,outline:`border border-input bg-background hover:bg-accent hover:text-accent-foreground`,secondary:`bg-secondary text-secondary-foreground hover:bg-secondary/80`,ghost:`hover:bg-accent hover:text-accent-foreground`,link:`text-primary underline-offset-4 hover:underline`},size:{default:`h-10 px-4 py-2`,sm:`h-9 rounded-md px-3`,lg:`h-11 rounded-md px-8`,icon:`h-10 w-10`}},defaultVariants:{variant:`default`,size:`default`}}),I=j.forwardRef(({className:e,variant:t,size:n,...r},i)=>(0,P.jsx)(`button`,{className:N(xi({variant:t,size:n,className:e})),ref:i,...r}));I.displayName=`Button`;var Si=Tn(`rounded-lg border text-card-foreground shadow-sm`,{variants:{variant:{default:`bg-card`,elevated:`bg-card shadow-lg`,gradient:`bg-gradient-to-br from-card to-card/60`,glass:`bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60`,glow:`bg-card shadow-lg shadow-primary/10`,interactive:`bg-card hover:shadow-md transition-shadow cursor-pointer`,success:`border-green-500/50 bg-green-500/5`,warning:`border-amber-500/50 bg-amber-500/5`,danger:`border-red-500/50 bg-red-500/5`,info:`border-blue-500/50 bg-blue-500/5`,flat:`bg-card shadow-none`},size:{default:``,compact:`p-3`,comfortable:`p-6`}},defaultVariants:{variant:`default`,size:`default`}}),L=j.forwardRef(({className:e,variant:t,size:n,...r},i)=>(0,P.jsx)(`div`,{ref:i,className:N(Si({variant:t,size:n,className:e})),...r}));L.displayName=`Card`;var R=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`div`,{ref:n,className:N(`flex flex-col space-y-1.5 p-6`,e),...t}));R.displayName=`CardHeader`;var z=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`div`,{ref:n,className:N(`text-2xl font-semibold leading-none tracking-tight`,e),...t}));z.displayName=`CardTitle`;var B=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`div`,{ref:n,className:N(`text-sm text-muted-foreground`,e),...t}));B.displayName=`CardDescription`;var V=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`div`,{ref:n,className:N(`p-6 pt-0`,e),...t}));V.displayName=`CardContent`;var Ci=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`div`,{ref:n,className:N(`flex items-center p-6 pt-0`,e),...t}));Ci.displayName=`CardFooter`;var wi=(0,j.createContext)({theme:`system`,setTheme:()=>null});function Ti({children:e,defaultTheme:t=`system`,storageKey:n=`vite-ui-theme`}){let[r,i]=(0,j.useState)(()=>localStorage.getItem(n)||t);(0,j.useEffect)(()=>{let e=window.document.documentElement;if(e.classList.remove(`light`,`dark`),r===`system`){let t=window.matchMedia(`(prefers-color-scheme: dark)`).matches?`dark`:`light`;e.classList.add(t);return}e.classList.add(r)},[r]);let a={theme:r,setTheme:e=>{localStorage.setItem(n,e),i(e)}};return(0,P.jsx)(wi.Provider,{value:a,children:e})}const Ei=()=>{let e=(0,j.useContext)(wi);if(e===void 0)throw Error(`useTheme must be used within a ThemeProvider`);return e};function Di(){let{setTheme:e}=Ei();return(0,P.jsxs)(Ur,{children:[(0,P.jsx)(Wr,{asChild:!0,children:(0,P.jsxs)(I,{variant:`outline`,size:`icon`,children:[(0,P.jsx)(re,{className:`h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0`}),(0,P.jsx)(Be,{className:`absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100`}),(0,P.jsx)(`span`,{className:`sr-only`,children:`Toggle theme`})]})}),(0,P.jsxs)(qr,{align:`end`,children:[(0,P.jsx)(Jr,{onClick:()=>e(`light`),children:`Light`}),(0,P.jsx)(Jr,{onClick:()=>e(`dark`),children:`Dark`}),(0,P.jsx)(Jr,{onClick:()=>e(`system`),children:`System`})]})]})}var Oi=Ot,ki=at,Ai=nt,ji=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Jt,{className:N(`fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t,ref:n}));ji.displayName=Jt.displayName;var Mi=Tn(`fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500`,{variants:{side:{top:`inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top`,bottom:`inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom`,left:`inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm`,right:`inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm`}},defaultVariants:{side:`right`}}),Ni=j.forwardRef(({side:e=`right`,className:t,children:n,...r},i)=>(0,P.jsxs)(Ai,{children:[(0,P.jsx)(ji,{}),(0,P.jsxs)(Xe,{ref:i,className:N(Mi({side:e}),t),...r,children:[n,(0,P.jsxs)(yt,{className:`absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary`,children:[(0,P.jsx)(ye,{className:`h-4 w-4`}),(0,P.jsx)(`span`,{className:`sr-only`,children:`Close`})]})]})]}));Ni.displayName=Xe.displayName;var Pi=({className:e,...t})=>(0,P.jsx)(`div`,{className:N(`flex flex-col space-y-2 text-center sm:text-left`,e),...t});Pi.displayName=`SheetHeader`;var Fi=({className:e,...t})=>(0,P.jsx)(`div`,{className:N(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});Fi.displayName=`SheetFooter`;var Ii=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)($t,{ref:n,className:N(`text-lg font-semibold text-foreground`,e),...t}));Ii.displayName=$t.displayName;var Li=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Lt,{ref:n,className:N(`text-sm text-muted-foreground`,e),...t}));Li.displayName=Lt.displayName;var Ri=j.forwardRef(({...e},t)=>(0,P.jsx)(`nav`,{ref:t,"aria-label":`breadcrumb`,...e}));Ri.displayName=`Breadcrumb`;var zi=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`ol`,{ref:n,className:N(`flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5`,e),...t}));zi.displayName=`BreadcrumbList`;var Bi=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`li`,{ref:n,className:N(`inline-flex items-center gap-1.5`,e),...t}));Bi.displayName=`BreadcrumbItem`;var Vi=j.forwardRef(({asChild:e,className:t,...n},r)=>(0,P.jsx)(e?Gt:`a`,{ref:r,className:N(`transition-colors hover:text-foreground`,t),...n}));Vi.displayName=`BreadcrumbLink`;var Hi=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`span`,{ref:n,role:`link`,"aria-disabled":`true`,"aria-current":`page`,className:N(`font-normal text-foreground`,e),...t}));Hi.displayName=`BreadcrumbPage`;var Ui=({children:e,className:t,...n})=>(0,P.jsx)(`li`,{role:`presentation`,"aria-hidden":`true`,className:N(`[&>svg]:size-3.5`,t),...n,children:e??(0,P.jsx)(Me,{})});Ui.displayName=`BreadcrumbSeparator`;var Wi=({className:e,...t})=>(0,P.jsxs)(`span`,{role:`presentation`,"aria-hidden":`true`,className:N(`flex h-9 w-9 items-center justify-center`,e),...t,children:[(0,P.jsx)(ht,{className:`h-4 w-4`}),(0,P.jsx)(`span`,{className:`sr-only`,children:`More`})]});Wi.displayName=`BreadcrumbEllipsis`;function Gi(){let e=yn({select:e=>e.status===`pending`}),[t,n]=j.useState(!1);return j.useEffect(()=>{let t;return e?n(!0):t=setTimeout(()=>n(!1),500),()=>clearTimeout(t)},[e]),t?(0,P.jsx)(`div`,{className:N(`fixed top-0 left-0 z-[100] h-1 w-full bg-transparent overflow-hidden`),children:(0,P.jsx)(`div`,{className:N(`h-full w-full bg-primary/80 origin-left animate-progress`)})}):null}var Ki=new Map;function qi(e){let t=Ki.get(e);if(t)return t.refs+=1,t;let n=new EventSource(e,{withCredentials:!0});n.onerror=()=>{};let r={url:e,es:n,refs:1};return Ki.set(e,r),r}function Ji(e){let t=Ki.get(e);t&&(--t.refs,!(t.refs>0)&&(Ki.delete(e),t.es.close()))}function Yi(e,t){let n=qi(e).es;for(let[e,r]of Object.entries(t))n.addEventListener(e,r);return{close:()=>{for(let[e,r]of Object.entries(t))n.removeEventListener(e,r);Ji(e)}}}function Xi(e,t,n){let r=E(),i=(0,j.useMemo)(()=>{let e=new URLSearchParams;return e.set(`include_read`,t?`true`:`false`),e.set(`limit`,n),`${Fn}/notifications/events?${e.toString()}`},[t,n]);(0,j.useEffect)(()=>{if(!e)return;let a=Yi(i,{snapshot:e=>{try{let i=JSON.parse(e.data);if(!i||!Array.isArray(i.notifications))return;r.setQueryData(F.notifications(t,n),i)}catch{}}});return()=>{a.close()}},[e,t,n,r,i])}const H=Sn()({component:Zi,errorComponent:$i,notFoundComponent:Qi});function Zi(){let e=yn({select:e=>e.location}),t=_n(),n=E(),[r,i]=(0,j.useState)(!1),[a,o]=(0,j.useState)(!1),[s,c]=(0,j.useState)(!1),[l,u]=(0,j.useState)(!1),d=O({queryKey:F.session(),queryFn:Rn,retry:!1,staleTime:3e4}),f=(0,j.useMemo)(()=>`${e.pathname}${e.searchStr??``}${e.hash??``}`,[e.pathname,e.searchStr,e.hash]),p=(0,j.useMemo)(()=>In(f),[f]),m=(0,j.useMemo)(()=>[`/dashboard`,`/admin`,`/webhooks`,`/syslog`,`/snmp`].some(t=>e.pathname.startsWith(t)),[e.pathname]);(0,j.useEffect)(()=>{u(!1)},[e.pathname]);let h=d.data?.displayName||d.data?.username||``,g=!!d.data?.isAdmin,_=m&&!d.isLoading&&!d.data?.authenticated,v=d.data?.username??``;Xi(!!v,!1,`20`);let y=O({queryKey:F.notifications(!1,`20`),enabled:!!v,queryFn:async()=>({notifications:(await Vn(v,{include_read:`false`,limit:`20`})).notifications??[]}),staleTime:1/0,initialData:{notifications:[]}}),b=(0,j.useMemo)(()=>(y.data?.notifications??[]).filter(e=>!e.is_read).length,[y.data?.notifications]);return(0,P.jsx)(Ti,{defaultTheme:`dark`,storageKey:`vite-ui-theme`,children:(0,P.jsxs)(`div`,{className:`min-h-full`,children:[(0,P.jsx)(Gi,{}),(0,P.jsx)(`header`,{className:`sticky top-0 z-40 border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60`,style:{backgroundImage:`linear-gradient(to right, rgba(0,0,0,0.8), rgba(0,0,0,0.4)), url('/assets/skyforge/header-background.png')`,backgroundSize:`cover`,backgroundPosition:`left 50%`,height:`120px`},children:(0,P.jsxs)(`div`,{className:`mx-auto flex h-full max-w-[1600px] items-center justify-between gap-4 px-4`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-6`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,P.jsxs)(Oi,{open:l,onOpenChange:u,children:[(0,P.jsx)(ki,{asChild:!0,children:(0,P.jsxs)(I,{variant:`ghost`,size:`icon`,className:`lg:hidden`,children:[(0,P.jsx)(We,{className:`h-5 w-5`}),(0,P.jsx)(`span`,{className:`sr-only`,children:`Toggle menu`})]})}),(0,P.jsx)(Ni,{side:`left`,className:`w-[240px] p-0`,children:(0,P.jsx)(`div`,{className:`px-2 py-6`,children:(0,P.jsx)(ti,{collapsed:!1,isAdmin:g})})})]}),(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`div`,{className:`text-[10px] uppercase tracking-wider text-muted-foreground leading-none`,children:`Technical Services`}),(0,P.jsx)(`div`,{className:`text-lg font-bold tracking-tight`,children:`Skyforge`})]}),(0,P.jsx)(`div`,{className:`h-8 w-px bg-border hidden md:block`}),(0,P.jsx)(`img`,{src:`/assets/skyforge/FN-logo.svg`,alt:`Forward Networks`,className:`h-6 w-auto hidden sm:block`})]}),(0,P.jsxs)(I,{variant:`outline`,className:`hidden md:flex h-9 w-64 items-center justify-start px-3 text-sm text-muted-foreground font-normal`,onClick:()=>{let e=new KeyboardEvent(`keydown`,{key:`k`,metaKey:!0,bubbles:!0});document.dispatchEvent(e)},children:[(0,P.jsx)(te,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Search...`}),(0,P.jsxs)(`kbd`,{className:`pointer-events-none ml-auto inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100`,children:[(0,P.jsx)(`span`,{className:`text-xs`,children:`⌘`}),`K`]})]})]}),(0,P.jsxs)(`nav`,{className:`flex items-center gap-4 text-sm`,children:[(0,P.jsxs)(I,{variant:`ghost`,size:`icon`,className:`relative text-muted-foreground hover:text-foreground`,"aria-label":`Notifications`,onClick:()=>void t({to:`/notifications`}),children:[(0,P.jsx)(fe,{className:`h-4 w-4`}),b>0?(0,P.jsx)(`span`,{className:`absolute -right-1 -top-1 inline-flex h-4 min-w-[16px] items-center justify-center rounded-full bg-primary px-1 text-[10px] font-semibold text-primary-foreground`,children:b>99?`99+`:b}):null]}),(0,P.jsx)(Di,{}),d.data?.authenticated?(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsxs)(`div`,{className:`hidden md:flex flex-col items-end`,children:[(0,P.jsx)(`span`,{className:`text-[10px] text-muted-foreground uppercase leading-none`,children:`Signed in as`}),(0,P.jsx)(`span`,{className:`text-xs font-medium leading-none mt-1`,children:h})]}),(0,P.jsx)(I,{variant:`outline`,size:`sm`,disabled:r,onClick:async()=>{try{i(!0),await zn(),window.location.href=`/status?signin=1`}finally{i(!1)}},children:r?`…`:`Logout`})]}):(0,P.jsx)(I,{variant:`outline`,size:`sm`,disabled:a,onClick:async()=>{try{if(o(!0),!await Hr({loginHref:p})){window.location.href=p;return}await n.invalidateQueries({queryKey:F.session()})}finally{o(!1)}},children:a?`…`:`Login`})]})]})}),(0,P.jsxs)(`div`,{className:`mx-auto flex min-h-[calc(100vh-64px)] max-w-[1600px]`,children:[d.data?.authenticated&&(0,P.jsx)(`aside`,{className:N(`hidden lg:block border-r bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60`,`transition-all duration-300 ease-in-out`,s?`w-[64px]`:`w-[220px]`),children:(0,P.jsxs)(`div`,{className:`relative h-full`,children:[(0,P.jsx)(`div`,{className:N(`h-full px-4 py-4`,s&&`px-2`),children:(0,P.jsx)(ti,{collapsed:s,isAdmin:g})}),(0,P.jsx)(`button`,{className:N(`absolute -right-3 top-4 flex h-7 w-7 items-center justify-center rounded-full border bg-background text-foreground shadow-sm`,`hover:bg-accent hover:text-accent-foreground transition-colors`),onClick:()=>c(e=>!e),"aria-label":s?`Expand navigation`:`Collapse navigation`,children:s?(0,P.jsx)(Me,{className:`h-4 w-4`}):(0,P.jsx)(ee,{className:`h-4 w-4`})})]})}),(0,P.jsx)(`main`,{className:`flex-1 px-4 py-6 w-full overflow-hidden flex flex-col`,children:_?(0,P.jsx)(`div`,{className:`mx-auto max-w-xl`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Login Required`}),(0,P.jsx)(B,{children:`Sign in to access this page.`})]}),(0,P.jsxs)(V,{className:`flex flex-col gap-3`,children:[(0,P.jsx)(I,{variant:`default`,disabled:a,onClick:async()=>{try{if(o(!0),!await Hr({loginHref:p})){window.location.href=p;return}await n.invalidateQueries({queryKey:F.session()})}finally{o(!1)}},children:a?`…`:`Login`}),(0,P.jsx)(`a`,{className:`text-sm text-muted-foreground underline`,href:p,children:`Login with redirect instead`})]})]})}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(`div`,{className:`mb-6`,children:(0,P.jsx)(Ri,{children:(0,P.jsxs)(zi,{children:[(0,P.jsx)(Bi,{children:(0,P.jsx)(Vi,{href:`/`,children:`Dashboard`})}),`                    `,e.pathname.split(`/`).filter(Boolean).map((e,t,n)=>{let r=`/${n.slice(0,t+1).join(`/`)}`,i=t===n.length-1;return(0,P.jsxs)(j.Fragment,{children:[(0,P.jsx)(Ui,{}),(0,P.jsx)(Bi,{children:i?(0,P.jsx)(Hi,{className:`capitalize`,children:e}):(0,P.jsx)(Vi,{href:r,className:`capitalize`,children:e})})]},r)})]})})}),(0,P.jsx)(gn,{}),(0,P.jsxs)(`footer`,{className:`mt-auto pt-12 pb-6 flex items-center justify-between text-xs text-muted-foreground border-t`,children:[(0,P.jsx)(`div`,{className:`flex gap-4`,children:(0,P.jsxs)(`span`,{children:[`Questions? Reach out at `,(0,P.jsx)(`span`,{className:`font-mono text-primary`,children:`#ask-skyforge`})]})}),(0,P.jsx)(`a`,{className:`hover:text-foreground transition-colors underline hover:no-underline`,href:`/git/skyforge/skyforge/issues/new`,target:`_blank`,rel:`noreferrer`,children:`File an issue`})]})]})})]}),(0,P.jsx)(yi,{}),(0,P.jsx)(bi,{})]})})}function Qi(){return(0,P.jsx)(`div`,{className:`flex flex-col items-center justify-center min-h-[50vh] space-y-4 text-center`,children:(0,P.jsxs)(L,{variant:`glass`,className:`max-w-md`,children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{className:`text-2xl`,children:`Page not found`}),(0,P.jsx)(B,{children:`This route hasn’t been migrated yet (or the URL is incorrect).`})]}),(0,P.jsxs)(V,{className:`flex flex-wrap justify-center gap-3`,children:[(0,P.jsx)(I,{variant:`default`,asChild:!0,children:(0,P.jsx)(T,{to:`/dashboard/deployments`,children:`Go to deployments`})}),(0,P.jsx)(I,{variant:`outline`,asChild:!0,children:(0,P.jsx)(T,{to:`/status`,children:`Platform status`})})]})]})})}function $i(e){let t=e.error instanceof Error?e.error.message:typeof e.error==`string`?e.error:`Unknown error`;return(0,P.jsxs)(`div`,{className:`space-y-6`,children:[(0,P.jsxs)(L,{variant:`danger`,children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Application error`}),(0,P.jsx)(B,{className:`text-red-200/80`,children:t})]}),(0,P.jsxs)(V,{className:`flex flex-wrap gap-3`,children:[(0,P.jsx)(I,{variant:`outline`,className:`border-red-500/50 bg-red-500/10 hover:bg-red-500/20 text-red-100`,onClick:()=>e.reset(),children:`Try again`}),(0,P.jsx)(I,{variant:`secondary`,asChild:!0,children:(0,P.jsx)(T,{to:`/dashboard/deployments`,children:`Go to deployments`})})]})]}),e.error instanceof Error&&e.error.stack&&(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{className:`text-sm`,children:`Error Stack Trace`})}),(0,P.jsx)(V,{children:(0,P.jsx)(`pre`,{className:`overflow-auto whitespace-pre-wrap text-xs text-muted-foreground p-4 rounded-md bg-muted`,children:e.error.stack})})]})]})}function ea(e,t){let n=E(),r=(0,j.useMemo)(()=>`${Fn}/webhooks/events/stream?limit=${encodeURIComponent(t)}`,[t]);(0,j.useEffect)(()=>{if(!e)return;let i=Yi(r,{snapshot:e=>{try{let r=JSON.parse(e.data);n.setQueryData(F.webhookEvents(t),r)}catch{}}});return()=>{i.close()}},[e,t,n,r])}var ta=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`div`,{className:`relative w-full overflow-auto`,children:(0,P.jsx)(`table`,{ref:n,className:N(`w-full caption-bottom text-sm`,e),...t})}));ta.displayName=`Table`;var na=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`thead`,{ref:n,className:N(`[&_tr]:border-b`,e),...t}));na.displayName=`TableHeader`;var ra=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`tbody`,{ref:n,className:N(`[&_tr:last-child]:border-0`,e),...t}));ra.displayName=`TableBody`;var ia=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`tfoot`,{ref:n,className:N(`border-t bg-muted/50 font-medium [&>tr]:last:border-b-0`,e),...t}));ia.displayName=`TableFooter`;var U=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`tr`,{ref:n,className:N(`border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted`,e),...t}));U.displayName=`TableRow`;var W=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`th`,{ref:n,className:N(`h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0`,e),...t}));W.displayName=`TableHead`;var G=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`td`,{ref:n,className:N(`p-4 align-middle [&:has([role=checkbox])]:pr-0`,e),...t}));G.displayName=`TableCell`;var aa=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`caption`,{ref:n,className:N(`mt-4 text-sm text-muted-foreground`,e),...t}));aa.displayName=`TableCaption`;function K({className:e,...t}){return(0,P.jsx)(`div`,{className:N(`animate-pulse rounded-md bg-muted`,e),...t})}function oa({title:e,description:t,icon:n,action:r,className:i,...a}){return(0,P.jsx)(`div`,{className:N(`flex min-h-[400px] flex-col items-center justify-center rounded-md border border-dashed p-8 text-center animate-in fade-in zoom-in duration-300`,i),...a,children:(0,P.jsxs)(`div`,{className:`mx-auto flex max-w-[420px] flex-col items-center justify-center text-center`,children:[n&&(0,P.jsx)(`div`,{className:`flex h-20 w-20 items-center justify-center rounded-full bg-muted`,children:(0,P.jsx)(n,{className:`h-10 w-10 text-muted-foreground`})}),(0,P.jsx)(`h3`,{className:`mt-4 text-lg font-semibold`,children:e}),t&&(0,P.jsx)(`p`,{className:`mb-4 mt-2 text-sm text-muted-foreground`,children:t}),r&&(0,P.jsx)(I,{onClick:r.onClick,variant:`outline`,size:`sm`,children:r.label})]})})}const sa=D(`/webhooks`)({component:ca});function ca(){ea(!0,`200`);let e=O({queryKey:F.webhookEvents(`200`),queryFn:()=>Or({limit:`200`}),staleTime:1/0}),t=e.data?.events??[];return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Webhook inbox`}),(0,P.jsx)(B,{children:`Recent webhook events routed to your user.`})]})}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-0`,children:e.isLoading?(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(K,{className:`h-12 w-full`}),(0,P.jsx)(K,{className:`h-12 w-full`}),(0,P.jsx)(K,{className:`h-12 w-full`})]}):e.isError?(0,P.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load webhook events.`}):t.length===0?(0,P.jsx)(oa,{icon:tt,title:`No webhook events`,description:`No webhook events have been received yet.`}):(0,P.jsxs)(ta,{children:[(0,P.jsx)(na,{children:(0,P.jsxs)(U,{children:[(0,P.jsx)(W,{className:`w-[180px]`,children:`Time`}),(0,P.jsx)(W,{className:`w-[140px]`,children:`Source`}),(0,P.jsx)(W,{children:`Event`}),(0,P.jsx)(W,{className:`w-[100px] text-right`,children:`ID`})]})}),(0,P.jsx)(ra,{children:t.map(e=>(0,P.jsxs)(U,{children:[(0,P.jsx)(G,{className:`text-muted-foreground whitespace-nowrap text-xs`,children:e.receivedAt??``}),(0,P.jsx)(G,{children:e.sourceIp??``}),(0,P.jsxs)(G,{className:`font-medium text-sm`,children:[e.method,` `,e.path]}),(0,P.jsx)(G,{className:`font-mono text-xs text-muted-foreground text-right`,children:String(e.id)})]},String(e.id)))})]})})})]})}function la(e,t){let n=E(),r=(0,j.useMemo)(()=>`${Fn}/syslog/events/stream?limit=${encodeURIComponent(t)}`,[t]);(0,j.useEffect)(()=>{if(!e)return;let i=Yi(r,{snapshot:e=>{try{let r=JSON.parse(e.data);n.setQueryData(F.syslogEvents(t),r)}catch{}}});return()=>{i.close()}},[e,t,n,r])}const ua=D(`/syslog`)({component:da});function da(){la(!0,`200`);let e=O({queryKey:F.syslogEvents(`200`),queryFn:()=>kr({limit:`200`}),staleTime:1/0}),t=e.data?.events??[];return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Syslog inbox`}),(0,P.jsx)(B,{children:`Recent syslog events mapped to your user.`})]})}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-0`,children:e.isLoading?(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(K,{className:`h-12 w-full`}),(0,P.jsx)(K,{className:`h-12 w-full`}),(0,P.jsx)(K,{className:`h-12 w-full`})]}):e.isError?(0,P.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load syslog events.`}):t.length===0?(0,P.jsx)(oa,{icon:tt,title:`No syslog events`,description:`No syslog messages have been received yet.`}):(0,P.jsxs)(ta,{children:[(0,P.jsx)(na,{children:(0,P.jsxs)(U,{children:[(0,P.jsx)(W,{className:`w-[180px]`,children:`Time`}),(0,P.jsx)(W,{className:`w-[140px]`,children:`Source`}),(0,P.jsx)(W,{className:`w-[140px]`,children:`App`}),(0,P.jsx)(W,{children:`Message`})]})}),(0,P.jsx)(ra,{children:t.map(e=>(0,P.jsxs)(U,{children:[(0,P.jsx)(G,{className:`text-muted-foreground whitespace-nowrap text-xs`,children:e.receivedAt??``}),(0,P.jsx)(G,{className:`font-mono text-xs`,children:e.sourceIp??``}),(0,P.jsx)(G,{className:`text-xs`,children:e.appName??``}),(0,P.jsx)(G,{className:`font-medium text-foreground text-sm line-clamp-2`,children:e.message??``})]},String(e.id)))})]})})})]})}function fa(e){let t=E(),n=(0,j.useMemo)(()=>`/status/summary/events`,[]);(0,j.useEffect)(()=>{if(!e)return;let r=Yi(n,{snapshot:e=>{try{let n=JSON.parse(e.data);t.setQueryData(F.statusSummary(),n)}catch{}}});return()=>{r.close()}},[e,t,n])}var pa=Tn(`inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2`,{variants:{variant:{default:`border-transparent bg-primary text-primary-foreground hover:bg-primary/80`,secondary:`border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80`,destructive:`border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80`,outline:`text-foreground`}},defaultVariants:{variant:`default`}});function ma({className:e,variant:t,...n}){return(0,P.jsx)(`div`,{className:N(pa({variant:t}),e),...n})}var ha={blue:`from-blue-500/10 via-blue-500/5 to-transparent`,green:`from-emerald-500/10 via-emerald-500/5 to-transparent`,purple:`from-purple-500/10 via-purple-500/5 to-transparent`,orange:`from-orange-500/10 via-orange-500/5 to-transparent`,red:`from-red-500/10 via-red-500/5 to-transparent`};const ga=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`div`,{ref:n,className:N(`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4`,e),...t}));ga.displayName=`BentoGrid`;const _a=j.forwardRef(({className:e,gradient:t=`blue`,children:n,...r},i)=>(0,P.jsx)(`div`,{ref:i,className:N(`relative overflow-hidden rounded-xl border border-border bg-card p-6`,`bg-gradient-to-br`,ha[t],e),...r,children:n}));_a.displayName=`BentoItem`;const va=j.forwardRef(({title:e,value:t,gradient:n=`blue`,icon:r,subtitle:i,trend:a,className:o},s)=>(0,P.jsxs)(_a,{ref:s,gradient:n,className:o,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2 mb-2`,children:[r&&(0,P.jsx)(`div`,{className:`text-muted-foreground`,children:r}),(0,P.jsx)(`h3`,{className:`text-sm font-medium text-muted-foreground/80`,children:e})]}),(0,P.jsxs)(`div`,{className:`flex items-end justify-between`,children:[(0,P.jsx)(`div`,{className:`text-3xl font-bold`,children:t}),a&&(0,P.jsxs)(`div`,{className:N(`flex items-center gap-1 text-sm`,a.direction===`up`?`text-emerald-500`:`text-red-500`),children:[a.direction===`up`?(0,P.jsx)(pe,{className:`w-4 h-4`}):(0,P.jsx)(ge,{className:`w-4 h-4`}),a.value,`%`]})]}),i&&(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground/70 mt-2`,children:i})]}));va.displayName=`BentoStatCard`;const ya=j.forwardRef(({userName:e,subtitle:t,className:n},r)=>(0,P.jsx)(_a,{ref:r,gradient:`purple`,className:N(`md:col-span-2`,n),children:(0,P.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,children:[(0,P.jsx)(`div`,{className:`p-2 rounded-full bg-purple-500/10`,children:(0,P.jsx)(St,{className:`w-5 h-5 text-purple-500`})}),(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h2`,{className:`text-xl font-bold`,children:e?`Welcome back, ${e}`:`Welcome to Skyforge`}),t&&(0,P.jsx)(`p`,{className:`text-sm text-muted-foreground/80`,children:t})]})]})}));ya.displayName=`BentoWelcomeCard`;const ba=j.forwardRef(({actions:e,className:n},r)=>(0,P.jsxs)(_a,{ref:r,gradient:`blue`,className:N(`md:col-span-2`,n),children:[(0,P.jsx)(`h3`,{className:`font-semibold mb-4`,children:`Quick Actions`}),(0,P.jsx)(`div`,{className:`grid grid-cols-2 gap-3`,children:e.map((e,n)=>(0,P.jsxs)(t.button,{onClick:e.onClick,className:`flex items-center gap-2 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors text-left`,whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.icon,(0,P.jsx)(`span`,{className:`text-sm font-medium`,children:e.label})]},n))})]}));ba.displayName=`BentoQuickActions`;const xa=j.forwardRef(({servers:e,className:t},n)=>(0,P.jsxs)(_a,{ref:n,gradient:`green`,className:N(`md:col-span-2`,t),children:[(0,P.jsx)(`h3`,{className:`font-semibold mb-4`,children:`Server Status`}),(0,P.jsx)(`div`,{className:`grid grid-cols-2 gap-3`,children:e.map((e,t)=>(0,P.jsxs)(`div`,{className:`flex items-center justify-between p-3 rounded-lg bg-muted/30`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`div`,{className:N(`w-2 h-2 rounded-full`,e.status===`online`?`bg-emerald-500`:e.status===`degraded`?`bg-amber-500`:`bg-red-500`)}),(0,P.jsx)(`span`,{className:`text-sm font-medium`,children:e.name})]}),e.cpu!==void 0&&(0,P.jsxs)(ma,{variant:`secondary`,className:`text-xs`,children:[e.cpu,`%`]})]},t))})]}));xa.displayName=`BentoServerStatus`;const Sa=D(`/status`)({component:Ca});function Ca(){fa(!0);let e=O({queryKey:F.statusSummary(),queryFn:Br,staleTime:1/0}),t=O({queryKey:F.uiConfig(),queryFn:zr,staleTime:1/0}),n=e.data,r=n?.checks??[],i=r.filter(e=>e.status!==`up`&&e.status!==`ok`);return(0,P.jsxs)(`div`,{className:`space-y-8 p-6`,children:[(0,P.jsxs)(ga,{className:`gap-4`,children:[(0,P.jsx)(ya,{subtitle:`Here's what's happening with your infrastructure today.`}),e.isLoading?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(_a,{className:`h-32`,children:(0,P.jsx)(K,{className:`h-full w-full`})}),(0,P.jsx)(_a,{className:`h-32`,children:(0,P.jsx)(K,{className:`h-full w-full`})}),(0,P.jsx)(_a,{className:`h-32`,children:(0,P.jsx)(K,{className:`h-full w-full`})})]}):(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(va,{title:`Active Deployments`,value:n?.deploymentsActive??0,gradient:`green`,icon:(0,P.jsx)(Qe,{className:`w-5 h-5`}),subtitle:`${n?.deploymentsTotal??0} total deployments`}),(0,P.jsx)(va,{title:`Services Operational`,value:`${n?.up??0} / ${r.length}`,gradient:n?.up===r.length?`green`:`orange`,icon:(0,P.jsx)(u,{className:`w-5 h-5`})}),(0,P.jsx)(va,{title:`Services Down`,value:n?.down??0,gradient:n?.down?`red`:`blue`,icon:(0,P.jsx)(v,{className:`w-5 h-5`})}),(0,P.jsxs)(_a,{gradient:`purple`,className:`relative overflow-hidden`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between mb-3`,children:[(0,P.jsxs)(`h3`,{className:`font-semibold flex items-center gap-2 text-sm text-muted-foreground/80`,children:[(0,P.jsx)(m,{className:`w-4 h-4`}),`Platform Health`]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(`span`,{className:`relative flex h-2 w-2`,children:[(0,P.jsx)(`span`,{className:`animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75`}),(0,P.jsx)(`span`,{className:`relative inline-flex rounded-full h-2 w-2 bg-emerald-500`})]}),(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:`Live`})]})]}),(0,P.jsx)(`div`,{className:`flex items-end gap-4`,children:(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`span`,{className:N(`text-3xl font-bold`,n?.status===`ok`?`text-emerald-500`:n?.status===`degraded`?`text-amber-500`:`text-muted-foreground`),children:(n?.status??`checking`).toUpperCase()}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground mt-1`,children:n?.timestamp?`Refreshed ${new Date(n.timestamp).toLocaleTimeString()}`:`Checking...`})]})})]})]})]}),(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-3`,children:[t.data?.externalUrl&&(0,P.jsxs)(L,{variant:`glass`,className:`border-green-500/20 bg-green-500/5`,children:[(0,P.jsx)(R,{children:(0,P.jsxs)(z,{className:`text-base flex items-center gap-2 text-green-500`,children:[(0,P.jsx)(Dt,{className:`w-4 h-4`}),`Public Access`]})}),(0,P.jsxs)(V,{className:`text-sm text-muted-foreground space-y-3`,children:[(0,P.jsx)(`p`,{children:`This environment is securely accessible via Cloudflare Tunnel.`}),(0,P.jsx)(`div`,{className:`rounded bg-background/50 p-2 border`,children:(0,P.jsx)(`a`,{className:`text-primary hover:underline break-all font-mono text-xs`,href:t.data.externalUrl,target:`_blank`,rel:`noreferrer`,children:t.data.externalUrl})})]})]}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsx)(R,{children:(0,P.jsxs)(z,{className:`text-base flex items-center gap-2`,children:[(0,P.jsx)(ue,{className:`w-4 h-4 text-orange-500`}),`Skyforge at a Glance`]})}),(0,P.jsxs)(V,{className:`text-sm text-muted-foreground space-y-3`,children:[(0,P.jsx)(`p`,{children:`Skyforge coordinates lab + cloud tooling into repeatable, auditable workflows for platform teams.`}),(0,P.jsxs)(`ul`,{className:`list-disc pl-4 space-y-1`,children:[(0,P.jsx)(`li`,{children:`Teams can still run tools manually; Skyforge standardizes the "happy path".`}),(0,P.jsx)(`li`,{children:`Enables consistent lab delivery across on-prem and cloud environments.`}),(0,P.jsx)(`li`,{children:`Creates shared context for collaboration, troubleshooting, and handoffs.`})]})]})]}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsx)(R,{children:(0,P.jsxs)(z,{className:`text-base flex items-center gap-2`,children:[(0,P.jsx)(zt,{className:`w-4 h-4 text-blue-500`}),`What You Can Do Here`]})}),(0,P.jsxs)(V,{className:`text-sm text-muted-foreground space-y-2`,children:[(0,P.jsx)(T,{className:`text-primary hover:underline`,to:`/dashboard/deployments`,children:`→ Open the dashboard`}),(0,P.jsx)(T,{className:`text-primary hover:underline`,to:`/dashboard/deployments/new`,children:`→ Create a deployment`}),(0,P.jsx)(T,{className:`text-primary hover:underline`,to:`/dashboard/s3`,children:`→ Browse artifacts (S3)`}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground mt-3`,children:`Status is refreshed automatically via Server-Sent Events.`})]})]}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsx)(R,{children:(0,P.jsxs)(z,{className:`text-base flex items-center gap-2`,children:[(0,P.jsx)(Tt,{className:`w-4 h-4 text-purple-500`}),`How Workflows Run`]})}),(0,P.jsxs)(V,{className:`text-sm text-muted-foreground space-y-2`,children:[(0,P.jsx)(`p`,{children:`Skyforge connects source control, automation, and lab capacity into one delivery loop.`}),(0,P.jsxs)(`ol`,{className:`list-decimal pl-4 space-y-1`,children:[(0,P.jsx)(`li`,{children:`Choose a blueprint (Git).`}),(0,P.jsx)(`li`,{children:`Run deployments (native task engine).`}),(0,P.jsx)(`li`,{children:`Validate on lab servers (BYOS + In-Cluster).`}),(0,P.jsx)(`li`,{children:`Store artifacts + state (Skyforge storage).`})]})]})]})]}),(0,P.jsx)(ga,{className:`gap-4`,children:(0,P.jsxs)(_a,{gradient:`blue`,className:`md:col-span-4 hover-lift`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between mb-6`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(`div`,{className:`p-2 rounded-lg bg-blue-500/10`,children:(0,P.jsx)(v,{className:`w-5 h-5 text-blue-500`})}),(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h3`,{className:`font-semibold`,children:`Integrated Toolchain & Status`}),(0,P.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Live health checks for all platform services.`})]})]}),i.length>0&&(0,P.jsxs)(ma,{variant:`destructive`,className:`animate-pulse`,children:[i.length,` Service`,i.length>1?`s`:``,` Reporting Issues`]})]}),(0,P.jsx)(`div`,{className:`grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4`,children:[{id:`gitea`,name:`Git`,path:`/git/`,icon:Qt},{id:`netbox`,name:`NetBox`,path:`/netbox/`,icon:He},{id:`nautobot`,name:`Nautobot`,path:`/nautobot/`,icon:He},{id:`coder`,name:`Coder`,path:`/coder`,icon:Qe},{id:`yaade`,name:`API Testing`,path:`/api-testing/`,icon:m},{id:`webhooks`,name:`Webhooks`,path:`/dashboard/webhooks`,icon:Tt}].map(e=>{let t=r.find(t=>t.name.toLowerCase().includes(e.id)),n=t?t.status===`up`||t.status===`ok`:!0,i=n?`bg-emerald-500`:`bg-red-500`,a=e.icon;return(0,P.jsxs)(`a`,{href:e.path,target:e.path.startsWith(`http`)||e.path.startsWith(`/api`)||e.path.includes(`/`)?`_blank`:`_self`,className:`flex flex-col items-center justify-center p-4 rounded-lg bg-background/50 border hover:bg-background/80 transition-colors group relative overflow-hidden`,children:[(0,P.jsx)(`div`,{className:`absolute top-2 right-2 w-2 h-2 rounded-full ${i} ${n?``:`animate-pulse`}`}),(0,P.jsx)(a,{className:`w-6 h-6 mb-2 text-muted-foreground group-hover:text-primary transition-colors`}),(0,P.jsx)(`span`,{className:`text-sm font-medium`,children:e.name}),(0,P.jsx)(`span`,{className:N(`text-[10px] mt-1 capitalize font-medium`,n?`text-emerald-500/80`:`text-red-500`),children:t?.status??`Operational`})]},e.id)})}),i.length>0&&(0,P.jsxs)(`div`,{className:`mt-6 pt-6 border-t`,children:[(0,P.jsx)(`h4`,{className:`text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-3`,children:`Service Alerts`}),(0,P.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:i.map(e=>(0,P.jsxs)(ma,{variant:`outline`,className:`text-[10px] border-red-500/30 text-red-400 bg-red-500/5`,children:[e.name,`: `,e.status]},e.name))})]})]})})]})}function wa(e,t){let n=E(),r=(0,j.useMemo)(()=>`${Fn}/snmp/traps/events/stream?limit=${encodeURIComponent(t)}`,[t]);(0,j.useEffect)(()=>{if(!e)return;let i=Yi(r,{snapshot:e=>{try{let r=JSON.parse(e.data);n.setQueryData(F.snmpTrapEvents(t),r)}catch{}}});return()=>{i.close()}},[e,t,n,r])}const Ta=D(`/snmp`)({component:Ea});function Ea(){wa(!0,`200`);let e=O({queryKey:F.snmpTrapEvents(`200`),queryFn:()=>Ar({limit:`200`}),staleTime:1/0}),t=e.data?.events??[];return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`SNMP trap inbox`}),(0,P.jsx)(B,{children:`Recent SNMP trap events routed to your user.`})]})}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-0`,children:e.isLoading?(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(K,{className:`h-12 w-full`}),(0,P.jsx)(K,{className:`h-12 w-full`}),(0,P.jsx)(K,{className:`h-12 w-full`})]}):e.isError?(0,P.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load SNMP trap events.`}):t.length===0?(0,P.jsx)(oa,{icon:tt,title:`No trap events`,description:`No SNMP traps have been received yet.`}):(0,P.jsxs)(ta,{children:[(0,P.jsx)(na,{children:(0,P.jsxs)(U,{children:[(0,P.jsx)(W,{className:`w-[180px]`,children:`Time`}),(0,P.jsx)(W,{className:`w-[140px]`,children:`Source`}),(0,P.jsx)(W,{children:`OID`}),(0,P.jsx)(W,{className:`w-[100px] text-right`,children:`ID`})]})}),(0,P.jsx)(ra,{children:t.map(e=>(0,P.jsxs)(U,{children:[(0,P.jsx)(G,{className:`text-muted-foreground whitespace-nowrap text-xs`,children:e.receivedAt??``}),(0,P.jsx)(G,{className:`font-mono text-xs`,children:e.sourceIp??``}),(0,P.jsx)(G,{className:`font-medium text-foreground text-sm font-mono`,children:e.oid??``}),(0,P.jsx)(G,{className:`font-mono text-xs text-muted-foreground text-right`,children:String(e.id)})]},String(e.id)))})]})})})]})}function Da({className:e,children:t,...n}){return(0,P.jsx)(`div`,{className:N(`w-full overflow-x-auto rounded-md border`,e),...n,children:(0,P.jsx)(`div`,{className:`min-w-[800px]`,children:t})})}var Oa=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Ue,{className:N(`peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input`,e),...t,ref:n,children:(0,P.jsx)(Ce,{className:N(`pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0`)})}));Oa.displayName=Ue.displayName;var ka=Tn(`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70`),q=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(ze,{ref:n,className:N(ka(),e),...t}));q.displayName=ze.displayName;var Aa=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(ie,{ref:n,className:N(`peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground`,e),...t,children:(0,P.jsx)(Ve,{className:N(`flex items-center justify-center text-current`),children:(0,P.jsx)(ve,{className:`h-4 w-4`})})}));Aa.displayName=ie.displayName;var ja=b,Ma=C,Na=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Pe,{className:N(`fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t,ref:n}));Na.displayName=Pe.displayName;var Pa=j.forwardRef(({className:e,...t},n)=>(0,P.jsxs)(Ma,{children:[(0,P.jsx)(Na,{}),(0,P.jsx)(Ie,{ref:n,className:N(`fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg`,e),...t})]}));Pa.displayName=Ie.displayName;var Fa=({className:e,...t})=>(0,P.jsx)(`div`,{className:N(`flex flex-col space-y-2 text-center sm:text-left`,e),...t});Fa.displayName=`AlertDialogHeader`;var Ia=({className:e,...t})=>(0,P.jsx)(`div`,{className:N(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});Ia.displayName=`AlertDialogFooter`;var La=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(oe,{ref:n,className:N(`text-lg font-semibold`,e),...t}));La.displayName=oe.displayName;var Ra=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(S,{ref:n,className:N(`text-sm text-muted-foreground`,e),...t}));Ra.displayName=S.displayName;var za=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(pn,{ref:n,className:N(xi(),e),...t}));za.displayName=pn.displayName;var Ba=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(o,{ref:n,className:N(xi({variant:`outline`}),`mt-2 sm:mt-0`,e),...t}));Ba.displayName=o.displayName;const Va=D(`/notifications`)({component:Ha});function Ha(){let[e,t]=(0,j.useState)(!1),[n,r]=(0,j.useState)(null),[i,a]=(0,j.useState)(!1),[o,s]=(0,j.useState)(new Set),c=E(),l=O({queryKey:F.session(),queryFn:Rn,staleTime:3e4,retry:!1}).data?.username??``;Xi(!!l,e,`50`);let u=O({queryKey:F.notifications(e,`50`),enabled:!!l,queryFn:async()=>({notifications:(await Vn(l,{include_read:e?`true`:`false`,limit:`50`})).notifications??[]}),staleTime:1/0,initialData:{notifications:[]}}),d=(0,j.useMemo)(()=>u.data?.notifications??[],[u.data?.notifications]),f=(0,j.useMemo)(()=>d.filter(e=>!e.is_read).length,[d]),p=e=>{s(e?new Set(d.map(e=>String(e.id))):new Set)},m=(e,t)=>{let n=new Set(o);t?n.add(e):n.delete(e),s(n)},h=async()=>{try{let t=Array.from(o).map(e=>Un(e));await Promise.all(t),w.success(`${o.size} notifications marked as read`),s(new Set),await c.invalidateQueries({queryKey:F.notifications(e,`50`)})}catch(e){w.error(`Failed to mark selection as read`,{description:e.message})}},ee=async()=>{try{let t=Array.from(o).map(e=>Wn(e));await Promise.all(t),w.success(`${o.size} notifications deleted`),s(new Set),await c.invalidateQueries({queryKey:F.notifications(e,`50`)})}catch(e){w.error(`Failed to delete selection`,{description:e.message})}},g=async()=>{try{await Hn(l),w.success(`All notifications marked as read`)}catch(e){w.error(`Failed to mark notifications as read`,{description:e.message})}},_=async e=>{try{await Un(e),w.success(`Notification marked as read`)}catch(e){w.error(`Failed to mark notification as read`,{description:e.message})}};return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(`div`,{className:`p-2 rounded-full bg-primary/10`,children:(0,P.jsx)(fe,{className:`h-6 w-6 text-primary`})}),(0,P.jsxs)(`div`,{children:[(0,P.jsx)(z,{children:`Notifications`}),(0,P.jsx)(B,{children:`Stay updated with platform events and system alerts.`})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(Oa,{id:`show-read`,checked:e,onCheckedChange:t}),(0,P.jsx)(q,{htmlFor:`show-read`,className:`cursor-pointer`,children:`Show read`})]}),(0,P.jsx)(I,{variant:`outline`,size:`sm`,disabled:!l||f===0,onClick:g,children:`Mark all read`})]})]})})}),o.size>0&&(0,P.jsxs)(`div`,{className:`fixed bottom-6 left-1/2 -translate-x-1/2 z-50 flex items-center gap-4 rounded-full border bg-background/95 p-2 px-6 shadow-xl backdrop-blur animate-in slide-in-from-bottom-10 fade-in duration-300`,children:[(0,P.jsxs)(`span`,{className:`text-sm font-medium`,children:[o.size,` selected`]}),(0,P.jsx)(`div`,{className:`h-4 w-px bg-border`}),(0,P.jsxs)(I,{size:`sm`,variant:`ghost`,onClick:h,children:[(0,P.jsx)(ve,{className:`mr-2 h-4 w-4`}),`Mark read`]}),(0,P.jsxs)(I,{size:`sm`,variant:`destructive`,onClick:ee,children:[(0,P.jsx)(Se,{className:`mr-2 h-4 w-4`}),`Delete`]}),(0,P.jsx)(I,{size:`sm`,variant:`ghost`,onClick:()=>s(new Set),children:`Cancel`})]}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-0`,children:u.isLoading?(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(K,{className:`h-12 w-full`}),(0,P.jsx)(K,{className:`h-12 w-full`}),(0,P.jsx)(K,{className:`h-12 w-full`})]}):u.isError?(0,P.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load notifications.`}):d.length===0?(0,P.jsx)(oa,{icon:tt,title:`No notifications`,description:e?`You don't have any notifications at the moment.`:`You've read all your notifications!`}):(0,P.jsx)(Da,{className:`border-none`,children:(0,P.jsxs)(ta,{children:[(0,P.jsx)(na,{children:(0,P.jsxs)(U,{children:[(0,P.jsx)(W,{className:`w-[50px]`,children:(0,P.jsx)(Aa,{checked:d.length>0&&o.size===d.length,onCheckedChange:p})}),(0,P.jsx)(W,{className:`w-[180px]`,children:`Time`}),(0,P.jsx)(W,{children:`Title & Message`}),(0,P.jsx)(W,{className:`w-[120px]`,children:`Category`}),(0,P.jsx)(W,{className:`w-[80px] text-right`,children:`Actions`})]})}),(0,P.jsx)(ra,{children:d.map(e=>{let t=String(e.id),n=o.has(t);return(0,P.jsxs)(U,{className:e.is_read?`opacity-60 grayscale-[0.5]`:``,"data-state":n?`selected`:void 0,children:[(0,P.jsx)(G,{children:(0,P.jsx)(Aa,{checked:n,onCheckedChange:e=>m(t,e)})}),(0,P.jsx)(G,{className:`text-muted-foreground text-xs whitespace-nowrap`,children:e.created_at??``}),(0,P.jsxs)(G,{children:[(0,P.jsx)(`div`,{className:`font-medium text-sm`,children:e.title??``}),e.message?(0,P.jsx)(`div`,{className:`mt-1 text-xs text-muted-foreground line-clamp-2`,children:e.message}):null]}),(0,P.jsx)(G,{children:(0,P.jsx)(`span`,{className:`inline-flex items-center rounded-full bg-muted px-2 py-0.5 text-[10px] font-medium text-muted-foreground capitalize`,children:e.category??`System`})}),(0,P.jsx)(G,{className:`text-right`,children:(0,P.jsxs)(Ur,{children:[(0,P.jsx)(Wr,{asChild:!0,children:(0,P.jsxs)(I,{variant:`ghost`,size:`icon`,className:`h-8 w-8`,children:[(0,P.jsx)(ht,{className:`h-4 w-4`}),(0,P.jsx)(`span`,{className:`sr-only`,children:`Open menu`})]})}),(0,P.jsxs)(qr,{align:`end`,children:[!e.is_read&&(0,P.jsxs)(Jr,{onClick:()=>_(t),children:[(0,P.jsx)(ve,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Mark as read`})]}),(0,P.jsxs)(Jr,{className:`text-destructive focus:text-destructive`,onClick:()=>{r(t),a(!0)},children:[(0,P.jsx)(Se,{className:`mr-2 h-4 w-4`}),(0,P.jsx)(`span`,{children:`Delete`})]})]})]})})]},t)})})]})})})}),(0,P.jsx)(ja,{open:i,onOpenChange:a,children:(0,P.jsxs)(Pa,{children:[(0,P.jsxs)(Fa,{children:[(0,P.jsx)(La,{children:`Delete notification?`}),(0,P.jsx)(Ra,{children:`This action cannot be undone.`})]}),(0,P.jsxs)(Ia,{children:[(0,P.jsx)(Ba,{children:`Cancel`}),(0,P.jsx)(za,{onClick:async()=>{if(n)try{await Wn(n),w.success(`Notification deleted`),a(!1),r(null)}catch(e){w.error(`Failed to delete notification`,{description:e.message})}},className:xi({variant:`destructive`}),children:`Delete`})]})]})})]})}var J=j.forwardRef(({className:e,type:t,...n},r)=>(0,P.jsx)(`input`,{type:t,className:N(`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm`,e),ref:r,...n}));J.displayName=`Input`;var Ua=de,Wa=ce,Ga=j.forwardRef(({className:e,children:t,...n},r)=>(0,P.jsxs)(ne,{ref:r,className:N(`flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1`,e),...n,children:[t,(0,P.jsx)(h,{asChild:!0,children:(0,P.jsx)(p,{className:`h-4 w-4 opacity-50`})})]}));Ga.displayName=ne.displayName;var Ka=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(be,{ref:n,className:N(`flex cursor-default items-center justify-center py-1`,e),...t,children:(0,P.jsx)(an,{className:`h-4 w-4`})}));Ka.displayName=be.displayName;var qa=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(me,{ref:n,className:N(`flex cursor-default items-center justify-center py-1`,e),...t,children:(0,P.jsx)(p,{className:`h-4 w-4`})}));qa.displayName=me.displayName;var Ja=j.forwardRef(({className:e,children:t,position:n=`popper`,...r},i)=>(0,P.jsx)(bt,{children:(0,P.jsxs)(rn,{ref:i,className:N(`relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,n===`popper`&&`data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1`,e),position:n,...r,children:[(0,P.jsx)(Ka,{}),(0,P.jsx)(Te,{className:N(`p-1`,n===`popper`&&`h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]`),children:t}),(0,P.jsx)(qa,{})]})}));Ja.displayName=rn.displayName;var Ya=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(r,{ref:n,className:N(`py-1.5 pl-8 pr-2 text-sm font-semibold`,e),...t}));Ya.displayName=r.displayName;var Y=j.forwardRef(({className:e,children:t,...n},r)=>(0,P.jsxs)(f,{ref:r,className:N(`relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...n,children:[(0,P.jsx)(`span`,{className:`absolute left-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,P.jsx)(_e,{children:(0,P.jsx)(ve,{className:`h-4 w-4`})})}),(0,P.jsx)(Ct,{children:t})]}));Y.displayName=f.displayName;var Xa=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(_,{ref:n,className:N(`-mx-1 my-1 h-px bg-muted`,e),...t}));Xa.displayName=_.displayName;var Za=Oe,Qa=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(sn,{ref:n,className:N(`inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground`,e),...t}));Qa.displayName=sn.displayName;var $a=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(l,{ref:n,className:N(`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm`,e),...t}));$a.displayName=l.displayName;var eo=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(Ze,{ref:n,className:N(`mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2`,e),...t}));eo.displayName=Ze.displayName;const to=D(`/design`)({component:no});function no(){return(0,P.jsxs)(`div`,{className:`space-y-10 p-6 pb-20`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`h1`,{className:`text-3xl font-bold tracking-tight`,children:`Design System`}),(0,P.jsx)(`p`,{className:`text-muted-foreground`,children:`A catalog of all reusable UI components available in the portal.`})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Buttons`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-4`,children:[(0,P.jsx)(I,{variant:`default`,children:`Default`}),(0,P.jsx)(I,{variant:`secondary`,children:`Secondary`}),(0,P.jsx)(I,{variant:`destructive`,children:`Destructive`}),(0,P.jsx)(I,{variant:`outline`,children:`Outline`}),(0,P.jsx)(I,{variant:`ghost`,children:`Ghost`}),(0,P.jsx)(I,{variant:`link`,children:`Link`}),(0,P.jsx)(I,{size:`sm`,children:`Small`}),(0,P.jsx)(I,{size:`lg`,children:`Large`}),(0,P.jsx)(I,{size:`icon`,children:(0,P.jsx)(c,{className:`h-4 w-4`})}),(0,P.jsx)(I,{disabled:!0,children:`Disabled`}),(0,P.jsxs)(I,{variant:`outline`,className:`gap-2`,children:[(0,P.jsx)(we,{className:`h-4 w-4`}),` With Icon`]})]})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Badges`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-4`,children:[(0,P.jsx)(ma,{children:`Default`}),(0,P.jsx)(ma,{variant:`secondary`,children:`Secondary`}),(0,P.jsx)(ma,{variant:`outline`,children:`Outline`}),(0,P.jsx)(ma,{variant:`destructive`,children:`Destructive`})]})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Cards`}),(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2 lg:grid-cols-4`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Default Card`}),(0,P.jsx)(B,{children:`Standard container style`})]}),(0,P.jsx)(V,{children:`Content goes here`})]}),(0,P.jsxs)(L,{variant:`glass`,children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Glass Card`}),(0,P.jsx)(B,{children:`Backdrop blur effect`})]}),(0,P.jsx)(V,{children:`Popular for headers`})]}),(0,P.jsxs)(L,{variant:`flat`,children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Flat Card`}),(0,P.jsx)(B,{children:`No shadow, border only`})]}),(0,P.jsx)(V,{children:`Clean look`})]}),(0,P.jsxs)(L,{variant:`danger`,children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Danger Card`}),(0,P.jsx)(B,{children:`For error states`})]}),(0,P.jsx)(V,{className:`text-sm`,children:`Something went wrong`})]})]})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Bento Grid`}),(0,P.jsxs)(ga,{children:[(0,P.jsx)(va,{title:`Total Revenue`,value:`$45,231.89`,icon:(0,P.jsx)(dn,{className:`h-4 w-4`}),gradient:`blue`}),(0,P.jsx)(va,{title:`Active Users`,value:`+2350`,icon:(0,P.jsx)(St,{className:`h-4 w-4`}),gradient:`green`}),(0,P.jsx)(_a,{gradient:`purple`,className:`md:col-span-2`,children:(0,P.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,P.jsx)(`div`,{className:`p-2 bg-background/20 rounded-full`,children:(0,P.jsx)(Qe,{className:`h-6 w-6`})}),(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h3`,{className:`font-semibold text-lg`,children:`Cloud Infrastructure`}),(0,P.jsx)(`p`,{className:`text-sm text-muted-foreground/80`,children:`Manage your cloud resources and deployments from a single dashboard.`})]})]})})]})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Form Inputs`}),(0,P.jsx)(L,{children:(0,P.jsxs)(V,{className:`pt-6 space-y-4 max-w-md`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(q,{htmlFor:`email`,children:`Email address`}),(0,P.jsx)(J,{type:`email`,id:`email`,placeholder:`name@example.com`})]}),(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(q,{children:`Framework`}),(0,P.jsxs)(Ua,{children:[(0,P.jsx)(Ga,{children:(0,P.jsx)(Wa,{placeholder:`Select framework`})}),(0,P.jsxs)(Ja,{children:[(0,P.jsx)(Y,{value:`react`,children:`React`}),(0,P.jsx)(Y,{value:`vue`,children:`Vue`}),(0,P.jsx)(Y,{value:`svelte`,children:`Svelte`})]})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center space-x-2`,children:[(0,P.jsx)(Oa,{id:`airplane-mode`}),(0,P.jsx)(q,{htmlFor:`airplane-mode`,children:`Airplane Mode`})]})]})})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Tabs`}),(0,P.jsxs)(Za,{defaultValue:`account`,className:`w-[400px]`,children:[(0,P.jsxs)(Qa,{children:[(0,P.jsx)($a,{value:`account`,children:`Account`}),(0,P.jsx)($a,{value:`password`,children:`Password`})]}),(0,P.jsx)(eo,{value:`account`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Account`}),(0,P.jsx)(B,{children:`Make changes to your account here.`})]}),(0,P.jsx)(V,{className:`space-y-2`,children:(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{htmlFor:`name`,children:`Name`}),(0,P.jsx)(J,{id:`name`,defaultValue:`Pedro Duarte`})]})}),(0,P.jsx)(Ci,{children:(0,P.jsx)(I,{children:`Save changes`})})]})}),(0,P.jsx)(eo,{value:`password`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Password`}),(0,P.jsx)(B,{children:`Change your password here.`})]}),(0,P.jsx)(V,{className:`space-y-2`,children:(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{htmlFor:`current`,children:`Current password`}),(0,P.jsx)(J,{id:`current`,type:`password`})]})}),(0,P.jsx)(Ci,{children:(0,P.jsx)(I,{children:`Save password`})})]})})]})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Feedback & Status`}),(0,P.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsx)(`h3`,{className:`text-sm font-medium text-muted-foreground`,children:`Empty State`}),(0,P.jsx)(`div`,{className:`border rounded-lg p-4`,children:(0,P.jsx)(oa,{icon:tt,title:`No items found`,description:`You haven't created any items yet.`,action:{label:`Create Item`,onClick:()=>w(`Clicked create`)},className:`min-h-[200px]`})})]}),(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsx)(`h3`,{className:`text-sm font-medium text-muted-foreground`,children:`Skeleton Loading`}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(K,{className:`h-5 w-[140px] mb-2`}),(0,P.jsx)(K,{className:`h-4 w-[250px]`})]}),(0,P.jsxs)(V,{className:`space-y-2`,children:[(0,P.jsx)(K,{className:`h-4 w-full`}),(0,P.jsx)(K,{className:`h-4 w-full`}),(0,P.jsx)(K,{className:`h-4 w-3/4`})]})]})]})]})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Toast Notifications`}),(0,P.jsxs)(`div`,{className:`flex flex-wrap gap-4`,children:[(0,P.jsx)(I,{variant:`outline`,onClick:()=>w(`Event has been created`),children:`Simple Toast`}),(0,P.jsx)(I,{variant:`outline`,onClick:()=>w.success(`Event created successfully`),children:`Success`}),(0,P.jsx)(I,{variant:`outline`,onClick:()=>w.error(`Failed to create event`),children:`Error`}),(0,P.jsx)(I,{variant:`outline`,onClick:()=>w.info(`New updates available`,{description:`Refresh to see changes`}),children:`With Description`}),(0,P.jsx)(I,{variant:`outline`,onClick:()=>w(`Event deleted`,{action:{label:`Undo`,onClick:()=>console.log(`Undo`)}}),children:`With Action`})]})]}),(0,P.jsxs)(`section`,{className:`space-y-4`,children:[(0,P.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Breadcrumbs`}),(0,P.jsx)(`div`,{className:`p-4 border rounded-lg`,children:(0,P.jsx)(Ri,{children:(0,P.jsxs)(zi,{children:[(0,P.jsx)(Bi,{children:(0,P.jsx)(Vi,{href:`/`,children:`Dashboard`})}),`              `,(0,P.jsx)(Ui,{}),(0,P.jsx)(Bi,{children:(0,P.jsx)(Vi,{href:`/components`,children:`Components`})}),(0,P.jsx)(Ui,{}),(0,P.jsx)(Bi,{children:(0,P.jsx)(Hi,{children:`Breadcrumb`})})]})})})]})]})}const ro=D(`/`)({component:io});function io(){let e=_n(),t=O({queryKey:F.session(),queryFn:Rn,retry:!1,staleTime:3e4});return(0,j.useEffect)(()=>{t.isLoading||(t.data?.authenticated?e({to:`/dashboard/deployments`,replace:!0}):e({to:`/status`,replace:!0}))},[t.data?.authenticated,t.isLoading,e]),null}const ao=D(`/dashboard/`)({component:oo});function oo(){let e=_n();return(0,j.useEffect)(()=>{e({to:`/dashboard/deployments`,replace:!0})},[e]),null}const so=D(`/admin/`)({component:co});function co(){let e=_n();return(0,j.useEffect)(()=>{e({to:`/admin/settings`,replace:!0})},[e]),null}const lo=D(`/dashboard/s3`)({component:uo});function uo(){let e=O({queryKey:F.workspaces(),queryFn:Bn,staleTime:3e4}),t=(0,j.useMemo)(()=>e.data?.workspaces?.[0]?.id??``,[e.data?.workspaces]),n=O({queryKey:F.workspaceArtifacts(t),queryFn:async()=>br(t),staleTime:1e4,enabled:!!t}),r=n.data?.items??[];return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`S3`}),(0,P.jsx)(B,{children:`Workspace artifacts and generated files (backed by the platform object store).`})]})}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-0`,children:e.isLoading||n.isLoading?(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(K,{className:`h-12 w-full`}),(0,P.jsx)(K,{className:`h-12 w-full`}),(0,P.jsx)(K,{className:`h-12 w-full`})]}):e.isError||n.isError?(0,P.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to list objects.`}):r.length===0?(0,P.jsx)(oa,{icon:tt,title:`No objects found`,description:`No artifacts found for this workspace.`}):(0,P.jsxs)(`div`,{children:[(0,P.jsxs)(`div`,{className:`p-4 border-b flex items-center gap-3`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Workspace`}),(0,P.jsxs)(Ua,{value:t,disabled:!0,children:[(0,P.jsx)(Ga,{className:`w-[280px]`,children:(0,P.jsx)(Wa,{placeholder:`Select workspace`})}),(0,P.jsx)(Ja,{children:(e.data?.workspaces??[]).map(e=>(0,P.jsxs)(Y,{value:e.id,children:[e.name,` (`,e.slug,`)`]},e.id))})]})]}),(0,P.jsxs)(ta,{children:[(0,P.jsx)(na,{children:(0,P.jsxs)(U,{children:[(0,P.jsx)(W,{children:`Object`}),(0,P.jsx)(W,{className:`w-[120px] text-right`,children:`Action`})]})}),(0,P.jsx)(ra,{children:r.map(e=>(0,P.jsxs)(U,{children:[(0,P.jsx)(G,{className:`font-mono text-xs`,children:e.key}),(0,P.jsx)(G,{className:`text-right`,children:(0,P.jsxs)(I,{variant:`outline`,size:`sm`,onClick:async()=>{let n=await xr(t,e.key),r=new Blob([Uint8Array.from(atob(n.fileData),e=>e.charCodeAt(0))]),i=URL.createObjectURL(r),a=document.createElement(`a`);a.href=i,a.download=e.key.split(`/`).pop()||`artifact`,document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(i)},children:[(0,P.jsx)(ft,{className:`mr-2 h-3 w-3`}),`Download`]})})]},e.key))})]})]})})})]})}var fo=An({tab:En([`tls`,`ssh`]).optional().catch(`tls`)});const po=D(`/dashboard/pki`)({validateSearch:e=>fo.parse(e),loaderDeps:({search:{tab:e}})=>({tab:e}),loader:async({context:{queryClient:e}})=>{await Promise.all([e.ensureQueryData({queryKey:F.pkiRoot(),queryFn:Sr,staleTime:6e4}),e.ensureQueryData({queryKey:F.pkiSshRoot(),queryFn:Cr,staleTime:6e4}),e.ensureQueryData({queryKey:F.pkiCerts(),queryFn:wr,staleTime:15e3}),e.ensureQueryData({queryKey:F.pkiSshCerts(),queryFn:Tr,staleTime:15e3})])},component:mo});function mo(){let e=E(),t=po.useNavigate(),{tab:r}=po.useSearch(),i=O({queryKey:F.pkiRoot(),queryFn:Sr,staleTime:6e4}),a=O({queryKey:F.pkiSshRoot(),queryFn:Cr,staleTime:6e4}),o=O({queryKey:F.pkiCerts(),queryFn:wr,staleTime:15e3}),s=O({queryKey:F.pkiSshCerts(),queryFn:Tr,staleTime:15e3}),[c,l]=(0,j.useState)(``),[u,d]=(0,j.useState)(``),f=e=>{t({search:t=>({...t,tab:e}),replace:!0})},p=k({mutationFn:async()=>{let e=c.trim();if(!e)throw Error(`Common name is required`);return Er({commonName:e})},onSuccess:async()=>{l(``),w.success(`TLS Certificate Issued`,{description:`Download ready.`}),await e.invalidateQueries({queryKey:F.pkiCerts()})},onError:e=>{w.error(`Failed to issue TLS certificate`,{description:e.message})}}),m=k({mutationFn:async()=>{let e=u.split(/[,\s]+/g).map(e=>e.trim()).filter(Boolean);if(e.length===0)throw Error(`At least one principal is required`);return Dr({principals:e})},onSuccess:async()=>{d(``),w.success(`SSH Certificate Issued`,{description:`Download ready.`}),await e.invalidateQueries({queryKey:F.pkiSshCerts()})},onError:e=>{w.error(`Failed to issue SSH certificate`,{description:e.message})}}),h=o.data?.certs??[],ee=s.data?.certs??[],g=(0,j.useMemo)(()=>a.data?.publicKey??``,[a.data?.publicKey]),_=(0,j.useMemo)(()=>i.data?.pem??``,[i.data?.pem]);return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(`div`,{className:`p-2 rounded-full bg-primary/10`,children:(0,P.jsx)(De,{className:`h-6 w-6 text-primary`})}),(0,P.jsxs)(`div`,{children:[(0,P.jsx)(z,{children:`PKI Management`}),(0,P.jsx)(B,{children:`Issue and manage TLS and SSH certificates signed by Skyforge.`})]})]})})}),(0,P.jsxs)(Za,{value:r,onValueChange:f,className:`space-y-6`,children:[(0,P.jsx)(`div`,{className:`flex items-center justify-between`,children:(0,P.jsxs)(Qa,{children:[(0,P.jsxs)($a,{value:`tls`,className:`gap-2`,children:[(0,P.jsx)(n,{className:`h-4 w-4`}),`TLS Certificates`]}),(0,P.jsxs)($a,{value:`ssh`,className:`gap-2`,children:[(0,P.jsx)(Ye,{className:`h-4 w-4`}),`SSH Certificates`]})]})}),(0,P.jsxs)(eo,{value:`tls`,className:`space-y-6 animate-in fade-in-50 duration-300`,children:[(0,P.jsxs)(`div`,{className:`grid gap-6 lg:grid-cols-2`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{className:`text-sm`,children:`CA Root Certificate`}),(0,P.jsx)(B,{children:`Trust this PEM for Skyforge-issued TLS certs.`})]}),(0,P.jsxs)(V,{children:[i.isLoading?(0,P.jsx)(K,{className:`h-40 w-full`}):(0,P.jsx)(`textarea`,{className:`h-40 w-full rounded-md border bg-muted p-2 font-mono text-[10px] text-muted-foreground focus:outline-none`,readOnly:!0,value:_}),i.isError&&(0,P.jsx)(`div`,{className:`mt-2 text-xs text-destructive`,children:`Failed to load CA root.`})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{className:`text-sm`,children:`Issue New TLS Certificate`}),(0,P.jsx)(B,{children:`Create a short-lived certificate for internal services.`})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`grid gap-2`,children:[(0,P.jsx)(q,{htmlFor:`common-name`,children:`Common name (CN)`}),(0,P.jsx)(J,{id:`common-name`,value:c,onChange:e=>l(e.target.value),placeholder:`e.g. service.internal`})]}),(0,P.jsxs)(I,{className:`w-full`,disabled:p.isPending,onClick:()=>p.mutate(),children:[p.isPending&&(0,P.jsx)(Fe,{className:`mr-2 h-4 w-4 animate-spin`}),p.isPending?`Generating…`:`Issue Certificate`]})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Issued TLS Certificates`})}),(0,P.jsxs)(V,{className:`p-0`,children:[o.isLoading?(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(K,{className:`h-10 w-full`}),(0,P.jsx)(K,{className:`h-10 w-full`})]}):h.length===0?(0,P.jsx)(oa,{icon:tt,title:`No TLS certificates`,description:`You haven't issued any TLS certificates yet.`}):(0,P.jsx)(Da,{className:`border-none`,children:(0,P.jsxs)(ta,{children:[(0,P.jsx)(na,{children:(0,P.jsxs)(U,{children:[(0,P.jsx)(W,{children:`Common Name`}),(0,P.jsx)(W,{children:`Expires`}),(0,P.jsx)(W,{className:`text-right`,children:`Action`})]})}),(0,P.jsx)(ra,{children:h.map(e=>(0,P.jsxs)(U,{children:[(0,P.jsx)(G,{className:`font-medium`,children:e.commonName}),(0,P.jsx)(G,{className:`text-muted-foreground text-xs`,children:e.expiresAt}),(0,P.jsx)(G,{className:`text-right`,children:(0,P.jsx)(I,{variant:`ghost`,size:`sm`,asChild:!0,children:(0,P.jsxs)(`a`,{href:`${Fn}/pki/certs/${encodeURIComponent(e.id)}/download`,target:`_blank`,rel:`noreferrer`,children:[(0,P.jsx)(ft,{className:`mr-2 h-3 w-3`}),`Download Bundle`]})})})]},e.id))})]})}),o.isError&&(0,P.jsx)(`div`,{className:`p-4 text-center text-xs text-destructive`,children:`Failed to list certs.`})]})]})]}),(0,P.jsxs)(eo,{value:`ssh`,className:`space-y-6 animate-in fade-in-50 duration-300`,children:[(0,P.jsxs)(`div`,{className:`grid gap-6 lg:grid-cols-2`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{className:`text-sm`,children:`SSH CA Public Key`}),(0,P.jsx)(B,{children:`Trust this key for Skyforge-issued SSH certs.`})]}),(0,P.jsxs)(V,{children:[a.isLoading?(0,P.jsx)(K,{className:`h-40 w-full`}):(0,P.jsx)(`textarea`,{className:`h-40 w-full rounded-md border bg-muted p-2 font-mono text-[10px] text-muted-foreground focus:outline-none`,readOnly:!0,value:g}),a.isError&&(0,P.jsx)(`div`,{className:`mt-2 text-xs text-destructive`,children:`Failed to load SSH CA key.`})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{className:`text-sm`,children:`Issue New SSH Certificate`}),(0,P.jsx)(B,{children:`Authorize keys for specific principals.`})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`grid gap-2`,children:[(0,P.jsx)(q,{htmlFor:`principals`,children:`Principals (comma separated)`}),(0,P.jsx)(J,{id:`principals`,value:u,onChange:e=>d(e.target.value),placeholder:`e.g. root, ubuntu, admin`})]}),(0,P.jsxs)(I,{className:`w-full`,disabled:m.isPending,onClick:()=>m.mutate(),children:[m.isPending&&(0,P.jsx)(Fe,{className:`mr-2 h-4 w-4 animate-spin`}),m.isPending?`Generating…`:`Issue Certificate`]})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Issued SSH Certificates`})}),(0,P.jsxs)(V,{className:`p-0`,children:[s.isLoading?(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(K,{className:`h-10 w-full`}),(0,P.jsx)(K,{className:`h-10 w-full`})]}):ee.length===0?(0,P.jsx)(oa,{icon:tt,title:`No SSH certificates`,description:`You haven't issued any SSH certificates yet.`}):(0,P.jsx)(Da,{className:`border-none`,children:(0,P.jsxs)(ta,{children:[(0,P.jsx)(na,{children:(0,P.jsxs)(U,{children:[(0,P.jsx)(W,{children:`Principals`}),(0,P.jsx)(W,{children:`Expires`}),(0,P.jsx)(W,{className:`text-right`,children:`Action`})]})}),(0,P.jsx)(ra,{children:ee.map(e=>(0,P.jsxs)(U,{children:[(0,P.jsx)(G,{className:`font-medium`,children:e.principals.map(e=>(0,P.jsx)(`span`,{className:`inline-flex items-center rounded-md bg-muted px-2 py-1 text-xs font-medium text-muted-foreground mr-1`,children:e},e))}),(0,P.jsx)(G,{className:`text-muted-foreground text-xs`,children:e.expiresAt}),(0,P.jsx)(G,{className:`text-right`,children:(0,P.jsx)(I,{variant:`ghost`,size:`sm`,asChild:!0,children:(0,P.jsxs)(`a`,{href:`${Fn}/pki/ssh/certs/${encodeURIComponent(e.id)}/download`,target:`_blank`,rel:`noreferrer`,children:[(0,P.jsx)(ft,{className:`mr-2 h-3 w-3`}),`Download Bundle`]})})})]},e.id))})]})}),s.isError&&(0,P.jsx)(`div`,{className:`p-4 text-center text-xs text-destructive`,children:`Failed to list SSH certs.`})]})]})]})]})]})}const ho=D(`/dashboard/forward`)({component:go});function go(){let e=E(),t=O({queryKey:F.userForwardCollector(),queryFn:fr}),n=O({queryKey:F.userCollectorRuntime(),queryFn:gr,enabled:!!t.data?.authorizationKey,refetchInterval:5e3}),[r,i]=(0,j.useState)(!1),a=O({queryKey:F.userCollectorLogs(),queryFn:async()=>_r(300),enabled:r&&!!t.data?.authorizationKey,refetchInterval:r?3e3:!1}),o=t.data,s=n.data?.runtime??o?.runtime,[c,l]=(0,j.useState)(`cloud`),[u,d]=(0,j.useState)(``),[f,p]=(0,j.useState)(!1),[m,h]=(0,j.useState)(``),[ee,g]=(0,j.useState)(``);(0,j.useEffect)(()=>{if(!o)return;let e=(o.baseUrl??`https://fwd.app`).trim();e&&e!==`https://fwd.app`?(l(`onprem`),d(e.replace(/^https?:\/\//,``)),p(o.skipTlsVerify??!0)):(l(`cloud`),d(``),p(o.skipTlsVerify??!1)),h(o.username??``)},[o]);let _=k({mutationFn:async()=>pr({baseUrl:c===`cloud`?`https://fwd.app`:u.trim(),skipTlsVerify:c===`onprem`?f:!1,username:m,password:ee}),onSuccess:async()=>{w.success(`Collector configured`),g(``),await e.invalidateQueries({queryKey:F.userForwardCollector()})},onError:e=>w.error(`Failed to save Forward collector`,{description:e.message})}),v=k({mutationFn:mr,onSuccess:async()=>{w.success(`Collector reset requested`),await e.invalidateQueries({queryKey:F.userForwardCollector()})},onError:e=>w.error(`Failed to reset collector`,{description:e.message})}),y=k({mutationFn:async()=>{await hr()},onSuccess:async()=>{w.success(`Forward collector cleared`),await e.invalidateQueries({queryKey:F.userForwardCollector()})},onError:e=>w.error(`Failed to clear collector`,{description:e.message})}),b=k({mutationFn:vr,onSuccess:async()=>{w.success(`Collector restarted`,{description:`Pulling latest image (if available)...`}),await e.invalidateQueries({queryKey:F.userCollectorRuntime()})},onError:e=>w.error(`Failed to restart collector`,{description:e.message})}),x=(o?.authorizationKey??``).trim(),S=!!s?.ready,te=(a.data?.logs??``).trim();return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsxs)(`div`,{className:`border-b pb-6`,children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Collector`}),(0,P.jsxs)(`p`,{className:`text-sm text-muted-foreground`,children:[`Stores your Forward credentials and provisions a per-user collector named `,(0,P.jsxs)(`span`,{className:`font-mono`,children:[`skyforge-`,`{user}`]}),`.`]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Collector status`}),(0,P.jsx)(B,{children:`Runs as a per-user Deployment inside the cluster.`})]}),(0,P.jsxs)(V,{className:`space-y-3`,children:[t.isLoading?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading…`}):t.isError?(0,P.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load Forward collector settings.`}):x?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Collector: `,(0,P.jsx)(`span`,{className:`font-mono`,children:o?.collectorUsername??``}),` (`,o?.collectorId??``,`)`]}),(0,P.jsxs)(`div`,{className:`text-sm`,children:[`Status:`,` `,(0,P.jsx)(`span`,{className:S?`text-emerald-600`:`text-muted-foreground`,children:S?`Running`:`Starting…`})]}),s?.podName?(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Pod: `,(0,P.jsx)(`span`,{className:`font-mono`,children:String(s.podName)}),` (`,String(s.podPhase??``),`)`]}):null,s?.image?(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Image: `,(0,P.jsx)(`span`,{className:`font-mono`,children:String(s.image)})]}):null,s?.updateStatus?(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Update check:`,` `,(0,P.jsxs)(`span`,{className:`font-mono`,children:[String(s.updateStatus),s.updateAvailable?` (update available)`:``]})]}):null,(0,P.jsxs)(`div`,{className:`pt-2 space-y-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Logs`}),(0,P.jsx)(I,{variant:`outline`,size:`sm`,onClick:()=>i(e=>!e),children:r?`Hide`:`Show`})]}),r?(0,P.jsx)(`pre`,{className:`bg-muted p-3 rounded-md overflow-auto font-mono text-xs whitespace-pre-wrap`,children:a.isLoading?`Loading…`:te||`No logs yet.`}):null]})]}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Not configured yet.`}),(0,P.jsxs)(`div`,{className:`flex gap-2`,children:[(0,P.jsx)(I,{variant:`outline`,disabled:!x||b.isPending,onClick:()=>b.mutate(),children:b.isPending?`Restarting…`:`Restart (pull latest)`}),(0,P.jsx)(I,{variant:`outline`,disabled:!x||v.isPending,onClick:()=>v.mutate(),children:v.isPending?`Resetting…`:`Reset collector`}),(0,P.jsx)(I,{variant:`destructive`,disabled:!x||y.isPending,onClick:()=>{window.confirm(`Deprovision collector? This deletes your stored Forward credentials and removes the in-cluster collector deployment.`)&&y.mutate()},children:y.isPending?`Deprovisioning…`:`Deprovision`})]})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Forward credentials`}),(0,P.jsx)(B,{children:`Used to create your per-user collector token in Forward.`})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`grid gap-2`,children:[(0,P.jsx)(q,{children:`Forward target`}),(0,P.jsxs)(`div`,{className:`grid gap-2`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`input`,{id:`forward-cloud`,type:`radio`,name:`forward-target`,className:`h-4 w-4`,checked:c===`cloud`,onChange:()=>l(`cloud`)}),(0,P.jsx)(q,{htmlFor:`forward-cloud`,children:`Forward Cloud (https://fwd.app)`})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`input`,{id:`forward-onprem`,type:`radio`,name:`forward-target`,className:`h-4 w-4`,checked:c===`onprem`,onChange:()=>l(`onprem`)}),(0,P.jsx)(q,{htmlFor:`forward-onprem`,children:`On-prem (enter IP/DNS)`})]})]}),c===`onprem`?(0,P.jsxs)(`div`,{className:`space-y-2 pt-2`,children:[(0,P.jsxs)(`div`,{className:`grid gap-2`,children:[(0,P.jsx)(q,{children:`On-prem host`}),(0,P.jsx)(J,{value:u,onChange:e=>d(e.target.value),placeholder:`10.0.0.10 or forward.example.com`}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Skyforge assumes `,(0,P.jsx)(`span`,{className:`font-mono`,children:`https://`}),` unless you include a scheme.`]})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(Aa,{checked:f,onCheckedChange:e=>p(!!e),id:`forward-skip-tls`}),(0,P.jsx)(q,{htmlFor:`forward-skip-tls`,children:`Skip TLS verification (default)`})]})]}):null]}),(0,P.jsxs)(`div`,{className:`grid gap-2`,children:[(0,P.jsx)(q,{children:`Forward username`}),(0,P.jsx)(J,{value:m,onChange:e=>h(e.target.value),placeholder:`you@company.com`})]}),(0,P.jsxs)(`div`,{className:`grid gap-2`,children:[(0,P.jsx)(q,{children:`Forward password`}),(0,P.jsx)(J,{value:ee,onChange:e=>g(e.target.value),type:`password`,placeholder:`••••••••`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Leave blank to keep existing password.`})]}),(0,P.jsx)(`div`,{className:`flex justify-end`,children:(0,P.jsx)(I,{disabled:_.isPending,onClick:()=>_.mutate(),children:_.isPending?`Saving…`:`Save`})})]})]})]})}const _o=D(`/admin/settings`)({component:vo});function vo(){let e=!!E().getQueryData(F.session())?.isAdmin;return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`System settings`}),(0,P.jsx)(B,{children:`Admin-only settings for Skyforge.`})]})}),!e&&(0,P.jsx)(L,{variant:`danger`,children:(0,P.jsx)(V,{className:`pt-6`,children:(0,P.jsx)(`div`,{className:`text-center font-medium`,children:`Admin access required.`})})}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`pt-6`,children:(0,P.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`This build uses Server-Sent Events (SSE) for live updates; polling configuration has been removed.`})})})]})}var yo=An({q:A().optional().catch(``),tab:En([`resources`,`costs`,`usage`]).optional().catch(`resources`)});const bo=D(`/admin/governance`)({validateSearch:e=>yo.parse(e),loaderDeps:({search:{q:e,tab:t}})=>({q:e,tab:t}),loader:async({context:{queryClient:e}})=>{(await e.ensureQueryData({queryKey:F.session(),queryFn:Rn,staleTime:3e4,retry:!1}))?.isAdmin&&await Promise.all([e.ensureQueryData({queryKey:F.governanceSummary(),queryFn:jr}),e.ensureQueryData({queryKey:F.governanceResources(`500`),queryFn:()=>Mr({limit:`500`})}),e.ensureQueryData({queryKey:F.governanceCosts(`50`),queryFn:()=>Nr({limit:`50`})}),e.ensureQueryData({queryKey:F.governanceUsage(`50`),queryFn:()=>Pr({limit:`50`})})])},component:xo});function xo(){let e=E(),t=bo.useNavigate(),{q:n,tab:r}=bo.useSearch(),i=!!O({queryKey:F.session(),queryFn:Rn,staleTime:3e4,retry:!1}).data?.isAdmin,a=O({queryKey:F.governanceSummary(),queryFn:jr,staleTime:3e4,enabled:i}),o=O({queryKey:F.governanceResources(`500`),queryFn:()=>Mr({limit:`500`}),staleTime:3e4,enabled:i}),s=O({queryKey:F.governanceCosts(`50`),queryFn:()=>Nr({limit:`50`}),staleTime:3e4,enabled:i}),c=O({queryKey:F.governanceUsage(`50`),queryFn:()=>Pr({limit:`50`}),staleTime:3e4,enabled:i}),l=(0,j.useMemo)(()=>{let e=o.data?.resources??[],t=n?.trim().toLowerCase()||``;return t?e.filter(e=>[e.name,e.resourceId,e.resourceType,e.workspaceName,e.owner,e.provider].filter(Boolean).join(` `).toLowerCase().includes(t)):e},[o.data?.resources,n]),u=k({mutationFn:async()=>{await Fr()},onSuccess:async()=>{w.success(`Governance sources synced`,{description:`Resource inventory updated.`}),await Promise.all([e.invalidateQueries({queryKey:F.governanceSummary()}),e.invalidateQueries({queryKey:F.governanceResources(`500`)}),e.invalidateQueries({queryKey:F.governanceCosts(`50`)}),e.invalidateQueries({queryKey:F.governanceUsage(`50`)})])},onError:e=>{w.error(`Failed to sync governance sources`,{description:e.message})}}),d=a.data,f=e=>{t({search:t=>({...t,q:e}),replace:!0})};return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(z,{children:`Governance`}),(0,P.jsx)(B,{children:`Admin-only inventory, cost, and usage telemetry.`})]}),(0,P.jsxs)(I,{variant:`outline`,size:`sm`,disabled:u.isPending||!i,onClick:()=>u.mutate(),children:[(0,P.jsx)(Re,{className:`mr-2 h-4 w-4 ${u.isPending?`animate-spin`:``}`}),u.isPending?`Syncing…`:`Sync sources`]})]})})}),!i&&(0,P.jsx)(L,{variant:`danger`,children:(0,P.jsx)(V,{className:`pt-6`,children:(0,P.jsx)(`div`,{className:`text-center font-medium text-destructive`,children:`Admin access required.`})})}),(a.isError||o.isError||s.isError||c.isError)&&(0,P.jsx)(L,{variant:`danger`,children:(0,P.jsx)(V,{className:`pt-6`,children:(0,P.jsx)(`div`,{className:`text-center font-medium`,children:`Failed to load governance data.`})})}),a.isLoading?(0,P.jsx)(ga,{children:[1,2,3,4].map(e=>(0,P.jsxs)(_a,{className:`h-32`,children:[(0,P.jsx)(K,{className:`h-4 w-24 mb-4`}),(0,P.jsx)(K,{className:`h-8 w-16`})]},e))}):(0,P.jsxs)(ga,{children:[(0,P.jsx)(va,{title:`Resources tracked`,value:String(d?.resourceCount??`—`),icon:(0,P.jsx)(tn,{className:`h-5 w-5`}),gradient:`blue`}),(0,P.jsx)(va,{title:`Active resources`,value:String(d?.activeResources??`—`),icon:(0,P.jsx)(v,{className:`h-5 w-5`}),gradient:`green`}),(0,P.jsx)(va,{title:`Workspaces tracked`,value:String(d?.workspacesTracked??`—`),icon:(0,P.jsx)(Wt,{className:`h-5 w-5`}),gradient:`purple`}),(0,P.jsx)(va,{title:`Last 30d spend`,value:d?`${d.costLast30Days} ${d.costCurrency}`:`—`,icon:(0,P.jsx)(Ke,{className:`h-5 w-5`}),gradient:`orange`})]}),(0,P.jsxs)(Za,{value:r,onValueChange:e=>{t({search:t=>({...t,tab:e}),replace:!0})},className:`space-y-6`,children:[(0,P.jsxs)(Qa,{children:[(0,P.jsxs)($a,{value:`resources`,className:`gap-2`,children:[(0,P.jsx)(tn,{className:`h-4 w-4`}),`Resources`]}),(0,P.jsxs)($a,{value:`costs`,className:`gap-2`,children:[(0,P.jsx)(dn,{className:`h-4 w-4`}),`Financials`]}),(0,P.jsxs)($a,{value:`usage`,className:`gap-2`,children:[(0,P.jsx)(wt,{className:`h-4 w-4`}),`Telemetry`]})]}),(0,P.jsx)(eo,{value:`resources`,className:`space-y-6 animate-in fade-in-50`,children:(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,P.jsx)(z,{children:`Resource Inventory`}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(`div`,{className:`relative`,children:[(0,P.jsx)(te,{className:`absolute left-2 top-2.5 h-4 w-4 text-muted-foreground`}),(0,P.jsx)(J,{className:`pl-8 w-full sm:w-[300px]`,placeholder:`Search resources…`,value:n||``,onChange:e=>f(e.target.value)})]}),!o.isLoading&&(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground whitespace-nowrap hidden sm:block`,children:[l.length,` shown`]})]})]})}),(0,P.jsx)(V,{children:o.isLoading?(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsx)(K,{className:`h-10 w-full`}),(0,P.jsx)(K,{className:`h-10 w-full`}),(0,P.jsx)(K,{className:`h-10 w-full`})]}):l.length===0?(0,P.jsx)(oa,{icon:tt,title:`No resources found`,description:`No resources match your search criteria.`}):(0,P.jsxs)(ta,{children:[(0,P.jsx)(na,{children:(0,P.jsxs)(U,{children:[(0,P.jsx)(W,{children:`Name`}),(0,P.jsx)(W,{children:`Provider`}),(0,P.jsx)(W,{children:`Type`}),(0,P.jsx)(W,{children:`Workspace`}),(0,P.jsx)(W,{children:`Owner`}),(0,P.jsx)(W,{children:`Status`})]})}),(0,P.jsx)(ra,{children:l.slice(0,500).map(e=>(0,P.jsxs)(U,{children:[(0,P.jsx)(G,{className:`font-medium`,children:e.name}),(0,P.jsx)(G,{children:e.provider}),(0,P.jsx)(G,{children:e.resourceType}),(0,P.jsx)(G,{children:e.workspaceName}),(0,P.jsx)(G,{children:e.owner}),(0,P.jsx)(G,{children:(0,P.jsx)(ma,{variant:e.status===`active`?`default`:`secondary`,children:e.status??`unknown`})})]},e.resourceId))})]})})]})}),(0,P.jsx)(eo,{value:`costs`,className:`space-y-6 animate-in fade-in-50`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Cost Snapshots`}),(0,P.jsx)(B,{children:`Historical spend data per provider.`})]}),(0,P.jsx)(V,{children:s.isLoading?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(K,{className:`h-12 w-full`}),(0,P.jsx)(K,{className:`h-12 w-full`})]}):(s.data?.costs??[]).length===0?(0,P.jsx)(oa,{icon:dn,title:`No cost data`,description:`No financial snapshots available.`}):(0,P.jsxs)(ta,{children:[(0,P.jsx)(na,{children:(0,P.jsxs)(U,{children:[(0,P.jsx)(W,{children:`Provider`}),(0,P.jsx)(W,{children:`Currency`}),(0,P.jsx)(W,{children:`Amount`}),(0,P.jsx)(W,{className:`text-right`,children:`Period End`})]})}),(0,P.jsx)(ra,{children:(s.data?.costs??[]).slice(0,50).map((e,t)=>(0,P.jsxs)(U,{children:[(0,P.jsx)(G,{className:`font-medium`,children:e.provider}),(0,P.jsx)(G,{children:e.currency}),(0,P.jsx)(G,{children:e.amount}),(0,P.jsx)(G,{className:`text-right text-muted-foreground`,children:e.periodEnd})]},t))})]})})]})}),(0,P.jsx)(eo,{value:`usage`,className:`space-y-6 animate-in fade-in-50`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Usage Telemetry`}),(0,P.jsx)(B,{children:`System usage metrics and limits.`})]}),(0,P.jsx)(V,{children:c.isLoading?(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(K,{className:`h-12 w-full`}),(0,P.jsx)(K,{className:`h-12 w-full`})]}):(c.data?.usage??[]).length===0?(0,P.jsx)(oa,{icon:wt,title:`No usage data`,description:`No telemetry snapshots available.`}):(0,P.jsxs)(ta,{children:[(0,P.jsx)(na,{children:(0,P.jsxs)(U,{children:[(0,P.jsx)(W,{children:`Provider`}),(0,P.jsx)(W,{children:`Metric`}),(0,P.jsx)(W,{children:`Value`}),(0,P.jsx)(W,{className:`text-right`,children:`Collected At`})]})}),(0,P.jsx)(ra,{children:(c.data?.usage??[]).slice(0,50).map((e,t)=>(0,P.jsxs)(U,{children:[(0,P.jsx)(G,{className:`font-medium`,children:e.provider}),(0,P.jsx)(G,{children:e.metric}),(0,P.jsx)(G,{children:e.value}),(0,P.jsx)(G,{className:`text-right text-muted-foreground`,children:e.collectedAt})]},t))})]})})]})})]})]})}function So(e,t){if(!t)return`none`;let n=String(e?.username??``).trim();return e?.isAdmin?`admin`:n?String(t.createdBy??``).toLowerCase()===n.toLowerCase()||(t.owners??[]).some(e=>String(e).toLowerCase()===n.toLowerCase())?`owner`:(t.editors??[]).some(e=>String(e).toLowerCase()===n.toLowerCase())?`editor`:(t.viewers??[]).some(e=>String(e).toLowerCase()===n.toLowerCase())||t.isPublic?`viewer`:`none`:`none`}function Co(e){return e===`admin`||e===`owner`||e===`editor`}function wo(e){return e===`admin`||e===`owner`}const To=D(`/dashboard/workspaces/`)({component:Eo});function Eo(){let e=O({queryKey:F.session(),queryFn:Rn,staleTime:3e4,retry:!1}),t=O({queryKey:F.workspaces(),queryFn:Bn}),n=t.data?.workspaces??[];return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between border-b pb-6`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Workspaces`}),(0,P.jsx)(`p`,{className:`text-muted-foreground text-sm`,children:`Create and configure workspaces.`})]}),(0,P.jsxs)(T,{to:`/dashboard/workspaces/new`,className:xi({variant:`default`}),children:[(0,P.jsx)(se,{className:`h-4 w-4 mr-2`}),`Create workspace`]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`All workspaces`}),(0,P.jsx)(B,{children:`Workspaces you can access.`})]}),(0,P.jsx)(V,{children:t.isLoading?(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsx)(K,{className:`h-10 w-full`}),(0,P.jsx)(K,{className:`h-10 w-full`}),(0,P.jsx)(K,{className:`h-10 w-full`})]}):t.isError?(0,P.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load workspaces.`}):n.length===0?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No workspaces yet.`}):(0,P.jsxs)(ta,{children:[(0,P.jsx)(na,{children:(0,P.jsxs)(U,{children:[(0,P.jsx)(W,{children:`Name`}),(0,P.jsx)(W,{children:`Slug`}),(0,P.jsx)(W,{children:`Visibility`}),(0,P.jsx)(W,{className:`text-right`,children:`Actions`})]})}),(0,P.jsx)(ra,{children:n.map(t=>(0,P.jsxs)(U,{children:[(0,P.jsx)(G,{className:`font-medium`,children:t.name}),(0,P.jsx)(G,{className:`text-muted-foreground`,children:t.slug}),(0,P.jsx)(G,{children:(0,P.jsx)(ma,{variant:t.isPublic?`default`:`secondary`,children:t.isPublic?`Public`:`Private`})}),(0,P.jsx)(G,{className:`text-right`,children:(0,P.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[(0,P.jsxs)(T,{to:`/dashboard/deployments`,search:{workspace:t.id},className:xi({variant:`outline`,size:`sm`}),children:[(0,P.jsx)(he,{className:`h-4 w-4 mr-2`}),`Deployments`]}),(0,P.jsxs)(T,{to:`/dashboard/workspaces/$workspaceId`,params:{workspaceId:t.id},className:xi({variant:`outline`,size:`sm`}),"aria-disabled":!Co(So(e.data,t)),tabIndex:Co(So(e.data,t))?0:-1,onClick:n=>{Co(So(e.data,t))||n.preventDefault()},children:[(0,P.jsx)(c,{className:`h-4 w-4 mr-2`}),`Settings`]})]})})]},t.id))})]})})]})]})}function Do(e){let t=E(),n=(0,j.useMemo)(()=>`${Fn}/dashboard/events`,[]);(0,j.useEffect)(()=>{if(!e)return;let r=Yi(n,{snapshot:e=>{try{let n=JSON.parse(e.data);t.setQueryData(F.dashboardSnapshot(),n)}catch{}}});return()=>{r.close()}},[e,t,n])}var Oo=An({workspace:A().optional().catch(``)});const ko=D(`/dashboard/deployments/`)({validateSearch:e=>Oo.parse(e),loaderDeps:({search:{workspace:e}})=>({workspace:e}),loader:async({context:{queryClient:e}})=>{await e.ensureQueryData({queryKey:F.workspaces(),queryFn:Bn,staleTime:3e4})},component:Ao});function Ao(){Do(!0);let e=_n(),t=E(),{workspace:n}=ko.useSearch(),r=O({queryKey:F.dashboardSnapshot(),queryFn:async()=>null,initialData:null,retry:!1,staleTime:1/0}),[a,o]=(0,j.useState)(null),[s,l]=(0,j.useState)(!1),u=O({queryKey:F.session(),queryFn:Rn,staleTime:3e4,retry:!1}),[d,f]=(0,j.useState)(``),[p,m]=(0,j.useState)(`all`),[h,g]=(0,j.useState)(`all`),[_,y]=(0,j.useState)(!0),b=r.data?.workspaces??[],x=(0,j.useMemo)(()=>n&&b.some(e=>e.id===n)?n:b[0]?.id??``,[n,b]),S=(0,j.useMemo)(()=>b.find(e=>e.id===x)??null,[b,x]),ne=(0,j.useMemo)(()=>Co(So(u.data,S)),[u.data,S]),re=t=>{e({search:{workspace:t},replace:!0})},ie=(0,j.useMemo)(()=>{let e=r.data?.deployments??[];return x?e.filter(e=>e.workspaceId===x):e},[x,r.data?.deployments]),ae=(0,j.useMemo)(()=>ie.filter(e=>{if(d&&!e.name.toLowerCase().includes(d.toLowerCase()))return!1;if(p!==`all`){let t=(e.activeTaskStatus??e.lastStatus??`unknown`).toLowerCase();if(p===`running`&&![`running`,`active`,`healthy`].includes(t)||p===`stopped`&&![`created`,`stopped`,`success`,`succeeded`].includes(t)||p===`failed`&&![`failed`,`error`,`crashloopbackoff`].includes(t))return!1}return!(h!==`all`&&(h===`netlab`&&!e.type.startsWith(`netlab`)||h===`containerlab`&&![`containerlab`,`clabernetes`].includes(e.type)||h===`terraform`&&e.type!==`terraform`))}),[ie,d,p,h]),oe=(0,j.useMemo)(()=>{let e=r.data?.runs??[];return x?e.filter(e=>String(e.workspaceId??``)===x):e},[x,r.data?.runs]),ce=In(window.location.pathname+window.location.search),le=async e=>{try{await Ir(e.workspaceId,e.id),w.success(`Deployment starting`,{description:`${e.name} is queued to start.`})}catch(e){w.error(`Failed to start`,{description:e.message})}},ue=async e=>{try{await Lr(e.workspaceId,e.id),w.success(`Deployment stopping`,{description:`${e.name} is queued to stop.`})}catch(e){w.error(`Failed to stop`,{description:e.message})}},de=async()=>{if(a)try{await Rr(a.workspaceId,a.id),w.success(`Deployment deleted`,{description:`${a.name} has been removed.`}),await t.invalidateQueries({queryKey:F.dashboardSnapshot()}),l(!1),o(null)}catch(e){w.error(`Failed to delete`,{description:e.message})}},fe=e=>{switch(e){case`netlab`:return`Netlab (BYOS)`;case`netlab-c9s`:return`Netlab`;case`containerlab`:return`Containerlab (BYOS)`;case`clabernetes`:return`Containerlab`;default:return e}};return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between border-b pb-6`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Deployments`}),(0,P.jsx)(`p`,{className:`text-muted-foreground text-sm`,children:`Manage deployments and monitor workspace activity.`})]}),(0,P.jsx)(`div`,{className:`flex items-center gap-3`,children:(0,P.jsxs)(`div`,{className:`flex items-center gap-2 bg-muted/50 p-1 rounded-lg border`,children:[(0,P.jsxs)(Ua,{value:x,onValueChange:re,disabled:b.length===0,children:[(0,P.jsx)(Ga,{className:`w-[200px] h-8 bg-transparent border-0 focus:ring-0 shadow-none`,children:(0,P.jsx)(Wa,{placeholder:`Select workspace`})}),(0,P.jsx)(Ja,{children:b.map(e=>(0,P.jsxs)(Y,{value:e.id,children:[e.name,` (`,e.slug,`)`]},e.id))})]}),(0,P.jsx)(`div`,{className:`h-4 w-px bg-border`}),(0,P.jsx)(T,{to:`/dashboard/workspaces/new`,title:`Create workspace`,className:xi({variant:`ghost`,size:`icon`,className:`h-8 w-8`}),children:(0,P.jsx)(se,{className:`h-4 w-4`})}),(0,P.jsx)(T,{to:`/dashboard/workspaces/$workspaceId`,params:{workspaceId:x},title:`Workspace Settings`,className:xi({variant:`ghost`,size:`icon`,className:`h-8 w-8`}),disabled:!x||!ne,children:(0,P.jsx)(c,{className:`h-4 w-4`})})]})})]}),!r.data&&(0,P.jsx)(L,{className:`border-dashed`,children:(0,P.jsx)(V,{className:`pt-6`,children:(0,P.jsxs)(`div`,{className:`flex flex-col items-center justify-center space-y-4 py-8`,children:[(0,P.jsx)(K,{className:`h-4 w-64`}),(0,P.jsxs)(`div`,{className:`text-center text-muted-foreground`,children:[`Waiting for platform stream…`,(0,P.jsxs)(`div`,{className:`mt-2 text-xs`,children:[`If you are logged out,`,` `,(0,P.jsx)(`a`,{className:`text-primary underline hover:no-underline`,href:ce,onClick:e=>{e.preventDefault(),(async()=>{if(!await Hr({loginHref:ce})){window.location.href=ce;return}await t.invalidateQueries({queryKey:F.session()})})()},children:`login`}),`.`]})]})]})})}),(0,P.jsxs)(`div`,{className:`flex flex-col lg:flex-row gap-6 relative items-start`,children:[(0,P.jsxs)(`div`,{className:`flex-1 min-w-0 space-y-4 w-full`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col sm:flex-row gap-3`,children:[(0,P.jsxs)(`div`,{className:`relative flex-1`,children:[(0,P.jsx)(te,{className:`absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground`}),(0,P.jsx)(J,{placeholder:`Search deployments...`,className:`pl-9`,value:d,onChange:e=>f(e.target.value)})]}),(0,P.jsxs)(Ua,{value:p,onValueChange:m,children:[(0,P.jsxs)(Ga,{className:`w-[140px]`,children:[(0,P.jsx)(it,{className:`mr-2 h-4 w-4 text-muted-foreground`}),(0,P.jsx)(Wa,{placeholder:`Status`})]}),(0,P.jsxs)(Ja,{children:[(0,P.jsx)(Y,{value:`all`,children:`All Status`}),(0,P.jsx)(Y,{value:`running`,children:`Running`}),(0,P.jsx)(Y,{value:`stopped`,children:`Stopped`}),(0,P.jsx)(Y,{value:`failed`,children:`Failed`})]})]}),(0,P.jsxs)(Ua,{value:h,onValueChange:g,children:[(0,P.jsxs)(Ga,{className:`w-[140px]`,children:[(0,P.jsx)(i,{className:`mr-2 h-4 w-4 text-muted-foreground`}),(0,P.jsx)(Wa,{placeholder:`Type`})]}),(0,P.jsxs)(Ja,{children:[(0,P.jsx)(Y,{value:`all`,children:`All Types`}),(0,P.jsx)(Y,{value:`netlab`,children:`Netlab`}),(0,P.jsx)(Y,{value:`containerlab`,children:`Containerlab`}),(0,P.jsx)(Y,{value:`terraform`,children:`Terraform`})]})]}),(0,P.jsxs)(T,{to:`/dashboard/deployments/new`,search:{workspace:x},className:xi({variant:`default`}),children:[(0,P.jsx)(se,{className:`mr-2 h-4 w-4`}),` Create`]})]}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-0`,children:r.data?ae.length===0?(0,P.jsx)(oa,{icon:tt,title:`No deployments found`,description:d||p!==`all`?`Try adjusting your filters.`:`You haven't created any deployments in this workspace yet.`,action:!d&&p===`all`?{label:`Create deployment`,onClick:()=>e({to:`/dashboard/deployments/new`,search:{workspace:x}})}:void 0}):(0,P.jsx)(Da,{className:`border-none`,children:(0,P.jsxs)(ta,{children:[(0,P.jsx)(na,{children:(0,P.jsxs)(U,{children:[(0,P.jsx)(W,{children:`Name`}),(0,P.jsx)(W,{children:`Type`}),(0,P.jsx)(W,{children:`Status`}),(0,P.jsx)(W,{className:`text-right`,children:`Actions`})]})}),(0,P.jsx)(ra,{children:ae.map(t=>(0,P.jsxs)(U,{children:[(0,P.jsx)(G,{className:`font-medium text-foreground`,children:(0,P.jsx)(T,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:t.id},className:`hover:underline flex items-center gap-2`,children:t.name})}),(0,P.jsx)(G,{className:`text-muted-foreground`,children:fe(t.type)}),(0,P.jsx)(G,{children:(0,P.jsx)(jo,{status:t.activeTaskStatus??t.lastStatus??`unknown`})}),(0,P.jsx)(G,{className:`text-right`,children:(0,P.jsxs)(Ur,{children:[(0,P.jsx)(Wr,{asChild:!0,children:(0,P.jsxs)(I,{variant:`ghost`,size:`icon`,className:`h-8 w-8`,children:[(0,P.jsx)(ht,{className:`h-4 w-4`}),(0,P.jsx)(`span`,{className:`sr-only`,children:`Open menu`})]})}),(0,P.jsxs)(qr,{align:`end`,children:[(0,P.jsx)(Zr,{children:`Actions`}),(0,P.jsxs)(Jr,{onClick:()=>e({to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:t.id}}),children:[(0,P.jsx)(qt,{className:`mr-2 h-4 w-4`}),`Details`]}),(0,P.jsx)(Qr,{}),(0,P.jsxs)(Jr,{onClick:()=>le(t),disabled:!!t.activeTaskId,children:[(0,P.jsx)(Ht,{className:`mr-2 h-4 w-4`}),`Start`]}),(0,P.jsxs)(Jr,{onClick:()=>ue(t),disabled:!t.activeTaskId,children:[(0,P.jsx)(ke,{className:`mr-2 h-4 w-4`}),`Stop`]}),(0,P.jsx)(Qr,{}),(0,P.jsxs)(Jr,{onClick:()=>{o(t),l(!0)},className:`text-destructive focus:text-destructive`,disabled:!!t.activeTaskId,children:[(0,P.jsx)(Se,{className:`mr-2 h-4 w-4`}),`Delete`]})]})]})})]},t.id))})]})}):(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(K,{className:`h-10 w-full`}),(0,P.jsx)(K,{className:`h-10 w-full`}),(0,P.jsx)(K,{className:`h-10 w-full`})]})})})]}),(0,P.jsxs)(`div`,{className:N(`transition-all duration-300 ease-in-out border-l space-y-4 shrink-0`,_?`w-full lg:w-80 xl:w-96 pl-6 opacity-100`:`w-0 lg:w-12 pl-0 opacity-100 border-none lg:border-l`),children:[(0,P.jsx)(`div`,{className:N(`flex items-center gap-2 h-[40px]`,!_&&`justify-center`),children:_?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(v,{className:`h-4 w-4 text-muted-foreground`}),(0,P.jsx)(`h3`,{className:`flex-1 text-sm font-semibold text-muted-foreground uppercase tracking-wider`,children:`Activity Feed`}),(0,P.jsx)(I,{variant:`ghost`,size:`icon`,className:`h-6 w-6 text-muted-foreground hover:text-foreground`,onClick:()=>y(!1),title:`Collapse feed`,children:(0,P.jsx)(Me,{className:`h-4 w-4`})})]}):(0,P.jsx)(I,{variant:`ghost`,size:`icon`,className:`h-8 w-8 text-muted-foreground hover:text-foreground`,onClick:()=>y(!0),title:`Expand activity feed`,children:(0,P.jsx)(ee,{className:`h-4 w-4`})})}),(0,P.jsx)(`div`,{className:N(`space-y-3`,!_&&`hidden`),children:r.data?oe.length===0?(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`p-6 text-center text-sm text-muted-foreground`,children:`No recent activity.`})}):(0,P.jsx)(`div`,{className:`space-y-3`,children:oe.slice(0,15).map(e=>([`success`,`failed`,`canceled`,`error`].includes(String(e.status??``).toLowerCase()),(0,P.jsx)(T,{to:`/dashboard/runs/$runId`,params:{runId:String(e.id??``)},className:`block group`,children:(0,P.jsx)(L,{className:`hover:border-primary/50 transition-colors`,children:(0,P.jsxs)(V,{className:`p-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-start justify-between gap-2`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col gap-1 min-w-0`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(`span`,{className:`font-mono text-xs font-medium text-foreground`,children:[`#`,String(e.id??``)]}),(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground truncate max-w-[120px]`,children:String(e.tpl_alias??e.type??`Run`)})]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground truncate`,children:String(e.message||`No message`)})]}),(0,P.jsx)(jo,{status:String(e.status??``),size:`xs`})]}),(0,P.jsxs)(`div`,{className:`mt-2 flex items-center justify-between text-[10px] text-muted-foreground`,children:[(0,P.jsx)(`span`,{children:String(e.user_name??`system`)}),(0,P.jsx)(`span`,{children:new Date(String(e.created)).toLocaleString(void 0,{month:`short`,day:`numeric`,hour:`numeric`,minute:`numeric`})})]})]})})},String(e.id??Math.random()))))}):(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsx)(K,{className:`h-20 w-full`}),(0,P.jsx)(K,{className:`h-20 w-full`})]})})]})]}),(0,P.jsx)(ja,{open:s,onOpenChange:l,children:(0,P.jsxs)(Pa,{children:[(0,P.jsxs)(Fa,{children:[(0,P.jsx)(La,{children:`Delete deployment?`}),(0,P.jsxs)(Ra,{children:[`This will remove "`,a?.name,`" from Skyforge and trigger provider cleanup. This action cannot be undone.`]})]}),(0,P.jsxs)(Ia,{children:[(0,P.jsx)(Ba,{children:`Cancel`}),(0,P.jsx)(za,{onClick:de,className:xi({variant:`destructive`}),children:`Delete`})]})]})})]})}function jo({status:e,size:t=`default`}){let n=`secondary`,r=e.toLowerCase();return[`running`,`active`,`healthy`,`succeeded`,`success`].includes(r)&&(n=`default`),[`failed`,`error`,`stopped`,`crashloopbackoff`].includes(r)&&(n=`destructive`),(0,P.jsx)(ma,{variant:n,className:`capitalize ${t===`xs`?`px-1.5 py-0 text-[10px] h-5`:``}`,children:e})}var Mo=Ge,No=j.createContext({}),X=({...e})=>(0,P.jsx)(No.Provider,{value:{name:e.name},children:(0,P.jsx)(dt,{...e})}),Po=()=>{let e=j.useContext(No),t=j.useContext(Fo),{getFieldState:n,formState:r}=un(),i=n(e.name,r);if(!e)throw Error(`useFormField should be used within <FormField>`);let{id:a}=t;return{id:a,name:e.name,formItemId:`${a}-form-item`,formDescriptionId:`${a}-form-item-description`,formMessageId:`${a}-form-item-message`,...i}},Fo=j.createContext({}),Z=j.forwardRef(({className:e,...t},n)=>{let r=j.useId();return(0,P.jsx)(Fo.Provider,{value:{id:r},children:(0,P.jsx)(`div`,{ref:n,className:N(`space-y-2`,e),...t})})});Z.displayName=`FormItem`;var Q=j.forwardRef(({className:e,...t},n)=>{let{error:r,formItemId:i}=Po();return(0,P.jsx)(q,{ref:n,className:N(r&&`text-destructive`,e),htmlFor:i,...t})});Q.displayName=`FormLabel`;var $=j.forwardRef(({...e},t)=>{let{error:n,formItemId:r,formDescriptionId:i,formMessageId:a}=Po();return(0,P.jsx)(Gt,{ref:t,id:r,"aria-describedby":n?`${i} ${a}`:`${i}`,"aria-invalid":!!n,...e})});$.displayName=`FormControl`;var Io=j.forwardRef(({className:e,...t},n)=>{let{formDescriptionId:r}=Po();return(0,P.jsx)(`p`,{ref:n,id:r,className:N(`text-sm text-muted-foreground`,e),...t})});Io.displayName=`FormDescription`;var Lo=j.forwardRef(({className:e,children:t,...n},r)=>{let{error:i,formMessageId:a}=Po(),o=i?String(i?.message):t;return o?(0,P.jsx)(`p`,{ref:r,id:a,className:N(`text-sm font-medium text-destructive`,e),...n,children:o}):null});Lo.displayName=`FormMessage`;var Ro=j.forwardRef(({className:e,...t},n)=>(0,P.jsx)(`textarea`,{className:N(`flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm`,e),ref:n,...t}));Ro.displayName=`Textarea`;var zo=An({name:A().min(2,`Name must be at least 2 characters`),slug:A().min(2,`Slug must be at least 2 characters`).regex(/^[a-z0-9-]+$/,`Slug must contain only lowercase letters, numbers, and dashes`),description:A().optional(),isPublic:On().default(!1),blueprint:A().optional(),allowExternalTemplateRepos:On().default(!1),allowCustomNetlabServers:On().default(!1),sharedUsers:A().optional(),awsAccountId:A().optional(),awsRoleName:A().optional(),awsRegion:A().optional(),awsAuthMethod:A().optional()});const Bo=D(`/dashboard/workspaces/new`)({component:Vo});function Vo(){let e=_n(),t=E(),n=en({resolver:mt(zo),defaultValues:{name:``,slug:``,description:``,isPublic:!1,blueprint:`skyforge/blueprints`,allowExternalTemplateRepos:!1,allowCustomNetlabServers:!1,sharedUsers:``,awsAccountId:``,awsRoleName:``,awsRegion:`us-east-1`,awsAuthMethod:`sso`}}),r=k({mutationFn:e=>cr({name:e.name,slug:e.slug,description:e.description||``,isPublic:!!e.isPublic,allowCustomNetlabServers:!!e.allowCustomNetlabServers,allowExternalTemplateRepos:!!e.allowExternalTemplateRepos,awsAccountId:(e.awsAccountId||``).trim(),awsAuthMethod:(e.awsAuthMethod||``).trim(),awsRegion:(e.awsRegion||``).trim(),awsRoleName:(e.awsRoleName||``).trim(),blueprint:(e.blueprint||``).trim(),externalTemplateRepos:[],sharedUsers:(e.sharedUsers||``).split(`,`).map(e=>e.trim()).filter(Boolean)}),onSuccess:async n=>{w.success(`Workspace created`,{description:`Workspace "${n.name}" has been created successfully.`}),await t.invalidateQueries({queryKey:F.workspaces()}),await e({to:`/dashboard/deployments`,search:{workspace:n.id}})},onError:e=>{w.error(`Failed to create workspace`,{description:e.message})}});function i(e){r.mutate(e)}function a(e){let t=e.target.value;if(n.setValue(`name`,t),!n.getFieldState(`slug`).isDirty){let e=t.toLowerCase().replace(/[^a-z0-9]+/g,`-`).replace(/^-|-$/g,``);n.setValue(`slug`,e)}}return(0,P.jsxs)(`div`,{className:`max-w-2xl mx-auto p-6 space-y-6`,children:[(0,P.jsx)(`div`,{className:`flex items-center justify-between`,children:(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Create Workspace`})}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Workspace Details`}),(0,P.jsx)(B,{children:`Workspaces organize your deployments and resources.`})]}),(0,P.jsx)(V,{children:(0,P.jsx)(Mo,{...n,children:(0,P.jsxs)(`form`,{onSubmit:n.handleSubmit(i),className:`space-y-6`,children:[(0,P.jsx)(X,{control:n.control,name:`name`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`Name`}),(0,P.jsx)($,{children:(0,P.jsx)(J,{placeholder:`My Project`,...e,onChange:t=>{e.onChange(t),a(t)}})}),(0,P.jsx)(Io,{children:`A display name for your workspace.`}),(0,P.jsx)(Lo,{})]})}),(0,P.jsx)(X,{control:n.control,name:`slug`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`Slug`}),(0,P.jsx)($,{children:(0,P.jsx)(J,{placeholder:`my-project`,...e})}),(0,P.jsx)(Io,{children:`Unique identifier used in URLs. Only lowercase letters, numbers, and dashes.`}),(0,P.jsx)(Lo,{})]})}),(0,P.jsx)(X,{control:n.control,name:`description`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`Description`}),(0,P.jsx)($,{children:(0,P.jsx)(Ro,{placeholder:`Describe the purpose of this workspace...`,...e})}),(0,P.jsx)(Io,{children:`Optional description for your team.`}),(0,P.jsx)(Lo,{})]})}),(0,P.jsx)(X,{control:n.control,name:`isPublic`,render:({field:e})=>(0,P.jsxs)(Z,{className:`flex items-center justify-between rounded-lg border p-4`,children:[(0,P.jsxs)(`div`,{className:`space-y-0.5`,children:[(0,P.jsx)(Q,{children:`Public workspace`}),(0,P.jsxs)(Io,{children:[`Required for BYOS Netlab via `,(0,P.jsx)(`code`,{className:`font-mono`,children:`topologyUrl`}),` when using workspace templates.`]})]}),(0,P.jsx)($,{children:(0,P.jsx)(Oa,{checked:e.value,onCheckedChange:e.onChange})})]})}),(0,P.jsx)(X,{control:n.control,name:`blueprint`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`Blueprint repo`}),(0,P.jsx)($,{children:(0,P.jsx)(J,{placeholder:`skyforge/blueprints`,...e})}),(0,P.jsx)(Io,{children:`Default template catalog repo (format: owner/repo).`}),(0,P.jsx)(Lo,{})]})}),(0,P.jsx)(X,{control:n.control,name:`sharedUsers`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`Shared users (viewers)`}),(0,P.jsx)($,{children:(0,P.jsx)(J,{placeholder:`alice,bob`,...e})}),(0,P.jsx)(Io,{children:`Comma-separated usernames.`}),(0,P.jsx)(Lo,{})]})}),(0,P.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,P.jsx)(X,{control:n.control,name:`awsAccountId`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`AWS account ID (optional)`}),(0,P.jsx)($,{children:(0,P.jsx)(J,{placeholder:`123456789012`,...e})}),(0,P.jsx)(Lo,{})]})}),(0,P.jsx)(X,{control:n.control,name:`awsRoleName`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`AWS role name (optional)`}),(0,P.jsx)($,{children:(0,P.jsx)(J,{placeholder:`MyRole`,...e})}),(0,P.jsx)(Lo,{})]})}),(0,P.jsx)(X,{control:n.control,name:`awsRegion`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`AWS region`}),(0,P.jsx)($,{children:(0,P.jsx)(J,{placeholder:`us-east-1`,...e})}),(0,P.jsx)(Lo,{})]})}),(0,P.jsx)(X,{control:n.control,name:`awsAuthMethod`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`AWS auth method`}),(0,P.jsx)($,{children:(0,P.jsx)(J,{placeholder:`sso`,...e})}),(0,P.jsx)(Lo,{})]})})]}),(0,P.jsxs)(`div`,{className:`space-y-3 rounded-lg border p-4`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Workspace options`}),(0,P.jsx)(X,{control:n.control,name:`allowExternalTemplateRepos`,render:({field:e})=>(0,P.jsxs)(Z,{className:`flex items-center justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-0.5`,children:[(0,P.jsx)(Q,{children:`Allow external template repos`}),(0,P.jsx)(Io,{children:`Enable additional template sources for deployments.`})]}),(0,P.jsx)($,{children:(0,P.jsx)(Oa,{checked:e.value,onCheckedChange:e.onChange})})]})}),(0,P.jsx)(X,{control:n.control,name:`allowCustomNetlabServers`,render:({field:e})=>(0,P.jsxs)(Z,{className:`flex items-center justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-0.5`,children:[(0,P.jsx)(Q,{children:`Allow custom Netlab servers (BYOS)`}),(0,P.jsx)(Io,{children:`Enable user-provided Netlab API servers.`})]}),(0,P.jsx)($,{children:(0,P.jsx)(Oa,{checked:e.value,onCheckedChange:e.onChange})})]})})]}),(0,P.jsxs)(`div`,{className:`flex justify-end gap-4`,children:[(0,P.jsx)(I,{type:`button`,variant:`ghost`,onClick:()=>e({to:`/dashboard/deployments`}),children:`Cancel`}),(0,P.jsx)(I,{type:`submit`,disabled:r.isPending,children:r.isPending?`Creating...`:`Create Workspace`})]})]})})})]})]})}const Ho=D(`/dashboard/workspaces/$workspaceId`)({component:Uo});function Uo(){let{workspaceId:e}=Ho.useParams(),t=_n(),n=E(),r=O({queryKey:F.session(),queryFn:Rn,staleTime:3e4,retry:!1}),i=O({queryKey:F.workspaces(),queryFn:Bn}),a=(0,j.useMemo)(()=>(i.data?.workspaces??[]).find(t=>t.id===e)??null,[i.data,e]),o=(0,j.useMemo)(()=>So(r.data,a),[r.data,a]),s=(0,j.useMemo)(()=>Co(o),[o]),c=(0,j.useMemo)(()=>wo(o),[o]),[l,u]=(0,j.useState)(``),[d,f]=(0,j.useState)(``),[p,m]=(0,j.useState)(``),[h,ee]=(0,j.useState)(!1),[g,_]=(0,j.useState)(!1),[v,y]=(0,j.useState)(``),[b,x]=(0,j.useState)(``),S=k({mutationFn:async()=>dr(e,{confirm:b.trim()||(a?.slug??e)}),onSuccess:async()=>{w.success(`Workspace deleted`),await n.invalidateQueries({queryKey:F.workspaces()}),await t({to:`/dashboard/deployments`})},onError:e=>w.error(`Failed to delete workspace`,{description:e.message})});(0,j.useEffect)(()=>{a&&(f((a.owners??[]).join(`,`)),m((a.editors??[]).join(`,`)),u((a.viewers??[]).join(`,`)),ee(!!a.allowExternalTemplateRepos),_(!!a.allowCustomNetlabServers),y(JSON.stringify(a.externalTemplateRepos??[],null,2)))},[a]);let te=k({mutationFn:async t=>lr(e,{isPublic:t.isPublic,owners:t.owners,ownerGroups:a?.ownerGroups??[],editors:t.editors,editorGroups:a?.editorGroups??[],viewers:t.viewers,viewerGroups:a?.viewerGroups??[]}),onSuccess:async()=>{w.success(`Workspace updated`),await n.invalidateQueries({queryKey:F.workspaces()})},onError:e=>w.error(`Failed to update workspace`,{description:e.message})}),ne=k({mutationFn:async t=>yr(e,{allowExternalTemplateRepos:t.allowExternalTemplateRepos,allowCustomNetlabServers:t.allowCustomNetlabServers,externalTemplateRepos:t.externalTemplateRepos??[]}),onSuccess:async()=>{w.success(`Workspace feature flags updated`),await n.invalidateQueries({queryKey:F.workspaces()})},onError:e=>w.error(`Failed to update settings`,{description:e.message})}),re=e=>e.split(`,`).map(e=>e.trim()).filter(Boolean);return i.isLoading?(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(K,{className:`h-8 w-64`}),(0,P.jsx)(K,{className:`h-28 w-full`})]}):a?(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between border-b pb-6`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:a.name}),(0,P.jsxs)(`div`,{className:`mt-1 text-sm text-muted-foreground`,children:[(0,P.jsx)(`span`,{className:`font-mono`,children:a.slug}),` `,(0,P.jsx)(ma,{variant:a.isPublic?`default`:`secondary`,children:a.isPublic?`Public`:`Private`})]})]}),(0,P.jsx)(T,{to:`/dashboard/deployments`,search:{workspace:a.id},children:(0,P.jsx)(I,{variant:`outline`,children:`Back to deployments`})})]}),(0,P.jsxs)(Za,{defaultValue:`access`,className:`space-y-6`,children:[(0,P.jsxs)(Qa,{children:[(0,P.jsx)($a,{value:`access`,children:`Access`}),(0,P.jsx)($a,{value:`features`,children:`Features`}),c&&(0,P.jsx)($a,{value:`danger`,children:`Danger`})]}),(0,P.jsxs)(eo,{value:`access`,className:`space-y-6`,children:[!s&&(0,P.jsx)(L,{children:(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Read-only access`}),(0,P.jsx)(B,{children:`You can view this workspace but cannot edit or delete it.`})]})}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Visibility`}),(0,P.jsx)(B,{children:"BYOS Netlab via `topologyUrl` requires public access to the selected topology."})]}),(0,P.jsxs)(V,{className:`flex items-center justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{children:`Public workspace`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Controls Gitea repo visibility and template accessibility.`})]}),(0,P.jsx)(Oa,{checked:!!a.isPublic,disabled:!s,onCheckedChange:e=>{let t=re(d);te.mutate({isPublic:e,owners:t,editors:re(p),viewers:re(l)})}})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Members`}),(0,P.jsx)(B,{children:`Comma-separated usernames. (Groups are not editable here yet.)`})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{children:`Owners`}),(0,P.jsx)(J,{value:d,onChange:e=>f(e.target.value),placeholder:`alice,bob`,disabled:!s})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{children:`Editors`}),(0,P.jsx)(J,{value:p,onChange:e=>m(e.target.value),placeholder:`alice,bob`,disabled:!s})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{children:`Viewers`}),(0,P.jsx)(J,{value:l,onChange:e=>u(e.target.value),placeholder:`alice,bob`,disabled:!s})]}),(0,P.jsx)(`div`,{className:`flex justify-end`,children:(0,P.jsx)(I,{variant:`default`,disabled:!s||te.isPending,onClick:()=>te.mutate({isPublic:!!a.isPublic,owners:re(d),editors:re(p),viewers:re(l)}),children:te.isPending?`Saving…`:`Save members`})})]})]})]}),(0,P.jsxs)(eo,{value:`features`,className:`space-y-6`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Workspace feature flags`}),(0,P.jsx)(B,{children:`Enable template repo sources and BYOS server support for this workspace.`})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{children:`Allow external template repos`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Expose user-defined repo sources in the deployment UI.`})]}),(0,P.jsx)(Oa,{checked:h,onCheckedChange:ee,disabled:!s})]}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{children:`Allow custom Netlab servers`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Enable BYOS Netlab API servers per workspace.`})]}),(0,P.jsx)(Oa,{checked:g,onCheckedChange:_,disabled:!s})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{children:`External template repos (JSON)`}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Array of `,`{ id, name, repo, defaultBranch }`,` objects. Saved only when external repos are enabled.`]}),(0,P.jsx)(`textarea`,{className:`w-full min-h-[160px] rounded-md border bg-background p-3 font-mono text-xs`,value:v,onChange:e=>y(e.target.value),disabled:!s})]}),(0,P.jsx)(`div`,{className:`flex justify-end`,children:(0,P.jsx)(I,{variant:`default`,disabled:!s||ne.isPending,onClick:()=>{let e=[];try{e=JSON.parse(v||`[]`)}catch{w.error(`External repos JSON is invalid`);return}ne.mutate({allowExternalTemplateRepos:h,allowCustomNetlabServers:g,externalTemplateRepos:e})},children:ne.isPending?`Saving…`:`Save settings`})})]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Forward`}),(0,P.jsx)(B,{children:`Forward integration is configured per-user and enabled per-deployment.`})]}),(0,P.jsx)(V,{children:(0,P.jsx)(T,{to:`/dashboard/forward`,children:(0,P.jsx)(I,{variant:`outline`,children:`Open Forward Collector settings`})})})]})]}),c&&(0,P.jsx)(eo,{value:`danger`,className:`space-y-6`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Delete workspace`}),(0,P.jsx)(B,{children:`Deletes the workspace and backing resources. This cannot be undone.`})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Type `,(0,P.jsx)(`span`,{className:`font-mono`,children:a.slug}),` to confirm.`]}),(0,P.jsx)(J,{value:b,onChange:e=>x(e.target.value),placeholder:a.slug}),(0,P.jsx)(`div`,{className:`flex justify-end`,children:(0,P.jsx)(I,{variant:`destructive`,disabled:S.isPending||b.trim().toLowerCase()!==a.slug.toLowerCase(),onClick:()=>S.mutate(),children:S.isPending?`Deleting…`:`Delete workspace`})})]})]})})]})]}):(0,P.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Workspace not found.`}),(0,P.jsx)(I,{variant:`outline`,onClick:()=>t({to:`/dashboard/workspaces`}),children:`Back`})]})}function Wo(e,t){let n=E(),r=(0,j.useMemo)(()=>`${Fn}/runs/${encodeURIComponent(e)}/events`,[e]);(0,j.useEffect)(()=>{if(!t||!e)return;let i=Yi(r,{output:t=>{try{console.log(`Run event:`,t.data);let r=JSON.parse(t.data);if(!r||!Array.isArray(r.entries))return;n.setQueryData(F.runLogs(e),e=>{let t=(e?.entries??[]).concat(r.entries);return{cursor:Number(r.cursor??e?.cursor??0),entries:t}})}catch{}}});return()=>{i.close()}},[t,n,e,r])}const Go=D(`/dashboard/runs/$runId`)({component:Ko});function Ko(){let{runId:e}=Go.useParams();Wo(e,!0);let t=E(),n=O({queryKey:F.dashboardSnapshot(),queryFn:async()=>null,initialData:null,retry:!1,staleTime:1/0}),r=(n.data?.runs??[]).find(t=>String(t.id??``)===e),i=O({queryKey:F.runLogs(e),queryFn:async()=>({cursor:0,entries:[]}),retry:!1,staleTime:1/0}),a=In(window.location.pathname+window.location.search);return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,P.jsx)(`div`,{children:(0,P.jsxs)(z,{children:[`Run `,e]})}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(T,{className:xi({variant:`outline`,size:`sm`}),to:`/dashboard/deployments`,children:`Back`}),(0,P.jsx)(I,{variant:`outline`,size:`sm`,onClick:()=>t.setQueryData(F.runLogs(e),{cursor:0,entries:[]}),children:`Clear`})]})]})})}),!n.data&&(0,P.jsx)(L,{className:`border-dashed`,children:(0,P.jsxs)(V,{className:`pt-6 text-center text-muted-foreground`,children:[`Waiting for platform stream…`,(0,P.jsxs)(`div`,{className:`mt-2 text-xs`,children:[`If you are logged out,`,` `,(0,P.jsx)(`a`,{className:`text-primary underline hover:no-underline`,href:a,onClick:e=>{e.preventDefault(),(async()=>{if(!await Hr({loginHref:a})){window.location.href=a;return}await t.invalidateQueries({queryKey:F.session()})})()},children:`login`}),`.`]})]})}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsx)(z,{children:`Metadata`}),(0,P.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Cursor: `,String(i.data?.cursor??0)]})]})}),(0,P.jsx)(V,{children:(0,P.jsxs)(`div`,{className:`grid grid-cols-1 gap-4 md:grid-cols-3`,children:[(0,P.jsx)(qo,{label:`Type`,value:String(r?.tpl_alias??``)}),(0,P.jsx)(qo,{label:`Status`,value:String(r?.status??``)}),(0,P.jsx)(qo,{label:`Workspace`,value:String(r?.workspaceId??``)}),(0,P.jsx)(qo,{label:`Created`,value:String(r?.created??``)}),(0,P.jsx)(qo,{label:`Started`,value:String(r?.start??``)}),(0,P.jsx)(qo,{label:`Finished`,value:String(r?.end??``)})]})})]}),(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{children:(0,P.jsx)(z,{children:`Output`})}),(0,P.jsx)(V,{children:(0,P.jsx)(`div`,{className:`rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100`,children:(0,P.jsx)(Jo,{entries:i.data?.entries??[]})})})]})]})}function qo(e){return(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-[11px] uppercase tracking-wide text-muted-foreground`,children:e.label}),(0,P.jsx)(`div`,{className:`break-all font-medium text-sm`,children:e.value||`—`})]})}function Jo(e){let t=(0,j.useRef)(null);return(0,j.useEffect)(()=>{let e=t.current;e&&(e.scrollTop=e.scrollHeight)},[e.entries.length]),e.entries.length===0?(0,P.jsx)(`div`,{className:`text-zinc-500`,children:`Waiting for output…`}):(0,P.jsx)(`div`,{ref:t,className:`max-h-[65vh] overflow-auto whitespace-pre-wrap`,children:e.entries.map((e,t)=>(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`span`,{className:`text-zinc-500 select-none`,children:e.time?`${e.time} `:``}),(0,P.jsx)(`span`,{children:e.output})]},`${e.time}-${t}`))})}var Yo=ct,Xo=Rt,Zo=kt,Qo=j.forwardRef(({className:e,sideOffset:t=4,...n},r)=>(0,P.jsx)(rt,{ref:r,sideOffset:t,className:N(`z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,e),...n}));Qo.displayName=rt.displayName;var $o=An({workspace:A().optional().catch(``)});const es=D(`/dashboard/deployments/new`)({validateSearch:e=>$o.parse(e),component:ns});var ts=An({workspaceId:A().min(1,`Workspace is required`),name:A().min(1,`Deployment name is required`).max(100),kind:En([`netlab-c9s`,`netlab`,`containerlab`,`clabernetes`,`terraform`]),source:En([`workspace`,`blueprints`,`external`]),templateRepoId:A().optional(),template:A().min(1,`Template is required`),netlabServer:A().optional(),forwardEnabled:On().default(!1),forwardCollectorUsername:A().optional()}).superRefine((e,t)=>{e.forwardEnabled&&!String(e.forwardCollectorUsername??``).trim()&&t.addIssue({code:Dn.custom,message:`Collector selection is required when Forward is enabled`,path:[`forwardCollectorUsername`]})});function ns(){let e=_n(),t=E(),{workspace:n}=es.useSearch();Do(!0);let r=O({queryKey:F.dashboardSnapshot(),queryFn:async()=>null,initialData:null,retry:!1,staleTime:1/0}),i=O({queryKey:F.workspaces(),queryFn:Bn,staleTime:3e4}).data?.workspaces??[],a=en({resolver:mt(ts),defaultValues:{workspaceId:n||``,name:``,kind:`netlab-c9s`,source:`blueprints`,templateRepoId:``,template:``,netlabServer:``,forwardEnabled:!1,forwardCollectorUsername:``}}),{watch:o,setValue:s}=a,c=o(`workspaceId`),l=o(`kind`),u=o(`source`),d=o(`templateRepoId`),f=o(`template`),p=o(`forwardEnabled`),m=r.data?.templatesIndexUpdatedAt??``;(0,j.useEffect)(()=>{!c&&i.length>0&&s(`workspaceId`,i[0].id)},[c,i,s]),(0,j.useEffect)(()=>{s(`name`,`${(f||l).split(`/`).pop()||l}-${new Date().toISOString().replace(/[-:]/g,``).replace(/\..+/,``).slice(0,15)}`)},[f,l,s]);let h=(0,j.useMemo)(()=>i.find(e=>e.id===c)??null,[c,i]),ee=O({queryKey:F.workspaceNetlabServers(c),queryFn:async()=>Gn(c),enabled:!!c,staleTime:3e4}),g=(0,j.useMemo)(()=>l===`netlab`||l===`netlab-c9s`?u===`workspace`?`workspace`:`blueprints`:l===`containerlab`||l===`clabernetes`?u:`workspace`,[l,u]),_=O({queryKey:F.workspaceTemplates(c,l,g,d||void 0,void 0),enabled:!!c,queryFn:async()=>{let e={source:g};switch(g===`external`&&d&&(e.repo=d),l){case`netlab`:case`netlab-c9s`:return ar(c,e);case`containerlab`:case`clabernetes`:return or(c,e);default:return ar(c,e)}},staleTime:5*6e4,refetchOnWindowFocus:!1});(0,j.useEffect)(()=>{m&&t.invalidateQueries({queryKey:[`workspaceTemplates`]})},[m,t]);let v=_.data?.templates??[],y=(h?.externalTemplateRepos??[]).filter(e=>!!e&&typeof e.id==`string`&&typeof e.repo==`string`),b=!!h?.allowExternalTemplateRepos&&y.length>0,x=O({queryKey:F.forwardCollectors(),queryFn:Kn,enabled:p,staleTime:3e4,retry:!1}),S=x.data?.collectors??[],te=k({mutationFn:async e=>{let t={template:e.template};if(e.kind===`netlab`||e.kind===`containerlab`){let n=(e.netlabServer||h?.netlabServer||``).trim();if(!n)throw Error(`netlab server is required`);t.netlabServer=n,t.templateSource=g,g===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),_.data?.dir&&(t.templatesDir=_.data.dir)}e.kind===`netlab-c9s`&&(t.templateSource=g,g===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),_.data?.dir&&(t.templatesDir=_.data.dir)),e.kind===`clabernetes`&&(t.templateSource=g,g===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),_.data?.dir&&(t.templatesDir=_.data.dir)),e.forwardEnabled&&(t.forwardEnabled=!0,t.forwardCollectorUsername=String(e.forwardCollectorUsername??``).trim());let n={name:e.name,type:e.kind,config:t};return sr(e.workspaceId,n)},onSuccess:async(n,r)=>{w.success(`Deployment created successfully`,{description:`${r.name} is now queued for provisioning.`}),await t.invalidateQueries({queryKey:F.dashboardSnapshot()}),await e({to:`/dashboard/deployments`,search:{workspace:r.workspaceId}})},onError:e=>{w.error(`Failed to create deployment`,{description:e.message})}});function ne(e){te.mutate(e)}let re=ee.data?.servers??[];return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsx)(L,{variant:`glass`,children:(0,P.jsx)(R,{children:(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,P.jsxs)(`div`,{children:[(0,P.jsx)(z,{children:`Create deployment`}),(0,P.jsx)(B,{children:`Configure and launch a new infrastructure deployment.`})]}),(0,P.jsx)(I,{variant:`outline`,onClick:()=>e({to:`/dashboard/deployments`,search:{workspace:c}}),children:`Cancel`})]})})}),(0,P.jsx)(L,{children:(0,P.jsx)(V,{className:`pt-6`,children:(0,P.jsx)(Mo,{...a,children:(0,P.jsxs)(`form`,{onSubmit:a.handleSubmit(ne),className:`space-y-8`,children:[(0,P.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:[(0,P.jsx)(X,{control:a.control,name:`workspaceId`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`Workspace`}),(0,P.jsxs)(Ua,{onValueChange:e.onChange,defaultValue:e.value,value:e.value,children:[(0,P.jsx)($,{children:(0,P.jsx)(Ga,{children:(0,P.jsx)(Wa,{placeholder:`Select workspace`})})}),(0,P.jsx)(Ja,{children:i.map(e=>(0,P.jsxs)(Y,{value:e.id,children:[e.name,` (`,e.slug,`)`]},e.id))})]}),(0,P.jsx)(Lo,{})]})}),(0,P.jsx)(X,{control:a.control,name:`kind`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`Provider`}),(0,P.jsxs)(Ua,{onValueChange:t=>{e.onChange(t),a.setValue(`template`,``)},defaultValue:e.value,children:[(0,P.jsx)($,{children:(0,P.jsx)(Ga,{children:(0,P.jsx)(Wa,{placeholder:`Select provider`})})}),(0,P.jsxs)(Ja,{children:[(0,P.jsx)(Y,{value:`netlab-c9s`,children:`Netlab`}),(0,P.jsx)(Y,{value:`netlab`,children:`Netlab (BYOS)`}),(0,P.jsx)(Y,{value:`containerlab`,children:`Containerlab (BYOS)`}),(0,P.jsx)(Y,{value:`clabernetes`,children:`Containerlab`}),(0,P.jsx)(Y,{value:`terraform`,children:`Terraform`})]})]}),(0,P.jsx)(Lo,{})]})}),(0,P.jsx)(X,{control:a.control,name:`source`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsxs)(Q,{className:`flex items-center gap-2`,children:[`Template source`,(0,P.jsx)(Yo,{children:(0,P.jsxs)(Xo,{children:[(0,P.jsx)(Zo,{asChild:!0,children:(0,P.jsx)(qt,{className:`h-4 w-4 text-muted-foreground`})}),(0,P.jsx)(Qo,{children:(0,P.jsx)(`p`,{children:`Git repository or URL containing deployment templates`})})]})})]}),(0,P.jsxs)(Ua,{onValueChange:t=>{e.onChange(t),a.setValue(`templateRepoId`,``),a.setValue(`template`,``)},defaultValue:e.value,children:[(0,P.jsx)($,{children:(0,P.jsx)(Ga,{children:(0,P.jsx)(Wa,{placeholder:`Select source`})})}),(0,P.jsxs)(Ja,{children:[(0,P.jsx)(Y,{value:`workspace`,children:`Workspace repo`}),(0,P.jsx)(Y,{value:`blueprints`,children:`Blueprints`}),(0,P.jsx)(Y,{value:`external`,disabled:!b||l!==`containerlab`&&l!==`clabernetes`,children:`External repo`})]})]}),!b&&(l===`containerlab`||l===`clabernetes`)&&(0,P.jsx)(Io,{children:`External repos disabled or not configured for this workspace.`}),(0,P.jsx)(Lo,{})]})}),g===`external`&&(0,P.jsx)(X,{control:a.control,name:`templateRepoId`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`External repo`}),(0,P.jsxs)(Ua,{onValueChange:t=>{e.onChange(t),a.setValue(`template`,``)},defaultValue:e.value,children:[(0,P.jsx)($,{children:(0,P.jsx)(Ga,{children:(0,P.jsx)(Wa,{placeholder:`Select repo…`})})}),(0,P.jsx)(Ja,{children:y.map(e=>(0,P.jsxs)(Y,{value:e.id,children:[e.name,` (`,e.repo,`)`]},e.id))})]}),(0,P.jsx)(Lo,{})]})}),(l===`netlab`||l===`containerlab`)&&(0,P.jsx)(X,{control:a.control,name:`netlabServer`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`Netlab server`}),(0,P.jsxs)(Ua,{onValueChange:e.onChange,defaultValue:e.value||h?.netlabServer||``,value:e.value||h?.netlabServer||``,children:[(0,P.jsx)($,{children:(0,P.jsx)(Ga,{children:(0,P.jsx)(Wa,{placeholder:`Select server…`})})}),(0,P.jsx)(Ja,{children:re.map(e=>(0,P.jsx)(Y,{value:e.value,children:e.label},e.value))})]}),ee.isLoading&&(0,P.jsx)(Io,{children:`Loading servers…`}),(0,P.jsx)(Lo,{})]})}),(0,P.jsx)(X,{control:a.control,name:`template`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`Template`}),(0,P.jsxs)(Ua,{onValueChange:e.onChange,defaultValue:e.value,disabled:_.isLoading||v.length===0,children:[(0,P.jsx)($,{children:(0,P.jsx)(Ga,{children:(0,P.jsx)(Wa,{placeholder:_.isLoading?`Loading…`:v.length?`Select template…`:`No templates`})})}),(0,P.jsx)(Ja,{children:v.map(e=>(0,P.jsx)(Y,{value:e,children:e},e))})]}),_.isError&&(0,P.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to load templates.`}),(0,P.jsx)(Lo,{})]})}),(0,P.jsx)(X,{control:a.control,name:`name`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`Deployment name`}),(0,P.jsx)($,{children:(0,P.jsx)(J,{placeholder:`My Deployment`,...e})}),(0,P.jsx)(Io,{children:`Custom name for this specific deployment instance.`}),(0,P.jsx)(Lo,{})]})})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Forward Networks`}),(0,P.jsx)(B,{children:`Optional: sync discovered device IPs into Forward for collection.`})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsx)(X,{control:a.control,name:`forwardEnabled`,render:({field:e})=>(0,P.jsxs)(Z,{className:`flex items-center justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(Q,{children:`Enable Forward collection`}),(0,P.jsx)(Io,{children:`Requires configuring your Collector in the left sidebar first.`})]}),(0,P.jsx)($,{children:(0,P.jsx)(Oa,{checked:!!e.value,onCheckedChange:e.onChange})})]})}),p?(0,P.jsx)(X,{control:a.control,name:`forwardCollectorUsername`,render:({field:e})=>(0,P.jsxs)(Z,{children:[(0,P.jsx)(Q,{children:`Collector`}),(0,P.jsxs)(Ua,{onValueChange:e.onChange,value:String(e.value??``),disabled:x.isLoading||x.isError,children:[(0,P.jsx)($,{children:(0,P.jsx)(Ga,{children:(0,P.jsx)(Wa,{placeholder:x.isLoading?`Loading…`:x.isError?`Configure Collector first`:`Select collector…`})})}),(0,P.jsx)(Ja,{children:S.map(e=>(0,P.jsxs)(Y,{value:e.username,children:[e.name,` (`,e.username,`)`]},e.id||e.username))})]}),(0,P.jsx)(Lo,{})]})}):null]})]}),te.isError&&(0,P.jsx)(`div`,{className:`rounded-md bg-destructive/15 p-3 text-sm text-destructive border border-destructive/20`,children:te.error?.message||`Create failed.`}),(0,P.jsxs)(`div`,{className:`flex gap-3`,children:[(0,P.jsxs)(I,{type:`submit`,disabled:te.isPending,children:[te.isPending&&(0,P.jsx)(ot,{className:`mr-2 h-4 w-4 animate-spin`}),te.isPending?`Creating…`:`Create Deployment`]}),(0,P.jsx)(I,{type:`button`,variant:`secondary`,onClick:()=>e({to:`/dashboard/deployments`,search:{workspace:c}}),disabled:te.isPending,children:`Back`})]})]})})})})]})}function rs(){return{downloadImage:(0,j.useCallback)((e,t)=>{e&&jn(e,{cacheBust:!0,backgroundColor:`#18181b`}).then(e=>{let n=document.createElement(`a`);n.download=t,n.href=e,n.click()}).catch(e=>{console.error(`Failed to download image`,e)})},[])}}var is=kn(),as=Mn();function os({open:e,onOpenChange:t,workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a}){let o=(0,j.useRef)(null),s=(0,j.useRef)(null),c=(0,j.useRef)(null),l=(0,j.useRef)(null),[u,d]=(0,j.useState)(`disconnected`),f=(0,j.useMemo)(()=>{let e=String(a??``).toLowerCase();return e.includes(`eos`)||e.includes(`ceos`)?`Cli`:`sh`},[a]),p=(0,j.useMemo)(()=>{if(!n||!r||!i)return``;let e=`${window.location.protocol===`https:`?`wss`:`ws`}://${window.location.host}${Pn}/api/workspaces/${encodeURIComponent(n)}/deployments/${encodeURIComponent(r)}/terminal/ws`,t=new URLSearchParams;return t.set(`node`,i),t.set(`command`,f),`${e}?${t.toString()}`},[f,r,i,n]);return(0,j.useEffect)(()=>{if(!e||!o.current||!p)return;let t=new is.Terminal({convertEol:!0,cursorBlink:!0,fontFamily:`ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace`,fontSize:12,theme:{background:`#09090b`}}),n=new as.FitAddon;t.loadAddon(n),t.open(o.current),n.fit(),t.writeln(`\x1B[1mSkyforge Terminal\x1B[0m`),t.writeln(`Node: ${i}  Command: ${f}`),t.writeln(``),s.current=t,c.current=n;let r=new WebSocket(p);l.current=r,d(`connecting`);let a=()=>{let e=s.current;if(!e)return;let t=e.cols??80,n=e.rows??24;try{r.send(JSON.stringify({type:`resize`,cols:t,rows:n}))}catch{}};r.onopen=()=>{d(`connected`),a(),t.focus()},r.onmessage=e=>{let n=null;try{n=JSON.parse(String(e.data))}catch{t.write(String(e.data));return}if(n){if(n.type===`output`){t.write(n.data??``);return}if(n.type===`info`){t.writeln(`\r\n[info] ${n.data??``}`);return}if(n.type===`error`){t.writeln(`\r\n[error] ${n.data??``}`);return}}},r.onclose=()=>{d(`closed`),t.writeln(`\r
[disconnected]`)},r.onerror=()=>{d(`error`)};let u=t.onData(e=>{try{r.send(JSON.stringify({type:`stdin`,data:e}))}catch{}}),m=()=>{n.fit(),a()};return window.addEventListener(`resize`,m),()=>{window.removeEventListener(`resize`,m),u.dispose();try{r.close()}catch{}l.current=null,t.dispose(),s.current=null,c.current=null,d(`disconnected`)}},[f,i,e,p]),(0,P.jsx)(ni,{open:e,onOpenChange:t,children:(0,P.jsxs)(ai,{className:`max-w-5xl`,children:[(0,P.jsx)(oi,{children:(0,P.jsxs)(ci,{className:`flex items-center gap-2`,children:[(0,P.jsx)(y,{className:`h-4 w-4`}),`Terminal`]})}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2 text-xs text-muted-foreground`,children:[(0,P.jsxs)(`div`,{className:`truncate`,children:[(0,P.jsx)(`span`,{className:`font-mono`,children:n}),` / `,(0,P.jsx)(`span`,{className:`font-mono`,children:r}),` /`,` `,(0,P.jsx)(`span`,{className:`font-mono`,children:i})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(`span`,{children:[`Status: `,u]}),(0,P.jsx)(I,{variant:`outline`,size:`sm`,onClick:()=>{let e=l.current;if(e&&e.readyState===WebSocket.OPEN)try{e.close()}catch{}t(!1)},children:`Close`})]})]}),(0,P.jsx)(`div`,{className:`rounded-md border bg-zinc-950 p-2`,children:(0,P.jsx)(`div`,{ref:o,className:`h-[65vh] w-full`})}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Tip: Right-click a node in the topology to open the terminal.`})]})})}function ss({open:e,onOpenChange:t,workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,nodeIp:o}){let s=(0,j.useMemo)(()=>{let e=[i];return a&&e.push(String(a)),e.join(` • `)},[i,a]),c=O({queryKey:[`deploymentNodeLogs`,n,r,i,400],enabled:e&&!!n&&!!r&&!!i,queryFn:async()=>tr(n,r,i,{tail:400}),refetchOnWindowFocus:!1,retry:1});return(0,P.jsx)(ni,{open:e,onOpenChange:t,children:(0,P.jsxs)(ai,{className:`max-w-5xl`,children:[(0,P.jsx)(oi,{children:(0,P.jsxs)(ci,{className:`flex items-center gap-2`,children:[(0,P.jsx)(y,{className:`h-4 w-4`}),`Node logs`]})}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2 text-xs text-muted-foreground`,children:[(0,P.jsxs)(`div`,{className:`truncate`,children:[(0,P.jsx)(`span`,{className:`font-mono`,children:s}),o?(0,P.jsx)(`span`,{className:`ml-2 font-mono`,children:o}):null,c.data?.namespace&&c.data?.podName?(0,P.jsxs)(`span`,{className:`ml-2`,children:[c.data.namespace,`/`,c.data.podName,c.data.container?` (${c.data.container})`:``]}):null]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(I,{variant:`outline`,size:`sm`,onClick:()=>c.refetch(),disabled:c.isFetching,children:[(0,P.jsx)(Fe,{className:c.isFetching?`mr-2 h-4 w-4 animate-spin`:`mr-2 h-4 w-4`}),`Refresh`]}),(0,P.jsx)(I,{variant:`outline`,size:`sm`,onClick:()=>t(!1),children:`Close`})]})]}),(0,P.jsx)(`div`,{className:`rounded-md border bg-muted/30`,children:(0,P.jsx)(`div`,{className:`h-[65vh] overflow-auto`,children:(0,P.jsx)(`pre`,{className:`p-3 text-xs font-mono whitespace-pre-wrap`,children:c.isLoading?`Loading…`:c.isError?`Failed to load logs: ${String(c.error)}`:c.data?.logs||``})})}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Tip: For interactive access, right-click the node and open the terminal.`})]})})}function cs({open:e,onOpenChange:t,workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,nodeIp:o}){let s=(0,j.useMemo)(()=>{let e=[i];return a&&e.push(String(a)),e.join(` • `)},[i,a]),c=O({queryKey:[`deploymentNodeDescribe`,n,r,i],enabled:e&&!!n&&!!r&&!!i,queryFn:async()=>nr(n,r,i),refetchOnWindowFocus:!1,retry:1});return(0,P.jsx)(ni,{open:e,onOpenChange:t,children:(0,P.jsxs)(ai,{className:`max-w-5xl`,children:[(0,P.jsx)(oi,{children:(0,P.jsxs)(ci,{className:`flex items-center gap-2`,children:[(0,P.jsx)(y,{className:`h-4 w-4`}),`Node status`]})}),(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2 text-xs text-muted-foreground`,children:[(0,P.jsxs)(`div`,{className:`truncate`,children:[(0,P.jsx)(`span`,{className:`font-mono`,children:s}),o?(0,P.jsx)(`span`,{className:`ml-2 font-mono`,children:o}):null,c.data?.namespace&&c.data?.podName?(0,P.jsxs)(`span`,{className:`ml-2`,children:[c.data.namespace,`/`,c.data.podName]}):null]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(I,{variant:`outline`,size:`sm`,onClick:()=>c.refetch(),disabled:c.isFetching,children:[(0,P.jsx)(Fe,{className:c.isFetching?`mr-2 h-4 w-4 animate-spin`:`mr-2 h-4 w-4`}),`Refresh`]}),(0,P.jsx)(I,{variant:`outline`,size:`sm`,onClick:()=>t(!1),children:`Close`})]})]}),(0,P.jsx)(`div`,{className:`rounded-md border bg-muted/30`,children:(0,P.jsx)(`div`,{className:`max-h-[65vh] overflow-auto`,children:(0,P.jsx)(`pre`,{className:`p-3 text-xs font-mono whitespace-pre-wrap`,children:c.isLoading?`Loading…`:c.isError?`Failed to load node status: ${String(c.error)}`:JSON.stringify(c.data??{},null,2)})})}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Tip: If the pod is Running but the NOS CLI is unavailable, check the node logs and the launcher container.`})]})})}function ls(e,t,n){let r=E(),i=(0,j.useMemo)(()=>`${Fn}/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/ui-events/events`,[t,e]);(0,j.useEffect)(()=>{if(!n||!e||!t)return;let a=n=>{try{let i=JSON.parse(n.data);if(!i||!Array.isArray(i.events))return;r.setQueryData(F.deploymentUIEvents(e,t),e=>{let t=(e?.events??[]).concat(i.events),n=t.slice(Math.max(0,t.length-300));return{cursor:Number(i.cursor??e?.cursor??0),events:n}})}catch{}},o=Yi(i,{"ui-events":a});return()=>o.close()},[t,n,r,i,e])}var us={custom:({data:e})=>{let t=e.icon===`switch`?He:e.icon===`cloud`?Qe:e.icon===`client`?vt:Le,n=e.status===`running`?`default`:e.status===`stopped`?`secondary`:`destructive`;return(0,P.jsxs)(L,{className:`min-w-[180px] border-2 shadow-md ${e?.highlight?`border-primary ring-2 ring-primary/30`:``}`,children:[(0,P.jsx)(R,{className:`p-3 pb-2`,children:(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`p-1.5 bg-muted rounded-md`,children:(0,P.jsx)(t,{className:`w-4 h-4`})}),(0,P.jsx)(ma,{variant:n,className:`text-[10px] h-5`,children:String(e.status)})]})}),(0,P.jsxs)(V,{className:`p-3 pt-0`,children:[(0,P.jsx)(z,{className:`text-sm font-bold truncate`,children:String(e.label)}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground mt-1 truncate font-mono`,children:String(e.ip||`10.0.0.x`)}),(0,P.jsx)(Ut,{type:`target`,position:Et.Top,className:`!bg-muted-foreground`}),(0,P.jsx)(Ut,{type:`source`,position:Et.Bottom,className:`!bg-muted-foreground`})]})]})}};function ds({topology:e,workspaceId:t,deploymentId:n,enableTerminal:r}){let i=(0,j.useMemo)(()=>{if(!e||!Array.isArray(e.nodes)||e.nodes.length===0)return{nodes:[],edges:[]};let t=Math.max(1,Math.ceil(Math.sqrt(e.nodes.length)));return{nodes:e.nodes.map((e,n)=>{let r=n%t,i=Math.floor(n/t),a=String(e.kind??``),o=a.includes(`linux`)?`client`:a.includes(`ceos`)||a.includes(`eos`)?`switch`:`server`,s=String(e.status??`unknown`);return{id:String(e.id),position:{x:r*240,y:i*160},data:{label:String(e.label??e.id),icon:o,status:s,ip:String(e.mgmtIp??``),kind:a},type:`custom`}}),edges:(e.edges??[]).map(e=>({id:String(e.id),source:String(e.source),target:String(e.target),label:e.label?String(e.label):void 0,animated:!1}))}},[e]),[a,o,s]=et(i.nodes),[c,l,u]=Kt(i.edges),d=(0,j.useRef)(null),{downloadImage:f}=rs(),[p,m]=(0,j.useState)(null),[h,ee]=(0,j.useState)(null),[g,_]=(0,j.useState)(null),[y,b]=(0,j.useState)(null),[x,S]=(0,j.useState)(null),[ne,re]=(0,j.useState)(null),[ie,ae]=(0,j.useState)(!1),[oe,se]=(0,j.useState)(!1),[ce,le]=(0,j.useState)(!1),[ue,de]=(0,j.useState)(null),[fe,pe]=(0,j.useState)({}),me=(0,j.useRef)(null),he=(0,j.useRef)({}),ge=(0,j.useRef)(!1),[_e,ve]=(0,j.useState)(``),[ye,be]=(0,j.useState)(`grid`),xe=(0,j.useMemo)(()=>!t||!n?``:`skyforge.topology.positions.${t}.${n}`,[n,t]),[Se,Ce]=(0,j.useState)(()=>({})),[we,Te]=(0,j.useState)(null),[Ee,De]=(0,j.useState)(!1),[Oe,ke]=(0,j.useState)(null),[Ae,je]=(0,j.useState)(!1),[Me,Ne]=(0,j.useState)(!1),[Pe,Fe]=(0,j.useState)(null),[Ie,Le]=(0,j.useState)({side:`source`,duration:`10`,packets:`2500`,snaplen:`192`}),[C,Re]=(0,j.useState)({delayMs:``,jitterMs:``,lossPct:``,dupPct:``,corruptPct:``,reorderPct:``,rateKbps:``});(0,j.useEffect)(()=>{if(xe)try{let e=window.localStorage.getItem(xe);if(!e)return;let t=JSON.parse(e);t&&typeof t==`object`&&Ce(t)}catch{}},[xe]);let ze=!!(t&&n);ls(t??``,n??``,ze);let Be=O({queryKey:t&&n?F.deploymentUIEvents(t,n):[`deploymentUIEvents`,`none`],queryFn:async()=>({cursor:0,events:[]}),initialData:{cursor:0,events:[]},staleTime:1/0,enabled:ze}),Ve=(0,j.useMemo)(()=>ms(Be.data?.events??[]),[Be.data?.events]);(0,j.useEffect)(()=>{o(gs(i.nodes,ye,Se,_e)),he.current=Object.fromEntries(i.edges.map(e=>[String(e.id),typeof e.label==`string`?e.label:void 0])),l(hs(i.edges,fe,ce,he.current,Ve))},[i.edges,i.nodes,Ve,fe,ye,Se,_e,l,o,ce]),(0,j.useEffect)(()=>{l(e=>hs(e,fe,ce,he.current,Ve))},[Ve,fe,l,ce]),(0,j.useEffect)(()=>{if(!t||!n||ge.current)return;let e=new URLSearchParams(window.location.search),r=e.get(`node`)?.trim(),i=e.get(`action`)?.trim();if(!r||!i){ge.current=!0;return}i===`terminal`&&m({id:r}),i===`logs`&&ee({id:r}),i===`describe`&&_({id:r}),i===`interfaces`&&(Te({id:r}),De(!0)),i===`running-config`&&(ke({id:r}),je(!0)),ge.current=!0,e.delete(`node`),e.delete(`action`);let a=e.toString(),o=`${window.location.pathname}${a?`?${a}`:``}${window.location.hash||``}`;window.history.replaceState(null,``,o)},[n,t]),(0,j.useEffect)(()=>{if(!y)return;let e=()=>b(null),t=e=>{e.key===`Escape`&&b(null)};return window.addEventListener(`click`,e),window.addEventListener(`keydown`,t),()=>{window.removeEventListener(`click`,e),window.removeEventListener(`keydown`,t)}},[y]);let He=k({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return rr(t,n,e)},onSuccess:(e,t)=>{if(e?.skipped){w.message(`Save config skipped`,{description:e.message||`Node ${t}`});return}w.success(`Save config queued/applied`,{description:e.stdout||`Node ${t}`})},onError:e=>{w.error(`Save config failed`,{description:e?.message??String(e)})}}),Ue=k({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return Xn(t,n,e)},onSuccess:e=>{let t=e.results.filter(e=>e.error);if(t.length){w.error(`Link admin applied with errors`,{description:t.map(e=>`${e.node}: ${e.error}`).join(`; `)});return}w.success(`Link ${e.action} applied`)},onError:e=>w.error(`Link admin failed`,{description:e?.message??String(e)})}),We=k({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return Zn(t,n,e)},onSuccess:e=>{w.success(`Pcap captured`,{description:`${e.sizeBytes} bytes • ${e.artifactKey}`})},onError:e=>w.error(`Pcap capture failed`,{description:e?.message??String(e)})}),Ge=k({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return Qn(t,n,e)},onError:e=>w.error(`Failed to load interfaces`,{description:e?.message??String(e)})}),Ke=k({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return $n(t,n,e)},onError:e=>w.error(`Failed to load running config`,{description:e?.message??String(e)})}),qe=(0,j.useCallback)(async e=>{if(!t)return;let n=await xr(t,e),r=String(n?.fileData??``);if(!r)throw Error(`missing fileData`);let i=Uint8Array.from(atob(r),e=>e.charCodeAt(0)),a=new Blob([i],{type:`application/vnd.tcpdump.pcap`}),o=URL.createObjectURL(a),s=document.createElement(`a`);s.href=o,s.download=e.split(`/`).pop()||`capture.pcap`,s.click(),URL.revokeObjectURL(o)},[t]),Ye=(0,j.useCallback)(async()=>{if(!t||!n)return;let e=await er(t,n,`csv`),r=String(e.csv??``);if(!r.trim())throw Error(`empty inventory csv`);let i=new Blob([r],{type:`text/csv`}),a=URL.createObjectURL(i),o=document.createElement(`a`);o.href=a,o.download=`${n}-inventory.csv`,o.click(),URL.revokeObjectURL(a)},[n,t]);(0,j.useEffect)(()=>{if(!x)return;let e=()=>S(null),t=e=>{e.key===`Escape`&&S(null)};return window.addEventListener(`click`,e),window.addEventListener(`keydown`,t),()=>{window.removeEventListener(`click`,e),window.removeEventListener(`keydown`,t)}},[x]),(0,j.useEffect)(()=>{Ee&&we?.id&&Ge.mutate(we.id)},[Ge,we?.id,Ee]),(0,j.useEffect)(()=>{Ae&&Oe?.id&&Ke.mutate(Oe.id)},[Ke,Oe?.id,Ae]);let Xe=(0,j.useCallback)(e=>l(t=>Zt(e,t)),[l]),Ze=(0,j.useCallback)((e,r)=>{if(e.preventDefault(),!t||!n)return;let i=d.current?.getBoundingClientRect();S({x:i?e.clientX-i.left:e.clientX,y:i?e.clientY-i.top:e.clientY,node:r})},[n,t]),Qe=(0,j.useCallback)((e,r)=>{if(!t||!n)return;e.preventDefault();let i=d.current?.getBoundingClientRect();b({x:i?e.clientX-i.left:e.clientX,y:i?e.clientY-i.top:e.clientY,edge:r})},[n,t]),$e=(0,j.useCallback)(async(e,r)=>{if(!(!t||!n))try{se(!0);let i={edgeId:r,action:e};if(e===`set`){let e=C.delayMs.trim()?Number(C.delayMs.trim()):void 0,t=C.jitterMs.trim()?Number(C.jitterMs.trim()):void 0,n=C.lossPct.trim()?Number(C.lossPct.trim()):void 0,r=C.dupPct.trim()?Number(C.dupPct.trim()):void 0,a=C.corruptPct.trim()?Number(C.corruptPct.trim()):void 0,o=C.reorderPct.trim()?Number(C.reorderPct.trim()):void 0,s=C.rateKbps.trim()?Number(C.rateKbps.trim()):void 0;Number.isFinite(e)&&(i.delayMs=e),Number.isFinite(t)&&(i.jitterMs=t),Number.isFinite(n)&&(i.lossPct=n),Number.isFinite(r)&&(i.dupPct=r),Number.isFinite(a)&&(i.corruptPct=a),Number.isFinite(o)&&(i.reorderPct=o),Number.isFinite(s)&&(i.rateKbps=s)}let a=(await Yn(t,n,i)).results.filter(e=>e.error);a.length?w.error(`Link impairment applied with errors`,{description:a.map(e=>`${e.node}: ${e.error}`).join(`; `)}):w.success(e===`clear`?`Link impairment cleared`:`Link impairment applied`)}catch(e){w.error(`Failed to apply link impairment`,{description:e?.message??String(e)})}finally{se(!1)}},[n,C.corruptPct,C.delayMs,C.dupPct,C.jitterMs,C.lossPct,C.rateKbps,C.reorderPct,t]);return(0,j.useEffect)(()=>{if(!ce||!t||!n)return;de(null),me.current=null;let e=`/api/workspaces/${encodeURIComponent(t)}/deployments/${encodeURIComponent(n)}/links/stats/events`,r=new EventSource(e,{withCredentials:!0}),i=e=>{try{let t=JSON.parse(String(e.data??`{}`));if(t.type===`error`){de(t.error||`failed to stream link stats`);return}if(t.type!==`snapshot`||!t.snapshot)return;let n=t.snapshot,r=Date.parse(n.generatedAt||``);if(!Number.isFinite(r))return;let i={};for(let e of n.edges??[])i[String(e.edgeId)]=e;let a=me.current;if(me.current={atMs:r,byEdge:i},!a)return;let o=(r-a.atMs)/1e3;if(!(o>0))return;let s={};for(let[e,t]of Object.entries(i)){let n=a.byEdge[e];if(!n)continue;let r=(e,t)=>Math.max(0,e-t),i=r(t.sourceTxBytes,n.sourceTxBytes),c=r(t.sourceRxBytes,n.sourceRxBytes),l=r(t.targetTxBytes,n.targetTxBytes),u=r(t.targetRxBytes,n.targetRxBytes),d=Math.max(i,u)+Math.max(l,c),f=r(t.sourceTxPackets,n.sourceTxPackets),p=r(t.sourceRxPackets,n.sourceRxPackets),m=r(t.targetTxPackets,n.targetTxPackets),h=r(t.targetRxPackets,n.targetRxPackets),ee=(Math.max(f,h)+Math.max(m,p))/o,g=(r(t.sourceRxDropped,n.sourceRxDropped)+r(t.sourceTxDropped,n.sourceTxDropped)+r(t.targetRxDropped,n.targetRxDropped)+r(t.targetTxDropped,n.targetTxDropped))/o;s[e]={bps:d*8/o,pps:ee,drops:g}}pe(s)}catch(e){de(e?.message??String(e))}};return r.addEventListener(`stats`,i),r.onerror=()=>de(`link stats stream disconnected`),ir(t,n).catch(()=>{}),()=>{r.removeEventListener(`stats`,i),r.close()}},[n,ce,t]),(0,P.jsxs)(`div`,{className:`h-[600px] w-full border rounded-xl bg-background/50 overflow-hidden relative`,ref:d,children:[(0,P.jsxs)(Ft,{nodes:a,edges:c,onNodesChange:s,onEdgesChange:u,onConnect:Xe,onNodeContextMenu:Ze,onEdgeContextMenu:Qe,onNodeDragStop:(e,t)=>{xe&&Ce(e=>{let n={...e,[String(t.id)]:{x:t.position.x,y:t.position.y}};try{window.localStorage.setItem(xe,JSON.stringify(n))}catch{}return n})},nodeTypes:us,fitView:!0,className:`bg-muted/10`,children:[(0,P.jsx)(Je,{position:`top-left`,children:(0,P.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,P.jsxs)(`div`,{className:`flex items-center gap-2 rounded-md border bg-background/80 px-2 py-1 shadow-sm backdrop-blur`,children:[(0,P.jsx)(te,{className:`h-4 w-4 text-muted-foreground`}),(0,P.jsx)(J,{value:_e,onChange:e=>ve(e.target.value),placeholder:`Search nodes…`,className:`h-7 w-56 border-0 bg-transparent p-0 text-sm focus-visible:ring-0`}),_e.trim()?(0,P.jsx)(I,{variant:`ghost`,size:`sm`,className:`h-7 px-2`,onClick:()=>ve(``),children:`Clear`}):null]})})}),(0,P.jsx)(Je,{position:`top-right`,children:(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(I,{variant:ce?`default`:`outline`,size:`sm`,className:`shadow-sm bg-background/80 backdrop-blur`,onClick:()=>{le(e=>{let t=!e;return t||(de(null),pe({}),me.current=null),t})},disabled:!t||!n,title:`Show live link utilization (SSE)`,children:[(0,P.jsx)(v,{className:`mr-2 h-4 w-4`}),`Live stats`]}),(0,P.jsxs)(I,{variant:`outline`,size:`sm`,className:`shadow-sm bg-background/80 backdrop-blur`,onClick:()=>be(e=>e===`grid`?`circle`:`grid`),title:`Toggle layout`,children:[(0,P.jsx)(Xt,{className:`mr-2 h-4 w-4`}),ye===`grid`?`Grid`:`Circle`]}),(0,P.jsx)(I,{variant:`outline`,size:`sm`,className:`shadow-sm bg-background/80 backdrop-blur`,onClick:()=>{if(Ce({}),xe)try{window.localStorage.removeItem(xe)}catch{}},title:`Reset pinned node positions`,children:`Reset`}),(0,P.jsx)(I,{variant:`outline`,size:`sm`,className:`shadow-sm bg-background/80 backdrop-blur`,onClick:()=>Ye().catch(e=>w.error(`Failed to download inventory`,{description:e.message})),disabled:!t||!n,title:`Download inventory CSV`,children:`Inventory`}),(0,P.jsxs)(I,{variant:`outline`,size:`sm`,className:`shadow-sm bg-background/80 backdrop-blur`,onClick:()=>d.current&&f(d.current,`topology.png`),children:[(0,P.jsx)(ft,{className:`mr-2 h-4 w-4`}),`Download PNG`]})]})}),(0,P.jsx)(Mt,{}),(0,P.jsx)(_t,{zoomable:!0,pannable:!0,className:`bg-background border rounded-lg`}),(0,P.jsx)(Yt,{gap:12,size:1})]}),ce&&ue?(0,P.jsxs)(`div`,{className:`absolute bottom-2 left-2 z-40 rounded-md border bg-background/90 px-3 py-2 text-xs text-muted-foreground shadow-sm`,children:[`Live stats: `,ue]}):null,ze&&(Be.data?.events?.length??0)>0?(0,P.jsx)(`div`,{className:`absolute bottom-2 right-2 z-40 w-[420px] max-w-[92vw]`,children:(0,P.jsxs)(L,{className:`shadow-sm border bg-background/90 backdrop-blur`,children:[(0,P.jsx)(R,{className:`p-3 pb-2`,children:(0,P.jsx)(z,{className:`text-sm`,children:`Recent activity`})}),(0,P.jsx)(V,{className:`p-3 pt-0 space-y-2`,children:(Be.data?.events??[]).slice(-8).reverse().map(e=>(0,P.jsxs)(`div`,{className:`flex items-start justify-between gap-2 text-xs`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsx)(`div`,{className:`font-mono truncate`,children:e.eventType}),(0,P.jsx)(`div`,{className:`text-muted-foreground truncate`,children:e.createdAt})]}),(0,P.jsx)(`div`,{className:`text-muted-foreground font-mono truncate`,children:e.createdBy?e.createdBy:``})]},String(e.id)))})]})}):null,r&&t&&n?(0,P.jsx)(os,{open:!!p,onOpenChange:e=>{e||m(null)},workspaceId:t,deploymentId:n,nodeId:p?.id??``,nodeKind:p?.kind??``}):null,t&&n?(0,P.jsx)(ss,{open:!!h,onOpenChange:e=>{e||ee(null)},workspaceId:t,deploymentId:n,nodeId:h?.id??``,nodeKind:h?.kind??``,nodeIp:h?.ip??``}):null,t&&n?(0,P.jsx)(cs,{open:!!g,onOpenChange:e=>{e||_(null)},workspaceId:t,deploymentId:n,nodeId:g?.id??``,nodeKind:g?.kind??``,nodeIp:g?.ip??``}):null,(0,P.jsx)(ni,{open:Ee,onOpenChange:e=>{De(e),e||Te(null)},children:(0,P.jsxs)(ai,{className:`max-w-3xl`,children:[(0,P.jsx)(oi,{children:(0,P.jsx)(ci,{children:`Interfaces`})}),(0,P.jsx)(_s,{node:we?.id??``,data:Ge.data,loading:Ge.isPending,error:Ge.isError?Ge.error?.message??`failed`:``})]})}),(0,P.jsx)(ni,{open:Ae,onOpenChange:e=>{je(e),e||ke(null)},children:(0,P.jsxs)(ai,{className:`max-w-4xl`,children:[(0,P.jsx)(oi,{children:(0,P.jsx)(ci,{children:`Running config`})}),(0,P.jsx)(vs,{node:Oe?.id??``,data:Ke.data,loading:Ke.isPending,error:Ke.isError?Ke.error?.message??`failed`:``})]})}),x&&t&&n?(0,P.jsx)(`div`,{className:`absolute z-50`,style:{left:x.x,top:x.y},onContextMenu:e=>e.preventDefault(),children:(0,P.jsxs)(L,{className:`w-64 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,P.jsxs)(R,{className:`p-3 pb-2`,children:[(0,P.jsx)(z,{className:`text-sm`,children:`Node Actions`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:String(x.node?.data?.label??x.node.id)})]}),(0,P.jsxs)(V,{className:`p-3 pt-0 space-y-2`,children:[(0,P.jsx)(I,{size:`sm`,className:`w-full`,disabled:!r,onClick:()=>{let e=String(x.node?.data?.kind??``);S(null),m({id:String(x.node.id),kind:e})},children:`Open terminal…`}),(0,P.jsx)(I,{size:`sm`,variant:`outline`,className:`w-full`,disabled:!r,onClick:()=>{let e=String(x.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=terminal`;window.open(t,`_blank`,`noopener,noreferrer`),S(null)},children:`Open terminal (new tab)`}),(0,P.jsx)(I,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(x.node?.data?.kind??``),t=String(x.node?.data?.ip??``);S(null),ee({id:String(x.node.id),kind:e,ip:t})},children:`View logs…`}),(0,P.jsx)(I,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(x.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=logs`;window.open(t,`_blank`,`noopener,noreferrer`),S(null)},children:`View logs (new tab)`}),(0,P.jsx)(I,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(x.node?.data?.kind??``),t=String(x.node?.data?.ip??``);S(null),_({id:String(x.node.id),kind:e,ip:t})},children:`Describe…`}),(0,P.jsx)(I,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(x.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=describe`;window.open(t,`_blank`,`noopener,noreferrer`),S(null)},children:`Describe (new tab)`}),(0,P.jsx)(I,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(x.node?.data?.kind??``),t=String(x.node?.data?.ip??``),n=String(x.node.id);S(null),Te({id:n,kind:e,ip:t}),De(!0)},children:`Interfaces…`}),(0,P.jsx)(I,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(x.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=interfaces`;window.open(t,`_blank`,`noopener,noreferrer`),S(null)},children:`Interfaces (new tab)`}),(0,P.jsx)(I,{size:`sm`,variant:`secondary`,className:`w-full`,disabled:He.isPending,onClick:()=>{let e=String(x.node.id);S(null),He.mutate(e)},children:He.isPending?`Saving…`:`Save config`}),(0,P.jsx)(I,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(x.node.id);S(null),ke({id:e}),je(!0)},children:`Running config…`}),(0,P.jsx)(I,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(x.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=running-config`;window.open(t,`_blank`,`noopener,noreferrer`),S(null)},children:`Running config (new tab)`}),(0,P.jsx)(I,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>{let e=String(x.node?.data?.ip??``).trim();if(!e){w.error(`No management IP available`);return}navigator.clipboard?.writeText(e),w.success(`Copied management IP`),S(null)},children:`Copy management IP`}),(0,P.jsx)(I,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>{let e=String(x.node.id);navigator.clipboard?.writeText(e),w.success(`Copied node name`),S(null)},children:`Copy node name`}),(0,P.jsx)(I,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>S(null),children:`Close`})]})]})}):null,y&&t&&n?(0,P.jsx)(`div`,{className:`absolute z-50`,style:{left:y.x,top:y.y},onContextMenu:e=>e.preventDefault(),children:(0,P.jsxs)(L,{className:`w-64 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,P.jsxs)(R,{className:`p-3 pb-2`,children:[(0,P.jsx)(z,{className:`text-sm`,children:`Link Actions`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:String(y.edge.label??y.edge.id)})]}),(0,P.jsxs)(V,{className:`p-3 pt-0 space-y-2`,children:[(0,P.jsx)(I,{size:`sm`,variant:Ve.edgeDown.has(String(y.edge.id))?`secondary`:`destructive`,className:`w-full`,disabled:Ue.isPending,onClick:()=>{let e=String(y.edge.id),t=Ve.edgeDown.has(e);b(null),Ue.mutate({edgeId:e,action:t?`up`:`down`})},children:Ve.edgeDown.has(String(y.edge.id))?`Bring link up`:`Bring link down`}),(0,P.jsx)(I,{size:`sm`,variant:`outline`,className:`w-full`,disabled:We.isPending,onClick:()=>{Fe({id:String(y.edge.id),label:String(y.edge.label??``)}),b(null),Ne(!0)},children:`Capture pcap…`}),Ve.lastCaptureByEdge[String(y.edge.id)]?(0,P.jsx)(I,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=Ve.lastCaptureByEdge[String(y.edge.id)];b(null),qe(e).catch(e=>w.error(`Failed to download pcap`,{description:e.message}))},children:`Download last pcap`}):null,(0,P.jsx)(I,{size:`sm`,className:`w-full`,onClick:()=>{re({id:String(y.edge.id),label:String(y.edge.label??``)}),b(null),ae(!0)},children:`Configure impairment…`}),(0,P.jsx)(I,{size:`sm`,variant:`secondary`,className:`w-full`,disabled:oe,onClick:()=>{let e=String(y.edge.id);b(null),$e(`clear`,e)},children:`Clear impairment`}),(0,P.jsx)(I,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>b(null),children:`Close`})]})]})}):null,(0,P.jsx)(ni,{open:Me,onOpenChange:e=>{Ne(e),e||Fe(null)},children:(0,P.jsxs)(ai,{className:`max-w-lg`,children:[(0,P.jsx)(oi,{children:(0,P.jsx)(ci,{children:`Capture pcap`})}),(0,P.jsxs)(`div`,{className:`space-y-4`,children:[Pe?.label?(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:Pe.label}):null,(0,P.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{htmlFor:`capSide`,children:`Side`}),(0,P.jsxs)(`select`,{id:`capSide`,className:`h-9 w-full rounded-md border bg-background px-3 text-sm`,value:Ie.side,onChange:e=>Le(t=>({...t,side:e.target.value})),children:[(0,P.jsx)(`option`,{value:`source`,children:`Source`}),(0,P.jsx)(`option`,{value:`target`,children:`Target`})]})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{htmlFor:`capDuration`,children:`Duration (s)`}),(0,P.jsx)(J,{id:`capDuration`,inputMode:`numeric`,value:Ie.duration,onChange:e=>Le(t=>({...t,duration:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{htmlFor:`capPackets`,children:`Max packets`}),(0,P.jsx)(J,{id:`capPackets`,inputMode:`numeric`,value:Ie.packets,onChange:e=>Le(t=>({...t,packets:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{htmlFor:`capSnaplen`,children:`Snaplen`}),(0,P.jsx)(J,{id:`capSnaplen`,inputMode:`numeric`,value:Ie.snaplen,onChange:e=>Le(t=>({...t,snaplen:e.target.value}))})]})]}),(0,P.jsxs)(`div`,{className:`flex gap-2 justify-end`,children:[(0,P.jsx)(I,{variant:`secondary`,onClick:()=>Ne(!1),disabled:We.isPending,children:`Cancel`}),(0,P.jsx)(I,{onClick:()=>{let e=String(Pe?.id??``);if(!e){w.error(`No link selected`);return}let t=Number(Ie.duration.trim()||`10`),n=Number(Ie.packets.trim()||`2500`),r=Number(Ie.snaplen.trim()||`192`);We.mutateAsync({edgeId:e,side:Ie.side,durationSeconds:t,maxPackets:n,snaplen:r}).then(e=>(w.success(`Pcap ready`,{description:e.artifactKey}),qe(e.artifactKey).catch(()=>{}))).finally(()=>Ne(!1))},disabled:We.isPending,children:We.isPending?`Capturing…`:`Capture`})]})]})]})}),(0,P.jsx)(ni,{open:ie,onOpenChange:e=>{ae(e),e||re(null)},children:(0,P.jsxs)(ai,{className:`max-w-lg`,children:[(0,P.jsx)(oi,{children:(0,P.jsx)(ci,{children:`Configure Link Impairment`})}),(0,P.jsxs)(`div`,{className:`space-y-4`,children:[ne?.label?(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:ne.label}):null,(0,P.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{htmlFor:`delayMs`,children:`Delay (ms)`}),(0,P.jsx)(J,{id:`delayMs`,inputMode:`numeric`,placeholder:`e.g. 50`,value:C.delayMs,onChange:e=>Re(t=>({...t,delayMs:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{htmlFor:`jitterMs`,children:`Jitter (ms)`}),(0,P.jsx)(J,{id:`jitterMs`,inputMode:`numeric`,placeholder:`e.g. 10`,value:C.jitterMs,onChange:e=>Re(t=>({...t,jitterMs:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{htmlFor:`lossPct`,children:`Loss (%)`}),(0,P.jsx)(J,{id:`lossPct`,inputMode:`decimal`,placeholder:`e.g. 1.0`,value:C.lossPct,onChange:e=>Re(t=>({...t,lossPct:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{htmlFor:`dupPct`,children:`Duplicate (%)`}),(0,P.jsx)(J,{id:`dupPct`,inputMode:`decimal`,placeholder:`e.g. 0.1`,value:C.dupPct,onChange:e=>Re(t=>({...t,dupPct:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{htmlFor:`corruptPct`,children:`Corrupt (%)`}),(0,P.jsx)(J,{id:`corruptPct`,inputMode:`decimal`,placeholder:`e.g. 0.05`,value:C.corruptPct,onChange:e=>Re(t=>({...t,corruptPct:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{htmlFor:`reorderPct`,children:`Reorder (%)`}),(0,P.jsx)(J,{id:`reorderPct`,inputMode:`decimal`,placeholder:`e.g. 0.2`,value:C.reorderPct,onChange:e=>Re(t=>({...t,reorderPct:e.target.value}))})]}),(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(q,{htmlFor:`rateKbps`,children:`Rate (kbit/s)`}),(0,P.jsx)(J,{id:`rateKbps`,inputMode:`numeric`,placeholder:`e.g. 100000`,value:C.rateKbps,onChange:e=>Re(t=>({...t,rateKbps:e.target.value}))})]})]}),(0,P.jsxs)(`div`,{className:`flex gap-2 justify-end`,children:[(0,P.jsx)(I,{variant:`secondary`,onClick:()=>ae(!1),disabled:oe,children:`Cancel`}),(0,P.jsx)(I,{onClick:()=>{let e=String(ne?.id??``);if(!e){w.error(`No link selected`);return}$e(`set`,e).finally(()=>ae(!1))},disabled:oe,children:`Apply`})]})]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Tip: Right-click a link in the topology to configure impairment.`})]})})]})}function fs(e){return e>0?e>=1e9?`${(e/1e9).toFixed(2)} Gbps`:e>=1e6?`${(e/1e6).toFixed(1)} Mbps`:e>=1e3?`${(e/1e3).toFixed(0)} Kbps`:`${Math.round(e)} bps`:`0 bps`}function ps(e){if(!Number.isFinite(e)||e<=0)return`0 B`;let t=[`B`,`KB`,`MB`,`GB`,`TB`],n=e,r=0;for(;n>=1024&&r<t.length-1;)n/=1024,r++;let i=r===0||r===1?0:1;return`${n.toFixed(i)} ${t[r]}`}function ms(e){let t=new Set,n={};for(let r of e??[]){let e=String(r?.eventType??``),i=r?.payload??{},a=String(i?.edgeId??``).trim();if(a&&(e===`link.down`&&t.add(a),e===`link.up`&&t.delete(a),e===`link.capture`)){let e=String(i?.artifactKey??``).trim();e&&(n[a]=e)}}return{edgeDown:t,lastCaptureByEdge:n}}function hs(e,t,n,r,i){return e.map(e=>{let a=String(e.id),o=r[a]??(typeof e.label==`string`?e.label:void 0),s=i.edgeDown.has(a);if(!n)return{...e,label:s?o?`${o} · DOWN`:`DOWN`:o,animated:!1,style:s?{stroke:`hsl(var(--destructive))`,strokeWidth:2,strokeDasharray:`6 6`}:void 0};let c=t[a];if(!c)return{...e,label:s?o?`${o} · DOWN`:`DOWN`:o,animated:!1,style:s?{stroke:`hsl(var(--destructive))`,strokeWidth:2,strokeDasharray:`6 6`}:void 0};let l=c.bps??0,u=1+Math.min(9,Math.log10(Math.max(1,l))/1.2),d=o?`${o} · ${fs(l)}`:fs(l),f=s?`${d} · DOWN`:d;return{...e,label:f,animated:!s&&l>0,style:{...e.style??{},strokeWidth:u,...s?{stroke:`hsl(var(--destructive))`,strokeDasharray:`6 6`}:{}}}})}function gs(e,t,n,r){let i=r.trim().toLowerCase(),a=new Set;if(i)for(let t of e){let e=String(t?.data?.label??t.id).toLowerCase(),n=String(t.id).toLowerCase(),r=String(t?.data?.ip??``).toLowerCase();(e.includes(i)||n.includes(i)||r.includes(i))&&a.add(String(t.id))}let o=e.length||1,s=Math.max(260,o*30);return e.map((e,r)=>{let c=String(e.id),l=n[c],u=l??e.position;if(!l&&t===`circle`){let e=r/o*Math.PI*2;u={x:Math.cos(e)*s,y:Math.sin(e)*s}}let d=i?a.has(c):!1,f=i?!a.has(c):!1;return{...e,position:u,data:{...e.data,highlight:d},style:f?{...e.style??{},opacity:.25}:e.style}})}function _s(e){if(e.loading)return(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading…`});if(e.error)return(0,P.jsx)(`div`,{className:`text-sm text-destructive`,children:e.error});let t=e.data?.interfaces??[];return t.length?(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:e.node}),(0,P.jsx)(`div`,{className:`rounded-md border overflow-auto max-h-[60vh]`,children:(0,P.jsxs)(`table`,{className:`w-full text-xs`,children:[(0,P.jsx)(`thead`,{className:`bg-muted/50 sticky top-0`,children:(0,P.jsxs)(`tr`,{children:[(0,P.jsx)(`th`,{className:`text-left p-2`,children:`Interface`}),(0,P.jsx)(`th`,{className:`text-left p-2`,children:`Peer`}),(0,P.jsx)(`th`,{className:`text-left p-2`,children:`State`}),(0,P.jsx)(`th`,{className:`text-right p-2`,children:`RX`}),(0,P.jsx)(`th`,{className:`text-right p-2`,children:`TX`}),(0,P.jsx)(`th`,{className:`text-right p-2`,children:`Drops`})]})}),(0,P.jsx)(`tbody`,{children:t.map(e=>(0,P.jsxs)(`tr`,{className:`border-t`,children:[(0,P.jsx)(`td`,{className:`p-2 font-mono`,children:e.ifName}),(0,P.jsx)(`td`,{className:`p-2 font-mono text-muted-foreground`,children:e.peerNode?`${e.peerNode}:${e.peerIf??``}`:`—`}),(0,P.jsx)(`td`,{className:`p-2`,children:e.operState??`—`}),(0,P.jsx)(`td`,{className:`p-2 text-right font-mono`,children:ps(Number(e.rxBytes??0))}),(0,P.jsx)(`td`,{className:`p-2 text-right font-mono`,children:ps(Number(e.txBytes??0))}),(0,P.jsx)(`td`,{className:`p-2 text-right font-mono`,children:Number(e.rxDropped??0)+Number(e.txDropped??0)})]},e.ifName))})]})})]}):(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No interfaces found.`})}function vs(e){if(e.loading)return(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading…`});if(e.error)return(0,P.jsx)(`div`,{className:`text-sm text-destructive`,children:e.error});if(e.data?.skipped)return(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:e.data.message||`Skipped`});let t=String(e.data?.stdout??``);return(0,P.jsxs)(`div`,{className:`space-y-3`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:e.node}),(0,P.jsx)(I,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(t),w.success(`Copied running config`)},disabled:!t,children:`Copy`})]}),(0,P.jsx)(`pre`,{className:`max-h-[65vh] overflow-auto rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100 whitespace-pre-wrap`,children:t||`No output`}),e.data?.stderr?(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground whitespace-pre-wrap`,children:e.data.stderr}):null]})}const ys=D(`/dashboard/deployments/$deploymentId/`)({component:bs});function bs(){let{deploymentId:e}=ys.useParams(),t=_n(),n=E();Do(!0);let[r,a]=(0,j.useState)(!1),[o,s]=(0,j.useState)(!1),[c,l]=(0,j.useState)(``),u=O({queryKey:F.dashboardSnapshot(),queryFn:async()=>null,initialData:null,retry:!1,staleTime:1/0}),d=(0,j.useMemo)(()=>(u.data?.deployments??[]).find(t=>t.id===e),[u.data?.deployments,e]);(0,j.useEffect)(()=>{let e=!!(d?.config??{}).forwardEnabled,t=String((d?.config??{}).forwardCollectorUsername??``).trim();s(e),l(t)},[d?.id,d?.config]);let f=String(d?.activeTaskId??``);Wo(f,!!f);let p=O({queryKey:F.runLogs(f),queryFn:async()=>({cursor:0,entries:[]}),retry:!1,staleTime:1/0,enabled:!!f});if(!u.data&&!d)return(0,P.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,P.jsx)(K,{className:`h-10 w-32`}),(0,P.jsx)(K,{className:`h-10 w-48`})]}),(0,P.jsx)(K,{className:`h-[400px] w-full`})]});if(!d)return(0,P.jsx)(`div`,{className:`p-6`,children:(0,P.jsx)(oa,{icon:i,title:`Deployment not found`,description:`This deployment may have been deleted or you don't have access.`,action:{label:`Back to Deployments`,onClick:()=>t({to:`/dashboard/deployments`})}})});let m=async()=>{try{await Ir(d.workspaceId,d.id),w.success(`Deployment starting`,{description:`${d.name} is queued to start.`})}catch(e){w.error(`Failed to start`,{description:e.message})}},h=async()=>{try{await Lr(d.workspaceId,d.id),w.success(`Deployment stopping`,{description:`${d.name} is queued to stop.`})}catch(e){w.error(`Failed to stop`,{description:e.message})}},ee=async()=>{try{await Rr(d.workspaceId,d.id),w.success(`Deployment deleted`),await n.invalidateQueries({queryKey:F.dashboardSnapshot()}),t({to:`/dashboard/deployments`,search:{workspace:d.workspaceId}})}catch(e){w.error(`Failed to delete`,{description:e.message})}},g=d.activeTaskStatus??d.lastStatus??`unknown`,_=!!d.activeTaskId,v=(0,j.useMemo)(()=>{let e=(u.data?.runs??[]).filter(e=>String(e.workspaceId??``)===d.workspaceId),t=e.filter(e=>String(e.deploymentId??``)===d.id);return t.length>0?t:e},[d.id,d.workspaceId,u.data?.runs]),b=O({queryKey:F.deploymentTopology(d.workspaceId,d.id),queryFn:async()=>ur(d.workspaceId,d.id),enabled:[`containerlab`,`netlab-c9s`,`clabernetes`].includes(d.type),retry:!1,staleTime:1e4}),x=k({mutationFn:async e=>rr(d.workspaceId,d.id,e),onSuccess:(e,t)=>{if(e?.skipped){w.message(`Save config skipped`,{description:e.message||`Node ${t}`});return}w.success(`Save config queued/applied`,{description:e.stdout||`Node ${t}`})},onError:e=>w.error(`Save config failed`,{description:e.message})}),S=O({queryKey:F.forwardCollectors(),queryFn:Kn,enabled:o,retry:!1,staleTime:3e4}),te=S.data?.collectors??[],ne=k({mutationFn:async e=>qn(d.workspaceId,d.id,e),onSuccess:async()=>{w.success(`Forward settings updated`),await n.invalidateQueries({queryKey:F.dashboardSnapshot()})},onError:e=>w.error(`Failed to update Forward settings`,{description:e.message})}),re=k({mutationFn:async()=>Jn(d.workspaceId,d.id),onSuccess:async e=>{w.success(`Forward sync queued`,{description:`Run ${String(e.run?.id??``)}`}),await n.invalidateQueries({queryKey:F.dashboardSnapshot()})},onError:e=>w.error(`Failed to sync to Forward`,{description:e.message})});return(0,P.jsxs)(`div`,{className:`space-y-6 p-6 pb-20`,children:[(0,P.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,P.jsx)(T,{to:`/dashboard/deployments`,className:xi({variant:`outline`,size:`icon`,className:`h-9 w-9`}),children:(0,P.jsx)(xe,{className:`h-4 w-4`})}),(0,P.jsxs)(`div`,{children:[(0,P.jsxs)(`h1`,{className:`text-2xl font-bold tracking-tight flex items-center gap-3`,children:[d.name,(0,P.jsx)(xs,{status:g})]}),(0,P.jsxs)(`p`,{className:`text-sm text-muted-foreground flex items-center gap-2 mt-1`,children:[(0,P.jsx)(`span`,{className:`font-mono text-xs bg-muted px-1.5 py-0.5 rounded`,children:d.id}),(0,P.jsx)(`span`,{children:`•`}),(0,P.jsx)(`span`,{className:`capitalize`,children:d.type})]})]})]}),(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsxs)(I,{variant:`outline`,size:`sm`,onClick:m,disabled:_,children:[(0,P.jsx)(Ht,{className:`mr-2 h-4 w-4`}),` Start`]}),(0,P.jsxs)(I,{variant:`outline`,size:`sm`,onClick:h,disabled:_,children:[(0,P.jsx)(ke,{className:`mr-2 h-4 w-4`}),` Stop`]}),(0,P.jsxs)(I,{variant:`destructive`,size:`sm`,onClick:()=>a(!0),disabled:_,children:[(0,P.jsx)(Se,{className:`mr-2 h-4 w-4`}),` Delete`]})]})]}),(0,P.jsxs)(Za,{defaultValue:`topology`,className:`space-y-6`,children:[(0,P.jsxs)(Qa,{children:[(0,P.jsxs)($a,{value:`topology`,className:`gap-2`,children:[(0,P.jsx)(He,{className:`h-4 w-4`}),` Topology`]}),(0,P.jsxs)($a,{value:`logs`,className:`gap-2`,children:[(0,P.jsx)(y,{className:`h-4 w-4`}),` Logs & Events`]}),(0,P.jsxs)($a,{value:`config`,className:`gap-2`,children:[(0,P.jsx)(At,{className:`h-4 w-4`}),` Configuration`]})]}),(0,P.jsxs)(eo,{value:`topology`,className:`space-y-6 animate-in fade-in-50`,children:[(0,P.jsxs)(L,{children:[(0,P.jsx)(R,{className:`pb-3`,children:(0,P.jsx)(`div`,{className:`flex items-center justify-between`,children:(0,P.jsxs)(`div`,{children:[(0,P.jsx)(z,{children:`Network Topology`}),(0,P.jsx)(B,{children:d.type===`containerlab`?`Derived from containerlab after deploy (includes resolved mgmt IPs).`:d.type===`netlab-c9s`||d.type===`clabernetes`?`Derived from clabernetes after deploy (includes resolved mgmt IPs).`:`Topology is provider-dependent; not yet implemented for this deployment type.`})]})})}),(0,P.jsx)(V,{children:(0,P.jsx)(ds,{topology:b.data,workspaceId:d.workspaceId,deploymentId:d.id,enableTerminal:[`netlab-c9s`,`clabernetes`].includes(d.type)})})]}),b.data?.nodes?.length?(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Nodes`}),(0,P.jsx)(B,{children:`Quick actions (opens in a new tab where applicable).`})]}),(0,P.jsx)(V,{children:(0,P.jsx)(`div`,{className:`space-y-2`,children:b.data.nodes.map(e=>{let t=String(e.id),n=String(e.kind??``),r=String(e.mgmtIp??``),i=String(e.status??``),a=`${window.location.pathname}?node=${encodeURIComponent(t)}`;return(0,P.jsxs)(`div`,{className:`flex flex-col gap-2 rounded-md border p-3 md:flex-row md:items-center md:justify-between`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:t}),i?(0,P.jsx)(ma,{variant:`secondary`,className:`capitalize`,children:i}):null,n?(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground truncate`,children:n}):null]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate mt-1`,children:r||`—`})]}),(0,P.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,P.jsx)(I,{size:`sm`,variant:`outline`,disabled:![`netlab-c9s`,`clabernetes`].includes(d.type),onClick:()=>window.open(`${a}&action=terminal`,`_blank`,`noopener,noreferrer`),children:`Terminal`}),(0,P.jsx)(I,{size:`sm`,variant:`outline`,onClick:()=>window.open(`${a}&action=logs`,`_blank`,`noopener,noreferrer`),children:`Logs`}),(0,P.jsx)(I,{size:`sm`,variant:`outline`,onClick:()=>window.open(`${a}&action=describe`,`_blank`,`noopener,noreferrer`),children:`Describe`}),(0,P.jsx)(I,{size:`sm`,variant:`outline`,disabled:x.isPending,onClick:()=>x.mutate(t),children:x.isPending?`Saving…`:`Save config`}),(0,P.jsx)(I,{size:`sm`,variant:`ghost`,onClick:()=>{if(!r.trim()){w.error(`No management IP available`);return}navigator.clipboard?.writeText(r),w.success(`Copied management IP`)},children:`Copy IP`})]})]},t)})})})]}):null]}),(0,P.jsx)(eo,{value:`logs`,className:`space-y-6 animate-in fade-in-50`,children:(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Logs & Events`}),(0,P.jsx)(B,{children:`Live task output.`})]}),(0,P.jsxs)(V,{children:[d.activeTaskId?(0,P.jsxs)(`div`,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsxs)(`div`,{className:`text-sm font-medium`,children:[`Active run: `,String(d.activeTaskId)]}),(0,P.jsx)(T,{to:`/dashboard/runs/$runId`,params:{runId:String(d.activeTaskId)},className:xi({variant:`outline`,size:`sm`}),children:`Open run details`})]}),(0,P.jsx)(`div`,{className:`rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100`,children:(0,P.jsx)(Ss,{entries:p.data?.entries??[]})})]}):(0,P.jsxs)(`div`,{className:`flex flex-col items-center justify-center py-10 text-center text-muted-foreground border-2 border-dashed rounded-lg`,children:[(0,P.jsx)(y,{className:`h-10 w-10 mb-3 opacity-20`}),(0,P.jsx)(`p`,{children:`No active run.`}),(0,P.jsx)(`p`,{className:`text-xs mt-1`,children:`Start/stop/destroy will queue runs that appear here.`})]}),(0,P.jsxs)(`div`,{className:`mt-8 space-y-3`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Recent runs`}),(0,P.jsx)(`div`,{className:`space-y-2`,children:v.length===0?(0,P.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No runs yet.`}):v.slice(0,10).map(e=>{let t=String(e.id??``);return(0,P.jsxs)(`div`,{className:`flex items-center justify-between gap-3 rounded-md border p-3`,children:[(0,P.jsxs)(`div`,{className:`min-w-0`,children:[(0,P.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,P.jsx)(`span`,{className:`font-mono text-xs`,children:t}),(0,P.jsx)(ma,{variant:`secondary`,className:`capitalize`,children:String(e.status??``)}),(0,P.jsx)(`span`,{className:`text-xs text-muted-foreground truncate`,children:String(e.tpl_alias??e.type??``)})]}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground truncate mt-1`,children:String(e.status_text??e.message??``)})]}),(0,P.jsx)(T,{to:`/dashboard/runs/$runId`,params:{runId:t},className:xi({variant:`outline`,size:`sm`}),children:`View`})]},t)})})]})]})]})}),(0,P.jsxs)(eo,{value:`config`,className:`space-y-6 animate-in fade-in-50`,children:[(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Forward Networks`}),(0,P.jsx)(B,{children:`Optional: sync device IPs into Forward for collection.`})]}),(0,P.jsxs)(V,{className:`space-y-4`,children:[(0,P.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,P.jsxs)(`div`,{className:`space-y-1`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Enable Forward collection`}),(0,P.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Requires configuring your Collector first.`})]}),(0,P.jsx)(Oa,{checked:o,disabled:ne.isPending,onCheckedChange:e=>{s(e);let t=e?c.trim():``;ne.mutate({enabled:e,collectorUsername:t||void 0})}})]}),o?(0,P.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,P.jsxs)(`div`,{className:`space-y-2`,children:[(0,P.jsx)(`div`,{className:`text-sm font-medium`,children:`Collector`}),(0,P.jsxs)(Ua,{value:c,onValueChange:e=>{l(e),ne.mutate({enabled:!0,collectorUsername:e})},disabled:S.isLoading||S.isError||ne.isPending,children:[(0,P.jsx)(Ga,{children:(0,P.jsx)(Wa,{placeholder:S.isLoading?`Loading…`:S.isError?`Configure Collector first`:`Select collector…`})}),(0,P.jsx)(Ja,{children:te.map(e=>(0,P.jsxs)(Y,{value:e.username,children:[e.name,` (`,e.username,`)`]},e.id||e.username))})]})]}),(0,P.jsx)(`div`,{className:`flex items-end gap-2`,children:(0,P.jsx)(I,{variant:`outline`,onClick:()=>re.mutate(),disabled:!c.trim()||re.isPending||ne.isPending,children:re.isPending?`Queueing…`:`Sync now`})})]}):null]})]}),(0,P.jsxs)(L,{children:[(0,P.jsxs)(R,{children:[(0,P.jsx)(z,{children:`Configuration`}),(0,P.jsx)(B,{children:`Read-only view of the deployment parameters.`})]}),(0,P.jsx)(V,{children:(0,P.jsx)(`pre`,{className:`bg-muted p-4 rounded-lg overflow-auto font-mono text-xs max-h-[500px]`,children:JSON.stringify(d.config,null,2)})})]})]})]}),(0,P.jsx)(ja,{open:r,onOpenChange:a,children:(0,P.jsxs)(Pa,{children:[(0,P.jsxs)(Fa,{children:[(0,P.jsx)(La,{children:`Delete deployment?`}),(0,P.jsxs)(Ra,{children:[`This will remove `,(0,P.jsx)(`strong`,{children:d.name}),` from Skyforge and trigger provider cleanup. This action cannot be undone.`]})]}),(0,P.jsxs)(Ia,{children:[(0,P.jsx)(Ba,{children:`Cancel`}),(0,P.jsx)(za,{onClick:ee,className:xi({variant:`destructive`}),children:`Delete Deployment`})]})]})})]})}function xs({status:e}){let t=`secondary`,n=e.toLowerCase();return[`running`,`active`,`healthy`,`succeeded`,`success`].includes(n)&&(t=`default`),[`failed`,`error`,`stopped`,`crashloopbackoff`].includes(n)&&(t=`destructive`),(0,P.jsx)(ma,{variant:t,className:`capitalize`,children:e})}function Ss(e){let t=(0,j.useRef)(null);return(0,j.useEffect)(()=>{let e=t.current;e&&(e.scrollTop=e.scrollHeight)},[e.entries.length]),e.entries.length===0?(0,P.jsx)(`div`,{className:`text-zinc-500`,children:`Waiting for output…`}):(0,P.jsx)(`div`,{ref:t,className:`max-h-[65vh] overflow-auto whitespace-pre-wrap`,children:e.entries.map((e,t)=>(0,P.jsxs)(`div`,{children:[(0,P.jsx)(`span`,{className:`text-zinc-500 select-none`,children:e.time?`${e.time} `:``}),(0,P.jsx)(`span`,{children:e.output})]},`${e.time}-${t}`))})}var Cs=sa.update({id:`/webhooks`,path:`/webhooks`,getParentRoute:()=>H}),ws=ua.update({id:`/syslog`,path:`/syslog`,getParentRoute:()=>H}),Ts=Sa.update({id:`/status`,path:`/status`,getParentRoute:()=>H}),Es=Ta.update({id:`/snmp`,path:`/snmp`,getParentRoute:()=>H}),Ds=Va.update({id:`/notifications`,path:`/notifications`,getParentRoute:()=>H}),Os=to.update({id:`/design`,path:`/design`,getParentRoute:()=>H}),ks=ro.update({id:`/`,path:`/`,getParentRoute:()=>H}),As=ao.update({id:`/dashboard/`,path:`/dashboard/`,getParentRoute:()=>H}),js=so.update({id:`/admin/`,path:`/admin/`,getParentRoute:()=>H}),Ms=lo.update({id:`/dashboard/s3`,path:`/dashboard/s3`,getParentRoute:()=>H}),Ns=po.update({id:`/dashboard/pki`,path:`/dashboard/pki`,getParentRoute:()=>H}),Ps=ho.update({id:`/dashboard/forward`,path:`/dashboard/forward`,getParentRoute:()=>H}),Fs=_o.update({id:`/admin/settings`,path:`/admin/settings`,getParentRoute:()=>H}),Is=bo.update({id:`/admin/governance`,path:`/admin/governance`,getParentRoute:()=>H}),Ls=To.update({id:`/dashboard/workspaces/`,path:`/dashboard/workspaces/`,getParentRoute:()=>H}),Rs=ko.update({id:`/dashboard/deployments/`,path:`/dashboard/deployments/`,getParentRoute:()=>H}),zs=Bo.update({id:`/dashboard/workspaces/new`,path:`/dashboard/workspaces/new`,getParentRoute:()=>H}),Bs=Ho.update({id:`/dashboard/workspaces/$workspaceId`,path:`/dashboard/workspaces/$workspaceId`,getParentRoute:()=>H}),Vs=Go.update({id:`/dashboard/runs/$runId`,path:`/dashboard/runs/$runId`,getParentRoute:()=>H}),Hs={IndexRoute:ks,DesignRoute:Os,NotificationsRoute:Ds,SnmpRoute:Es,StatusRoute:Ts,SyslogRoute:ws,WebhooksRoute:Cs,AdminGovernanceRoute:Is,AdminSettingsRoute:Fs,DashboardForwardRoute:Ps,DashboardPkiRoute:Ns,DashboardS3Route:Ms,AdminIndexRoute:js,DashboardIndexRoute:As,DashboardDeploymentsNewRoute:es.update({id:`/dashboard/deployments/new`,path:`/dashboard/deployments/new`,getParentRoute:()=>H}),DashboardRunsRunIdRoute:Vs,DashboardWorkspacesWorkspaceIdRoute:Bs,DashboardWorkspacesNewRoute:zs,DashboardDeploymentsIndexRoute:Rs,DashboardWorkspacesIndexRoute:Ls,DashboardDeploymentsDeploymentIdIndexRoute:ys.update({id:`/dashboard/deployments/$deploymentId/`,path:`/dashboard/deployments/$deploymentId/`,getParentRoute:()=>H})};const Us=xn({routeTree:H._addFileChildren(Hs)._addFileTypes(),context:{queryClient:void 0}});var Ws=new hn;Nn.createRoot(document.getElementById(`root`)).render((0,P.jsx)(j.StrictMode,{children:(0,P.jsx)(bn,{client:Ws,children:(0,P.jsx)(vn,{router:Us,context:{queryClient:Ws}})})}));