import{a as e}from"./rolldown-runtime-DAKAggwm.js";import{a as t,c as n,d as r,f as i,h as a,i as o,l as s,m as c,n as l,o as u,p as d,r as f,s as p,t as m,u as h}from"./tanstack-D1yHXwnB.js";import{$ as g,$n as _,$t as v,A as y,An as b,At as x,B as S,Bn as C,Bt as w,C as T,Cn as E,Ct as D,D as O,Dn as ee,Dt as k,E as te,En as ne,Et as re,F as ie,Fn as ae,Ft as oe,G as A,Gn as j,Gt as se,H as ce,Hn as le,Ht as ue,I as de,In as fe,It as pe,J as me,Jn as he,Jt as ge,K as _e,Kn as ve,Kt as ye,L as be,Ln as xe,Lt as Se,M as Ce,Mn as we,Mt as Te,N as Ee,Nn as De,Nt as Oe,O as ke,On as Ae,Ot as je,P as M,Pn as Me,Pt as Ne,Q as Pe,Qn as Fe,Qt as Ie,R as N,Rn as Le,Rt as Re,S as ze,Sn as Be,St as Ve,T as He,Tn as Ue,Tt as We,U as Ge,Un as Ke,Ut as qe,V as Je,Vn as Ye,Vt as Xe,W as Ze,Wn as Qe,Wt as $e,X as et,Xt as tt,Y as nt,Yn as rt,Yt as it,Z as at,Zt as ot,_ as st,_n as ct,_t as lt,a as ut,an as dt,at as ft,b as pt,bn as mt,bt as ht,c as gt,cn as _t,ct as vt,d as yt,dn as bt,dt as xt,en as St,et as Ct,f as wt,fn as Tt,ft as Et,g as Dt,gn as Ot,gt as kt,h as At,hn as jt,ht as Mt,i as Nt,in as Pt,it as Ft,j as It,jn as Lt,jt as Rt,k as zt,kn as Bt,kt as Vt,l as Ht,ln as Ut,lt as Wt,m as Gt,mn as Kt,mt as qt,n as Jt,nn as Yt,nt as P,o as Xt,on as Zt,ot as Qt,p as $t,pn as en,pt as tn,q as nn,qn as rn,qt as an,r as on,rn as sn,rt as cn,s as ln,sn as un,st as dn,t as fn,tn as pn,tt as mn,u as hn,un as gn,ut as _n,v as vn,vn as yn,vt as bn,w as xn,wn as Sn,wt as Cn,x as wn,xn as Tn,xt as En,y as Dn,yn as On,yt as kn,z as An,zn as jn,zt as Mn}from"./react-BJst1MYz.js";import{n as Nn,r as Pn,t as Fn}from"./ui-utils-l2x0dF3k.js";import{a as In,c as Ln,i as Rn,l as zn,n as Bn,o as Vn,r as Hn,s as Un,t as Wn}from"./vendor-BI4_7CPc.js";(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var Gn=e(rt(),1),F=e(_(),1);function I(...e){return Nn(Pn(e))}var L=Fe(),Kn=We,qn=Cn,Jn=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(D,{ref:n,className:I(`fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t}));Jn.displayName=D.displayName;var Yn=F.forwardRef(({className:e,children:t,...n},r)=>(0,L.jsxs)(qn,{children:[(0,L.jsx)(Jn,{}),(0,L.jsxs)(En,{ref:r,className:I(`fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg`,e),...n,children:[t,(0,L.jsxs)(ht,{className:`absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground`,children:[(0,L.jsx)(Vt,{className:`h-4 w-4`}),(0,L.jsx)(`span`,{className:`sr-only`,children:`Close`})]})]})]}));Yn.displayName=En.displayName;var Xn=({className:e,...t})=>(0,L.jsx)(`div`,{className:I(`flex flex-col space-y-1.5 text-center sm:text-left`,e),...t});Xn.displayName=`DialogHeader`;var Zn=({className:e,...t})=>(0,L.jsx)(`div`,{className:I(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});Zn.displayName=`DialogFooter`;var Qn=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(re,{ref:n,className:I(`text-lg font-semibold leading-none tracking-tight`,e),...t}));Qn.displayName=re.displayName;var $n=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(Ve,{ref:n,className:I(`text-sm text-muted-foreground`,e),...t}));$n.displayName=Ve.displayName;var er=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(bn,{ref:n,className:I(`flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground`,e),...t}));er.displayName=bn.displayName;var tr=({children:e,...t})=>(0,L.jsx)(Kn,{...t,children:(0,L.jsx)(Yn,{className:`overflow-hidden p-0 shadow-lg`,children:(0,L.jsx)(er,{className:`[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5`,children:e})})}),nr=F.forwardRef(({className:e,...t},n)=>(0,L.jsxs)(`div`,{className:`flex items-center border-b px-3`,"cmdk-input-wrapper":``,children:[(0,L.jsx)(an,{className:`mr-2 h-4 w-4 shrink-0 opacity-50`}),(0,L.jsx)(bn.Input,{ref:n,className:I(`flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50`,e),...t})]}));nr.displayName=bn.Input.displayName;var rr=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(bn.List,{ref:n,className:I(`max-h-[300px] overflow-y-auto overflow-x-hidden`,e),...t}));rr.displayName=bn.List.displayName;var ir=F.forwardRef((e,t)=>(0,L.jsx)(bn.Empty,{ref:t,className:`py-6 text-center text-sm`,...e}));ir.displayName=bn.Empty.displayName;var ar=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(bn.Group,{ref:n,className:I(`overflow-hidden p-1 text-popover-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground`,e),...t}));ar.displayName=bn.Group.displayName;var or=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(bn.Separator,{ref:n,className:I(`-mx-1 h-px bg-border`,e),...t}));or.displayName=bn.Separator.displayName;var sr=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(bn.Item,{ref:n,className:I(`relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...t}));sr.displayName=bn.Item.displayName;var cr=({className:e,...t})=>(0,L.jsx)(`span`,{className:I(`ml-auto text-xs tracking-widest text-muted-foreground`,e),...t});cr.displayName=`CommandShortcut`;function lr(){let[e,t]=F.useState(!1),r=n();F.useEffect(()=>{let e=e=>{e.key===`k`&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),t(e=>!e))};return document.addEventListener(`keydown`,e),()=>document.removeEventListener(`keydown`,e)},[]);let i=F.useCallback(e=>{t(!1),e()},[]);return(0,L.jsxs)(tr,{open:e,onOpenChange:t,children:[(0,L.jsx)(nr,{placeholder:`Type a command or search...`}),(0,L.jsxs)(rr,{children:[(0,L.jsx)(ir,{children:`No results found.`}),(0,L.jsxs)(ar,{heading:`Suggestions`,children:[(0,L.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/status`})),children:[(0,L.jsx)(gn,{className:`mr-2 h-4 w-4`}),(0,L.jsx)(`span`,{children:`Dashboard`})]}),(0,L.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/dashboard/deployments`})),children:[(0,L.jsx)(Tn,{className:`mr-2 h-4 w-4`}),(0,L.jsx)(`span`,{children:`Deployments`})]}),(0,L.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/status`})),children:[(0,L.jsx)(he,{className:`mr-2 h-4 w-4`}),(0,L.jsx)(`span`,{children:`Platform Status`})]})]}),(0,L.jsx)(or,{}),(0,L.jsx)(ar,{heading:`Infrastructure`,children:(0,L.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/dashboard/s3`})),children:[(0,L.jsx)(ye,{className:`mr-2 h-4 w-4`}),(0,L.jsx)(`span`,{children:`Artifacts (S3)`})]})}),(0,L.jsx)(or,{}),(0,L.jsxs)(ar,{heading:`Events & Monitoring`,children:[(0,L.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/notifications`})),children:[(0,L.jsx)(j,{className:`mr-2 h-4 w-4`}),(0,L.jsx)(`span`,{children:`Notifications`})]}),(0,L.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/webhooks`})),children:[(0,L.jsx)(Rt,{className:`mr-2 h-4 w-4`}),(0,L.jsx)(`span`,{children:`Webhooks`})]}),(0,L.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/syslog`})),children:[(0,L.jsx)(Kt,{className:`mr-2 h-4 w-4`}),(0,L.jsx)(`span`,{children:`Syslog`})]}),(0,L.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/snmp`})),children:[(0,L.jsx)($e,{className:`mr-2 h-4 w-4`}),(0,L.jsx)(`span`,{children:`SNMP Traps`})]})]})]})]})}function ur(){let e=s({select:e=>e.status===`pending`}),[t,n]=F.useState(!1);return F.useEffect(()=>{let t;return e?n(!0):t=setTimeout(()=>n(!1),500),()=>clearTimeout(t)},[e]),t?(0,L.jsx)(`div`,{className:I(`fixed top-0 left-0 z-[100] h-1 w-full bg-transparent overflow-hidden`),children:(0,L.jsx)(`div`,{className:I(`h-full w-full bg-primary/80 origin-left animate-progress`)})}):null}var dr=(0,F.createContext)({theme:`system`,setTheme:()=>null});function fr({children:e,defaultTheme:t=`system`,storageKey:n=`vite-ui-theme`}){let[r,i]=(0,F.useState)(()=>localStorage.getItem(n)||t);(0,F.useEffect)(()=>{let e=window.document.documentElement;if(e.classList.remove(`light`,`dark`),r===`system`){let t=window.matchMedia(`(prefers-color-scheme: dark)`).matches?`dark`:`light`;e.classList.add(t);return}e.classList.add(r)},[r]);let a={theme:r,setTheme:e=>{localStorage.setItem(n,e),i(e)}};return(0,L.jsx)(dr.Provider,{value:a,children:e})}const pr=()=>{let e=(0,F.useContext)(dr);if(e===void 0)throw Error(`useTheme must be used within a ThemeProvider`);return e};var mr=Fn(`inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0`,{variants:{variant:{default:`bg-primary text-primary-foreground hover:bg-primary/90`,destructive:`bg-destructive text-destructive-foreground hover:bg-destructive/90`,outline:`border border-input bg-background hover:bg-accent hover:text-accent-foreground`,secondary:`bg-secondary text-secondary-foreground hover:bg-secondary/80`,ghost:`hover:bg-accent hover:text-accent-foreground`,link:`text-primary underline-offset-4 hover:underline`},size:{default:`h-10 px-4 py-2`,sm:`h-9 rounded-md px-3`,lg:`h-11 rounded-md px-8`,icon:`h-10 w-10`}},defaultVariants:{variant:`default`,size:`default`}}),R=F.forwardRef(({className:e,variant:t,size:n,...r},i)=>(0,L.jsx)(`button`,{className:I(mr({variant:t,size:n,className:e})),ref:i,...r}));R.displayName=`Button`;var hr=Et,gr=lt,_r=F.forwardRef(({className:e,inset:t,children:n,...r},i)=>(0,L.jsxs)(kt,{ref:i,className:I(`flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent`,t&&`pl-8`,e),...r,children:[n,(0,L.jsx)(Le,{className:`ml-auto h-4 w-4`})]}));_r.displayName=kt.displayName;var vr=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(Mt,{ref:n,className:I(`z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,e),...t}));vr.displayName=Mt.displayName;var yr=F.forwardRef(({className:e,sideOffset:t=4,...n},r)=>(0,L.jsx)(Wt,{children:(0,L.jsx)(Ft,{ref:r,sideOffset:t,className:I(`z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,e),...n})}));yr.displayName=Ft.displayName;var br=F.forwardRef(({className:e,inset:t,...n},r)=>(0,L.jsx)(Qt,{ref:r,className:I(`relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,t&&`pl-8`,e),...n}));br.displayName=Qt.displayName;var xr=F.forwardRef(({className:e,children:t,checked:n,...r},i)=>(0,L.jsxs)(cn,{ref:i,className:I(`relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),checked:n,...r,children:[(0,L.jsx)(`span`,{className:`absolute left-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,L.jsx)(dn,{children:(0,L.jsx)(Ye,{className:`h-4 w-4`})})}),t]}));xr.displayName=cn.displayName;var Sr=F.forwardRef(({className:e,children:t,...n},r)=>(0,L.jsxs)(xt,{ref:r,className:I(`relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...n,children:[(0,L.jsx)(`span`,{className:`absolute left-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,L.jsx)(dn,{children:(0,L.jsx)(Me,{className:`h-2 w-2 fill-current`})})}),t]}));Sr.displayName=xt.displayName;var Cr=F.forwardRef(({className:e,inset:t,...n},r)=>(0,L.jsx)(vt,{ref:r,className:I(`px-2 py-1.5 text-sm font-semibold`,t&&`pl-8`,e),...n}));Cr.displayName=vt.displayName;var wr=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(tn,{ref:n,className:I(`-mx-1 my-1 h-px bg-muted`,e),...t}));wr.displayName=tn.displayName;var Tr=({className:e,...t})=>(0,L.jsx)(`span`,{className:I(`ml-auto text-xs tracking-widest opacity-60`,e),...t});Tr.displayName=`DropdownMenuShortcut`;function Er(){let{setTheme:e}=pr();return(0,L.jsxs)(hr,{children:[(0,L.jsx)(gr,{asChild:!0,children:(0,L.jsxs)(R,{variant:`outline`,size:`icon`,children:[(0,L.jsx)(Xe,{className:`h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0`}),(0,L.jsx)(Pt,{className:`absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100`}),(0,L.jsx)(`span`,{className:`sr-only`,children:`Toggle theme`})]})}),(0,L.jsxs)(yr,{align:`end`,children:[(0,L.jsx)(br,{onClick:()=>e(`light`),children:`Light`}),(0,L.jsx)(br,{onClick:()=>e(`dark`),children:`Dark`}),(0,L.jsx)(br,{onClick:()=>e(`system`),children:`System`})]})]})}const Dr=`/api`;function Or(e){let t=e.startsWith(`/`)?e:`/`;return`${Dr}/oidc/login?next=${encodeURIComponent(t)}`}var kr=class extends Error{status;bodyText;constructor(e,t,n){super(e),this.name=`ApiError`,this.status=t,this.bodyText=n}};async function z(e,t){let n=(t?.method??`GET`).toUpperCase(),r=await fetch(`${e}`,{credentials:`include`,...t,headers:{"Content-Type":`application/json`,...t?.headers??{}}});if(r.status===401){let e=await r.text().catch(()=>``);if(n===`GET`&&typeof window<`u`){let e=window.location.pathname+(window.location.search??``);window.location.href=Or(e)}throw new kr(`unauthorized`,r.status,e)}if(r.status===403){let e=await r.text().catch(()=>``);throw new kr(`forbidden`,r.status,e)}if(!r.ok){let e=await r.text().catch(()=>``);throw new kr(`request failed (${r.status})`,r.status,e)}return r.status===204?{}:await r.json()}async function Ar(){return z(`/api/session`)}async function jr(){let e=await fetch(`/auth/logout`,{method:`POST`,credentials:`include`,headers:{"Content-Type":`application/json`},body:`{}`});if(!e.ok){let t=await e.text().catch(()=>``);throw Error(`logout failed (${e.status}): ${t}`)}}async function Mr(){return z(`/api/workspaces`)}async function Nr(){return z(`/api/dashboard/snapshot`)}async function Pr(e,t){let n=new URLSearchParams;t?.include_read&&n.set(`include_read`,t.include_read),t?.limit&&n.set(`limit`,t.limit);let r=n.toString();return z(`/notifications/for-user/${encodeURIComponent(e)}${r?`?${r}`:``}`)}async function Fr(e){return z(`/notifications/for-user/${encodeURIComponent(e)}/read-all`,{method:`PUT`})}async function Ir(e){return z(`/notifications/single/${encodeURIComponent(e)}/read`,{method:`PUT`})}async function Lr(e){return z(`/notifications/single/${encodeURIComponent(e)}`,{method:`DELETE`})}async function Rr(e){return z(`/api/workspaces/${encodeURIComponent(e)}/netlab/servers`)}async function zr(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/netlab/servers`,{method:`PUT`,body:JSON.stringify(t)})}async function Br(e,t){await z(`/api/workspaces/${encodeURIComponent(e)}/netlab/servers/${encodeURIComponent(t)}`,{method:`DELETE`})}async function Vr(e){return z(`/api/workspaces/${encodeURIComponent(e)}/eve/servers`)}async function Hr(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/eve/servers`,{method:`PUT`,body:JSON.stringify(t)})}async function Ur(e,t){await z(`/api/workspaces/${encodeURIComponent(e)}/eve/servers/${encodeURIComponent(t)}`,{method:`DELETE`})}async function Wr(){return z(`/api/user/integrations/servicenow`)}async function Gr(e){return z(`/api/user/integrations/servicenow`,{method:`PUT`,body:JSON.stringify(e)})}async function Kr(){return z(`/api/user/integrations/servicenow/install`,{method:`POST`,body:`{}`})}async function qr(){return z(`/api/user/integrations/servicenow/pdiStatus`)}async function Jr(){return z(`/api/user/integrations/servicenow/schemaStatus`)}async function Yr(){return z(`/api/user/integrations/servicenow/wake`,{method:`POST`,body:`{}`})}async function Xr(){return z(`/api/user/integrations/servicenow/configureForwardTicketing`,{method:`POST`,body:`{}`})}async function Zr(){return z(`/api/user/git-credentials`)}async function Qr(e){return z(`/api/user/git-credentials`,{method:`PUT`,body:JSON.stringify(e)})}async function $r(){return z(`/api/user/git-credentials/rotate`,{method:`POST`,body:`{}`})}async function ei(e,t,n){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/forward`,{method:`PUT`,body:JSON.stringify(n)})}async function ti(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/forward/sync`,{method:`POST`,body:`{}`})}async function ni(e,t,n){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/impair`,{method:`POST`,body:JSON.stringify(n)})}async function ri(e,t,n){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/admin`,{method:`POST`,body:JSON.stringify(n)})}async function ii(e,t,n){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/capture`,{method:`POST`,body:JSON.stringify(n)})}async function ai(e,t,n){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/interfaces`)}async function oi(e,t,n){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/running-config`)}async function si(e,t,n=`json`){let r=new URLSearchParams;return r.set(`format`,n),z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/inventory?${r.toString()}`)}async function ci(e,t,n,r){let i=new URLSearchParams;r?.tail&&i.set(`tail`,String(r.tail)),r?.container&&i.set(`container`,r.container);let a=i.toString();return z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/logs${a?`?${a}`:``}`)}async function li(e,t,n){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/describe`)}async function ui(e,t,n){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/save-config`,{method:`POST`,body:`{}`})}async function di(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/stats`)}async function fi(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return z(`/api/workspaces/${encodeURIComponent(e)}/netlab/templates${r?`?${r}`:``}`)}async function pi(e,t){let n=new URLSearchParams;return t.source&&n.set(`source`,t.source),t.repo&&n.set(`repo`,t.repo),t.dir&&n.set(`dir`,t.dir),n.set(`template`,t.template),z(`/api/workspaces/${encodeURIComponent(e)}/netlab/template?${n.toString()}`)}async function mi(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/netlab/validate`,{method:`POST`,body:JSON.stringify(t)})}async function hi(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return z(`/api/workspaces/${encodeURIComponent(e)}/containerlab/templates${r?`?${r}`:``}`)}async function gi(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return z(`/api/workspaces/${encodeURIComponent(e)}/terraform/templates${r?`?${r}`:``}`)}async function _i(e,t){let n=new URLSearchParams;return t.source&&n.set(`source`,t.source),t.repo&&n.set(`repo`,t.repo),t.dir&&n.set(`dir`,t.dir),n.set(`file`,t.file),z(`/api/workspaces/${encodeURIComponent(e)}/containerlab/template?${n.toString()}`)}async function vi(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return z(`/api/workspaces/${encodeURIComponent(e)}/labpp/templates${r?`?${r}`:``}`)}async function yi(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments`,{method:`POST`,body:JSON.stringify(t)})}async function bi(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/containerlab/topologies`,{method:`POST`,body:JSON.stringify(t)})}async function xi(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments-designer/clabernetes/from-template`,{method:`POST`,body:JSON.stringify(t)})}async function Si(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments-designer/containerlab/from-template`,{method:`POST`,body:JSON.stringify(t)})}async function Ci(e){return z(`/api/workspaces`,{method:`POST`,body:JSON.stringify(e)})}async function wi(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/members`,{method:`PUT`,body:JSON.stringify(t)})}async function Ti(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/topology`)}async function Ei(e){let t=new URLSearchParams;e?.q&&t.set(`q`,e.q),e?.n&&t.set(`n`,String(e.n));let n=t.toString();return z(`/api/registry/repos${n?`?${n}`:``}`)}async function Di(e,t){let n=new URLSearchParams;t?.q&&n.set(`q`,t.q);let r=n.toString();return z(`/api/registry/repos/${encodeURIComponent(e)}/tags${r?`?${r}`:``}`)}async function Oi(e,t){let n=new URLSearchParams;return n.set(`confirm`,t.confirm),t.force&&n.set(`force`,`true`),z(`/api/workspaces/${encodeURIComponent(e)}?${n.toString()}`,{method:`DELETE`})}async function ki(){return z(`/api/forward/collector-configs`)}async function Ai(e){return z(`/api/forward/collector-configs`,{method:`POST`,body:JSON.stringify(e)})}async function ji(e){return z(`/api/forward/collector-configs/${encodeURIComponent(e)}`,{method:`DELETE`})}async function Mi(e,t){let n=new URLSearchParams;t&&t>0&&n.set(`tail`,String(t));let r=n.toString();return z(`/api/forward/collector-configs/${encodeURIComponent(e)}/logs${r?`?${r}`:``}`)}async function Ni(e){return z(`/api/forward/collector-configs/${encodeURIComponent(e)}/restart`,{method:`POST`,body:`{}`})}async function Pi(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/settings`,{method:`PUT`,body:JSON.stringify(t)})}async function Fi(e,t){let n=new URLSearchParams;t?.prefix&&n.set(`prefix`,t.prefix),t?.limit&&n.set(`limit`,t.limit);let r=n.toString();return z(`/api/workspaces/${encodeURIComponent(e)}/artifacts${r?`?${r}`:``}`)}async function Ii(e,t){let n=new URLSearchParams({key:t});return z(`/api/workspaces/${encodeURIComponent(e)}/artifacts/download?${n.toString()}`)}async function Li(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/artifacts/object`,{method:`POST`,body:JSON.stringify(t)})}async function Ri(e,t){let n=new URLSearchParams({key:t});return z(`/api/workspaces/${encodeURIComponent(e)}/artifacts/object?${n.toString()}`,{method:`DELETE`})}async function zi(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/artifacts/folder`,{method:`POST`,body:JSON.stringify({prefix:t})})}async function Bi(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit),e?.before_id&&t.set(`before_id`,e.before_id);let n=t.toString();return z(`/api/webhooks/events${n?`?${n}`:``}`)}async function Vi(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit),e?.before_id&&t.set(`before_id`,e.before_id),e?.source_ip&&t.set(`source_ip`,e.source_ip),e?.unassigned&&t.set(`unassigned`,e.unassigned);let n=t.toString();return z(`/api/syslog/events${n?`?${n}`:``}`)}async function Hi(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit),e?.before_id&&t.set(`before_id`,e.before_id);let n=t.toString();return z(`/api/snmp/traps/events${n?`?${n}`:``}`)}async function Ui(){return z(`/api/admin/governance/summary`)}async function Wi(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString();return z(`/api/admin/governance/resources${n?`?${n}`:``}`)}async function Gi(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString();return z(`/api/admin/governance/costs${n?`?${n}`:``}`)}async function Ki(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString();return z(`/api/admin/governance/usage${n?`?${n}`:``}`)}async function qi(){await z(`/api/admin/governance/sync`,{method:`POST`,body:`{}`})}async function Ji(){return z(`/api/admin/config`)}async function Yi(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString();return z(`/api/admin/audit${n?`?${n}`:``}`)}async function Xi(){return z(`/api/admin/impersonate/status`)}async function Zi(e){return z(`/api/admin/impersonate/start`,{method:`POST`,body:JSON.stringify(e)})}async function Qi(){return z(`/api/admin/impersonate/stop`,{method:`POST`,body:`{}`})}async function $i(e){return z(`/api/admin/tasks/reconcile`,{method:`POST`,body:JSON.stringify(e)})}async function ea(e){return z(`/api/admin/tasks/reconcile-running`,{method:`POST`,body:JSON.stringify(e)})}async function ta(e){return z(`/api/admin/users/purge`,{method:`POST`,body:JSON.stringify(e)})}async function na(){return z(`/api/admin/governance/policy`)}async function ra(e){return z(`/api/admin/governance/policy`,{method:`PUT`,body:JSON.stringify(e)})}async function ia(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/start`,{method:`POST`,body:`{}`})}async function aa(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/stop`,{method:`POST`,body:`{}`})}async function oa(e,t,n){let r=new URLSearchParams;n?.forwardDelete&&r.set(`forward_delete`,`true`);let i=r.toString();return z(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}${i?`?${i}`:``}`,{method:`DELETE`})}async function sa(){return z(`/api/ui/config`)}async function ca(){return z(`/status/summary`)}async function la(e,t){let n=new URLSearchParams;return t&&n.set(`workspace_id`,t),z(`/api/runs/${encodeURIComponent(String(e))}/cancel${n.toString()?`?${n.toString()}`:``}`,{method:`POST`,body:`{}`})}async function ua(e){return z(`/api/workspaces/${encodeURIComponent(e)}/variable-groups`)}async function da(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/variable-groups`,{method:`POST`,body:JSON.stringify(t)})}async function fa(e,t,n){return z(`/api/workspaces/${encodeURIComponent(e)}/variable-groups/${encodeURIComponent(t)}`,{method:`PUT`,body:JSON.stringify(n)})}async function pa(e,t){return z(`/api/workspaces/${encodeURIComponent(e)}/variable-groups/${encodeURIComponent(t)}`,{method:`DELETE`})}var ma=[{label:`Dashboard`,href:`/status`,icon:gn},{label:`Deployments`,href:`/dashboard/deployments`,icon:Tn},{label:`Designer`,href:`/dashboard/labs/designer`,icon:jt,newTab:!0},{label:`Collector (Forward)`,href:`/dashboard/forward`,icon:Ie},{label:`ServiceNow`,href:`/dashboard/servicenow`,icon:x},{label:`Artifacts`,href:`/dashboard/s3`,icon:ye},{label:`Tools`,href:``,icon:Bt,children:[{label:`NetBox`,href:`/netbox/`,icon:sn,external:!0},{label:`Nautobot`,href:`/nautobot/`,icon:sn,external:!0}]},{label:`Webhooks`,href:`/webhooks`,icon:Rt},{label:`Syslog`,href:`/syslog`,icon:Kt},{label:`SNMP`,href:`/snmp`,icon:$e},{label:`Git`,href:`/git/`,icon:ct,external:!0},{label:`DNS`,href:`${Dr}/dns/sso?next=/dns/`,icon:sn,external:!0},{label:`Coder`,href:`/coder/launch`,icon:De,external:!0},{label:`Coder Admin`,href:`/coder/`,icon:De,external:!0,adminOnly:!0},{label:`API Testing`,href:`${Dr}/yaade/sso`,icon:Yt,external:!0},{label:`Docs`,href:`/docs/`,icon:Qe,external:!0},{label:`Settings`,href:`/admin/settings`,icon:se,adminOnly:!0},{label:`Governance`,href:`/admin/governance`,icon:$e,adminOnly:!0}];function ha(e){let t=s({select:e=>e.location.pathname}),[n,r]=(0,F.useState)({SSOT:!0}),i=`_blank`,a=`noreferrer noopener`,o=e=>!!e.external||!!e.newTab,c=e=>e?e===`/`?t===`/`:e.endsWith(`/`)?t.startsWith(e):t===e||t.startsWith(`${e}/`):!1,l=e=>{r(t=>({...t,[e]:!t[e]}))};return(0,L.jsx)(`nav`,{className:`grid items-start gap-2`,children:(0,L.jsxs)(`div`,{className:`space-y-2`,children:[e.collapsed?null:(0,L.jsx)(`h4`,{className:`px-3 text-xs font-semibold uppercase tracking-wide text-muted-foreground`,children:`Overview`}),(0,L.jsx)(`div`,{className:`grid gap-1`,children:ma.filter(t=>t.adminOnly?!!e.isAdmin:!0).flatMap(t=>{let n=e.features;if(!n)return[t];if(t.label===`Git`&&!n.giteaEnabled||t.label===`DNS`&&!n.dnsEnabled||t.label===`Coder`&&!n.coderEnabled||t.label===`Coder Admin`&&!n.coderEnabled||t.label===`API Testing`&&!n.yaadeEnabled||t.label===`Collector (Forward)`&&!n.forwardEnabled)return[];if(t.label===`Tools`){let e=t.children?.filter(e=>e.label===`NetBox`?!!n.netboxEnabled:e.label===`Nautobot`?!!n.nautobotEnabled:!0)??[];return e.length===0?[]:[{...t,children:e}]}return[t]}).map(t=>{let r=t.icon;if(t.children){let o=t.children.some(e=>c(e.href)),s=n[t.label];return e.collapsed?(0,L.jsxs)(hr,{children:[(0,L.jsx)(gr,{asChild:!0,children:(0,L.jsx)(`button`,{className:I(`group flex items-center justify-center rounded-md px-2 py-2 text-sm font-medium transition-colors w-full`,`hover:bg-accent hover:text-accent-foreground`,o?`bg-accent text-accent-foreground`:`transparent`),title:t.label,children:(0,L.jsx)(r,{className:`h-5 w-5`})})}),(0,L.jsxs)(yr,{side:`right`,align:`start`,sideOffset:10,children:[(0,L.jsx)(Cr,{children:t.label}),(0,L.jsx)(wr,{}),t.children.map(e=>(0,L.jsx)(br,{asChild:!0,children:e.external?(0,L.jsxs)(`a`,{href:e.href,target:i,rel:a,className:`flex items-center gap-2 cursor-pointer w-full`,children:[(0,L.jsx)(e.icon,{className:`h-4 w-4 mr-2`}),e.label]}):(0,L.jsxs)(p,{to:e.href,className:`flex items-center gap-2 cursor-pointer w-full`,children:[(0,L.jsx)(e.icon,{className:`h-4 w-4 mr-2`}),e.label]})},e.href))]})]},t.label):(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsxs)(`button`,{onClick:()=>l(t.label),className:I(`group flex w-full items-center justify-between rounded-md px-3 py-2 text-sm font-medium transition-colors`,`hover:bg-accent hover:text-accent-foreground`,o?`text-foreground font-semibold`:`text-muted-foreground`),children:[(0,L.jsxs)(`div`,{className:`flex items-center`,children:[(0,L.jsx)(r,{className:`mr-2 h-4 w-4`}),(0,L.jsx)(`span`,{children:t.label})]}),s?(0,L.jsx)(C,{className:`h-4 w-4 opacity-50`}):(0,L.jsx)(Le,{className:`h-4 w-4 opacity-50`})]}),s&&(0,L.jsx)(`div`,{className:`grid gap-1 pl-4 border-l ml-4 border-border/50`,children:t.children.map(e=>{let t=c(e.href),n=e.icon,r=I(`group flex items-center rounded-md px-3 py-2 text-sm font-medium transition-colors`,`hover:bg-accent hover:text-accent-foreground`,t?`bg-accent text-accent-foreground`:`text-muted-foreground`);return e.external?(0,L.jsxs)(`a`,{href:e.href,target:i,rel:a,className:r,children:[(0,L.jsx)(n,{className:`mr-2 h-4 w-4 opacity-70 group-hover:opacity-100`}),(0,L.jsx)(`span`,{children:e.label})]},e.href):(0,L.jsxs)(p,{to:e.href,className:r,children:[(0,L.jsx)(n,{className:`mr-2 h-4 w-4 opacity-70 group-hover:opacity-100`}),(0,L.jsx)(`span`,{children:e.label})]},e.href)})})]},t.label)}let s=I(`group flex items-center rounded-md px-3 py-2 text-sm font-medium transition-colors`,`hover:bg-accent hover:text-accent-foreground`,c(t.href)?`bg-accent`:`transparent`,e.collapsed&&`justify-center px-2`),u=I(`transition-transform duration-200 group-hover:scale-110 group-hover:text-primary`,e.collapsed?`h-5 w-5`:`mr-2 h-4 w-4`);return t.external?(0,L.jsxs)(`a`,{href:t.href,target:i,rel:a,className:s,title:e.collapsed?t.label:void 0,children:[(0,L.jsx)(r,{className:u}),e.collapsed?null:(0,L.jsx)(`span`,{children:t.label})]},t.href):(0,L.jsxs)(p,{to:t.href,className:s,title:e.collapsed?t.label:void 0,target:o(t)?i:void 0,rel:o(t)?a:void 0,children:[(0,L.jsx)(r,{className:u}),e.collapsed?null:(0,L.jsx)(`span`,{children:t.label})]},t.href)})})]})})}var ga=F.forwardRef(({...e},t)=>(0,L.jsx)(`nav`,{ref:t,"aria-label":`breadcrumb`,...e}));ga.displayName=`Breadcrumb`;var _a=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`ol`,{ref:n,className:I(`flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5`,e),...t}));_a.displayName=`BreadcrumbList`;var va=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`li`,{ref:n,className:I(`inline-flex items-center gap-1.5`,e),...t}));va.displayName=`BreadcrumbItem`;var ya=F.forwardRef(({asChild:e,className:t,...n},r)=>(0,L.jsx)(e?kn:`a`,{ref:r,className:I(`transition-colors hover:text-foreground`,t),...n}));ya.displayName=`BreadcrumbLink`;var ba=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`span`,{ref:n,role:`link`,"aria-disabled":`true`,"aria-current":`page`,className:I(`font-normal text-foreground`,e),...t}));ba.displayName=`BreadcrumbPage`;var xa=({children:e,className:t,...n})=>(0,L.jsx)(`li`,{role:`presentation`,"aria-hidden":`true`,className:I(`[&>svg]:size-3.5`,t),...n,children:e??(0,L.jsx)(Le,{})});xa.displayName=`BreadcrumbSeparator`;var Sa=({className:e,...t})=>(0,L.jsxs)(`span`,{role:`presentation`,"aria-hidden":`true`,className:I(`flex h-9 w-9 items-center justify-center`,e),...t,children:[(0,L.jsx)(ne,{className:`h-4 w-4`}),(0,L.jsx)(`span`,{className:`sr-only`,children:`More`})]});Sa.displayName=`BreadcrumbEllipsis`;var Ca=Fn(`rounded-lg border text-card-foreground shadow-sm`,{variants:{variant:{default:`bg-card`,elevated:`bg-card shadow-lg`,gradient:`bg-gradient-to-br from-card to-card/60`,glass:`bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60`,glow:`bg-card shadow-lg shadow-primary/10`,interactive:`bg-card hover:shadow-md transition-shadow cursor-pointer`,success:`border-green-500/50 bg-green-500/5`,warning:`border-amber-500/50 bg-amber-500/5`,danger:`border-red-500/50 bg-red-500/5`,info:`border-blue-500/50 bg-blue-500/5`,flat:`bg-card shadow-none`},size:{default:``,compact:`p-3`,comfortable:`p-6`}},defaultVariants:{variant:`default`,size:`default`}}),B=F.forwardRef(({className:e,variant:t,size:n,...r},i)=>(0,L.jsx)(`div`,{ref:i,className:I(Ca({variant:t,size:n,className:e})),...r}));B.displayName=`Card`;var V=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`div`,{ref:n,className:I(`flex flex-col space-y-1.5 p-6`,e),...t}));V.displayName=`CardHeader`;var H=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`div`,{ref:n,className:I(`text-2xl font-semibold leading-none tracking-tight`,e),...t}));H.displayName=`CardTitle`;var U=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`div`,{ref:n,className:I(`text-sm text-muted-foreground`,e),...t}));U.displayName=`CardDescription`;var W=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`div`,{ref:n,className:I(`p-6 pt-0`,e),...t}));W.displayName=`CardContent`;var wa=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`div`,{ref:n,className:I(`flex items-center p-6 pt-0`,e),...t}));wa.displayName=`CardFooter`;var Ta=We,Ea=k,Da=Cn,Oa=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(D,{className:I(`fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t,ref:n}));Oa.displayName=D.displayName;var ka=Fn(`fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500`,{variants:{side:{top:`inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top`,bottom:`inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom`,left:`inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm`,right:`inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm`}},defaultVariants:{side:`right`}}),Aa=F.forwardRef(({side:e=`right`,className:t,children:n,...r},i)=>(0,L.jsxs)(Da,{children:[(0,L.jsx)(Oa,{}),(0,L.jsxs)(En,{ref:i,className:I(ka({side:e}),t),...r,children:[n,(0,L.jsxs)(ht,{className:`absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary`,children:[(0,L.jsx)(Vt,{className:`h-4 w-4`}),(0,L.jsx)(`span`,{className:`sr-only`,children:`Close`})]})]})]}));Aa.displayName=En.displayName;var ja=({className:e,...t})=>(0,L.jsx)(`div`,{className:I(`flex flex-col space-y-2 text-center sm:text-left`,e),...t});ja.displayName=`SheetHeader`;var Ma=({className:e,...t})=>(0,L.jsx)(`div`,{className:I(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});Ma.displayName=`SheetFooter`;var Na=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(re,{ref:n,className:I(`text-lg font-semibold text-foreground`,e),...t}));Na.displayName=re.displayName;var Pa=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(Ve,{ref:n,className:I(`text-sm text-muted-foreground`,e),...t}));Pa.displayName=Ve.displayName;var Fa=({...e})=>(0,L.jsx)(mn,{className:`toaster group`,toastOptions:{classNames:{toast:`group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg`,description:`group-[.toast]:text-muted-foreground`,actionButton:`group-[.toast]:bg-primary group-[.toast]:text-primary-foreground`,cancelButton:`group-[.toast]:bg-muted group-[.toast]:text-muted-foreground`}},...e});async function Ia(){try{let e=await fetch(`/api/session`,{credentials:`include`,headers:{"Content-Type":`application/json`}});return e.ok?await e.json():null}catch{return null}}async function La(e){if(typeof window>`u`)return!1;let t=e.pollIntervalMs??750,n=e.timeoutMs??2*6e4;if((await Ia())?.authenticated)return!0;let r=Math.max(0,Math.floor((window.screen.width-520)/2)),i=Math.max(0,Math.floor((window.screen.height-720)/2)),a=[`popup=yes`,`width=520`,`height=720`,`left=${r}`,`top=${i}`].join(`,`),o=window.open(e.loginHref,`skyforge_login`,a);if(!o)return!1;try{o.focus()}catch{}return await new Promise(e=>{let r=Date.now(),i=window.setInterval(async()=>{try{if(o.closed){window.clearInterval(i),e(!1);return}if(Date.now()-r>n){window.clearInterval(i);try{o.close()}catch{}e(!1);return}if((await Ia())?.authenticated){window.clearInterval(i);try{o.close()}catch{}e(!0)}}catch{}},t)})}const G={session:()=>[`session`],uiConfig:()=>[`uiConfig`],dashboardSnapshot:()=>[`dashboardSnapshot`],statusSummary:()=>[`statusSummary`],runLogs:e=>[`runLogs`,e],deploymentTopology:(e,t)=>[`deploymentTopology`,e,t],deploymentUIEvents:(e,t)=>[`deploymentUIEvents`,e,t],workspaces:()=>[`workspaces`],workspaceForwardConfig:e=>[`workspaceForwardConfig`,e],workspaceForwardCollectors:e=>[`workspaceForwardCollectors`,e],forwardCollectors:()=>[`forwardCollectors`],userForwardCollector:()=>[`userForwardCollector`],userCollectorRuntime:()=>[`userCollectorRuntime`],userCollectorLogs:()=>[`userCollectorLogs`],userGitCredentials:()=>[`userGitCredentials`],userForwardCollectorConfigs:()=>[`userForwardCollectorConfigs`],userForwardCollectorConfigRuntime:e=>[`userForwardCollectorConfigRuntime`,e],userForwardCollectorConfigLogs:e=>[`userForwardCollectorConfigLogs`,e],userServiceNowConfig:()=>[`userServiceNowConfig`],userServiceNowPdiStatus:()=>[`userServiceNowPdiStatus`],userServiceNowSchemaStatus:()=>[`userServiceNowSchemaStatus`],storageFiles:()=>[`storageFiles`],workspaceArtifacts:e=>[`workspaceArtifacts`,e],workspaceEveServers:e=>[`workspaceEveServers`,e],workspaceNetlabServers:e=>[`workspaceNetlabServers`,e],notifications:(e,t)=>[`notifications`,e?`1`:`0`,t??``],syslogEvents:e=>[`syslogEvents`,e??``],snmpTrapEvents:e=>[`snmpTrapEvents`,e??``],workspaceTemplates:(e,t,n,r,i)=>[`workspaceTemplates`,e,t,n,r??``,i??``],pkiRoot:()=>[`pkiRoot`],pkiCerts:()=>[`pkiCerts`],pkiSshRoot:()=>[`pkiSshRoot`],pkiSshCerts:()=>[`pkiSshCerts`],webhookEvents:e=>[`webhookEvents`,e??``],notificationSettings:()=>[`notificationSettings`],governanceSummary:()=>[`governanceSummary`],governanceResources:e=>[`governanceResources`,e??``],governanceCosts:e=>[`governanceCosts`,e??``],governanceUsage:e=>[`governanceUsage`,e??``],governancePolicy:()=>[`governancePolicy`],adminConfig:()=>[`adminConfig`],adminAudit:e=>[`adminAudit`,e??``],adminImpersonateStatus:()=>[`adminImpersonateStatus`],registryRepos:e=>[`registryRepos`,e],registryTags:(e,t)=>[`registryTags`,e,t]};var Ra=new Map;function za(e){for(let[t,n]of e.handlers.entries())for(let r of n.values())e.es.addEventListener(t,r)}function Ba(e){let t=new EventSource(e.url,{withCredentials:!0});return t.onopen=()=>{e.retryMs=500},t.onerror=()=>{if(e.closed||e.reconnectTimer)return;try{t.close()}catch{}let n=e.retryMs;e.retryMs=Math.min(e.retryMs*2,15e3),e.reconnectTimer=window.setTimeout(()=>{e.reconnectTimer=void 0,!e.closed&&(e.es=Ba(e),za(e))},n)},t}function Va(e){let t=Ra.get(e);if(t)return t.refs+=1,t;let n={url:e,es:void 0,refs:1,handlers:new Map,retryMs:500,closed:!1};return n.es=Ba(n),Ra.set(e,n),n}function Ha(e){let t=Ra.get(e);if(t&&(--t.refs,!(t.refs>0))){Ra.delete(e),t.closed=!0,t.reconnectTimer&&=(window.clearTimeout(t.reconnectTimer),void 0);try{t.es.close()}catch{}}}function Ua(e,t){let n=Va(e);for(let[e,r]of Object.entries(t)){let t=n.handlers.get(e);t||(t=new Set,n.handlers.set(e,t)),t.add(r),n.es.addEventListener(e,r)}return{close:()=>{for(let[e,r]of Object.entries(t)){try{n.es.removeEventListener(e,r)}catch{}let t=n.handlers.get(e);t&&(t.delete(r),t.size===0&&n.handlers.delete(e))}Ha(e)}}}function Wa(e,t,n){let r=c(),i=(0,F.useMemo)(()=>{let e=new URLSearchParams;return e.set(`include_read`,t?`true`:`false`),e.set(`limit`,n),`${Dr}/notifications/events?${e.toString()}`},[t,n]);(0,F.useEffect)(()=>{if(!e)return;let a=Ua(i,{snapshot:e=>{try{let i=JSON.parse(e.data);if(!i||!Array.isArray(i.notifications))return;r.setQueryData(G.notifications(t,n),i)}catch{}}});return()=>{a.close()}},[e,t,n,r,i])}const Ga=u()({component:Ka,errorComponent:Ja,notFoundComponent:qa});function Ka(){let e=s({select:e=>e.location}),t=n(),r=c(),[a,l]=(0,F.useState)(!1),[u,d]=(0,F.useState)(!1),[f,p]=(0,F.useState)(!1),[m,h]=(0,F.useState)(!1),g=(0,F.useMemo)(()=>e.pathname===`/dashboard/labs/designer`,[e.pathname]),_=(0,F.useMemo)(()=>g||e.pathname===`/dashboard/labs/map`,[g,e.pathname]);(0,F.useEffect)(()=>{g&&p(!0)},[g]),(0,F.useEffect)(()=>{window.location.pathname===`/index.html`&&t({to:`/`,replace:!0})},[t]);let v=i({queryKey:G.session(),queryFn:Ar,retry:!1,staleTime:3e4}),y=i({queryKey:G.uiConfig(),queryFn:sa,staleTime:5*6e4}),b=y.data?.productName||`Skyforge`,x=y.data?.productSubtitle||`Automation Platform`,S=(0,F.useMemo)(()=>`${e.pathname}${e.searchStr??``}${e.hash??``}`,[e.pathname,e.searchStr,e.hash]),C=(0,F.useMemo)(()=>Or(S),[S]),w=(0,F.useMemo)(()=>[`/dashboard`,`/admin`,`/webhooks`,`/syslog`,`/snmp`].some(t=>e.pathname.startsWith(t)),[e.pathname]);(0,F.useEffect)(()=>{h(!1)},[e.pathname]);let T=v.data?.displayName||v.data?.username||``,E=!!v.data?.isAdmin,D=w&&!v.isLoading&&!v.data?.authenticated,O=v.data?.username??``;Wa(!!O,!1,`20`);let ee=i({queryKey:G.notifications(!1,`20`),enabled:!!O,queryFn:async()=>({notifications:(await Pr(O,{include_read:`false`,limit:`20`})).notifications??[]}),staleTime:1/0,initialData:{notifications:[]}}),k=(0,F.useMemo)(()=>(ee.data?.notifications??[]).filter(e=>!e.is_read).length,[ee.data?.notifications]);return(0,L.jsx)(fr,{defaultTheme:`dark`,storageKey:`vite-ui-theme`,children:(0,L.jsxs)(`div`,{className:`min-h-full`,children:[(0,L.jsx)(ur,{}),(0,L.jsx)(`header`,{className:`sticky top-0 z-40 border-b glass-header`,children:(0,L.jsxs)(`div`,{className:`mx-auto flex h-16 max-w-[1600px] items-center justify-between gap-4 px-4`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-6`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,L.jsxs)(Ta,{open:m,onOpenChange:h,children:[(0,L.jsx)(Ea,{asChild:!0,children:(0,L.jsxs)(R,{variant:`ghost`,size:`icon`,className:`lg:hidden`,children:[(0,L.jsx)(dt,{className:`h-5 w-5`}),(0,L.jsx)(`span`,{className:`sr-only`,children:`Toggle menu`})]})}),(0,L.jsx)(Aa,{side:`left`,className:`w-[240px] p-0`,children:(0,L.jsx)(`div`,{className:`px-2 py-6`,children:(0,L.jsx)(ha,{collapsed:!1,isAdmin:E,features:y.data?.features})})})]}),(0,L.jsxs)(`div`,{children:[(0,L.jsx)(`div`,{className:`text-[10px] uppercase tracking-wider text-muted-foreground leading-none`,children:x}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2 text-base font-semibold tracking-tight`,children:[(0,L.jsx)(rn,{className:`h-5 w-5 text-primary`}),(0,L.jsx)(`span`,{children:b})]})]}),(0,L.jsx)(`div`,{className:`h-8 w-px bg-border hidden md:block`}),(0,L.jsx)(`img`,{src:`/assets/skyforge/FN-logo.svg`,alt:`Forward Networks`,className:`h-6 w-auto hidden sm:block`})]}),(0,L.jsxs)(R,{variant:`outline`,className:`hidden md:flex h-9 w-64 items-center justify-start px-3 text-sm text-muted-foreground font-normal`,onClick:()=>{let e=new KeyboardEvent(`keydown`,{key:`k`,metaKey:!0,bubbles:!0});document.dispatchEvent(e)},children:[(0,L.jsx)(an,{className:`mr-2 h-4 w-4`}),(0,L.jsx)(`span`,{children:`Search...`}),(0,L.jsxs)(`kbd`,{className:`pointer-events-none ml-auto inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100`,children:[(0,L.jsx)(`span`,{className:`text-xs`,children:`⌘`}),`K`]})]})]}),(0,L.jsxs)(`nav`,{className:`flex items-center gap-4 text-sm`,children:[(0,L.jsxs)(R,{variant:`ghost`,size:`icon`,className:`relative text-muted-foreground hover:text-foreground`,"aria-label":`Notifications`,onClick:()=>void t({to:`/notifications`}),children:[(0,L.jsx)(j,{className:`h-4 w-4`}),k>0?(0,L.jsx)(`span`,{className:`absolute -right-1 -top-1 inline-flex h-4 min-w-[16px] items-center justify-center rounded-full bg-primary px-1 text-[10px] font-semibold text-primary-foreground`,children:k>99?`99+`:k}):null]}),(0,L.jsx)(Er,{}),v.data?.authenticated?(0,L.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,L.jsxs)(`div`,{className:`hidden md:flex flex-col items-end`,children:[(0,L.jsx)(`span`,{className:`text-[10px] text-muted-foreground uppercase leading-none`,children:`Signed in as`}),(0,L.jsx)(`span`,{className:`text-xs font-medium leading-none mt-1`,children:T})]}),(0,L.jsx)(R,{variant:`outline`,size:`sm`,disabled:a,onClick:async()=>{try{l(!0),await jr(),window.location.href=`/status?signin=1`}finally{l(!1)}},children:a?`…`:`Logout`})]}):(0,L.jsx)(R,{variant:`outline`,size:`sm`,disabled:u,onClick:async()=>{try{if(d(!0),!await La({loginHref:C})){window.location.href=C;return}await r.invalidateQueries({queryKey:G.session()})}finally{d(!1)}},children:u?`…`:`Login`})]})]})}),(0,L.jsxs)(`div`,{className:I(`mx-auto flex min-h-[calc(100vh-4rem)]`,_?`max-w-none`:`max-w-[1600px]`),children:[v.data?.authenticated&&(0,L.jsx)(`aside`,{className:I(`hidden lg:block border-r bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60`,`transition-all duration-300 ease-in-out`,f?`w-[64px]`:`w-[220px]`),children:(0,L.jsxs)(`div`,{className:`relative h-full`,children:[(0,L.jsx)(`div`,{className:I(`h-full px-4 py-4`,f&&`px-2`),children:(0,L.jsx)(ha,{collapsed:f,isAdmin:E,features:y.data?.features})}),(0,L.jsx)(`button`,{className:I(`absolute -right-3 top-4 flex h-7 w-7 items-center justify-center rounded-full border bg-background text-foreground shadow-sm`,`hover:bg-accent hover:text-accent-foreground transition-colors`),onClick:()=>p(e=>!e),"aria-label":f?`Expand navigation`:`Collapse navigation`,children:f?(0,L.jsx)(Le,{className:`h-4 w-4`}):(0,L.jsx)(jn,{className:`h-4 w-4`})})]})}),(0,L.jsx)(`main`,{className:I(`flex-1 w-full overflow-hidden flex flex-col`,_?`px-0 py-0`:`px-4 py-6`),children:D?(0,L.jsx)(`div`,{className:`mx-auto max-w-xl`,children:(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Login Required`}),(0,L.jsx)(U,{children:`Sign in to access this page.`})]}),(0,L.jsxs)(W,{className:`flex flex-col gap-3`,children:[(0,L.jsx)(R,{variant:`default`,disabled:u,onClick:async()=>{try{if(d(!0),!await La({loginHref:C})){window.location.href=C;return}await r.invalidateQueries({queryKey:G.session()})}finally{d(!1)}},children:u?`…`:`Login`}),(0,L.jsx)(`a`,{className:`text-sm text-muted-foreground underline`,href:C,children:`Login with redirect instead`})]})]})}):(0,L.jsxs)(L.Fragment,{children:[_?null:(0,L.jsx)(`div`,{className:`mb-6`,children:(0,L.jsx)(ga,{children:(0,L.jsxs)(_a,{children:[(0,L.jsx)(va,{children:(0,L.jsx)(ya,{href:`/status`,children:`Dashboard`})}),` `,e.pathname.split(`/`).filter(Boolean).map((e,t,n)=>{let r=`/${n.slice(0,t+1).join(`/`)}`,i=t===n.length-1;return(0,L.jsxs)(F.Fragment,{children:[(0,L.jsx)(xa,{}),(0,L.jsx)(va,{children:i?(0,L.jsx)(ba,{className:`capitalize`,children:e}):(0,L.jsx)(ya,{href:r,className:`capitalize`,children:e})})]},r)})]})})}),(0,L.jsx)(o,{}),_?null:(0,L.jsxs)(`footer`,{className:`mt-auto pt-12 pb-6 flex items-center justify-between text-xs text-muted-foreground border-t`,children:[(0,L.jsx)(`div`,{className:`flex gap-4`,children:(0,L.jsxs)(`span`,{children:[`Questions? Reach out at`,` `,(0,L.jsx)(`span`,{className:`font-mono text-primary`,children:`#ask-skyforge`})]})}),(0,L.jsx)(`a`,{className:`hover:text-foreground transition-colors underline hover:no-underline`,href:`/git/skyforge/skyforge/issues/new`,target:`_blank`,rel:`noreferrer`,children:`File an issue`})]})]})})]}),(0,L.jsx)(lr,{}),(0,L.jsx)(Fa,{})]})})}function qa(){return(0,L.jsx)(`div`,{className:`flex flex-col items-center justify-center min-h-[50vh] space-y-4 text-center`,children:(0,L.jsxs)(B,{variant:`glass`,className:`max-w-md`,children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{className:`text-2xl`,children:`Page not found`}),(0,L.jsx)(U,{children:`This route hasn’t been migrated yet (or the URL is incorrect).`})]}),(0,L.jsxs)(W,{className:`flex flex-wrap justify-center gap-3`,children:[(0,L.jsx)(R,{variant:`default`,asChild:!0,children:(0,L.jsx)(p,{to:`/dashboard/deployments`,children:`Go to deployments`})}),(0,L.jsx)(R,{variant:`outline`,asChild:!0,children:(0,L.jsx)(p,{to:`/status`,children:`Platform status`})})]})]})})}function Ja(e){let t=e.error instanceof Error?e.error.message:typeof e.error==`string`?e.error:`Unknown error`;return(0,L.jsxs)(`div`,{className:`space-y-6`,children:[(0,L.jsxs)(B,{variant:`danger`,children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Application error`}),(0,L.jsx)(U,{className:`text-red-200/80`,children:t})]}),(0,L.jsxs)(W,{className:`flex flex-wrap gap-3`,children:[(0,L.jsx)(R,{variant:`outline`,className:`border-red-500/50 bg-red-500/10 hover:bg-red-500/20 text-red-100`,onClick:()=>e.reset(),children:`Try again`}),(0,L.jsx)(R,{variant:`secondary`,asChild:!0,children:(0,L.jsx)(p,{to:`/dashboard/deployments`,children:`Go to deployments`})})]})]}),e.error instanceof Error&&e.error.stack&&(0,L.jsxs)(B,{children:[(0,L.jsx)(V,{children:(0,L.jsx)(H,{className:`text-sm`,children:`Error Stack Trace`})}),(0,L.jsx)(W,{children:(0,L.jsx)(`pre`,{className:`overflow-auto whitespace-pre-wrap text-xs text-muted-foreground p-4 rounded-md bg-muted`,children:e.error.stack})})]})]})}function Ya(e){return e===void 0?`minmax(0, 1fr)`:typeof e==`number`?`${e}px`:e}function Xa({columns:e,rows:t,getRowId:n,onRowClick:r,getRowClassName:i,getRowAriaSelected:a,isLoading:o,emptyText:s=`No results.`,maxHeightClassName:c=`max-h-[70vh]`,minWidthClassName:l=`min-w-[900px]`,estimateRowHeight:u=34}){let d=F.useRef(null),f=F.useMemo(()=>e.map(e=>Ya(e.width)).join(` `),[e]),p=m({count:t.length,getScrollElement:()=>d.current,estimateSize:()=>u,overscan:10}),h=p.getVirtualItems();return(0,L.jsx)(`div`,{className:`w-full overflow-x-auto rounded-md border`,children:(0,L.jsx)(`div`,{className:I(l),children:(0,L.jsxs)(`div`,{role:`table`,"aria-rowcount":t.length,className:`w-full text-sm`,style:{gridTemplateColumns:f},children:[(0,L.jsx)(`div`,{role:`rowgroup`,className:`sticky top-0 z-10 border-b bg-background/90 backdrop-blur`,children:(0,L.jsx)(`div`,{role:`row`,className:`grid`,style:{gridTemplateColumns:f},children:e.map(e=>(0,L.jsx)(`div`,{role:`columnheader`,className:I(`px-3 py-2 text-xs font-medium uppercase tracking-wide text-muted-foreground`,e.align===`center`&&`text-center`,e.align===`right`&&`text-right`,e.headerClassName),children:e.header},e.id))})}),(0,L.jsx)(`div`,{ref:d,role:`rowgroup`,className:I(`relative overflow-auto`,c),children:o?(0,L.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:`Loading…`}):t.length===0?(0,L.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:s}):(0,L.jsx)(`div`,{className:`relative`,style:{height:`${p.getTotalSize()}px`},children:h.map(o=>{let s=t[o.index],c=n(s),l=!!r,u=i?.(s,o.index),d=a?.(s,o.index);return(0,L.jsx)(`div`,{role:`row`,"aria-rowindex":o.index+1,"aria-selected":d,className:I(`absolute left-0 right-0 grid border-b last:border-b-0`,o.index%2==0&&`bg-background`,o.index%2==1&&`bg-muted/20`,l&&`cursor-pointer hover:bg-muted/40`,u),style:{gridTemplateColumns:f,transform:`translateY(${o.start}px)`},onClick:l?()=>r?.(s):void 0,children:e.map(e=>(0,L.jsx)(`div`,{role:`cell`,className:I(`px-3 py-2 align-middle`,e.align===`center`&&`text-center`,e.align===`right`&&`text-right`,e.className),children:e.cell(s)},e.id))},c)})})})]})})})}function Za({title:e,description:t,icon:n,action:r,className:i,...a}){return(0,L.jsx)(`div`,{className:I(`flex min-h-[400px] flex-col items-center justify-center rounded-md border border-dashed p-8 text-center animate-in fade-in zoom-in duration-300`,i),...a,children:(0,L.jsxs)(`div`,{className:`mx-auto flex max-w-[420px] flex-col items-center justify-center text-center`,children:[n&&(0,L.jsx)(`div`,{className:`flex h-20 w-20 items-center justify-center rounded-full bg-muted`,children:(0,L.jsx)(n,{className:`h-10 w-10 text-muted-foreground`})}),(0,L.jsx)(`h3`,{className:`mt-4 text-lg font-semibold`,children:e}),t&&(0,L.jsx)(`p`,{className:`mb-4 mt-2 text-sm text-muted-foreground`,children:t}),r&&(0,L.jsx)(R,{onClick:r.onClick,variant:`outline`,size:`sm`,children:r.label})]})})}function K({className:e,...t}){return(0,L.jsx)(`div`,{className:I(`animate-pulse rounded-md bg-muted`,e),...t})}function Qa(e,t){let n=c(),r=(0,F.useMemo)(()=>`${Dr}/webhooks/events/stream?limit=${encodeURIComponent(t)}`,[t]);(0,F.useEffect)(()=>{if(!e)return;let i=Ua(r,{snapshot:e=>{try{let r=JSON.parse(e.data);n.setQueryData(G.webhookEvents(t),r)}catch{}}});return()=>{i.close()}},[e,t,n,r])}const $a=t(`/webhooks`)({component:eo});function eo(){Qa(!0,`200`);let e=i({queryKey:G.webhookEvents(`200`),queryFn:()=>Bi({limit:`200`}),staleTime:1/0}),t=e.data?.events??[];return(0,L.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,L.jsx)(B,{variant:`glass`,children:(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Webhook inbox`}),(0,L.jsx)(U,{children:`Recent webhook events routed to your user.`})]})}),(0,L.jsx)(B,{children:(0,L.jsx)(W,{className:`p-0`,children:e.isLoading?(0,L.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,L.jsx)(K,{className:`h-12 w-full`}),(0,L.jsx)(K,{className:`h-12 w-full`}),(0,L.jsx)(K,{className:`h-12 w-full`})]}):e.isError?(0,L.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load webhook events.`}):t.length===0?(0,L.jsx)(Za,{icon:Kt,title:`No webhook events`,description:`No webhook events have been received yet.`}):(0,L.jsx)(Xa,{columns:[{id:`time`,header:`Time`,width:190,cell:e=>(0,L.jsx)(`span`,{className:`text-muted-foreground whitespace-nowrap text-xs`,children:e.receivedAt??``})},{id:`source`,header:`Source`,width:160,cell:e=>(0,L.jsx)(`span`,{className:`font-mono text-xs`,children:e.sourceIp??``})},{id:`event`,header:`Event`,cell:e=>(0,L.jsxs)(`span`,{className:`font-medium text-sm`,children:[e.method,` `,e.path]})},{id:`id`,header:`ID`,width:120,align:`right`,cell:e=>(0,L.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:String(e.id)})}],rows:t,getRowId:e=>String(e.id),maxHeightClassName:`max-h-[65vh]`})})})]})}function to(e,t){let n=c(),r=(0,F.useMemo)(()=>`${Dr}/syslog/events/stream?limit=${encodeURIComponent(t)}`,[t]);(0,F.useEffect)(()=>{if(!e)return;let i=Ua(r,{snapshot:e=>{try{let r=JSON.parse(e.data);n.setQueryData(G.syslogEvents(t),r)}catch{}}});return()=>{i.close()}},[e,t,n,r])}const no=t(`/syslog`)({component:ro});function ro(){to(!0,`200`);let e=i({queryKey:G.syslogEvents(`200`),queryFn:()=>Vi({limit:`200`}),staleTime:1/0}),t=e.data?.events??[];return(0,L.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,L.jsx)(B,{variant:`glass`,children:(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Syslog inbox`}),(0,L.jsx)(U,{children:`Recent syslog events mapped to your user.`})]})}),(0,L.jsx)(B,{children:(0,L.jsx)(W,{className:`p-0`,children:e.isLoading?(0,L.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,L.jsx)(K,{className:`h-12 w-full`}),(0,L.jsx)(K,{className:`h-12 w-full`}),(0,L.jsx)(K,{className:`h-12 w-full`})]}):e.isError?(0,L.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load syslog events.`}):t.length===0?(0,L.jsx)(Za,{icon:Kt,title:`No syslog events`,description:`No syslog messages have been received yet.`}):(0,L.jsx)(Xa,{columns:[{id:`time`,header:`Time`,width:190,cell:e=>(0,L.jsx)(`span`,{className:`text-muted-foreground whitespace-nowrap text-xs`,children:e.receivedAt??``})},{id:`source`,header:`Source`,width:160,cell:e=>(0,L.jsx)(`span`,{className:`font-mono text-xs`,children:e.sourceIp??``})},{id:`app`,header:`App`,width:160,cell:e=>(0,L.jsx)(`span`,{className:`text-xs`,children:e.appName??``})},{id:`message`,header:`Message`,cell:e=>(0,L.jsx)(`span`,{className:`font-medium text-foreground text-sm line-clamp-2`,children:e.message??``})}],rows:t,getRowId:e=>String(e.id),maxHeightClassName:`max-h-[65vh]`})})})]})}var io=Fn(`inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2`,{variants:{variant:{default:`border-transparent bg-primary text-primary-foreground hover:bg-primary/80`,secondary:`border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80`,destructive:`border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80`,outline:`text-foreground`}},defaultVariants:{variant:`default`}});function ao({className:e,variant:t,...n}){return(0,L.jsx)(`div`,{className:I(io({variant:t}),e),...n})}var oo={blue:`from-blue-500/10 via-blue-500/5 to-transparent`,green:`from-emerald-500/10 via-emerald-500/5 to-transparent`,purple:`from-purple-500/10 via-purple-500/5 to-transparent`,orange:`from-orange-500/10 via-orange-500/5 to-transparent`,red:`from-red-500/10 via-red-500/5 to-transparent`};const so=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`div`,{ref:n,className:I(`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4`,e),...t}));so.displayName=`BentoGrid`;const co=F.forwardRef(({className:e,gradient:t=`blue`,children:n,...r},i)=>(0,L.jsx)(`div`,{ref:i,className:I(`relative overflow-hidden rounded-xl border border-border bg-card p-6`,`bg-gradient-to-br`,oo[t],e),...r,children:n}));co.displayName=`BentoItem`;const lo=F.forwardRef(({title:e,value:t,gradient:n=`blue`,icon:r,subtitle:i,trend:a,className:o},s)=>(0,L.jsxs)(co,{ref:s,gradient:n,className:o,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-2 mb-2`,children:[r&&(0,L.jsx)(`div`,{className:`text-muted-foreground`,children:r}),(0,L.jsx)(`h3`,{className:`text-sm font-medium text-muted-foreground/80`,children:e})]}),(0,L.jsxs)(`div`,{className:`flex items-end justify-between`,children:[(0,L.jsx)(`div`,{className:`text-3xl font-bold`,children:t}),a&&(0,L.jsxs)(`div`,{className:I(`flex items-center gap-1 text-sm`,a.direction===`up`?`text-emerald-500`:`text-red-500`),children:[a.direction===`up`?(0,L.jsx)(Se,{className:`w-4 h-4`}):(0,L.jsx)(Re,{className:`w-4 h-4`}),a.value,`%`]})]}),i&&(0,L.jsx)(`p`,{className:`text-xs text-muted-foreground/70 mt-2`,children:i})]}));lo.displayName=`BentoStatCard`;const uo=F.forwardRef(({userName:e,subtitle:t,className:n},r)=>(0,L.jsx)(co,{ref:r,gradient:`purple`,className:I(`md:col-span-2`,n),children:(0,L.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,children:[(0,L.jsx)(`div`,{className:`p-2 rounded-full bg-purple-500/10`,children:(0,L.jsx)(Ne,{className:`w-5 h-5 text-purple-500`})}),(0,L.jsxs)(`div`,{children:[(0,L.jsx)(`h2`,{className:`text-xl font-bold`,children:e?`Welcome back, ${e}`:`Welcome to Skyforge`}),t&&(0,L.jsx)(`p`,{className:`text-sm text-muted-foreground/80`,children:t})]})]})}));uo.displayName=`BentoWelcomeCard`;const fo=F.forwardRef(({actions:e,className:t},n)=>(0,L.jsxs)(co,{ref:n,gradient:`blue`,className:I(`md:col-span-2`,t),children:[(0,L.jsx)(`h3`,{className:`font-semibold mb-4`,children:`Quick Actions`}),(0,L.jsx)(`div`,{className:`grid grid-cols-2 gap-3`,children:e.map((e,t)=>(0,L.jsxs)(Ct.button,{onClick:e.onClick,className:`flex items-center gap-2 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors text-left`,whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.icon,(0,L.jsx)(`span`,{className:`text-sm font-medium`,children:e.label})]},t))})]}));fo.displayName=`BentoQuickActions`;const po=F.forwardRef(({servers:e,className:t},n)=>(0,L.jsxs)(co,{ref:n,gradient:`green`,className:I(`md:col-span-2`,t),children:[(0,L.jsx)(`h3`,{className:`font-semibold mb-4`,children:`Server Status`}),(0,L.jsx)(`div`,{className:`grid grid-cols-2 gap-3`,children:e.map((e,t)=>(0,L.jsxs)(`div`,{className:`flex items-center justify-between p-3 rounded-lg bg-muted/30`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(`div`,{className:I(`w-2 h-2 rounded-full`,e.status===`online`?`bg-emerald-500`:e.status===`degraded`?`bg-amber-500`:`bg-red-500`)}),(0,L.jsx)(`span`,{className:`text-sm font-medium`,children:e.name})]}),e.cpu!==void 0&&(0,L.jsxs)(ao,{variant:`secondary`,className:`text-xs`,children:[e.cpu,`%`]})]},t))})]}));po.displayName=`BentoServerStatus`;function mo(e){let t=c(),n=(0,F.useMemo)(()=>`/status/summary/events`,[]);(0,F.useEffect)(()=>{if(!e)return;let r=Ua(n,{snapshot:e=>{try{let n=JSON.parse(e.data);t.setQueryData(G.statusSummary(),n)}catch{}}});return()=>{r.close()}},[e,t,n])}const ho=t(`/status`)({component:go});function go(){mo(!0);let e=i({queryKey:G.statusSummary(),queryFn:ca,staleTime:1/0}),t=i({queryKey:G.uiConfig(),queryFn:sa,staleTime:1/0}),n=t.data?.features,r=e.data,a=r?.checks??[],o=a.filter(e=>e.status!==`up`&&e.status!==`ok`);return(0,L.jsxs)(`div`,{className:`space-y-8 p-6`,children:[(0,L.jsxs)(so,{className:`gap-4`,children:[(0,L.jsx)(uo,{subtitle:`Here's what's happening with your infrastructure today.`}),e.isLoading?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(co,{className:`h-32`,children:(0,L.jsx)(K,{className:`h-full w-full`})}),(0,L.jsx)(co,{className:`h-32`,children:(0,L.jsx)(K,{className:`h-full w-full`})}),(0,L.jsx)(co,{className:`h-32`,children:(0,L.jsx)(K,{className:`h-full w-full`})})]}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(lo,{title:`Active Deployments`,value:r?.deploymentsActive??0,gradient:`green`,icon:(0,L.jsx)(De,{className:`w-5 h-5`}),subtitle:`${r?.deploymentsTotal??0} total deployments`}),(0,L.jsx)(lo,{title:`Services Operational`,value:`${r?.up??0} / ${a.length}`,gradient:r?.up===a.length?`green`:`orange`,icon:(0,L.jsx)(fe,{className:`w-5 h-5`})}),(0,L.jsx)(lo,{title:`Services Down`,value:r?.down??0,gradient:r?.down?`red`:`blue`,icon:(0,L.jsx)(he,{className:`w-5 h-5`})}),(0,L.jsxs)(co,{gradient:`purple`,className:`relative overflow-hidden`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between mb-3`,children:[(0,L.jsxs)(`h3`,{className:`font-semibold flex items-center gap-2 text-sm text-muted-foreground/80`,children:[(0,L.jsx)(je,{className:`w-4 h-4`}),`Platform Health`]}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsxs)(`span`,{className:`relative flex h-2 w-2`,children:[(0,L.jsx)(`span`,{className:`animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75`}),(0,L.jsx)(`span`,{className:`relative inline-flex rounded-full h-2 w-2 bg-emerald-500`})]}),(0,L.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:`Live`})]})]}),(0,L.jsx)(`div`,{className:`flex items-end gap-4`,children:(0,L.jsxs)(`div`,{children:[(0,L.jsx)(`span`,{className:I(`text-3xl font-bold`,r?.status===`ok`?`text-emerald-500`:r?.status===`degraded`?`text-amber-500`:`text-muted-foreground`),children:(r?.status??`checking`).toUpperCase()}),(0,L.jsx)(`p`,{className:`text-xs text-muted-foreground mt-1`,children:r?.timestamp?`Refreshed ${new Date(r.timestamp).toLocaleTimeString()}`:`Checking...`})]})})]})]})]}),(0,L.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-3`,children:[t.data?.externalUrl&&(0,L.jsxs)(B,{variant:`glass`,className:`border-green-500/20 bg-green-500/5`,children:[(0,L.jsx)(V,{children:(0,L.jsxs)(H,{className:`text-base flex items-center gap-2 text-green-500`,children:[(0,L.jsx)(Ot,{className:`w-4 h-4`}),`Public Access`]})}),(0,L.jsxs)(W,{className:`text-sm text-muted-foreground space-y-3`,children:[(0,L.jsx)(`p`,{children:`This environment is securely accessible via Cloudflare Tunnel.`}),(0,L.jsx)(`div`,{className:`rounded bg-background/50 p-2 border`,children:(0,L.jsx)(`a`,{className:`text-primary hover:underline break-all font-mono text-xs`,href:t.data.externalUrl,target:`_blank`,rel:`noreferrer`,children:t.data.externalUrl})})]})]}),(0,L.jsxs)(B,{variant:`glass`,children:[(0,L.jsx)(V,{children:(0,L.jsxs)(H,{className:`text-base flex items-center gap-2`,children:[(0,L.jsx)(ue,{className:`w-4 h-4 text-orange-500`}),`Skyforge at a Glance`]})}),(0,L.jsxs)(W,{className:`text-sm text-muted-foreground space-y-3`,children:[(0,L.jsx)(`p`,{children:`Skyforge coordinates lab + cloud tooling into repeatable, auditable workflows for platform teams.`}),(0,L.jsxs)(`ul`,{className:`list-disc pl-4 space-y-1`,children:[(0,L.jsx)(`li`,{children:`Teams can still run tools manually; Skyforge standardizes the "happy path".`}),(0,L.jsx)(`li`,{children:`Enables consistent lab delivery across on-prem and cloud environments.`}),(0,L.jsx)(`li`,{children:`Creates shared context for collaboration, troubleshooting, and handoffs.`})]})]})]}),(0,L.jsxs)(B,{variant:`glass`,children:[(0,L.jsx)(V,{children:(0,L.jsxs)(H,{className:`text-base flex items-center gap-2`,children:[(0,L.jsx)(Be,{className:`w-4 h-4 text-blue-500`}),`What You Can Do Here`]})}),(0,L.jsxs)(W,{className:`text-sm text-muted-foreground space-y-2`,children:[(0,L.jsx)(p,{className:`text-primary hover:underline`,to:`/dashboard/deployments`,children:`→ Open the dashboard`}),(0,L.jsx)(p,{className:`text-primary hover:underline`,to:`/dashboard/deployments/new`,children:`→ Create a deployment`}),(0,L.jsx)(p,{className:`text-primary hover:underline`,to:`/dashboard/s3`,children:`→ Browse artifacts (S3)`}),(0,L.jsx)(`p`,{className:`text-xs text-muted-foreground mt-3`,children:`Status is refreshed automatically via Server-Sent Events.`})]})]}),(0,L.jsxs)(B,{variant:`glass`,children:[(0,L.jsx)(V,{children:(0,L.jsxs)(H,{className:`text-base flex items-center gap-2`,children:[(0,L.jsx)(x,{className:`w-4 h-4 text-purple-500`}),`How Workflows Run`]})}),(0,L.jsxs)(W,{className:`text-sm text-muted-foreground space-y-2`,children:[(0,L.jsx)(`p`,{children:`Skyforge connects source control, automation, and lab capacity into one delivery loop.`}),(0,L.jsxs)(`ol`,{className:`list-decimal pl-4 space-y-1`,children:[(0,L.jsx)(`li`,{children:`Choose a blueprint (Git).`}),(0,L.jsx)(`li`,{children:`Run deployments (native task engine).`}),(0,L.jsx)(`li`,{children:`Validate on lab servers (BYOS + In-Cluster).`}),(0,L.jsx)(`li`,{children:`Store artifacts + state (Skyforge storage).`})]})]})]})]}),(0,L.jsx)(so,{className:`gap-4`,children:(0,L.jsxs)(co,{gradient:`blue`,className:`md:col-span-4 hover-lift`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between mb-6`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,L.jsx)(`div`,{className:`p-2 rounded-lg bg-blue-500/10`,children:(0,L.jsx)(he,{className:`w-5 h-5 text-blue-500`})}),(0,L.jsxs)(`div`,{children:[(0,L.jsx)(`h3`,{className:`font-semibold`,children:`Integrated Toolchain & Status`}),(0,L.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Live health checks for all platform services.`})]})]}),o.length>0&&(0,L.jsxs)(ao,{variant:`destructive`,className:`animate-pulse`,children:[o.length,` Service`,o.length>1?`s`:``,` `,`Reporting Issues`]})]}),(0,L.jsx)(`div`,{className:`grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4`,children:[{id:`gitea`,name:`Git`,path:`/git/`,icon:ct,enabled:n?.giteaEnabled??!0,external:!0},{id:`netbox`,name:`NetBox`,path:`/netbox/`,icon:sn,enabled:n?.netboxEnabled??!1,external:!0},{id:`nautobot`,name:`Nautobot`,path:`/nautobot/`,icon:sn,enabled:n?.nautobotEnabled??!1,external:!0},{id:`coder`,name:`Coder`,path:`/coder/launch`,icon:De,enabled:n?.coderEnabled??!1,external:!0},{id:`yaade`,name:`API Testing`,path:`${Dr}/yaade/sso`,icon:je,enabled:n?.yaadeEnabled??!1,external:!0},{id:`webhooks`,name:`Webhooks`,path:`/dashboard/webhooks`,icon:x,enabled:!0,external:!1}].filter(e=>e.enabled).map(e=>{let t=a.find(t=>t.name.toLowerCase().includes(e.id)),n=t?t.status===`up`||t.status===`ok`:!0,r=n?`bg-emerald-500`:`bg-red-500`,i=e.icon;return(0,L.jsxs)(`a`,{href:e.path,target:e.external?`_blank`:`_self`,rel:e.external?`noreferrer noopener`:void 0,className:`flex flex-col items-center justify-center p-4 rounded-lg bg-background/50 border hover:bg-background/80 transition-colors group relative overflow-hidden`,children:[(0,L.jsx)(`div`,{className:`absolute top-2 right-2 w-2 h-2 rounded-full ${r} ${n?``:`animate-pulse`}`}),(0,L.jsx)(i,{className:`w-6 h-6 mb-2 text-muted-foreground group-hover:text-primary transition-colors`}),(0,L.jsx)(`span`,{className:`text-sm font-medium`,children:e.name}),(0,L.jsx)(`span`,{className:I(`text-[10px] mt-1 capitalize font-medium`,n?`text-emerald-500/80`:`text-red-500`),children:t?.status??`Operational`})]},e.id)})}),o.length>0&&(0,L.jsxs)(`div`,{className:`mt-6 pt-6 border-t`,children:[(0,L.jsx)(`h4`,{className:`text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-3`,children:`Service Alerts`}),(0,L.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:o.map(e=>(0,L.jsxs)(ao,{variant:`outline`,className:`text-[10px] border-red-500/30 text-red-400 bg-red-500/5`,children:[e.name,`: `,e.status]},e.name))})]})]})})]})}function _o(e,t){let n=c(),r=(0,F.useMemo)(()=>`${Dr}/snmp/traps/events/stream?limit=${encodeURIComponent(t)}`,[t]);(0,F.useEffect)(()=>{if(!e)return;let i=Ua(r,{snapshot:e=>{try{let r=JSON.parse(e.data);n.setQueryData(G.snmpTrapEvents(t),r)}catch{}}});return()=>{i.close()}},[e,t,n,r])}const vo=t(`/snmp`)({component:yo});function yo(){_o(!0,`200`);let e=i({queryKey:G.snmpTrapEvents(`200`),queryFn:()=>Hi({limit:`200`}),staleTime:1/0}),t=e.data?.events??[];return(0,L.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,L.jsx)(B,{variant:`glass`,children:(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`SNMP trap inbox`}),(0,L.jsx)(U,{children:`Recent SNMP trap events routed to your user.`})]})}),(0,L.jsx)(B,{children:(0,L.jsx)(W,{className:`p-0`,children:e.isLoading?(0,L.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,L.jsx)(K,{className:`h-12 w-full`}),(0,L.jsx)(K,{className:`h-12 w-full`}),(0,L.jsx)(K,{className:`h-12 w-full`})]}):e.isError?(0,L.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load SNMP trap events.`}):t.length===0?(0,L.jsx)(Za,{icon:Kt,title:`No trap events`,description:`No SNMP traps have been received yet.`}):(0,L.jsx)(Xa,{columns:[{id:`time`,header:`Time`,width:190,cell:e=>(0,L.jsx)(`span`,{className:`text-muted-foreground whitespace-nowrap text-xs`,children:e.receivedAt??``})},{id:`source`,header:`Source`,width:160,cell:e=>(0,L.jsx)(`span`,{className:`font-mono text-xs`,children:e.sourceIp??``})},{id:`oid`,header:`OID`,cell:e=>(0,L.jsx)(`span`,{className:`font-medium text-foreground text-sm font-mono`,children:e.oid??``})},{id:`id`,header:`ID`,width:120,align:`right`,cell:e=>(0,L.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:String(e.id)})}],rows:t,getRowId:e=>String(e.id),maxHeightClassName:`max-h-[65vh]`})})})]})}var bo=at,xo=et,So=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(nt,{className:I(`fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t,ref:n}));So.displayName=nt.displayName;var Co=F.forwardRef(({className:e,...t},n)=>(0,L.jsxs)(xo,{children:[(0,L.jsx)(So,{}),(0,L.jsx)(nn,{ref:n,className:I(`fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg`,e),...t})]}));Co.displayName=nn.displayName;var wo=({className:e,...t})=>(0,L.jsx)(`div`,{className:I(`flex flex-col space-y-2 text-center sm:text-left`,e),...t});wo.displayName=`AlertDialogHeader`;var To=({className:e,...t})=>(0,L.jsx)(`div`,{className:I(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});To.displayName=`AlertDialogFooter`;var Eo=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(Pe,{ref:n,className:I(`text-lg font-semibold`,e),...t}));Eo.displayName=Pe.displayName;var Do=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(me,{ref:n,className:I(`text-sm text-muted-foreground`,e),...t}));Do.displayName=me.displayName;var Oo=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(A,{ref:n,className:I(mr(),e),...t}));Oo.displayName=A.displayName;var ko=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(_e,{ref:n,className:I(mr({variant:`outline`}),`mt-2 sm:mt-0`,e),...t}));ko.displayName=_e.displayName;var Ao=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(Ge,{ref:n,className:I(`peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground`,e),...t,children:(0,L.jsx)(Ze,{className:I(`flex items-center justify-center text-current`),children:(0,L.jsx)(Ye,{className:`h-4 w-4`})})}));Ao.displayName=Ge.displayName;var jo=Fn(`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70`),q=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(ce,{ref:n,className:I(jo(),e),...t}));q.displayName=ce.displayName;var Mo=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(S,{className:I(`peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input`,e),...t,ref:n,children:(0,L.jsx)(Je,{className:I(`pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0`)})}));Mo.displayName=S.displayName;const No=t(`/notifications`)({component:Po});function Po(){let[e,t]=(0,F.useState)(!1),[n,r]=(0,F.useState)(null),[a,o]=(0,F.useState)(!1),[s,l]=(0,F.useState)(new Set),u=c(),d=i({queryKey:G.session(),queryFn:Ar,staleTime:3e4,retry:!1}).data?.username??``;Wa(!!d,e,`50`);let f=i({queryKey:G.notifications(e,`50`),enabled:!!d,queryFn:async()=>({notifications:(await Pr(d,{include_read:e?`true`:`false`,limit:`50`})).notifications??[]}),staleTime:1/0,initialData:{notifications:[]}}),p=(0,F.useMemo)(()=>f.data?.notifications??[],[f.data?.notifications]),m=(0,F.useMemo)(()=>p.filter(e=>!e.is_read).length,[p]),h=e=>{l(e?new Set(p.map(e=>String(e.id))):new Set)},g=(e,t)=>{let n=new Set(s);t?n.add(e):n.delete(e),l(n)},_=async()=>{try{let t=Array.from(s).map(e=>Ir(e));await Promise.all(t),P.success(`${s.size} notifications marked as read`),l(new Set),await u.invalidateQueries({queryKey:G.notifications(e,`50`)})}catch(e){P.error(`Failed to mark selection as read`,{description:e.message})}},v=async()=>{try{let t=Array.from(s).map(e=>Lr(e));await Promise.all(t),P.success(`${s.size} notifications deleted`),l(new Set),await u.invalidateQueries({queryKey:G.notifications(e,`50`)})}catch(e){P.error(`Failed to delete selection`,{description:e.message})}},y=async()=>{try{await Fr(d),P.success(`All notifications marked as read`)}catch(e){P.error(`Failed to mark notifications as read`,{description:e.message})}},b=async e=>{try{await Ir(e),P.success(`Notification marked as read`)}catch(e){P.error(`Failed to mark notification as read`,{description:e.message})}},x=async()=>{if(n)try{await Lr(n),P.success(`Notification deleted`),o(!1),r(null)}catch(e){P.error(`Failed to delete notification`,{description:e.message})}},S=[{id:`select`,header:(0,L.jsx)(Ao,{checked:p.length>0&&s.size===p.length,onCheckedChange:e=>h(!!e),"aria-label":`Select all`}),width:54,headerClassName:`px-2 py-0`,className:`px-2 py-0`,cell:e=>{let t=String(e.id);return(0,L.jsx)(Ao,{checked:s.has(t),onCheckedChange:e=>g(t,e),"aria-label":`Select notification ${t}`})}},{id:`time`,header:`Time`,width:190,cell:e=>(0,L.jsx)(`span`,{className:`text-muted-foreground text-xs whitespace-nowrap`,children:e.created_at??``})},{id:`message`,header:`Title & Message`,cell:e=>(0,L.jsxs)(`div`,{children:[(0,L.jsx)(`div`,{className:`font-medium text-sm`,children:e.title??``}),e.message?(0,L.jsx)(`div`,{className:`mt-1 text-xs text-muted-foreground line-clamp-2`,children:e.message}):null]})},{id:`category`,header:`Category`,width:160,cell:e=>(0,L.jsx)(`span`,{className:`inline-flex items-center rounded-full bg-muted px-2 py-0.5 text-[10px] font-medium text-muted-foreground capitalize`,children:e.category??`System`})},{id:`actions`,header:`Actions`,width:120,align:`right`,cell:e=>{let t=String(e.id);return(0,L.jsxs)(hr,{children:[(0,L.jsx)(gr,{asChild:!0,children:(0,L.jsxs)(R,{variant:`ghost`,size:`icon`,className:`h-8 w-8`,children:[(0,L.jsx)(ne,{className:`h-4 w-4`}),(0,L.jsx)(`span`,{className:`sr-only`,children:`Open menu`})]})}),(0,L.jsxs)(yr,{align:`end`,children:[!e.is_read&&(0,L.jsxs)(br,{onClick:()=>b(t),children:[(0,L.jsx)(Ye,{className:`mr-2 h-4 w-4`}),(0,L.jsx)(`span`,{children:`Mark as read`})]}),(0,L.jsxs)(br,{className:`text-destructive focus:text-destructive`,onClick:()=>{r(t),o(!0)},children:[(0,L.jsx)(Mn,{className:`mr-2 h-4 w-4`}),(0,L.jsx)(`span`,{children:`Delete`})]})]})]})}}];return(0,L.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,L.jsx)(B,{variant:`glass`,children:(0,L.jsx)(V,{children:(0,L.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,L.jsx)(`div`,{className:`p-2 rounded-full bg-primary/10`,children:(0,L.jsx)(j,{className:`h-6 w-6 text-primary`})}),(0,L.jsxs)(`div`,{children:[(0,L.jsx)(H,{children:`Notifications`}),(0,L.jsx)(U,{children:`Stay updated with platform events and system alerts.`})]})]}),(0,L.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(Mo,{id:`show-read`,checked:e,onCheckedChange:t}),(0,L.jsx)(q,{htmlFor:`show-read`,className:`cursor-pointer`,children:`Show read`})]}),(0,L.jsx)(R,{variant:`outline`,size:`sm`,disabled:!d||m===0,onClick:y,children:`Mark all read`})]})]})})}),s.size>0&&(0,L.jsxs)(`div`,{className:`fixed bottom-6 left-1/2 -translate-x-1/2 z-50 flex items-center gap-4 rounded-full border bg-background/95 p-2 px-6 shadow-xl backdrop-blur animate-in slide-in-from-bottom-10 fade-in duration-300`,children:[(0,L.jsxs)(`span`,{className:`text-sm font-medium`,children:[s.size,` selected`]}),(0,L.jsx)(`div`,{className:`h-4 w-px bg-border`}),(0,L.jsxs)(R,{size:`sm`,variant:`ghost`,onClick:_,children:[(0,L.jsx)(Ye,{className:`mr-2 h-4 w-4`}),`Mark read`]}),(0,L.jsxs)(R,{size:`sm`,variant:`destructive`,onClick:v,children:[(0,L.jsx)(Mn,{className:`mr-2 h-4 w-4`}),`Delete`]}),(0,L.jsx)(R,{size:`sm`,variant:`ghost`,onClick:()=>l(new Set),children:`Cancel`})]}),(0,L.jsx)(B,{children:(0,L.jsx)(W,{className:`p-0`,children:f.isLoading?(0,L.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,L.jsx)(K,{className:`h-12 w-full`}),(0,L.jsx)(K,{className:`h-12 w-full`}),(0,L.jsx)(K,{className:`h-12 w-full`})]}):f.isError?(0,L.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load notifications.`}):p.length===0?(0,L.jsx)(Za,{icon:Kt,title:`No notifications`,description:e?`You don't have any notifications at the moment.`:`You've read all your notifications!`}):(0,L.jsx)(Xa,{columns:S,rows:p,getRowId:e=>String(e.id),getRowClassName:e=>{let t=String(e.id),n=s.has(t);return[e.is_read?`opacity-60 grayscale-[0.5]`:``,n?`bg-primary/10 hover:bg-primary/10`:``].filter(Boolean).join(` `)},getRowAriaSelected:e=>s.has(String(e.id)),maxHeightClassName:`max-h-[65vh]`,minWidthClassName:`min-w-[900px]`})})}),(0,L.jsx)(bo,{open:a,onOpenChange:o,children:(0,L.jsxs)(Co,{children:[(0,L.jsxs)(wo,{children:[(0,L.jsx)(Eo,{children:`Delete notification?`}),(0,L.jsx)(Do,{children:`This action cannot be undone.`})]}),(0,L.jsxs)(To,{children:[(0,L.jsx)(ko,{children:`Cancel`}),(0,L.jsx)(Oo,{onClick:x,className:mr({variant:`destructive`}),children:`Delete`})]})]})})]})}var J=F.forwardRef(({className:e,type:t,...n},r)=>(0,L.jsx)(`input`,{type:t,className:I(`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm`,e),ref:r,...n}));J.displayName=`Input`;var Y=Ee,X=N,Z=F.forwardRef(({className:e,children:t,...n},r)=>(0,L.jsxs)(be,{ref:r,className:I(`flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1`,e),...n,children:[t,(0,L.jsx)(O,{asChild:!0,children:(0,L.jsx)(C,{className:`h-4 w-4 opacity-50`})})]}));Z.displayName=be.displayName;var Fo=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(ie,{ref:n,className:I(`flex cursor-default items-center justify-center py-1`,e),...t,children:(0,L.jsx)(xe,{className:`h-4 w-4`})}));Fo.displayName=ie.displayName;var Io=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(M,{ref:n,className:I(`flex cursor-default items-center justify-center py-1`,e),...t,children:(0,L.jsx)(C,{className:`h-4 w-4`})}));Io.displayName=M.displayName;var Q=F.forwardRef(({className:e,children:t,position:n=`popper`,...r},i)=>(0,L.jsx)(Ce,{children:(0,L.jsxs)(He,{ref:i,className:I(`relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,n===`popper`&&`data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1`,e),position:n,...r,children:[(0,L.jsx)(Fo,{}),(0,L.jsx)(An,{className:I(`p-1`,n===`popper`&&`h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]`),children:t}),(0,L.jsx)(Io,{})]})}));Q.displayName=He.displayName;var Lo=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(It,{ref:n,className:I(`py-1.5 pl-8 pr-2 text-sm font-semibold`,e),...t}));Lo.displayName=It.displayName;var $=F.forwardRef(({className:e,children:t,...n},r)=>(0,L.jsxs)(ke,{ref:r,className:I(`relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...n,children:[(0,L.jsx)(`span`,{className:`absolute left-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,L.jsx)(zt,{children:(0,L.jsx)(Ye,{className:`h-4 w-4`})})}),(0,L.jsx)(y,{children:t})]}));$.displayName=ke.displayName;var Ro=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(de,{ref:n,className:I(`-mx-1 my-1 h-px bg-muted`,e),...t}));Ro.displayName=de.displayName;var zo=T,Bo=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(ze,{ref:n,className:I(`inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground`,e),...t}));Bo.displayName=ze.displayName;var Vo=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(xn,{ref:n,className:I(`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm`,e),...t}));Vo.displayName=xn.displayName;var Ho=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(wn,{ref:n,className:I(`mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2`,e),...t}));Ho.displayName=wn.displayName;const Uo=t(`/design`)({component:Wo});function Wo(){return(0,L.jsxs)(`div`,{className:`space-y-10 p-6 pb-20`,children:[(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(`h1`,{className:`text-3xl font-bold tracking-tight`,children:`Design System`}),(0,L.jsx)(`p`,{className:`text-muted-foreground`,children:`A catalog of all reusable UI components available in the portal.`})]}),(0,L.jsxs)(`section`,{className:`space-y-4`,children:[(0,L.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Buttons`}),(0,L.jsxs)(`div`,{className:`flex flex-wrap gap-4`,children:[(0,L.jsx)(R,{variant:`default`,children:`Default`}),(0,L.jsx)(R,{variant:`secondary`,children:`Secondary`}),(0,L.jsx)(R,{variant:`destructive`,children:`Destructive`}),(0,L.jsx)(R,{variant:`outline`,children:`Outline`}),(0,L.jsx)(R,{variant:`ghost`,children:`Ghost`}),(0,L.jsx)(R,{variant:`link`,children:`Link`}),(0,L.jsx)(R,{size:`sm`,children:`Small`}),(0,L.jsx)(R,{size:`lg`,children:`Large`}),(0,L.jsx)(R,{size:`icon`,children:(0,L.jsx)(se,{className:`h-4 w-4`})}),(0,L.jsx)(R,{disabled:!0,children:`Disabled`}),(0,L.jsxs)(R,{variant:`outline`,className:`gap-2`,children:[(0,L.jsx)(Zt,{className:`h-4 w-4`}),` With Icon`]})]})]}),(0,L.jsxs)(`section`,{className:`space-y-4`,children:[(0,L.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Badges`}),(0,L.jsxs)(`div`,{className:`flex flex-wrap gap-4`,children:[(0,L.jsx)(ao,{children:`Default`}),(0,L.jsx)(ao,{variant:`secondary`,children:`Secondary`}),(0,L.jsx)(ao,{variant:`outline`,children:`Outline`}),(0,L.jsx)(ao,{variant:`destructive`,children:`Destructive`})]})]}),(0,L.jsxs)(`section`,{className:`space-y-4`,children:[(0,L.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Cards`}),(0,L.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2 lg:grid-cols-4`,children:[(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Default Card`}),(0,L.jsx)(U,{children:`Standard container style`})]}),(0,L.jsx)(W,{children:`Content goes here`})]}),(0,L.jsxs)(B,{variant:`glass`,children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Glass Card`}),(0,L.jsx)(U,{children:`Backdrop blur effect`})]}),(0,L.jsx)(W,{children:`Popular for headers`})]}),(0,L.jsxs)(B,{variant:`flat`,children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Flat Card`}),(0,L.jsx)(U,{children:`No shadow, border only`})]}),(0,L.jsx)(W,{children:`Clean look`})]}),(0,L.jsxs)(B,{variant:`danger`,children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Danger Card`}),(0,L.jsx)(U,{children:`For error states`})]}),(0,L.jsx)(W,{className:`text-sm`,children:`Something went wrong`})]})]})]}),(0,L.jsxs)(`section`,{className:`space-y-4`,children:[(0,L.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Bento Grid`}),(0,L.jsxs)(so,{children:[(0,L.jsx)(lo,{title:`Total Revenue`,value:`$45,231.89`,icon:(0,L.jsx)(b,{className:`h-4 w-4`}),gradient:`blue`}),(0,L.jsx)(lo,{title:`Active Users`,value:`+2350`,icon:(0,L.jsx)(Ne,{className:`h-4 w-4`}),gradient:`green`}),(0,L.jsx)(co,{gradient:`purple`,className:`md:col-span-2`,children:(0,L.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,L.jsx)(`div`,{className:`p-2 bg-background/20 rounded-full`,children:(0,L.jsx)(De,{className:`h-6 w-6`})}),(0,L.jsxs)(`div`,{children:[(0,L.jsx)(`h3`,{className:`font-semibold text-lg`,children:`Cloud Infrastructure`}),(0,L.jsx)(`p`,{className:`text-sm text-muted-foreground/80`,children:`Manage your cloud resources and deployments from a single dashboard.`})]})]})})]})]}),(0,L.jsxs)(`section`,{className:`space-y-4`,children:[(0,L.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Form Inputs`}),(0,L.jsx)(B,{children:(0,L.jsxs)(W,{className:`pt-6 space-y-4 max-w-md`,children:[(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(q,{htmlFor:`email`,children:`Email address`}),(0,L.jsx)(J,{type:`email`,id:`email`,placeholder:`name@example.com`})]}),(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(q,{children:`Framework`}),(0,L.jsxs)(Y,{children:[(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:`Select framework`})}),(0,L.jsxs)(Q,{children:[(0,L.jsx)($,{value:`react`,children:`React`}),(0,L.jsx)($,{value:`vue`,children:`Vue`}),(0,L.jsx)($,{value:`svelte`,children:`Svelte`})]})]})]}),(0,L.jsxs)(`div`,{className:`flex items-center space-x-2`,children:[(0,L.jsx)(Mo,{id:`airplane-mode`}),(0,L.jsx)(q,{htmlFor:`airplane-mode`,children:`Airplane Mode`})]})]})})]}),(0,L.jsxs)(`section`,{className:`space-y-4`,children:[(0,L.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Tabs`}),(0,L.jsxs)(zo,{defaultValue:`account`,className:`w-[400px]`,children:[(0,L.jsxs)(Bo,{children:[(0,L.jsx)(Vo,{value:`account`,children:`Account`}),(0,L.jsx)(Vo,{value:`password`,children:`Password`})]}),(0,L.jsx)(Ho,{value:`account`,children:(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Account`}),(0,L.jsx)(U,{children:`Make changes to your account here.`})]}),(0,L.jsx)(W,{className:`space-y-2`,children:(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{htmlFor:`name`,children:`Name`}),(0,L.jsx)(J,{id:`name`,defaultValue:`Pedro Duarte`})]})}),(0,L.jsx)(wa,{children:(0,L.jsx)(R,{children:`Save changes`})})]})}),(0,L.jsx)(Ho,{value:`password`,children:(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Password`}),(0,L.jsx)(U,{children:`Change your password here.`})]}),(0,L.jsx)(W,{className:`space-y-2`,children:(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{htmlFor:`current`,children:`Current password`}),(0,L.jsx)(J,{id:`current`,type:`password`})]})}),(0,L.jsx)(wa,{children:(0,L.jsx)(R,{children:`Save password`})})]})})]})]}),(0,L.jsxs)(`section`,{className:`space-y-4`,children:[(0,L.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Feedback & Status`}),(0,L.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:[(0,L.jsxs)(`div`,{className:`space-y-4`,children:[(0,L.jsx)(`h3`,{className:`text-sm font-medium text-muted-foreground`,children:`Empty State`}),(0,L.jsx)(`div`,{className:`border rounded-lg p-4`,children:(0,L.jsx)(Za,{icon:Kt,title:`No items found`,description:`You haven't created any items yet.`,action:{label:`Create Item`,onClick:()=>P(`Clicked create`)},className:`min-h-[200px]`})})]}),(0,L.jsxs)(`div`,{className:`space-y-4`,children:[(0,L.jsx)(`h3`,{className:`text-sm font-medium text-muted-foreground`,children:`Skeleton Loading`}),(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(K,{className:`h-5 w-[140px] mb-2`}),(0,L.jsx)(K,{className:`h-4 w-[250px]`})]}),(0,L.jsxs)(W,{className:`space-y-2`,children:[(0,L.jsx)(K,{className:`h-4 w-full`}),(0,L.jsx)(K,{className:`h-4 w-full`}),(0,L.jsx)(K,{className:`h-4 w-3/4`})]})]})]})]})]}),(0,L.jsxs)(`section`,{className:`space-y-4`,children:[(0,L.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Toast Notifications`}),(0,L.jsxs)(`div`,{className:`flex flex-wrap gap-4`,children:[(0,L.jsx)(R,{variant:`outline`,onClick:()=>P(`Event has been created`),children:`Simple Toast`}),(0,L.jsx)(R,{variant:`outline`,onClick:()=>P.success(`Event created successfully`),children:`Success`}),(0,L.jsx)(R,{variant:`outline`,onClick:()=>P.error(`Failed to create event`),children:`Error`}),(0,L.jsx)(R,{variant:`outline`,onClick:()=>P.info(`New updates available`,{description:`Refresh to see changes`}),children:`With Description`}),(0,L.jsx)(R,{variant:`outline`,onClick:()=>P(`Event deleted`,{action:{label:`Undo`,onClick:()=>console.log(`Undo`)}}),children:`With Action`})]})]}),(0,L.jsxs)(`section`,{className:`space-y-4`,children:[(0,L.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Breadcrumbs`}),(0,L.jsx)(`div`,{className:`p-4 border rounded-lg`,children:(0,L.jsx)(ga,{children:(0,L.jsxs)(_a,{children:[(0,L.jsx)(va,{children:(0,L.jsx)(ya,{href:`/status`,children:`Dashboard`})}),` `,(0,L.jsx)(xa,{}),(0,L.jsx)(va,{children:(0,L.jsx)(ya,{href:`/components`,children:`Components`})}),(0,L.jsx)(xa,{}),(0,L.jsx)(va,{children:(0,L.jsx)(ba,{children:`Breadcrumb`})})]})})})]})]})}const Go=t(`/`)({component:Ko});function Ko(){let e=n(),t=i({queryKey:G.session(),queryFn:Ar,retry:!1,staleTime:3e4});return(0,F.useEffect)(()=>{t.isLoading||(t.data?.authenticated?e({to:`/dashboard/deployments`,replace:!0}):e({to:`/status`,replace:!0}))},[t.data?.authenticated,t.isLoading,e]),null}const qo=t(`/dashboard/`)({component:Jo});function Jo(){let e=n();return(0,F.useEffect)(()=>{e({to:`/status`,replace:!0})},[e]),null}const Yo=t(`/admin/`)({component:Xo});function Xo(){let e=n();return(0,F.useEffect)(()=>{e({to:`/admin/settings`,replace:!0})},[e]),null}const Zo=t(`/dashboard/servicenow`)({component:Qo});function Qo(){let e=c(),t=G.userServiceNowConfig(),n=G.userServiceNowPdiStatus(),a=G.userServiceNowSchemaStatus(),o=G.userForwardCollectorConfigs(),s=i({queryKey:t,queryFn:Wr,retry:!1}).data,[l,u]=(0,F.useState)(``),[d,f]=(0,F.useState)(``),[p,m]=(0,F.useState)(``),[h,g]=(0,F.useState)(``),[_,v]=(0,F.useState)(`collector`),[y,b]=(0,F.useState)(``),[x,S]=(0,F.useState)(``),[C,w]=(0,F.useState)(!0);(0,F.useEffect)(()=>{s&&(u(s.instanceUrl??``),f(s.adminUsername??``),g(s.forwardCollectorConfigId??``),v(s.forwardCollectorConfigId?`collector`:s.forwardUsername?`custom`:`collector`),b(s.forwardUsername??``))},[s]);let T=i({queryKey:o,queryFn:ki,retry:!1,staleTime:3e4}),E=(0,F.useMemo)(()=>T.data?.collectors??[],[T.data]);(0,F.useEffect)(()=>{if(_!==`collector`||h)return;let e=E.find(e=>e.isDefault)??E[0];e?.id&&g(e.id)},[s,E,h,_]);let D=i({queryKey:n,queryFn:qr,enabled:!!s?.configured,retry:!1,refetchOnWindowFocus:!0,staleTime:0,refetchInterval:e=>{if(document.visibilityState===`hidden`)return!1;let t=e.state.data?.status??``;return t===`awake`?12e4:t===`sleeping`||t===`waking`||t===`unreachable`?3e4:6e4}}),O=i({queryKey:a,queryFn:Jr,enabled:!!s?.configured,retry:!1,refetchOnWindowFocus:!0,staleTime:0}),ee=r({mutationFn:async()=>Yr(),onSuccess:async()=>{P.success(`Wake requested`),await e.invalidateQueries({queryKey:n})},onError:e=>P.error(`Failed to wake PDI`,{description:e.message})}),k=r({mutationFn:async()=>{if(!l.trim())throw Error(`ServiceNow instance URL is required`);if(!d.trim())throw Error(`ServiceNow admin username is required`);let e=_===`collector`;if(e){if(!h.trim())throw Error(`Select a Forward collector (or choose Custom)`)}else if(!y.trim())throw Error(`Forward username is required`);return Gr({instanceUrl:l.trim(),adminUsername:d.trim(),adminPassword:p,forwardCollectorConfigId:e?h.trim():``,forwardUsername:e?``:y.trim(),forwardPassword:e?``:x})},onSuccess:async()=>{P.success(`Saved ServiceNow settings`),m(``),S(``),await e.invalidateQueries({queryKey:t}),await e.invalidateQueries({queryKey:n}),await e.invalidateQueries({queryKey:a}),C&&ne.mutate()},onError:e=>P.error(`Failed to save ServiceNow settings`,{description:e.message})}),te=r({mutationFn:async()=>Kr(),onSuccess:async n=>{n.installed?P.success(`ServiceNow demo installed`):P.error(`ServiceNow install failed`,{description:n.message}),await e.invalidateQueries({queryKey:t})},onError:e=>P.error(`Failed to install ServiceNow demo`,{description:e.message})}),ne=r({mutationFn:async()=>Xr(),onSuccess:async e=>{e.configured?P.success(`Configured Forward ticketing integration`):P.error(`Failed to configure Forward`,{description:e.message})},onError:e=>P.error(`Failed to configure Forward`,{description:e.message})});return(0,L.jsxs)(`div`,{className:`p-6 space-y-6`,children:[(0,L.jsxs)(`div`,{children:[(0,L.jsx)(`h1`,{className:`text-2xl font-bold`,children:`ServiceNow`}),(0,L.jsx)(`p`,{className:`text-sm text-muted-foreground mt-1`,children:`Install the Forward Connectivity Ticket demo into a ServiceNow PDI. ServiceNow calls Forward SaaS directly; Skyforge only installs and configures the app.`})]}),(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Quick links`}),(0,L.jsx)(U,{children:`Create a ServiceNow PDI (manual step).`})]}),(0,L.jsxs)(W,{className:`space-y-2`,children:[(0,L.jsx)(`a`,{className:`text-sm underline`,href:`https://developer.servicenow.com/dev.do#!/guides/now-platform/pdi-guide/obtaining-a-pdi`,target:`_blank`,rel:`noreferrer`,children:`Create a Personal Developer Instance (PDI)`}),(0,L.jsx)(`a`,{className:`text-sm underline`,href:`/docs/servicenow.html`,target:`_blank`,rel:`noreferrer`,children:`Open Skyforge ServiceNow docs`}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Create and wake your PDI in the ServiceNow portal; then paste the instance URL and admin creds below.`})]})]}),(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`PDI status`}),(0,L.jsx)(U,{children:`ServiceNow PDIs can sleep after inactivity. Skyforge can detect this and attempt to wake the instance.`})]}),(0,L.jsxs)(W,{className:`space-y-3`,children:[(0,L.jsx)(`div`,{className:`text-sm`,children:s?.configured?(0,L.jsxs)(L.Fragment,{children:[`Status:`,` `,(0,L.jsx)(`span`,{className:`font-medium`,children:D.data?.status??(D.isFetching?`checking…`:`unknown`)}),D.data?.httpStatus?` (HTTP ${D.data.httpStatus})`:``,D.data?.detail?` — ${D.data.detail}`:``]}):(0,L.jsx)(`span`,{className:`text-muted-foreground`,children:`Save configuration first.`})}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(R,{variant:`secondary`,onClick:()=>void D.refetch(),disabled:!s?.configured||D.isFetching||ee.isPending,children:`Check now`}),(0,L.jsx)(R,{variant:`secondary`,onClick:()=>ee.mutate(),disabled:!s?.configured||ee.isPending,children:`Wake up`})]})]})]}),(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Schema status`}),(0,L.jsx)(U,{children:`The demo requires two custom tables and fields. ServiceNow does not allow Skyforge to create these via Table API, so you create them once in the PDI and Skyforge installs everything else.`})]}),(0,L.jsxs)(W,{className:`space-y-3`,children:[(0,L.jsx)(`div`,{className:`text-sm`,children:s?.configured?(0,L.jsxs)(L.Fragment,{children:[`Status:`,` `,(0,L.jsx)(`span`,{className:`font-medium`,children:O.data?.status??(O.isFetching?`checking…`:`unknown`)}),O.data?.checkedAt?` (checked ${O.data.checkedAt})`:``,O.data?.detail?` — ${O.data.detail}`:``]}):(0,L.jsx)(`span`,{className:`text-muted-foreground`,children:`Save configuration first.`})}),O.data?.status===`missing`&&O.data.missing?.length?(0,L.jsxs)(`div`,{className:`rounded-md border p-3 bg-muted/30`,children:[(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground mb-2`,children:`Missing items:`}),(0,L.jsx)(`ul`,{className:`text-xs font-mono space-y-1`,children:O.data.missing.map(e=>(0,L.jsxs)(`li`,{children:[`- `,e]},e))})]}):null,(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(R,{variant:`secondary`,onClick:()=>void O.refetch(),disabled:!s?.configured||O.isFetching,children:`Check schema`}),(0,L.jsx)(`a`,{className:`text-sm underline text-muted-foreground`,href:`/docs/servicenow.html`,target:`_blank`,rel:`noreferrer`,children:`Docs`})]})]})]}),(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Configuration`}),(0,L.jsx)(U,{children:`Skyforge uses ServiceNow admin creds to install/configure. Forward creds are stored in ServiceNow as a Basic Auth credential for the demo REST Message.`})]}),(0,L.jsxs)(W,{className:`space-y-6`,children:[(0,L.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(q,{children:`ServiceNow instance URL`}),(0,L.jsx)(J,{value:l,onChange:e=>u(e.target.value),placeholder:`https://dev12345.service-now.com`})]}),(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(q,{children:`ServiceNow admin username`}),(0,L.jsx)(J,{value:d,onChange:e=>f(e.target.value),placeholder:`admin`})]}),(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(q,{children:`ServiceNow admin password`}),(0,L.jsx)(J,{type:`password`,value:p,onChange:e=>m(e.target.value),placeholder:s?.hasAdminPassword?`(leave blank to keep stored)`:``})]})]}),(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(q,{children:`Forward credentials`}),(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Uses Forward SaaS (`,(0,L.jsx)(`code`,{children:`https://fwd.app`}),`).`]}),(0,L.jsxs)(Y,{value:_===`custom`?`custom`:h||``,onValueChange:e=>{if(e===`custom`){v(`custom`),g(``);return}v(`collector`),g(e)},children:[(0,L.jsx)(Z,{className:`w-full`,children:(0,L.jsx)(X,{placeholder:`Select a collector`})}),(0,L.jsxs)(Q,{children:[E.map(e=>(0,L.jsxs)($,{value:e.id,children:[e.name,e.isDefault?` (default)`:``]},e.id)),(0,L.jsx)($,{value:`custom`,children:`Custom…`})]})]})]}),_===`custom`?(0,L.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(q,{children:`Forward username`}),(0,L.jsx)(J,{value:y,onChange:e=>b(e.target.value),placeholder:`you@example.com`})]}),(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(q,{children:`Forward password`}),(0,L.jsx)(J,{type:`password`,value:x,onChange:e=>S(e.target.value),placeholder:s?.hasForwardPassword?`(leave blank to keep stored)`:``})]})]}):null,(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(q,{children:`Forward integration`}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(Ao,{id:`snow-configure-ticketing-on-save`,checked:C,onCheckedChange:e=>w(!!e)}),(0,L.jsx)(q,{htmlFor:`snow-configure-ticketing-on-save`,className:`font-normal text-sm`,children:`Configure Forward ticketing integration on save`})]}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Configures Forward SaaS to auto-create and auto-update incidents in this ServiceNow instance.`})]}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(R,{onClick:()=>k.mutate(),disabled:k.isPending||te.isPending,children:`Save`}),(0,L.jsx)(R,{variant:`secondary`,onClick:()=>te.mutate(),disabled:te.isPending||k.isPending||!s?.configured||O.data?.status===`missing`,children:`Install demo app`}),(0,L.jsx)(R,{variant:`secondary`,onClick:()=>ne.mutate(),disabled:ne.isPending||k.isPending||!s?.configured,children:`Configure Forward (ticketing)`}),(0,L.jsx)(`a`,{className:`text-sm underline text-muted-foreground ml-2`,href:`/docs/servicenow.html`,target:`_blank`,rel:`noreferrer`,children:`Docs`}),s?.lastInstallStatus?(0,L.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Status: `,s.lastInstallStatus,s.lastInstallError?` (${s.lastInstallError})`:``]}):null]})]})]})]})}const $o=t(`/dashboard/s3`)({component:es});function es(){let e=i({queryKey:G.workspaces(),queryFn:Mr,staleTime:3e4}),t=e.data?.workspaces??[],[n,r]=(0,F.useState)(``),[a,o]=(0,F.useState)(``);(0,F.useEffect)(()=>{if(t.length===0)return;let e=window.localStorage.getItem(`skyforge.lastWorkspaceId.s3`)??``,n=t.some(t=>t.id===e)?e:t[0]?.id??``;r(e=>e||n)},[t]);let s=i({queryKey:G.workspaceArtifacts(n),queryFn:async()=>Fi(n,{prefix:a||void 0}),staleTime:1e4,enabled:!!n}),c=s.data?.items??[],l=(0,F.useMemo)(()=>[{id:`object`,header:`Object`,cell:e=>(0,L.jsx)(`span`,{className:`font-mono text-xs`,children:e.key})},{id:`actions`,header:`Actions`,width:300,align:`right`,cell:e=>(0,L.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[e.key.toLowerCase().endsWith(`.json`)&&(0,L.jsxs)(R,{variant:`outline`,size:`sm`,onClick:async()=>{try{let t=await Ii(n,e.key),r=atob(t.fileData),i=new Uint8Array(r.length);for(let e=0;e<r.length;e++)i[e]=r.charCodeAt(e);let a=new TextDecoder().decode(i),o=JSON.stringify(JSON.parse(a),null,2),s=new Blob([o],{type:`application/json`}),c=URL.createObjectURL(s);window.open(c,`_blank`,`noopener,noreferrer`),window.setTimeout(()=>URL.revokeObjectURL(c),1e4)}catch(e){P.error(`View failed`,{description:e.message})}},disabled:!n,children:[(0,L.jsx)(Sn,{className:`mr-2 h-3 w-3`}),`View`]}),(0,L.jsxs)(R,{variant:`outline`,size:`sm`,onClick:async()=>{try{let t=await Ii(n,e.key),r=atob(t.fileData),i=new Uint8Array(r.length);for(let e=0;e<r.length;e++)i[e]=r.charCodeAt(e);let a=new Blob([i]),o=URL.createObjectURL(a),s=document.createElement(`a`);s.href=o,s.download=e.key.split(`/`).pop()||`artifact`,document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(o)}catch(e){P.error(`Download failed`,{description:e.message})}},disabled:!n,children:[(0,L.jsx)(ee,{className:`mr-2 h-3 w-3`}),`Download`]}),(0,L.jsxs)(R,{variant:`destructive`,size:`sm`,onClick:async()=>{if(confirm(`Delete ${e.key}?`))try{await Ri(n,e.key),P.success(`Deleted`,{description:e.key}),await s.refetch()}catch(e){P.error(`Delete failed`,{description:e.message})}},disabled:!n,children:[(0,L.jsx)(Mn,{className:`mr-2 h-3 w-3`}),`Delete`]})]})}],[s.refetch,n]),u=(0,L.jsxs)(`div`,{className:`p-4 border-b flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,L.jsx)(`div`,{className:`text-sm font-medium`,children:`Workspace`}),(0,L.jsxs)(Y,{value:n,onValueChange:e=>{r(e),window.localStorage.setItem(`skyforge.lastWorkspaceId.s3`,e)},disabled:t.length===0,children:[(0,L.jsx)(Z,{className:`w-[280px]`,children:(0,L.jsx)(X,{placeholder:`Select workspace`})}),(0,L.jsx)(Q,{children:t.map(e=>(0,L.jsxs)($,{value:e.id,children:[e.name,` (`,e.slug,`)`]},e.id))})]})]}),(0,L.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center`,children:[(0,L.jsx)(J,{placeholder:`Prefix (e.g. topology/)`,value:a,onChange:e=>o(e.target.value),className:`w-[260px]`}),(0,L.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>s.refetch(),disabled:!n,children:`Refresh`}),(0,L.jsxs)(R,{variant:`outline`,size:`sm`,onClick:async()=>{if(!n)return;let e=window.prompt(`Folder prefix (e.g. uploads/)`);if(e)try{await zi(n,e),P.success(`Folder created`),await s.refetch()}catch(e){P.error(`Create folder failed`,{description:e.message})}},disabled:!n,children:[(0,L.jsx)(On,{className:`mr-2 h-3 w-3`}),`Folder`]}),(0,L.jsxs)(R,{variant:`outline`,size:`sm`,onClick:()=>{if(!n)return;let e=document.createElement(`input`);e.type=`file`,e.onchange=()=>{let t=e.files?.[0];t&&(async()=>{try{let e=new Uint8Array(await t.arrayBuffer()),r=``,i=32*1024;for(let t=0;t<e.length;t+=i){let n=e.subarray(t,t+i);r+=btoa(String.fromCharCode(...n))}let o=(a||``)+t.name;await Li(n,{key:o,contentBase64:r,contentType:t.type||`application/octet-stream`}),P.success(`Uploaded`,{description:o}),await s.refetch()}catch(e){P.error(`Upload failed`,{description:e.message})}})()},e.click()},disabled:!n,children:[(0,L.jsx)(pe,{className:`mr-2 h-3 w-3`}),`Upload`]})]})]});return(0,L.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,L.jsx)(B,{variant:`glass`,children:(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`S3`}),(0,L.jsx)(U,{children:`Workspace artifacts and generated files (backed by the platform object store).`})]})}),(0,L.jsx)(B,{children:(0,L.jsx)(W,{className:`p-0`,children:e.isLoading||s.isLoading?(0,L.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,L.jsx)(K,{className:`h-12 w-full`}),(0,L.jsx)(K,{className:`h-12 w-full`}),(0,L.jsx)(K,{className:`h-12 w-full`})]}):(0,L.jsxs)(`div`,{children:[u,e.isError||s.isError?(0,L.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to list objects.`}):c.length===0?(0,L.jsx)(`div`,{className:`p-6`,children:(0,L.jsx)(Za,{icon:Kt,title:`No objects found`,description:`No artifacts found for this workspace.`})}):(0,L.jsx)(Xa,{columns:l,rows:c,getRowId:e=>e.key,maxHeightClassName:`max-h-[60vh]`,minWidthClassName:`min-w-[900px]`})]})})})]})}const ts=t(`/dashboard/forward`)({component:rs});function ns(e,t){if(e===`cloud`)return`https://fwd.app`;let n=t.trim();return n?/^https?:\/\//i.test(n)?n:`https://${n}`:``}function rs(){let e=c(),t=G.userForwardCollectorConfigs(),n=i({queryKey:t,queryFn:ki,refetchInterval:5e3,staleTime:1e4,retry:!1}),a=(0,F.useMemo)(()=>n.data?.collectors??[],[n.data?.collectors]),[o,s]=(0,F.useState)(``),l=i({queryKey:G.userForwardCollectorConfigLogs(o),queryFn:async()=>Mi(o,300),enabled:!!o,refetchInterval:o?3e3:!1,retry:!1}),[u,d]=(0,F.useState)(`cloud`),[f,p]=(0,F.useState)(``),[m,h]=(0,F.useState)(!0),[g,_]=(0,F.useState)(``),[v,y]=(0,F.useState)(!1),[b,x]=(0,F.useState)(``),[S,C]=(0,F.useState)(``),[w,T]=(0,F.useState)(!0),E=i({queryKey:G.userGitCredentials(),queryFn:Zr,staleTime:6e4,retry:!1});(0,F.useEffect)(()=>{h(u!==`cloud`)},[u]),(0,F.useEffect)(()=>{if(v||g.trim())return;let e=(E.data?.username??``).trim();e&&_(`skyforge-${e}`)},[v,g,E.data?.username]);let D=r({mutationFn:async()=>{let e=g.trim();if(!e)throw Error(`Collector name is required`);let t=ns(u,f);if(!t)throw Error(`Forward URL is required`);if(!b.trim()||!S.trim())throw Error(`Forward username/password are required`);return Ai({name:e,baseUrl:t,skipTlsVerify:u===`onprem`?m:!1,username:b.trim(),password:S,setDefault:w})},onSuccess:async()=>{P.success(`Collector created`),C(``),await e.invalidateQueries({queryKey:t})},onError:e=>P.error(`Failed to create collector`,{description:e.message})}),O=r({mutationFn:async e=>Ni(e),onSuccess:async()=>{P.success(`Collector restarted`),await e.invalidateQueries({queryKey:t})},onError:e=>P.error(`Failed to restart collector`,{description:e.message})}),ee=r({mutationFn:async e=>ji(e),onSuccess:async(n,r)=>{P.success(`Collector deleted`),s(``),e.setQueryData(t,e=>{let t=e?.collectors??[];return{...e??{},collectors:t.filter(e=>String(e?.id??``)!==String(r))}}),await e.invalidateQueries({queryKey:t})},onError:e=>P.error(`Failed to delete collector`,{description:e.message})}),k=r({mutationFn:async e=>{for(let t of e)await ji(t)},onSuccess:async()=>{P.success(`Collectors deleted`),s(``),e.setQueryData(t,e=>({...e??{},collectors:[]})),await e.invalidateQueries({queryKey:t})},onError:e=>P.error(`Failed to delete collectors`,{description:e.message})});return(0,L.jsxs)(`div`,{className:`p-6 space-y-6`,children:[(0,L.jsx)(`div`,{className:`flex items-start justify-between gap-4`,children:(0,L.jsxs)(`div`,{children:[(0,L.jsx)(`h1`,{className:`text-2xl font-bold`,children:`Collector`}),(0,L.jsx)(`p`,{className:`text-sm text-muted-foreground mt-1`,children:`Create one or more per-user in-cluster Forward collectors. Select a collector per deployment.`})]})}),(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Create collector`}),(0,L.jsx)(U,{children:`Creates a Forward collector and deploys a matching in-cluster Deployment. Deleting here only deletes the in-cluster Deployment and the saved credentials; it does not delete the Forward-side collector.`})]}),(0,L.jsxs)(W,{className:`space-y-4`,children:[(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(q,{children:`Collector name`}),(0,L.jsx)(J,{value:g,onChange:e=>{y(!0),_(e.target.value)},placeholder:`skyforge-yourname`})]}),(0,L.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(q,{children:`Forward target`}),(0,L.jsxs)(Y,{value:u,onValueChange:e=>d(e),children:[(0,L.jsx)(Z,{children:(0,L.jsx)(X,{})}),(0,L.jsxs)(Q,{children:[(0,L.jsx)($,{value:`cloud`,children:`fwd.app (cloud)`}),(0,L.jsx)($,{value:`onprem`,children:`on-prem`})]})]})]}),u===`onprem`?(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(q,{children:`On-prem host`}),(0,L.jsx)(J,{value:f,onChange:e=>p(e.target.value),placeholder:`forward.example.com (:port)`})]}):null]}),u===`onprem`?(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(Ao,{checked:m,onCheckedChange:e=>h(!!e)}),(0,L.jsx)(q,{className:`text-sm`,children:`Skip TLS verification`})]}):null,(0,L.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(q,{children:`Forward username`}),(0,L.jsx)(J,{value:b,onChange:e=>x(e.target.value),placeholder:`you@company.com`})]}),(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(q,{children:`Forward password`}),(0,L.jsx)(J,{type:`password`,value:S,onChange:e=>C(e.target.value),placeholder:`••••••••`})]})]}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(Ao,{checked:w,onCheckedChange:e=>T(!!e)}),(0,L.jsx)(q,{className:`text-sm`,children:`Make default`})]}),(0,L.jsx)(R,{onClick:()=>D.mutate(),disabled:D.isPending,children:D.isPending?`Creating…`:`Create`})]})]}),(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-4`,children:[(0,L.jsx)(H,{children:`Configured collectors`}),a.length>0?(0,L.jsx)(R,{variant:`destructive`,size:`sm`,disabled:k.isPending,onClick:()=>{let e=a.map(e=>String(e.id)).filter(Boolean);e.length!==0&&confirm(`Delete ${e.length} collector(s)? This removes in-cluster Deployments and saved credentials.`)&&k.mutate(e)},children:k.isPending?`Deleting…`:`Delete all`}):null]}),(0,L.jsx)(U,{children:`Each entry maps to one in-cluster Deployment and one Forward collector.`})]}),(0,L.jsxs)(W,{className:`space-y-3`,children:[n.isLoading?(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading…`}):null,n.isError?(0,L.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load collectors.`}):a.length===0?(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No collectors configured yet.`}):null,a.map(e=>{let t=!!e.runtime?.ready,n=typeof e.forwardCollector?.connected==`boolean`?e.forwardCollector.connected:void 0;return(0,L.jsxs)(`div`,{className:`rounded-md border p-3 space-y-2`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,L.jsxs)(`div`,{className:`min-w-0`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-2 min-w-0`,children:[(0,L.jsx)(`div`,{className:`font-medium truncate`,children:e.name}),e.isDefault?(0,L.jsx)(ao,{variant:`secondary`,children:`default`}):null,e.decryptionFailed?(0,L.jsx)(ao,{variant:`destructive`,children:`re-save creds`}):null]}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:e.id})]}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>s(t=>t===e.id?``:e.id),children:o===e.id?`Hide logs`:`Logs`}),(0,L.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>O.mutate(e.id),disabled:O.isPending,children:`Restart`}),(0,L.jsx)(R,{variant:`destructive`,size:`sm`,onClick:()=>{confirm(`Delete collector "${e.name}"?`)&&ee.mutate(e.id)},disabled:ee.isPending,children:`Delete`})]})]}),(0,L.jsxs)(`div`,{className:`text-sm`,children:[`Status:`,` `,(0,L.jsx)(`span`,{className:t?`text-emerald-600`:`text-muted-foreground`,children:t?`Running`:`Starting…`})]}),(0,L.jsxs)(`div`,{className:`text-sm`,children:[`Forward:`,` `,typeof n==`boolean`?(0,L.jsx)(`span`,{className:n?`text-emerald-600`:`text-muted-foreground`,children:n?`Connected`:`Not connected`}):(0,L.jsx)(`span`,{className:`text-muted-foreground`,children:`Unknown`})]}),e.forwardCollector?.version?(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Version:`,` `,(0,L.jsx)(`span`,{className:`font-mono`,children:String(e.forwardCollector.version)})]}):null,e.forwardCollector?.updateStatus?(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Update:`,` `,(0,L.jsx)(`span`,{className:`font-mono`,children:String(e.forwardCollector.updateStatus)})]}):null,e.forwardCollector?.externalIp?(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`External IP:`,` `,(0,L.jsx)(`span`,{className:`font-mono`,children:String(e.forwardCollector.externalIp)})]}):null,Array.isArray(e.forwardCollector?.internalIps)&&(e.forwardCollector?.internalIps??[]).length>0?(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Internal IPs:`,` `,(0,L.jsx)(`span`,{className:`font-mono`,children:(e.forwardCollector?.internalIps??[]).filter(Boolean).join(`, `)})]}):null,e.runtime?.podName?(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Pod:`,` `,(0,L.jsx)(`span`,{className:`font-mono`,children:String(e.runtime.podName)}),` `,`(`,String(e.runtime.podPhase??``),`)`]}):null,o===e.id?(0,L.jsx)(`pre`,{className:`bg-muted p-3 rounded-md overflow-auto font-mono text-xs whitespace-pre-wrap`,children:l.isLoading?`Loading…`:(l.data?.logs??``).trim()||`No logs yet.`}):null]},e.id)})]})]})]})}const is=t(`/admin/settings`)({component:as});function as(){let e=i({queryKey:G.session(),queryFn:Ar,staleTime:3e4,retry:!1}),t=!!e.data?.isAdmin,[n,a]=(0,F.useState)(`200`),o=i({queryKey:G.adminAudit(n),queryFn:()=>Yi({limit:n}),enabled:t,staleTime:15e3,retry:!1}),s=i({queryKey:G.adminConfig(),queryFn:Ji,enabled:t,staleTime:15e3,retry:!1}),c=i({queryKey:G.adminImpersonateStatus(),queryFn:Xi,enabled:t,staleTime:5e3,retry:!1}),l=r({mutationFn:async e=>$i({limit:e}),onSuccess:e=>{P.success(`Reconciled queued tasks`,{description:`Considered ${e.consideredTasks}, republished ${e.republished}, errors ${e.publishErrors}`})},onError:e=>{P.error(`Failed to reconcile queued tasks`,{description:e.message})}}),u=r({mutationFn:async e=>ea({limit:e.limit,hardMaxRuntimeMinutes:e.hardMaxRuntimeMinutes,maxIdleMinutes:e.maxIdleMinutes}),onSuccess:e=>{P.success(`Reconciled running tasks`,{description:`Considered ${e.consideredTasks}, marked failed ${e.markedFailed}, errors ${e.finishErrors}`})},onError:e=>{P.error(`Failed to reconcile running tasks`,{description:e.message})}}),[d,f]=(0,F.useState)(``),p=r({mutationFn:async()=>Zi({username:d}),onSuccess:()=>{P.success(`Impersonation started`),c.refetch(),window.location.reload()},onError:e=>{P.error(`Failed to impersonate`,{description:e.message})}}),m=r({mutationFn:async()=>Qi(),onSuccess:()=>{P.success(`Impersonation stopped`),c.refetch(),window.location.reload()},onError:e=>{P.error(`Failed to stop impersonation`,{description:e.message})}}),[h,g]=(0,F.useState)(``),_=r({mutationFn:async()=>ta({username:h,confirm:h}),onSuccess:e=>{P.success(`User purged`,{description:`Deleted workspaces: ${e.deletedWorkspaces}`})},onError:e=>{P.error(`Failed to purge user`,{description:e.message})}}),v=(0,F.useMemo)(()=>[{id:`createdAt`,header:`Time`,cell:e=>(0,L.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:e.createdAt}),width:220},{id:`actor`,header:`Actor`,cell:e=>(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(`span`,{className:`font-medium`,children:e.actorUsername}),e.actorIsAdmin?(0,L.jsx)(ao,{variant:`secondary`,children:`admin`}):null,e.impersonatedUsername?(0,L.jsxs)(ao,{variant:`outline`,children:[`as `,e.impersonatedUsername]}):null]}),width:260},{id:`action`,header:`Action`,cell:e=>e.action,width:260},{id:`workspaceId`,header:`Workspace`,cell:e=>(0,L.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:e.workspaceId}),width:220},{id:`details`,header:`Details`,cell:e=>(0,L.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.details})}],[]);return(0,L.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,L.jsx)(B,{variant:`glass`,children:(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`System settings`}),(0,L.jsx)(U,{children:`Admin-only settings for Skyforge.`})]})}),!t&&(0,L.jsx)(B,{variant:`danger`,children:(0,L.jsx)(W,{className:`pt-6`,children:(0,L.jsx)(`div`,{className:`text-center font-medium`,children:`Admin access required.`})})}),t&&(0,L.jsxs)(zo,{defaultValue:`overview`,children:[(0,L.jsxs)(Bo,{children:[(0,L.jsx)(Vo,{value:`overview`,children:`Overview`}),(0,L.jsx)(Vo,{value:`audit`,children:`Audit`}),(0,L.jsx)(Vo,{value:`tasks`,children:`Tasks`}),(0,L.jsx)(Vo,{value:`users`,children:`Users`})]}),(0,L.jsxs)(Ho,{value:`overview`,className:`space-y-6`,children:[(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Effective config`}),(0,L.jsx)(U,{children:`Read-only view of the running server's non-secret Encore config.`})]}),(0,L.jsx)(W,{children:s.isLoading?(0,L.jsx)(K,{className:`h-40 w-full`}):s.data?(0,L.jsxs)(`div`,{className:`space-y-3`,children:[s.data.missing?.length?(0,L.jsxs)(`div`,{className:`rounded-md border border-destructive/40 bg-destructive/10 p-3 text-sm`,children:[(0,L.jsx)(`div`,{className:`font-medium`,children:`Missing config`}),(0,L.jsx)(`ul`,{className:`list-disc pl-5 text-muted-foreground`,children:s.data.missing.map(e=>(0,L.jsx)(`li`,{children:e},e))})]}):null,(0,L.jsx)(`pre`,{className:`max-h-[420px] overflow-auto rounded-md border bg-muted/50 p-3 text-xs`,children:JSON.stringify(s.data,null,2)})]}):(0,L.jsx)(Za,{title:`No config`,description:`Could not load effective config.`})})]}),(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Impersonation`}),(0,L.jsx)(U,{children:`Impersonate another user to reproduce issues or verify UX.`})]}),(0,L.jsxs)(W,{className:`space-y-4`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,L.jsx)(qe,{className:`h-5 w-5 text-muted-foreground`}),(0,L.jsxs)(`div`,{className:`text-sm`,children:[(0,L.jsx)(`span`,{className:`font-medium`,children:c.data?.actorUsername||e.data?.username||`—`}),c.data?.impersonating?(0,L.jsxs)(L.Fragment,{children:[` `,`→`,` `,(0,L.jsx)(`span`,{className:`font-medium`,children:c.data.effectiveUsername}),(0,L.jsx)(ao,{className:`ml-2`,variant:`secondary`,children:`impersonating`})]}):(0,L.jsx)(ao,{className:`ml-2`,variant:`outline`,children:`not impersonating`})]})]}),(0,L.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center`,children:[(0,L.jsx)(J,{placeholder:`user@example.com`,value:d,onChange:e=>f(e.target.value)}),(0,L.jsxs)(R,{onClick:()=>p.mutate(),disabled:p.isPending||!d.trim()||c.data?.impersonating,children:[(0,L.jsx)(oe,{className:`mr-2 h-4 w-4`}),`Impersonate`]}),(0,L.jsx)(R,{variant:`outline`,onClick:()=>m.mutate(),disabled:m.isPending||!c.data?.impersonating,children:`Stop`})]})]})]})]}),(0,L.jsx)(Ho,{value:`audit`,className:`space-y-6`,children:(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Audit log`}),(0,L.jsx)(U,{children:`Recent admin and user actions.`})]}),(0,L.jsxs)(W,{className:`space-y-4`,children:[(0,L.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`Limit`}),(0,L.jsx)(J,{className:`w-28`,value:n,onChange:e=>a(e.target.value)})]}),(0,L.jsx)(ao,{variant:`outline`,children:o.data?.timestamp??`—`})]}),(0,L.jsx)(Xa,{rows:o.data?.events??[],columns:v,getRowId:e=>String(e.id),isLoading:o.isLoading,emptyText:`No audit events.`,minWidthClassName:`min-w-[1100px]`})]})]})}),(0,L.jsx)(Ho,{value:`tasks`,className:`space-y-6`,children:(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Task reconciliation`}),(0,L.jsx)(U,{children:`Manual guardrails for stuck queued/running jobs.`})]}),(0,L.jsxs)(W,{className:`space-y-6`,children:[(0,L.jsxs)(`div`,{className:`flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[(0,L.jsxs)(`div`,{children:[(0,L.jsx)(`div`,{className:`font-medium`,children:`Queued tasks`}),(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Republish missing queue events.`})]}),(0,L.jsx)(R,{variant:`outline`,disabled:l.isPending,onClick:()=>l.mutate(200),children:l.isPending?`Running…`:`Reconcile queued`})]}),(0,L.jsxs)(`div`,{className:`flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[(0,L.jsxs)(`div`,{children:[(0,L.jsx)(`div`,{className:`font-medium`,children:`Running tasks`}),(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Mark long-running/no-log tasks failed.`})]}),(0,L.jsx)(R,{variant:`outline`,disabled:u.isPending,onClick:()=>u.mutate({limit:50,hardMaxRuntimeMinutes:720,maxIdleMinutes:120}),children:u.isPending?`Running…`:`Reconcile running`})]})]})]})}),(0,L.jsx)(Ho,{value:`users`,className:`space-y-6`,children:(0,L.jsxs)(B,{variant:`danger`,children:[(0,L.jsxs)(V,{children:[(0,L.jsxs)(H,{className:`flex items-center gap-2`,children:[(0,L.jsx)(Oe,{className:`h-5 w-5`}),`Purge user (dev-only)`]}),(0,L.jsx)(U,{children:`Removes user state and associated workspaces to rerun first-login bootstrap.`})]}),(0,L.jsxs)(W,{className:`space-y-3`,children:[(0,L.jsx)(J,{placeholder:`user@example.com`,value:h,onChange:e=>g(e.target.value)}),(0,L.jsx)(R,{variant:`destructive`,disabled:!h.trim()||_.isPending,onClick:()=>_.mutate(),children:_.isPending?`Purging…`:`Purge user`})]})]})})]})]})}var os=Ln({q:zn().optional().catch(``),tab:Un([`policy`,`resources`,`costs`,`usage`]).optional().catch(`policy`)});const ss=t(`/admin/governance`)({validateSearch:e=>os.parse(e),loaderDeps:({search:{q:e,tab:t}})=>({q:e,tab:t}),loader:async({context:{queryClient:e}})=>{(await e.ensureQueryData({queryKey:G.session(),queryFn:Ar,staleTime:3e4,retry:!1}))?.isAdmin&&await Promise.all([e.ensureQueryData({queryKey:G.governancePolicy(),queryFn:na}),e.ensureQueryData({queryKey:G.governanceSummary(),queryFn:Ui}),e.ensureQueryData({queryKey:G.governanceResources(`500`),queryFn:()=>Wi({limit:`500`})}),e.ensureQueryData({queryKey:G.governanceCosts(`50`),queryFn:()=>Gi({limit:`50`})}),e.ensureQueryData({queryKey:G.governanceUsage(`500`),queryFn:()=>Ki({limit:`500`})})])},component:cs});function cs(){let e=c(),t=ss.useNavigate(),{q:n,tab:a}=ss.useSearch(),o=!!i({queryKey:G.session(),queryFn:Ar,staleTime:3e4,retry:!1}).data?.isAdmin,s=i({queryKey:G.governanceSummary(),queryFn:Ui,staleTime:3e4,enabled:o}),l=i({queryKey:G.governancePolicy(),queryFn:na,staleTime:3e4,enabled:o,retry:!1}),u=i({queryKey:G.governanceResources(`500`),queryFn:()=>Wi({limit:`500`}),staleTime:3e4,enabled:o}),d=i({queryKey:G.governanceCosts(`50`),queryFn:()=>Gi({limit:`50`}),staleTime:3e4,enabled:o}),f=i({queryKey:G.governanceUsage(`500`),queryFn:()=>Ki({limit:`500`}),staleTime:3e4,enabled:o}),p=f.data?.usage??[],m=(0,F.useMemo)(()=>{let e=new Map;for(let t of p){if(t.scopeType!==`cluster`)continue;let n=String(t.metric??``);if(!n)continue;let r=e.get(n);if(!r){e.set(n,t);continue}new Date(String(t.collectedAt)).getTime()>new Date(String(r.collectedAt)).getTime()&&e.set(n,t)}return e},[p]),h=(0,F.useMemo)(()=>{let e=new Map;for(let t of p){if(t.scopeType!==`user`)continue;let n=String(t.scopeId??``).trim();if(!n)continue;let r=String(t.metric??``).trim();if(!r)continue;let i=Number(t.value??0),a=String(t.collectedAt??``),o=e.get(n)??{user:n,deploymentsActive:0,deploymentsTotal:0,collectorsTotal:0,tasksRunning:0,lastSeenAt:a};switch(r){case`deployments.active`:o.deploymentsActive=i;break;case`deployments.total`:o.deploymentsTotal=i;break;case`collectors.total`:o.collectorsTotal=i;break;case`tasks.running`:o.tasksRunning=i;break;default:break}new Date(a).getTime()>new Date(o.lastSeenAt).getTime()&&(o.lastSeenAt=a),e.set(n,o)}return Array.from(e.values()).sort((e,t)=>t.deploymentsActive===e.deploymentsActive?t.tasksRunning===e.tasksRunning?e.user.localeCompare(t.user):t.tasksRunning-e.tasksRunning:t.deploymentsActive-e.deploymentsActive)},[p]),g=(0,F.useMemo)(()=>{let e=u.data?.resources??[],t=n?.trim().toLowerCase()||``;return t?e.filter(e=>[e.name,e.resourceId,e.resourceType,e.workspaceName,e.owner,e.provider].filter(Boolean).join(` `).toLowerCase().includes(t)):e},[u.data?.resources,n]),_=r({mutationFn:async()=>{await qi()},onSuccess:async()=>{P.success(`Governance sources synced`,{description:`Resource inventory updated.`}),await Promise.all([e.invalidateQueries({queryKey:G.governanceSummary()}),e.invalidateQueries({queryKey:G.governanceResources(`500`)}),e.invalidateQueries({queryKey:G.governanceCosts(`50`)}),e.invalidateQueries({queryKey:G.governanceUsage(`500`)})])},onError:e=>{P.error(`Failed to sync governance sources`,{description:e.message})}}),[v,y]=(0,F.useState)({maxDeploymentsPerUser:0,maxCollectorsPerUser:0});(0,F.useEffect)(()=>{l.data?.policy&&y({maxDeploymentsPerUser:l.data.policy.maxDeploymentsPerUser??0,maxCollectorsPerUser:l.data.policy.maxCollectorsPerUser??0})},[l.data?.policy?.maxDeploymentsPerUser,l.data?.policy?.maxCollectorsPerUser]);let x=r({mutationFn:async()=>ra({policy:{maxDeploymentsPerUser:Math.max(0,v.maxDeploymentsPerUser),maxCollectorsPerUser:Math.max(0,v.maxCollectorsPerUser)}}),onSuccess:async()=>{P.success(`Governance policy saved`),await e.invalidateQueries({queryKey:G.governancePolicy()})},onError:e=>{P.error(`Failed to save governance policy`,{description:e.message})}}),S=s.data,C=e=>{t({search:t=>({...t,q:e}),replace:!0})};return(0,L.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,L.jsx)(B,{variant:`glass`,children:(0,L.jsx)(V,{children:(0,L.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,L.jsxs)(`div`,{children:[(0,L.jsx)(H,{children:`Governance`}),(0,L.jsx)(U,{children:`Admin-only guardrails, inventory, cost, and usage telemetry.`})]}),(0,L.jsxs)(R,{variant:`outline`,size:`sm`,disabled:_.isPending||!o,onClick:()=>_.mutate(),children:[(0,L.jsx)(ot,{className:`mr-2 h-4 w-4 ${_.isPending?`animate-spin`:``}`}),_.isPending?`Syncing…`:`Sync sources`]})]})})}),!o&&(0,L.jsx)(B,{variant:`danger`,children:(0,L.jsx)(W,{className:`pt-6`,children:(0,L.jsx)(`div`,{className:`text-center font-medium text-destructive`,children:`Admin access required.`})})}),(l.isError||s.isError||u.isError||d.isError||f.isError)&&(0,L.jsx)(B,{variant:`danger`,children:(0,L.jsx)(W,{className:`pt-6`,children:(0,L.jsx)(`div`,{className:`text-center font-medium`,children:`Failed to load governance data.`})})}),s.isLoading?(0,L.jsx)(so,{children:[1,2,3,4].map(e=>(0,L.jsxs)(co,{className:`h-32`,children:[(0,L.jsx)(K,{className:`h-4 w-24 mb-4`}),(0,L.jsx)(K,{className:`h-8 w-16`})]},e))}):(0,L.jsxs)(so,{children:[(0,L.jsx)(lo,{title:`Resources tracked`,value:String(S?.resourceCount??`—`),icon:(0,L.jsx)(Bt,{className:`h-5 w-5`}),gradient:`blue`}),(0,L.jsx)(lo,{title:`Active resources`,value:String(S?.activeResources??`—`),icon:(0,L.jsx)(he,{className:`h-5 w-5`}),gradient:`green`}),(0,L.jsx)(lo,{title:`Workspaces tracked`,value:String(S?.workspacesTracked??`—`),icon:(0,L.jsx)(bt,{className:`h-5 w-5`}),gradient:`purple`}),(0,L.jsx)(lo,{title:`Last 30d spend`,value:S?`${S.costLast30Days} ${S.costCurrency}`:`—`,icon:(0,L.jsx)(Ae,{className:`h-5 w-5`}),gradient:`orange`})]}),(0,L.jsxs)(zo,{value:a,onValueChange:e=>{t({search:t=>({...t,tab:e}),replace:!0})},className:`space-y-6`,children:[(0,L.jsxs)(Bo,{children:[(0,L.jsxs)(Vo,{value:`policy`,className:`gap-2`,children:[(0,L.jsx)(Kt,{className:`h-4 w-4`}),`Policy`]}),(0,L.jsxs)(Vo,{value:`resources`,className:`gap-2`,children:[(0,L.jsx)(Bt,{className:`h-4 w-4`}),`Resources`]}),(0,L.jsxs)(Vo,{value:`costs`,className:`gap-2`,children:[(0,L.jsx)(b,{className:`h-4 w-4`}),`Financials`]}),(0,L.jsxs)(Vo,{value:`usage`,className:`gap-2`,children:[(0,L.jsx)(le,{className:`h-4 w-4`}),`Telemetry`]})]}),(0,L.jsx)(Ho,{value:`policy`,className:`space-y-6 animate-in fade-in-50`,children:(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Policy`}),(0,L.jsx)(U,{children:`Optional guardrails. Use 0 for unlimited.`})]}),(0,L.jsxs)(W,{className:`space-y-4`,children:[(0,L.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(`div`,{className:`text-sm font-medium`,children:`Max deployments per user`}),(0,L.jsx)(J,{inputMode:`numeric`,value:String(v.maxDeploymentsPerUser),onChange:e=>y(t=>({...t,maxDeploymentsPerUser:Number.parseInt(e.target.value||`0`,10)||0}))}),(0,L.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Applies when creating new deployment definitions.`})]}),(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(`div`,{className:`text-sm font-medium`,children:`Max collectors per user`}),(0,L.jsx)(J,{inputMode:`numeric`,value:String(v.maxCollectorsPerUser),onChange:e=>y(t=>({...t,maxCollectorsPerUser:Number.parseInt(e.target.value||`0`,10)||0}))}),(0,L.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Applies when creating in-cluster Forward collectors.`})]})]}),(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:l.data?.retrievedAt?`Loaded ${l.data.retrievedAt}`:``}),(0,L.jsx)(R,{onClick:()=>x.mutate(),disabled:x.isPending||!o,children:x.isPending?`Saving…`:`Save policy`})]})]})]})}),(0,L.jsx)(Ho,{value:`resources`,className:`space-y-6 animate-in fade-in-50`,children:(0,L.jsxs)(B,{children:[(0,L.jsx)(V,{children:(0,L.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,L.jsx)(H,{children:`Resource Inventory`}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsxs)(`div`,{className:`relative`,children:[(0,L.jsx)(an,{className:`absolute left-2 top-2.5 h-4 w-4 text-muted-foreground`}),(0,L.jsx)(J,{className:`pl-8 w-full sm:w-[300px]`,placeholder:`Search resources…`,value:n||``,onChange:e=>C(e.target.value)})]}),!u.isLoading&&(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground whitespace-nowrap hidden sm:block`,children:[g.length,` shown`]})]})]})}),(0,L.jsx)(W,{children:u.isLoading?(0,L.jsxs)(`div`,{className:`space-y-4`,children:[(0,L.jsx)(K,{className:`h-10 w-full`}),(0,L.jsx)(K,{className:`h-10 w-full`}),(0,L.jsx)(K,{className:`h-10 w-full`})]}):g.length===0?(0,L.jsx)(Za,{icon:Kt,title:`No resources found`,description:`No resources match your search criteria.`}):(0,L.jsx)(Xa,{columns:[{id:`name`,header:`Name`,width:`minmax(220px, 1fr)`,cell:e=>(0,L.jsx)(`span`,{className:`font-medium`,children:e.name})},{id:`provider`,header:`Provider`,width:140,cell:e=>e.provider},{id:`type`,header:`Type`,width:160,cell:e=>e.resourceType},{id:`workspace`,header:`Workspace`,width:200,cell:e=>e.workspaceName},{id:`owner`,header:`Owner`,width:160,cell:e=>e.owner},{id:`status`,header:`Status`,width:120,cell:e=>(0,L.jsx)(ao,{variant:e.status===`active`?`default`:`secondary`,children:e.status??`unknown`})}],rows:g.slice(0,500),getRowId:e=>String(e.resourceId),maxHeightClassName:`max-h-[60vh]`,minWidthClassName:`min-w-[1100px]`})})]})}),(0,L.jsx)(Ho,{value:`costs`,className:`space-y-6 animate-in fade-in-50`,children:(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Cost Snapshots`}),(0,L.jsx)(U,{children:`Historical spend data per provider.`})]}),(0,L.jsx)(W,{children:d.isLoading?(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(K,{className:`h-12 w-full`}),(0,L.jsx)(K,{className:`h-12 w-full`})]}):(d.data?.costs??[]).length===0?(0,L.jsx)(Za,{icon:b,title:`No cost data`,description:`No financial snapshots available.`}):(0,L.jsx)(Xa,{columns:[{id:`provider`,header:`Provider`,width:180,cell:e=>(0,L.jsx)(`span`,{className:`font-medium`,children:e.provider})},{id:`currency`,header:`Currency`,width:120,cell:e=>e.currency},{id:`amount`,header:`Amount`,width:140,cell:e=>e.amount},{id:`periodEnd`,header:`Period End`,width:200,align:`right`,cell:e=>(0,L.jsx)(`span`,{className:`text-muted-foreground`,children:e.periodEnd})}],rows:(d.data?.costs??[]).slice(0,50),getRowId:e=>`${e.provider}:${e.periodEnd}:${e.amount}`,maxHeightClassName:`max-h-[50vh]`,minWidthClassName:`min-w-[900px]`})})]})}),(0,L.jsx)(Ho,{value:`usage`,className:`space-y-6 animate-in fade-in-50`,children:(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Usage Telemetry`}),(0,L.jsx)(U,{children:`Lightweight snapshots of cluster load and user activity (no Prometheus).`})]}),(0,L.jsx)(W,{children:f.isLoading?(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(K,{className:`h-12 w-full`}),(0,L.jsx)(K,{className:`h-12 w-full`})]}):(f.data?.usage??[]).length===0?(0,L.jsx)(Za,{icon:le,title:`No usage data`,description:`No telemetry snapshots available.`}):(0,L.jsxs)(`div`,{className:`space-y-6`,children:[(0,L.jsxs)(so,{children:[(0,L.jsx)(lo,{title:`CPU p95`,value:m.get(`node.cpu_active.p95`)?.value??`—`,subtitle:`Last snapshot`,icon:(0,L.jsx)(he,{className:`h-4 w-4`})}),(0,L.jsx)(lo,{title:`Mem p95`,value:m.get(`node.mem_used.p95`)?.value??`—`,subtitle:`Last snapshot`,icon:(0,L.jsx)(bt,{className:`h-4 w-4`})}),(0,L.jsx)(lo,{title:`Disk p95`,value:m.get(`node.disk_used.p95`)?.value??`—`,subtitle:`Last snapshot`,icon:(0,L.jsx)(Bt,{className:`h-4 w-4`})}),(0,L.jsx)(lo,{title:`Active users (24h)`,value:m.get(`users.active_24h`)?.value??`—`,subtitle:`Distinct users`,icon:(0,L.jsx)(Kt,{className:`h-4 w-4`})})]}),(0,L.jsxs)(B,{variant:`glass`,children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{className:`text-base`,children:`Top Users`}),(0,L.jsx)(U,{children:`Latest per-user activity snapshots (sorted by active deployments).`})]}),(0,L.jsx)(W,{children:h.length===0?(0,L.jsx)(Za,{icon:le,title:`No user activity`,description:`No per-user snapshots available yet.`}):(0,L.jsx)(Xa,{columns:[{id:`user`,header:`User`,width:240,cell:e=>(0,L.jsx)(`span`,{className:`font-medium`,children:e.user})},{id:`deploymentsActive`,header:`Active Deployments`,width:180,cell:e=>e.deploymentsActive},{id:`tasksRunning`,header:`Running Tasks`,width:160,cell:e=>e.tasksRunning},{id:`collectorsTotal`,header:`Collectors`,width:140,cell:e=>e.collectorsTotal},{id:`deploymentsTotal`,header:`Total Deployments`,width:170,cell:e=>e.deploymentsTotal},{id:`lastSeenAt`,header:`Last Updated`,align:`right`,width:220,cell:e=>(0,L.jsx)(`span`,{className:`text-muted-foreground`,children:e.lastSeenAt})}],rows:h.slice(0,50),getRowId:e=>e.user,maxHeightClassName:`max-h-[45vh]`,minWidthClassName:`min-w-[1000px]`})})]}),(0,L.jsxs)(B,{variant:`glass`,children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{className:`text-base`,children:`Raw Snapshots`}),(0,L.jsx)(U,{children:`Most recent usage snapshot records (for debugging).`})]}),(0,L.jsx)(W,{children:(0,L.jsx)(Xa,{columns:[{id:`scope`,header:`Scope`,width:180,cell:e=>e.scopeType===`user`?`user:${e.scopeId??``}`:e.scopeType},{id:`metric`,header:`Metric`,cell:e=>e.metric},{id:`value`,header:`Value`,width:160,cell:e=>typeof e.value==`number`?e.value:String(e.value)},{id:`collectedAt`,header:`Collected At`,width:220,align:`right`,cell:e=>(0,L.jsx)(`span`,{className:`text-muted-foreground`,children:e.collectedAt})}],rows:(f.data?.usage??[]).slice(0,200),getRowId:e=>`${e.provider}:${e.scopeType}:${e.scopeId??``}:${e.metric}:${e.collectedAt}`,maxHeightClassName:`max-h-[50vh]`,minWidthClassName:`min-w-[900px]`})})]})]})})]})})]})]})}const ls=t(`/dashboard/workspaces/`)({beforeLoad:()=>{throw h({to:`/dashboard/deployments`})}});function us(e){let t=c(),n=(0,F.useMemo)(()=>`${Dr}/dashboard/events`,[]);(0,F.useEffect)(()=>{if(!e)return;let r=Ua(n,{snapshot:e=>{try{let n=JSON.parse(e.data);t.setQueryData(G.dashboardSnapshot(),n)}catch{}}});return()=>{r.close()}},[e,t,n])}function ds(e,t){if(!t)return`none`;let n=String(e?.username??``).trim();return e?.isAdmin?`admin`:n?String(t.createdBy??``).toLowerCase()===n.toLowerCase()||(t.owners??[]).some(e=>String(e).toLowerCase()===n.toLowerCase())?`owner`:(t.editors??[]).some(e=>String(e).toLowerCase()===n.toLowerCase())?`editor`:(t.viewers??[]).some(e=>String(e).toLowerCase()===n.toLowerCase())||t.isPublic?`viewer`:`none`:`none`}function fs(e){return e===`admin`||e===`owner`||e===`editor`}function ps(e){return e===`admin`||e===`owner`}var ms=Ln({workspace:zn().optional().catch(``)});const hs=t(`/dashboard/deployments/`)({validateSearch:e=>ms.parse(e),loaderDeps:({search:{workspace:e}})=>({workspace:e}),loader:async({context:{queryClient:e}})=>{await e.ensureQueryData({queryKey:G.workspaces(),queryFn:Mr,staleTime:3e4})},component:gs});function gs(){us(!0);let e=n(),t=c(),{workspace:r}=hs.useSearch(),a=i({queryKey:G.dashboardSnapshot(),queryFn:Nr,initialData:()=>t.getQueryData(G.dashboardSnapshot())??null,retry:!1,staleTime:1/0}),[o,s]=(0,F.useState)(null),[l,u]=(0,F.useState)(!1),[d,f]=(0,F.useState)(!1),m=i({queryKey:G.session(),queryFn:Ar,staleTime:3e4,retry:!1}),[h,g]=(0,F.useState)(``),[_,y]=(0,F.useState)(`all`),[b,x]=(0,F.useState)(`all`),[S,C]=(0,F.useState)(!0),w=i({queryKey:G.workspaces(),queryFn:Mr,staleTime:3e4}).data?.workspaces??[],T=`skyforge.lastWorkspaceId.deployments`,E=(0,F.useMemo)(()=>{if(r&&w.some(e=>e.id===r))return r;let e=typeof window<`u`?window.localStorage.getItem(T)??``:``;return e&&w.some(t=>t.id===e)?e:w[0]?.id??``},[r,w]);(0,F.useEffect)(()=>{E&&(typeof window<`u`&&window.localStorage.setItem(T,E),r!==E&&e({search:{workspace:E},replace:!0}))},[E]);let D=(0,F.useMemo)(()=>w.find(e=>e.id===E)??null,[w,E]),O=(0,F.useMemo)(()=>fs(ds(m.data,D)),[m.data,D]),ee=t=>{typeof window<`u`&&window.localStorage.setItem(T,t),e({search:{workspace:t},replace:!0})},k=(0,F.useMemo)(()=>{let e=a.data?.deployments??[];return E?e.filter(e=>e.workspaceId===E):e},[E,a.data?.deployments]),te=(0,F.useMemo)(()=>k.filter(e=>{if(h&&!e.name.toLowerCase().includes(h.toLowerCase()))return!1;if(_!==`all`){let t=(e.activeTaskStatus??e.lastStatus??`unknown`).toLowerCase();if(_===`running`&&![`running`,`active`,`healthy`].includes(t)||_===`stopped`&&![`created`,`stopped`,`success`,`succeeded`,`ready`].includes(t)||_===`failed`&&![`failed`,`error`,`crashloopbackoff`].includes(t))return!1}return!(b!==`all`&&(b===`netlab`&&!e.type.startsWith(`netlab`)||b===`containerlab`&&![`containerlab`,`clabernetes`].includes(e.type)||b===`terraform`&&e.type!==`terraform`))}),[k,h,_,b]),re=async e=>{try{await ia(e.workspaceId,e.id),P.success(`Deployment starting`,{description:`${e.name} is queued to start.`})}catch(e){P.error(`Failed to start`,{description:e.message})}},ie=async e=>{try{await aa(e.workspaceId,e.id),P.success(`Deployment stopping`,{description:`${e.name} is queued to stop.`})}catch(e){P.error(`Failed to stop`,{description:e.message})}},oe=(0,F.useMemo)(()=>[{id:`name`,header:`Name`,width:`minmax(240px, 1fr)`,cell:e=>(0,L.jsx)(p,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e.id},className:`hover:underline flex items-center gap-2 font-medium text-foreground`,children:e.name})},{id:`type`,header:`Type`,width:160,cell:e=>(0,L.jsx)(`span`,{className:`text-muted-foreground`,children:le(e.type)})},{id:`status`,header:`Status`,width:150,cell:e=>(0,L.jsx)(_s,{status:e.activeTaskStatus??e.lastStatus??`unknown`})},{id:`actions`,header:`Actions`,width:120,align:`right`,cell:t=>{let n=(t.activeTaskStatus??t.lastStatus??`unknown`).toLowerCase(),r=[`running`,`active`,`healthy`].includes(n),i=!!t.activeTaskId;return(0,L.jsxs)(hr,{children:[(0,L.jsx)(gr,{asChild:!0,children:(0,L.jsxs)(R,{variant:`ghost`,size:`icon`,className:`h-8 w-8`,children:[(0,L.jsx)(ne,{className:`h-4 w-4`}),(0,L.jsx)(`span`,{className:`sr-only`,children:`Open menu`})]})}),(0,L.jsxs)(yr,{align:`end`,children:[(0,L.jsx)(Cr,{children:`Actions`}),(0,L.jsxs)(br,{onClick:()=>e({to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:t.id}}),children:[(0,L.jsx)(en,{className:`mr-2 h-4 w-4`}),`Details`]}),(0,L.jsx)(wr,{}),(0,L.jsxs)(br,{onClick:()=>re(t),disabled:i||r,children:[(0,L.jsx)(St,{className:`mr-2 h-4 w-4`}),`Start`]}),(0,L.jsxs)(br,{onClick:()=>ie(t),disabled:i||!r,children:[(0,L.jsx)(ae,{className:`mr-2 h-4 w-4`}),`Stop`]}),(0,L.jsx)(wr,{}),(0,L.jsxs)(br,{onClick:()=>{s(t),u(!0)},className:`text-destructive focus:text-destructive`,disabled:i,children:[(0,L.jsx)(Mn,{className:`mr-2 h-4 w-4`}),`Delete`]})]})]})}}],[re,ie,e]),A=(0,F.useMemo)(()=>{let e=a.data?.runs??[];return E?e.filter(e=>String(e.workspaceId??``)===E):e},[E,a.data?.runs]),j=Or(window.location.pathname+window.location.search),ce=async()=>{if(o)try{await oa(o.workspaceId,o.id,{forwardDelete:d}),P.success(`Deployment deleted`,{description:`${o.name} has been removed.`}),await t.invalidateQueries({queryKey:G.dashboardSnapshot()}),u(!1),s(null),f(!1)}catch(e){P.error(`Failed to delete`,{description:e.message})}},le=e=>{switch(e){case`netlab`:return`Netlab (BYOS)`;case`netlab-c9s`:return`Netlab`;case`containerlab`:return`Containerlab (BYOS)`;case`clabernetes`:return`Containerlab`;default:return e}},ue=!!o?.config?.forwardNetworkId;return(0,L.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,L.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between border-b pb-6`,children:[(0,L.jsxs)(`div`,{children:[(0,L.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Deployments`}),(0,L.jsx)(`p`,{className:`text-muted-foreground text-sm`,children:`Manage deployments and monitor workspace activity.`})]}),(0,L.jsx)(`div`,{className:`flex items-center gap-3`,children:(0,L.jsxs)(`div`,{className:`flex items-center gap-2 bg-muted/50 p-1 rounded-lg border`,children:[(0,L.jsxs)(Y,{value:E,onValueChange:ee,disabled:w.length===0,children:[(0,L.jsx)(Z,{className:`w-[200px] h-8 bg-transparent border-0 focus:ring-0 shadow-none`,children:(0,L.jsx)(X,{placeholder:`Select workspace`})}),(0,L.jsx)(Q,{children:w.map(e=>(0,L.jsxs)($,{value:e.id,children:[e.name,` (`,e.slug,`)`]},e.id))})]}),(0,L.jsx)(`div`,{className:`h-4 w-px bg-border`}),(0,L.jsx)(p,{to:`/dashboard/workspaces/new`,title:`Create workspace`,className:mr({variant:`ghost`,size:`icon`,className:`h-8 w-8`}),children:(0,L.jsx)(v,{className:`h-4 w-4`})}),(0,L.jsx)(p,{to:`/dashboard/workspaces/$workspaceId`,params:{workspaceId:E},title:`Workspace Settings`,className:mr({variant:`ghost`,size:`icon`,className:`h-8 w-8`}),disabled:!E||!O,children:(0,L.jsx)(se,{className:`h-4 w-4`})})]})})]}),!a.data&&(0,L.jsx)(B,{className:`border-dashed`,children:(0,L.jsx)(W,{className:`pt-6`,children:(0,L.jsxs)(`div`,{className:`flex flex-col items-center justify-center space-y-4 py-8`,children:[(0,L.jsx)(K,{className:`h-4 w-64`}),(0,L.jsxs)(`div`,{className:`text-center text-muted-foreground`,children:[`Loading dashboard…`,(0,L.jsxs)(`div`,{className:`mt-2 text-xs`,children:[`If you are logged out,`,` `,(0,L.jsx)(`a`,{className:`text-primary underline hover:no-underline`,href:j,onClick:e=>{e.preventDefault(),(async()=>{if(!await La({loginHref:j})){window.location.href=j;return}await t.invalidateQueries({queryKey:G.session()})})()},children:`login`}),`.`]})]})]})})}),(0,L.jsxs)(`div`,{className:`flex flex-col lg:flex-row gap-6 relative items-start`,children:[(0,L.jsxs)(`div`,{className:`flex-1 min-w-0 space-y-4 w-full`,children:[(0,L.jsxs)(`div`,{className:`flex flex-col sm:flex-row gap-3`,children:[(0,L.jsxs)(`div`,{className:`relative flex-1`,children:[(0,L.jsx)(an,{className:`absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground`}),(0,L.jsx)(J,{placeholder:`Search deployments...`,className:`pl-9`,value:h,onChange:e=>g(e.target.value)})]}),(0,L.jsxs)(Y,{value:_,onValueChange:y,children:[(0,L.jsxs)(Z,{className:`w-[140px]`,children:[(0,L.jsx)(yn,{className:`mr-2 h-4 w-4 text-muted-foreground`}),(0,L.jsx)(X,{placeholder:`Status`})]}),(0,L.jsxs)(Q,{children:[(0,L.jsx)($,{value:`all`,children:`All Status`}),(0,L.jsx)($,{value:`running`,children:`Running`}),(0,L.jsx)($,{value:`stopped`,children:`Stopped`}),(0,L.jsx)($,{value:`failed`,children:`Failed`})]})]}),(0,L.jsxs)(Y,{value:b,onValueChange:x,children:[(0,L.jsxs)(Z,{className:`w-[140px]`,children:[(0,L.jsx)(Ke,{className:`mr-2 h-4 w-4 text-muted-foreground`}),(0,L.jsx)(X,{placeholder:`Type`})]}),(0,L.jsxs)(Q,{children:[(0,L.jsx)($,{value:`all`,children:`All Types`}),(0,L.jsx)($,{value:`netlab`,children:`Netlab`}),(0,L.jsx)($,{value:`containerlab`,children:`Containerlab`}),(0,L.jsx)($,{value:`terraform`,children:`Terraform`})]})]}),(0,L.jsxs)(p,{to:`/dashboard/deployments/new`,search:{workspace:E},className:mr({variant:`default`}),children:[(0,L.jsx)(v,{className:`mr-2 h-4 w-4`}),` Create`]})]}),(0,L.jsx)(B,{children:(0,L.jsx)(W,{className:`p-0`,children:a.data?te.length===0?(0,L.jsx)(Za,{icon:Kt,title:`No deployments found`,description:h||_!==`all`?`Try adjusting your filters.`:`You haven't created any deployments in this workspace yet.`,action:!h&&_===`all`?{label:`Create deployment`,onClick:()=>e({to:`/dashboard/deployments/new`,search:{workspace:E}})}:void 0}):(0,L.jsx)(Xa,{columns:oe,rows:te,getRowId:e=>e.id,maxHeightClassName:`max-h-[60vh]`,minWidthClassName:`min-w-[900px]`}):(0,L.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,L.jsx)(K,{className:`h-10 w-full`}),(0,L.jsx)(K,{className:`h-10 w-full`}),(0,L.jsx)(K,{className:`h-10 w-full`})]})})})]}),(0,L.jsxs)(`div`,{className:I(`transition-all duration-300 ease-in-out border-l space-y-4 shrink-0`,S?`w-full lg:w-80 xl:w-96 pl-6 opacity-100`:`w-0 lg:w-12 pl-0 opacity-100 border-none lg:border-l`),children:[(0,L.jsx)(`div`,{className:I(`flex items-center gap-2 h-[40px]`,!S&&`justify-center`),children:S?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(he,{className:`h-4 w-4 text-muted-foreground`}),(0,L.jsx)(`h3`,{className:`flex-1 text-sm font-semibold text-muted-foreground uppercase tracking-wider`,children:`Activity Feed`}),(0,L.jsx)(R,{variant:`ghost`,size:`icon`,className:`h-6 w-6 text-muted-foreground hover:text-foreground`,onClick:()=>C(!1),title:`Collapse feed`,children:(0,L.jsx)(Le,{className:`h-4 w-4`})})]}):(0,L.jsx)(R,{variant:`ghost`,size:`icon`,className:`h-8 w-8 text-muted-foreground hover:text-foreground`,onClick:()=>C(!0),title:`Expand activity feed`,children:(0,L.jsx)(jn,{className:`h-4 w-4`})})}),(0,L.jsx)(`div`,{className:I(`space-y-3`,!S&&`hidden`),children:a.data?A.length===0?(0,L.jsx)(B,{children:(0,L.jsx)(W,{className:`p-6 text-center text-sm text-muted-foreground`,children:`No recent activity.`})}):(0,L.jsx)(`div`,{className:`space-y-3`,children:A.slice(0,15).map(e=>([`success`,`failed`,`canceled`,`error`].includes(String(e.status??``).toLowerCase()),(0,L.jsx)(p,{to:`/dashboard/runs/$runId`,params:{runId:String(e.id??``)},className:`block group`,children:(0,L.jsx)(B,{className:`hover:border-primary/50 transition-colors`,children:(0,L.jsxs)(W,{className:`p-3`,children:[(0,L.jsxs)(`div`,{className:`flex items-start justify-between gap-2`,children:[(0,L.jsxs)(`div`,{className:`flex flex-col gap-1 min-w-0`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsxs)(`span`,{className:`font-mono text-xs font-medium text-foreground`,children:[`#`,String(e.id??``)]}),(0,L.jsx)(`span`,{className:`text-xs text-muted-foreground truncate max-w-[120px]`,children:String(e.tpl_alias??e.type??`Run`)})]}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground truncate`,children:String(e.message||`No message`)})]}),(0,L.jsx)(_s,{status:String(e.status??``),size:`xs`})]}),(0,L.jsxs)(`div`,{className:`mt-2 flex items-center justify-between text-[10px] text-muted-foreground`,children:[(0,L.jsx)(`span`,{children:String(e.user_name??`system`)}),(0,L.jsx)(`span`,{children:new Date(String(e.created)).toLocaleString(void 0,{month:`short`,day:`numeric`,hour:`numeric`,minute:`numeric`})})]})]})})},String(e.id??Math.random()))))}):(0,L.jsxs)(`div`,{className:`space-y-3`,children:[(0,L.jsx)(K,{className:`h-20 w-full`}),(0,L.jsx)(K,{className:`h-20 w-full`})]})})]})]}),(0,L.jsx)(bo,{open:l,onOpenChange:u,children:(0,L.jsxs)(Co,{children:[(0,L.jsxs)(wo,{children:[(0,L.jsx)(Eo,{children:`Delete deployment?`}),(0,L.jsxs)(Do,{children:[`This will remove "`,o?.name,`" from Skyforge and trigger provider cleanup. This action cannot be undone.`]})]}),ue&&(0,L.jsxs)(`div`,{className:`flex items-start gap-3 rounded-md border p-3`,children:[(0,L.jsx)(Ao,{checked:d,onCheckedChange:e=>f(!!e),id:`delete-forward-network`}),(0,L.jsx)(`label`,{htmlFor:`delete-forward-network`,className:`text-sm leading-tight cursor-pointer`,children:`Also delete the Forward network associated with this deployment.`})]}),(0,L.jsxs)(To,{children:[(0,L.jsx)(ko,{children:`Cancel`}),(0,L.jsx)(Oo,{onClick:ce,className:mr({variant:`destructive`}),children:`Delete`})]})]})})]})}function _s({status:e,size:t=`default`}){let n=`secondary`,r=e.toLowerCase(),i=r===`success`||r===`succeeded`?`ready`:r===`crashloopbackoff`?`crashloop`:e;return[`running`,`active`,`healthy`].includes(r)&&(n=`default`),[`failed`,`error`,`crashloopbackoff`].includes(r)&&(n=`destructive`),(0,L.jsx)(ao,{variant:n,className:`capitalize ${t===`xs`?`px-1.5 py-0 text-[10px] h-5`:``}`,children:i})}var vs=st,ys=F.createContext({}),bs=({...e})=>(0,L.jsx)(ys.Provider,{value:{name:e.name},children:(0,L.jsx)(Dt,{...e})}),xs=()=>{let e=F.useContext(ys),t=F.useContext(Ss),{getFieldState:n,formState:r}=pt(),i=n(e.name,r);if(!e)throw Error(`useFormField should be used within <FormField>`);let{id:a}=t;return{id:a,name:e.name,formItemId:`${a}-form-item`,formDescriptionId:`${a}-form-item-description`,formMessageId:`${a}-form-item-message`,...i}},Ss=F.createContext({}),Cs=F.forwardRef(({className:e,...t},n)=>{let r=F.useId();return(0,L.jsx)(Ss.Provider,{value:{id:r},children:(0,L.jsx)(`div`,{ref:n,className:I(`space-y-2`,e),...t})})});Cs.displayName=`FormItem`;var ws=F.forwardRef(({className:e,...t},n)=>{let{error:r,formItemId:i}=xs();return(0,L.jsx)(q,{ref:n,className:I(r&&`text-destructive`,e),htmlFor:i,...t})});ws.displayName=`FormLabel`;var Ts=F.forwardRef(({...e},t)=>{let{error:n,formItemId:r,formDescriptionId:i,formMessageId:a}=xs();return(0,L.jsx)(kn,{ref:t,id:r,"aria-describedby":n?`${i} ${a}`:`${i}`,"aria-invalid":!!n,...e})});Ts.displayName=`FormControl`;var Es=F.forwardRef(({className:e,...t},n)=>{let{formDescriptionId:r}=xs();return(0,L.jsx)(`p`,{ref:n,id:r,className:I(`text-sm text-muted-foreground`,e),...t})});Es.displayName=`FormDescription`;var Ds=F.forwardRef(({className:e,children:t,...n},r)=>{let{error:i,formMessageId:a}=xs(),o=i?String(i?.message):t;return o?(0,L.jsx)(`p`,{ref:r,id:a,className:I(`text-sm font-medium text-destructive`,e),...n,children:o}):null});Ds.displayName=`FormMessage`;var Os=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`textarea`,{className:I(`flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm`,e),ref:n,...t}));Os.displayName=`Textarea`;var ks=Ln({name:zn().min(2,`Name must be at least 2 characters`),slug:zn().min(2,`Slug must be at least 2 characters`).regex(/^[a-z0-9-]+$/,`Slug must contain only lowercase letters, numbers, and dashes`),description:zn().optional(),isPublic:Vn().default(!1),blueprint:zn().optional(),sharedUsers:zn().optional(),awsAccountId:zn().optional(),awsRoleName:zn().optional(),awsRegion:zn().optional(),awsAuthMethod:zn().optional()});const As=t(`/dashboard/workspaces/new`)({component:js});function js(){let e=n(),t=c(),i=Dn({resolver:At(ks),defaultValues:{name:``,slug:``,description:``,isPublic:!1,blueprint:`skyforge/blueprints`,sharedUsers:``,awsAccountId:``,awsRoleName:``,awsRegion:`us-east-1`,awsAuthMethod:`sso`}}),a=r({mutationFn:e=>Ci({name:e.name,slug:e.slug,description:e.description||``,isPublic:!!e.isPublic,allowCustomNetlabServers:!1,allowExternalTemplateRepos:!1,awsAccountId:(e.awsAccountId||``).trim(),awsAuthMethod:(e.awsAuthMethod||``).trim(),awsRegion:(e.awsRegion||``).trim(),awsRoleName:(e.awsRoleName||``).trim(),blueprint:(e.blueprint||``).trim(),externalTemplateRepos:[],sharedUsers:(e.sharedUsers||``).split(`,`).map(e=>e.trim()).filter(Boolean)}),onSuccess:async n=>{P.success(`Workspace created`,{description:`Workspace "${n.name}" has been created successfully.`}),await t.invalidateQueries({queryKey:G.workspaces()}),await e({to:`/dashboard/deployments`,search:{workspace:n.id}})},onError:e=>{P.error(`Failed to create workspace`,{description:e.message})}});function o(e){a.mutate(e)}function s(e){let t=e.target.value;if(i.setValue(`name`,t),!i.getFieldState(`slug`).isDirty){let e=t.toLowerCase().replace(/[^a-z0-9]+/g,`-`).replace(/^-|-$/g,``);i.setValue(`slug`,e)}}return(0,L.jsxs)(`div`,{className:`max-w-2xl mx-auto p-6 space-y-6`,children:[(0,L.jsx)(`div`,{className:`flex items-center justify-between`,children:(0,L.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Create Workspace`})}),(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Workspace Details`}),(0,L.jsx)(U,{children:`Workspaces organize your deployments and resources.`})]}),(0,L.jsx)(W,{children:(0,L.jsx)(vs,{...i,children:(0,L.jsxs)(`form`,{onSubmit:i.handleSubmit(o),className:`space-y-6`,children:[(0,L.jsx)(bs,{control:i.control,name:`name`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{children:`Name`}),(0,L.jsx)(Ts,{children:(0,L.jsx)(J,{placeholder:`My Project`,...e,onChange:t=>{e.onChange(t),s(t)}})}),(0,L.jsx)(Es,{children:`A display name for your workspace.`}),(0,L.jsx)(Ds,{})]})}),(0,L.jsx)(bs,{control:i.control,name:`slug`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{children:`Slug`}),(0,L.jsx)(Ts,{children:(0,L.jsx)(J,{placeholder:`my-project`,...e})}),(0,L.jsx)(Es,{children:`Unique identifier used in URLs. Only lowercase letters, numbers, and dashes.`}),(0,L.jsx)(Ds,{})]})}),(0,L.jsx)(bs,{control:i.control,name:`description`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{children:`Description`}),(0,L.jsx)(Ts,{children:(0,L.jsx)(Os,{placeholder:`Describe the purpose of this workspace...`,...e})}),(0,L.jsx)(Es,{children:`Optional description for your team.`}),(0,L.jsx)(Ds,{})]})}),(0,L.jsx)(bs,{control:i.control,name:`isPublic`,render:({field:e})=>(0,L.jsxs)(Cs,{className:`flex items-center justify-between rounded-lg border p-4`,children:[(0,L.jsxs)(`div`,{className:`space-y-0.5`,children:[(0,L.jsx)(ws,{children:`Public workspace`}),(0,L.jsxs)(Es,{children:[`Required for BYOS Netlab via`,` `,(0,L.jsx)(`code`,{className:`font-mono`,children:`topologyUrl`}),` when using workspace templates.`]})]}),(0,L.jsx)(Ts,{children:(0,L.jsx)(Mo,{checked:e.value,onCheckedChange:e.onChange})})]})}),(0,L.jsx)(bs,{control:i.control,name:`blueprint`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{children:`Blueprint repo`}),(0,L.jsx)(Ts,{children:(0,L.jsx)(J,{placeholder:`skyforge/blueprints`,...e})}),(0,L.jsx)(Es,{children:`Default template catalog repo (format: owner/repo).`}),(0,L.jsx)(Ds,{})]})}),(0,L.jsx)(bs,{control:i.control,name:`sharedUsers`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{children:`Shared users (viewers)`}),(0,L.jsx)(Ts,{children:(0,L.jsx)(J,{placeholder:`alice,bob`,...e})}),(0,L.jsx)(Es,{children:`Comma-separated usernames.`}),(0,L.jsx)(Ds,{})]})}),(0,L.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,L.jsx)(bs,{control:i.control,name:`awsAccountId`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{children:`AWS account ID (optional)`}),(0,L.jsx)(Ts,{children:(0,L.jsx)(J,{placeholder:`123456789012`,...e})}),(0,L.jsx)(Ds,{})]})}),(0,L.jsx)(bs,{control:i.control,name:`awsRoleName`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{children:`AWS role name (optional)`}),(0,L.jsx)(Ts,{children:(0,L.jsx)(J,{placeholder:`MyRole`,...e})}),(0,L.jsx)(Ds,{})]})}),(0,L.jsx)(bs,{control:i.control,name:`awsRegion`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{children:`AWS region`}),(0,L.jsx)(Ts,{children:(0,L.jsx)(J,{placeholder:`us-east-1`,...e})}),(0,L.jsx)(Ds,{})]})}),(0,L.jsx)(bs,{control:i.control,name:`awsAuthMethod`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{children:`AWS auth method`}),(0,L.jsx)(Ts,{children:(0,L.jsx)(J,{placeholder:`sso`,...e})}),(0,L.jsx)(Ds,{})]})})]}),(0,L.jsxs)(`div`,{className:`flex justify-end gap-4`,children:[(0,L.jsx)(R,{type:`button`,variant:`ghost`,onClick:()=>e({to:`/dashboard/deployments`}),children:`Cancel`}),(0,L.jsx)(R,{type:`submit`,disabled:a.isPending,children:a.isPending?`Creating...`:`Create Workspace`})]})]})})})]})]})}const Ms=[{label:"Device (`NETLAB_DEVICE`)",key:`NETLAB_DEVICE`},{label:"BGP AS (`NETLAB_BGP_AS`)",key:`NETLAB_BGP_AS`},{label:"P2P IPv4 pool (`NETLAB_ADDRESSING_P2P_IPV4`)",key:`NETLAB_ADDRESSING_P2P_IPV4`},{label:"P2P IPv6 mode (`NETLAB_ADDRESSING_P2P_IPV6`)",key:`NETLAB_ADDRESSING_P2P_IPV6`},{label:"Loopback IPv4 pool (`NETLAB_ADDRESSING_LOOPBACK_IPV4`)",key:`NETLAB_ADDRESSING_LOOPBACK_IPV4`},{label:"LAN IPv4 pool (`NETLAB_ADDRESSING_LAN_IPV4`)",key:`NETLAB_ADDRESSING_LAN_IPV4`},{label:"Netlab `--set` overrides (`SKYFORGE_NETLAB_SET_OVERRIDES`)",key:`SKYFORGE_NETLAB_SET_OVERRIDES`}],Ns=[{label:`Arista EOS (eos)`,value:`eos`},{label:`Cisco IOL (iol)`,value:`iol`},{label:`Cisco IOSv (iosv)`,value:`iosv`},{label:`Cisco IOSvL2 (iosvl2)`,value:`iosvl2`},{label:`Cisco CSR1000v (csr)`,value:`csr`},{label:`Cisco ASA (asav)`,value:`asav`},{label:`Cisco NX-OSv9k (nxos)`,value:`nxos`},{label:`Juniper SRX`,value:`vsrx`},{label:`Juniper vMX (vmx)`,value:`vmx`},{label:`Juniper vJunos Router (vjunos-router)`,value:`vjunos-router`},{label:`Juniper vJunos Switch (vjunos-switch)`,value:`vjunos-switch`},{label:`Nokia SR OS (sros)`,value:`sros`},{label:`Linux (linux)`,value:`linux`}];function Ps(e){return String(e??``).trim().toUpperCase()===`SKYFORGE_NETLAB_SET_OVERRIDES`}function Fs(e){switch(String(e??``).trim().toUpperCase()){case`NETLAB_DEVICE`:return Ns;case`NETLAB_BGP_AS`:return[{label:`65000`,value:`65000`},{label:`65100`,value:`65100`},{label:`65200`,value:`65200`},{label:`65500`,value:`65500`}];case`NETLAB_ADDRESSING_P2P_IPV4`:return[{label:`198.18.0.0/16 (benchmark range)`,value:`198.18.0.0/16`},{label:`172.16.0.0/12`,value:`172.16.0.0/12`},{label:`100.64.0.0/10`,value:`100.64.0.0/10`}];case`NETLAB_ADDRESSING_P2P_IPV6`:return[{label:`false (disable / avoid LLA-only)`,value:`false`},{label:`true`,value:`true`}];case`NETLAB_ADDRESSING_LOOPBACK_IPV4`:return[{label:`10.0.0.0/24`,value:`10.0.0.0/24`},{label:`198.18.1.0/24`,value:`198.18.1.0/24`},{label:`172.16.0.0/24`,value:`172.16.0.0/24`}];case`NETLAB_ADDRESSING_LAN_IPV4`:return[{label:`172.18.0.0/16`,value:`172.18.0.0/16`},{label:`198.18.128.0/17`,value:`198.18.128.0/17`}];default:return null}}var Is=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`div`,{className:`relative w-full overflow-auto`,children:(0,L.jsx)(`table`,{ref:n,className:I(`w-full caption-bottom text-sm`,e),...t})}));Is.displayName=`Table`;var Ls=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`thead`,{ref:n,className:I(`[&_tr]:border-b`,e),...t}));Ls.displayName=`TableHeader`;var Rs=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`tbody`,{ref:n,className:I(`[&_tr:last-child]:border-0`,e),...t}));Rs.displayName=`TableBody`;var zs=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`tfoot`,{ref:n,className:I(`border-t bg-muted/50 font-medium [&>tr]:last:border-b-0`,e),...t}));zs.displayName=`TableFooter`;var Bs=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`tr`,{ref:n,className:I(`border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted`,e),...t}));Bs.displayName=`TableRow`;var Vs=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`th`,{ref:n,className:I(`h-10 px-3 text-left align-middle text-xs font-medium uppercase tracking-wide text-muted-foreground [&:has([role=checkbox])]:pr-0`,e),...t}));Vs.displayName=`TableHead`;var Hs=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`td`,{ref:n,className:I(`px-3 py-2 align-middle [&:has([role=checkbox])]:pr-0`,e),...t}));Hs.displayName=`TableCell`;var Us=F.forwardRef(({className:e,...t},n)=>(0,L.jsx)(`caption`,{ref:n,className:I(`mt-4 text-sm text-muted-foreground`,e),...t}));Us.displayName=`TableCaption`;function Ws({workspaceId:e,allowEdit:t}){let n=c(),[a,o]=(0,F.useState)(!1),[s,l]=(0,F.useState)(null),[u,d]=(0,F.useState)(null),f=i({queryKey:[`workspaceVariableGroups`,e],queryFn:async()=>ua(e),staleTime:3e4}),p=f.data?.groups??[],m=r({mutationFn:async t=>pa(e,t),onSuccess:()=>{P.success(`Variable group deleted`),n.invalidateQueries({queryKey:[`workspaceVariableGroups`,e]}),d(null)},onError:e=>P.error(`Failed to delete group`,{description:e.message})});return(0,L.jsxs)(B,{children:[(0,L.jsx)(V,{children:(0,L.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,L.jsxs)(`div`,{children:[(0,L.jsx)(H,{children:`Variable Groups`}),(0,L.jsx)(U,{children:`Define sets of environment variables that can be injected into deployments.`})]}),(0,L.jsxs)(R,{size:`sm`,onClick:()=>o(!0),disabled:!t,children:[(0,L.jsx)(v,{className:`mr-2 h-4 w-4`}),`New Group`]})]})}),(0,L.jsx)(W,{children:f.isLoading?(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading groups…`}):p.length===0?(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground border border-dashed rounded-lg p-8 text-center`,children:`No variable groups defined.`}):(0,L.jsx)(`div`,{className:`rounded-md border`,children:(0,L.jsxs)(Is,{children:[(0,L.jsx)(Ls,{children:(0,L.jsxs)(Bs,{children:[(0,L.jsx)(Vs,{children:`Name`}),(0,L.jsx)(Vs,{children:`Variables`}),(0,L.jsx)(Vs,{className:`text-right`,children:`Actions`})]})}),(0,L.jsx)(Rs,{children:p.map(e=>(0,L.jsxs)(Bs,{children:[(0,L.jsx)(Hs,{className:`font-medium`,children:e.name}),(0,L.jsxs)(Hs,{className:`text-muted-foreground text-xs`,children:[Object.keys(e.variables??{}).length,` variables`]}),(0,L.jsx)(Hs,{className:`text-right`,children:(0,L.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[(0,L.jsx)(R,{variant:`ghost`,size:`icon`,className:`h-8 w-8`,onClick:()=>l(e),disabled:!t,children:(0,L.jsx)(pn,{className:`h-4 w-4`})}),(0,L.jsx)(R,{variant:`ghost`,size:`icon`,className:`h-8 w-8 text-destructive hover:text-destructive`,onClick:()=>d(e),disabled:!t,children:(0,L.jsx)(Mn,{className:`h-4 w-4`})})]})})]},e.id))})]})})}),(0,L.jsx)(Gs,{open:a,onOpenChange:o,workspaceId:e,allowEdit:t,mode:`create`}),s&&(0,L.jsx)(Gs,{open:!!s,onOpenChange:e=>!e&&l(null),workspaceId:e,allowEdit:t,mode:`edit`,initialData:s}),(0,L.jsx)(bo,{open:!!u,onOpenChange:e=>!e&&d(null),children:(0,L.jsxs)(Co,{children:[(0,L.jsxs)(wo,{children:[(0,L.jsx)(Eo,{children:`Delete variable group?`}),(0,L.jsxs)(Do,{children:[`This will permanently delete `,(0,L.jsx)(`strong`,{children:u?.name}),`.`]})]}),(0,L.jsxs)(To,{children:[(0,L.jsx)(ko,{children:`Cancel`}),(0,L.jsx)(Oo,{className:`bg-destructive text-destructive-foreground hover:bg-destructive/90`,onClick:()=>u&&m.mutate(u.id),children:m.isPending?`Deleting…`:`Delete`})]})]})})]})}function Gs({open:e,onOpenChange:t,workspaceId:n,allowEdit:i,mode:a,initialData:o}){let s=c(),[l,u]=(0,F.useState)(o?.name??``),[d,f]=(0,F.useState)(!1),[p,m]=(0,F.useState)(()=>o?.variables?Object.entries(o.variables).map(([e,t])=>({key:e,value:t})):[{key:``,value:``}]),h=r({mutationFn:async()=>{let e={};for(let t of p)t.key.trim()&&(e[t.key.trim()]=t.value);let t={name:l.trim(),variables:e};if(a===`create`)return da(n,t);if(!o)throw Error(`Missing initial data for edit`);return fa(n,o.id,t)},onSuccess:()=>{P.success(a===`create`?`Group created`:`Group updated`),s.invalidateQueries({queryKey:[`workspaceVariableGroups`,n]}),t(!1),a===`create`&&(u(``),m([{key:``,value:``}]))},onError:e=>P.error(`Failed to save group`,{description:e.message})});return(0,L.jsxs)(Kn,{open:e,onOpenChange:t,children:[(0,L.jsxs)(Yn,{className:`max-w-2xl`,children:[(0,L.jsxs)(Xn,{children:[(0,L.jsx)(Qn,{children:a===`create`?`Create Variable Group`:`Edit Variable Group`}),(0,L.jsx)($n,{children:`Define environment variables as key-value pairs.`})]}),(0,L.jsxs)(`div`,{className:`space-y-4 py-4`,children:[(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(q,{children:`Group Name`}),(0,L.jsx)(J,{value:l,onChange:e=>u(e.target.value),placeholder:`e.g. Production Vars`,disabled:!i})]}),(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,L.jsx)(q,{children:`Variables`}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(R,{type:`button`,variant:`ghost`,size:`sm`,onClick:()=>f(!0),children:`Supported vars`}),(0,L.jsxs)(R,{type:`button`,variant:`outline`,size:`sm`,onClick:()=>m([...p,{key:``,value:``}]),disabled:!i,children:[(0,L.jsx)(v,{className:`mr-2 h-3 w-3`}),` Add Variable`]})]})]}),(0,L.jsx)(`div`,{className:`space-y-2 max-h-[320px] overflow-y-auto pr-2`,children:p.map((e,t)=>{let n=String(e.key??``).trim(),r=Ms.some(e=>e.key===n)?n:`__custom__`,a=Ps(n),o=Fs(n),s=e=>{m(n=>{let r=[...n];return r[t]={...r[t],...e},r})};return(0,L.jsxs)(`div`,{className:`grid grid-cols-12 gap-2 items-start`,children:[(0,L.jsxs)(`div`,{className:`col-span-5 space-y-1`,children:[(0,L.jsx)(q,{className:`text-xs text-muted-foreground`,children:`Key`}),(0,L.jsxs)(Y,{value:r,onValueChange:e=>s({key:e===`__custom__`?``:e}),disabled:!i,children:[(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:`Select key…`})}),(0,L.jsxs)(Q,{children:[Ms.map(e=>(0,L.jsx)($,{value:e.key,children:e.label},e.key)),(0,L.jsx)($,{value:`__custom__`,children:`Custom…`})]})]}),r===`__custom__`&&(0,L.jsx)(J,{placeholder:`KEY`,value:e.key,onChange:e=>s({key:e.target.value}),className:`font-mono text-xs`,disabled:!i})]}),(0,L.jsxs)(`div`,{className:`col-span-6 space-y-1`,children:[(0,L.jsx)(q,{className:`text-xs text-muted-foreground`,children:`Value`}),a?(0,L.jsx)(Os,{value:e.value,onChange:e=>s({value:e.target.value}),placeholder:`One \`key=value\` per line.
Example:
addressing.p2p.ipv4=198.18.0.0/16`,className:`font-mono text-xs min-h-[120px]`,disabled:!i}):o?(0,L.jsx)(`div`,{className:`space-y-2`,children:(()=>{let t=String(e.value??``).trim(),n=o.some(e=>e.value===t),r=t?n?t:`__custom__`:`none`;return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(Y,{value:r,onValueChange:e=>{s(e===`none`?{value:``}:e===`__custom__`?{value:n?``:t}:{value:e})},disabled:!i,children:[(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:`Select value…`})}),(0,L.jsxs)(Q,{children:[(0,L.jsx)($,{value:`none`,children:`None`}),o.map(e=>(0,L.jsx)($,{value:e.value,children:e.label},e.value)),(0,L.jsx)($,{value:`__custom__`,children:`Custom…`})]})]}),r===`__custom__`&&(0,L.jsx)(J,{placeholder:`VALUE`,value:e.value,onChange:e=>s({value:e.target.value}),className:`font-mono text-xs`,disabled:!i})]})})()}):(0,L.jsx)(J,{placeholder:`VALUE`,value:e.value,onChange:e=>s({value:e.target.value}),className:`font-mono text-xs`,disabled:!i})]}),(0,L.jsx)(`div`,{className:`col-span-1 flex justify-end pt-6`,children:(0,L.jsx)(R,{type:`button`,variant:`ghost`,size:`icon`,className:`h-8 w-8`,onClick:()=>{m(e=>{let n=e.filter((e,n)=>n!==t);return n.length?n:[{key:``,value:``}]})},disabled:!i,children:(0,L.jsx)(Mn,{className:`h-4 w-4 text-muted-foreground`})})})]},t)})})]})]}),(0,L.jsxs)(Zn,{children:[(0,L.jsx)(R,{variant:`outline`,onClick:()=>t(!1),children:`Cancel`}),(0,L.jsxs)(R,{onClick:()=>h.mutate(),disabled:!i||h.isPending||!l.trim(),children:[h.isPending&&(0,L.jsx)(un,{className:`mr-2 h-4 w-4 animate-spin`}),`Save Group`]})]})]}),(0,L.jsx)(bo,{open:d,onOpenChange:f,children:(0,L.jsxs)(Co,{children:[(0,L.jsxs)(wo,{children:[(0,L.jsx)(Eo,{children:`Supported NETLAB_ variables`}),(0,L.jsx)(Do,{children:"These are the most useful Netlab defaults you can override via environment variables (plus Skyforge’s multiline `SKYFORGE_NETLAB_SET_OVERRIDES`)."})]}),(0,L.jsx)(`div`,{className:`max-h-[50vh] overflow-auto rounded-md border bg-muted/30 p-3 font-mono text-xs`,children:Ms.map(e=>(0,L.jsxs)(`div`,{className:`flex gap-2`,children:[(0,L.jsx)(`span`,{className:`text-foreground`,children:e.key}),(0,L.jsxs)(`span`,{className:`text-muted-foreground`,children:[`— `,e.label]})]},e.key))}),(0,L.jsx)(To,{children:(0,L.jsx)(Oo,{children:`Close`})})]})})]})}const Ks=t(`/dashboard/workspaces/$workspaceId`)({component:Ys});function qs(e){let t=String(e??``).trim();if(!t)return``;try{return new URL(t).hostname||t}catch{return t.replace(/^https?:\/\//,``).split(`/`)[0]??t}}function Js(e){return qs(e)||`server`}function Ys(){let{workspaceId:e}=Ks.useParams(),t=n(),a=c(),o=i({queryKey:G.session(),queryFn:Ar,staleTime:3e4,retry:!1}),s=i({queryKey:G.workspaces(),queryFn:Mr}),l=(0,F.useMemo)(()=>(s.data?.workspaces??[]).find(t=>t.id===e)??null,[s.data,e]),u=(0,F.useMemo)(()=>ds(o.data,l),[o.data,l]),d=(0,F.useMemo)(()=>fs(u),[u]),f=(0,F.useMemo)(()=>ps(u),[u]),[m,h]=(0,F.useState)(``),[g,_]=(0,F.useState)(``),[v,y]=(0,F.useState)(``),[b,x]=(0,F.useState)([]),[S,C]=(0,F.useState)(``),[w,T]=(0,F.useState)(``),[E,D]=(0,F.useState)(``),[O,ee]=(0,F.useState)(``),[k,te]=(0,F.useState)(!0),[ne,re]=(0,F.useState)(``),[ie,ae]=(0,F.useState)(``),[oe,A]=(0,F.useState)(``),[j,se]=(0,F.useState)(!0),[ce,le]=(0,F.useState)(``),[ue,de]=(0,F.useState)(``),fe=r({mutationFn:async()=>Oi(e,{confirm:S.trim()||(l?.slug??e)}),onSuccess:async()=>{P.success(`Workspace deleted`),await a.invalidateQueries({queryKey:G.workspaces()}),await t({to:`/dashboard/deployments`})},onError:e=>P.error(`Failed to delete workspace`,{description:e.message})});(0,F.useEffect)(()=>{l&&(_((l.owners??[]).join(`,`)),y((l.editors??[]).join(`,`)),h((l.viewers??[]).join(`,`)),x((l.externalTemplateRepos??[]).filter(e=>!!e&&typeof e.id==`string`&&typeof e.name==`string`&&typeof e.repo==`string`).map(e=>({id:String(e.id??``).trim(),name:String(e.name??``).trim(),repo:String(e.repo??``).trim(),defaultBranch:String(e.defaultBranch??``).trim()||void 0}))))},[l]);let pe=i({queryKey:[`userGitCredentials`],queryFn:Zr,staleTime:3e4});(0,F.useEffect)(()=>{let e=pe.data;e&&T(e.httpsUsername??``)},[pe.data]);let me=r({mutationFn:async e=>Qr(e),onSuccess:async()=>{P.success(`Git credentials updated`),D(``),await a.invalidateQueries({queryKey:[`userGitCredentials`]})},onError:e=>P.error(`Failed to update git credentials`,{description:e.message})}),he=r({mutationFn:$r,onSuccess:async()=>{P.success(`Deploy key rotated`),await a.invalidateQueries({queryKey:[`userGitCredentials`]})},onError:e=>P.error(`Failed to rotate deploy key`,{description:e.message})}),ge=r({mutationFn:async t=>wi(e,{isPublic:t.isPublic,owners:t.owners,ownerGroups:l?.ownerGroups??[],editors:t.editors,editorGroups:l?.editorGroups??[],viewers:t.viewers,viewerGroups:l?.viewerGroups??[]}),onSuccess:async()=>{P.success(`Workspace updated`),await a.invalidateQueries({queryKey:G.workspaces()})},onError:e=>P.error(`Failed to update workspace`,{description:e.message})}),_e=r({mutationFn:async t=>Pi(e,{allowExternalTemplateRepos:(t.externalTemplateRepos??[]).length>0,allowCustomEveServers:!0,allowCustomNetlabServers:!0,externalTemplateRepos:t.externalTemplateRepos??[]}),onSuccess:async()=>{P.success(`Workspace feature flags updated`),await a.invalidateQueries({queryKey:G.workspaces()})},onError:e=>P.error(`Failed to update settings`,{description:e.message})}),ve=i({queryKey:G.workspaceNetlabServers(e),queryFn:async()=>Rr(e),staleTime:3e4}),ye=i({queryKey:[`workspaceEveServers`,e],queryFn:async()=>Vr(e),staleTime:3e4}),be=r({mutationFn:async()=>zr(e,{name:Js(O),apiUrl:O.trim(),apiInsecure:k,apiUser:ne.trim()||void 0,apiPassword:ie.trim()||void 0}),onSuccess:async()=>{P.success(`Netlab server saved`),ee(``),te(!0),re(``),ae(``),await a.invalidateQueries({queryKey:G.workspaceNetlabServers(e)})},onError:e=>P.error(`Failed to save Netlab server`,{description:e.message})}),xe=r({mutationFn:async t=>Br(e,t),onSuccess:async()=>{P.success(`Netlab server deleted`),await a.invalidateQueries({queryKey:G.workspaceNetlabServers(e)})},onError:e=>P.error(`Failed to delete Netlab server`,{description:e.message})}),Se=r({mutationFn:async()=>Hr(e,{name:Js(oe),apiUrl:oe.trim(),skipTlsVerify:j,apiUser:ce.trim()||void 0,apiPassword:ue.trim()||void 0}),onSuccess:async()=>{P.success(`EVE-NG server saved`),A(``),se(!0),le(``),de(``),await a.invalidateQueries({queryKey:[`workspaceEveServers`,e]})},onError:e=>P.error(`Failed to save EVE-NG server`,{description:e.message})}),Ce=r({mutationFn:async t=>Ur(e,t),onSuccess:async()=>{P.success(`EVE-NG server deleted`),await a.invalidateQueries({queryKey:[`workspaceEveServers`,e]})},onError:e=>P.error(`Failed to delete EVE-NG server`,{description:e.message})}),we=e=>e.split(`,`).map(e=>e.trim()).filter(Boolean);return s.isLoading?(0,L.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,L.jsx)(K,{className:`h-8 w-64`}),(0,L.jsx)(K,{className:`h-28 w-full`})]}):l?(0,L.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between border-b pb-6`,children:[(0,L.jsxs)(`div`,{children:[(0,L.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:l.name}),(0,L.jsxs)(`div`,{className:`mt-1 text-sm text-muted-foreground`,children:[(0,L.jsx)(`span`,{className:`font-mono`,children:l.slug}),` `,(0,L.jsx)(ao,{variant:l.isPublic?`default`:`secondary`,children:l.isPublic?`Public`:`Private`})]})]}),(0,L.jsx)(p,{to:`/dashboard/deployments`,search:{workspace:l.id},children:(0,L.jsx)(R,{variant:`outline`,children:`Back to deployments`})})]}),(0,L.jsxs)(zo,{defaultValue:`access`,className:`space-y-6`,children:[(0,L.jsxs)(Bo,{children:[(0,L.jsx)(Vo,{value:`access`,children:`Access`}),(0,L.jsx)(Vo,{value:`variables`,children:`Variables`}),(0,L.jsx)(Vo,{value:`features`,children:`Features`}),f&&(0,L.jsx)(Vo,{value:`danger`,children:`Danger`})]}),(0,L.jsxs)(Ho,{value:`access`,className:`space-y-6`,children:[!d&&(0,L.jsx)(B,{children:(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Read-only access`}),(0,L.jsx)(U,{children:`You can view this workspace but cannot edit or delete it.`})]})}),(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Visibility`}),(0,L.jsx)(U,{children:"BYOS Netlab via `topologyUrl` requires public access to the selected topology."})]}),(0,L.jsxs)(W,{className:`flex items-center justify-between`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Public workspace`}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Controls Gitea repo visibility and template accessibility.`})]}),(0,L.jsx)(Mo,{checked:!!l.isPublic,disabled:!d,onCheckedChange:e=>{let t=we(g);ge.mutate({isPublic:e,owners:t,editors:we(v),viewers:we(m)})}})]})]}),(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Members`}),(0,L.jsx)(U,{children:`Comma-separated usernames. (Groups are not editable here yet.)`})]}),(0,L.jsxs)(W,{className:`space-y-4`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Owners`}),(0,L.jsx)(J,{value:g,onChange:e=>_(e.target.value),placeholder:`alice,bob`,disabled:!d})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Editors`}),(0,L.jsx)(J,{value:v,onChange:e=>y(e.target.value),placeholder:`alice,bob`,disabled:!d})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Viewers`}),(0,L.jsx)(J,{value:m,onChange:e=>h(e.target.value),placeholder:`alice,bob`,disabled:!d})]}),(0,L.jsx)(`div`,{className:`flex justify-end`,children:(0,L.jsx)(R,{variant:`default`,disabled:!d||ge.isPending,onClick:()=>ge.mutate({isPublic:!!l.isPublic,owners:we(g),editors:we(v),viewers:we(m)}),children:ge.isPending?`Saving…`:`Save members`})})]})]})]}),(0,L.jsx)(Ho,{value:`variables`,className:`space-y-6`,children:(0,L.jsx)(Ws,{workspaceId:e,allowEdit:d})}),(0,L.jsx)(Ho,{value:`features`,className:`space-y-6`,children:(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Workspace features`}),(0,L.jsx)(U,{children:`Configure external template sources and BYOS servers for this workspace.`})]}),(0,L.jsxs)(W,{className:`space-y-4`,children:[(0,L.jsxs)(`div`,{className:`rounded-md border p-3 space-y-3`,children:[(0,L.jsx)(`div`,{className:`text-sm font-medium`,children:`BYOS Netlab servers`}),(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Add one or more Netlab API endpoints. When at least one is configured, `,(0,L.jsx)(`span`,{className:`font-mono`,children:`Netlab (BYOS)`}),` `,`becomes available in Create deployment.`]}),(0,L.jsx)(`div`,{className:`space-y-2`,children:(ve.data?.servers??[]).length===0?(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No Netlab servers configured.`}):(ve.data?.servers??[]).map(e=>(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-3 rounded-md border p-3`,children:[(0,L.jsxs)(`div`,{className:`min-w-0`,children:[(0,L.jsx)(`div`,{className:`font-medium`,children:qs(e.apiUrl)||e.name}),(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground truncate`,children:[e.apiUrl,` `,e.apiInsecure?`(insecure)`:``,` `,e.apiUser?`· ${e.apiUser}`:``,` `,e.hasPassword?`· password set`:``]})]}),(0,L.jsx)(R,{type:`button`,variant:`destructive`,size:`sm`,disabled:!d||xe.isPending,onClick:()=>xe.mutate(e.id),children:`Delete`})]},e.id))}),(0,L.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`API URL`}),(0,L.jsx)(J,{value:O,disabled:!d,onChange:e=>ee(e.target.value),placeholder:`https://netlab.local.forwardnetworks.com:8080`}),(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Custom ports are supported (e.g.`,` `,(0,L.jsx)(`span`,{className:`font-mono`,children:`:8080`}),`) but won’t be shown in dropdown labels.`]})]}),(0,L.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3 md:col-span-2`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(`div`,{className:`text-sm font-medium`,children:`Skip TLS verification`}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Disable certificate verification for this server.`})]}),(0,L.jsx)(Mo,{checked:k,onCheckedChange:te,disabled:!d})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Username`}),(0,L.jsx)(J,{value:ne,disabled:!d,onChange:e=>re(e.target.value),placeholder:`user`})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Password`}),(0,L.jsx)(J,{value:ie,disabled:!d,onChange:e=>ae(e.target.value),placeholder:`password`,type:`password`})]})]}),(0,L.jsx)(`div`,{className:`flex justify-end`,children:(0,L.jsx)(R,{type:`button`,disabled:!d||be.isPending||!O.trim(),onClick:()=>be.mutate(),children:be.isPending?`Saving…`:`Add Netlab server`})})]}),(0,L.jsxs)(`div`,{className:`rounded-md border p-3 space-y-3`,children:[(0,L.jsx)(`div`,{className:`text-sm font-medium`,children:`BYOS EVE-NG servers (LabPP)`}),(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Add one or more EVE-NG API endpoints. When at least one is configured, `,(0,L.jsx)(`span`,{className:`font-mono`,children:`LabPP`}),` becomes available in Create deployment.`]}),(0,L.jsx)(`div`,{className:`space-y-2`,children:(ye.data?.servers??[]).length===0?(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No EVE-NG servers configured.`}):(ye.data?.servers??[]).map(e=>(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-3 rounded-md border p-3`,children:[(0,L.jsxs)(`div`,{className:`min-w-0`,children:[(0,L.jsx)(`div`,{className:`font-medium`,children:qs(e.apiUrl)||e.name}),(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground truncate`,children:[e.apiUrl,` `,e.skipTlsVerify?`(skip TLS verify)`:``,` `,e.apiUser?`· ${e.apiUser}`:``,` `,e.hasPassword?`· password set`:``]})]}),(0,L.jsx)(R,{type:`button`,variant:`destructive`,size:`sm`,disabled:!d||Ce.isPending,onClick:()=>Ce.mutate(e.id),children:`Delete`})]},e.id))}),(0,L.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`API URL`}),(0,L.jsx)(J,{value:oe,disabled:!d,onChange:e=>A(e.target.value),placeholder:`https://eve.example:8080/api`}),(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Custom ports are supported (e.g.`,` `,(0,L.jsx)(`span`,{className:`font-mono`,children:`:8080`}),`) but won’t be shown in dropdown labels.`]})]}),(0,L.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3 md:col-span-2`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(`div`,{className:`text-sm font-medium`,children:`Skip TLS verification`}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Disable certificate verification for this server.`})]}),(0,L.jsx)(Mo,{checked:j,onCheckedChange:se,disabled:!d})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Username`}),(0,L.jsx)(J,{value:ce,disabled:!d,onChange:e=>le(e.target.value),placeholder:`user`})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Password`}),(0,L.jsx)(J,{value:ue,disabled:!d,onChange:e=>de(e.target.value),placeholder:`password`,type:`password`})]})]}),(0,L.jsx)(`div`,{className:`flex justify-end`,children:(0,L.jsx)(R,{type:`button`,disabled:!d||Se.isPending||!oe.trim(),onClick:()=>Se.mutate(),children:Se.isPending?`Saving…`:`Add EVE-NG server`})})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,L.jsxs)(`div`,{children:[(0,L.jsx)(q,{children:`External template repos`}),(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Repos are either`,` `,(0,L.jsx)(`span`,{className:`font-mono`,children:`owner/repo`}),` (Gitea) or a git URL (https://… or git@host:repo.git). Used by the deployment UI when Template source is set to External repo.`]})]}),(0,L.jsx)(R,{type:`button`,variant:`outline`,size:`sm`,disabled:!d,onClick:()=>x(e=>[...e,{id:`repo-${e.length+1}`,name:`Repo ${e.length+1}`,repo:``,defaultBranch:``}]),children:`Add repo`})]}),(0,L.jsx)(`div`,{className:`space-y-3`,children:b.length===0?(0,L.jsx)(`div`,{className:`rounded-md border bg-muted/30 p-3 text-sm text-muted-foreground`,children:`No external repos configured.`}):b.map((e,t)=>(0,L.jsxs)(`div`,{className:`rounded-md border p-3 space-y-3`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,L.jsxs)(`div`,{className:`text-sm font-medium`,children:[`Repo `,t+1]}),(0,L.jsx)(R,{type:`button`,variant:`ghost`,size:`sm`,disabled:!d,onClick:()=>x(e=>e.filter((e,n)=>n!==t)),children:`Remove`})]}),(0,L.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`ID`}),(0,L.jsx)(J,{value:e.id,disabled:!d,onChange:e=>x(n=>n.map((n,r)=>r===t?{...n,id:e.target.value}:n)),placeholder:`my-repo`})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Name`}),(0,L.jsx)(J,{value:e.name,disabled:!d,onChange:e=>x(n=>n.map((n,r)=>r===t?{...n,name:e.target.value}:n)),placeholder:`My templates`})]}),(0,L.jsxs)(`div`,{className:`space-y-1 md:col-span-2`,children:[(0,L.jsx)(q,{children:`Repo`}),(0,L.jsx)(J,{value:e.repo,disabled:!d,onChange:e=>x(n=>n.map((n,r)=>r===t?{...n,repo:e.target.value}:n)),placeholder:`owner/repo`})]}),(0,L.jsxs)(`div`,{className:`space-y-1 md:col-span-2`,children:[(0,L.jsx)(q,{children:`Default branch`}),(0,L.jsx)(J,{value:e.defaultBranch??``,disabled:!d,onChange:e=>x(n=>n.map((n,r)=>r===t?{...n,defaultBranch:e.target.value}:n)),placeholder:`main`})]})]})]},`${e.id}-${t}`))})]}),(0,L.jsxs)(`div`,{className:`rounded-md border p-3 space-y-3`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,L.jsxs)(`div`,{children:[(0,L.jsx)(`div`,{className:`text-sm font-medium`,children:`Git credentials (your user)`}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Use this deploy key for SSH-based repos and an HTTPS token for https:// clones.`})]}),(0,L.jsxs)(`div`,{className:`flex gap-2`,children:[(0,L.jsx)(R,{type:`button`,variant:`outline`,size:`sm`,disabled:he.isPending||pe.isLoading,onClick:()=>he.mutate(),children:`Rotate key`}),(0,L.jsx)(R,{type:`button`,variant:`outline`,size:`sm`,disabled:!pe.data?.sshPublicKey,onClick:async()=>{let e=pe.data?.sshPublicKey??``;try{await navigator.clipboard.writeText(e),P.success(`Copied public key`)}catch{P.error(`Failed to copy`)}},children:`Copy public key`})]})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`SSH deploy key (public)`}),(0,L.jsx)(Os,{readOnly:!0,value:pe.data?.sshPublicKey??``,placeholder:`Loading…`})]}),(0,L.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`HTTPS username`}),(0,L.jsx)(J,{value:w,disabled:me.isPending,onChange:e=>T(e.target.value),placeholder:`username`})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`HTTPS token`}),(0,L.jsx)(J,{value:E,disabled:me.isPending,onChange:e=>D(e.target.value),placeholder:`token`,type:`password`})]})]}),(0,L.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[(0,L.jsx)(R,{type:`button`,variant:`secondary`,disabled:me.isPending||pe.isLoading||!pe.data?.hasHttpsToken,onClick:()=>me.mutate({httpsUsername:w,clearToken:!0}),children:`Clear token`}),(0,L.jsx)(R,{type:`button`,disabled:me.isPending||pe.isLoading,onClick:()=>me.mutate({httpsUsername:w,httpsToken:E}),children:`Save git credentials`})]})]}),(0,L.jsx)(`div`,{className:`flex justify-end`,children:(0,L.jsx)(R,{variant:`default`,disabled:!d||_e.isPending,onClick:()=>{let e=b.map(e=>({id:String(e.id??``).trim(),name:String(e.name??``).trim(),repo:String(e.repo??``).trim(),defaultBranch:String(e.defaultBranch??``).trim()||void 0})).filter(e=>e.id&&e.name&&e.repo);if(e.some(e=>!e.id||!e.name||!e.repo)){P.error(`External repos must include id, name, and repo`);return}_e.mutate({externalTemplateRepos:e})},children:_e.isPending?`Saving…`:`Save settings`})})]})]})}),f&&(0,L.jsx)(Ho,{value:`danger`,className:`space-y-6`,children:(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Delete workspace`}),(0,L.jsx)(U,{children:`Deletes the workspace and backing resources. This cannot be undone.`})]}),(0,L.jsxs)(W,{className:`space-y-4`,children:[(0,L.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Type `,(0,L.jsx)(`span`,{className:`font-mono`,children:l.slug}),` to confirm.`]}),(0,L.jsx)(J,{value:S,onChange:e=>C(e.target.value),placeholder:l.slug}),(0,L.jsx)(`div`,{className:`flex justify-end`,children:(0,L.jsx)(R,{variant:`destructive`,disabled:fe.isPending||S.trim().toLowerCase()!==l.slug.toLowerCase(),onClick:()=>fe.mutate(),children:fe.isPending?`Deleting…`:`Delete workspace`})})]})]})})]})]}):(0,L.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Workspace not found.`}),(0,L.jsx)(R,{variant:`outline`,onClick:()=>t({to:`/dashboard/workspaces`}),children:`Back`})]})}function Xs(e,t){let n=c(),r=(0,F.useMemo)(()=>`${Dr}/runs/${encodeURIComponent(e)}/events`,[e]);(0,F.useEffect)(()=>{if(!t||!e)return;let i=Ua(r,{output:t=>{try{console.log(`Run event:`,t.data);let r=JSON.parse(t.data);if(!r||!Array.isArray(r.entries))return;n.setQueryData(G.runLogs(e),e=>{let t=(e?.entries??[]).concat(r.entries);return{cursor:Number(r.cursor??e?.cursor??0),entries:t}})}catch{}}});return()=>{i.close()}},[t,n,e,r])}const Zs=t(`/dashboard/runs/$runId`)({component:Qs});function Qs(){let{runId:e}=Zs.useParams();Xs(e,!0);let t=c(),r=n(),a=i({queryKey:G.dashboardSnapshot(),queryFn:Nr,initialData:()=>t.getQueryData(G.dashboardSnapshot())??null,retry:!1,staleTime:1/0}),o=(a.data?.runs??[]).find(t=>String(t.id??``)===e),s=String(o?.status??``).toLowerCase(),l=s===`queued`||s===`running`,u=i({queryKey:G.runLogs(e),queryFn:async()=>({cursor:0,entries:[]}),retry:!1,staleTime:1/0}),d=Or(window.location.pathname+window.location.search);return(0,L.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,L.jsx)(B,{variant:`glass`,children:(0,L.jsx)(V,{children:(0,L.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,L.jsx)(`div`,{children:(0,L.jsxs)(H,{children:[`Run `,e]})}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(p,{className:mr({variant:`outline`,size:`sm`}),to:`/dashboard/deployments`,children:`Back`}),(0,L.jsx)(R,{variant:`destructive`,size:`sm`,disabled:!o||!l,onClick:()=>{if(!o)return;let n=String(o.workspaceId??``);if(!n){P.error(`Cannot cancel run`,{description:`Missing workspace ID.`});return}(async()=>{try{await la(e,n),P.success(`Run canceled`),await t.invalidateQueries({queryKey:G.dashboardSnapshot()}),r({to:`/dashboard/deployments`,search:{workspace:n}})}catch(e){P.error(`Cancel failed`,{description:e.message})}})()},children:`Cancel`}),(0,L.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>t.setQueryData(G.runLogs(e),{cursor:0,entries:[]}),children:`Clear`})]})]})})}),!a.data&&(0,L.jsx)(B,{className:`border-dashed`,children:(0,L.jsxs)(W,{className:`pt-6 text-center text-muted-foreground`,children:[`Loading dashboard…`,(0,L.jsxs)(`div`,{className:`mt-2 text-xs`,children:[`If you are logged out,`,` `,(0,L.jsx)(`a`,{className:`text-primary underline hover:no-underline`,href:d,onClick:e=>{e.preventDefault(),(async()=>{if(!await La({loginHref:d})){window.location.href=d;return}await t.invalidateQueries({queryKey:G.session()})})()},children:`login`}),`.`]})]})}),(0,L.jsxs)(B,{children:[(0,L.jsx)(V,{children:(0,L.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,L.jsx)(H,{children:`Metadata`}),(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Cursor: `,String(u.data?.cursor??0)]})]})}),(0,L.jsx)(W,{children:(0,L.jsxs)(`div`,{className:`grid grid-cols-1 gap-4 md:grid-cols-3`,children:[(0,L.jsx)($s,{label:`Type`,value:String(o?.tpl_alias??``)}),(0,L.jsx)($s,{label:`Status`,value:String(o?.status??``)}),(0,L.jsx)($s,{label:`Workspace`,value:String(o?.workspaceId??``)}),(0,L.jsx)($s,{label:`Created`,value:String(o?.created??``)}),(0,L.jsx)($s,{label:`Started`,value:String(o?.start??``)}),(0,L.jsx)($s,{label:`Finished`,value:String(o?.end??``)})]})})]}),(0,L.jsxs)(B,{children:[(0,L.jsx)(V,{children:(0,L.jsx)(H,{children:`Output`})}),(0,L.jsx)(W,{children:(0,L.jsx)(`div`,{className:`rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100`,children:(0,L.jsx)(ec,{entries:u.data?.entries??[]})})})]})]})}function $s(e){return(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(`div`,{className:`text-[11px] uppercase tracking-wide text-muted-foreground`,children:e.label}),(0,L.jsx)(`div`,{className:`break-all font-medium text-sm`,children:e.value||`—`})]})}function ec(e){let t=(0,F.useRef)(null);return(0,F.useEffect)(()=>{let e=t.current;e&&(e.scrollTop=e.scrollHeight)},[e.entries.length]),e.entries.length===0?(0,L.jsx)(`div`,{className:`text-zinc-500`,children:`Waiting for output…`}):(0,L.jsx)(`div`,{ref:t,className:`max-h-[65vh] overflow-auto whitespace-pre-wrap`,children:e.entries.map((e,t)=>(0,L.jsxs)(`div`,{children:[(0,L.jsx)(`span`,{className:`text-zinc-500 select-none`,children:e.time?`${e.time} `:``}),(0,L.jsx)(`span`,{children:e.output})]},`${e.time}-${t}`))})}function tc({workspaceId:e,deploymentId:t,nodeId:n,nodeKind:r,nodeIp:a,onClose:o,className:s}){let c=(0,F.useMemo)(()=>{let e=[n];return r&&e.push(String(r)),e.join(` • `)},[n,r]),l=i({queryKey:[`deploymentNodeDescribe`,e,t,n],enabled:!!e&&!!t&&!!n,queryFn:async()=>li(e,t,n),refetchOnWindowFocus:!1,retry:1});return(0,L.jsxs)(`div`,{className:`flex flex-col h-full w-full ${s??``}`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-2 p-2 border-b bg-muted/40 text-xs`,children:[(0,L.jsxs)(`div`,{className:`truncate flex items-center gap-2`,children:[(0,L.jsx)(`span`,{className:`font-mono font-medium`,children:c}),a?(0,L.jsx)(`span`,{className:`font-mono text-muted-foreground`,children:a}):null]}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsxs)(R,{variant:`outline`,size:`sm`,className:`h-7`,onClick:()=>l.refetch(),disabled:l.isFetching,children:[(0,L.jsx)(tt,{className:l.isFetching?`mr-2 h-3 w-3 animate-spin`:`mr-2 h-3 w-3`}),`Refresh`]}),o?(0,L.jsx)(R,{variant:`ghost`,size:`sm`,className:`h-7`,onClick:o,children:`Close`}):null]})]}),(0,L.jsx)(`div`,{className:`flex-1 overflow-auto bg-muted/10 p-4`,children:(0,L.jsx)(`pre`,{className:`text-xs font-mono whitespace-pre-wrap`,children:l.isLoading?`Loading…`:l.isError?`Failed to load node status: ${String(l.error)}`:JSON.stringify(l.data??{},null,2)})})]})}function nc({open:e,onOpenChange:t,workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,nodeIp:o}){return(0,L.jsx)(Kn,{open:e,onOpenChange:t,children:(0,L.jsxs)(Yn,{className:`max-w-5xl h-[70vh] flex flex-col p-0 gap-0 overflow-hidden`,children:[(0,L.jsx)(Xn,{className:`px-6 py-4 border-b`,children:(0,L.jsxs)(Qn,{className:`flex items-center gap-2`,children:[(0,L.jsx)(w,{className:`h-4 w-4`}),`Node status`]})}),(0,L.jsx)(`div`,{className:`flex-1 min-h-0`,children:e?(0,L.jsx)(tc,{workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,nodeIp:o,onClose:()=>t(!1)}):null})]})})}function rc({workspaceId:e,deploymentId:t,nodeId:n,nodeKind:r,nodeIp:a,onClose:o,className:s}){let c=(0,F.useMemo)(()=>{let e=[n];return r&&e.push(String(r)),e.join(` • `)},[n,r]),l=i({queryKey:[`deploymentNodeLogs`,e,t,n,400],enabled:!!e&&!!t&&!!n,queryFn:async()=>ci(e,t,n,{tail:400,container:n}),refetchOnWindowFocus:!1,retry:1});return(0,L.jsxs)(`div`,{className:`flex flex-col h-full w-full ${s??``}`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-2 p-2 border-b bg-muted/40 text-xs`,children:[(0,L.jsxs)(`div`,{className:`truncate flex items-center gap-2`,children:[(0,L.jsx)(`span`,{className:`font-mono font-medium`,children:c}),a?(0,L.jsx)(`span`,{className:`font-mono text-muted-foreground`,children:a}):null,l.data?.namespace&&l.data?.podName?(0,L.jsxs)(`span`,{className:`text-muted-foreground`,children:[l.data.namespace,`/`,l.data.podName]}):null]}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsxs)(R,{variant:`outline`,size:`sm`,className:`h-7`,onClick:()=>l.refetch(),disabled:l.isFetching,children:[(0,L.jsx)(tt,{className:l.isFetching?`mr-2 h-3 w-3 animate-spin`:`mr-2 h-3 w-3`}),`Refresh`]}),o?(0,L.jsx)(R,{variant:`ghost`,size:`sm`,className:`h-7`,onClick:o,children:`Close`}):null]})]}),(0,L.jsx)(`div`,{className:`flex-1 overflow-auto bg-muted/10 p-4`,children:(0,L.jsx)(`pre`,{className:`text-xs font-mono whitespace-pre-wrap`,children:l.isLoading?`Loading…`:l.isError?`Failed to load logs: ${String(l.error)}`:l.data?.logs||``})})]})}function ic({open:e,onOpenChange:t,workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,nodeIp:o}){return(0,L.jsx)(Kn,{open:e,onOpenChange:t,children:(0,L.jsxs)(Yn,{className:`max-w-5xl h-[70vh] flex flex-col p-0 gap-0 overflow-hidden`,children:[(0,L.jsx)(Xn,{className:`px-6 py-4 border-b`,children:(0,L.jsxs)(Qn,{className:`flex items-center gap-2`,children:[(0,L.jsx)(w,{className:`h-4 w-4`}),`Node logs`]})}),(0,L.jsx)(`div`,{className:`flex-1 min-h-0`,children:e?(0,L.jsx)(rc,{workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,nodeIp:o,onClose:()=>t(!1)}):null})]})})}var ac=Rn(),oc=Hn();function sc({workspaceId:e,deploymentId:t,nodeId:n,nodeKind:r,onClose:i,className:a}){let o=(0,F.useRef)(null),s=(0,F.useRef)(null),c=(0,F.useRef)(null),l=(0,F.useRef)(null),[u,d]=(0,F.useState)(`disconnected`),f=(0,F.useMemo)(()=>{let e=String(r??``).toLowerCase();return e.includes(`eos`)||e.includes(`ceos`)?`Cli`:`sh`},[r]),p=(0,F.useMemo)(()=>{if(!e||!t||!n)return``;let r=`${window.location.protocol===`https:`?`wss`:`ws`}://${window.location.host}/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/terminal/ws`,i=new URLSearchParams;return i.set(`node`,n),i.set(`command`,f),`${r}?${i.toString()}`},[f,t,n,e]);return(0,F.useEffect)(()=>{if(!o.current||!p)return;let e=new oc.Terminal({convertEol:!0,cursorBlink:!0,fontFamily:`ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace`,fontSize:12,theme:{background:`#09090b`}}),t=new ac.FitAddon;e.loadAddon(t),e.open(o.current),t.fit(),e.writeln(`\x1B[1mSkyforge Terminal\x1B[0m`),e.writeln(`Node: ${n}  Command: ${f}`),e.writeln(``),s.current=e,c.current=t;let r=new WebSocket(p);l.current=r,d(`connecting`);let i=()=>{let e=s.current;if(!e)return;let t=e.cols??80,n=e.rows??24;try{r.send(JSON.stringify({type:`resize`,cols:t,rows:n}))}catch{}};r.onopen=()=>{d(`connected`),i(),e.focus()},r.onmessage=t=>{let n=null;try{n=JSON.parse(String(t.data))}catch{e.write(String(t.data));return}if(n){if(n.type===`output`){e.write(n.data??``);return}if(n.type===`info`){e.writeln(`\r\n[info] ${n.data??``}`);return}if(n.type===`error`){e.writeln(`\r\n[error] ${n.data??``}`);return}}},r.onclose=t=>{d(`closed`);let n=typeof t.code==`number`?t.code:0,r=t.reason?` ${t.reason}`:``;e.writeln(`\r\n[disconnected]${n?` (code ${n})`:``}${r}`)},r.onerror=()=>{d(`error`),e.writeln(`\r
[error] websocket error (check browser console/network)`)};let a=e.onData(e=>{try{r.send(JSON.stringify({type:`stdin`,data:e}))}catch{}}),u=()=>{t.fit(),i()};return window.addEventListener(`resize`,u),()=>{window.removeEventListener(`resize`,u),a.dispose();try{r.close()}catch{}l.current=null,e.dispose(),s.current=null,c.current=null,d(`disconnected`)}},[f,n,p]),(0,L.jsxs)(`div`,{className:`flex flex-col h-full w-full ${a??``}`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-2 p-2 text-xs text-muted-foreground bg-zinc-900 border-b border-zinc-800`,children:[(0,L.jsxs)(`div`,{className:`truncate`,children:[(0,L.jsx)(`span`,{className:`font-mono text-zinc-300`,children:n}),(0,L.jsx)(`span`,{className:`mx-2 text-zinc-600`,children:`/`}),(0,L.jsx)(`span`,{children:u})]}),i?(0,L.jsx)(R,{variant:`ghost`,size:`sm`,className:`h-6 px-2 text-xs`,onClick:()=>{let e=l.current;if(e&&e.readyState===WebSocket.OPEN)try{e.close()}catch{}i()},children:`Close`}):null]}),(0,L.jsx)(`div`,{className:`flex-1 bg-zinc-950 p-2 min-h-0`,children:(0,L.jsx)(`div`,{ref:o,className:`h-full w-full`})})]})}function cc({open:e,onOpenChange:t,workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a}){let o=`${n}-${r}-${i}-${e}`;return(0,L.jsx)(Kn,{open:e,onOpenChange:t,children:(0,L.jsxs)(Yn,{className:`max-w-5xl h-[70vh] flex flex-col p-0 gap-0 overflow-hidden`,children:[(0,L.jsx)(Xn,{className:`px-6 py-4 border-b`,children:(0,L.jsxs)(Qn,{className:`flex items-center gap-2`,children:[(0,L.jsx)(w,{className:`h-4 w-4`}),`Terminal`]})}),(0,L.jsx)(`div`,{className:`flex-1 min-h-0`,children:e?(0,L.jsx)(sc,{workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,onClose:()=>t(!1)},o):null})]})})}function lc(){return{downloadImage:(0,F.useCallback)((e,t)=>{e&&Bn(e,{cacheBust:!0,backgroundColor:`#18181b`}).then(e=>{let n=document.createElement(`a`);n.download=t,n.href=e,n.click()}).catch(e=>{console.error(`Failed to download image`,e)})},[])}}function uc(e,t,n){let r=c(),i=(0,F.useMemo)(()=>`${Dr}/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/ui-events/events`,[t,e]);(0,F.useEffect)(()=>{if(!n||!e||!t)return;let a=n=>{try{let i=JSON.parse(n.data);if(!i||!Array.isArray(i.events))return;r.setQueryData(G.deploymentUIEvents(e,t),e=>{let t=(e?.events??[]).concat(i.events),n=t.slice(Math.max(0,t.length-300));return{cursor:Number(i.cursor??e?.cursor??0),events:n}})}catch{}},o=Ua(i,{"ui-events":a});return()=>o.close()},[t,n,r,i,e])}var dc={custom:({data:e})=>{let t=e.icon===`switch`?sn:e.icon===`cloud`?De:e.icon===`client`?Tt:ye,n=e.status===`running`?`default`:e.status===`stopped`?`secondary`:`destructive`,r=!!e?.highlight,i=String(e?.vendor??``);return(0,L.jsxs)(B,{className:`min-w-[180px] border-2 shadow-md ${r?`border-primary ring-2 ring-primary/30`:``}`,children:[(0,L.jsx)(V,{className:`p-3 pb-2`,children:(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(({vendor:e})=>{let t=String(e).toLowerCase();return t===`cisco`?(0,L.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center`,title:`Cisco`,style:{background:`rgba(0, 142, 204, 0.15)`,color:`rgb(0, 142, 204)`},children:(0,L.jsx)(`svg`,{viewBox:`0 0 24 24`,width:`16`,height:`16`,"aria-hidden":`true`,children:[{x:4,h:8},{x:7,h:10},{x:10,h:12},{x:13,h:10},{x:16,h:8}].map(e=>(0,L.jsx)(`rect`,{x:e.x,y:14-e.h,width:`2`,height:e.h,rx:`1`,fill:`currentColor`},e.x))})}):t===`arista`?(0,L.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center`,title:`Arista`,style:{background:`rgba(232, 43, 44, 0.14)`,color:`rgb(232, 43, 44)`},children:(0,L.jsx)(`svg`,{viewBox:`0 0 24 24`,width:`16`,height:`16`,"aria-hidden":`true`,children:(0,L.jsx)(`path`,{d:`M12 3 4.5 21h3.6l1.6-4h4.6l1.6 4h3.6L12 3zm-1 11 1-2.6 1 2.6h-2z`,fill:`currentColor`})})}):t===`linux`?(0,L.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center`,title:`Linux`,style:{background:`rgba(34, 197, 94, 0.12)`,color:`rgb(34, 197, 94)`},children:(0,L.jsxs)(`svg`,{viewBox:`0 0 24 24`,width:`16`,height:`16`,"aria-hidden":`true`,children:[(0,L.jsx)(`circle`,{cx:`12`,cy:`9`,r:`4`,fill:`#111827`}),(0,L.jsx)(`ellipse`,{cx:`12`,cy:`16`,rx:`5`,ry:`6`,fill:`#111827`}),(0,L.jsx)(`ellipse`,{cx:`12`,cy:`17`,rx:`3.3`,ry:`4.2`,fill:`#ffffff`}),(0,L.jsx)(`path`,{d:`M12 10l2 1-2 1-2-1 2-1z`,fill:`#f59e0b`})]})}):(0,L.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center bg-muted text-[11px] font-bold`,title:`Unknown`,children:`?`})},{vendor:i}),(0,L.jsx)(`div`,{className:`p-1.5 bg-muted rounded-md`,title:String(e?.kind??``),children:(0,L.jsx)(t,{className:`w-4 h-4`})})]}),(0,L.jsx)(ao,{variant:n,className:`text-[10px] h-5`,children:String(e.status)})]})}),(0,L.jsxs)(W,{className:`p-3 pt-0`,children:[(0,L.jsx)(H,{className:`text-sm font-bold truncate`,children:String(e.label)}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground mt-1 truncate font-mono`,children:String(e.ip||`10.0.0.x`)}),(0,L.jsx)(ln,{type:`target`,position:$t.Top,className:`!bg-muted-foreground`}),(0,L.jsx)(ln,{type:`source`,position:$t.Bottom,className:`!bg-muted-foreground`})]})]})}};function fc({topology:e,workspaceId:t,deploymentId:n,enableTerminal:a,fullHeight:o,className:s}){let c=(0,F.useCallback)(e=>{let t=String(e??``).toLowerCase();return t?t.includes(`arista`)||t.includes(`eos`)||t.includes(`ceos`)||t.includes(`veos`)?`arista`:t.includes(`cisco`)||t.includes(`ios`)||t.includes(`nxos`)||t.includes(`csr`)||t.includes(`c8k`)||t.includes(`iosxr`)?`cisco`:t.includes(`linux`)||t.includes(`ubuntu`)||t.includes(`debian`)||t.includes(`alpine`)||t.includes(`rocky`)||t.includes(`centos`)?`linux`:`unknown`:`unknown`},[]),l=(0,F.useMemo)(()=>{if(!e||!Array.isArray(e.nodes)||e.nodes.length===0)return{nodes:[],edges:[]};let t=Math.max(1,Math.ceil(Math.sqrt(e.nodes.length)));return{nodes:e.nodes.map((e,n)=>{let r=n%t,i=Math.floor(n/t),a=String(e.kind??``),o=c(a),s=o===`linux`?`client`:o===`arista`||o===`cisco`?`switch`:`server`,l=String(e.status??`unknown`),u=String(e.pingIp??e.mgmtIp??``),d=String(e.mgmtHost??``);return{id:String(e.id),position:{x:r*240,y:i*160},data:{label:String(e.label??e.id),icon:s,status:l,ip:u,mgmtHost:d,kind:a,vendor:o},type:`custom`}}),edges:(e.edges??[]).map(e=>({id:String(e.id),source:String(e.source),target:String(e.target),label:e.label?String(e.label):void 0,animated:!1}))}},[e,c]),[u,d,f]=wt(l.nodes),[p,m,h]=yt(l.edges),g=(0,F.useRef)(null),{downloadImage:_}=lc(),[v,y]=(0,F.useState)(null),[b,x]=(0,F.useState)(null),[S,C]=(0,F.useState)(null),[w,T]=(0,F.useState)(null),[E,D]=(0,F.useState)(null),[O,k]=(0,F.useState)(null),[te,ne]=(0,F.useState)(!1),[re,ie]=(0,F.useState)(!1),[ae,oe]=(0,F.useState)(!1),[A,j]=(0,F.useState)(null),[se,ce]=(0,F.useState)({}),le=(0,F.useRef)(null),ue=(0,F.useRef)({}),de=(0,F.useRef)(!1),[fe,pe]=(0,F.useState)(``),[me,ge]=(0,F.useState)(`grid`),_e=(0,F.useMemo)(()=>!t||!n?``:`skyforge.topology.positions.${t}.${n}`,[n,t]),[ve,ye]=(0,F.useState)(()=>({})),[be,xe]=(0,F.useState)(null),[Se,Ce]=(0,F.useState)(!1),[we,Te]=(0,F.useState)(null),[Ee,De]=(0,F.useState)(!1),[Oe,ke]=(0,F.useState)(!1),[Ae,je]=(0,F.useState)(null),[M,Me]=(0,F.useState)({side:`source`,duration:`10`,packets:`2500`,snaplen:`192`}),[Ne,Pe]=(0,F.useState)(!1),[Fe,Ie]=(0,F.useState)(null),[N,Le]=(0,F.useState)({delayMs:``,jitterMs:``,lossPct:``,dupPct:``,corruptPct:``,reorderPct:``,rateKbps:``});(0,F.useEffect)(()=>{if(_e)try{let e=window.localStorage.getItem(_e);if(!e)return;let t=JSON.parse(e);t&&typeof t==`object`&&ye(t)}catch{}},[_e]);let Re=!!(t&&n);uc(t??``,n??``,Re);let ze=i({queryKey:t&&n?G.deploymentUIEvents(t,n):[`deploymentUIEvents`,`none`],queryFn:async()=>({cursor:0,events:[]}),initialData:{cursor:0,events:[]},staleTime:1/0,enabled:Re}),Be=(0,F.useMemo)(()=>hc(ze.data?.events??[]),[ze.data?.events]);(0,F.useEffect)(()=>{d(_c(l.nodes,me,ve,fe)),ue.current=Object.fromEntries(l.edges.map(e=>[String(e.id),typeof e.label==`string`?e.label:void 0])),m(gc(l.edges,se,ae,ue.current,Be))},[l.edges,l.nodes,Be,se,me,ve,fe,m,d,ae]),(0,F.useEffect)(()=>{m(e=>gc(e,se,ae,ue.current,Be))},[Be,se,m,ae]),(0,F.useEffect)(()=>{if(!t||!n||de.current)return;let e=new URLSearchParams(window.location.search),r=e.get(`node`)?.trim(),i=e.get(`action`)?.trim();if(!r||!i){de.current=!0;return}i===`terminal`&&y({id:r}),i===`logs`&&x({id:r}),i===`describe`&&C({id:r}),i===`interfaces`&&(xe({id:r}),Ce(!0)),i===`running-config`&&(Te({id:r}),De(!0)),de.current=!0,e.delete(`node`),e.delete(`action`);let a=e.toString(),o=`${window.location.pathname}${a?`?${a}`:``}${window.location.hash||``}`;window.history.replaceState(null,``,o)},[n,t]),(0,F.useEffect)(()=>{if(!w)return;let e=()=>T(null),t=e=>{e.key===`Escape`&&T(null)};return window.addEventListener(`click`,e),window.addEventListener(`keydown`,t),()=>{window.removeEventListener(`click`,e),window.removeEventListener(`keydown`,t)}},[w]);let Ve=r({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return ui(t,n,e)},onSuccess:(e,t)=>{if(e?.skipped){P.message(`Save config skipped`,{description:e.message||`Node ${t}`});return}P.success(`Save config queued/applied`,{description:e.stdout||`Node ${t}`})},onError:e=>{P.error(`Save config failed`,{description:e?.message??String(e)})}}),He=r({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return ri(t,n,e)},onSuccess:e=>{let t=e.results.filter(e=>e.error);if(t.length){P.error(`Link admin applied with errors`,{description:t.map(e=>`${e.node}: ${e.error}`).join(`; `)});return}P.success(`Link ${e.action} applied`)},onError:e=>P.error(`Link admin failed`,{description:e?.message??String(e)})}),Ue=r({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return ii(t,n,e)},onSuccess:e=>{P.success(`Pcap captured`,{description:`${e.sizeBytes} bytes • ${e.artifactKey}`})},onError:e=>P.error(`Pcap capture failed`,{description:e?.message??String(e)})}),We=r({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return ai(t,n,e)},onError:e=>P.error(`Failed to load interfaces`,{description:e?.message??String(e)})}),Ge=r({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return oi(t,n,e)},onError:e=>P.error(`Failed to load running config`,{description:e?.message??String(e)})}),Ke=(0,F.useCallback)(async e=>{if(!t)return;let n=await Ii(t,e),r=String(n?.fileData??``);if(!r)throw Error(`missing fileData`);let i=Uint8Array.from(atob(r),e=>e.charCodeAt(0)),a=new Blob([i],{type:`application/vnd.tcpdump.pcap`}),o=URL.createObjectURL(a),s=document.createElement(`a`);s.href=o,s.download=e.split(`/`).pop()||`capture.pcap`,s.click(),URL.revokeObjectURL(o)},[t]),qe=(0,F.useCallback)(async()=>{if(!t||!n)return;let e=await si(t,n,`csv`),r=String(e.csv??``);if(!r.trim())throw Error(`empty inventory csv`);let i=new Blob([r],{type:`text/csv`}),a=URL.createObjectURL(i),o=document.createElement(`a`);o.href=a,o.download=`${n}-inventory.csv`,o.click(),URL.revokeObjectURL(a)},[n,t]);(0,F.useEffect)(()=>{if(!E)return;let e=()=>D(null),t=e=>{e.key===`Escape`&&D(null)};return window.addEventListener(`click`,e),window.addEventListener(`keydown`,t),()=>{window.removeEventListener(`click`,e),window.removeEventListener(`keydown`,t)}},[E]),(0,F.useEffect)(()=>{Se&&be?.id&&We.mutate(be.id)},[We,be?.id,Se]),(0,F.useEffect)(()=>{if(!Se||!Ne||!be?.id)return;let e=window.setInterval(()=>{We.mutate(be.id)},2e3);return()=>window.clearInterval(e)},[We,Ne,be?.id,Se]),(0,F.useEffect)(()=>{Ee&&we?.id&&Ge.mutate(we.id)},[Ge,we?.id,Ee]);let Je=(0,F.useCallback)(e=>m(t=>Gt(e,t)),[m]),Ye=(0,F.useCallback)((e,r)=>{if(e.preventDefault(),!t||!n)return;let i=g.current?.getBoundingClientRect();D({x:i?e.clientX-i.left:e.clientX,y:i?e.clientY-i.top:e.clientY,node:r})},[n,t]),Xe=(0,F.useCallback)((e,r)=>{if(!t||!n)return;e.preventDefault();let i=g.current?.getBoundingClientRect();T({x:i?e.clientX-i.left:e.clientX,y:i?e.clientY-i.top:e.clientY,edge:r})},[n,t]),Ze=(0,F.useCallback)(async(e,r)=>{if(!(!t||!n))try{ie(!0);let i={edgeId:r,action:e};if(e===`set`){let e=N.delayMs.trim()?Number(N.delayMs.trim()):void 0,t=N.jitterMs.trim()?Number(N.jitterMs.trim()):void 0,n=N.lossPct.trim()?Number(N.lossPct.trim()):void 0,r=N.dupPct.trim()?Number(N.dupPct.trim()):void 0,a=N.corruptPct.trim()?Number(N.corruptPct.trim()):void 0,o=N.reorderPct.trim()?Number(N.reorderPct.trim()):void 0,s=N.rateKbps.trim()?Number(N.rateKbps.trim()):void 0;Number.isFinite(e)&&(i.delayMs=e),Number.isFinite(t)&&(i.jitterMs=t),Number.isFinite(n)&&(i.lossPct=n),Number.isFinite(r)&&(i.dupPct=r),Number.isFinite(a)&&(i.corruptPct=a),Number.isFinite(o)&&(i.reorderPct=o),Number.isFinite(s)&&(i.rateKbps=s)}let a=(await ni(t,n,i)).results.filter(e=>e.error);a.length?P.error(`Link impairment applied with errors`,{description:a.map(e=>`${e.node}: ${e.error}`).join(`; `)}):P.success(e===`clear`?`Link impairment cleared`:`Link impairment applied`)}catch(e){P.error(`Failed to apply link impairment`,{description:e?.message??String(e)})}finally{ie(!1)}},[n,N.corruptPct,N.delayMs,N.dupPct,N.jitterMs,N.lossPct,N.rateKbps,N.reorderPct,t]);return(0,F.useEffect)(()=>{if(!ae||!t||!n)return;j(null),le.current=null;let e=`/api/workspaces/${encodeURIComponent(t)}/deployments/${encodeURIComponent(n)}/links/stats/events`,r=new EventSource(e,{withCredentials:!0}),i=e=>{try{let t=JSON.parse(String(e.data??`{}`));if(t.type===`error`){j(t.error||`failed to stream link stats`);return}if(t.type!==`snapshot`||!t.snapshot)return;let n=t.snapshot,r=Date.parse(n.generatedAt||``);if(!Number.isFinite(r))return;let i={};for(let e of n.edges??[])i[String(e.edgeId)]=e;let a=le.current;if(le.current={atMs:r,byEdge:i},!a)return;let o=(r-a.atMs)/1e3;if(!(o>0))return;let s={};for(let[e,t]of Object.entries(i)){let n=a.byEdge[e];if(!n)continue;let r=(e,t)=>Math.max(0,e-t),i=r(t.sourceTxBytes,n.sourceTxBytes),c=r(t.sourceRxBytes,n.sourceRxBytes),l=r(t.targetTxBytes,n.targetTxBytes),u=r(t.targetRxBytes,n.targetRxBytes),d=Math.max(i,u)+Math.max(l,c),f=r(t.sourceTxPackets,n.sourceTxPackets),p=r(t.sourceRxPackets,n.sourceRxPackets),m=r(t.targetTxPackets,n.targetTxPackets),h=r(t.targetRxPackets,n.targetRxPackets),g=(Math.max(f,h)+Math.max(m,p))/o,_=(r(t.sourceRxDropped,n.sourceRxDropped)+r(t.sourceTxDropped,n.sourceTxDropped)+r(t.targetRxDropped,n.targetRxDropped)+r(t.targetTxDropped,n.targetTxDropped))/o;s[e]={bps:d*8/o,pps:g,drops:_}}ce(s)}catch(e){j(e?.message??String(e))}};return r.addEventListener(`stats`,i),r.onerror=()=>j(`link stats stream disconnected`),di(t,n).catch(()=>{}),()=>{r.removeEventListener(`stats`,i),r.close()}},[n,ae,t]),(0,L.jsxs)(`div`,{className:`w-full bg-background/50 overflow-hidden relative ${o?`h-full`:`h-[600px]`} border rounded-xl ${s??``}`,ref:g,children:[(0,L.jsxs)(hn,{nodes:u,edges:p,onNodesChange:f,onEdgesChange:h,onConnect:Je,onNodeContextMenu:Ye,onEdgeContextMenu:Xe,onEdgeMouseEnter:(e,t)=>{let n=g.current?.getBoundingClientRect(),r=n?e.clientX-n.left:e.clientX,i=n?e.clientY-n.top:e.clientY;Ie({id:String(t.id),x:r,y:i})},onEdgeMouseMove:e=>{if(!Fe)return;let t=g.current?.getBoundingClientRect(),n=t?e.clientX-t.left:e.clientX,r=t?e.clientY-t.top:e.clientY;Ie(e=>e?{...e,x:n,y:r}:null)},onEdgeMouseLeave:()=>Ie(null),onNodeDragStop:(e,t)=>{_e&&ye(e=>{let n={...e,[String(t.id)]:{x:t.position.x,y:t.position.y}};try{window.localStorage.setItem(_e,JSON.stringify(n))}catch{}return n})},nodeTypes:dc,fitView:!0,className:`bg-muted/10`,children:[(0,L.jsx)(Ht,{position:`top-right`,children:(0,L.jsxs)(B,{className:`shadow-sm border bg-background/85 backdrop-blur`,children:[(0,L.jsx)(V,{className:`p-3 pb-2`,children:(0,L.jsx)(H,{className:`text-sm`,children:`Tools`})}),(0,L.jsxs)(W,{className:`p-3 pt-0 space-y-2`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-2 rounded-md border bg-background/70 px-2 py-1`,children:[(0,L.jsx)(an,{className:`h-4 w-4 text-muted-foreground`}),(0,L.jsx)(J,{value:fe,onChange:e=>pe(e.target.value),placeholder:`Search nodes…`,className:`h-7 w-56 border-0 bg-transparent p-0 text-sm focus-visible:ring-0`}),fe.trim()?(0,L.jsx)(R,{variant:`ghost`,size:`sm`,className:`h-7 px-2`,onClick:()=>pe(``),children:`Clear`}):null]}),(0,L.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,L.jsxs)(R,{variant:ae?`default`:`outline`,size:`sm`,onClick:()=>{oe(e=>{let t=!e;return t||(j(null),ce({}),le.current=null),t})},disabled:!t||!n,title:`Show live link utilization (SSE)`,children:[(0,L.jsx)(he,{className:`mr-2 h-4 w-4`}),`Live stats`]}),(0,L.jsxs)(R,{variant:`outline`,size:`sm`,onClick:()=>ge(e=>e===`grid`?`circle`:`grid`),title:`Toggle layout`,children:[(0,L.jsx)(Ut,{className:`mr-2 h-4 w-4`}),me===`grid`?`Grid`:`Circle`]}),(0,L.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>{if(ye({}),_e)try{window.localStorage.removeItem(_e)}catch{}},title:`Reset pinned node positions`,children:`Reset`}),(0,L.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>qe().catch(e=>P.error(`Failed to download inventory`,{description:e.message})),disabled:!t||!n,title:`Download inventory CSV`,children:`Inventory`}),(0,L.jsxs)(R,{variant:`outline`,size:`sm`,onClick:()=>g.current&&_(g.current,`topology.png`),children:[(0,L.jsx)(ee,{className:`mr-2 h-4 w-4`}),`PNG`]})]}),(0,L.jsx)(`div`,{className:`text-[11px] text-muted-foreground`,children:`Tip: Right-click a node or link for actions.`})]})]})}),(0,L.jsx)(Xt,{}),(0,L.jsx)(gt,{zoomable:!0,pannable:!0,className:`bg-background border rounded-lg`}),(0,L.jsx)(ut,{gap:12,size:1})]}),ae&&A?(0,L.jsxs)(`div`,{className:`absolute bottom-2 left-2 z-40 rounded-md border bg-background/90 px-3 py-2 text-xs text-muted-foreground shadow-sm`,children:[`Live stats: `,A]}):null,Fe&&ae&&se[Fe.id]?(0,L.jsxs)(`div`,{className:`absolute z-40 rounded-md border bg-background/90 px-3 py-2 text-xs shadow-sm`,style:{left:Fe.x+12,top:Fe.y+12},children:[(0,L.jsx)(`div`,{className:`font-mono`,children:Fe.id}),(0,L.jsxs)(`div`,{className:`text-muted-foreground`,children:[pc(se[Fe.id].bps),` •`,` `,Math.round(se[Fe.id].pps),` pps •`,` `,se[Fe.id].drops.toFixed(1),` drops/s`]})]}):null,Re&&(ze.data?.events?.length??0)>0?(0,L.jsx)(`div`,{className:`absolute bottom-2 right-2 z-40 w-[420px] max-w-[92vw]`,children:(0,L.jsxs)(B,{className:`shadow-sm border bg-background/90 backdrop-blur`,children:[(0,L.jsx)(V,{className:`p-3 pb-2`,children:(0,L.jsx)(H,{className:`text-sm`,children:`Recent activity`})}),(0,L.jsx)(W,{className:`p-3 pt-0 space-y-2`,children:(ze.data?.events??[]).slice(-8).reverse().map(e=>(0,L.jsxs)(`div`,{className:`flex items-start justify-between gap-2 text-xs`,children:[(0,L.jsxs)(`div`,{className:`min-w-0`,children:[(0,L.jsx)(`div`,{className:`font-mono truncate`,children:e.eventType}),(0,L.jsx)(`div`,{className:`text-muted-foreground truncate`,children:e.createdAt})]}),(0,L.jsx)(`div`,{className:`text-muted-foreground font-mono truncate`,children:e.createdBy?e.createdBy:``})]},String(e.id)))})]})}):null,a&&t&&n?(0,L.jsx)(cc,{open:!!v,onOpenChange:e=>{e||y(null)},workspaceId:t,deploymentId:n,nodeId:v?.id??``,nodeKind:v?.kind??``}):null,t&&n?(0,L.jsx)(ic,{open:!!b,onOpenChange:e=>{e||x(null)},workspaceId:t,deploymentId:n,nodeId:b?.id??``,nodeKind:b?.kind??``,nodeIp:b?.ip??``}):null,t&&n?(0,L.jsx)(nc,{open:!!S,onOpenChange:e=>{e||C(null)},workspaceId:t,deploymentId:n,nodeId:S?.id??``,nodeKind:S?.kind??``,nodeIp:S?.ip??``}):null,(0,L.jsx)(Kn,{open:Se,onOpenChange:e=>{Ce(e),e||xe(null)},children:(0,L.jsxs)(Yn,{className:`max-w-3xl`,children:[(0,L.jsx)(Xn,{children:(0,L.jsx)(Qn,{children:`Interfaces`})}),(0,L.jsx)(vc,{node:be?.id??``,data:We.data,loading:We.isPending,error:We.isError?We.error?.message??`failed`:``,autoRefresh:Ne,onToggleAutoRefresh:()=>Pe(e=>!e)})]})}),(0,L.jsx)(Kn,{open:Ee,onOpenChange:e=>{De(e),e||Te(null)},children:(0,L.jsxs)(Yn,{className:`max-w-4xl`,children:[(0,L.jsx)(Xn,{children:(0,L.jsx)(Qn,{children:`Running config`})}),(0,L.jsx)(yc,{node:we?.id??``,data:Ge.data,loading:Ge.isPending,error:Ge.isError?Ge.error?.message??`failed`:``})]})}),E&&t&&n?(0,L.jsx)(`div`,{className:`absolute z-50`,style:{left:E.x,top:E.y},onContextMenu:e=>e.preventDefault(),children:(0,L.jsxs)(B,{className:`w-64 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,L.jsxs)(V,{className:`p-3 pb-2`,children:[(0,L.jsx)(H,{className:`text-sm`,children:`Node Actions`}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:String(E.node?.data?.label??E.node.id)})]}),(0,L.jsxs)(W,{className:`p-3 pt-0 space-y-2`,children:[(0,L.jsx)(R,{size:`sm`,className:`w-full`,disabled:!a,onClick:()=>{let e=String(E.node?.data?.kind??``);D(null),y({id:String(E.node.id),kind:e})},children:`Open terminal…`}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,disabled:!a,onClick:()=>{let e=String(E.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=terminal`;window.open(t,`_blank`,`noopener,noreferrer`),D(null)},children:`Open terminal (new tab)`}),(0,L.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(E.node?.data?.kind??``),t=String(E.node?.data?.ip??``);D(null),x({id:String(E.node.id),kind:e,ip:t})},children:`View logs…`}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(E.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=logs`;window.open(t,`_blank`,`noopener,noreferrer`),D(null)},children:`View logs (new tab)`}),(0,L.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(E.node?.data?.kind??``),t=String(E.node?.data?.ip??``);D(null),C({id:String(E.node.id),kind:e,ip:t})},children:`Describe…`}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(E.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=describe`;window.open(t,`_blank`,`noopener,noreferrer`),D(null)},children:`Describe (new tab)`}),(0,L.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(E.node?.data?.kind??``),t=String(E.node?.data?.ip??``),n=String(E.node.id);D(null),xe({id:n,kind:e,ip:t}),Ce(!0)},children:`Interfaces…`}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(E.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=interfaces`;window.open(t,`_blank`,`noopener,noreferrer`),D(null)},children:`Interfaces (new tab)`}),(0,L.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,disabled:Ve.isPending,onClick:()=>{let e=String(E.node.id);D(null),Ve.mutate(e)},children:Ve.isPending?`Saving…`:`Save config`}),(0,L.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(E.node.id);D(null),Te({id:e}),De(!0)},children:`Running config…`}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(E.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=running-config`;window.open(t,`_blank`,`noopener,noreferrer`),D(null)},children:`Running config (new tab)`}),(0,L.jsx)(R,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>{let e=String(E.node?.data?.ip??``).trim();if(!e){P.error(`No management IP available`);return}navigator.clipboard?.writeText(e),P.success(`Copied management IP`),D(null)},children:`Copy management IP`}),(0,L.jsx)(R,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>{let e=String(E.node.id);navigator.clipboard?.writeText(e),P.success(`Copied node name`),D(null)},children:`Copy node name`}),(0,L.jsx)(R,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>{let e=String(E.node?.data?.ip??``).trim();if(!e){P.error(`No management IP available`);return}let t=`ssh admin@${e}`;navigator.clipboard?.writeText(t),P.success(`Copied SSH command`),D(null)},children:`Copy SSH command`}),(0,L.jsx)(R,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>D(null),children:`Close`})]})]})}):null,w&&t&&n?(0,L.jsx)(`div`,{className:`absolute z-50`,style:{left:w.x,top:w.y},onContextMenu:e=>e.preventDefault(),children:(0,L.jsxs)(B,{className:`w-64 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,L.jsxs)(V,{className:`p-3 pb-2`,children:[(0,L.jsx)(H,{className:`text-sm`,children:`Link Actions`}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:String(w.edge.label??w.edge.id)})]}),(0,L.jsxs)(W,{className:`p-3 pt-0 space-y-2`,children:[(0,L.jsx)(R,{size:`sm`,variant:Be.edgeDown.has(String(w.edge.id))?`secondary`:`destructive`,className:`w-full`,disabled:He.isPending,onClick:()=>{let e=String(w.edge.id),t=Be.edgeDown.has(e);T(null),He.mutate({edgeId:e,action:t?`up`:`down`})},children:Be.edgeDown.has(String(w.edge.id))?`Bring link up`:`Bring link down`}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,disabled:Ue.isPending,onClick:()=>{je({id:String(w.edge.id),label:String(w.edge.label??``)}),T(null),ke(!0)},children:`Capture pcap…`}),Be.lastCaptureByEdge[String(w.edge.id)]?(0,L.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=Be.lastCaptureByEdge[String(w.edge.id)];T(null),Ke(e).catch(e=>P.error(`Failed to download pcap`,{description:e.message}))},children:`Download last pcap`}):null,(0,L.jsx)(R,{size:`sm`,className:`w-full`,onClick:()=>{k({id:String(w.edge.id),label:String(w.edge.label??``)}),T(null),ne(!0)},children:`Configure impairment…`}),(0,L.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,disabled:re,onClick:()=>{let e=String(w.edge.id);T(null),Ze(`clear`,e)},children:`Clear impairment`}),(0,L.jsx)(R,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>T(null),children:`Close`})]})]})}):null,(0,L.jsx)(Kn,{open:Oe,onOpenChange:e=>{ke(e),e||je(null)},children:(0,L.jsxs)(Yn,{className:`max-w-lg`,children:[(0,L.jsx)(Xn,{children:(0,L.jsx)(Qn,{children:`Capture pcap`})}),(0,L.jsxs)(`div`,{className:`space-y-4`,children:[Ae?.label?(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:Ae.label}):null,(0,L.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{htmlFor:`capSide`,children:`Side`}),(0,L.jsxs)(`select`,{id:`capSide`,className:`h-9 w-full rounded-md border bg-background px-3 text-sm`,value:M.side,onChange:e=>Me(t=>({...t,side:e.target.value})),children:[(0,L.jsx)(`option`,{value:`source`,children:`Source`}),(0,L.jsx)(`option`,{value:`target`,children:`Target`})]})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{htmlFor:`capDuration`,children:`Duration (s)`}),(0,L.jsx)(J,{id:`capDuration`,inputMode:`numeric`,value:M.duration,onChange:e=>Me(t=>({...t,duration:e.target.value}))})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{htmlFor:`capPackets`,children:`Max packets`}),(0,L.jsx)(J,{id:`capPackets`,inputMode:`numeric`,value:M.packets,onChange:e=>Me(t=>({...t,packets:e.target.value}))})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{htmlFor:`capSnaplen`,children:`Snaplen`}),(0,L.jsx)(J,{id:`capSnaplen`,inputMode:`numeric`,value:M.snaplen,onChange:e=>Me(t=>({...t,snaplen:e.target.value}))})]})]}),(0,L.jsxs)(`div`,{className:`flex gap-2 justify-end`,children:[(0,L.jsx)(R,{variant:`secondary`,onClick:()=>ke(!1),disabled:Ue.isPending,children:`Cancel`}),(0,L.jsx)(R,{onClick:()=>{let e=String(Ae?.id??``);if(!e){P.error(`No link selected`);return}let t=Number(M.duration.trim()||`10`),n=Number(M.packets.trim()||`2500`),r=Number(M.snaplen.trim()||`192`);Ue.mutateAsync({edgeId:e,side:M.side,durationSeconds:t,maxPackets:n,snaplen:r}).then(e=>(P.success(`Pcap ready`,{description:e.artifactKey}),Ke(e.artifactKey).catch(()=>{}))).finally(()=>ke(!1))},disabled:Ue.isPending,children:Ue.isPending?`Capturing…`:`Capture`})]})]})]})}),(0,L.jsx)(Kn,{open:te,onOpenChange:e=>{ne(e),e||k(null)},children:(0,L.jsxs)(Yn,{className:`max-w-lg`,children:[(0,L.jsx)(Xn,{children:(0,L.jsx)(Qn,{children:`Configure Link Impairment`})}),(0,L.jsxs)(`div`,{className:`space-y-4`,children:[O?.label?(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:O.label}):null,(0,L.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{htmlFor:`delayMs`,children:`Delay (ms)`}),(0,L.jsx)(J,{id:`delayMs`,inputMode:`numeric`,placeholder:`e.g. 50`,value:N.delayMs,onChange:e=>Le(t=>({...t,delayMs:e.target.value}))})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{htmlFor:`jitterMs`,children:`Jitter (ms)`}),(0,L.jsx)(J,{id:`jitterMs`,inputMode:`numeric`,placeholder:`e.g. 10`,value:N.jitterMs,onChange:e=>Le(t=>({...t,jitterMs:e.target.value}))})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{htmlFor:`lossPct`,children:`Loss (%)`}),(0,L.jsx)(J,{id:`lossPct`,inputMode:`decimal`,placeholder:`e.g. 1.0`,value:N.lossPct,onChange:e=>Le(t=>({...t,lossPct:e.target.value}))})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{htmlFor:`dupPct`,children:`Duplicate (%)`}),(0,L.jsx)(J,{id:`dupPct`,inputMode:`decimal`,placeholder:`e.g. 0.1`,value:N.dupPct,onChange:e=>Le(t=>({...t,dupPct:e.target.value}))})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{htmlFor:`corruptPct`,children:`Corrupt (%)`}),(0,L.jsx)(J,{id:`corruptPct`,inputMode:`decimal`,placeholder:`e.g. 0.05`,value:N.corruptPct,onChange:e=>Le(t=>({...t,corruptPct:e.target.value}))})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{htmlFor:`reorderPct`,children:`Reorder (%)`}),(0,L.jsx)(J,{id:`reorderPct`,inputMode:`decimal`,placeholder:`e.g. 0.2`,value:N.reorderPct,onChange:e=>Le(t=>({...t,reorderPct:e.target.value}))})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{htmlFor:`rateKbps`,children:`Rate (kbit/s)`}),(0,L.jsx)(J,{id:`rateKbps`,inputMode:`numeric`,placeholder:`e.g. 100000`,value:N.rateKbps,onChange:e=>Le(t=>({...t,rateKbps:e.target.value}))})]})]}),(0,L.jsxs)(`div`,{className:`flex gap-2 justify-end`,children:[(0,L.jsx)(R,{variant:`secondary`,onClick:()=>ne(!1),disabled:re,children:`Cancel`}),(0,L.jsx)(R,{onClick:()=>{let e=String(O?.id??``);if(!e){P.error(`No link selected`);return}Ze(`set`,e).finally(()=>ne(!1))},disabled:re,children:`Apply`})]})]}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Tip: Right-click a link in the topology to configure impairment.`})]})})]})}function pc(e){return e>0?e>=1e9?`${(e/1e9).toFixed(2)} Gbps`:e>=1e6?`${(e/1e6).toFixed(1)} Mbps`:e>=1e3?`${(e/1e3).toFixed(0)} Kbps`:`${Math.round(e)} bps`:`0 bps`}function mc(e){if(!Number.isFinite(e)||e<=0)return`0 B`;let t=[`B`,`KB`,`MB`,`GB`,`TB`],n=e,r=0;for(;n>=1024&&r<t.length-1;)n/=1024,r++;let i=r===0||r===1?0:1;return`${n.toFixed(i)} ${t[r]}`}function hc(e){let t=new Set,n={};for(let r of e??[]){let e=String(r?.eventType??``),i=r?.payload??{},a=String(i?.edgeId??``).trim();if(a&&(e===`link.down`&&t.add(a),e===`link.up`&&t.delete(a),e===`link.capture`)){let e=String(i?.artifactKey??``).trim();e&&(n[a]=e)}}return{edgeDown:t,lastCaptureByEdge:n}}function gc(e,t,n,r,i){return e.map(e=>{let a=String(e.id),o=r[a]??(typeof e.label==`string`?e.label:void 0),s=i.edgeDown.has(a);if(!n)return{...e,label:s?o?`${o} · DOWN`:`DOWN`:o,animated:!1,style:s?{stroke:`hsl(var(--destructive))`,strokeWidth:2,strokeDasharray:`6 6`}:void 0};let c=t[a];if(!c)return{...e,label:s?o?`${o} · DOWN`:`DOWN`:o,animated:!1,style:s?{stroke:`hsl(var(--destructive))`,strokeWidth:2,strokeDasharray:`6 6`}:void 0};let l=c.bps??0,u=1+Math.min(9,Math.log10(Math.max(1,l))/1.2),d=o?`${o} · ${pc(l)}`:pc(l),f=s?`${d} · DOWN`:d;return{...e,label:f,animated:!s&&l>0,style:{...e.style??{},strokeWidth:u,...s?{stroke:`hsl(var(--destructive))`,strokeDasharray:`6 6`}:{}}}})}function _c(e,t,n,r){let i=r.trim().toLowerCase(),a=new Set;if(i)for(let t of e){let e=String(t?.data?.label??t.id).toLowerCase(),n=String(t.id).toLowerCase(),r=String(t?.data?.ip??``).toLowerCase();(e.includes(i)||n.includes(i)||r.includes(i))&&a.add(String(t.id))}let o=e.length||1,s=Math.max(260,o*30);return e.map((e,r)=>{let c=String(e.id),l=n[c],u=l??e.position;if(!l&&t===`circle`){let e=r/o*Math.PI*2;u={x:Math.cos(e)*s,y:Math.sin(e)*s}}let d=i?a.has(c):!1,f=i?!a.has(c):!1;return{...e,position:u,data:{...e.data,highlight:d},style:f?{...e.style??{},opacity:.25}:e.style}})}function vc(e){if(e.loading)return(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading…`});if(e.error)return(0,L.jsx)(`div`,{className:`text-sm text-destructive`,children:e.error});let t=e.data?.interfaces??[];return t.length?(0,L.jsxs)(`div`,{className:`space-y-3`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:e.node}),(0,L.jsx)(R,{size:`sm`,variant:e.autoRefresh?`default`:`outline`,onClick:e.onToggleAutoRefresh,children:e.autoRefresh?`Auto refresh: on`:`Auto refresh: off`})]}),(0,L.jsx)(`div`,{className:`rounded-md border overflow-auto max-h-[60vh]`,children:(0,L.jsxs)(`table`,{className:`w-full text-xs`,children:[(0,L.jsx)(`thead`,{className:`bg-muted/50 sticky top-0`,children:(0,L.jsxs)(`tr`,{children:[(0,L.jsx)(`th`,{className:`text-left p-2`,children:`Interface`}),(0,L.jsx)(`th`,{className:`text-left p-2`,children:`Peer`}),(0,L.jsx)(`th`,{className:`text-left p-2`,children:`State`}),(0,L.jsx)(`th`,{className:`text-right p-2`,children:`RX`}),(0,L.jsx)(`th`,{className:`text-right p-2`,children:`TX`}),(0,L.jsx)(`th`,{className:`text-right p-2`,children:`Drops`})]})}),(0,L.jsx)(`tbody`,{children:t.map(e=>(0,L.jsxs)(`tr`,{className:`border-t`,children:[(0,L.jsx)(`td`,{className:`p-2 font-mono`,children:e.ifName}),(0,L.jsx)(`td`,{className:`p-2 font-mono text-muted-foreground`,children:e.peerNode?`${e.peerNode}:${e.peerIf??``}`:`—`}),(0,L.jsx)(`td`,{className:`p-2`,children:e.operState??`—`}),(0,L.jsx)(`td`,{className:`p-2 text-right font-mono`,children:mc(Number(e.rxBytes??0))}),(0,L.jsx)(`td`,{className:`p-2 text-right font-mono`,children:mc(Number(e.txBytes??0))}),(0,L.jsx)(`td`,{className:`p-2 text-right font-mono`,children:Number(e.rxDropped??0)+Number(e.txDropped??0)})]},e.ifName))})]})})]}):(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No interfaces found.`})}function yc(e){if(e.loading)return(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading…`});if(e.error)return(0,L.jsx)(`div`,{className:`text-sm text-destructive`,children:e.error});if(e.data?.skipped)return(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:e.data.message||`Skipped`});let t=String(e.data?.stdout??``);return(0,L.jsxs)(`div`,{className:`space-y-3`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:e.node}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(t),P.success(`Copied running config`)},disabled:!t,children:`Copy`})]}),(0,L.jsx)(`pre`,{className:`max-h-[65vh] overflow-auto rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100 whitespace-pre-wrap`,children:t||`No output`}),e.data?.stderr?(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground whitespace-pre-wrap`,children:e.data.stderr}):null]})}const bc=t(`/dashboard/labs/map`)({component:Sc});function xc(e){let t=Wn.parse(String(e??``))?.topology??{},n=t?.nodes??{},r=Object.entries(n).map(([e,t])=>{let n=String(t?.kind??``);return{id:String(e),label:String(e),kind:n,status:`unknown`,mgmtIp:``}}),i=[],a=Array.isArray(t?.links)?t.links:[];for(let e=0;e<a.length;e++){let t=a[e],n=Array.isArray(t?.endpoints)?t.endpoints:[];if(n.length!==2)continue;let r=String(n[0]??``),o=String(n[1]??``),s=r.split(`:`)[0],c=o.split(`:`)[0];!s||!c||i.push({id:`e${e+1}`,source:s,target:c,label:`${r} ↔ ${o}`})}return{nodes:r,edges:i}}function Sc(){let e=bc.useSearch(),t=String(e?.workspaceId??``),n=String(e?.source??`workspace`),r=String(e?.dir??`containerlab/designer`),a=String(e?.file??``),o=i({queryKey:G.workspaces(),queryFn:Mr,retry:!1,staleTime:3e4}),s=i({queryKey:t?[`containerlabTemplateMap`,t,n,r,a]:[`containerlabTemplateMap`,`none`],queryFn:async()=>{if(!t)throw Error(`workspaceId is required`);if(!a)throw Error(`file is required`);return _i(t,{source:n,dir:r,file:a})},enabled:!!t&&!!a,retry:!1,staleTime:3e4}),c=(0,F.useMemo)(()=>{if(!s.data?.yaml)return null;try{return xc(s.data.yaml)}catch{return null}},[s.data?.yaml]);return!t||!a?(0,L.jsx)(`div`,{className:`h-screen w-screen p-6`,children:(0,L.jsxs)(`div`,{className:`max-w-2xl space-y-4`,children:[(0,L.jsx)(`div`,{className:`text-2xl font-bold tracking-tight`,children:`Lab map`}),(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Open this page from the Lab Designer “Open map” button, or provide query params.`}),(0,L.jsxs)(B,{children:[(0,L.jsx)(V,{children:(0,L.jsx)(H,{children:`Parameters`})}),(0,L.jsxs)(W,{className:`space-y-3`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Workspace`}),(0,L.jsx)(J,{value:t,readOnly:!0,placeholder:o.isLoading?`Loading…`:`workspaceId missing`})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`File`}),(0,L.jsx)(J,{value:a,readOnly:!0,placeholder:`file missing`})]}),(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Example:`,` `,(0,L.jsx)(`span`,{className:`font-mono`,children:`/dashboard/labs/map?workspaceId=<id>&source=workspace&dir=containerlab/designer&file=lab.clab.yml`})]})]})]})]})}):s.isLoading||s.isFetching?(0,L.jsxs)(`div`,{className:`h-screen w-screen p-6`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,L.jsx)(K,{className:`h-9 w-9`}),(0,L.jsx)(K,{className:`h-8 w-64`})]}),(0,L.jsx)(`div`,{className:`mt-6`,children:(0,L.jsx)(K,{className:`h-[75vh] w-full`})})]}):!s.data||!c?(0,L.jsx)(`div`,{className:`h-screen w-screen p-6`,children:(0,L.jsx)(Za,{title:`Map unavailable`,description:s.isError?`Failed to load template.`:`Template YAML could not be parsed into a topology.`,action:{label:`Close`,onClick:()=>window.close()}})}):(0,L.jsxs)(`div`,{className:`h-screen w-screen flex flex-col bg-background`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-3 border-b px-4 py-3`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-3 min-w-0`,children:[(0,L.jsx)(p,{to:`/dashboard/labs/designer`,search:{},className:mr({variant:`outline`,size:`icon`,className:`h-9 w-9`}),title:`Back to designer`,children:(0,L.jsx)(ve,{className:`h-4 w-4`})}),(0,L.jsxs)(`div`,{className:`min-w-0`,children:[(0,L.jsx)(`div`,{className:`font-semibold truncate`,children:`Lab map`}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:s.data.path})]})]}),(0,L.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,L.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>{navigator.clipboard?.writeText(s.data.yaml)},children:`Copy YAML`})})]}),(0,L.jsxs)(`div`,{className:`flex-1 min-h-0 grid grid-cols-1 lg:grid-cols-[1fr_520px]`,children:[(0,L.jsx)(`div`,{className:`min-h-0 p-3`,children:(0,L.jsx)(`div`,{className:`h-full rounded-xl border overflow-hidden`,children:(0,L.jsx)(fc,{topology:c,workspaceId:t,enableTerminal:!1,fullHeight:!0})})}),(0,L.jsx)(`div`,{className:`min-h-0 border-l bg-background p-3`,children:(0,L.jsxs)(B,{className:`h-full`,children:[(0,L.jsx)(V,{className:`pb-3`,children:(0,L.jsx)(H,{children:`YAML`})}),(0,L.jsx)(W,{className:`h-[calc(100%-56px)]`,children:(0,L.jsx)(Os,{value:s.data.yaml,readOnly:!0,className:`h-full font-mono text-xs`})})]})})]})]})}function Cc(e){let[t,n]=(0,F.useState)(``),[r,a]=(0,F.useState)(``),[o,s]=(0,F.useState)(``),c=i({queryKey:G.registryRepos(t),queryFn:async()=>Ei({q:t,n:500}),retry:!1,staleTime:3e4}),l=i({queryKey:o?G.registryTags(o,r):[`registryTags`,`none`],queryFn:async()=>Di(o,{q:r}),enabled:!!o,retry:!1,staleTime:3e4}),u=(0,F.useMemo)(()=>{let t=(e.value||``).trim(),n=t.lastIndexOf(`:`);return n<=0?{repo:t,tag:``}:{repo:t.slice(0,n),tag:t.slice(n+1)}},[e.value]);return(0,L.jsxs)(`div`,{className:`space-y-3 ${e.className??``}`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Image`}),(0,L.jsx)(J,{value:e.value,onChange:t=>e.onChange(t.target.value),placeholder:`repo:tag`}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:"Registry-backed picker. Requires server env `SKYFORGE_REGISTRY_URL`."})]}),(0,L.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-3`,children:[(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,L.jsx)(q,{children:`Repository`}),(0,L.jsx)(R,{size:`sm`,variant:`ghost`,onClick:()=>{u.repo&&(s(u.repo),P.message(`Repository selected`,{description:u.repo}))},children:`Use current`})]}),(0,L.jsx)(J,{value:t,onChange:e=>n(e.target.value),placeholder:`Search repos…`}),(0,L.jsx)(`div`,{className:`max-h-40 overflow-auto rounded-md border`,children:c.isError?(0,L.jsx)(`div`,{className:`p-2 text-xs text-destructive`,children:`Failed to load repos.`}):c.isLoading?(0,L.jsx)(`div`,{className:`p-2 text-xs text-muted-foreground`,children:`Loading…`}):(0,L.jsx)(`div`,{className:`divide-y`,children:(c.data?.repositories??[]).slice(0,200).map(e=>(0,L.jsx)(`button`,{type:`button`,className:`w-full text-left px-2 py-1.5 text-xs font-mono hover:bg-accent ${o===e?`bg-accent`:``}`,onClick:()=>s(e),children:e},e))})})]}),(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,L.jsx)(q,{children:`Tag`}),(0,L.jsx)(R,{size:`sm`,variant:`ghost`,onClick:()=>{if(!o)return;let t=`${o}:${u.tag||`latest`}`;e.onChange(t)},disabled:!o,children:`Set image`})]}),(0,L.jsx)(J,{value:r,onChange:e=>a(e.target.value),placeholder:`Search tags…`,disabled:!o}),(0,L.jsx)(`div`,{className:`max-h-40 overflow-auto rounded-md border`,children:o?l.isError?(0,L.jsx)(`div`,{className:`p-2 text-xs text-destructive`,children:`Failed to load tags.`}):l.isLoading?(0,L.jsx)(`div`,{className:`p-2 text-xs text-muted-foreground`,children:`Loading…`}):(0,L.jsx)(`div`,{className:`divide-y`,children:(l.data?.tags??[]).slice(0,300).map(t=>(0,L.jsx)(`button`,{type:`button`,className:`w-full text-left px-2 py-1.5 text-xs font-mono hover:bg-accent`,onClick:()=>e.onChange(`${o}:${t}`),children:t},t))}):(0,L.jsx)(`div`,{className:`p-2 text-xs text-muted-foreground`,children:`Select a repo…`})})]})]})]})}function wc(e){let t=String(e??``).trim();return t&&t.toLowerCase().replace(/[^a-z0-9-]+/g,`-`).replace(/^-+|-+$/g,``).slice(0,48)||`node`}function Tc(e){let t=new Set,n=new Map;for(let r of e){let e=wc(r.id||r.label||`node`),i=e,a=2;for(;t.has(i);)i=`${e}-${a++}`;t.add(i),n.set(r.id,i)}return n}function Ec(e){let t=[],n=wc(e.name||`lab`),r=Tc(e.nodes),i=new Map,a=e=>{let t=(i.get(e)??0)+1;return i.set(e,t),`eth${t}`},o={};for(let n of e.nodes){let e=r.get(n.id)||wc(n.id),i=String(n.id||n.label||``).trim();i&&wc(i)!==i&&t.push(`Node ${i}: name will be '${wc(i)}'`),i&&wc(i)!==e&&t.push(`Node ${i}: name adjusted to '${e}'`);let a=(n.kind||``).trim()||void 0,s=(n.image||``).trim()||void 0;s||t.push(`Node ${e}: missing image`),o[e]={...a?{kind:a}:{},...s?{image:s}:{},...n.env&&Object.keys(n.env).length?{env:n.env}:{},...n.mgmtIpv4?{mgmt_ipv4:n.mgmtIpv4}:{}}}let s=[];for(let n of e.links){let e=r.get(n.source),i=r.get(n.target);if(!e||!i){t.push(`Link ${n.id}: missing endpoint(s)`);continue}let o=a(n.source),c=a(n.target);s.push({endpoints:[`${e}:${o}`,`${i}:${c}`]})}let c={name:n,topology:{nodes:o,...s.length?{links:s}:{}}},l=(e,t=0)=>{let n=`  `.repeat(t);if(e==null)return`null`;if(typeof e==`string`)return JSON.stringify(e);if(typeof e==`number`||typeof e==`boolean`)return String(e);if(Array.isArray(e))return e.length===0?`[]`:e.map(e=>{if(typeof e==`object`&&e&&!Array.isArray(e)){let r=l(e,t+1).split(`
`);return`${n}- ${r[0].trimStart()}\n${r.slice(1).map(e=>`${n}  ${e}`).join(`
`)}`}return`${n}- ${l(e,0)}`}).join(`
`);if(typeof e==`object`){let r=Object.keys(e);return r.length===0?`{}`:r.map(r=>{let i=e[r];return i===void 0?``:typeof i==`object`&&i?`${n}${r}:\n${l(i,t+1)}`:`${n}${r}: ${l(i,0)}`}).filter(Boolean).join(`
`)}return JSON.stringify(String(e))};return{yaml:l(c,0)+`
`,warnings:t}}var Dc=Ln({workspaceId:zn().optional().catch(``),importDeploymentId:zn().optional().catch(``)});const Oc=t(`/dashboard/labs/designer`)({validateSearch:e=>Dc.parse(e),component:Pc});var kc=`application/x-skyforge-palette-item`;function Ac(e){let t=String(e??``).trim().replace(/^\/+|\/+$/g,``),n=t.toLowerCase(),r=t.split(`/`).pop()??t,i=e=>({id:`${e.kind}:${e.repo??``}`,...e});return n.includes(`endhost`)||n.includes(`linux`)||n.includes(`ubuntu`)||n.includes(`alpine`)?i({label:`Host · ${r}`,category:`Hosts`,kind:`linux`,repo:t,vendor:`Linux`,model:r,role:`host`}):r===`ceos`||n.endsWith(`/ceos`)||n.includes(`/ceos:`)?i({label:`Switch/Router · Arista cEOS`,category:`Switches`,kind:`ceos`,repo:t,vendor:`Arista`,model:`cEOS`,role:`switch`}):n.includes(`vrnetlab/cisco_iol`)?i({label:`Router · Cisco IOL (IOS)`,category:`Routers`,kind:`cisco_iol`,repo:t,vendor:`Cisco`,model:`IOL`,role:`router`}):n.includes(`vrnetlab/cisco_viosl2`)?i({label:`Switch · Cisco vIOS L2`,category:`Switches`,kind:`cisco_viosl2`,repo:t,vendor:`Cisco`,model:`vIOS L2`,role:`switch`}):n.includes(`vrnetlab/vr-n9kv`)||n.includes(`vrnetlab/nxos`)?i({label:`Switch · Cisco NX-OSv (N9Kv)`,category:`Switches`,kind:`vr-n9kv`,repo:t,vendor:`Cisco`,model:`NX-OSv9k`,role:`switch`}):n.includes(`vrnetlab/vr-vmx`)||n.includes(`/vr-vmx`)?i({label:`Router · Juniper vMX`,category:`Routers`,kind:`vr-vmx`,repo:t,vendor:`Juniper`,model:`vMX`,role:`router`}):n.includes(`vrnetlab/juniper_vjunos-router`)?i({label:`Router · Juniper vJunos Router`,category:`Routers`,kind:`juniper_vjunos-router`,repo:t,vendor:`Juniper`,model:`vJunos-router`,role:`router`}):n.includes(`vrnetlab/juniper_vjunos-switch`)?i({label:`Switch · Juniper vJunos Switch`,category:`Switches`,kind:`juniper_vjunos-switch`,repo:t,vendor:`Juniper`,model:`vJunos-switch`,role:`switch`}):n.includes(`vrnetlab/juniper_vsrx`)||n.includes(`vr-vsrx`)||n.includes(`vsrx`)||n.includes(`/srx`)?i({label:`Firewall · Juniper SRX`,category:`Firewalls`,kind:`vr-vsrx`,repo:t,vendor:`Juniper`,model:`SRX`,role:`firewall`}):n.includes(`vrnetlab/vr-fortios`)||n.includes(`fortios`)?i({label:`Firewall · Fortinet FortiOS`,category:`Firewalls`,kind:`vr-fortios`,repo:t,vendor:`Fortinet`,model:`FortiOS`,role:`firewall`}):n.includes(`vrnetlab/vr-ftosv`)||n.includes(`os10`)?i({label:`Switch · Dell OS10`,category:`Switches`,kind:`vr-ftosv`,repo:t,vendor:`Dell`,model:`OS10`,role:`switch`}):n.includes(`vrnetlab/`)&&(n.includes(`asa`)||n.includes(`pan`)||n.includes(`palo`)||n.includes(`checkpoint`))?i({label:`Firewall · ${r}`,category:`Firewalls`,kind:r,repo:t,role:`firewall`}):i({label:`Node · ${r}`,category:`Other`,kind:r,repo:t,role:`other`})}function jc(e){let t=e.item,n=t.role===`firewall`?qe:t.role===`host`?ye:Te,r=t.vendor?`${t.vendor}${t.model?` · ${t.model}`:``}`:t.label,i=t.role===`router`?`Router`:t.role===`switch`?`Switch`:t.role===`firewall`?`Firewall`:t.role===`host`?`Host`:`Node`;return(0,L.jsx)(`div`,{className:`cursor-grab select-none rounded-lg border bg-background px-3 py-2 text-sm hover:bg-accent`,draggable:!0,onDragStart:e=>{e.dataTransfer.setData(kc,JSON.stringify(t)),e.dataTransfer.effectAllowed=`copy`},title:t.repo?`${t.label}\n${t.repo}`:t.label,children:(0,L.jsxs)(`div`,{className:`flex items-start gap-2`,children:[(0,L.jsx)(n,{className:`mt-0.5 h-4 w-4 text-muted-foreground`}),(0,L.jsxs)(`div`,{className:`min-w-0`,children:[(0,L.jsxs)(`div`,{className:`truncate flex items-center gap-2`,children:[(0,L.jsx)(`span`,{className:`truncate`,children:r}),(0,L.jsx)(`span`,{className:`shrink-0 rounded-full bg-muted px-2 py-0.5 text-[10px] font-medium text-muted-foreground`,children:i})]}),(0,L.jsx)(`div`,{className:`truncate text-[11px] text-muted-foreground font-mono`,children:t.repo??t.kind})]})]})})}async function Mc(e){let t=String(e.repo??``).trim().replace(/^\/+|\/+$/g,``);if(!t)return`latest`;try{let n=await e.queryClient.fetchQuery({queryKey:G.registryTags(t,``),queryFn:async()=>Di(t,{q:``}),retry:!1,staleTime:3e4}),r=Array.isArray(n?.tags)?n.tags:[];return r.includes(`latest`)?`latest`:r.length>0?String(r[r.length-1]):`latest`}catch{return`latest`}}function Nc(e){let t=String(e.data?.kind??``),n=String(e.data?.label??e.id),r=t.toLowerCase(),i=r.includes(`forti`)||r.includes(`vsrx`)||r.includes(`srx`)||r.includes(`asa`)||r.includes(`pan`),a=r.includes(`linux`)||r.includes(`host`),o=i?qe:a?ye:Lt,s=i?`border-amber-500/60`:a?`border-emerald-500/60`:`border-sky-500/60`;return(0,L.jsxs)(`div`,{className:[`rounded-xl border bg-background/95 px-3 py-2 shadow-sm min-w-[140px]`,e.selected?`ring-2 ring-primary/60`:``,s].join(` `),children:[(0,L.jsx)(ln,{type:`target`,position:$t.Top}),(0,L.jsx)(ln,{type:`target`,position:$t.Left}),(0,L.jsx)(ln,{type:`source`,position:$t.Right}),(0,L.jsx)(ln,{type:`source`,position:$t.Bottom}),(0,L.jsxs)(`div`,{className:`flex items-start gap-2`,children:[(0,L.jsx)(`div`,{className:`mt-0.5 rounded-md border bg-muted p-1.5`,children:(0,L.jsx)(o,{className:`h-4 w-4`})}),(0,L.jsxs)(`div`,{className:`min-w-0`,children:[(0,L.jsx)(`div`,{className:`font-medium leading-tight truncate`,children:n}),(0,L.jsx)(`div`,{className:`text-[11px] text-muted-foreground truncate`,children:t||`node`})]})]})]})}function Pc(){let e=Oc.useSearch(),t=String(e.importDeploymentId??``).trim(),n=`skyforge.labDesigner.v1`,a=(0,F.useRef)(null),o=c(),[s,l]=(0,F.useState)(`lab`),[u,d]=(0,F.useState)(``),[f,p]=(0,F.useState)(`clabernetes`),[m,h]=(0,F.useState)(``),[g,_]=(0,F.useState)(!0),[y,b]=(0,F.useState)(null),[x,S]=(0,F.useState)(`containerlab/designer`),[C,w]=(0,F.useState)(``),[T,E]=(0,F.useState)(!0),[D,O]=(0,F.useState)(``),[k,te]=(0,F.useState)(`all`),[ne,re]=(0,F.useState)(`all`),[ie,ae]=(0,F.useState)(null),[oe,A]=(0,F.useState)(``),[j,se]=(0,F.useState)(!1),[ce,le]=(0,F.useState)(``),[ue,de]=(0,F.useState)(`generated`),[fe,pe]=(0,F.useState)(``),[me,he]=(0,F.useState)(!1),[_e,ve]=(0,F.useState)(`blueprints`),[ye,be]=(0,F.useState)(`containerlab`),[xe,Se]=(0,F.useState)(``),[Ce,Te]=(0,F.useState)(!0),[Ee,De]=(0,F.useState)(null),[Oe,ke]=(0,F.useState)(null),[Ae,je]=(0,F.useState)(null),[M,Me,Ne]=wt([{id:`r1`,position:{x:80,y:80},data:{label:`r1`,kind:`linux`,image:``},type:`designerNode`}]),[Pe,Fe,Ie]=yt([]),N=(0,F.useMemo)(()=>M.find(e=>e.id===oe)??null,[M,oe]),Le=(0,F.useMemo)(()=>({name:s,nodes:M.map(e=>({id:String(e.id),label:String(e.data?.label??e.id),kind:String(e.data?.kind??``),image:String(e.data?.image??``),position:{x:e.position.x,y:e.position.y}})),links:Pe.map(e=>({id:String(e.id),source:String(e.source),target:String(e.target)}))}),[Pe,s,M]),{yaml:Re,warnings:ze}=(0,F.useMemo)(()=>Ec(Le),[Le]),Be=(0,F.useMemo)(()=>ue===`custom`?String(fe??``):Re,[fe,Re,ue]),Ve=(0,F.useMemo)(()=>String(x??``).trim().replace(/^\/+|\/+$/g,``)||`containerlab/designer`,[x]),He=(0,F.useMemo)(()=>{let e=String(C??``).trim()||`${s||`lab`}.clab.yml`;return e.endsWith(`.yml`)||e.endsWith(`.yaml`)?e:`${e}.yml`},[s,C]);(0,F.useEffect)(()=>{if(!me||!u)return;let e=`skyforge.labDesigner.importPrefs.${u}`;try{let t=window.localStorage.getItem(e);if(!t)return;let n=JSON.parse(t);(n?.source===`workspace`||n?.source===`blueprints`)&&ve(n.source),typeof n?.dir==`string`&&be(n.dir)}catch{}},[me,u]),(0,F.useEffect)(()=>{if(!u)return;let e=`skyforge.labDesigner.importPrefs.${u}`;try{window.localStorage.setItem(e,JSON.stringify({source:_e,dir:ye}))}catch{}},[ye,_e,u]);let We=()=>{let e=M.length+1,t=`n${e}`,n=new Set(M.map(e=>e.id));for(;n.has(t);)e++,t=`n${e}`;let r={x:120+M.length*40,y:120+M.length*30},i={id:t,position:r,data:{label:t,kind:`linux`,image:``},type:`designerNode`};Me(e=>[...e,i]),A(t)},Ge=()=>{let e=M.length;if(!e)return;let t=Math.max(1,Math.ceil(Math.sqrt(e)));Me(e=>e.map((e,n)=>({...e,position:{x:120+n%t*260,y:120+Math.floor(n/t)*180}}))),requestAnimationFrame(()=>ie?.fitView({padding:.15,duration:300}))},Ke=()=>{De(null),ke(null),je(null)},qe=e=>{if(!t)return;let n=new URLSearchParams;n.set(`action`,e.action),n.set(`node`,e.node);let r=`/dashboard/deployments/${encodeURIComponent(t)}?${n.toString()}`;window.open(r,`_blank`,`noopener,noreferrer`)},Je=e=>{let t=M.find(t=>String(t.id)===e);if(!t)return;let n=String(t.data?.label??t.id),r=window.prompt(`Node name`,n);if(r==null)return;let i=r.trim();if(!i)return;let a=new Set(M.map(e=>String(e.id)));a.delete(e);let o=i,s=2;for(;a.has(o);)o=`${i}-${s++}`;Me(t=>t.map(t=>String(t.id)===e?{...t,id:o,data:{...t.data,label:i}}:t)),Fe(t=>t.map(t=>({...t,source:String(t.source)===e?o:t.source,target:String(t.target)===e?o:t.target,label:String(t.source)===e||String(t.target)===e?`${String(t.source)===e?o:t.source} ↔ ${String(t.target)===e?o:t.target}`:t.label}))),oe===e&&A(o),De(t=>t&&t.nodeId===e?{...t,nodeId:o}:t)};(0,F.useEffect)(()=>{let e=e=>{e.key===`Escape`&&Ke()};return window.addEventListener(`keydown`,e),()=>window.removeEventListener(`keydown`,e)},[]);let Ye=()=>{let e=new Blob([Be],{type:`text/yaml`}),t=document.createElement(`a`);t.href=URL.createObjectURL(e),t.download=`${s||`lab`}.clab.yml`,document.body.appendChild(t),t.click(),t.remove(),setTimeout(()=>URL.revokeObjectURL(t.href),5e3)};(0,F.useEffect)(()=>{let t=String(e.workspaceId??``).trim(),n=String(e.importDeploymentId??``).trim();if(!t||!n)return;d(t),_(!1),b(null);let r=!1;return(async()=>{try{let e=await Ti(t,n);if(r)return;let i=(e.nodes??[]).map((e,t)=>({id:String(e.id),position:{x:120+t%4*260,y:120+Math.floor(t/4)*180},data:{label:String(e.label||e.id),kind:String(e.kind||``),image:``},type:`designerNode`})),a=(e.edges??[]).map(e=>({id:String(e.id),source:String(e.source),target:String(e.target),label:e.label||`${e.source} ↔ ${e.target}`}));if(!i.length)throw Error(`No nodes found in deployment topology`);Me(i),Fe(a),A(String(i[0].id)),P.success(`Imported running topology`,{description:`Deployment ${n}`}),requestAnimationFrame(()=>ie?.fitView({padding:.15,duration:250}))}catch(e){if(r)return;P.error(`Failed to import deployment topology`,{description:e.message})}})(),()=>{r=!0}},[e.importDeploymentId,e.workspaceId]);let Xe=()=>{try{let e={labName:s,workspaceId:u,runtime:f,netlabServer:m,useSavedConfig:g,lastSaved:y,nodes:M,edges:Pe};window.localStorage.setItem(n,JSON.stringify(e)),P.success(`Draft saved`)}catch(e){P.error(`Failed to save draft`,{description:e.message})}},Ze=()=>{try{let e=window.localStorage.getItem(n);if(!e){P.message(`No saved draft`);return}let t=JSON.parse(e);typeof t?.labName==`string`&&l(t.labName),typeof t?.workspaceId==`string`&&d(t.workspaceId),(t?.runtime===`clabernetes`||t?.runtime===`containerlab`)&&p(t.runtime),typeof t?.netlabServer==`string`&&h(t.netlabServer),typeof t?.useSavedConfig==`boolean`&&_(t.useSavedConfig),t?.lastSaved&&typeof t.lastSaved==`object`&&b(t.lastSaved),Array.isArray(t?.nodes)&&Me(t.nodes),Array.isArray(t?.edges)&&Fe(t.edges),P.success(`Draft loaded`)}catch(e){P.error(`Failed to load draft`,{description:e.message})}},Qe=i({queryKey:G.workspaces(),queryFn:Mr,retry:!1,staleTime:3e4}),$e=i({queryKey:G.registryRepos(``),queryFn:async()=>Ei({q:``,n:2e3}),retry:!1,staleTime:6e4}),et=i({queryKey:u?G.workspaceNetlabServers(u):[`workspaceNetlabServers`,`none`],queryFn:async()=>Rr(u),enabled:!!u&&f===`containerlab`,retry:!1,staleTime:3e4}),tt=i({queryKey:u?[`containerlabTemplates`,u,_e,ye]:[`containerlabTemplates`,`none`],queryFn:async()=>hi(u,{source:_e,dir:ye}),enabled:!!u&&me,retry:!1,staleTime:3e4}),nt=i({queryKey:u?[`containerlabTemplate`,u,_e,ye,xe]:[`containerlabTemplate`,`none`],queryFn:async()=>{if(!u)throw Error(`missing workspace`);return xe?_i(u,{source:_e,dir:ye,file:xe}):null},enabled:!!u&&me&&!!xe,retry:!1,staleTime:3e4}),rt=r({mutationFn:async()=>{if(!u)throw Error(`Select a workspace`);if(!Be.trim())throw Error(`YAML is empty`);if(!/^\s*topology\s*:/m.test(Be))throw Error(`YAML must contain a top-level 'topology:' section`);if(Ve!==`containerlab`&&!Ve.startsWith(`containerlab/`))throw Error(`Repo path must be under containerlab/`);let e=g&&y?.workspaceId===u?y:await bi(u,{name:s,topologyYAML:Be,templatesDir:Ve,template:He}).then(e=>{let t={workspaceId:e.workspaceId,templatesDir:e.templatesDir,template:e.template,filePath:e.filePath,branch:e.branch};return b(t),t});if(f===`containerlab`){if(!m)throw Error(`Select a netlab server`);return Si(u,{name:s,netlabServer:m,templateSource:`workspace`,templatesDir:e.templatesDir,template:e.template,autoDeploy:!0})}return xi(u,{name:s,templateSource:`workspace`,templatesDir:e.templatesDir,template:e.template,autoDeploy:!0})},onSuccess:async e=>{P.success(`Deployment created`,{description:e.deployment?.name??s}),await o.invalidateQueries({queryKey:G.dashboardSnapshot()});let t=e.deployment?.id;Ce&&t&&window.open(`/dashboard/deployments/${t}`,`_blank`,`noopener,noreferrer`)},onError:e=>P.error(`Create deployment failed`,{description:e.message})}),at=r({mutationFn:async()=>{if(!u)throw Error(`Select a workspace`);if(!Be.trim())throw Error(`YAML is empty`);if(!/^\s*topology\s*:/m.test(Be))throw Error(`YAML must contain a top-level 'topology:' section`);if(Ve!==`containerlab`&&!Ve.startsWith(`containerlab/`))throw Error(`Repo path must be under containerlab/`);return bi(u,{name:s,topologyYAML:Be,templatesDir:Ve,template:He})},onSuccess:e=>{b({workspaceId:e.workspaceId,templatesDir:e.templatesDir,template:e.template,filePath:e.filePath,branch:e.branch}),P.success(`Saved to repo`,{description:`${e.filePath} (${e.branch})`})},onError:e=>P.error(`Save failed`,{description:e.message})}),ot=r({mutationFn:async()=>{if(!u)throw Error(`Select a workspace`);let e=xe.trim();if(!e)throw Error(`Select a template`);return _i(u,{source:_e,dir:ye,file:e})},onSuccess:e=>{de(`custom`),pe(e.yaml),he(!1),P.success(`Template imported`,{description:e.path})},onError:e=>P.error(`Import failed`,{description:e.message})}),st=e=>{e.preventDefault(),e.dataTransfer.dropEffect=`move`},ct=async e=>{if(e.preventDefault(),!a.current||!ie)return;let t=e.dataTransfer.getData(kc),n=e.dataTransfer.getData(`application/x-skyforge-kind`),r=t?(()=>{try{return JSON.parse(t)}catch{return null}})():null,i=r?.kind||n;if(!i)return;let s=a.current.getBoundingClientRect(),c=ie.screenToFlowPosition({x:e.clientX-s.left,y:e.clientY-s.top}),l=r?.role,u=l===`host`?`h`:l===`router`?`r`:l===`switch`?`s`:l===`firewall`?`f`:i===`linux`?`h`:`n`,d=M.length+1,f=`${u}${d}`,p=new Set(M.map(e=>e.id));for(;p.has(f);)d++,f=`${u}${d}`;let m=String(r?.repo??``).trim(),h=m?await Mc({repo:m,queryClient:o}):``,g=m?`${m}:${h}`:``,_={id:f,position:c,data:{label:f,kind:i,image:g},type:`designerNode`};Me(e=>[...e,_]),A(f)},lt=async()=>{if(!u){P.error(`Select a workspace first`);return}try{let e=y?.workspaceId===u?y:await bi(u,{name:s,topologyYAML:Be,templatesDir:Ve,template:He}).then(e=>{let t={workspaceId:e.workspaceId,templatesDir:e.templatesDir,template:e.template,filePath:e.filePath,branch:e.branch};return b(t),t}),t=new URLSearchParams;t.set(`workspaceId`,u),t.set(`source`,`workspace`),t.set(`dir`,e.templatesDir),t.set(`file`,e.template);let n=`/dashboard/labs/map?${t.toString()}`;window.open(n,`_blank`,`noopener,noreferrer`)}catch(e){P.error(`Failed to open map`,{description:e.message})}},dt=e=>{let t=e.target,n=t?.tagName?.toUpperCase?.()??``;if(n===`INPUT`||n===`TEXTAREA`||t?.isContentEditable)return;if(e.key===`Escape`){Ke();return}if(e.key!==`Delete`&&e.key!==`Backspace`)return;let r=new Set(M.filter(e=>e.selected).map(e=>String(e.id))),i=new Set(Pe.filter(e=>e.selected).map(e=>String(e.id)));r.size===0&&i.size===0||(e.preventDefault(),Me(e=>e.filter(e=>!r.has(String(e.id)))),Fe(e=>e.filter(e=>!(i.has(String(e.id))||r.has(String(e.source))||r.has(String(e.target))))))},ft=(0,F.useMemo)(()=>({designerNode:Nc}),[]),pt=(0,F.useMemo)(()=>($e.data?.repositories??[]).map(Ac),[$e.data?.repositories]),ht=(0,F.useMemo)(()=>{let e=new Set;for(let t of pt){let n=String(t.vendor??``).trim();n&&e.add(n)}return Array.from(e).sort((e,t)=>e.localeCompare(t))},[pt]),vt=(0,F.useMemo)(()=>{let e=pt,t=D.trim().toLowerCase(),n=e.filter(e=>k===`all`?!0:String(e.vendor??``)===k).filter(e=>ne===`all`?!0:String(e.role??`other`)===ne).filter(e=>t?`${e.label} ${e.kind} ${e.category} ${e.repo??``}`.toLowerCase().includes(t):!0),r={Hosts:0,Routers:1,Switches:2,Firewalls:3,Other:4};return n.sort((e,t)=>{let n=r[e.category]??99,i=r[t.category]??99;return n===i?e.label.localeCompare(t.label):n-i})},[pt,ne,D,k]);return(0,L.jsxs)(`div`,{className:`h-full w-full p-4 flex flex-col gap-4 min-h-0`,children:[(0,L.jsxs)(`div`,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(`div`,{className:`text-2xl font-bold tracking-tight`,children:`Lab Designer (Containerlab)`}),(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Drag nodes, wire links, generate Containerlab YAML, and deploy.`})]}),(0,L.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,L.jsxs)(R,{variant:`outline`,size:`sm`,onClick:()=>he(!0),disabled:!u,children:[(0,L.jsx)(mt,{className:`mr-2 h-4 w-4`}),`Import template`]}),(0,L.jsx)(R,{variant:`outline`,size:`sm`,onClick:Ze,children:`Load draft`}),(0,L.jsx)(R,{variant:`outline`,size:`sm`,onClick:Xe,children:`Save draft`}),(0,L.jsxs)(R,{variant:`outline`,size:`sm`,onClick:()=>at.mutate(),disabled:at.isPending,children:[(0,L.jsx)(ge,{className:`mr-2 h-4 w-4`}),`Save config`]}),(0,L.jsxs)(R,{variant:`outline`,size:`sm`,onClick:Ye,children:[(0,L.jsx)(ee,{className:`mr-2 h-4 w-4`}),`Download YAML`]})]})]}),(0,L.jsxs)(`div`,{className:`grid gap-4 lg:grid-cols-[1fr_420px] flex-1 min-h-0`,children:[(0,L.jsxs)(B,{className:`flex flex-col min-h-0`,children:[(0,L.jsx)(V,{className:`pb-3`,children:(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,L.jsx)(H,{children:`Topology`}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>E(e=>!e),children:T?`Snap: on`:`Snap: off`}),(0,L.jsxs)(R,{size:`sm`,variant:j?`default`:`outline`,onClick:()=>{se(e=>{let t=!e;return t||le(``),t})},title:`Create links by clicking a source node, then a target node`,children:[(0,L.jsx)(_t,{className:`mr-2 h-4 w-4`}),j?`Link: on`:`Link: off`]}),(0,L.jsxs)(R,{size:`sm`,variant:`outline`,onClick:Ge,disabled:M.length<2,children:[(0,L.jsx)(Ut,{className:`mr-2 h-4 w-4`}),`Auto-layout`]}),(0,L.jsxs)(R,{size:`sm`,variant:`outline`,onClick:We,children:[(0,L.jsx)(v,{className:`mr-2 h-4 w-4`}),`Add node`]})]})]})}),(0,L.jsx)(W,{className:`flex-1 min-h-0`,children:(0,L.jsxs)(`div`,{className:`flex h-full w-full border rounded-xl overflow-hidden bg-background/50`,children:[(0,L.jsxs)(`div`,{className:`w-[180px] border-r bg-background p-3`,children:[(0,L.jsx)(`div`,{className:`text-xs font-semibold text-muted-foreground`,children:`Palette`}),(0,L.jsx)(`div`,{className:`mt-2`,children:(0,L.jsx)(J,{value:D,onChange:e=>O(e.target.value),placeholder:`Search…`,className:`h-8`})}),(0,L.jsxs)(`div`,{className:`mt-2 grid gap-2`,children:[(0,L.jsxs)(Y,{value:k,onValueChange:te,children:[(0,L.jsx)(Z,{className:`h-8`,children:(0,L.jsx)(X,{placeholder:`Vendor`})}),(0,L.jsxs)(Q,{children:[(0,L.jsx)($,{value:`all`,children:`All vendors`}),ht.map(e=>(0,L.jsx)($,{value:e,children:e},e))]})]}),(0,L.jsxs)(Y,{value:ne,onValueChange:re,children:[(0,L.jsx)(Z,{className:`h-8`,children:(0,L.jsx)(X,{placeholder:`Role`})}),(0,L.jsxs)(Q,{children:[(0,L.jsx)($,{value:`all`,children:`All roles`}),(0,L.jsx)($,{value:`router`,children:`Routers`}),(0,L.jsx)($,{value:`switch`,children:`Switches`}),(0,L.jsx)($,{value:`firewall`,children:`Firewalls`}),(0,L.jsx)($,{value:`host`,children:`Hosts`}),(0,L.jsx)($,{value:`other`,children:`Other`})]})]})]}),(0,L.jsx)(`div`,{className:`mt-3 space-y-2`,children:$e.isError?(0,L.jsx)(`div`,{className:`rounded-lg border bg-background px-3 py-2 text-xs text-destructive`,children:`Registry not available.`}):$e.isLoading?(0,L.jsx)(`div`,{className:`rounded-lg border bg-background px-3 py-2 text-xs text-muted-foreground`,children:`Loading images…`}):vt.length===0?(0,L.jsx)(`div`,{className:`rounded-lg border bg-background px-3 py-2 text-xs text-muted-foreground`,children:`No images found.`}):(0,L.jsx)(`div`,{className:`space-y-3`,children:[`Hosts`,`Routers`,`Switches`,`Firewalls`,`Other`].map(e=>({category:e,items:vt.filter(t=>t.category===e)})).filter(e=>e.items.length>0).map(e=>(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(`div`,{className:`text-[11px] font-semibold text-muted-foreground`,children:e.category}),(0,L.jsx)(`div`,{className:`space-y-2`,children:e.items.slice(0,60).map(e=>(0,L.jsx)(jc,{item:e},e.id))})]},e.category))})})]}),(0,L.jsxs)(`div`,{className:`flex-1 outline-none relative`,ref:a,onDrop:ct,onDragOver:st,tabIndex:0,onKeyDown:dt,onMouseDown:e=>{e.currentTarget.focus(),Ke()},onContextMenu:e=>e.preventDefault(),children:[j?(0,L.jsx)(`div`,{className:`absolute z-10 m-3 rounded-lg border bg-background/80 px-3 py-2 text-xs text-muted-foreground backdrop-blur`,children:ce?(0,L.jsxs)(L.Fragment,{children:[`Link mode: select target for`,` `,(0,L.jsx)(`span`,{className:`font-mono text-foreground`,children:ce})]}):(0,L.jsx)(L.Fragment,{children:`Link mode: click a source node, then click a target node`})}):null,(0,L.jsxs)(hn,{nodes:M,edges:Pe,onNodesChange:Ne,onEdgesChange:Ie,onConnect:e=>{let t=e.source&&e.target?`${e.source} ↔ ${e.target}`:void 0;Fe(n=>Gt({...e,label:t},n))},fitView:!0,onNodeClick:(e,t)=>{let n=String(t.id);if(j){if(!ce){le(n);return}if(ce===n){le(``);return}let e=`e-${ce}-${n}-${Date.now()}`;Fe(t=>Gt({id:e,source:ce,target:n,label:`${ce} ↔ ${n}`},t)),le(``);return}A(n)},onNodeContextMenu:(e,t)=>{e.preventDefault();let n=a.current?.getBoundingClientRect();De({x:n?e.clientX-n.left:e.clientX,y:n?e.clientY-n.top:e.clientY,nodeId:String(t.id)}),ke(null),je(null)},onEdgeContextMenu:(e,t)=>{e.preventDefault();let n=a.current?.getBoundingClientRect();ke({x:n?e.clientX-n.left:e.clientX,y:n?e.clientY-n.top:e.clientY,edgeId:String(t.id)}),De(null),je(null)},onPaneContextMenu:e=>{e.preventDefault();let t=a.current?.getBoundingClientRect();je({x:t?e.clientX-t.left:e.clientX,y:t?e.clientY-t.top:e.clientY}),De(null),ke(null)},onInit:ae,snapToGrid:T,snapGrid:[12,12],nodeTypes:ft,children:[(0,L.jsx)(Xt,{}),(0,L.jsx)(gt,{zoomable:!0,pannable:!0,className:`bg-background border rounded-lg`}),(0,L.jsx)(ut,{gap:12,size:1})]}),Ee?(0,L.jsx)(`div`,{className:`absolute z-50`,style:{left:Ee.x,top:Ee.y},onContextMenu:e=>e.preventDefault(),children:(0,L.jsxs)(B,{className:`w-64 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,L.jsxs)(V,{className:`p-3 pb-2`,children:[(0,L.jsx)(H,{className:`text-sm`,children:`Node`}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:String(M.find(e=>String(e.id)===Ee.nodeId)?.data?.label??Ee.nodeId)})]}),(0,L.jsxs)(W,{className:`p-3 pt-0 space-y-2`,children:[(0,L.jsx)(R,{size:`sm`,className:`w-full`,onClick:()=>{A(Ee.nodeId),Ke()},children:`Edit…`}),t?(0,L.jsxs)(`div`,{className:`grid grid-cols-3 gap-2`,children:[(0,L.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>{qe({action:`terminal`,node:Ee.nodeId}),Ke()},children:`Terminal`}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>{qe({action:`logs`,node:Ee.nodeId}),Ke()},children:`Logs`}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>{qe({action:`describe`,node:Ee.nodeId}),Ke()},children:`Describe`})]}):null,(0,L.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{Je(Ee.nodeId),Ke()},children:`Rename…`}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=M.find(e=>String(e.id)===Ee.nodeId);if(!e)return;let t=new Set(M.map(e=>String(e.id))),n=M.length+1,r=`${String(e.id)}-${n}`;for(;t.has(r);)n++,r=`${String(e.id)}-${n}`;let i={...e,id:r,position:{x:e.position.x+32,y:e.position.y+32},data:{...e.data,label:r}};Me(e=>[...e,i]),A(r),Ke()},children:`Duplicate`}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{se(!0),le(Ee.nodeId),Ke()},children:`Start link`}),(0,L.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=M.find(e=>String(e.id)===Ee.nodeId)?.data?.label??Ee.nodeId;navigator.clipboard?.writeText(String(e)),P.success(`Copied`),Ke()},children:`Copy name`}),(0,L.jsx)(R,{size:`sm`,variant:`destructive`,className:`w-full`,onClick:()=>{let e=Ee.nodeId;Me(t=>t.filter(t=>String(t.id)!==e)),Fe(t=>t.filter(t=>String(t.source)!==e&&String(t.target)!==e)),oe===e&&A(``),Ke()},children:`Delete`})]})]})}):null,Oe?(0,L.jsx)(`div`,{className:`absolute z-50`,style:{left:Oe.x,top:Oe.y},onContextMenu:e=>e.preventDefault(),children:(0,L.jsxs)(B,{className:`w-60 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,L.jsxs)(V,{className:`p-3 pb-2`,children:[(0,L.jsx)(H,{className:`text-sm`,children:`Link`}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:Pe.find(e=>String(e.id)===Oe.edgeId)?.label??Oe.edgeId})]}),(0,L.jsxs)(W,{className:`p-3 pt-0 space-y-2`,children:[(0,L.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=Pe.find(e=>String(e.id)===Oe.edgeId);if(!e)return;let t=window.prompt(`Link label`,String(e.label??``));t!=null&&(Fe(e=>e.map(e=>String(e.id)===Oe.edgeId?{...e,label:t}:e)),Ke())},children:`Rename…`}),(0,L.jsx)(R,{size:`sm`,variant:`destructive`,className:`w-full`,onClick:()=>{Fe(e=>e.filter(e=>String(e.id)!==Oe.edgeId)),Ke()},children:`Delete`})]})]})}):null,Ae?(0,L.jsx)(`div`,{className:`absolute z-50`,style:{left:Ae.x,top:Ae.y},onContextMenu:e=>e.preventDefault(),children:(0,L.jsxs)(B,{className:`w-60 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,L.jsx)(V,{className:`p-3 pb-2`,children:(0,L.jsx)(H,{className:`text-sm`,children:`Canvas`})}),(0,L.jsxs)(W,{className:`p-3 pt-0 space-y-2`,children:[(0,L.jsx)(R,{size:`sm`,className:`w-full`,onClick:()=>{We(),Ke()},children:`Add node`}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{Ge(),Ke()},disabled:M.length<2,children:`Auto-layout`}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{ie?.fitView({padding:.15,duration:250}),Ke()},disabled:!ie,children:`Fit view`})]})]})}):null]})]})})]}),(0,L.jsxs)(`div`,{className:`space-y-6`,children:[(0,L.jsxs)(B,{children:[(0,L.jsx)(V,{children:(0,L.jsx)(H,{children:`Lab`})}),(0,L.jsxs)(W,{className:`space-y-3`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Lab name`}),(0,L.jsx)(J,{value:s,onChange:e=>l(e.target.value)})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Workspace`}),(0,L.jsxs)(Y,{value:u,onValueChange:e=>d(e),children:[(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:Qe.isLoading?`Loading…`:`Select workspace…`})}),(0,L.jsx)(Q,{children:(Qe.data?.workspaces??[]).map(e=>(0,L.jsx)($,{value:String(e.id),children:String(e.name??e.slug??e.id)},String(e.id)))})]})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Runtime`}),(0,L.jsxs)(Y,{value:f,onValueChange:e=>p(e),disabled:!u,children:[(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:u?`Select runtime…`:`Select workspace first…`})}),(0,L.jsxs)(Q,{children:[(0,L.jsx)($,{value:`clabernetes`,children:`Clabernetes (in-cluster)`}),(0,L.jsx)($,{value:`containerlab`,children:`Containerlab (BYOS)`})]})]})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Repo path`}),(0,L.jsxs)(`div`,{className:`grid grid-cols-2 gap-2`,children:[(0,L.jsx)(J,{value:x,onChange:e=>S(e.target.value),placeholder:`containerlab/designer`}),(0,L.jsx)(J,{value:C,onChange:e=>w(e.target.value),placeholder:`${s||`lab`}.clab.yml`})]}),(0,L.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,L.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(`${Ve}/${He}`),P.success(`Copied path`)},disabled:!u,children:`Copy path`}),(0,L.jsxs)(R,{size:`sm`,variant:`outline`,onClick:lt,disabled:!u,children:[(0,L.jsx)(Ue,{className:`mr-2 h-4 w-4`}),`Open map`]})]}),(0,L.jsxs)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:[Ve,`/`,He]})]}),(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-3 rounded-lg border p-3`,children:[(0,L.jsxs)(`div`,{className:`min-w-0`,children:[(0,L.jsx)(`div`,{className:`text-sm font-medium`,children:`Use saved config`}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground truncate`,children:y?.workspaceId===u?`${y.filePath} (${y.branch})`:`Auto-saves before deploy`})]}),(0,L.jsx)(Mo,{checked:g,onCheckedChange:e=>_(!!e)})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Netlab server`}),(0,L.jsxs)(Y,{value:m,onValueChange:e=>h(e),disabled:!u||f!==`containerlab`,children:[(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:f===`containerlab`?u?et.isLoading?`Loading…`:`Select server…`:`Select workspace first…`:`Not required for clabernetes…`})}),(0,L.jsx)(Q,{children:(et.data?.servers??[]).map(e=>(0,L.jsx)($,{value:`ws:${String(e.id)}`,children:String(e.name)},String(e.id)))})]})]}),(0,L.jsx)(`div`,{children:(0,L.jsxs)(R,{className:`w-full`,disabled:rt.isPending,onClick:()=>rt.mutate(),children:[(0,L.jsx)(it,{className:`mr-2 h-4 w-4`}),rt.isPending?`Creating…`:`Create deployment + deploy`]})}),(0,L.jsxs)(`div`,{className:`flex items-center justify-between rounded-lg border px-3 py-2`,children:[(0,L.jsxs)(`div`,{className:`min-w-0`,children:[(0,L.jsx)(`div`,{className:`text-sm font-medium`,children:`Open deployment on create`}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Keeps the Designer open in this tab.`})]}),(0,L.jsx)(Mo,{checked:Ce,onCheckedChange:e=>Te(!!e)})]})]})]}),(0,L.jsxs)(B,{children:[(0,L.jsx)(V,{children:(0,L.jsx)(H,{children:`Node`})}),(0,L.jsx)(W,{className:`space-y-4`,children:N?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Name`}),(0,L.jsx)(J,{value:String(N.data?.label??N.id),onChange:e=>{let t=e.target.value;Me(e=>e.map(e=>e.id===N.id?{...e,data:{...e.data,label:t}}:e))}})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Kind`}),(0,L.jsx)(J,{value:String(N.data?.kind??``),onChange:e=>{let t=e.target.value;Me(e=>e.map(e=>e.id===N.id?{...e,data:{...e.data,kind:t}}:e))},placeholder:`linux, ceos, ...`})]}),(0,L.jsx)(Cc,{value:String(N.data?.image??``),onChange:e=>{Me(t=>t.map(t=>t.id===N.id?{...t,data:{...t.data,image:e}}:t))}})]}):(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Click a node to edit.`})})]}),(0,L.jsxs)(B,{children:[(0,L.jsx)(V,{className:`pb-3`,children:(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,L.jsx)(H,{children:`YAML`}),(0,L.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,L.jsxs)(R,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(Be),P.success(`Copied YAML`)},children:[(0,L.jsx)(we,{className:`mr-2 h-4 w-4`}),`Copy`]})})]})}),(0,L.jsxs)(W,{className:`space-y-3`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(R,{size:`sm`,variant:ue===`generated`?`default`:`outline`,onClick:()=>de(`generated`),children:`Generated`}),(0,L.jsx)(R,{size:`sm`,variant:ue===`custom`?`default`:`outline`,onClick:()=>{de(`custom`),fe.trim()||pe(Be)},children:`Custom`})]}),ze.length?(0,L.jsx)(`div`,{className:`rounded-md border bg-amber-500/10 text-amber-900 dark:text-amber-200 px-3 py-2 text-xs`,children:ze.slice(0,6).map(e=>(0,L.jsx)(`div`,{children:e},e))}):null,(0,L.jsx)(Os,{value:ue===`custom`?fe:Re,onChange:e=>pe(e.target.value),readOnly:ue!==`custom`,className:`font-mono text-xs h-[320px]`})]})]})]})]}),(0,L.jsx)(Kn,{open:me,onOpenChange:e=>he(e),children:(0,L.jsxs)(Yn,{children:[(0,L.jsxs)(Xn,{children:[(0,L.jsx)(Qn,{children:`Import template`}),(0,L.jsx)($n,{children:`Load an existing containerlab YAML from templates/blueprints into the editor.`})]}),(0,L.jsxs)(`div`,{className:`space-y-3`,children:[(0,L.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Source`}),(0,L.jsxs)(Y,{value:_e,onValueChange:e=>{let t=e;ve(t),be(t===`workspace`?`containerlab/designer`:`containerlab`),Se(``)},children:[(0,L.jsx)(Z,{children:(0,L.jsx)(X,{})}),(0,L.jsxs)(Q,{children:[(0,L.jsx)($,{value:`blueprints`,children:`Blueprints`}),(0,L.jsx)($,{value:`workspace`,children:`Workspace repo`})]})]})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Directory`}),(0,L.jsx)(J,{value:ye,onChange:e=>be(e.target.value)})]})]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Template`}),(0,L.jsxs)(Y,{value:xe,onValueChange:e=>Se(e),disabled:!u,children:[(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:tt.isLoading?`Loading…`:`Select template…`})}),(0,L.jsx)(Q,{children:(tt.data?.templates??[]).map(e=>(0,L.jsx)($,{value:e,children:e},e))})]}),tt.isError?(0,L.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to list templates`}):null]}),(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(q,{children:`Preview`}),(0,L.jsx)(Os,{value:nt.data?.yaml??``,readOnly:!0,placeholder:xe?nt.isLoading?`Loading preview…`:`No preview`:`Select a template to preview…`,className:`font-mono text-xs h-[220px]`})]})]}),(0,L.jsxs)(Zn,{children:[(0,L.jsx)(R,{variant:`outline`,onClick:()=>he(!1),children:`Cancel`}),(0,L.jsx)(R,{onClick:()=>ot.mutate(),disabled:ot.isPending||!xe,children:`Import`})]})]})})]})}var Fc=Jt,Ic=on,Lc=Nt,Rc=F.forwardRef(({className:e,sideOffset:t=4,...n},r)=>(0,L.jsx)(fn,{ref:r,sideOffset:t,className:I(`z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,e),...n}));Rc.displayName=fn.displayName;var zc=Ln({workspace:zn().optional().catch(``)});const Bc=t(`/dashboard/deployments/new`)({validateSearch:e=>zc.parse(e),component:Uc});var Vc=Ln({workspaceId:zn().min(1,`Workspace is required`),name:zn().min(1,`Deployment name is required`).max(100),kind:Un([`netlab-c9s`,`netlab`,`containerlab`,`clabernetes`,`terraform`,`labpp`]),source:Un([`workspace`,`blueprints`,`external`]),templateRepoId:zn().optional(),template:zn().min(1,`Template is required`),netlabServer:zn().optional(),eveServer:zn().optional(),forwardCollectorId:zn().optional(),variableGroupId:zn().optional(),env:In(Ln({key:zn(),value:zn()})).optional()});function Hc(e){let t=String(e??``).trim();if(!t)return``;try{return new URL(t).hostname||t}catch{return t.replace(/^https?:\/\//,``).split(`/`)[0]??t}}function Uc(){let e=n(),t=c(),{workspace:a}=Bc.useSearch(),[o,s]=(0,F.useState)(!1),[l,u]=(0,F.useState)(!1),[d,f]=(0,F.useState)(`all`);us(!0);let p=i({queryKey:G.dashboardSnapshot(),queryFn:Nr,initialData:()=>t.getQueryData(G.dashboardSnapshot())??null,retry:!1,staleTime:1/0}),m=i({queryKey:G.workspaces(),queryFn:Mr,staleTime:3e4}).data?.workspaces??[],h=Dn({resolver:At(Vc),defaultValues:{workspaceId:a||``,name:``,kind:`netlab-c9s`,source:`blueprints`,templateRepoId:``,template:``,netlabServer:``,eveServer:``,forwardCollectorId:`none`,variableGroupId:`none`,env:[]}}),{watch:g,setValue:_,control:y}=h,{fields:b,append:x,remove:S}=vn({control:y,name:`env`}),C=g(`workspaceId`),w=g(`kind`),T=g(`source`),E=g(`templateRepoId`),D=g(`template`),O=g(`forwardCollectorId`);g(`env`);let ee=p.data?.templatesIndexUpdatedAt??``,k=`skyforge.lastWorkspaceId.deployments`;(0,F.useEffect)(()=>{if(C||m.length===0)return;let e=String(a??``).trim();if(e&&m.some(t=>t.id===e)){_(`workspaceId`,e);return}let t=typeof window<`u`?window.localStorage.getItem(k)??``:``;if(t&&m.some(e=>e.id===t)){_(`workspaceId`,t);return}_(`workspaceId`,m[0].id)},[C,m,_]),(0,F.useEffect)(()=>{if(C&&!(typeof window>`u`))try{window.localStorage.setItem(k,C)}catch{}},[C]),(0,F.useEffect)(()=>{_(`name`,`${(D||w).split(`/`).pop()||w}-${new Date().toISOString().replace(/[-:]/g,``).replace(/\..+/,``).slice(0,15)}`)},[D,w,_]);let te=(0,F.useMemo)(()=>m.find(e=>e.id===C)??null,[C,m]),ne=i({queryKey:G.workspaceNetlabServers(C),queryFn:async()=>Rr(C),enabled:!!C,staleTime:3e4}),re=i({queryKey:[`workspaceEveServers`,C],queryFn:async()=>Vr(C),enabled:!!C,staleTime:3e4}),ie=i({queryKey:[`workspaceVariableGroups`,C],queryFn:async()=>ua(C),enabled:!!C,staleTime:3e4}),ae=i({queryKey:G.userForwardCollectorConfigs(),queryFn:ki,enabled:[`netlab-c9s`,`clabernetes`,`terraform`].includes(w),staleTime:3e4,retry:!1}),oe=(0,F.useMemo)(()=>(ae.data?.collectors??[]).filter(e=>e&&typeof e.id==`string`&&typeof e.name==`string`).filter(e=>!e.decryptionFailed),[ae.data?.collectors]);(0,F.useEffect)(()=>{if(![`netlab-c9s`,`clabernetes`,`terraform`].includes(w)){(O??`none`)!==`none`&&_(`forwardCollectorId`,`none`);return}if((O??`none`)!==`none`)return;let e=oe.find(e=>e.isDefault)??oe[0];e?.id&&_(`forwardCollectorId`,String(e.id))},[w,O,oe,_]);let A=(0,F.useMemo)(()=>w===`netlab`||w===`netlab-c9s`?T===`workspace`?`workspace`:`blueprints`:w===`labpp`?`blueprints`:w===`containerlab`||w===`clabernetes`||w===`terraform`?T:`workspace`,[w,T]),j=i({queryKey:G.workspaceTemplates(C,w,A,E||void 0,void 0),enabled:!!C,queryFn:async()=>{let e={source:A};switch(A===`external`&&E&&(e.repo=E),w){case`netlab`:case`netlab-c9s`:return fi(C,e);case`labpp`:return vi(C,e);case`containerlab`:case`clabernetes`:return hi(C,e);case`terraform`:return gi(C,e);default:return fi(C,e)}},staleTime:5*6e4,refetchOnWindowFocus:!1});(0,F.useEffect)(()=>{ee&&t.invalidateQueries({queryKey:[`workspaceTemplates`]})},[ee,t]);let se=(0,F.useMemo)(()=>{let e=j.data?.templates??[];if(w!==`terraform`)return e;let t=String(d??`all`).trim().toLowerCase();return!t||t===`all`?e:e.filter(e=>String(e).toLowerCase().startsWith(`${t}/`)||String(e).toLowerCase()===t)},[j.data?.templates,d,w]),ce=(0,F.useMemo)(()=>{if(w!==`terraform`)return[];let e=j.data?.templates??[],t=new Set;for(let n of e){let e=String(n??``).split(`/`)[0]?.trim();e&&t.add(e)}return Array.from(t).sort((e,t)=>e.localeCompare(t))},[j.data?.templates,w]);(0,F.useEffect)(()=>{if(w!==`terraform`){f(`all`);return}d!==`all`&&!ce.includes(d)&&f(`all`)},[d,ce,w]);let le=i({queryKey:[`workspaceTemplate`,w,C,A,E,j.data?.dir,D],queryFn:async()=>{if(!C)throw Error(`workspaceId is required`);if(!D)throw Error(`template is required`);let e={source:A};return A===`external`&&E&&(e.repo=E),j.data?.dir&&(e.dir=j.data.dir),w===`containerlab`||w===`clabernetes`?_i(C,{...e,file:D}):pi(C,{...e,template:D})},enabled:o&&!!C&&!!D&&(w===`netlab`||w===`netlab-c9s`||w===`containerlab`||w===`clabernetes`),retry:!1,staleTime:3e4}),ue=(te?.externalTemplateRepos??[]).filter(e=>!!e&&typeof e.id==`string`&&typeof e.repo==`string`),de=!!te?.allowExternalTemplateRepos&&ue.length>0,fe=r({mutationFn:async e=>{let t={template:e.template};if(e.variableGroupId&&e.variableGroupId!==`none`&&(t.envGroupIds=[Number.parseInt(e.variableGroupId,10)]),e.env&&e.env.length>0){let n={};for(let t of e.env)t.key.trim()&&(n[t.key.trim()]=t.value);Object.keys(n).length>0&&(t.environment=n)}if([`netlab-c9s`,`clabernetes`,`terraform`].includes(e.kind)){let n=String(e.forwardCollectorId??`none`).trim();n&&n!==`none`&&(t.forwardEnabled=!0,t.forwardCollectorId=n)}if(e.kind===`netlab`||e.kind===`containerlab`){let n=(e.netlabServer||te?.netlabServer||``).trim();if(!n)throw Error(`netlab server is required`);t.netlabServer=n,t.templateSource=A,A===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),j.data?.dir&&(t.templatesDir=j.data.dir)}if(e.kind===`netlab-c9s`&&(t.templateSource=A,A===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),j.data?.dir&&(t.templatesDir=j.data.dir)),e.kind===`clabernetes`&&(t.templateSource=A,A===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),j.data?.dir&&(t.templatesDir=j.data.dir)),e.kind===`terraform`&&(t.templateSource=A,A===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),j.data?.dir&&(t.templatesDir=j.data.dir)),e.kind===`labpp`){t.templateSource=`blueprints`,j.data?.dir&&(t.templatesDir=j.data.dir);let n=(e.eveServer||``).trim();if(!n)throw Error(`EVE-NG server is required`);t.eveServer=n}let n={name:e.name,type:e.kind,config:t};return yi(e.workspaceId,n)},onSuccess:async(n,r)=>{P.success(`Deployment created successfully`,{description:`${r.name} is now queued for provisioning.`}),await t.invalidateQueries({queryKey:G.dashboardSnapshot()}),await e({to:`/dashboard/deployments`,search:{workspace:r.workspaceId}})},onError:e=>{P.error(`Failed to create deployment`,{description:e.message})}}),pe=r({mutationFn:async()=>{if(!C)throw Error(`Select a workspace first.`);if(!D)throw Error(`Select a template first.`);let e=new Map;for(let t of h.getValues(`env`)||[]){let n=(t?.key??``).trim();n&&e.set(n,String(t?.value??``))}let t=String(h.getValues(`variableGroupId`)??`none`),n=t===`none`?null:Number(t),r={...(n?_e.find(e=>e.id===n)?.variables:void 0)??{}};for(let[t,n]of e.entries())r[t]=n;let i={source:A,template:D,environment:r};return A===`external`&&E&&(i.repo=E),j.data?.dir&&(i.dir=j.data.dir),mi(C,i)},onSuccess:async t=>{let n=String(t?.task?.id??t?.task?.task_id??``).trim();P.success(`Validation queued`,{description:n?`Run ${n} started.`:`Validation run started.`}),n&&e({to:`/dashboard/runs/$runId`,params:{runId:n}})},onError:e=>{P.error(`Validation failed`,{description:String(e?.message??e)})}});function me(e){fe.mutate(e)}let he=ne.data?.servers??[],ge=re.data?.servers??[],_e=ie.data?.groups??[],ve=he.length>0,ye=ge.length>0,be=he.map(e=>({value:`ws:${e.id}`,label:Hc(e.apiUrl)||e.name}));return(0,L.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,L.jsx)(B,{variant:`glass`,children:(0,L.jsx)(V,{children:(0,L.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,L.jsxs)(`div`,{children:[(0,L.jsx)(H,{children:`Create deployment`}),(0,L.jsx)(U,{children:`Configure and launch a new infrastructure deployment.`})]}),(0,L.jsx)(R,{variant:`outline`,onClick:()=>e({to:`/dashboard/deployments`,search:{workspace:C}}),children:`Cancel`})]})})}),(0,L.jsx)(B,{children:(0,L.jsx)(W,{className:`pt-6`,children:(0,L.jsx)(vs,{...h,children:(0,L.jsxs)(`form`,{onSubmit:h.handleSubmit(me),className:`space-y-8`,children:[(0,L.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:[(0,L.jsx)(bs,{control:h.control,name:`workspaceId`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{children:`Workspace`}),(0,L.jsxs)(Y,{onValueChange:e.onChange,defaultValue:e.value,value:e.value,children:[(0,L.jsx)(Ts,{children:(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:`Select workspace`})})}),(0,L.jsx)(Q,{children:m.map(e=>(0,L.jsxs)($,{value:e.id,children:[e.name,` (`,e.slug,`)`]},e.id))})]}),(0,L.jsx)(Ds,{})]})}),(0,L.jsx)(bs,{control:h.control,name:`kind`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{children:`Provider`}),(0,L.jsxs)(Y,{onValueChange:t=>{e.onChange(t),h.setValue(`template`,``)},defaultValue:e.value,children:[(0,L.jsx)(Ts,{children:(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:`Select provider`})})}),(0,L.jsxs)(Q,{children:[(0,L.jsx)($,{value:`netlab-c9s`,children:`Netlab`}),ve&&(0,L.jsx)($,{value:`netlab`,children:`Netlab (BYOS)`}),ye&&(0,L.jsx)($,{value:`labpp`,children:`LabPP`}),ve&&(0,L.jsx)($,{value:`containerlab`,children:`Containerlab (BYOS)`}),(0,L.jsx)($,{value:`clabernetes`,children:`Containerlab`}),(0,L.jsx)($,{value:`terraform`,children:`Terraform`})]})]}),(0,L.jsx)(Ds,{})]})}),[`netlab-c9s`,`clabernetes`,`terraform`].includes(w)&&(0,L.jsx)(bs,{control:h.control,name:`forwardCollectorId`,render:({field:e})=>(0,L.jsxs)(Cs,{className:`rounded-md border p-3 md:col-span-2 space-y-2`,children:[(0,L.jsx)(ws,{children:`Forward collector`}),(0,L.jsxs)(Es,{children:[`Optional. Select a per-user in-cluster Collector. Configure collectors under`,` `,(0,L.jsx)(`code`,{className:`font-mono`,children:`Dashboard → Collector`}),`.`]}),ae.isError?(0,L.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to load collectors.`}):null,ae.data&&oe.length===0?(0,L.jsx)(`div`,{className:`text-xs text-destructive`,children:`No collectors configured yet.`}):null,(0,L.jsxs)(Y,{value:String(e.value??`none`),onValueChange:t=>e.onChange(t),disabled:ae.isLoading,children:[(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:`Select a collector (or None)`})}),(0,L.jsxs)(Q,{children:[(0,L.jsx)($,{value:`none`,children:`None`}),oe.map(e=>(0,L.jsx)($,{value:String(e.id),children:String(e.name)},String(e.id)))]})]})]})}),(0,L.jsx)(bs,{control:h.control,name:`source`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsxs)(ws,{className:`flex items-center gap-2`,children:[`Template source`,(0,L.jsx)(Fc,{children:(0,L.jsxs)(Ic,{children:[(0,L.jsx)(Lc,{asChild:!0,children:(0,L.jsx)(en,{className:`h-4 w-4 text-muted-foreground`})}),(0,L.jsx)(Rc,{children:(0,L.jsx)(`p`,{children:`Git repository or URL containing deployment templates`})})]})})]}),(0,L.jsxs)(Y,{onValueChange:t=>{e.onChange(t),h.setValue(`templateRepoId`,``),h.setValue(`template`,``)},defaultValue:e.value,children:[(0,L.jsx)(Ts,{children:(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:`Select source`})})}),(0,L.jsxs)(Q,{children:[(0,L.jsx)($,{value:`workspace`,children:`Workspace repo`}),(0,L.jsx)($,{value:`blueprints`,children:`Blueprints`}),(0,L.jsx)($,{value:`external`,disabled:!de||w!==`containerlab`&&w!==`clabernetes`&&w!==`terraform`,children:`External repo`})]})]}),!de&&(w===`containerlab`||w===`clabernetes`||w===`terraform`)&&(0,L.jsx)(Es,{children:`External repos disabled or not configured for this workspace.`}),(0,L.jsx)(Ds,{})]})}),A===`external`&&(0,L.jsx)(bs,{control:h.control,name:`templateRepoId`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{children:`External repo`}),(0,L.jsxs)(Y,{onValueChange:t=>{e.onChange(t),h.setValue(`template`,``)},defaultValue:e.value,children:[(0,L.jsx)(Ts,{children:(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:`Select repo…`})})}),(0,L.jsx)(Q,{children:ue.map(e=>(0,L.jsxs)($,{value:e.id,children:[e.name,` (`,e.repo,`)`]},e.id))})]}),(0,L.jsx)(Ds,{})]})}),(w===`netlab`||w===`containerlab`)&&(0,L.jsx)(bs,{control:h.control,name:`netlabServer`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{children:`Netlab server`}),(0,L.jsxs)(Y,{onValueChange:e.onChange,defaultValue:e.value||te?.netlabServer||``,value:e.value||te?.netlabServer||``,children:[(0,L.jsx)(Ts,{children:(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:`Select server…`})})}),(0,L.jsx)(Q,{children:be.map(e=>(0,L.jsx)($,{value:e.value,children:e.label},e.value))})]}),ne.isLoading&&(0,L.jsx)(Es,{children:`Loading servers…`}),(0,L.jsx)(Ds,{})]})}),w===`labpp`&&(0,L.jsx)(bs,{control:h.control,name:`eveServer`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{children:`EVE-NG server`}),(0,L.jsxs)(Y,{onValueChange:e.onChange,defaultValue:e.value||``,value:e.value||``,children:[(0,L.jsx)(Ts,{children:(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:`Select server…`})})}),(0,L.jsx)(Q,{children:ge.map(e=>(0,L.jsx)($,{value:`ws:${e.id}`,children:Hc(e.apiUrl)||e.name},e.id))})]}),re.isLoading&&(0,L.jsx)(Es,{children:`Loading servers…`}),(0,L.jsx)(Ds,{})]})}),(0,L.jsx)(bs,{control:h.control,name:`template`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,L.jsx)(ws,{children:`Template`}),(w===`netlab`||w===`netlab-c9s`||w===`containerlab`||w===`clabernetes`)&&(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(R,{type:`button`,variant:`outline`,size:`sm`,disabled:!D,onClick:()=>s(!0),children:`View`}),w===`netlab`||w===`netlab-c9s`?(0,L.jsx)(R,{type:`button`,variant:`outline`,size:`sm`,disabled:!D||pe.isPending,onClick:()=>pe.mutate(),children:pe.isPending?(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(un,{className:`mr-2 h-3 w-3 animate-spin`}),` `,`Validating…`]}):`Validate`}):null]})]}),w===`terraform`?(0,L.jsxs)(`div`,{className:`grid gap-2 rounded-md border p-3`,children:[(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Terraform templates are grouped by provider (folder name). Select a provider to filter the template list.`}),(0,L.jsxs)(Y,{value:d,onValueChange:e=>f(e),disabled:j.isLoading||ce.length===0&&se.length===0,children:[(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:`Provider filter`})}),(0,L.jsxs)(Q,{children:[(0,L.jsx)($,{value:`all`,children:`All providers`}),ce.map(e=>(0,L.jsx)($,{value:e,children:e},e)),(0,L.jsx)($,{value:`ibm`,disabled:!0,children:`ibm (coming soon)`})]})]})]}):null,(0,L.jsxs)(Y,{onValueChange:e.onChange,defaultValue:e.value,disabled:j.isLoading||se.length===0,children:[(0,L.jsx)(Ts,{children:(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:j.isLoading?`Loading…`:se.length?`Select template…`:`No templates`})})}),(0,L.jsx)(Q,{children:se.map(e=>(0,L.jsx)($,{value:e,children:e},e))})]}),j.isError&&(0,L.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to load templates.`}),(0,L.jsx)(Ds,{})]})}),(0,L.jsx)(bs,{control:h.control,name:`name`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{children:`Deployment name`}),(0,L.jsx)(Ts,{children:(0,L.jsx)(J,{placeholder:`My Deployment`,...e})}),(0,L.jsx)(Es,{children:`Custom name for this specific deployment instance.`}),(0,L.jsx)(Ds,{})]})})]}),(0,L.jsxs)(`div`,{className:`rounded-md border p-4 space-y-4`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,L.jsx)(ws,{children:`Environment Variables`}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(w===`netlab-c9s`||w===`netlab`)&&(0,L.jsx)(R,{type:`button`,variant:`outline`,size:`sm`,onClick:()=>u(!0),children:`Supported NETLAB_ vars`}),(0,L.jsxs)(R,{type:`button`,variant:`outline`,size:`sm`,onClick:()=>x({key:``,value:``}),children:[(0,L.jsx)(v,{className:`mr-2 h-3 w-3`}),` Add Variable`]})]})]}),(0,L.jsx)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:(0,L.jsx)(bs,{control:h.control,name:`variableGroupId`,render:({field:e})=>(0,L.jsxs)(Cs,{children:[(0,L.jsx)(ws,{className:`text-xs text-muted-foreground`,children:`Variable Group`}),(0,L.jsxs)(Y,{onValueChange:e.onChange,defaultValue:e.value||`none`,value:e.value||`none`,children:[(0,L.jsx)(Ts,{children:(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:`None`})})}),(0,L.jsxs)(Q,{children:[(0,L.jsx)($,{value:`none`,children:`None`}),_e.map(e=>(0,L.jsx)($,{value:String(e.id),children:e.name},e.id))]})]})]})})}),b.length>0&&(0,L.jsx)(`div`,{className:`space-y-2`,children:b.map((e,t)=>(0,L.jsxs)(`div`,{className:`flex gap-2 items-start`,children:[w===`netlab-c9s`||w===`netlab`?(0,L.jsx)(bs,{control:h.control,name:`env.${t}.key`,render:({field:e})=>{let t=String(e.value??``).trim(),n=Ms.some(e=>e.key===t)?t:`__custom__`;return(0,L.jsxs)(Cs,{className:`flex-1 space-y-2`,children:[(0,L.jsx)(Ts,{children:(0,L.jsxs)(Y,{value:n,onValueChange:t=>{t===`__custom__`?e.onChange(``):e.onChange(t)},children:[(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:`Select env var…`})}),(0,L.jsxs)(Q,{children:[Ms.map(e=>(0,L.jsx)($,{value:e.key,children:e.label},e.key)),(0,L.jsx)($,{value:`__custom__`,children:`Custom…`})]})]})}),n===`__custom__`&&(0,L.jsx)(Ts,{children:(0,L.jsx)(J,{...e,placeholder:`KEY`,className:`font-mono text-xs`})}),(0,L.jsx)(Ds,{})]})}}):(0,L.jsx)(bs,{control:h.control,name:`env.${t}.key`,render:({field:e})=>(0,L.jsxs)(Cs,{className:`flex-1`,children:[(0,L.jsx)(Ts,{children:(0,L.jsx)(J,{...e,placeholder:`KEY`,className:`font-mono text-xs`})}),(0,L.jsx)(Ds,{})]})}),(0,L.jsx)(bs,{control:h.control,name:`env.${t}.value`,render:({field:e})=>(0,L.jsxs)(Cs,{className:`flex-1`,children:[(0,L.jsx)(Ts,{children:(()=>{let n=String(h.getValues(`env.${t}.key`)??``).trim();if(Ps(n))return(0,L.jsx)(Os,{...e,placeholder:`One \`key=value\` per line.
Example:
addressing.p2p.ipv4=198.18.0.0/16`,className:`font-mono text-xs min-h-[120px]`});let r=Fs(n);if(!r)return(0,L.jsx)(J,{...e,placeholder:`VALUE`,className:`font-mono text-xs`});let i=String(e.value??``).trim(),a=r.some(e=>e.value===i),o=i?a?i:`__custom__`:`none`;return(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsxs)(Y,{value:o,onValueChange:t=>{t===`none`?e.onChange(``):t===`__custom__`?e.onChange(i&&!a?i:``):e.onChange(t)},children:[(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:`Select value…`})}),(0,L.jsxs)(Q,{children:[(0,L.jsx)($,{value:`none`,children:`None`}),r.map(e=>(0,L.jsx)($,{value:e.value,children:e.label},e.value)),(0,L.jsx)($,{value:`__custom__`,children:`Custom…`})]})]}),o===`__custom__`&&(0,L.jsx)(J,{...e,placeholder:`VALUE`,className:`font-mono text-xs`})]})})()}),(0,L.jsx)(Ds,{})]})}),(0,L.jsx)(R,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>S(t),className:`shrink-0`,children:(0,L.jsx)(Mn,{className:`h-4 w-4 text-muted-foreground`})})]},e.id))})]}),(0,L.jsx)(Kn,{open:l,onOpenChange:u,children:(0,L.jsxs)(Yn,{className:`max-w-2xl`,children:[(0,L.jsxs)(Xn,{children:[(0,L.jsx)(Qn,{children:`Supported Netlab overrides`}),(0,L.jsxs)($n,{children:[`These variables are passed into the Netlab generator. Use`,` `,(0,L.jsx)(`span`,{className:`font-mono`,children:`NETLAB_*`}),` for native Netlab defaults, and`,` `,(0,L.jsx)(`span`,{className:`font-mono`,children:`SKYFORGE_NETLAB_SET_OVERRIDES`}),` `,`for generator-only`,` `,(0,L.jsx)(`span`,{className:`font-mono`,children:`netlab --set`}),` overrides.`]})]}),(0,L.jsx)(`div`,{className:`space-y-2 text-sm`,children:Ms.map(e=>(0,L.jsx)(`div`,{className:`flex items-start justify-between gap-3 rounded-md border p-3`,children:(0,L.jsxs)(`div`,{className:`min-w-0`,children:[(0,L.jsx)(`div`,{className:`font-medium`,children:e.label}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono break-all`,children:e.key})]})},e.key))})]})}),fe.isError&&(0,L.jsx)(`div`,{className:`rounded-md bg-destructive/15 p-3 text-sm text-destructive border border-destructive/20`,children:fe.error?.message||`Create failed.`}),(0,L.jsxs)(`div`,{className:`flex gap-3`,children:[(0,L.jsxs)(R,{type:`submit`,disabled:fe.isPending,children:[fe.isPending&&(0,L.jsx)(un,{className:`mr-2 h-4 w-4 animate-spin`}),fe.isPending?`Creating…`:`Create Deployment`]}),(0,L.jsx)(R,{type:`button`,variant:`secondary`,onClick:()=>e({to:`/dashboard/deployments`,search:{workspace:C}}),disabled:fe.isPending,children:`Back`})]})]})})})}),(0,L.jsx)(Kn,{open:o,onOpenChange:s,children:(0,L.jsxs)(Yn,{className:`max-w-4xl`,children:[(0,L.jsxs)(Xn,{children:[(0,L.jsx)(Qn,{children:`Template`}),(0,L.jsx)($n,{className:`font-mono text-xs truncate`,children:String(le.data?.path??D)})]}),(0,L.jsxs)(`div`,{className:`space-y-2`,children:[le.isError&&(0,L.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load template.`}),(0,L.jsx)(Os,{readOnly:!0,value:String(le.data?.yaml??``),className:`h-[60vh] font-mono text-xs`,placeholder:le.isLoading?`Loading…`:`No template loaded.`})]})]})})]})}const Wc=t(`/dashboard/deployments/$deploymentId/`)({component:Gc,validateSearch:e=>{let t={};return typeof e.action==`string`&&e.action.trim()&&(t.action=e.action.trim()),typeof e.node==`string`&&e.node.trim()&&(t.node=e.node.trim()),t}});function Gc(){let{deploymentId:e}=Wc.useParams(),{action:t,node:a}=Wc.useSearch(),o=n(),s=c();us(!0);let[l,u]=(0,F.useState)(!1),[d,f]=(0,F.useState)(!1),[m,h]=(0,F.useState)(``),g=i({queryKey:G.dashboardSnapshot(),queryFn:async()=>null,initialData:null,retry:!1,staleTime:1/0}),_=(0,F.useMemo)(()=>(g.data?.deployments??[]).find(t=>t.id===e),[g.data?.deployments,e]),v=String(_?.workspaceId??``),y=String(_?.type??``);(0,F.useEffect)(()=>{let e=!!(_?.config??{}).forwardEnabled,t=String((_?.config??{}).forwardCollectorId??``).trim();f(e),h(t)},[_?.id,_?.config]);let b=String(_?.activeTaskId??``);Xs(b,!!b);let x=i({queryKey:G.runLogs(b),queryFn:async()=>({cursor:0,entries:[]}),retry:!1,staleTime:1/0,enabled:!!b}),S=async()=>{try{if(!_)throw Error(`deployment not found`);await ia(_.workspaceId,_.id),P.success(`Deployment starting`,{description:`${_.name} is queued to start.`})}catch(e){P.error(`Failed to start`,{description:e.message})}},C=async()=>{try{if(!_)throw Error(`deployment not found`);await aa(_.workspaceId,_.id),P.success(`Deployment stopping`,{description:`${_.name} is queued to stop.`})}catch(e){P.error(`Failed to stop`,{description:e.message})}},T=async()=>{try{if(!_)throw Error(`deployment not found`);await oa(_.workspaceId,_.id),P.success(`Deployment deleted`),await s.invalidateQueries({queryKey:G.dashboardSnapshot()}),o({to:`/dashboard/deployments`,search:{workspace:_.workspaceId}})}catch(e){P.error(`Failed to delete`,{description:e.message})}},D=_?.activeTaskStatus??_?.lastStatus??`unknown`,O=!!_?.activeTaskId,k=(0,F.useMemo)(()=>{if(!_)return[];let e=(g.data?.runs??[]).filter(e=>String(e.workspaceId??``)===_.workspaceId),t=e.filter(e=>String(e.deploymentId??``)===_.id);return t.length>0?t:e},[_,g.data?.runs]),te=i({queryKey:G.deploymentTopology(v,e),queryFn:async()=>{if(!_)throw Error(`deployment not found`);return Ti(_.workspaceId,_.id)},enabled:!!_&&[`containerlab`,`netlab-c9s`,`clabernetes`].includes(y),retry:!1,staleTime:1e4}),ne=r({mutationFn:async e=>{if(!_)throw Error(`deployment not found`);return ui(_.workspaceId,_.id,e)},onSuccess:(e,t)=>{if(e?.skipped){P.message(`Save config skipped`,{description:e.message||`Node ${t}`});return}P.success(`Save config queued/applied`,{description:e.stdout||`Node ${t}`})},onError:e=>P.error(`Save config failed`,{description:e.message})}),re=async()=>{if(!_)return;let e=te.data?.nodes??[];if(!e.length){P.message(`No nodes to save`);return}if(ne.isPending)return;P.message(`Saving configs…`,{description:`Nodes: ${e.length}`});let t=e.map(e=>String(e.id)),n=0,r=0,i=0,a=0;if(await Promise.all(Array.from({length:Math.min(3,t.length)},async()=>{for(;n<t.length;){let e=t[n++];try{(await ui(_.workspaceId,_.id,e))?.skipped?i++:r++}catch{a++}}})),a){P.error(`Save configs finished with errors`,{description:`ok=${r} skipped=${i} failed=${a}`});return}P.success(`Save configs finished`,{description:`ok=${r} skipped=${i}`})},ie=()=>{try{if(!_){P.error(`Cannot download config`,{description:`Deployment not found.`});return}let e=new Blob([JSON.stringify(_.config??{},null,2)],{type:`application/json`}),t=document.createElement(`a`),n=String(_.name??`deployment`).replace(/[^a-zA-Z0-9._-]+/g,`_`);t.href=URL.createObjectURL(e),t.download=`${n}.config.json`,document.body.appendChild(t),t.click(),t.remove(),setTimeout(()=>URL.revokeObjectURL(t.href),5e3),P.success(`Downloaded config`)}catch(e){P.error(`Failed to download config`,{description:e.message})}},oe=i({queryKey:G.userForwardCollectorConfigs(),queryFn:ki,enabled:d,retry:!1,staleTime:3e4}),A=oe.data?.collectors??[],j=r({mutationFn:async e=>{if(!_)throw Error(`deployment not found`);return ei(_.workspaceId,_.id,e)},onSuccess:async()=>{P.success(`Forward settings updated`),await s.invalidateQueries({queryKey:G.dashboardSnapshot()})},onError:e=>P.error(`Failed to update Forward settings`,{description:e.message})}),se=r({mutationFn:async()=>{if(!_)throw Error(`deployment not found`);return ti(_.workspaceId,_.id)},onSuccess:async e=>{P.success(`Forward sync queued`,{description:`Run ${String(e.run?.id??``)}`}),await s.invalidateQueries({queryKey:G.dashboardSnapshot()})},onError:e=>P.error(`Failed to sync to Forward`,{description:e.message})});if(t&&a&&_){if(t===`terminal`)return(0,L.jsx)(`div`,{className:`h-screen w-screen bg-zinc-950 flex flex-col`,children:(0,L.jsx)(sc,{workspaceId:v,deploymentId:e,nodeId:a,className:`flex-1`})});if(t===`logs`)return(0,L.jsx)(`div`,{className:`h-screen w-screen bg-background flex flex-col`,children:(0,L.jsx)(rc,{workspaceId:v,deploymentId:e,nodeId:a,className:`flex-1`})});if(t===`describe`)return(0,L.jsx)(`div`,{className:`h-screen w-screen bg-background flex flex-col`,children:(0,L.jsx)(tc,{workspaceId:v,deploymentId:e,nodeId:a,className:`flex-1`})})}return _?(0,L.jsxs)(`div`,{className:`space-y-6 p-6 pb-20`,children:[(0,L.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,L.jsx)(p,{to:`/dashboard/deployments`,className:mr({variant:`outline`,size:`icon`,className:`h-9 w-9`}),children:(0,L.jsx)(ve,{className:`h-4 w-4`})}),(0,L.jsxs)(`div`,{children:[(0,L.jsxs)(`h1`,{className:`text-2xl font-bold tracking-tight flex items-center gap-3`,children:[_.name,(0,L.jsx)(Kc,{status:D})]}),(0,L.jsxs)(`p`,{className:`text-sm text-muted-foreground flex items-center gap-2 mt-1`,children:[(0,L.jsx)(`span`,{className:`font-mono text-xs bg-muted px-1.5 py-0.5 rounded`,children:_.id}),(0,L.jsx)(`span`,{children:`•`}),(0,L.jsx)(`span`,{className:`capitalize`,children:_.type})]})]})]}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsxs)(R,{variant:`outline`,size:`sm`,onClick:S,disabled:O,children:[(0,L.jsx)(St,{className:`mr-2 h-4 w-4`}),` Start`]}),(0,L.jsxs)(R,{variant:`outline`,size:`sm`,onClick:C,disabled:O,children:[(0,L.jsx)(ae,{className:`mr-2 h-4 w-4`}),` Stop`]}),(0,L.jsxs)(R,{variant:`destructive`,size:`sm`,onClick:()=>u(!0),disabled:O,children:[(0,L.jsx)(Mn,{className:`mr-2 h-4 w-4`}),` Delete`]})]})]}),(0,L.jsxs)(zo,{defaultValue:`topology`,className:`space-y-6`,children:[(0,L.jsxs)(Bo,{children:[(0,L.jsxs)(Vo,{value:`topology`,className:`gap-2`,children:[(0,L.jsx)(sn,{className:`h-4 w-4`}),` Topology`]}),(0,L.jsxs)(Vo,{value:`logs`,className:`gap-2`,children:[(0,L.jsx)(w,{className:`h-4 w-4`}),` Logs & Events`]}),(0,L.jsxs)(Vo,{value:`config`,className:`gap-2`,children:[(0,L.jsx)(E,{className:`h-4 w-4`}),` Configuration`]})]}),(0,L.jsxs)(Ho,{value:`topology`,className:`space-y-6 animate-in fade-in-50`,children:[(0,L.jsxs)(B,{children:[(0,L.jsx)(V,{className:`pb-3`,children:(0,L.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,L.jsxs)(`div`,{children:[(0,L.jsx)(H,{children:`Network Topology`}),(0,L.jsx)(U,{children:_.type===`containerlab`?`Derived from containerlab after deploy (includes resolved mgmt IPs).`:_.type===`netlab-c9s`||_.type===`clabernetes`?`Derived from clabernetes after deploy (includes resolved mgmt IPs).`:`Topology is provider-dependent; not yet implemented for this deployment type.`})]}),(0,L.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,L.jsxs)(R,{variant:`outline`,size:`sm`,onClick:()=>{let e=window.location.pathname,t=e.endsWith(`/`)?e.slice(0,-1):e;window.open(`${t}/map`,`_blank`,`noopener,noreferrer`)},title:`Open the full-screen map view in a new tab`,children:[(0,L.jsx)(Ue,{className:`mr-2 h-4 w-4`}),`Open map`]})})]})}),(0,L.jsx)(W,{children:(0,L.jsx)(fc,{topology:te.data,workspaceId:_.workspaceId,deploymentId:_.id,enableTerminal:[`netlab-c9s`,`clabernetes`].includes(_.type)})})]}),te.data?.nodes?.length?(0,L.jsxs)(B,{children:[(0,L.jsx)(V,{className:`pb-3`,children:(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,L.jsxs)(`div`,{children:[(0,L.jsx)(H,{children:`Nodes`}),(0,L.jsx)(U,{children:`Quick actions (opens in a new tab where applicable).`})]}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,disabled:ne.isPending,onClick:re,children:ne.isPending?`Saving…`:`Save all configs`})]})}),(0,L.jsx)(W,{children:(0,L.jsx)(`div`,{className:`space-y-2`,children:te.data.nodes.map(e=>{let t=String(e.id),n=String(e.kind??``),r=String(e.mgmtIp??``),i=String(e.status??``),a=`${window.location.pathname}?node=${encodeURIComponent(t)}`;return(0,L.jsxs)(`div`,{className:`flex flex-col gap-2 rounded-md border p-3 md:flex-row md:items-center md:justify-between`,children:[(0,L.jsxs)(`div`,{className:`min-w-0`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(`span`,{className:`font-mono text-xs`,children:t}),i?(0,L.jsx)(ao,{variant:`secondary`,className:`capitalize`,children:i}):null,n?(0,L.jsx)(`span`,{className:`text-xs text-muted-foreground truncate`,children:n}):null]}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate mt-1`,children:r||`—`})]}),(0,L.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,L.jsx)(R,{size:`sm`,variant:`outline`,disabled:![`netlab-c9s`,`clabernetes`].includes(_.type),onClick:()=>window.open(`${a}&action=terminal`,`_blank`,`noopener,noreferrer`),children:`Terminal`}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>window.open(`${a}&action=logs`,`_blank`,`noopener,noreferrer`),children:`Logs`}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>window.open(`${a}&action=describe`,`_blank`,`noopener,noreferrer`),children:`Describe`}),(0,L.jsx)(R,{size:`sm`,variant:`outline`,disabled:ne.isPending,onClick:()=>ne.mutate(t),children:ne.isPending?`Saving…`:`Save config`}),(0,L.jsx)(R,{size:`sm`,variant:`ghost`,onClick:()=>{if(!r.trim()){P.error(`No management IP available`);return}navigator.clipboard?.writeText(r),P.success(`Copied management IP`)},children:`Copy IP`})]})]},t)})})})]}):null]}),(0,L.jsx)(Ho,{value:`logs`,className:`space-y-6 animate-in fade-in-50`,children:(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Logs & Events`}),(0,L.jsx)(U,{children:`Live task output.`})]}),(0,L.jsxs)(W,{children:[_.activeTaskId?(0,L.jsxs)(`div`,{className:`space-y-4`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,L.jsxs)(`div`,{className:`text-sm font-medium`,children:[`Active run: `,String(_.activeTaskId)]}),(0,L.jsx)(p,{to:`/dashboard/runs/$runId`,params:{runId:String(_.activeTaskId)},className:mr({variant:`outline`,size:`sm`}),children:`Open run details`})]}),(0,L.jsx)(`div`,{className:`rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100`,children:(0,L.jsx)(qc,{entries:x.data?.entries??[]})})]}):(0,L.jsxs)(`div`,{className:`flex flex-col items-center justify-center py-10 text-center text-muted-foreground border-2 border-dashed rounded-lg`,children:[(0,L.jsx)(w,{className:`h-10 w-10 mb-3 opacity-20`}),(0,L.jsx)(`p`,{children:`No active run.`}),(0,L.jsx)(`p`,{className:`text-xs mt-1`,children:`Start/stop/destroy will queue runs that appear here.`})]}),(0,L.jsxs)(`div`,{className:`mt-8 space-y-3`,children:[(0,L.jsx)(`div`,{className:`text-sm font-medium`,children:`Recent runs`}),(0,L.jsx)(`div`,{className:`space-y-2`,children:k.length===0?(0,L.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No runs yet.`}):k.slice(0,10).map(e=>{let t=String(e.id??``);return(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-3 rounded-md border p-3`,children:[(0,L.jsxs)(`div`,{className:`min-w-0`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsx)(`span`,{className:`font-mono text-xs`,children:t}),(0,L.jsx)(ao,{variant:`secondary`,className:`capitalize`,children:String(e.status??``)}),(0,L.jsx)(`span`,{className:`text-xs text-muted-foreground truncate`,children:String(e.tpl_alias??e.type??``)})]}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground truncate mt-1`,children:String(e.status_text??e.message??``)})]}),(0,L.jsx)(p,{to:`/dashboard/runs/$runId`,params:{runId:t},className:mr({variant:`outline`,size:`sm`}),children:`View`})]},t)})})]})]})]})}),(0,L.jsxs)(Ho,{value:`config`,className:`space-y-6 animate-in fade-in-50`,children:[(0,L.jsxs)(B,{children:[(0,L.jsxs)(V,{children:[(0,L.jsx)(H,{children:`Forward Networks`}),(0,L.jsx)(U,{children:`Optional: sync device IPs into Forward for collection.`})]}),(0,L.jsxs)(W,{className:`space-y-4`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,L.jsxs)(`div`,{className:`space-y-1`,children:[(0,L.jsx)(`div`,{className:`text-sm font-medium`,children:`Enable Forward collection`}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Requires configuring your Collector first.`})]}),(0,L.jsx)(Mo,{checked:d,disabled:j.isPending,onCheckedChange:e=>{f(e);let t=e?m.trim():``;j.mutate({enabled:e,collectorConfigId:t||void 0})}})]}),d?(0,L.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,L.jsxs)(`div`,{className:`space-y-2`,children:[(0,L.jsx)(`div`,{className:`text-sm font-medium`,children:`Collector`}),(0,L.jsxs)(Y,{value:m,onValueChange:e=>{h(e),j.mutate({enabled:!0,collectorConfigId:e})},disabled:oe.isLoading||oe.isError||j.isPending,children:[(0,L.jsx)(Z,{children:(0,L.jsx)(X,{placeholder:oe.isLoading?`Loading…`:oe.isError?`Configure Collector first`:`Select collector…`})}),(0,L.jsx)(Q,{children:A.map(e=>(0,L.jsx)($,{value:e.id,children:e.name},e.id))})]})]}),(0,L.jsx)(`div`,{className:`flex items-end gap-2`,children:(0,L.jsx)(R,{variant:`outline`,onClick:()=>se.mutate(),disabled:!m.trim()||se.isPending||j.isPending,children:se.isPending?`Queueing…`:`Sync now`})})]}):null]})]}),(0,L.jsxs)(B,{children:[(0,L.jsx)(V,{children:(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,L.jsxs)(`div`,{children:[(0,L.jsx)(H,{children:`Configuration`}),(0,L.jsx)(U,{children:`Read-only view of the deployment parameters.`})]}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsxs)(R,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(JSON.stringify(_.config??{},null,2)),P.success(`Copied config JSON`)},children:[(0,L.jsx)(we,{className:`mr-2 h-4 w-4`}),`Copy`]}),(0,L.jsxs)(R,{size:`sm`,variant:`outline`,onClick:ie,children:[(0,L.jsx)(ee,{className:`mr-2 h-4 w-4`}),`Download`]})]})]})}),(0,L.jsx)(W,{children:(0,L.jsx)(`pre`,{className:`bg-muted p-4 rounded-lg overflow-auto font-mono text-xs max-h-[500px]`,children:JSON.stringify(_.config,null,2)})})]})]})]}),(0,L.jsx)(bo,{open:l,onOpenChange:u,children:(0,L.jsxs)(Co,{children:[(0,L.jsxs)(wo,{children:[(0,L.jsx)(Eo,{children:`Delete deployment?`}),(0,L.jsxs)(Do,{children:[`This will remove `,(0,L.jsx)(`strong`,{children:_.name}),` from Skyforge and trigger provider cleanup. This action cannot be undone.`]})]}),(0,L.jsxs)(To,{children:[(0,L.jsx)(ko,{children:`Cancel`}),(0,L.jsx)(Oo,{onClick:T,className:mr({variant:`destructive`}),children:`Delete Deployment`})]})]})})]}):g.isLoading||g.isFetching?(0,L.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,L.jsx)(K,{className:`h-10 w-32`}),(0,L.jsx)(K,{className:`h-10 w-48`})]}),(0,L.jsx)(K,{className:`h-[400px] w-full`})]}):(0,L.jsx)(`div`,{className:`p-6`,children:(0,L.jsx)(Za,{icon:Ke,title:`Deployment not found`,description:`This deployment may have been deleted or you don't have access.`,action:{label:`Back to Deployments`,onClick:()=>o({to:`/dashboard/deployments`})}})})}function Kc({status:e}){let t=`secondary`,n=e.toLowerCase();return[`running`,`active`,`healthy`,`succeeded`,`success`].includes(n)&&(t=`default`),[`failed`,`error`,`stopped`,`crashloopbackoff`].includes(n)&&(t=`destructive`),(0,L.jsx)(ao,{variant:t,className:`capitalize`,children:e})}function qc(e){let t=(0,F.useRef)(null);return(0,F.useEffect)(()=>{let e=t.current;e&&(e.scrollTop=e.scrollHeight)},[e.entries.length]),e.entries.length===0?(0,L.jsx)(`div`,{className:`text-zinc-500`,children:`Waiting for output…`}):(0,L.jsx)(`div`,{ref:t,className:`max-h-[65vh] overflow-auto whitespace-pre-wrap`,children:e.entries.map((e,t)=>(0,L.jsxs)(`div`,{children:[(0,L.jsx)(`span`,{className:`text-zinc-500 select-none`,children:e.time?`${e.time} `:``}),(0,L.jsx)(`span`,{children:e.output})]},`${e.time}-${t}`))})}const Jc=t(`/dashboard/deployments/$deploymentId/map`)({component:Yc});function Yc(){let{deploymentId:e}=Jc.useParams();us(!0);let t=i({queryKey:G.dashboardSnapshot(),queryFn:async()=>null,initialData:null,retry:!1,staleTime:1/0}),n=(0,F.useMemo)(()=>(t.data?.deployments??[]).find(t=>t.id===e),[e,t.data?.deployments]),r=String(n?.workspaceId??``),a=String(n?.type??``),o=n?.activeTaskStatus??n?.lastStatus??`unknown`,s=i({queryKey:G.deploymentTopology(r,e),queryFn:async()=>{if(!n)throw Error(`deployment not found`);return Ti(n.workspaceId,n.id)},enabled:!!n&&[`containerlab`,`netlab-c9s`,`clabernetes`].includes(a),retry:!1,staleTime:1e4});return n?(0,L.jsxs)(`div`,{className:`h-screen w-screen flex flex-col bg-background`,children:[(0,L.jsxs)(`div`,{className:`flex items-center justify-between gap-3 border-b px-4 py-3`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-3 min-w-0`,children:[(0,L.jsx)(p,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e},className:mr({variant:`outline`,size:`icon`,className:`h-9 w-9`}),title:`Back to deployment`,children:(0,L.jsx)(ve,{className:`h-4 w-4`})}),(0,L.jsxs)(`div`,{className:`min-w-0`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-2 min-w-0`,children:[(0,L.jsx)(`div`,{className:`font-semibold truncate`,children:n.name}),(0,L.jsx)(ao,{variant:`secondary`,className:`capitalize`,children:o}),(0,L.jsx)(ao,{variant:`outline`,className:`capitalize`,children:a||`unknown`})]}),(0,L.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:n.id})]})]}),(0,L.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,L.jsxs)(`a`,{href:`/dashboard/labs/designer?workspaceId=${encodeURIComponent(r)}&importDeploymentId=${encodeURIComponent(e)}`,target:`_blank`,rel:`noreferrer noopener`,className:mr({variant:`outline`,size:`sm`}),title:`Open this running topology in the Lab Designer (new tab)`,children:[(0,L.jsx)(jt,{className:`mr-2 h-4 w-4`}),`Edit in Designer`]}),(0,L.jsxs)(p,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e},className:mr({variant:`outline`,size:`sm`}),title:`Open the deployment page`,children:[(0,L.jsx)(Ue,{className:`mr-2 h-4 w-4`}),`Details`]})]})]}),(0,L.jsx)(`div`,{className:`flex-1 min-h-0 p-3`,children:(0,L.jsx)(`div`,{className:`h-full`,children:(0,L.jsx)(fc,{topology:s.data,workspaceId:n.workspaceId,deploymentId:n.id,enableTerminal:[`netlab-c9s`,`clabernetes`].includes(n.type),fullHeight:!0})})})]}):t.isLoading||t.isFetching?(0,L.jsxs)(`div`,{className:`h-screen w-screen p-6`,children:[(0,L.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,L.jsx)(K,{className:`h-9 w-9`}),(0,L.jsx)(K,{className:`h-8 w-64`})]}),(0,L.jsx)(`div`,{className:`mt-6`,children:(0,L.jsx)(K,{className:`h-[75vh] w-full`})})]}):(0,L.jsx)(`div`,{className:`h-screen w-screen p-6`,children:(0,L.jsx)(Za,{title:`Deployment not found`,description:`This deployment may have been deleted or you don't have access.`,action:{label:`Back`,onClick:()=>window.close()}})})}var Xc=$a.update({id:`/webhooks`,path:`/webhooks`,getParentRoute:()=>Ga}),Zc=no.update({id:`/syslog`,path:`/syslog`,getParentRoute:()=>Ga}),Qc=ho.update({id:`/status`,path:`/status`,getParentRoute:()=>Ga}),$c=vo.update({id:`/snmp`,path:`/snmp`,getParentRoute:()=>Ga}),el=No.update({id:`/notifications`,path:`/notifications`,getParentRoute:()=>Ga}),tl=Uo.update({id:`/design`,path:`/design`,getParentRoute:()=>Ga}),nl=Go.update({id:`/`,path:`/`,getParentRoute:()=>Ga}),rl=qo.update({id:`/dashboard/`,path:`/dashboard/`,getParentRoute:()=>Ga}),il=Yo.update({id:`/admin/`,path:`/admin/`,getParentRoute:()=>Ga}),al=Zo.update({id:`/dashboard/servicenow`,path:`/dashboard/servicenow`,getParentRoute:()=>Ga}),ol=$o.update({id:`/dashboard/s3`,path:`/dashboard/s3`,getParentRoute:()=>Ga}),sl=ts.update({id:`/dashboard/forward`,path:`/dashboard/forward`,getParentRoute:()=>Ga}),cl=is.update({id:`/admin/settings`,path:`/admin/settings`,getParentRoute:()=>Ga}),ll=ss.update({id:`/admin/governance`,path:`/admin/governance`,getParentRoute:()=>Ga}),ul=ls.update({id:`/dashboard/workspaces/`,path:`/dashboard/workspaces/`,getParentRoute:()=>Ga}),dl=hs.update({id:`/dashboard/deployments/`,path:`/dashboard/deployments/`,getParentRoute:()=>Ga}),fl=As.update({id:`/dashboard/workspaces/new`,path:`/dashboard/workspaces/new`,getParentRoute:()=>Ga}),pl=Ks.update({id:`/dashboard/workspaces/$workspaceId`,path:`/dashboard/workspaces/$workspaceId`,getParentRoute:()=>Ga}),ml=Zs.update({id:`/dashboard/runs/$runId`,path:`/dashboard/runs/$runId`,getParentRoute:()=>Ga}),hl=bc.update({id:`/dashboard/labs/map`,path:`/dashboard/labs/map`,getParentRoute:()=>Ga}),gl=Oc.update({id:`/dashboard/labs/designer`,path:`/dashboard/labs/designer`,getParentRoute:()=>Ga}),_l=Bc.update({id:`/dashboard/deployments/new`,path:`/dashboard/deployments/new`,getParentRoute:()=>Ga}),vl=Wc.update({id:`/dashboard/deployments/$deploymentId/`,path:`/dashboard/deployments/$deploymentId/`,getParentRoute:()=>Ga}),yl={IndexRoute:nl,DesignRoute:tl,NotificationsRoute:el,SnmpRoute:$c,StatusRoute:Qc,SyslogRoute:Zc,WebhooksRoute:Xc,AdminGovernanceRoute:ll,AdminSettingsRoute:cl,DashboardForwardRoute:sl,DashboardS3Route:ol,DashboardServicenowRoute:al,AdminIndexRoute:il,DashboardIndexRoute:rl,DashboardDeploymentsNewRoute:_l,DashboardLabsDesignerRoute:gl,DashboardLabsMapRoute:hl,DashboardRunsRunIdRoute:ml,DashboardWorkspacesWorkspaceIdRoute:pl,DashboardWorkspacesNewRoute:fl,DashboardDeploymentsIndexRoute:dl,DashboardWorkspacesIndexRoute:ul,DashboardDeploymentsDeploymentIdMapRoute:Jc.update({id:`/dashboard/deployments/$deploymentId/map`,path:`/dashboard/deployments/$deploymentId/map`,getParentRoute:()=>Ga}),DashboardDeploymentsDeploymentIdIndexRoute:vl};const bl=f({routeTree:Ga._addFileChildren(yl)._addFileTypes(),defaultPreload:`intent`,defaultPreloadDelay:50,context:{queryClient:void 0}});var xl=new a({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1,staleTime:1e4}}});Gn.createRoot(document.getElementById(`root`)).render((0,L.jsx)(F.StrictMode,{children:(0,L.jsx)(d,{client:xl,children:(0,L.jsx)(l,{router:bl,context:{queryClient:xl}})})}));