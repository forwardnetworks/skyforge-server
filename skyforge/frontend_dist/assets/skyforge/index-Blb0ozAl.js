import{a as e}from"./rolldown-runtime-DAKAggwm.js";import{a as t,c as n,d as r,f as i,i as a,l as o,m as s,n as c,o as l,p as u,r as d,s as f,t as p,u as m}from"./tanstack-kwSerYzS.js";import{$ as h,$n as g,$t as _,A as v,An as y,At as b,B as x,Bn as S,Bt as ee,C,Cn as te,Ct as w,D as T,Dn as E,Dt as ne,E as D,En as re,Et as O,F as ie,Fn as ae,Ft as oe,G as se,Gn as ce,Gt as le,H as ue,Hn as de,Ht as fe,I as pe,In as me,It as k,J as he,Jn as ge,Jt as _e,K as ve,Kn as ye,Kt as be,L as xe,Ln as Se,Lt as Ce,M as we,Mn as Te,Mt as Ee,N as De,Nn as A,Nt as Oe,O as ke,On as Ae,Ot as je,P as Me,Pn as j,Pt as Ne,Q as Pe,Qn as Fe,Qt as Ie,R as Le,Rn as M,Rt as Re,S as ze,Sn as Be,St as Ve,T as He,Tn as Ue,Tt as We,U as Ge,Un as Ke,Ut as qe,V as Je,Vn as Ye,Vt as Xe,W as Ze,Wn as Qe,Wt as $e,X as et,Xt as tt,Y as nt,Yn as rt,Yt as it,Z as at,Zt as ot,_ as st,_n as ct,_t as lt,a as ut,an as dt,at as ft,b as pt,bn as mt,bt as ht,c as gt,cn as _t,ct as vt,d as yt,dn as bt,dt as xt,en as St,et as Ct,f as wt,fn as Tt,ft as Et,g as Dt,gn as Ot,gt as kt,h as At,hn as jt,ht as Mt,i as Nt,in as Pt,it as Ft,j as It,jn as Lt,jt as Rt,k as zt,kn as Bt,kt as Vt,l as Ht,ln as Ut,lt as Wt,m as Gt,mn as Kt,mt as qt,n as Jt,nn as Yt,nt as N,o as Xt,on as Zt,ot as Qt,p as $t,pn as en,pt as tn,q as nn,qn as rn,qt as an,r as on,rn as sn,rt as cn,s as ln,sn as un,st as dn,t as fn,tn as pn,tt as mn,u as hn,un as gn,ut as _n,v as vn,vn as yn,vt as bn,w as xn,wn as Sn,wt as Cn,x as wn,xn as Tn,xt as En,y as Dn,yn as On,yt as kn,z as An,zn as jn,zt as Mn}from"./react-BJst1MYz.js";import{n as Nn,r as Pn,t as Fn}from"./ui-utils-l2x0dF3k.js";import{a as In,c as Ln,i as Rn,l as zn,n as Bn,o as Vn,r as Hn,s as Un,t as Wn}from"./vendor-BI4_7CPc.js";(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var Gn=e(rt(),1),P=e(g(),1);function F(...e){return Nn(Pn(e))}var I=Fe(),Kn=We,qn=Cn,Jn=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(w,{ref:n,className:F(`fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t}));Jn.displayName=w.displayName;var Yn=P.forwardRef(({className:e,children:t,...n},r)=>(0,I.jsxs)(qn,{children:[(0,I.jsx)(Jn,{}),(0,I.jsxs)(En,{ref:r,className:F(`fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg`,e),...n,children:[t,(0,I.jsxs)(ht,{className:`absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground`,children:[(0,I.jsx)(Vt,{className:`h-4 w-4`}),(0,I.jsx)(`span`,{className:`sr-only`,children:`Close`})]})]})]}));Yn.displayName=En.displayName;var Xn=({className:e,...t})=>(0,I.jsx)(`div`,{className:F(`flex flex-col space-y-1.5 text-center sm:text-left`,e),...t});Xn.displayName=`DialogHeader`;var Zn=({className:e,...t})=>(0,I.jsx)(`div`,{className:F(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});Zn.displayName=`DialogFooter`;var Qn=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(O,{ref:n,className:F(`text-lg font-semibold leading-none tracking-tight`,e),...t}));Qn.displayName=O.displayName;var $n=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(Ve,{ref:n,className:F(`text-sm text-muted-foreground`,e),...t}));$n.displayName=Ve.displayName;var er=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(bn,{ref:n,className:F(`flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground`,e),...t}));er.displayName=bn.displayName;var tr=({children:e,...t})=>(0,I.jsx)(Kn,{...t,children:(0,I.jsx)(Yn,{className:`overflow-hidden p-0 shadow-lg`,children:(0,I.jsx)(er,{className:`[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5`,children:e})})}),nr=P.forwardRef(({className:e,...t},n)=>(0,I.jsxs)(`div`,{className:`flex items-center border-b px-3`,"cmdk-input-wrapper":``,children:[(0,I.jsx)(an,{className:`mr-2 h-4 w-4 shrink-0 opacity-50`}),(0,I.jsx)(bn.Input,{ref:n,className:F(`flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50`,e),...t})]}));nr.displayName=bn.Input.displayName;var rr=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(bn.List,{ref:n,className:F(`max-h-[300px] overflow-y-auto overflow-x-hidden`,e),...t}));rr.displayName=bn.List.displayName;var ir=P.forwardRef((e,t)=>(0,I.jsx)(bn.Empty,{ref:t,className:`py-6 text-center text-sm`,...e}));ir.displayName=bn.Empty.displayName;var ar=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(bn.Group,{ref:n,className:F(`overflow-hidden p-1 text-popover-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground`,e),...t}));ar.displayName=bn.Group.displayName;var or=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(bn.Separator,{ref:n,className:F(`-mx-1 h-px bg-border`,e),...t}));or.displayName=bn.Separator.displayName;var sr=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(bn.Item,{ref:n,className:F(`relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...t}));sr.displayName=bn.Item.displayName;var cr=({className:e,...t})=>(0,I.jsx)(`span`,{className:F(`ml-auto text-xs tracking-widest text-muted-foreground`,e),...t});cr.displayName=`CommandShortcut`;function lr(){let[e,t]=P.useState(!1),r=n();P.useEffect(()=>{let e=e=>{e.key===`k`&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),t(e=>!e))};return document.addEventListener(`keydown`,e),()=>document.removeEventListener(`keydown`,e)},[]);let i=P.useCallback(e=>{t(!1),e()},[]);return(0,I.jsxs)(tr,{open:e,onOpenChange:t,children:[(0,I.jsx)(nr,{placeholder:`Type a command or search...`}),(0,I.jsxs)(rr,{children:[(0,I.jsx)(ir,{children:`No results found.`}),(0,I.jsxs)(ar,{heading:`Suggestions`,children:[(0,I.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/status`})),children:[(0,I.jsx)(gn,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:`Dashboard`})]}),(0,I.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/dashboard/deployments`})),children:[(0,I.jsx)(Tn,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:`Deployments`})]}),(0,I.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/status`})),children:[(0,I.jsx)(ge,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:`Platform Status`})]})]}),(0,I.jsx)(or,{}),(0,I.jsx)(ar,{heading:`Infrastructure`,children:(0,I.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/dashboard/s3`})),children:[(0,I.jsx)(be,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:`Artifacts (S3)`})]})}),(0,I.jsx)(or,{}),(0,I.jsxs)(ar,{heading:`Events & Monitoring`,children:[(0,I.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/notifications`})),children:[(0,I.jsx)(ce,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:`Notifications`})]}),(0,I.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/webhooks`})),children:[(0,I.jsx)(Rt,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:`Webhooks`})]}),(0,I.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/syslog`})),children:[(0,I.jsx)(Kt,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:`Syslog`})]}),(0,I.jsxs)(sr,{onSelect:()=>i(()=>r({to:`/snmp`})),children:[(0,I.jsx)($e,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:`SNMP Traps`})]})]})]})]})}function ur(){let e=o({select:e=>e.status===`pending`}),[t,n]=P.useState(!1);return P.useEffect(()=>{let t;return e?n(!0):t=setTimeout(()=>n(!1),500),()=>clearTimeout(t)},[e]),t?(0,I.jsx)(`div`,{className:F(`fixed top-0 left-0 z-[100] h-1 w-full bg-transparent overflow-hidden`),children:(0,I.jsx)(`div`,{className:F(`h-full w-full bg-primary/80 origin-left animate-progress`)})}):null}var dr=(0,P.createContext)({theme:`system`,setTheme:()=>null});function fr({children:e,defaultTheme:t=`system`,storageKey:n=`vite-ui-theme`}){let[r,i]=(0,P.useState)(()=>localStorage.getItem(n)||t);(0,P.useEffect)(()=>{let e=window.document.documentElement;if(e.classList.remove(`light`,`dark`),r===`system`){let t=window.matchMedia(`(prefers-color-scheme: dark)`).matches?`dark`:`light`;e.classList.add(t);return}e.classList.add(r)},[r]);let a={theme:r,setTheme:e=>{localStorage.setItem(n,e),i(e)}};return(0,I.jsx)(dr.Provider,{value:a,children:e})}const pr=()=>{let e=(0,P.useContext)(dr);if(e===void 0)throw Error(`useTheme must be used within a ThemeProvider`);return e};var mr=Fn(`inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0`,{variants:{variant:{default:`bg-primary text-primary-foreground hover:bg-primary/90`,destructive:`bg-destructive text-destructive-foreground hover:bg-destructive/90`,outline:`border border-input bg-background hover:bg-accent hover:text-accent-foreground`,secondary:`bg-secondary text-secondary-foreground hover:bg-secondary/80`,ghost:`hover:bg-accent hover:text-accent-foreground`,link:`text-primary underline-offset-4 hover:underline`},size:{default:`h-10 px-4 py-2`,sm:`h-9 rounded-md px-3`,lg:`h-11 rounded-md px-8`,icon:`h-10 w-10`}},defaultVariants:{variant:`default`,size:`default`}}),L=P.forwardRef(({className:e,variant:t,size:n,...r},i)=>(0,I.jsx)(`button`,{className:F(mr({variant:t,size:n,className:e})),ref:i,...r}));L.displayName=`Button`;var hr=Et,gr=lt,_r=P.forwardRef(({className:e,inset:t,children:n,...r},i)=>(0,I.jsxs)(kt,{ref:i,className:F(`flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent`,t&&`pl-8`,e),...r,children:[n,(0,I.jsx)(M,{className:`ml-auto h-4 w-4`})]}));_r.displayName=kt.displayName;var vr=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(Mt,{ref:n,className:F(`z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,e),...t}));vr.displayName=Mt.displayName;var yr=P.forwardRef(({className:e,sideOffset:t=4,...n},r)=>(0,I.jsx)(Wt,{children:(0,I.jsx)(Ft,{ref:r,sideOffset:t,className:F(`z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,e),...n})}));yr.displayName=Ft.displayName;var br=P.forwardRef(({className:e,inset:t,...n},r)=>(0,I.jsx)(Qt,{ref:r,className:F(`relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,t&&`pl-8`,e),...n}));br.displayName=Qt.displayName;var xr=P.forwardRef(({className:e,children:t,checked:n,...r},i)=>(0,I.jsxs)(cn,{ref:i,className:F(`relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),checked:n,...r,children:[(0,I.jsx)(`span`,{className:`absolute left-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,I.jsx)(dn,{children:(0,I.jsx)(Ye,{className:`h-4 w-4`})})}),t]}));xr.displayName=cn.displayName;var Sr=P.forwardRef(({className:e,children:t,...n},r)=>(0,I.jsxs)(xt,{ref:r,className:F(`relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...n,children:[(0,I.jsx)(`span`,{className:`absolute left-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,I.jsx)(dn,{children:(0,I.jsx)(j,{className:`h-2 w-2 fill-current`})})}),t]}));Sr.displayName=xt.displayName;var Cr=P.forwardRef(({className:e,inset:t,...n},r)=>(0,I.jsx)(vt,{ref:r,className:F(`px-2 py-1.5 text-sm font-semibold`,t&&`pl-8`,e),...n}));Cr.displayName=vt.displayName;var wr=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(tn,{ref:n,className:F(`-mx-1 my-1 h-px bg-muted`,e),...t}));wr.displayName=tn.displayName;var Tr=({className:e,...t})=>(0,I.jsx)(`span`,{className:F(`ml-auto text-xs tracking-widest opacity-60`,e),...t});Tr.displayName=`DropdownMenuShortcut`;function Er(){let{setTheme:e}=pr();return(0,I.jsxs)(hr,{children:[(0,I.jsx)(gr,{asChild:!0,children:(0,I.jsxs)(L,{variant:`outline`,size:`icon`,children:[(0,I.jsx)(Xe,{className:`h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0`}),(0,I.jsx)(Pt,{className:`absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100`}),(0,I.jsx)(`span`,{className:`sr-only`,children:`Toggle theme`})]})}),(0,I.jsxs)(yr,{align:`end`,children:[(0,I.jsx)(br,{onClick:()=>e(`light`),children:`Light`}),(0,I.jsx)(br,{onClick:()=>e(`dark`),children:`Dark`}),(0,I.jsx)(br,{onClick:()=>e(`system`),children:`System`})]})]})}const Dr=`/api`;function Or(e){let t=e.startsWith(`/`)?e:`/`;return`${Dr}/oidc/login?next=${encodeURIComponent(t)}`}var kr=class extends Error{status;bodyText;constructor(e,t,n){super(e),this.name=`ApiError`,this.status=t,this.bodyText=n}};async function R(e,t){let n=(t?.method??`GET`).toUpperCase(),r=await fetch(`${e}`,{credentials:`include`,...t,headers:{"Content-Type":`application/json`,...t?.headers??{}}});if(r.status===401){let e=await r.text().catch(()=>``);if(n===`GET`&&typeof window<`u`){let e=window.location.pathname+(window.location.search??``);window.location.href=Or(e)}throw new kr(`unauthorized`,r.status,e)}if(r.status===403){let e=await r.text().catch(()=>``);throw new kr(`forbidden`,r.status,e)}if(!r.ok){let e=await r.text().catch(()=>``);throw new kr(`request failed (${r.status})`,r.status,e)}return r.status===204?{}:await r.json()}async function Ar(){return R(`/api/session`)}async function jr(){let e=await fetch(`/auth/logout`,{method:`POST`,credentials:`include`,headers:{"Content-Type":`application/json`},body:`{}`});if(!e.ok){let t=await e.text().catch(()=>``);throw Error(`logout failed (${e.status}): ${t}`)}}async function Mr(){return R(`/api/workspaces`)}async function Nr(){return R(`/api/dashboard/snapshot`)}async function Pr(e,t){let n=new URLSearchParams;t?.include_read&&n.set(`include_read`,t.include_read),t?.limit&&n.set(`limit`,t.limit);let r=n.toString();return R(`/notifications/for-user/${encodeURIComponent(e)}${r?`?${r}`:``}`)}async function Fr(e){return R(`/notifications/for-user/${encodeURIComponent(e)}/read-all`,{method:`PUT`})}async function Ir(e){return R(`/notifications/single/${encodeURIComponent(e)}/read`,{method:`PUT`})}async function Lr(e){return R(`/notifications/single/${encodeURIComponent(e)}`,{method:`DELETE`})}async function Rr(e){return R(`/api/workspaces/${encodeURIComponent(e)}/netlab/servers`)}async function zr(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/netlab/servers`,{method:`PUT`,body:JSON.stringify(t)})}async function Br(e,t){await R(`/api/workspaces/${encodeURIComponent(e)}/netlab/servers/${encodeURIComponent(t)}`,{method:`DELETE`})}async function Vr(e){return R(`/api/workspaces/${encodeURIComponent(e)}/eve/servers`)}async function Hr(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/eve/servers`,{method:`PUT`,body:JSON.stringify(t)})}async function Ur(e,t){await R(`/api/workspaces/${encodeURIComponent(e)}/eve/servers/${encodeURIComponent(t)}`,{method:`DELETE`})}async function Wr(){return R(`/api/user/integrations/servicenow`)}async function Gr(e){return R(`/api/user/integrations/servicenow`,{method:`PUT`,body:JSON.stringify(e)})}async function Kr(){return R(`/api/user/integrations/servicenow/install`,{method:`POST`,body:`{}`})}async function qr(){return R(`/api/user/integrations/servicenow/pdiStatus`)}async function Jr(){return R(`/api/user/integrations/servicenow/schemaStatus`)}async function Yr(){return R(`/api/user/integrations/servicenow/wake`,{method:`POST`,body:`{}`})}async function Xr(){return R(`/api/user/integrations/servicenow/configureForwardTicketing`,{method:`POST`,body:`{}`})}async function Zr(){return R(`/api/user/integrations/gemini`)}async function Qr(){await R(`/api/user/integrations/gemini/disconnect`,{method:`POST`,body:`{}`})}async function $r(){return R(`/api/user/git-credentials`)}async function ei(e){return R(`/api/user/git-credentials`,{method:`PUT`,body:JSON.stringify(e)})}async function ti(){return R(`/api/user/git-credentials/rotate`,{method:`POST`,body:`{}`})}async function ni(){return R(`/api/user/settings`)}async function ri(e){return R(`/api/user/settings`,{method:`PUT`,body:JSON.stringify(e)})}async function ii(){return R(`/api/user/cloud/aws-static`)}async function ai(e){return R(`/api/user/cloud/aws-static`,{method:`PUT`,body:JSON.stringify(e)})}async function oi(){await R(`/api/user/cloud/aws-static`,{method:`DELETE`})}async function si(){return R(`/api/user/cloud/aws-sso`)}async function ci(e){return R(`/api/user/cloud/aws-sso`,{method:`PUT`,body:JSON.stringify(e)})}async function li(){await R(`/api/user/cloud/aws-sso`,{method:`DELETE`})}async function ui(){return R(`/api/user/cloud/azure`)}async function di(e){return R(`/api/user/cloud/azure`,{method:`PUT`,body:JSON.stringify(e)})}async function fi(){await R(`/api/user/cloud/azure`,{method:`DELETE`})}async function pi(){return R(`/api/user/cloud/gcp`)}async function mi(e){return R(`/api/user/cloud/gcp`,{method:`PUT`,body:JSON.stringify(e)})}async function hi(){await R(`/api/user/cloud/gcp`,{method:`DELETE`})}async function gi(){return R(`/api/user/cloud/ibm`)}async function _i(e){return R(`/api/user/cloud/ibm`,{method:`PUT`,body:JSON.stringify(e)})}async function vi(){await R(`/api/user/cloud/ibm`,{method:`DELETE`})}async function yi(){return R(`/api/user/netlab/servers`)}async function bi(e){return R(`/api/user/netlab/servers`,{method:`PUT`,body:JSON.stringify(e)})}async function xi(e){await R(`/api/user/netlab/servers/${encodeURIComponent(e)}`,{method:`DELETE`})}async function Si(){return R(`/api/user/eve/servers`)}async function Ci(e){return R(`/api/user/eve/servers`,{method:`PUT`,body:JSON.stringify(e)})}async function wi(e){await R(`/api/user/eve/servers/${encodeURIComponent(e)}`,{method:`DELETE`})}async function Ti(){return R(`/api/user/containerlab/servers`)}async function Ei(e){return R(`/api/user/containerlab/servers`,{method:`PUT`,body:JSON.stringify(e)})}async function Di(e){await R(`/api/user/containerlab/servers/${encodeURIComponent(e)}`,{method:`DELETE`})}async function Oi(e,t,n){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/forward`,{method:`PUT`,body:JSON.stringify(n)})}async function ki(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/forward/sync`,{method:`POST`,body:`{}`})}async function Ai(e,t,n){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/impair`,{method:`POST`,body:JSON.stringify(n)})}async function ji(e,t,n){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/admin`,{method:`POST`,body:JSON.stringify(n)})}async function Mi(e,t,n){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/capture`,{method:`POST`,body:JSON.stringify(n)})}async function Ni(e,t,n){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/interfaces`)}async function Pi(e,t,n){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/running-config`)}async function Fi(e,t,n=`json`){let r=new URLSearchParams;return r.set(`format`,n),R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/inventory?${r.toString()}`)}async function Ii(e,t,n,r){let i=new URLSearchParams;r?.tail&&i.set(`tail`,String(r.tail)),r?.container&&i.set(`container`,r.container);let a=i.toString();return R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/logs${a?`?${a}`:``}`)}async function Li(e,t,n){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/describe`)}async function Ri(e,t,n){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/nodes/${encodeURIComponent(n)}/save-config`,{method:`POST`,body:`{}`})}async function zi(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/links/stats`)}async function Bi(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return R(`/api/workspaces/${encodeURIComponent(e)}/netlab/templates${r?`?${r}`:``}`)}async function Vi(e,t){let n=new URLSearchParams;return t.source&&n.set(`source`,t.source),t.repo&&n.set(`repo`,t.repo),t.dir&&n.set(`dir`,t.dir),n.set(`template`,t.template),R(`/api/workspaces/${encodeURIComponent(e)}/netlab/template?${n.toString()}`)}async function Hi(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/netlab/validate`,{method:`POST`,body:JSON.stringify(t)})}async function Ui(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return R(`/api/workspaces/${encodeURIComponent(e)}/containerlab/templates${r?`?${r}`:``}`)}async function Wi(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return R(`/api/workspaces/${encodeURIComponent(e)}/terraform/templates${r?`?${r}`:``}`)}async function Gi(e,t){let n=new URLSearchParams;return t.source&&n.set(`source`,t.source),t.repo&&n.set(`repo`,t.repo),t.dir&&n.set(`dir`,t.dir),n.set(`file`,t.file),R(`/api/workspaces/${encodeURIComponent(e)}/containerlab/template?${n.toString()}`)}async function Ki(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return R(`/api/workspaces/${encodeURIComponent(e)}/labpp/templates${r?`?${r}`:``}`)}async function qi(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments`,{method:`POST`,body:JSON.stringify(t)})}async function Ji(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/containerlab/topologies`,{method:`POST`,body:JSON.stringify(t)})}async function Yi(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments-designer/clabernetes/from-template`,{method:`POST`,body:JSON.stringify(t)})}async function Xi(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments-designer/containerlab/from-template`,{method:`POST`,body:JSON.stringify(t)})}async function Zi(e){return R(`/api/workspaces`,{method:`POST`,body:JSON.stringify(e)})}async function Qi(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/members`,{method:`PUT`,body:JSON.stringify(t)})}async function $i(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/topology`)}async function ea(e){let t=new URLSearchParams;e?.q&&t.set(`q`,e.q),e?.n&&t.set(`n`,String(e.n));let n=t.toString();return R(`/api/registry/repos${n?`?${n}`:``}`)}async function ta(e,t){let n=new URLSearchParams;t?.q&&n.set(`q`,t.q);let r=n.toString();return R(`/api/registry/repos/${encodeURIComponent(e)}/tags${r?`?${r}`:``}`)}async function na(e,t){let n=new URLSearchParams;return n.set(`confirm`,t.confirm),t.force&&n.set(`force`,`true`),R(`/api/workspaces/${encodeURIComponent(e)}?${n.toString()}`,{method:`DELETE`})}async function ra(){return R(`/api/forward/collector-configs`)}async function ia(e){return R(`/api/forward/collector-configs`,{method:`POST`,body:JSON.stringify(e)})}async function aa(e){return R(`/api/forward/collector-configs/${encodeURIComponent(e)}`,{method:`DELETE`})}async function oa(e,t){let n=new URLSearchParams;t&&t>0&&n.set(`tail`,String(t));let r=n.toString();return R(`/api/forward/collector-configs/${encodeURIComponent(e)}/logs${r?`?${r}`:``}`)}async function sa(e){return R(`/api/forward/collector-configs/${encodeURIComponent(e)}/restart`,{method:`POST`,body:`{}`})}async function ca(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/settings`,{method:`PUT`,body:JSON.stringify(t)})}async function la(e,t){let n=new URLSearchParams;t?.prefix&&n.set(`prefix`,t.prefix),t?.limit&&n.set(`limit`,t.limit);let r=n.toString();return R(`/api/workspaces/${encodeURIComponent(e)}/artifacts${r?`?${r}`:``}`)}async function ua(e,t){let n=new URLSearchParams({key:t});return R(`/api/workspaces/${encodeURIComponent(e)}/artifacts/download?${n.toString()}`)}async function da(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/artifacts/object`,{method:`POST`,body:JSON.stringify(t)})}async function fa(e,t){let n=new URLSearchParams({key:t});return R(`/api/workspaces/${encodeURIComponent(e)}/artifacts/object?${n.toString()}`,{method:`DELETE`})}async function pa(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/artifacts/folder`,{method:`POST`,body:JSON.stringify({prefix:t})})}async function ma(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit),e?.before_id&&t.set(`before_id`,e.before_id);let n=t.toString();return R(`/api/webhooks/events${n?`?${n}`:``}`)}async function ha(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit),e?.before_id&&t.set(`before_id`,e.before_id),e?.source_ip&&t.set(`source_ip`,e.source_ip),e?.unassigned&&t.set(`unassigned`,e.unassigned);let n=t.toString();return R(`/api/syslog/events${n?`?${n}`:``}`)}async function ga(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit),e?.before_id&&t.set(`before_id`,e.before_id);let n=t.toString();return R(`/api/snmp/traps/events${n?`?${n}`:``}`)}async function _a(){return R(`/api/admin/governance/summary`)}async function va(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString();return R(`/api/admin/governance/resources${n?`?${n}`:``}`)}async function ya(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString();return R(`/api/admin/governance/costs${n?`?${n}`:``}`)}async function ba(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString();return R(`/api/admin/governance/usage${n?`?${n}`:``}`)}async function xa(){await R(`/api/admin/governance/sync`,{method:`POST`,body:`{}`})}async function Sa(){return R(`/api/admin/config`)}async function Ca(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString();return R(`/api/admin/audit${n?`?${n}`:``}`)}async function wa(){return R(`/api/admin/impersonate/status`)}async function Ta(e){return R(`/api/admin/impersonate/start`,{method:`POST`,body:JSON.stringify(e)})}async function Ea(){return R(`/api/admin/impersonate/stop`,{method:`POST`,body:`{}`})}async function Da(e){return R(`/api/admin/tasks/reconcile`,{method:`POST`,body:JSON.stringify(e)})}async function Oa(e){return R(`/api/admin/tasks/reconcile-running`,{method:`POST`,body:JSON.stringify(e)})}async function ka(e){return R(`/api/admin/users/purge`,{method:`POST`,body:JSON.stringify(e)})}async function Aa(){return R(`/api/admin/governance/policy`)}async function ja(e){return R(`/api/admin/governance/policy`,{method:`PUT`,body:JSON.stringify(e)})}async function Ma(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/start`,{method:`POST`,body:`{}`})}async function Na(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/stop`,{method:`POST`,body:`{}`})}async function Pa(e,t,n){let r=new URLSearchParams;n?.forwardDelete&&r.set(`forward_delete`,`true`);let i=r.toString();return R(`/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}${i?`?${i}`:``}`,{method:`DELETE`})}async function Fa(){return R(`/api/ui/config`)}async function Ia(){return R(`/status/summary`)}async function La(e,t){let n=new URLSearchParams;return t&&n.set(`workspace_id`,t),R(`/api/runs/${encodeURIComponent(String(e))}/cancel${n.toString()?`?${n.toString()}`:``}`,{method:`POST`,body:`{}`})}async function Ra(e){return R(`/api/workspaces/${encodeURIComponent(e)}/variable-groups`)}async function za(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/variable-groups`,{method:`POST`,body:JSON.stringify(t)})}async function Ba(e,t,n){return R(`/api/workspaces/${encodeURIComponent(e)}/variable-groups/${encodeURIComponent(t)}`,{method:`PUT`,body:JSON.stringify(n)})}async function Va(e,t){return R(`/api/workspaces/${encodeURIComponent(e)}/variable-groups/${encodeURIComponent(t)}`,{method:`DELETE`})}var Ha=[{label:`Dashboard`,href:`/status`,icon:gn},{label:`Deployments`,href:`/dashboard/deployments`,icon:Tn},{label:`Runs`,href:`/dashboard/runs`,icon:Yt},{label:`Workspaces`,href:`/dashboard/workspaces`,icon:Oe},{label:`Designer`,href:`/dashboard/labs/designer`,icon:jt,newTab:!0},{label:`Integrations`,href:``,icon:b,children:[{label:`Collector (Forward)`,href:`/dashboard/forward`,icon:Ie},{label:`ServiceNow`,href:`/dashboard/servicenow`,icon:b},{label:`Artifacts`,href:`/dashboard/s3`,icon:be}]},{label:`Connect AI`,href:``,icon:fe,children:[{label:`Gemini`,href:`/dashboard/gemini`,icon:fe},{label:`ChatGPT`,href:`/dashboard/chatgpt`,icon:fe},{label:`Claude`,href:`/dashboard/claude`,icon:fe}]},{label:`My Settings`,href:`/dashboard/settings`,icon:le},{label:`Tools`,href:``,icon:Bt,children:[{label:`NetBox`,href:`/netbox/`,icon:sn,external:!0},{label:`Nautobot`,href:`/nautobot/`,icon:sn,external:!0}]},{label:`Webhooks`,href:`/webhooks`,icon:Rt},{label:`Syslog`,href:`/syslog`,icon:Kt},{label:`SNMP`,href:`/snmp`,icon:$e},{label:`Git`,href:`/git/`,icon:ct,external:!0},{label:`DNS`,href:`${Dr}/dns/sso?next=/dns/`,icon:sn,external:!0},{label:`Coder`,href:`/coder/launch`,icon:A,external:!0},{label:`Coder Admin`,href:`/coder/`,icon:A,external:!0,adminOnly:!0},{label:`API Testing`,href:`${Dr}/yaade/sso`,icon:Yt,external:!0},{label:`Docs`,href:`/dashboard/docs`,icon:Qe},{label:`Admin Settings`,href:`/admin/settings`,icon:le,adminOnly:!0},{label:`Governance`,href:`/admin/governance`,icon:$e,adminOnly:!0}];function Ua(e){let t=o({select:e=>e.location.pathname}),[n,r]=(0,P.useState)({SSOT:!0}),i=`_blank`,a=`noreferrer noopener`,s=e=>!!e.external||!!e.newTab,c=e=>e?e===`/`?t===`/`:e.endsWith(`/`)?t.startsWith(e):t===e||t.startsWith(`${e}/`):!1,l=e=>{r(t=>({...t,[e]:!t[e]}))};return(0,I.jsx)(`nav`,{className:`grid items-start gap-2`,children:(0,I.jsxs)(`div`,{className:`space-y-2`,children:[e.collapsed?null:(0,I.jsx)(`h4`,{className:`px-3 text-xs font-semibold uppercase tracking-wide text-muted-foreground`,children:`Overview`}),(0,I.jsx)(`div`,{className:`grid gap-1`,children:Ha.filter(t=>t.adminOnly?!!e.isAdmin:!0).flatMap(t=>{let n=e.features;if(!n)return[t];if(t.label===`Git`&&!n.giteaEnabled||t.label===`DNS`&&!n.dnsEnabled||t.label===`Coder`&&!n.coderEnabled||t.label===`Coder Admin`&&!n.coderEnabled||t.label===`API Testing`&&!n.yaadeEnabled||t.label===`Collector (Forward)`&&!n.forwardEnabled||t.label===`Artifacts`&&!n.minioEnabled)return[];if(t.label===`Integrations`){let e=t.children?.filter(e=>e.label===`Collector (Forward)`?!!n.forwardEnabled:e.label===`Artifacts`?!!n.minioEnabled:!0)??[];return e.length===0?[]:[{...t,children:e}]}if(t.label===`Tools`){let e=t.children?.filter(e=>e.label===`NetBox`?!!n.netboxEnabled:e.label===`Nautobot`?!!n.nautobotEnabled:!0)??[];return e.length===0?[]:[{...t,children:e}]}return[t]}).map(t=>{let r=t.icon;if(t.children){let o=t.children.some(e=>c(e.href)),s=n[t.label];return e.collapsed?(0,I.jsxs)(hr,{children:[(0,I.jsx)(gr,{asChild:!0,children:(0,I.jsx)(`button`,{className:F(`group flex items-center justify-center rounded-md px-2 py-2 text-sm font-medium transition-colors w-full`,`hover:bg-accent hover:text-accent-foreground`,o?`bg-accent text-accent-foreground`:`transparent`),title:t.label,children:(0,I.jsx)(r,{className:`h-5 w-5`})})}),(0,I.jsxs)(yr,{side:`right`,align:`start`,sideOffset:10,children:[(0,I.jsx)(Cr,{children:t.label}),(0,I.jsx)(wr,{}),t.children.map(e=>(0,I.jsx)(br,{asChild:!0,children:e.external?(0,I.jsxs)(`a`,{href:e.href,target:i,rel:a,className:`flex items-center gap-2 cursor-pointer w-full`,children:[(0,I.jsx)(e.icon,{className:`h-4 w-4 mr-2`}),e.label]}):(0,I.jsxs)(f,{to:e.href,className:`flex items-center gap-2 cursor-pointer w-full`,children:[(0,I.jsx)(e.icon,{className:`h-4 w-4 mr-2`}),e.label]})},e.href))]})]},t.label):(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsxs)(`button`,{onClick:()=>l(t.label),className:F(`group flex w-full items-center justify-between rounded-md px-3 py-2 text-sm font-medium transition-colors`,`hover:bg-accent hover:text-accent-foreground`,o?`text-foreground font-semibold`:`text-muted-foreground`),children:[(0,I.jsxs)(`div`,{className:`flex items-center`,children:[(0,I.jsx)(r,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:t.label})]}),s?(0,I.jsx)(S,{className:`h-4 w-4 opacity-50`}):(0,I.jsx)(M,{className:`h-4 w-4 opacity-50`})]}),s&&(0,I.jsx)(`div`,{className:`grid gap-1 pl-4 border-l ml-4 border-border/50`,children:t.children.map(e=>{let t=c(e.href),n=e.icon,r=F(`group flex items-center rounded-md px-3 py-2 text-sm font-medium transition-colors`,`hover:bg-accent hover:text-accent-foreground`,t?`bg-accent text-accent-foreground`:`text-muted-foreground`);return e.external?(0,I.jsxs)(`a`,{href:e.href,target:i,rel:a,className:r,children:[(0,I.jsx)(n,{className:`mr-2 h-4 w-4 opacity-70 group-hover:opacity-100`}),(0,I.jsx)(`span`,{children:e.label})]},e.href):(0,I.jsxs)(f,{to:e.href,className:r,children:[(0,I.jsx)(n,{className:`mr-2 h-4 w-4 opacity-70 group-hover:opacity-100`}),(0,I.jsx)(`span`,{children:e.label})]},e.href)})})]},t.label)}let o=F(`group flex items-center rounded-md px-3 py-2 text-sm font-medium transition-colors`,`hover:bg-accent hover:text-accent-foreground`,c(t.href)?`bg-accent`:`transparent`,e.collapsed&&`justify-center px-2`),u=F(`transition-transform duration-200 group-hover:scale-110 group-hover:text-primary`,e.collapsed?`h-5 w-5`:`mr-2 h-4 w-4`);return t.external?(0,I.jsxs)(`a`,{href:t.href,target:i,rel:a,className:o,title:e.collapsed?t.label:void 0,children:[(0,I.jsx)(r,{className:u}),e.collapsed?null:(0,I.jsx)(`span`,{children:t.label})]},t.href):(0,I.jsxs)(f,{to:t.href,className:o,title:e.collapsed?t.label:void 0,target:s(t)?i:void 0,rel:s(t)?a:void 0,children:[(0,I.jsx)(r,{className:u}),e.collapsed?null:(0,I.jsx)(`span`,{children:t.label})]},t.href)})})]})})}var Wa=P.forwardRef(({...e},t)=>(0,I.jsx)(`nav`,{ref:t,"aria-label":`breadcrumb`,...e}));Wa.displayName=`Breadcrumb`;var Ga=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`ol`,{ref:n,className:F(`flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5`,e),...t}));Ga.displayName=`BreadcrumbList`;var Ka=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`li`,{ref:n,className:F(`inline-flex items-center gap-1.5`,e),...t}));Ka.displayName=`BreadcrumbItem`;var qa=P.forwardRef(({asChild:e,className:t,...n},r)=>(0,I.jsx)(e?kn:`a`,{ref:r,className:F(`transition-colors hover:text-foreground`,t),...n}));qa.displayName=`BreadcrumbLink`;var Ja=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`span`,{ref:n,role:`link`,"aria-disabled":`true`,"aria-current":`page`,className:F(`font-normal text-foreground`,e),...t}));Ja.displayName=`BreadcrumbPage`;var Ya=({children:e,className:t,...n})=>(0,I.jsx)(`li`,{role:`presentation`,"aria-hidden":`true`,className:F(`[&>svg]:size-3.5`,t),...n,children:e??(0,I.jsx)(M,{})});Ya.displayName=`BreadcrumbSeparator`;var Xa=({className:e,...t})=>(0,I.jsxs)(`span`,{role:`presentation`,"aria-hidden":`true`,className:F(`flex h-9 w-9 items-center justify-center`,e),...t,children:[(0,I.jsx)(re,{className:`h-4 w-4`}),(0,I.jsx)(`span`,{className:`sr-only`,children:`More`})]});Xa.displayName=`BreadcrumbEllipsis`;var Za=Fn(`rounded-lg border text-card-foreground shadow-sm`,{variants:{variant:{default:`bg-card`,elevated:`bg-card shadow-lg`,gradient:`bg-gradient-to-br from-card to-card/60`,glass:`bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60`,glow:`bg-card shadow-lg shadow-primary/10`,interactive:`bg-card hover:shadow-md transition-shadow cursor-pointer`,success:`border-green-500/50 bg-green-500/5`,warning:`border-amber-500/50 bg-amber-500/5`,danger:`border-red-500/50 bg-red-500/5`,info:`border-blue-500/50 bg-blue-500/5`,flat:`bg-card shadow-none`},size:{default:``,compact:`p-3`,comfortable:`p-6`}},defaultVariants:{variant:`default`,size:`default`}}),z=P.forwardRef(({className:e,variant:t,size:n,...r},i)=>(0,I.jsx)(`div`,{ref:i,className:F(Za({variant:t,size:n,className:e})),...r}));z.displayName=`Card`;var B=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`div`,{ref:n,className:F(`flex flex-col space-y-1.5 p-6`,e),...t}));B.displayName=`CardHeader`;var V=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`div`,{ref:n,className:F(`text-2xl font-semibold leading-none tracking-tight`,e),...t}));V.displayName=`CardTitle`;var H=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`div`,{ref:n,className:F(`text-sm text-muted-foreground`,e),...t}));H.displayName=`CardDescription`;var U=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`div`,{ref:n,className:F(`p-6 pt-0`,e),...t}));U.displayName=`CardContent`;var Qa=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`div`,{ref:n,className:F(`flex items-center p-6 pt-0`,e),...t}));Qa.displayName=`CardFooter`;var $a=We,eo=ne,to=Cn,no=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(w,{className:F(`fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t,ref:n}));no.displayName=w.displayName;var ro=Fn(`fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500`,{variants:{side:{top:`inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top`,bottom:`inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom`,left:`inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm`,right:`inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm`}},defaultVariants:{side:`right`}}),io=P.forwardRef(({side:e=`right`,className:t,children:n,...r},i)=>(0,I.jsxs)(to,{children:[(0,I.jsx)(no,{}),(0,I.jsxs)(En,{ref:i,className:F(ro({side:e}),t),...r,children:[n,(0,I.jsxs)(ht,{className:`absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary`,children:[(0,I.jsx)(Vt,{className:`h-4 w-4`}),(0,I.jsx)(`span`,{className:`sr-only`,children:`Close`})]})]})]}));io.displayName=En.displayName;var ao=({className:e,...t})=>(0,I.jsx)(`div`,{className:F(`flex flex-col space-y-2 text-center sm:text-left`,e),...t});ao.displayName=`SheetHeader`;var oo=({className:e,...t})=>(0,I.jsx)(`div`,{className:F(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});oo.displayName=`SheetFooter`;var so=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(O,{ref:n,className:F(`text-lg font-semibold text-foreground`,e),...t}));so.displayName=O.displayName;var co=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(Ve,{ref:n,className:F(`text-sm text-muted-foreground`,e),...t}));co.displayName=Ve.displayName;var lo=({...e})=>(0,I.jsx)(mn,{className:`toaster group`,toastOptions:{classNames:{toast:`group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg`,description:`group-[.toast]:text-muted-foreground`,actionButton:`group-[.toast]:bg-primary group-[.toast]:text-primary-foreground`,cancelButton:`group-[.toast]:bg-muted group-[.toast]:text-muted-foreground`}},...e});async function uo(){try{let e=await fetch(`/api/session`,{credentials:`include`,headers:{"Content-Type":`application/json`}});return e.ok?await e.json():null}catch{return null}}async function fo(e){if(typeof window>`u`)return!1;let t=e.pollIntervalMs??750,n=e.timeoutMs??2*6e4;if((await uo())?.authenticated)return!0;let r=Math.max(0,Math.floor((window.screen.width-520)/2)),i=Math.max(0,Math.floor((window.screen.height-720)/2)),a=[`popup=yes`,`width=520`,`height=720`,`left=${r}`,`top=${i}`].join(`,`),o=window.open(e.loginHref,`skyforge_login`,a);if(!o)return!1;try{o.focus()}catch{}return await new Promise(e=>{let r=Date.now(),i=window.setInterval(async()=>{try{if(o.closed){window.clearInterval(i),e(!1);return}if(Date.now()-r>n){window.clearInterval(i);try{o.close()}catch{}e(!1);return}if((await uo())?.authenticated){window.clearInterval(i);try{o.close()}catch{}e(!0)}}catch{}},t)})}const W={session:()=>[`session`],uiConfig:()=>[`uiConfig`],dashboardSnapshot:()=>[`dashboardSnapshot`],statusSummary:()=>[`statusSummary`],runLogs:e=>[`runLogs`,e],deploymentTopology:(e,t)=>[`deploymentTopology`,e,t],deploymentUIEvents:(e,t)=>[`deploymentUIEvents`,e,t],workspaces:()=>[`workspaces`],workspaceForwardConfig:e=>[`workspaceForwardConfig`,e],workspaceForwardCollectors:e=>[`workspaceForwardCollectors`,e],forwardCollectors:()=>[`forwardCollectors`],userForwardCollector:()=>[`userForwardCollector`],userCollectorRuntime:()=>[`userCollectorRuntime`],userCollectorLogs:()=>[`userCollectorLogs`],userGitCredentials:()=>[`userGitCredentials`],userSettings:()=>[`userSettings`],userNetlabServers:()=>[`userNetlabServers`],userEveServers:()=>[`userEveServers`],userContainerlabServers:()=>[`userContainerlabServers`],userAwsStaticCredentials:()=>[`userAwsStaticCredentials`],userAwsSsoCredentials:()=>[`userAwsSsoCredentials`],userAzureCredentials:()=>[`userAzureCredentials`],userGcpCredentials:()=>[`userGcpCredentials`],userIbmCredentials:()=>[`userIbmCredentials`],userForwardCollectorConfigs:()=>[`userForwardCollectorConfigs`],userForwardCollectorConfigRuntime:e=>[`userForwardCollectorConfigRuntime`,e],userForwardCollectorConfigLogs:e=>[`userForwardCollectorConfigLogs`,e],userServiceNowConfig:()=>[`userServiceNowConfig`],userServiceNowPdiStatus:()=>[`userServiceNowPdiStatus`],userServiceNowSchemaStatus:()=>[`userServiceNowSchemaStatus`],userGeminiConfig:()=>[`userGeminiConfig`],storageFiles:()=>[`storageFiles`],workspaceArtifacts:e=>[`workspaceArtifacts`,e],workspaceEveServers:e=>[`workspaceEveServers`,e],workspaceNetlabServers:e=>[`workspaceNetlabServers`,e],notifications:(e,t)=>[`notifications`,e?`1`:`0`,t??``],syslogEvents:e=>[`syslogEvents`,e??``],snmpTrapEvents:e=>[`snmpTrapEvents`,e??``],workspaceTemplates:(e,t,n,r,i)=>[`workspaceTemplates`,e,t,n,r??``,i??``],pkiRoot:()=>[`pkiRoot`],pkiCerts:()=>[`pkiCerts`],pkiSshRoot:()=>[`pkiSshRoot`],pkiSshCerts:()=>[`pkiSshCerts`],webhookEvents:e=>[`webhookEvents`,e??``],notificationSettings:()=>[`notificationSettings`],governanceSummary:()=>[`governanceSummary`],governanceResources:e=>[`governanceResources`,e??``],governanceCosts:e=>[`governanceCosts`,e??``],governanceUsage:e=>[`governanceUsage`,e??``],governancePolicy:()=>[`governancePolicy`],adminConfig:()=>[`adminConfig`],adminAudit:e=>[`adminAudit`,e??``],adminImpersonateStatus:()=>[`adminImpersonateStatus`],registryRepos:e=>[`registryRepos`,e],registryTags:(e,t)=>[`registryTags`,e,t]};var po=new Map;function mo(e){for(let[t,n]of e.handlers.entries())for(let r of n.values())e.es.addEventListener(t,r)}function ho(e){let t=new EventSource(e.url,{withCredentials:!0});return t.onopen=()=>{e.retryMs=500},t.onerror=()=>{if(e.closed||e.reconnectTimer)return;try{t.close()}catch{}let n=e.retryMs;e.retryMs=Math.min(e.retryMs*2,15e3),e.reconnectTimer=window.setTimeout(()=>{e.reconnectTimer=void 0,!e.closed&&(e.es=ho(e),mo(e))},n)},t}function go(e){let t=po.get(e);if(t)return t.refs+=1,t;let n={url:e,es:void 0,refs:1,handlers:new Map,retryMs:500,closed:!1};return n.es=ho(n),po.set(e,n),n}function _o(e){let t=po.get(e);if(t&&(--t.refs,!(t.refs>0))){po.delete(e),t.closed=!0,t.reconnectTimer&&=(window.clearTimeout(t.reconnectTimer),void 0);try{t.es.close()}catch{}}}function vo(e,t){let n=go(e);for(let[e,r]of Object.entries(t)){let t=n.handlers.get(e);t||(t=new Set,n.handlers.set(e,t)),t.add(r),n.es.addEventListener(e,r)}return{close:()=>{for(let[e,r]of Object.entries(t)){try{n.es.removeEventListener(e,r)}catch{}let t=n.handlers.get(e);t&&(t.delete(r),t.size===0&&n.handlers.delete(e))}_o(e)}}}function yo(e,t,n){let r=u(),i=(0,P.useMemo)(()=>{let e=new URLSearchParams;return e.set(`include_read`,t?`true`:`false`),e.set(`limit`,n),`${Dr}/notifications/events?${e.toString()}`},[t,n]);(0,P.useEffect)(()=>{if(!e)return;let a=vo(i,{snapshot:e=>{try{let i=JSON.parse(e.data);if(!i||!Array.isArray(i.notifications))return;r.setQueryData(W.notifications(t,n),i)}catch{}}});return()=>{a.close()}},[e,t,n,r,i])}const G=l()({component:bo,errorComponent:So,notFoundComponent:xo});function bo(){let e=o({select:e=>e.location}),t=n(),i=u(),[s,c]=(0,P.useState)(!1),[l,d]=(0,P.useState)(!1),[f,p]=(0,P.useState)(!1),[m,h]=(0,P.useState)(!1),g=(0,P.useMemo)(()=>e.pathname===`/dashboard/labs/designer`,[e.pathname]),_=(0,P.useMemo)(()=>g||e.pathname===`/dashboard/labs/map`,[g,e.pathname]);(0,P.useEffect)(()=>{g&&p(!0)},[g]),(0,P.useEffect)(()=>{window.location.pathname===`/index.html`&&t({to:`/`,replace:!0})},[t]);let v=r({queryKey:W.session(),queryFn:Ar,retry:!1,staleTime:3e4}),y=r({queryKey:W.uiConfig(),queryFn:Fa,staleTime:5*6e4}),b=y.data?.productName||`Skyforge`,x=y.data?.productSubtitle||`Automation Platform`,S=(0,P.useMemo)(()=>`${e.pathname}${e.searchStr??``}${e.hash??``}`,[e.pathname,e.searchStr,e.hash]),ee=(0,P.useMemo)(()=>Or(S),[S]),C=(0,P.useMemo)(()=>[`/dashboard`,`/admin`,`/webhooks`,`/syslog`,`/snmp`].some(t=>e.pathname.startsWith(t)),[e.pathname]);(0,P.useEffect)(()=>{h(!1)},[e.pathname]);let te=v.data?.displayName||v.data?.username||``,w=!!v.data?.isAdmin,T=C&&!v.isLoading&&!v.data?.authenticated,E=v.data?.username??``;yo(!!E,!1,`20`);let ne=r({queryKey:W.notifications(!1,`20`),enabled:!!E,queryFn:async()=>({notifications:(await Pr(E,{include_read:`false`,limit:`20`})).notifications??[]}),staleTime:1/0,initialData:{notifications:[]}}),D=(0,P.useMemo)(()=>(ne.data?.notifications??[]).filter(e=>!e.is_read).length,[ne.data?.notifications]);return(0,I.jsx)(fr,{defaultTheme:`dark`,storageKey:`vite-ui-theme`,children:(0,I.jsxs)(`div`,{className:`min-h-full`,children:[(0,I.jsx)(ur,{}),(0,I.jsx)(`header`,{className:`sticky top-0 z-40 border-b glass-header`,children:(0,I.jsxs)(`div`,{className:`mx-auto flex h-16 max-w-[1600px] items-center justify-between gap-4 px-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-6`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,I.jsxs)($a,{open:m,onOpenChange:h,children:[(0,I.jsx)(eo,{asChild:!0,children:(0,I.jsxs)(L,{variant:`ghost`,size:`icon`,className:`lg:hidden`,children:[(0,I.jsx)(dt,{className:`h-5 w-5`}),(0,I.jsx)(`span`,{className:`sr-only`,children:`Toggle menu`})]})}),(0,I.jsx)(io,{side:`left`,className:`w-[240px] p-0`,children:(0,I.jsx)(`div`,{className:`px-2 py-6`,children:(0,I.jsx)(Ua,{collapsed:!1,isAdmin:w,features:y.data?.features})})})]}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`text-[10px] uppercase tracking-wider text-muted-foreground leading-none`,children:x}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2 text-base font-semibold tracking-tight`,children:[(0,I.jsx)(rn,{className:`h-5 w-5 text-primary`}),(0,I.jsx)(`span`,{children:b})]})]}),(0,I.jsx)(`div`,{className:`h-8 w-px bg-border hidden md:block`}),(0,I.jsx)(`img`,{src:`/assets/skyforge/FN-logo.svg`,alt:`Forward Networks`,className:`h-6 w-auto hidden sm:block`})]}),(0,I.jsxs)(L,{variant:`outline`,className:`hidden md:flex h-9 w-64 items-center justify-start px-3 text-sm text-muted-foreground font-normal`,onClick:()=>{let e=new KeyboardEvent(`keydown`,{key:`k`,metaKey:!0,bubbles:!0});document.dispatchEvent(e)},children:[(0,I.jsx)(an,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:`Search...`}),(0,I.jsxs)(`kbd`,{className:`pointer-events-none ml-auto inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100`,children:[(0,I.jsx)(`span`,{className:`text-xs`,children:``}),`K`]})]})]}),(0,I.jsxs)(`nav`,{className:`flex items-center gap-4 text-sm`,children:[(0,I.jsxs)(L,{variant:`ghost`,size:`icon`,className:`relative text-muted-foreground hover:text-foreground`,"aria-label":`Notifications`,onClick:()=>void t({to:`/notifications`}),children:[(0,I.jsx)(ce,{className:`h-4 w-4`}),D>0?(0,I.jsx)(`span`,{className:`absolute -right-1 -top-1 inline-flex h-4 min-w-[16px] items-center justify-center rounded-full bg-primary px-1 text-[10px] font-semibold text-primary-foreground`,children:D>99?`99+`:D}):null]}),(0,I.jsx)(Er,{}),v.data?.authenticated?(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsxs)(`div`,{className:`hidden md:flex flex-col items-end`,children:[(0,I.jsx)(`span`,{className:`text-[10px] text-muted-foreground uppercase leading-none`,children:`Signed in as`}),(0,I.jsx)(`span`,{className:`text-xs font-medium leading-none mt-1`,children:te})]}),(0,I.jsx)(L,{variant:`outline`,size:`sm`,disabled:s,onClick:async()=>{try{c(!0),await jr(),window.location.href=`/status?signin=1`}finally{c(!1)}},children:s?``:`Logout`})]}):(0,I.jsx)(L,{variant:`outline`,size:`sm`,disabled:l,onClick:async()=>{try{if(d(!0),!await fo({loginHref:ee})){window.location.href=ee;return}await i.invalidateQueries({queryKey:W.session()})}finally{d(!1)}},children:l?``:`Login`})]})]})}),(0,I.jsxs)(`div`,{className:F(`mx-auto flex min-h-[calc(100vh-4rem)]`,_?`max-w-none`:`max-w-[1600px]`),children:[v.data?.authenticated&&(0,I.jsx)(`aside`,{className:F(`hidden lg:block border-r bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60`,`transition-all duration-300 ease-in-out`,f?`w-[64px]`:`w-[220px]`),children:(0,I.jsxs)(`div`,{className:`relative h-full`,children:[(0,I.jsx)(`div`,{className:F(`h-full px-4 py-4`,f&&`px-2`),children:(0,I.jsx)(Ua,{collapsed:f,isAdmin:w,features:y.data?.features})}),(0,I.jsx)(`button`,{className:F(`absolute -right-3 top-4 flex h-7 w-7 items-center justify-center rounded-full border bg-background text-foreground shadow-sm`,`hover:bg-accent hover:text-accent-foreground transition-colors`),onClick:()=>p(e=>!e),"aria-label":f?`Expand navigation`:`Collapse navigation`,children:f?(0,I.jsx)(M,{className:`h-4 w-4`}):(0,I.jsx)(jn,{className:`h-4 w-4`})})]})}),(0,I.jsx)(`main`,{className:F(`flex-1 w-full overflow-hidden flex flex-col`,_?`px-0 py-0`:`px-4 py-6`),children:T?(0,I.jsx)(`div`,{className:`mx-auto max-w-xl`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Login Required`}),(0,I.jsx)(H,{children:`Sign in to access this page.`})]}),(0,I.jsxs)(U,{className:`flex flex-col gap-3`,children:[(0,I.jsx)(L,{variant:`default`,disabled:l,onClick:async()=>{try{if(d(!0),!await fo({loginHref:ee})){window.location.href=ee;return}await i.invalidateQueries({queryKey:W.session()})}finally{d(!1)}},children:l?``:`Login`}),(0,I.jsx)(`a`,{className:`text-sm text-muted-foreground underline`,href:ee,children:`Login with redirect instead`})]})]})}):(0,I.jsxs)(I.Fragment,{children:[_?null:(0,I.jsx)(`div`,{className:`mb-6`,children:(0,I.jsx)(Wa,{children:(0,I.jsxs)(Ga,{children:[(0,I.jsx)(Ka,{children:(0,I.jsx)(qa,{href:`/status`,children:`Dashboard`})}),` `,e.pathname.split(`/`).filter(Boolean).map((e,t,n)=>{let r=`/${n.slice(0,t+1).join(`/`)}`,i=t===n.length-1;return(0,I.jsxs)(P.Fragment,{children:[(0,I.jsx)(Ya,{}),(0,I.jsx)(Ka,{children:i?(0,I.jsx)(Ja,{className:`capitalize`,children:e}):(0,I.jsx)(qa,{href:r,className:`capitalize`,children:e})})]},r)})]})})}),(0,I.jsx)(a,{}),_?null:(0,I.jsxs)(`footer`,{className:`mt-auto pt-12 pb-6 flex items-center justify-between text-xs text-muted-foreground border-t`,children:[(0,I.jsx)(`div`,{className:`flex gap-4`,children:(0,I.jsxs)(`span`,{children:[`Questions? Reach out at`,` `,(0,I.jsx)(`span`,{className:`font-mono text-primary`,children:`#ask-skyforge`})]})}),(0,I.jsx)(`a`,{className:`hover:text-foreground transition-colors underline hover:no-underline`,href:`/git/skyforge/skyforge/issues/new`,target:`_blank`,rel:`noreferrer`,children:`File an issue`})]})]})})]}),(0,I.jsx)(lr,{}),(0,I.jsx)(lo,{})]})})}function xo(){return(0,I.jsx)(`div`,{className:`flex flex-col items-center justify-center min-h-[50vh] space-y-4 text-center`,children:(0,I.jsxs)(z,{variant:`glass`,className:`max-w-md`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{className:`text-2xl`,children:`Page not found`}),(0,I.jsx)(H,{children:`This route hasnt been migrated yet (or the URL is incorrect).`})]}),(0,I.jsxs)(U,{className:`flex flex-wrap justify-center gap-3`,children:[(0,I.jsx)(L,{variant:`default`,asChild:!0,children:(0,I.jsx)(f,{to:`/dashboard/deployments`,children:`Go to deployments`})}),(0,I.jsx)(L,{variant:`outline`,asChild:!0,children:(0,I.jsx)(f,{to:`/status`,children:`Platform status`})})]})]})})}function So(e){let t=e.error instanceof Error?e.error.message:typeof e.error==`string`?e.error:`Unknown error`;return(0,I.jsxs)(`div`,{className:`space-y-6`,children:[(0,I.jsxs)(z,{variant:`danger`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Application error`}),(0,I.jsx)(H,{className:`text-red-200/80`,children:t})]}),(0,I.jsxs)(U,{className:`flex flex-wrap gap-3`,children:[(0,I.jsx)(L,{variant:`outline`,className:`border-red-500/50 bg-red-500/10 hover:bg-red-500/20 text-red-100`,onClick:()=>e.reset(),children:`Try again`}),(0,I.jsx)(L,{variant:`secondary`,asChild:!0,children:(0,I.jsx)(f,{to:`/dashboard/deployments`,children:`Go to deployments`})})]})]}),e.error instanceof Error&&e.error.stack&&(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{className:`text-sm`,children:`Error Stack Trace`})}),(0,I.jsx)(U,{children:(0,I.jsx)(`pre`,{className:`overflow-auto whitespace-pre-wrap text-xs text-muted-foreground p-4 rounded-md bg-muted`,children:e.error.stack})})]})]})}function Co(e){return e===void 0?`minmax(0, 1fr)`:typeof e==`number`?`${e}px`:e}function wo({columns:e,rows:t,getRowId:n,onRowClick:r,getRowClassName:i,getRowAriaSelected:a,isLoading:o,emptyText:s=`No results.`,maxHeightClassName:c=`max-h-[70vh]`,minWidthClassName:l=`min-w-[900px]`,estimateRowHeight:u=34}){let d=P.useRef(null),f=P.useMemo(()=>e.map(e=>Co(e.width)).join(` `),[e]),m=p({count:t.length,getScrollElement:()=>d.current,estimateSize:()=>u,overscan:10}),h=m.getVirtualItems();return(0,I.jsx)(`div`,{className:`w-full overflow-x-auto rounded-md border`,children:(0,I.jsx)(`div`,{className:F(l),children:(0,I.jsxs)(`div`,{role:`table`,"aria-rowcount":t.length,className:`w-full text-sm`,style:{gridTemplateColumns:f},children:[(0,I.jsx)(`div`,{role:`rowgroup`,className:`sticky top-0 z-10 border-b bg-background/90 backdrop-blur`,children:(0,I.jsx)(`div`,{role:`row`,className:`grid`,style:{gridTemplateColumns:f},children:e.map(e=>(0,I.jsx)(`div`,{role:`columnheader`,className:F(`px-3 py-2 text-xs font-medium uppercase tracking-wide text-muted-foreground`,e.align===`center`&&`text-center`,e.align===`right`&&`text-right`,e.headerClassName),children:e.header},e.id))})}),(0,I.jsx)(`div`,{ref:d,role:`rowgroup`,className:F(`relative overflow-auto`,c),children:o?(0,I.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:`Loading`}):t.length===0?(0,I.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:s}):(0,I.jsx)(`div`,{className:`relative`,style:{height:`${m.getTotalSize()}px`},children:h.map(o=>{let s=t[o.index],c=n(s),l=!!r,u=i?.(s,o.index),d=a?.(s,o.index);return(0,I.jsx)(`div`,{role:`row`,"aria-rowindex":o.index+1,"aria-selected":d,className:F(`absolute left-0 right-0 grid border-b last:border-b-0`,o.index%2==0&&`bg-background`,o.index%2==1&&`bg-muted/20`,l&&`cursor-pointer hover:bg-muted/40`,u),style:{gridTemplateColumns:f,transform:`translateY(${o.start}px)`},onClick:l?()=>r?.(s):void 0,children:e.map(e=>(0,I.jsx)(`div`,{role:`cell`,className:F(`px-3 py-2 align-middle`,e.align===`center`&&`text-center`,e.align===`right`&&`text-right`,e.className),children:e.cell(s)},e.id))},c)})})})]})})})}function To({title:e,description:t,icon:n,action:r,className:i,...a}){return(0,I.jsx)(`div`,{className:F(`flex min-h-[400px] flex-col items-center justify-center rounded-md border border-dashed p-8 text-center animate-in fade-in zoom-in duration-300`,i),...a,children:(0,I.jsxs)(`div`,{className:`mx-auto flex max-w-[420px] flex-col items-center justify-center text-center`,children:[n&&(0,I.jsx)(`div`,{className:`flex h-20 w-20 items-center justify-center rounded-full bg-muted`,children:(0,I.jsx)(n,{className:`h-10 w-10 text-muted-foreground`})}),(0,I.jsx)(`h3`,{className:`mt-4 text-lg font-semibold`,children:e}),t&&(0,I.jsx)(`p`,{className:`mb-4 mt-2 text-sm text-muted-foreground`,children:t}),r&&(0,I.jsx)(L,{onClick:r.onClick,variant:`outline`,size:`sm`,children:r.label})]})})}function K({className:e,...t}){return(0,I.jsx)(`div`,{className:F(`animate-pulse rounded-md bg-muted`,e),...t})}function Eo(e,t){let n=u(),r=(0,P.useMemo)(()=>`${Dr}/webhooks/events/stream?limit=${encodeURIComponent(t)}`,[t]);(0,P.useEffect)(()=>{if(!e)return;let i=vo(r,{snapshot:e=>{try{let r=JSON.parse(e.data);n.setQueryData(W.webhookEvents(t),r)}catch{}}});return()=>{i.close()}},[e,t,n,r])}const Do=t(`/webhooks`)({component:Oo});function Oo(){Eo(!0,`200`);let e=r({queryKey:W.webhookEvents(`200`),queryFn:()=>ma({limit:`200`}),staleTime:1/0}),t=e.data?.events??[];return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Webhook inbox`}),(0,I.jsx)(H,{children:`Recent webhook events routed to your user.`})]})}),(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`p-0`,children:e.isLoading?(0,I.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,I.jsx)(K,{className:`h-12 w-full`}),(0,I.jsx)(K,{className:`h-12 w-full`}),(0,I.jsx)(K,{className:`h-12 w-full`})]}):e.isError?(0,I.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load webhook events.`}):t.length===0?(0,I.jsx)(To,{icon:Kt,title:`No webhook events`,description:`No webhook events have been received yet.`}):(0,I.jsx)(wo,{columns:[{id:`time`,header:`Time`,width:190,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground whitespace-nowrap text-xs`,children:e.receivedAt??``})},{id:`source`,header:`Source`,width:160,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.sourceIp??``})},{id:`event`,header:`Event`,cell:e=>(0,I.jsxs)(`span`,{className:`font-medium text-sm`,children:[e.method,` `,e.path]})},{id:`id`,header:`ID`,width:120,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:String(e.id)})}],rows:t,getRowId:e=>String(e.id),maxHeightClassName:`max-h-[65vh]`})})})]})}function ko(e,t){let n=u(),r=(0,P.useMemo)(()=>`${Dr}/syslog/events/stream?limit=${encodeURIComponent(t)}`,[t]);(0,P.useEffect)(()=>{if(!e)return;let i=vo(r,{snapshot:e=>{try{let r=JSON.parse(e.data);n.setQueryData(W.syslogEvents(t),r)}catch{}}});return()=>{i.close()}},[e,t,n,r])}const Ao=t(`/syslog`)({component:jo});function jo(){ko(!0,`200`);let e=r({queryKey:W.syslogEvents(`200`),queryFn:()=>ha({limit:`200`}),staleTime:1/0}),t=e.data?.events??[];return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Syslog inbox`}),(0,I.jsx)(H,{children:`Recent syslog events mapped to your user.`})]})}),(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`p-0`,children:e.isLoading?(0,I.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,I.jsx)(K,{className:`h-12 w-full`}),(0,I.jsx)(K,{className:`h-12 w-full`}),(0,I.jsx)(K,{className:`h-12 w-full`})]}):e.isError?(0,I.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load syslog events.`}):t.length===0?(0,I.jsx)(To,{icon:Kt,title:`No syslog events`,description:`No syslog messages have been received yet.`}):(0,I.jsx)(wo,{columns:[{id:`time`,header:`Time`,width:190,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground whitespace-nowrap text-xs`,children:e.receivedAt??``})},{id:`source`,header:`Source`,width:160,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.sourceIp??``})},{id:`app`,header:`App`,width:160,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.appName??``})},{id:`message`,header:`Message`,cell:e=>(0,I.jsx)(`span`,{className:`font-medium text-foreground text-sm line-clamp-2`,children:e.message??``})}],rows:t,getRowId:e=>String(e.id),maxHeightClassName:`max-h-[65vh]`})})})]})}var Mo=Fn(`inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2`,{variants:{variant:{default:`border-transparent bg-primary text-primary-foreground hover:bg-primary/80`,secondary:`border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80`,destructive:`border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80`,outline:`text-foreground`}},defaultVariants:{variant:`default`}});function No({className:e,variant:t,...n}){return(0,I.jsx)(`div`,{className:F(Mo({variant:t}),e),...n})}var Po={blue:`from-blue-500/10 via-blue-500/5 to-transparent`,green:`from-emerald-500/10 via-emerald-500/5 to-transparent`,purple:`from-purple-500/10 via-purple-500/5 to-transparent`,orange:`from-orange-500/10 via-orange-500/5 to-transparent`,red:`from-red-500/10 via-red-500/5 to-transparent`};const Fo=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`div`,{ref:n,className:F(`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4`,e),...t}));Fo.displayName=`BentoGrid`;const Io=P.forwardRef(({className:e,gradient:t=`blue`,children:n,...r},i)=>(0,I.jsx)(`div`,{ref:i,className:F(`relative overflow-hidden rounded-xl border border-border bg-card p-6`,`bg-gradient-to-br`,Po[t],e),...r,children:n}));Io.displayName=`BentoItem`;const Lo=P.forwardRef(({title:e,value:t,gradient:n=`blue`,icon:r,subtitle:i,trend:a,className:o},s)=>(0,I.jsxs)(Io,{ref:s,gradient:n,className:o,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2 mb-2`,children:[r&&(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:r}),(0,I.jsx)(`h3`,{className:`text-sm font-medium text-muted-foreground/80`,children:e})]}),(0,I.jsxs)(`div`,{className:`flex items-end justify-between`,children:[(0,I.jsx)(`div`,{className:`text-3xl font-bold`,children:t}),a&&(0,I.jsxs)(`div`,{className:F(`flex items-center gap-1 text-sm`,a.direction===`up`?`text-emerald-500`:`text-red-500`),children:[a.direction===`up`?(0,I.jsx)(Ce,{className:`w-4 h-4`}):(0,I.jsx)(Re,{className:`w-4 h-4`}),a.value,`%`]})]}),i&&(0,I.jsx)(`p`,{className:`text-xs text-muted-foreground/70 mt-2`,children:i})]}));Lo.displayName=`BentoStatCard`;const Ro=P.forwardRef(({userName:e,subtitle:t,className:n},r)=>(0,I.jsx)(Io,{ref:r,gradient:`purple`,className:F(`md:col-span-2`,n),children:(0,I.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,children:[(0,I.jsx)(`div`,{className:`p-2 rounded-full bg-purple-500/10`,children:(0,I.jsx)(Ne,{className:`w-5 h-5 text-purple-500`})}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h2`,{className:`text-xl font-bold`,children:e?`Welcome back, ${e}`:`Welcome to Skyforge`}),t&&(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground/80`,children:t})]})]})}));Ro.displayName=`BentoWelcomeCard`;const zo=P.forwardRef(({actions:e,className:t},n)=>(0,I.jsxs)(Io,{ref:n,gradient:`blue`,className:F(`md:col-span-2`,t),children:[(0,I.jsx)(`h3`,{className:`font-semibold mb-4`,children:`Quick Actions`}),(0,I.jsx)(`div`,{className:`grid grid-cols-2 gap-3`,children:e.map((e,t)=>(0,I.jsxs)(Ct.button,{onClick:e.onClick,className:`flex items-center gap-2 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors text-left`,whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.icon,(0,I.jsx)(`span`,{className:`text-sm font-medium`,children:e.label})]},t))})]}));zo.displayName=`BentoQuickActions`;const Bo=P.forwardRef(({servers:e,className:t},n)=>(0,I.jsxs)(Io,{ref:n,gradient:`green`,className:F(`md:col-span-2`,t),children:[(0,I.jsx)(`h3`,{className:`font-semibold mb-4`,children:`Server Status`}),(0,I.jsx)(`div`,{className:`grid grid-cols-2 gap-3`,children:e.map((e,t)=>(0,I.jsxs)(`div`,{className:`flex items-center justify-between p-3 rounded-lg bg-muted/30`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`div`,{className:F(`w-2 h-2 rounded-full`,e.status===`online`?`bg-emerald-500`:e.status===`degraded`?`bg-amber-500`:`bg-red-500`)}),(0,I.jsx)(`span`,{className:`text-sm font-medium`,children:e.name})]}),e.cpu!==void 0&&(0,I.jsxs)(No,{variant:`secondary`,className:`text-xs`,children:[e.cpu,`%`]})]},t))})]}));Bo.displayName=`BentoServerStatus`;function Vo(e){let t=u(),n=(0,P.useMemo)(()=>`/status/summary/events`,[]);(0,P.useEffect)(()=>{if(!e)return;let r=vo(n,{snapshot:e=>{try{let n=JSON.parse(e.data);t.setQueryData(W.statusSummary(),n)}catch{}}});return()=>{r.close()}},[e,t,n])}const Ho=t(`/status`)({component:Uo});function Uo(){Vo(!0);let e=r({queryKey:W.statusSummary(),queryFn:Ia,staleTime:1/0}),t=r({queryKey:W.uiConfig(),queryFn:Fa,staleTime:1/0}),n=t.data?.features,i=e.data,a=i?.checks??[],o=a.filter(e=>e.status!==`up`&&e.status!==`ok`);return(0,I.jsxs)(`div`,{className:`space-y-8 p-6`,children:[(0,I.jsxs)(Fo,{className:`gap-4`,children:[(0,I.jsx)(Ro,{subtitle:`Here's what's happening with your infrastructure today.`}),e.isLoading?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Io,{className:`h-32`,children:(0,I.jsx)(K,{className:`h-full w-full`})}),(0,I.jsx)(Io,{className:`h-32`,children:(0,I.jsx)(K,{className:`h-full w-full`})}),(0,I.jsx)(Io,{className:`h-32`,children:(0,I.jsx)(K,{className:`h-full w-full`})})]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Lo,{title:`Active Deployments`,value:i?.deploymentsActive??0,gradient:`green`,icon:(0,I.jsx)(A,{className:`w-5 h-5`}),subtitle:`${i?.deploymentsTotal??0} total deployments`}),(0,I.jsx)(Lo,{title:`Services Operational`,value:`${i?.up??0} / ${a.length}`,gradient:i?.up===a.length?`green`:`orange`,icon:(0,I.jsx)(me,{className:`w-5 h-5`})}),(0,I.jsx)(Lo,{title:`Services Down`,value:i?.down??0,gradient:i?.down?`red`:`blue`,icon:(0,I.jsx)(ge,{className:`w-5 h-5`})}),(0,I.jsxs)(Io,{gradient:`purple`,className:`relative overflow-hidden`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between mb-3`,children:[(0,I.jsxs)(`h3`,{className:`font-semibold flex items-center gap-2 text-sm text-muted-foreground/80`,children:[(0,I.jsx)(je,{className:`w-4 h-4`}),`Platform Health`]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(`span`,{className:`relative flex h-2 w-2`,children:[(0,I.jsx)(`span`,{className:`animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75`}),(0,I.jsx)(`span`,{className:`relative inline-flex rounded-full h-2 w-2 bg-emerald-500`})]}),(0,I.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:`Live`})]})]}),(0,I.jsx)(`div`,{className:`flex items-end gap-4`,children:(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`span`,{className:F(`text-3xl font-bold`,i?.status===`ok`?`text-emerald-500`:i?.status===`degraded`?`text-amber-500`:`text-muted-foreground`),children:(i?.status??`checking`).toUpperCase()}),(0,I.jsx)(`p`,{className:`text-xs text-muted-foreground mt-1`,children:i?.timestamp?`Refreshed ${new Date(i.timestamp).toLocaleTimeString()}`:`Checking...`})]})})]})]})]}),(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-3`,children:[t.data?.externalUrl&&(0,I.jsxs)(z,{variant:`glass`,className:`border-green-500/20 bg-green-500/5`,children:[(0,I.jsx)(B,{children:(0,I.jsxs)(V,{className:`text-base flex items-center gap-2 text-green-500`,children:[(0,I.jsx)(Ot,{className:`w-4 h-4`}),`Public Access`]})}),(0,I.jsxs)(U,{className:`text-sm text-muted-foreground space-y-3`,children:[(0,I.jsx)(`p`,{children:`This environment is securely accessible via Cloudflare Tunnel.`}),(0,I.jsx)(`div`,{className:`rounded bg-background/50 p-2 border`,children:(0,I.jsx)(`a`,{className:`text-primary hover:underline break-all font-mono text-xs`,href:t.data.externalUrl,target:`_blank`,rel:`noreferrer`,children:t.data.externalUrl})})]})]}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsx)(B,{children:(0,I.jsxs)(V,{className:`text-base flex items-center gap-2`,children:[(0,I.jsx)(fe,{className:`w-4 h-4 text-orange-500`}),`Skyforge at a Glance`]})}),(0,I.jsxs)(U,{className:`text-sm text-muted-foreground space-y-3`,children:[(0,I.jsx)(`p`,{children:`Skyforge coordinates lab + cloud tooling into repeatable, auditable workflows for platform teams.`}),(0,I.jsxs)(`ul`,{className:`list-disc pl-4 space-y-1`,children:[(0,I.jsx)(`li`,{children:`Teams can still run tools manually; Skyforge standardizes the "happy path".`}),(0,I.jsx)(`li`,{children:`Enables consistent lab delivery across on-prem and cloud environments.`}),(0,I.jsx)(`li`,{children:`Creates shared context for collaboration, troubleshooting, and handoffs.`})]})]})]}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsx)(B,{children:(0,I.jsxs)(V,{className:`text-base flex items-center gap-2`,children:[(0,I.jsx)(Be,{className:`w-4 h-4 text-blue-500`}),`What You Can Do Here`]})}),(0,I.jsxs)(U,{className:`text-sm text-muted-foreground space-y-2`,children:[(0,I.jsx)(f,{className:`text-primary hover:underline`,to:`/dashboard/deployments`,children:` Open the dashboard`}),(0,I.jsx)(f,{className:`text-primary hover:underline`,to:`/dashboard/deployments/new`,children:` Create a deployment`}),(0,I.jsx)(f,{className:`text-primary hover:underline`,to:`/dashboard/s3`,children:` Browse artifacts (S3)`}),(0,I.jsx)(`p`,{className:`text-xs text-muted-foreground mt-3`,children:`Status is refreshed automatically via Server-Sent Events.`})]})]}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsx)(B,{children:(0,I.jsxs)(V,{className:`text-base flex items-center gap-2`,children:[(0,I.jsx)(b,{className:`w-4 h-4 text-purple-500`}),`How Workflows Run`]})}),(0,I.jsxs)(U,{className:`text-sm text-muted-foreground space-y-2`,children:[(0,I.jsx)(`p`,{children:`Skyforge connects source control, automation, and lab capacity into one delivery loop.`}),(0,I.jsxs)(`ol`,{className:`list-decimal pl-4 space-y-1`,children:[(0,I.jsx)(`li`,{children:`Choose a blueprint (Git).`}),(0,I.jsx)(`li`,{children:`Run deployments (native task engine).`}),(0,I.jsx)(`li`,{children:`Validate on lab servers (BYOS + In-Cluster).`}),(0,I.jsx)(`li`,{children:`Store artifacts + state (Skyforge storage).`})]})]})]})]}),(0,I.jsx)(Fo,{className:`gap-4`,children:(0,I.jsxs)(Io,{gradient:`blue`,className:`md:col-span-4 hover-lift`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between mb-6`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(`div`,{className:`p-2 rounded-lg bg-blue-500/10`,children:(0,I.jsx)(ge,{className:`w-5 h-5 text-blue-500`})}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h3`,{className:`font-semibold`,children:`Integrated Toolchain & Status`}),(0,I.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Live health checks for all platform services.`})]})]}),o.length>0&&(0,I.jsxs)(No,{variant:`destructive`,className:`animate-pulse`,children:[o.length,` Service`,o.length>1?`s`:``,` `,`Reporting Issues`]})]}),(0,I.jsx)(`div`,{className:`grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4`,children:[{id:`gitea`,name:`Git`,path:`/git/`,icon:ct,enabled:n?.giteaEnabled??!0,external:!0},{id:`netbox`,name:`NetBox`,path:`/netbox/`,icon:sn,enabled:n?.netboxEnabled??!1,external:!0},{id:`nautobot`,name:`Nautobot`,path:`/nautobot/`,icon:sn,enabled:n?.nautobotEnabled??!1,external:!0},{id:`coder`,name:`Coder`,path:`/coder/launch`,icon:A,enabled:n?.coderEnabled??!1,external:!0},{id:`yaade`,name:`API Testing`,path:`${Dr}/yaade/sso`,icon:je,enabled:n?.yaadeEnabled??!1,external:!0},{id:`webhooks`,name:`Webhooks`,path:`/dashboard/webhooks`,icon:b,enabled:!0,external:!1}].filter(e=>e.enabled).map(e=>{let t=a.find(t=>t.name.toLowerCase().includes(e.id)),n=t?t.status===`up`||t.status===`ok`:!0,r=n?`bg-emerald-500`:`bg-red-500`,i=e.icon;return(0,I.jsxs)(`a`,{href:e.path,target:e.external?`_blank`:`_self`,rel:e.external?`noreferrer noopener`:void 0,className:`flex flex-col items-center justify-center p-4 rounded-lg bg-background/50 border hover:bg-background/80 transition-colors group relative overflow-hidden`,children:[(0,I.jsx)(`div`,{className:`absolute top-2 right-2 w-2 h-2 rounded-full ${r} ${n?``:`animate-pulse`}`}),(0,I.jsx)(i,{className:`w-6 h-6 mb-2 text-muted-foreground group-hover:text-primary transition-colors`}),(0,I.jsx)(`span`,{className:`text-sm font-medium`,children:e.name}),(0,I.jsx)(`span`,{className:F(`text-[10px] mt-1 capitalize font-medium`,n?`text-emerald-500/80`:`text-red-500`),children:t?.status??`Operational`})]},e.id)})}),o.length>0&&(0,I.jsxs)(`div`,{className:`mt-6 pt-6 border-t`,children:[(0,I.jsx)(`h4`,{className:`text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-3`,children:`Service Alerts`}),(0,I.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:o.map(e=>(0,I.jsxs)(No,{variant:`outline`,className:`text-[10px] border-red-500/30 text-red-400 bg-red-500/5`,children:[e.name,`: `,e.status]},e.name))})]})]})})]})}function Wo(e,t){let n=u(),r=(0,P.useMemo)(()=>`${Dr}/snmp/traps/events/stream?limit=${encodeURIComponent(t)}`,[t]);(0,P.useEffect)(()=>{if(!e)return;let i=vo(r,{snapshot:e=>{try{let r=JSON.parse(e.data);n.setQueryData(W.snmpTrapEvents(t),r)}catch{}}});return()=>{i.close()}},[e,t,n,r])}const Go=t(`/snmp`)({component:Ko});function Ko(){Wo(!0,`200`);let e=r({queryKey:W.snmpTrapEvents(`200`),queryFn:()=>ga({limit:`200`}),staleTime:1/0}),t=e.data?.events??[];return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`SNMP trap inbox`}),(0,I.jsx)(H,{children:`Recent SNMP trap events routed to your user.`})]})}),(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`p-0`,children:e.isLoading?(0,I.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,I.jsx)(K,{className:`h-12 w-full`}),(0,I.jsx)(K,{className:`h-12 w-full`}),(0,I.jsx)(K,{className:`h-12 w-full`})]}):e.isError?(0,I.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load SNMP trap events.`}):t.length===0?(0,I.jsx)(To,{icon:Kt,title:`No trap events`,description:`No SNMP traps have been received yet.`}):(0,I.jsx)(wo,{columns:[{id:`time`,header:`Time`,width:190,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground whitespace-nowrap text-xs`,children:e.receivedAt??``})},{id:`source`,header:`Source`,width:160,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.sourceIp??``})},{id:`oid`,header:`OID`,cell:e=>(0,I.jsx)(`span`,{className:`font-medium text-foreground text-sm font-mono`,children:e.oid??``})},{id:`id`,header:`ID`,width:120,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:String(e.id)})}],rows:t,getRowId:e=>String(e.id),maxHeightClassName:`max-h-[65vh]`})})})]})}var qo=at,Jo=et,Yo=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(nt,{className:F(`fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t,ref:n}));Yo.displayName=nt.displayName;var Xo=P.forwardRef(({className:e,...t},n)=>(0,I.jsxs)(Jo,{children:[(0,I.jsx)(Yo,{}),(0,I.jsx)(nn,{ref:n,className:F(`fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg`,e),...t})]}));Xo.displayName=nn.displayName;var Zo=({className:e,...t})=>(0,I.jsx)(`div`,{className:F(`flex flex-col space-y-2 text-center sm:text-left`,e),...t});Zo.displayName=`AlertDialogHeader`;var Qo=({className:e,...t})=>(0,I.jsx)(`div`,{className:F(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});Qo.displayName=`AlertDialogFooter`;var $o=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(Pe,{ref:n,className:F(`text-lg font-semibold`,e),...t}));$o.displayName=Pe.displayName;var es=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(he,{ref:n,className:F(`text-sm text-muted-foreground`,e),...t}));es.displayName=he.displayName;var ts=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(se,{ref:n,className:F(mr(),e),...t}));ts.displayName=se.displayName;var ns=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(ve,{ref:n,className:F(mr({variant:`outline`}),`mt-2 sm:mt-0`,e),...t}));ns.displayName=ve.displayName;var rs=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(Ge,{ref:n,className:F(`peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground`,e),...t,children:(0,I.jsx)(Ze,{className:F(`flex items-center justify-center text-current`),children:(0,I.jsx)(Ye,{className:`h-4 w-4`})})}));rs.displayName=Ge.displayName;var is=Fn(`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70`),q=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(ue,{ref:n,className:F(is(),e),...t}));q.displayName=ue.displayName;var as=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(x,{className:F(`peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input`,e),...t,ref:n,children:(0,I.jsx)(Je,{className:F(`pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0`)})}));as.displayName=x.displayName;const os=t(`/notifications`)({component:ss});function ss(){let[e,t]=(0,P.useState)(!1),[n,i]=(0,P.useState)(null),[a,o]=(0,P.useState)(!1),[s,c]=(0,P.useState)(new Set),l=u(),d=r({queryKey:W.session(),queryFn:Ar,staleTime:3e4,retry:!1}).data?.username??``;yo(!!d,e,`50`);let f=r({queryKey:W.notifications(e,`50`),enabled:!!d,queryFn:async()=>({notifications:(await Pr(d,{include_read:e?`true`:`false`,limit:`50`})).notifications??[]}),staleTime:1/0,initialData:{notifications:[]}}),p=(0,P.useMemo)(()=>f.data?.notifications??[],[f.data?.notifications]),m=(0,P.useMemo)(()=>p.filter(e=>!e.is_read).length,[p]),h=e=>{c(e?new Set(p.map(e=>String(e.id))):new Set)},g=(e,t)=>{let n=new Set(s);t?n.add(e):n.delete(e),c(n)},_=async()=>{try{let t=Array.from(s).map(e=>Ir(e));await Promise.all(t),N.success(`${s.size} notifications marked as read`),c(new Set),await l.invalidateQueries({queryKey:W.notifications(e,`50`)})}catch(e){N.error(`Failed to mark selection as read`,{description:e.message})}},v=async()=>{try{let t=Array.from(s).map(e=>Lr(e));await Promise.all(t),N.success(`${s.size} notifications deleted`),c(new Set),await l.invalidateQueries({queryKey:W.notifications(e,`50`)})}catch(e){N.error(`Failed to delete selection`,{description:e.message})}},y=async()=>{try{await Fr(d),N.success(`All notifications marked as read`)}catch(e){N.error(`Failed to mark notifications as read`,{description:e.message})}},b=async e=>{try{await Ir(e),N.success(`Notification marked as read`)}catch(e){N.error(`Failed to mark notification as read`,{description:e.message})}},x=async()=>{if(n)try{await Lr(n),N.success(`Notification deleted`),o(!1),i(null)}catch(e){N.error(`Failed to delete notification`,{description:e.message})}},S=[{id:`select`,header:(0,I.jsx)(rs,{checked:p.length>0&&s.size===p.length,onCheckedChange:e=>h(!!e),"aria-label":`Select all`}),width:54,headerClassName:`px-2 py-0`,className:`px-2 py-0`,cell:e=>{let t=String(e.id);return(0,I.jsx)(rs,{checked:s.has(t),onCheckedChange:e=>g(t,e),"aria-label":`Select notification ${t}`})}},{id:`time`,header:`Time`,width:190,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs whitespace-nowrap`,children:e.created_at??``})},{id:`message`,header:`Title & Message`,cell:e=>(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`font-medium text-sm`,children:e.title??``}),e.message?(0,I.jsx)(`div`,{className:`mt-1 text-xs text-muted-foreground line-clamp-2`,children:e.message}):null]})},{id:`category`,header:`Category`,width:160,cell:e=>(0,I.jsx)(`span`,{className:`inline-flex items-center rounded-full bg-muted px-2 py-0.5 text-[10px] font-medium text-muted-foreground capitalize`,children:e.category??`System`})},{id:`actions`,header:`Actions`,width:120,align:`right`,cell:e=>{let t=String(e.id);return(0,I.jsxs)(hr,{children:[(0,I.jsx)(gr,{asChild:!0,children:(0,I.jsxs)(L,{variant:`ghost`,size:`icon`,className:`h-8 w-8`,children:[(0,I.jsx)(re,{className:`h-4 w-4`}),(0,I.jsx)(`span`,{className:`sr-only`,children:`Open menu`})]})}),(0,I.jsxs)(yr,{align:`end`,children:[!e.is_read&&(0,I.jsxs)(br,{onClick:()=>b(t),children:[(0,I.jsx)(Ye,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:`Mark as read`})]}),(0,I.jsxs)(br,{className:`text-destructive focus:text-destructive`,onClick:()=>{i(t),o(!0)},children:[(0,I.jsx)(Mn,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:`Delete`})]})]})]})}}];return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(`div`,{className:`p-2 rounded-full bg-primary/10`,children:(0,I.jsx)(ce,{className:`h-6 w-6 text-primary`})}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(V,{children:`Notifications`}),(0,I.jsx)(H,{children:`Stay updated with platform events and system alerts.`})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(as,{id:`show-read`,checked:e,onCheckedChange:t}),(0,I.jsx)(q,{htmlFor:`show-read`,className:`cursor-pointer`,children:`Show read`})]}),(0,I.jsx)(L,{variant:`outline`,size:`sm`,disabled:!d||m===0,onClick:y,children:`Mark all read`})]})]})})}),s.size>0&&(0,I.jsxs)(`div`,{className:`fixed bottom-6 left-1/2 -translate-x-1/2 z-50 flex items-center gap-4 rounded-full border bg-background/95 p-2 px-6 shadow-xl backdrop-blur animate-in slide-in-from-bottom-10 fade-in duration-300`,children:[(0,I.jsxs)(`span`,{className:`text-sm font-medium`,children:[s.size,` selected`]}),(0,I.jsx)(`div`,{className:`h-4 w-px bg-border`}),(0,I.jsxs)(L,{size:`sm`,variant:`ghost`,onClick:_,children:[(0,I.jsx)(Ye,{className:`mr-2 h-4 w-4`}),`Mark read`]}),(0,I.jsxs)(L,{size:`sm`,variant:`destructive`,onClick:v,children:[(0,I.jsx)(Mn,{className:`mr-2 h-4 w-4`}),`Delete`]}),(0,I.jsx)(L,{size:`sm`,variant:`ghost`,onClick:()=>c(new Set),children:`Cancel`})]}),(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`p-0`,children:f.isLoading?(0,I.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,I.jsx)(K,{className:`h-12 w-full`}),(0,I.jsx)(K,{className:`h-12 w-full`}),(0,I.jsx)(K,{className:`h-12 w-full`})]}):f.isError?(0,I.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load notifications.`}):p.length===0?(0,I.jsx)(To,{icon:Kt,title:`No notifications`,description:e?`You don't have any notifications at the moment.`:`You've read all your notifications!`}):(0,I.jsx)(wo,{columns:S,rows:p,getRowId:e=>String(e.id),getRowClassName:e=>{let t=String(e.id),n=s.has(t);return[e.is_read?`opacity-60 grayscale-[0.5]`:``,n?`bg-primary/10 hover:bg-primary/10`:``].filter(Boolean).join(` `)},getRowAriaSelected:e=>s.has(String(e.id)),maxHeightClassName:`max-h-[65vh]`,minWidthClassName:`min-w-[900px]`})})}),(0,I.jsx)(qo,{open:a,onOpenChange:o,children:(0,I.jsxs)(Xo,{children:[(0,I.jsxs)(Zo,{children:[(0,I.jsx)($o,{children:`Delete notification?`}),(0,I.jsx)(es,{children:`This action cannot be undone.`})]}),(0,I.jsxs)(Qo,{children:[(0,I.jsx)(ns,{children:`Cancel`}),(0,I.jsx)(ts,{onClick:x,className:mr({variant:`destructive`}),children:`Delete`})]})]})})]})}var J=P.forwardRef(({className:e,type:t,...n},r)=>(0,I.jsx)(`input`,{type:t,className:F(`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm`,e),ref:r,...n}));J.displayName=`Input`;var Y=De,X=Le,Z=P.forwardRef(({className:e,children:t,...n},r)=>(0,I.jsxs)(xe,{ref:r,className:F(`flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1`,e),...n,children:[t,(0,I.jsx)(T,{asChild:!0,children:(0,I.jsx)(S,{className:`h-4 w-4 opacity-50`})})]}));Z.displayName=xe.displayName;var cs=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(ie,{ref:n,className:F(`flex cursor-default items-center justify-center py-1`,e),...t,children:(0,I.jsx)(Se,{className:`h-4 w-4`})}));cs.displayName=ie.displayName;var ls=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(Me,{ref:n,className:F(`flex cursor-default items-center justify-center py-1`,e),...t,children:(0,I.jsx)(S,{className:`h-4 w-4`})}));ls.displayName=Me.displayName;var Q=P.forwardRef(({className:e,children:t,position:n=`popper`,...r},i)=>(0,I.jsx)(we,{children:(0,I.jsxs)(He,{ref:i,className:F(`relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,n===`popper`&&`data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1`,e),position:n,...r,children:[(0,I.jsx)(cs,{}),(0,I.jsx)(An,{className:F(`p-1`,n===`popper`&&`h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]`),children:t}),(0,I.jsx)(ls,{})]})}));Q.displayName=He.displayName;var us=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(It,{ref:n,className:F(`py-1.5 pl-8 pr-2 text-sm font-semibold`,e),...t}));us.displayName=It.displayName;var $=P.forwardRef(({className:e,children:t,...n},r)=>(0,I.jsxs)(ke,{ref:r,className:F(`relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...n,children:[(0,I.jsx)(`span`,{className:`absolute left-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,I.jsx)(zt,{children:(0,I.jsx)(Ye,{className:`h-4 w-4`})})}),(0,I.jsx)(v,{children:t})]}));$.displayName=ke.displayName;var ds=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(pe,{ref:n,className:F(`-mx-1 my-1 h-px bg-muted`,e),...t}));ds.displayName=pe.displayName;var fs=C,ps=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(ze,{ref:n,className:F(`inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground`,e),...t}));ps.displayName=ze.displayName;var ms=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(xn,{ref:n,className:F(`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm`,e),...t}));ms.displayName=xn.displayName;var hs=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(wn,{ref:n,className:F(`mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2`,e),...t}));hs.displayName=wn.displayName;const gs=t(`/design`)({component:_s});function _s(){return(0,I.jsxs)(`div`,{className:`space-y-10 p-6 pb-20`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(`h1`,{className:`text-3xl font-bold tracking-tight`,children:`Design System`}),(0,I.jsx)(`p`,{className:`text-muted-foreground`,children:`A catalog of all reusable UI components available in the portal.`})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Buttons`}),(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-4`,children:[(0,I.jsx)(L,{variant:`default`,children:`Default`}),(0,I.jsx)(L,{variant:`secondary`,children:`Secondary`}),(0,I.jsx)(L,{variant:`destructive`,children:`Destructive`}),(0,I.jsx)(L,{variant:`outline`,children:`Outline`}),(0,I.jsx)(L,{variant:`ghost`,children:`Ghost`}),(0,I.jsx)(L,{variant:`link`,children:`Link`}),(0,I.jsx)(L,{size:`sm`,children:`Small`}),(0,I.jsx)(L,{size:`lg`,children:`Large`}),(0,I.jsx)(L,{size:`icon`,children:(0,I.jsx)(le,{className:`h-4 w-4`})}),(0,I.jsx)(L,{disabled:!0,children:`Disabled`}),(0,I.jsxs)(L,{variant:`outline`,className:`gap-2`,children:[(0,I.jsx)(Zt,{className:`h-4 w-4`}),` With Icon`]})]})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Badges`}),(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-4`,children:[(0,I.jsx)(No,{children:`Default`}),(0,I.jsx)(No,{variant:`secondary`,children:`Secondary`}),(0,I.jsx)(No,{variant:`outline`,children:`Outline`}),(0,I.jsx)(No,{variant:`destructive`,children:`Destructive`})]})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Cards`}),(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2 lg:grid-cols-4`,children:[(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Default Card`}),(0,I.jsx)(H,{children:`Standard container style`})]}),(0,I.jsx)(U,{children:`Content goes here`})]}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Glass Card`}),(0,I.jsx)(H,{children:`Backdrop blur effect`})]}),(0,I.jsx)(U,{children:`Popular for headers`})]}),(0,I.jsxs)(z,{variant:`flat`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Flat Card`}),(0,I.jsx)(H,{children:`No shadow, border only`})]}),(0,I.jsx)(U,{children:`Clean look`})]}),(0,I.jsxs)(z,{variant:`danger`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Danger Card`}),(0,I.jsx)(H,{children:`For error states`})]}),(0,I.jsx)(U,{className:`text-sm`,children:`Something went wrong`})]})]})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Bento Grid`}),(0,I.jsxs)(Fo,{children:[(0,I.jsx)(Lo,{title:`Total Revenue`,value:`$45,231.89`,icon:(0,I.jsx)(y,{className:`h-4 w-4`}),gradient:`blue`}),(0,I.jsx)(Lo,{title:`Active Users`,value:`+2350`,icon:(0,I.jsx)(Ne,{className:`h-4 w-4`}),gradient:`green`}),(0,I.jsx)(Io,{gradient:`purple`,className:`md:col-span-2`,children:(0,I.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,I.jsx)(`div`,{className:`p-2 bg-background/20 rounded-full`,children:(0,I.jsx)(A,{className:`h-6 w-6`})}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h3`,{className:`font-semibold text-lg`,children:`Cloud Infrastructure`}),(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground/80`,children:`Manage your cloud resources and deployments from a single dashboard.`})]})]})})]})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Form Inputs`}),(0,I.jsx)(z,{children:(0,I.jsxs)(U,{className:`pt-6 space-y-4 max-w-md`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{htmlFor:`email`,children:`Email address`}),(0,I.jsx)(J,{type:`email`,id:`email`,placeholder:`name@example.com`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Framework`}),(0,I.jsxs)(Y,{children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select framework`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`react`,children:`React`}),(0,I.jsx)($,{value:`vue`,children:`Vue`}),(0,I.jsx)($,{value:`svelte`,children:`Svelte`})]})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center space-x-2`,children:[(0,I.jsx)(as,{id:`airplane-mode`}),(0,I.jsx)(q,{htmlFor:`airplane-mode`,children:`Airplane Mode`})]})]})})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Tabs`}),(0,I.jsxs)(fs,{defaultValue:`account`,className:`w-[400px]`,children:[(0,I.jsxs)(ps,{children:[(0,I.jsx)(ms,{value:`account`,children:`Account`}),(0,I.jsx)(ms,{value:`password`,children:`Password`})]}),(0,I.jsx)(hs,{value:`account`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Account`}),(0,I.jsx)(H,{children:`Make changes to your account here.`})]}),(0,I.jsx)(U,{className:`space-y-2`,children:(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`name`,children:`Name`}),(0,I.jsx)(J,{id:`name`,defaultValue:`Pedro Duarte`})]})}),(0,I.jsx)(Qa,{children:(0,I.jsx)(L,{children:`Save changes`})})]})}),(0,I.jsx)(hs,{value:`password`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Password`}),(0,I.jsx)(H,{children:`Change your password here.`})]}),(0,I.jsx)(U,{className:`space-y-2`,children:(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`current`,children:`Current password`}),(0,I.jsx)(J,{id:`current`,type:`password`})]})}),(0,I.jsx)(Qa,{children:(0,I.jsx)(L,{children:`Save password`})})]})})]})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Feedback & Status`}),(0,I.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsx)(`h3`,{className:`text-sm font-medium text-muted-foreground`,children:`Empty State`}),(0,I.jsx)(`div`,{className:`border rounded-lg p-4`,children:(0,I.jsx)(To,{icon:Kt,title:`No items found`,description:`You haven't created any items yet.`,action:{label:`Create Item`,onClick:()=>N(`Clicked create`)},className:`min-h-[200px]`})})]}),(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsx)(`h3`,{className:`text-sm font-medium text-muted-foreground`,children:`Skeleton Loading`}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(K,{className:`h-5 w-[140px] mb-2`}),(0,I.jsx)(K,{className:`h-4 w-[250px]`})]}),(0,I.jsxs)(U,{className:`space-y-2`,children:[(0,I.jsx)(K,{className:`h-4 w-full`}),(0,I.jsx)(K,{className:`h-4 w-full`}),(0,I.jsx)(K,{className:`h-4 w-3/4`})]})]})]})]})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Toast Notifications`}),(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-4`,children:[(0,I.jsx)(L,{variant:`outline`,onClick:()=>N(`Event has been created`),children:`Simple Toast`}),(0,I.jsx)(L,{variant:`outline`,onClick:()=>N.success(`Event created successfully`),children:`Success`}),(0,I.jsx)(L,{variant:`outline`,onClick:()=>N.error(`Failed to create event`),children:`Error`}),(0,I.jsx)(L,{variant:`outline`,onClick:()=>N.info(`New updates available`,{description:`Refresh to see changes`}),children:`With Description`}),(0,I.jsx)(L,{variant:`outline`,onClick:()=>N(`Event deleted`,{action:{label:`Undo`,onClick:()=>console.log(`Undo`)}}),children:`With Action`})]})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Breadcrumbs`}),(0,I.jsx)(`div`,{className:`p-4 border rounded-lg`,children:(0,I.jsx)(Wa,{children:(0,I.jsxs)(Ga,{children:[(0,I.jsx)(Ka,{children:(0,I.jsx)(qa,{href:`/status`,children:`Dashboard`})}),` `,(0,I.jsx)(Ya,{}),(0,I.jsx)(Ka,{children:(0,I.jsx)(qa,{href:`/components`,children:`Components`})}),(0,I.jsx)(Ya,{}),(0,I.jsx)(Ka,{children:(0,I.jsx)(Ja,{children:`Breadcrumb`})})]})})})]})]})}const vs=t(`/`)({component:ys});function ys(){let e=n(),t=r({queryKey:W.session(),queryFn:Ar,retry:!1,staleTime:3e4});return(0,P.useEffect)(()=>{t.isLoading||(t.data?.authenticated?e({to:`/dashboard/deployments`,replace:!0}):e({to:`/status`,replace:!0}))},[t.data?.authenticated,t.isLoading,e]),null}const bs=t(`/dashboard/`)({component:xs});function xs(){let e=n();return(0,P.useEffect)(()=>{e({to:`/status`,replace:!0})},[e]),null}const Ss=t(`/admin/`)({component:Cs});function Cs(){let e=n();return(0,P.useEffect)(()=>{e({to:`/admin/settings`,replace:!0})},[e]),null}var ws=st,Ts=P.createContext({}),Es=({...e})=>(0,I.jsx)(Ts.Provider,{value:{name:e.name},children:(0,I.jsx)(Dt,{...e})}),Ds=()=>{let e=P.useContext(Ts),t=P.useContext(Os),{getFieldState:n,formState:r}=pt(),i=n(e.name,r);if(!e)throw Error(`useFormField should be used within <FormField>`);let{id:a}=t;return{id:a,name:e.name,formItemId:`${a}-form-item`,formDescriptionId:`${a}-form-item-description`,formMessageId:`${a}-form-item-message`,...i}},Os=P.createContext({}),ks=P.forwardRef(({className:e,...t},n)=>{let r=P.useId();return(0,I.jsx)(Os.Provider,{value:{id:r},children:(0,I.jsx)(`div`,{ref:n,className:F(`space-y-2`,e),...t})})});ks.displayName=`FormItem`;var As=P.forwardRef(({className:e,...t},n)=>{let{error:r,formItemId:i}=Ds();return(0,I.jsx)(q,{ref:n,className:F(r&&`text-destructive`,e),htmlFor:i,...t})});As.displayName=`FormLabel`;var js=P.forwardRef(({...e},t)=>{let{error:n,formItemId:r,formDescriptionId:i,formMessageId:a}=Ds();return(0,I.jsx)(kn,{ref:t,id:r,"aria-describedby":n?`${i} ${a}`:`${i}`,"aria-invalid":!!n,...e})});js.displayName=`FormControl`;var Ms=P.forwardRef(({className:e,...t},n)=>{let{formDescriptionId:r}=Ds();return(0,I.jsx)(`p`,{ref:n,id:r,className:F(`text-sm text-muted-foreground`,e),...t})});Ms.displayName=`FormDescription`;var Ns=P.forwardRef(({className:e,children:t,...n},r)=>{let{error:i,formMessageId:a}=Ds(),o=i?String(i?.message):t;return o?(0,I.jsx)(`p`,{ref:r,id:a,className:F(`text-sm font-medium text-destructive`,e),...n,children:o}):null});Ns.displayName=`FormMessage`;var Ps=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`textarea`,{className:F(`flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm`,e),ref:n,...t}));Ps.displayName=`Textarea`;const Fs=[{label:"Device (`NETLAB_DEVICE`)",key:`NETLAB_DEVICE`},{label:"BGP AS (`NETLAB_BGP_AS`)",key:`NETLAB_BGP_AS`},{label:"P2P IPv4 pool (`NETLAB_ADDRESSING_P2P_IPV4`)",key:`NETLAB_ADDRESSING_P2P_IPV4`},{label:"P2P IPv6 mode (`NETLAB_ADDRESSING_P2P_IPV6`)",key:`NETLAB_ADDRESSING_P2P_IPV6`},{label:"Loopback IPv4 pool (`NETLAB_ADDRESSING_LOOPBACK_IPV4`)",key:`NETLAB_ADDRESSING_LOOPBACK_IPV4`},{label:"LAN IPv4 pool (`NETLAB_ADDRESSING_LAN_IPV4`)",key:`NETLAB_ADDRESSING_LAN_IPV4`},{label:"Netlab `--set` overrides (`SKYFORGE_NETLAB_SET_OVERRIDES`)",key:`SKYFORGE_NETLAB_SET_OVERRIDES`}],Is=[{label:`Arista EOS (eos)`,value:`eos`},{label:`Cisco IOL (iol)`,value:`iol`},{label:`Cisco IOSv (iosv)`,value:`iosv`},{label:`Cisco IOSvL2 (iosvl2)`,value:`iosvl2`},{label:`Cisco CSR1000v (csr)`,value:`csr`},{label:`Cisco ASA (asav)`,value:`asav`},{label:`Cisco NX-OSv9k (nxos)`,value:`nxos`},{label:`Juniper SRX`,value:`vsrx`},{label:`Juniper vMX (vmx)`,value:`vmx`},{label:`Juniper vJunos Router (vjunos-router)`,value:`vjunos-router`},{label:`Juniper vJunos Switch (vjunos-switch)`,value:`vjunos-switch`},{label:`Nokia SR OS (sros)`,value:`sros`},{label:`Linux (linux)`,value:`linux`}];function Ls(e){return String(e??``).trim().toUpperCase()===`SKYFORGE_NETLAB_SET_OVERRIDES`}function Rs(e){switch(String(e??``).trim().toUpperCase()){case`NETLAB_DEVICE`:return Is;case`NETLAB_BGP_AS`:return[{label:`65000`,value:`65000`},{label:`65100`,value:`65100`},{label:`65200`,value:`65200`},{label:`65500`,value:`65500`}];case`NETLAB_ADDRESSING_P2P_IPV4`:return[{label:`198.18.0.0/16 (benchmark range)`,value:`198.18.0.0/16`},{label:`172.16.0.0/12`,value:`172.16.0.0/12`},{label:`100.64.0.0/10`,value:`100.64.0.0/10`}];case`NETLAB_ADDRESSING_P2P_IPV6`:return[{label:`false (disable / avoid LLA-only)`,value:`false`},{label:`true`,value:`true`}];case`NETLAB_ADDRESSING_LOOPBACK_IPV4`:return[{label:`10.0.0.0/24`,value:`10.0.0.0/24`},{label:`198.18.1.0/24`,value:`198.18.1.0/24`},{label:`172.16.0.0/24`,value:`172.16.0.0/24`}];case`NETLAB_ADDRESSING_LAN_IPV4`:return[{label:`172.18.0.0/16`,value:`172.18.0.0/16`},{label:`198.18.128.0/17`,value:`198.18.128.0/17`}];default:return null}}const zs=t(`/dashboard/settings`)({component:Vs});var Bs=Ln({defaultForwardCollectorConfigId:zn().optional(),defaultEnv:In(Ln({key:zn().min(1),value:zn()})).optional(),externalTemplateRepos:In(Ln({id:zn().optional(),name:zn().optional(),repo:zn().min(1),defaultBranch:zn().optional()})).optional()});function Vs(){let e=u(),t=r({queryKey:W.userForwardCollectorConfigs(),queryFn:ra,staleTime:1e4}),n=r({queryKey:W.userSettings(),queryFn:ni,staleTime:1e4}),i=t.data?.collectors??[],a=(0,P.useMemo)(()=>n.data?.defaultForwardCollectorConfigId||(i.find(e=>e.name===`default`)?.id??i[0]?.id??``),[i,n.data?.defaultForwardCollectorConfigId]),o=Dn({resolver:At(Bs),values:{defaultForwardCollectorConfigId:a||void 0,defaultEnv:n.data?.defaultEnv??[],externalTemplateRepos:n.data?.externalTemplateRepos??[]}}),s=vn({control:o.control,name:`defaultEnv`}),c=vn({control:o.control,name:`externalTemplateRepos`}),l=m({mutationFn:async e=>{let t=(e.externalTemplateRepos??[]).map(e=>{let t=e.repo.trim(),n=t.split(`/`).filter(Boolean).at(-1)?.replace(/\.git$/,``)??`repo`;return{id:e.id??globalThis.crypto?.randomUUID?.()??n,name:e.name?.trim()||n,repo:t,defaultBranch:e.defaultBranch?.trim()||`main`}});return ri({defaultForwardCollectorConfigId:e.defaultForwardCollectorConfigId,defaultEnv:e.defaultEnv??[],externalTemplateRepos:t})},onSuccess:async()=>{await e.invalidateQueries({queryKey:W.userSettings()}),N.success(`Saved`)},onError:e=>{N.error(e instanceof Error?e.message:`Failed to save user settings`)}}),d=t.isLoading||n.isLoading||l.isPending,p=r({queryKey:W.userAwsStaticCredentials(),queryFn:ii,staleTime:1e4,retry:!1}),h=r({queryKey:W.userAwsSsoCredentials(),queryFn:si,staleTime:1e4,retry:!1}),g=r({queryKey:W.userAzureCredentials(),queryFn:ui,staleTime:1e4,retry:!1}),_=r({queryKey:W.userGcpCredentials(),queryFn:pi,staleTime:1e4,retry:!1}),v=r({queryKey:W.userIbmCredentials(),queryFn:gi,staleTime:1e4,retry:!1}),y=r({queryKey:W.userNetlabServers(),queryFn:yi,staleTime:1e4,retry:!1}),b=r({queryKey:W.userEveServers(),queryFn:Si,staleTime:1e4,retry:!1}),x=r({queryKey:W.userContainerlabServers(),queryFn:Ti,staleTime:1e4,retry:!1}),S=r({queryKey:W.userServiceNowConfig(),queryFn:Wr,staleTime:1e4,retry:!1}),ee=r({queryKey:W.userGeminiConfig(),queryFn:Zr,staleTime:1e4,retry:!1}),[C,te]=(0,P.useState)(``),[w,T]=(0,P.useState)(``),[E,ne]=(0,P.useState)(``),[D,re]=(0,P.useState)(``),[O,ie]=(0,P.useState)(``),[ae,oe]=(0,P.useState)(``),[se,ce]=(0,P.useState)(``),[le,ue]=(0,P.useState)(``),[de,fe]=(0,P.useState)(``),[pe,me]=(0,P.useState)(``),[k,he]=(0,P.useState)(``),[ge,ve]=(0,P.useState)(``),[ye,be]=(0,P.useState)(``),[xe,Se]=(0,P.useState)(``),[Ce,we]=(0,P.useState)(``),[Te,Ee]=(0,P.useState)(``),[De,A]=(0,P.useState)(!0),[Oe,ke]=(0,P.useState)(``),[Ae,je]=(0,P.useState)(``),[Me,j]=(0,P.useState)(``),[Ne,Pe]=(0,P.useState)(!0),[Fe,Ie]=(0,P.useState)(``),[Le,M]=(0,P.useState)(``),[Re,ze]=(0,P.useState)(``),[Be,Ve]=(0,P.useState)(``),[He,Ue]=(0,P.useState)(!0),[We,Ge]=(0,P.useState)(``),[Ke,qe]=(0,P.useState)(``),Je=e=>{try{return new URL(e).hostname||e}catch{return e}},Ye=m({mutationFn:async()=>ai({accessKeyId:C.trim(),secretAccessKey:w}),onSuccess:async()=>{T(``),await e.invalidateQueries({queryKey:W.userAwsStaticCredentials()}),N.success(`AWS static credentials saved`)},onError:e=>N.error(`Failed to save AWS static credentials`,{description:e instanceof Error?e.message:String(e)})}),Xe=m({mutationFn:async()=>oi(),onSuccess:async()=>{te(``),T(``),await e.invalidateQueries({queryKey:W.userAwsStaticCredentials()}),N.success(`AWS static credentials deleted`)},onError:e=>N.error(`Failed to delete AWS static credentials`,{description:e instanceof Error?e.message:String(e)})}),Ze=m({mutationFn:async()=>ci({startUrl:E.trim(),region:D.trim(),accountId:O.trim(),roleName:ae.trim()}),onSuccess:async()=>{await e.invalidateQueries({queryKey:W.userAwsSsoCredentials()}),N.success(`AWS SSO config saved`)},onError:e=>N.error(`Failed to save AWS SSO config`,{description:e instanceof Error?e.message:String(e)})}),Qe=m({mutationFn:async()=>li(),onSuccess:async()=>{ne(``),re(``),ie(``),oe(``),await e.invalidateQueries({queryKey:W.userAwsSsoCredentials()}),N.success(`AWS SSO config deleted`)},onError:e=>N.error(`Failed to delete AWS SSO config`,{description:e instanceof Error?e.message:String(e)})}),$e=m({mutationFn:async()=>di({tenantId:se.trim(),clientId:le.trim(),clientSecret:de,subscriptionId:pe.trim()||void 0}),onSuccess:async()=>{fe(``),await e.invalidateQueries({queryKey:W.userAzureCredentials()}),N.success(`Azure credentials saved`)},onError:e=>N.error(`Failed to save Azure credentials`,{description:e instanceof Error?e.message:String(e)})}),et=m({mutationFn:async()=>fi(),onSuccess:async()=>{ce(``),ue(``),fe(``),me(``),await e.invalidateQueries({queryKey:W.userAzureCredentials()}),N.success(`Azure credentials deleted`)},onError:e=>N.error(`Failed to delete Azure credentials`,{description:e instanceof Error?e.message:String(e)})}),tt=m({mutationFn:async()=>mi({projectId:k.trim(),serviceAccountJSON:ge}),onSuccess:async()=>{ve(``),await e.invalidateQueries({queryKey:W.userGcpCredentials()}),N.success(`GCP credentials saved`)},onError:e=>N.error(`Failed to save GCP credentials`,{description:e instanceof Error?e.message:String(e)})}),nt=m({mutationFn:async()=>hi(),onSuccess:async()=>{he(``),ve(``),await e.invalidateQueries({queryKey:W.userGcpCredentials()}),N.success(`GCP credentials deleted`)},onError:e=>N.error(`Failed to delete GCP credentials`,{description:e instanceof Error?e.message:String(e)})}),rt=m({mutationFn:async()=>_i({apiKey:ye,region:xe.trim(),resourceGroupId:Ce.trim()||void 0}),onSuccess:async()=>{be(``),await e.invalidateQueries({queryKey:W.userIbmCredentials()}),N.success(`IBM Cloud credentials saved`)},onError:e=>N.error(`Failed to save IBM Cloud credentials`,{description:e instanceof Error?e.message:String(e)})}),it=m({mutationFn:async()=>vi(),onSuccess:async()=>{be(``),Se(``),we(``),await e.invalidateQueries({queryKey:W.userIbmCredentials()}),N.success(`IBM Cloud credentials deleted`)},onError:e=>N.error(`Failed to delete IBM Cloud credentials`,{description:e instanceof Error?e.message:String(e)})}),at=m({mutationFn:async()=>bi({name:Je(Te).trim(),apiUrl:Te.trim(),apiInsecure:De,apiUser:Oe.trim()||void 0,apiPassword:Ae.trim()||void 0}),onSuccess:async()=>{Ee(``),A(!0),ke(``),je(``),await e.invalidateQueries({queryKey:W.userNetlabServers()}),N.success(`Netlab server saved`)},onError:e=>N.error(`Failed to save Netlab server`,{description:e instanceof Error?e.message:String(e)})}),ot=m({mutationFn:async e=>xi(e),onSuccess:async()=>{await e.invalidateQueries({queryKey:W.userNetlabServers()}),N.success(`Netlab server deleted`)},onError:e=>N.error(`Failed to delete Netlab server`,{description:e instanceof Error?e.message:String(e)})}),st=m({mutationFn:async()=>Ei({name:Je(Me).trim(),apiUrl:Me.trim(),apiInsecure:Ne,apiUser:Fe.trim()||void 0,apiPassword:Le.trim()||void 0}),onSuccess:async()=>{j(``),Pe(!0),Ie(``),M(``),await e.invalidateQueries({queryKey:W.userContainerlabServers()}),N.success(`Containerlab server saved`)},onError:e=>N.error(`Failed to save Containerlab server`,{description:e instanceof Error?e.message:String(e)})}),ct=m({mutationFn:async e=>Di(e),onSuccess:async()=>{await e.invalidateQueries({queryKey:W.userContainerlabServers()}),N.success(`Containerlab server deleted`)},onError:e=>N.error(`Failed to delete Containerlab server`,{description:e instanceof Error?e.message:String(e)})}),lt=m({mutationFn:async()=>Ci({name:Je(Re).trim(),apiUrl:Re.trim(),webUrl:Be.trim()||void 0,skipTlsVerify:He,apiUser:We.trim()||void 0,apiPassword:Ke.trim()||void 0}),onSuccess:async()=>{ze(``),Ve(``),Ue(!0),Ge(``),qe(``),await e.invalidateQueries({queryKey:W.userEveServers()}),N.success(`EVE-NG server saved`)},onError:e=>N.error(`Failed to save EVE-NG server`,{description:e instanceof Error?e.message:String(e)})}),ut=m({mutationFn:async e=>wi(e),onSuccess:async()=>{await e.invalidateQueries({queryKey:W.userEveServers()}),N.success(`EVE-NG server deleted`)},onError:e=>N.error(`Failed to delete EVE-NG server`,{description:e instanceof Error?e.message:String(e)})});return(0,I.jsxs)(`div`,{className:`mx-auto w-full max-w-4xl space-y-6 p-6`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`My Settings`}),(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Defaults that pre-fill new deployments. These do not change existing deployments.`})]}),(0,I.jsx)(ws,{...o,children:(0,I.jsxs)(`form`,{onSubmit:o.handleSubmit(e=>l.mutate(e)),className:`space-y-6`,children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Integrations`})}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Forward collector`}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:i.length?`${i.length} configured`:`None configured`})]}),(0,I.jsx)(L,{asChild:!0,variant:`outline`,children:(0,I.jsx)(f,{to:`/dashboard/forward`,children:`Open`})})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`ServiceNow`}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:S.data?.configured?`Configured`:`Not configured`})]}),(0,I.jsx)(L,{asChild:!0,variant:`outline`,children:(0,I.jsx)(f,{to:`/dashboard/servicenow`,children:`Open`})})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Connect AI (Gemini)`}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:ee.data?.enabled?ee.data?.configured?`Connected`:`Not connected`:`Disabled`})]}),(0,I.jsx)(L,{asChild:!0,variant:`outline`,children:(0,I.jsx)(f,{to:`/dashboard/gemini`,children:`Open`})})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Defaults`})}),(0,I.jsxs)(U,{className:`space-y-6`,children:[(0,I.jsx)(Es,{control:o.control,name:`defaultForwardCollectorConfigId`,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{children:`Default Forward collector`}),(0,I.jsxs)(Y,{value:e.value??``,onValueChange:t=>e.onChange(t),disabled:i.length===0,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:i.length?`Select collector`:`No collectors`})}),(0,I.jsx)(Q,{children:i.slice().sort((e,t)=>e.name===`default`?-1:t.name===`default`?1:0).map(e=>(0,I.jsx)($,{value:e.id,children:e.name},e.id))})]}),(0,I.jsx)(Ns,{})]})}),(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Default environment variables`}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Used for Netlab/Clabernetes generator env overrides.`})]}),(0,I.jsx)(L,{type:`button`,variant:`outline`,onClick:()=>s.append({key:`NETLAB_DEVICE`,value:``}),children:`Add variable`})]}),s.fields.length===0?(0,I.jsx)(`div`,{className:`rounded border p-4 text-sm text-muted-foreground`,children:`No default variables.`}):(0,I.jsx)(`div`,{className:`space-y-3`,children:s.fields.map((e,t)=>{let n=`defaultEnv.${t}.key`,r=`defaultEnv.${t}.value`,i=o.watch(n)||e.key,a=Rs(i),c=Ls(i);return(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsx)(Es,{control:o.control,name:n,render:({field:e})=>(0,I.jsxs)(ks,{className:`w-1/2`,children:[(0,I.jsx)(As,{className:`sr-only`,children:`Key`}),(0,I.jsxs)(Y,{value:e.value,onValueChange:t=>e.onChange(t),children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select key`})}),(0,I.jsx)(Q,{children:Fs.map(e=>(0,I.jsx)($,{value:e.key,children:e.label},e.key))})]}),(0,I.jsx)(Ns,{})]})}),(0,I.jsx)(Es,{control:o.control,name:r,render:({field:e})=>(0,I.jsxs)(ks,{className:`w-1/2`,children:[(0,I.jsx)(As,{className:`sr-only`,children:`Value`}),a?(0,I.jsxs)(Y,{value:e.value,onValueChange:t=>e.onChange(t),children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select value`})}),(0,I.jsx)(Q,{children:a.map(e=>(0,I.jsx)($,{value:e.value,children:e.label},e.value))})]}):(0,I.jsx)(J,{...e,placeholder:c?`Enter value`:`Value`}),(0,I.jsx)(Ns,{})]})}),(0,I.jsx)(L,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>s.remove(t),children:(0,I.jsx)(Mn,{className:`h-4 w-4`})})]},e.id)})})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`External Template Repos`})}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-4`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`IDs referenced when selecting template source = External.`}),(0,I.jsx)(L,{type:`button`,variant:`outline`,onClick:()=>c.append({name:``,repo:``,defaultBranch:``}),children:`Add repo`})]}),c.fields.length===0?(0,I.jsx)(`div`,{className:`rounded border p-4 text-sm text-muted-foreground`,children:`No external repos configured.`}):(0,I.jsx)(`div`,{className:`space-y-3`,children:c.fields.map((e,t)=>{let n=`externalTemplateRepos.${t}.id`,r=`externalTemplateRepos.${t}.name`,i=`externalTemplateRepos.${t}.repo`,a=`externalTemplateRepos.${t}.defaultBranch`;return(0,I.jsxs)(`div`,{className:`grid gap-2 rounded border p-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`ID:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:o.watch(n)||e.id||`(new)`})]}),(0,I.jsx)(L,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>c.remove(t),children:(0,I.jsx)(Mn,{className:`h-4 w-4`})})]}),(0,I.jsx)(Es,{control:o.control,name:n,render:({field:e})=>(0,I.jsxs)(ks,{className:`hidden`,children:[(0,I.jsx)(As,{className:`sr-only`,children:`ID`}),(0,I.jsx)(J,{...e})]})}),(0,I.jsx)(Es,{control:o.control,name:r,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{children:`Name (optional)`}),(0,I.jsx)(J,{...e,placeholder:`My repo`}),(0,I.jsx)(Ns,{})]})}),(0,I.jsx)(Es,{control:o.control,name:i,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{children:`Repo`}),(0,I.jsx)(J,{...e,placeholder:`owner/repo or git URL`}),(0,I.jsx)(Ns,{})]})}),(0,I.jsx)(Es,{control:o.control,name:a,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{children:`Default branch (optional)`}),(0,I.jsx)(J,{...e,placeholder:`main`}),(0,I.jsx)(Ns,{})]})})]},e.id)})})]})]}),(0,I.jsx)(`div`,{className:`flex items-center justify-end gap-2`,children:(0,I.jsx)(L,{type:`submit`,disabled:d||!o.formState.isDirty,children:l.isPending?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(un,{className:`mr-2 h-4 w-4 animate-spin`}),`Saving`]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(_e,{className:`mr-2 h-4 w-4`}),`Save`]})})})]})}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Cloud Credentials`})}),(0,I.jsxs)(U,{className:`space-y-8`,children:[(0,I.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`rounded border p-4 space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`AWS (static)`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:p.data?.configured?`Configured (${p.data?.accessKeyLast4??``})`:`Not configured`})]}),(0,I.jsx)(J,{placeholder:`Access key id`,value:C,onChange:e=>te(e.target.value)}),(0,I.jsx)(J,{placeholder:`Secret access key`,type:`password`,value:w,onChange:e=>T(e.target.value)}),(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsx)(L,{type:`button`,onClick:()=>Ye.mutate(),disabled:Ye.isPending,children:`Save`}),(0,I.jsx)(L,{type:`button`,variant:`outline`,onClick:()=>Xe.mutate(),disabled:Xe.isPending,children:`Delete`})]})]}),(0,I.jsxs)(`div`,{className:`rounded border p-4 space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`AWS (SSO config)`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:h.data?.configured?`Configured`:`Not configured`})]}),(0,I.jsx)(J,{placeholder:`Start URL`,value:E,onChange:e=>ne(e.target.value)}),(0,I.jsx)(J,{placeholder:`Region`,value:D,onChange:e=>re(e.target.value)}),(0,I.jsx)(J,{placeholder:`Account ID`,value:O,onChange:e=>ie(e.target.value)}),(0,I.jsx)(J,{placeholder:`Role name`,value:ae,onChange:e=>oe(e.target.value)}),(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsx)(L,{type:`button`,onClick:()=>Ze.mutate(),disabled:Ze.isPending,children:`Save`}),(0,I.jsx)(L,{type:`button`,variant:`outline`,onClick:()=>Qe.mutate(),disabled:Qe.isPending,children:`Delete`})]})]})]}),(0,I.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-3`,children:[(0,I.jsxs)(`div`,{className:`rounded border p-4 space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Azure`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:g.data?.configured?`Configured`:`Not configured`})]}),(0,I.jsx)(J,{placeholder:`Tenant ID`,value:se,onChange:e=>ce(e.target.value)}),(0,I.jsx)(J,{placeholder:`Client ID`,value:le,onChange:e=>ue(e.target.value)}),(0,I.jsx)(J,{placeholder:`Client secret`,type:`password`,value:de,onChange:e=>fe(e.target.value)}),(0,I.jsx)(J,{placeholder:`Subscription ID (optional)`,value:pe,onChange:e=>me(e.target.value)}),(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsx)(L,{type:`button`,onClick:()=>$e.mutate(),disabled:$e.isPending,children:`Save`}),(0,I.jsx)(L,{type:`button`,variant:`outline`,onClick:()=>et.mutate(),disabled:et.isPending,children:`Delete`})]})]}),(0,I.jsxs)(`div`,{className:`rounded border p-4 space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`GCP`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:_.data?.configured?`Configured`:`Not configured`})]}),(0,I.jsx)(J,{placeholder:`Project ID`,value:k,onChange:e=>he(e.target.value)}),(0,I.jsx)(Ps,{placeholder:`Service account JSON`,className:`min-h-[140px] font-mono text-xs`,value:ge,onChange:e=>ve(e.target.value)}),(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsx)(L,{type:`button`,onClick:()=>tt.mutate(),disabled:tt.isPending,children:`Save`}),(0,I.jsx)(L,{type:`button`,variant:`outline`,onClick:()=>nt.mutate(),disabled:nt.isPending,children:`Delete`})]})]}),(0,I.jsxs)(`div`,{className:`rounded border p-4 space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`IBM Cloud`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:v.data?.configured?`Configured`:`Not configured`})]}),(0,I.jsx)(J,{placeholder:`Region`,value:xe,onChange:e=>Se(e.target.value)}),(0,I.jsx)(J,{placeholder:`API key`,type:`password`,value:ye,onChange:e=>be(e.target.value)}),(0,I.jsx)(J,{placeholder:`Resource group ID (optional)`,value:Ce,onChange:e=>we(e.target.value)}),(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsx)(L,{type:`button`,onClick:()=>rt.mutate(),disabled:rt.isPending,children:`Save`}),(0,I.jsx)(L,{type:`button`,variant:`outline`,onClick:()=>it.mutate(),disabled:it.isPending,children:`Delete`})]})]})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`BYOL Servers`})}),(0,I.jsxs)(U,{className:`space-y-8`,children:[(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Netlab`}),(0,I.jsxs)(`div`,{className:`grid gap-2 md:grid-cols-2`,children:[(0,I.jsx)(J,{placeholder:`https://netlab.example.com`,value:Te,onChange:e=>Ee(e.target.value)}),(0,I.jsx)(J,{placeholder:`API username (optional)`,value:Oe,onChange:e=>ke(e.target.value)}),(0,I.jsx)(J,{placeholder:`API password (optional)`,type:`password`,value:Ae,onChange:e=>je(e.target.value)}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:De,onChange:e=>A(e.target.checked)}),(0,I.jsx)(`div`,{className:`text-sm`,children:`Skip TLS verify`})]})]}),(0,I.jsx)(L,{type:`button`,variant:`outline`,onClick:()=>at.mutate(),disabled:!Te.trim()||at.isPending,children:`Add/Update`}),(0,I.jsx)(`div`,{className:`space-y-2`,children:(y.data?.servers??[]).map(e=>(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded border px-3 py-2`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`truncate text-sm font-medium`,children:e.name}),(0,I.jsx)(`div`,{className:`truncate text-xs text-muted-foreground font-mono`,children:e.apiUrl})]}),(0,I.jsx)(L,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>e.id&&ot.mutate(e.id),children:(0,I.jsx)(Mn,{className:`h-4 w-4`})})]},e.id))})]}),(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Containerlab`}),(0,I.jsxs)(`div`,{className:`grid gap-2 md:grid-cols-2`,children:[(0,I.jsx)(J,{placeholder:`https://clab.example.com`,value:Me,onChange:e=>j(e.target.value)}),(0,I.jsx)(J,{placeholder:`API username (optional)`,value:Fe,onChange:e=>Ie(e.target.value)}),(0,I.jsx)(J,{placeholder:`API password (optional)`,type:`password`,value:Le,onChange:e=>M(e.target.value)}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:Ne,onChange:e=>Pe(e.target.checked)}),(0,I.jsx)(`div`,{className:`text-sm`,children:`Skip TLS verify`})]})]}),(0,I.jsx)(L,{type:`button`,variant:`outline`,onClick:()=>st.mutate(),disabled:!Me.trim()||st.isPending,children:`Add/Update`}),(0,I.jsx)(`div`,{className:`space-y-2`,children:(x.data?.servers??[]).map(e=>(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded border px-3 py-2`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`truncate text-sm font-medium`,children:e.name}),(0,I.jsx)(`div`,{className:`truncate text-xs text-muted-foreground font-mono`,children:e.apiUrl})]}),(0,I.jsx)(L,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>e.id&&ct.mutate(e.id),children:(0,I.jsx)(Mn,{className:`h-4 w-4`})})]},e.id))})]}),(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`EVE-NG`}),(0,I.jsxs)(`div`,{className:`grid gap-2 md:grid-cols-2`,children:[(0,I.jsx)(J,{placeholder:`https://eve.example.com/api`,value:Re,onChange:e=>ze(e.target.value)}),(0,I.jsx)(J,{placeholder:`Web URL (optional)`,value:Be,onChange:e=>Ve(e.target.value)}),(0,I.jsx)(J,{placeholder:`API username (optional)`,value:We,onChange:e=>Ge(e.target.value)}),(0,I.jsx)(J,{placeholder:`API password (optional)`,type:`password`,value:Ke,onChange:e=>qe(e.target.value)}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:He,onChange:e=>Ue(e.target.checked)}),(0,I.jsx)(`div`,{className:`text-sm`,children:`Skip TLS verify`})]})]}),(0,I.jsx)(L,{type:`button`,variant:`outline`,onClick:()=>lt.mutate(),disabled:!Re.trim()||lt.isPending,children:`Add/Update`}),(0,I.jsx)(`div`,{className:`space-y-2`,children:(b.data?.servers??[]).map(e=>(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded border px-3 py-2`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`truncate text-sm font-medium`,children:e.name}),(0,I.jsx)(`div`,{className:`truncate text-xs text-muted-foreground font-mono`,children:e.apiUrl})]}),(0,I.jsx)(L,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>e.id&&ut.mutate(e.id),children:(0,I.jsx)(Mn,{className:`h-4 w-4`})})]},e.id))})]})]})]})]})}const Hs=t(`/dashboard/servicenow`)({component:Us});function Us(){let e=u(),t=W.userServiceNowConfig(),n=W.userServiceNowPdiStatus(),i=W.userServiceNowSchemaStatus(),a=W.userForwardCollectorConfigs(),o=r({queryKey:t,queryFn:Wr,retry:!1}).data,[s,c]=(0,P.useState)(``),[l,d]=(0,P.useState)(``),[f,p]=(0,P.useState)(``),[h,g]=(0,P.useState)(``),[_,v]=(0,P.useState)(`collector`),[y,b]=(0,P.useState)(``),[x,S]=(0,P.useState)(``),[ee,C]=(0,P.useState)(!0);(0,P.useEffect)(()=>{o&&(c(o.instanceUrl??``),d(o.adminUsername??``),g(o.forwardCollectorConfigId??``),v(o.forwardCollectorConfigId?`collector`:o.forwardUsername?`custom`:`collector`),b(o.forwardUsername??``))},[o]);let te=r({queryKey:a,queryFn:ra,retry:!1,staleTime:3e4}),w=(0,P.useMemo)(()=>te.data?.collectors??[],[te.data]);(0,P.useEffect)(()=>{if(_!==`collector`||h)return;let e=w.find(e=>e.isDefault)??w[0];e?.id&&g(e.id)},[o,w,h,_]);let T=r({queryKey:n,queryFn:qr,enabled:!!o?.configured,retry:!1,refetchOnWindowFocus:!0,staleTime:0,refetchInterval:e=>{if(document.visibilityState===`hidden`)return!1;let t=e.state.data?.status??``;return t===`awake`?12e4:t===`sleeping`||t===`waking`||t===`unreachable`?3e4:6e4}}),E=r({queryKey:i,queryFn:Jr,enabled:!!o?.configured,retry:!1,refetchOnWindowFocus:!0,staleTime:0}),ne=(0,P.useMemo)(()=>(E.data?.missing??[]).some(e=>e.startsWith(`table:`)),[E.data?.missing]),D=(0,P.useMemo)(()=>{let e=(s||o?.instanceUrl||``).trim().replace(/\/+$/,``);return e?`${e}/sp?id=connectivity_ticket`:``},[o?.instanceUrl,s]),re=m({mutationFn:async()=>Yr(),onSuccess:async()=>{N.success(`Wake requested`),await e.invalidateQueries({queryKey:n})},onError:e=>N.error(`Failed to wake PDI`,{description:e.message})}),O=m({mutationFn:async()=>{if(!s.trim())throw Error(`ServiceNow instance URL is required`);if(!l.trim())throw Error(`ServiceNow admin username is required`);let e=_===`collector`;if(e){if(!h.trim())throw Error(`Select a Forward collector (or choose Custom)`)}else if(!y.trim())throw Error(`Forward username is required`);return Gr({instanceUrl:s.trim(),adminUsername:l.trim(),adminPassword:f,forwardCollectorConfigId:e?h.trim():``,forwardUsername:e?``:y.trim(),forwardPassword:e?``:x})},onSuccess:async()=>{N.success(`Saved ServiceNow settings`),p(``),S(``),await e.invalidateQueries({queryKey:t}),await e.invalidateQueries({queryKey:n}),await e.invalidateQueries({queryKey:i}),ee&&ae.mutate()},onError:e=>N.error(`Failed to save ServiceNow settings`,{description:e.message})}),ie=m({mutationFn:async()=>Kr(),onSuccess:async n=>{n.installed?N.success(`ServiceNow demo installed`):N.error(`ServiceNow install failed`,{description:n.message}),await e.invalidateQueries({queryKey:t})},onError:e=>N.error(`Failed to install ServiceNow demo`,{description:e.message})}),ae=m({mutationFn:async()=>Xr(),onSuccess:async e=>{e.configured?N.success(`Configured Forward ticketing integration`):N.error(`Failed to configure Forward`,{description:e.message})},onError:e=>N.error(`Failed to configure Forward`,{description:e.message})});return(0,I.jsxs)(`div`,{className:`p-6 space-y-6`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold`,children:`ServiceNow`}),(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground mt-1`,children:`Install the Forward Connectivity Ticket demo into a ServiceNow PDI. ServiceNow calls Forward SaaS directly; Skyforge only installs and configures the app.`})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Quick links`}),(0,I.jsx)(H,{children:`Create a ServiceNow PDI (manual step).`})]}),(0,I.jsxs)(U,{className:`space-y-2`,children:[(0,I.jsx)(`a`,{className:`text-sm underline`,href:`https://developer.servicenow.com/dev.do#!/guides/now-platform/pdi-guide/obtaining-a-pdi`,target:`_blank`,rel:`noreferrer`,children:`Create a Personal Developer Instance (PDI)`}),(0,I.jsx)(`a`,{className:`text-sm underline`,href:`/dashboard/docs/servicenow`,target:`_blank`,rel:`noreferrer`,children:`Open Skyforge ServiceNow docs`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Create and wake your PDI in the ServiceNow portal; then paste the instance URL and admin creds below.`}),D?(0,I.jsx)(`a`,{className:`text-sm underline`,href:D,target:`_blank`,rel:`noreferrer`,children:`Open the demo portal page (after install)`}):null]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`PDI status`}),(0,I.jsx)(H,{children:`ServiceNow PDIs can sleep after inactivity. Skyforge can detect this and attempt to wake the instance.`})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsx)(`div`,{className:`text-sm`,children:o?.configured?(0,I.jsxs)(I.Fragment,{children:[`Status:`,` `,(0,I.jsx)(`span`,{className:`font-medium`,children:T.data?.status??(T.isFetching?`checking`:`unknown`)}),T.data?.httpStatus?` (HTTP ${T.data.httpStatus})`:``,T.data?.detail?`  ${T.data.detail}`:``]}):(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:`Save configuration first.`})}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(L,{variant:`secondary`,onClick:()=>void T.refetch(),disabled:!o?.configured||T.isFetching||re.isPending,children:`Check now`}),(0,I.jsx)(L,{variant:`secondary`,onClick:()=>re.mutate(),disabled:!o?.configured||re.isPending,children:`Wake up`})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Schema status`}),(0,I.jsx)(H,{children:`The demo requires two custom tables. Create the tables once in the PDI; Skyforge can auto-create the required fields and choice lists when you install the demo app.`})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsx)(`div`,{className:`text-sm`,children:o?.configured?(0,I.jsxs)(I.Fragment,{children:[`Status:`,` `,(0,I.jsx)(`span`,{className:`font-medium`,children:E.data?.status??(E.isFetching?`checking`:`unknown`)}),E.data?.checkedAt?` (checked ${E.data.checkedAt})`:``,E.data?.detail?`  ${E.data.detail}`:``]}):(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:`Save configuration first.`})}),o?.configured&&s?(0,I.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Portal page:`,` `,(0,I.jsx)(`a`,{className:`underline`,href:`${s.replace(/\/+$/,``)}/sp?id=connectivity_ticket`,target:`_blank`,rel:`noreferrer`,children:`/sp?id=connectivity_ticket`})]}):null,o?.configured&&s?(0,I.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Find records:`,` `,(0,I.jsx)(`a`,{className:`underline`,href:`${s.replace(/\/+$/,``)}/sp_widget_list.do?sysparm_query=name=Connectivity%20Ticket%20Analyzer`,target:`_blank`,rel:`noreferrer`,children:`widget`}),`  `,(0,I.jsx)(`a`,{className:`underline`,href:`${s.replace(/\/+$/,``)}/sp_page_list.do?sysparm_query=id=connectivity_ticket`,target:`_blank`,rel:`noreferrer`,children:`page`}),`  `,(0,I.jsx)(`a`,{className:`underline`,href:`${s.replace(/\/+$/,``)}/sys_rest_message_list.do?sysparm_query=name=Forward%20API`,target:`_blank`,rel:`noreferrer`,children:`REST message`})]}):null,E.data?.status===`missing`&&E.data.missing?.length?(0,I.jsxs)(`div`,{className:`rounded-md border p-3 bg-muted/30`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground mb-2`,children:`Missing items:`}),ne?(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground mb-2`,children:[`Create the missing `,(0,I.jsx)(`span`,{className:`font-medium`,children:`tables`}),` `,`in ServiceNow first; then click`,` `,(0,I.jsx)(`span`,{className:`font-medium`,children:`Install demo app`}),` to let Skyforge auto-create the rest.`]}):(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground mb-2`,children:[`Click `,(0,I.jsx)(`span`,{className:`font-medium`,children:`Install demo app`}),` to let Skyforge auto-create these fields/choices.`]}),(0,I.jsx)(`ul`,{className:`text-xs font-mono space-y-1`,children:E.data.missing.map(e=>(0,I.jsxs)(`li`,{children:[`- `,e]},e))})]}):null,(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(L,{variant:`secondary`,onClick:()=>void E.refetch(),disabled:!o?.configured||E.isFetching,children:`Check schema`}),(0,I.jsx)(`a`,{className:`text-sm underline text-muted-foreground`,href:`/dashboard/docs/servicenow`,target:`_blank`,rel:`noreferrer`,children:`Docs`})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Configuration`}),(0,I.jsx)(H,{children:`Skyforge uses ServiceNow admin creds to install/configure. Forward creds are stored in ServiceNow as a Basic Auth credential for the demo REST Message.`})]}),(0,I.jsxs)(U,{className:`space-y-6`,children:[(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`ServiceNow instance URL`}),(0,I.jsx)(J,{value:s,onChange:e=>c(e.target.value),placeholder:`https://dev12345.service-now.com`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`ServiceNow admin username`}),(0,I.jsx)(J,{value:l,onChange:e=>d(e.target.value),placeholder:`admin`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`ServiceNow admin password`}),(0,I.jsx)(J,{type:`password`,value:f,onChange:e=>p(e.target.value),placeholder:o?.hasAdminPassword?`(leave blank to keep stored)`:``})]})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Forward credentials`}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Uses Forward SaaS (`,(0,I.jsx)(`code`,{children:`https://fwd.app`}),`).`]}),(0,I.jsxs)(Y,{value:_===`custom`?`custom`:h||``,onValueChange:e=>{if(e===`custom`){v(`custom`),g(``);return}v(`collector`),g(e)},children:[(0,I.jsx)(Z,{className:`w-full`,children:(0,I.jsx)(X,{placeholder:`Select a collector`})}),(0,I.jsxs)(Q,{children:[w.map(e=>(0,I.jsxs)($,{value:e.id,children:[e.name,e.isDefault?` (default)`:``]},e.id)),(0,I.jsx)($,{value:`custom`,children:`Custom`})]})]})]}),_===`custom`?(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Forward username`}),(0,I.jsx)(J,{value:y,onChange:e=>b(e.target.value),placeholder:`you@example.com`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Forward password`}),(0,I.jsx)(J,{type:`password`,value:x,onChange:e=>S(e.target.value),placeholder:o?.hasForwardPassword?`(leave blank to keep stored)`:``})]})]}):null,(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Forward integration`}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(rs,{id:`snow-configure-ticketing-on-save`,checked:ee,onCheckedChange:e=>C(!!e)}),(0,I.jsx)(q,{htmlFor:`snow-configure-ticketing-on-save`,className:`font-normal text-sm`,children:`Configure Forward ticketing integration on save`})]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Configures Forward SaaS to auto-create and auto-update incidents in this ServiceNow instance.`})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(L,{onClick:()=>O.mutate(),disabled:O.isPending||ie.isPending,children:`Save`}),(0,I.jsx)(L,{variant:`secondary`,onClick:()=>ie.mutate(),disabled:ie.isPending||O.isPending||!o?.configured||ne,children:`Install demo app`}),D?(0,I.jsx)(L,{variant:`outline`,asChild:!0,disabled:!o?.configured||ne,children:(0,I.jsx)(`a`,{href:D,target:`_blank`,rel:`noreferrer`,children:`Open in ServiceNow`})}):null,(0,I.jsx)(L,{variant:`secondary`,onClick:()=>ae.mutate(),disabled:ae.isPending||O.isPending||!o?.configured,children:`Configure Forward (ticketing)`}),(0,I.jsx)(`a`,{className:`text-sm underline text-muted-foreground ml-2`,href:`/dashboard/docs/servicenow`,target:`_blank`,rel:`noreferrer`,children:`Docs`}),o?.lastInstallStatus?(0,I.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Status: `,o.lastInstallStatus,o.lastInstallError?` (${o.lastInstallError})`:``]}):null]})]})]})]})}const Ws=t(`/dashboard/s3`)({component:Gs});function Gs(){let e=r({queryKey:W.workspaces(),queryFn:Mr,staleTime:3e4}),t=e.data?.workspaces??[],[n,i]=(0,P.useState)(``),[a,o]=(0,P.useState)(``);(0,P.useEffect)(()=>{if(t.length===0)return;let e=window.localStorage.getItem(`skyforge.lastWorkspaceId.s3`)??``,n=t.some(t=>t.id===e)?e:t[0]?.id??``;i(e=>e||n)},[t]);let s=r({queryKey:W.workspaceArtifacts(n),queryFn:async()=>la(n,{prefix:a||void 0}),staleTime:1e4,enabled:!!n}),c=s.data?.items??[],l=(0,P.useMemo)(()=>[{id:`object`,header:`Object`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.key})},{id:`actions`,header:`Actions`,width:300,align:`right`,cell:e=>(0,I.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[e.key.toLowerCase().endsWith(`.json`)&&(0,I.jsxs)(L,{variant:`outline`,size:`sm`,onClick:async()=>{try{let t=await ua(n,e.key),r=atob(t.fileData),i=new Uint8Array(r.length);for(let e=0;e<r.length;e++)i[e]=r.charCodeAt(e);let a=new TextDecoder().decode(i),o=JSON.stringify(JSON.parse(a),null,2),s=new Blob([o],{type:`application/json`}),c=URL.createObjectURL(s);window.open(c,`_blank`,`noopener,noreferrer`),window.setTimeout(()=>URL.revokeObjectURL(c),1e4)}catch(e){N.error(`View failed`,{description:e.message})}},disabled:!n,children:[(0,I.jsx)(Sn,{className:`mr-2 h-3 w-3`}),`View`]}),(0,I.jsxs)(L,{variant:`outline`,size:`sm`,onClick:async()=>{try{let t=await ua(n,e.key),r=atob(t.fileData),i=new Uint8Array(r.length);for(let e=0;e<r.length;e++)i[e]=r.charCodeAt(e);let a=new Blob([i]),o=URL.createObjectURL(a),s=document.createElement(`a`);s.href=o,s.download=e.key.split(`/`).pop()||`artifact`,document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(o)}catch(e){N.error(`Download failed`,{description:e.message})}},disabled:!n,children:[(0,I.jsx)(E,{className:`mr-2 h-3 w-3`}),`Download`]}),(0,I.jsxs)(L,{variant:`destructive`,size:`sm`,onClick:async()=>{if(confirm(`Delete ${e.key}?`))try{await fa(n,e.key),N.success(`Deleted`,{description:e.key}),await s.refetch()}catch(e){N.error(`Delete failed`,{description:e.message})}},disabled:!n,children:[(0,I.jsx)(Mn,{className:`mr-2 h-3 w-3`}),`Delete`]})]})}],[s.refetch,n]),u=(0,I.jsxs)(`div`,{className:`p-4 border-b flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Workspace`}),(0,I.jsxs)(Y,{value:n,onValueChange:e=>{i(e),window.localStorage.setItem(`skyforge.lastWorkspaceId.s3`,e)},disabled:t.length===0,children:[(0,I.jsx)(Z,{className:`w-[280px]`,children:(0,I.jsx)(X,{placeholder:`Select workspace`})}),(0,I.jsx)(Q,{children:t.map(e=>(0,I.jsxs)($,{value:e.id,children:[e.name,` (`,e.slug,`)`]},e.id))})]})]}),(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center`,children:[(0,I.jsx)(J,{placeholder:`Prefix (e.g. topology/)`,value:a,onChange:e=>o(e.target.value),className:`w-[260px]`}),(0,I.jsx)(L,{variant:`outline`,size:`sm`,onClick:()=>s.refetch(),disabled:!n,children:`Refresh`}),(0,I.jsxs)(L,{variant:`outline`,size:`sm`,onClick:async()=>{if(!n)return;let e=window.prompt(`Folder prefix (e.g. uploads/)`);if(e)try{await pa(n,e),N.success(`Folder created`),await s.refetch()}catch(e){N.error(`Create folder failed`,{description:e.message})}},disabled:!n,children:[(0,I.jsx)(On,{className:`mr-2 h-3 w-3`}),`Folder`]}),(0,I.jsxs)(L,{variant:`outline`,size:`sm`,onClick:()=>{if(!n)return;let e=document.createElement(`input`);e.type=`file`,e.onchange=()=>{let t=e.files?.[0];t&&(async()=>{try{let e=new Uint8Array(await t.arrayBuffer()),r=``,i=32*1024;for(let t=0;t<e.length;t+=i){let n=e.subarray(t,t+i);r+=btoa(String.fromCharCode(...n))}let o=(a||``)+t.name;await da(n,{key:o,contentBase64:r,contentType:t.type||`application/octet-stream`}),N.success(`Uploaded`,{description:o}),await s.refetch()}catch(e){N.error(`Upload failed`,{description:e.message})}})()},e.click()},disabled:!n,children:[(0,I.jsx)(k,{className:`mr-2 h-3 w-3`}),`Upload`]})]})]});return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`S3`}),(0,I.jsx)(H,{children:`Workspace artifacts and generated files (backed by the platform object store).`})]})}),(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`p-0`,children:e.isLoading||s.isLoading?(0,I.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,I.jsx)(K,{className:`h-12 w-full`}),(0,I.jsx)(K,{className:`h-12 w-full`}),(0,I.jsx)(K,{className:`h-12 w-full`})]}):(0,I.jsxs)(`div`,{children:[u,e.isError||s.isError?(0,I.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to list objects.`}):c.length===0?(0,I.jsx)(`div`,{className:`p-6`,children:(0,I.jsx)(To,{icon:Kt,title:`No objects found`,description:`No artifacts found for this workspace.`})}):(0,I.jsx)(wo,{columns:l,rows:c,getRowId:e=>e.key,maxHeightClassName:`max-h-[60vh]`,minWidthClassName:`min-w-[900px]`})]})})})]})}const Ks=t(`/dashboard/gemini`)({component:qs});function qs(){let e=u(),t=n(),i=W.userGeminiConfig(),a=Ks.useSearch(),o=r({queryKey:i,queryFn:Zr,refetchInterval:1e4});(0,P.useEffect)(()=>{let e=String(a?.error??``);if(!e)return;let n=e===`oauth_denied`?`Gemini authorization denied`:e===`oauth_failed`?`Gemini authorization failed`:e===`store_failed`?`Failed to store Gemini tokens`:`Gemini connect failed`;N.error(n),t({to:`/dashboard/gemini`,replace:!0})},[t,a?.error]);let s=m({mutationFn:async()=>Qr(),onSuccess:async()=>{N.success(`Disconnected Gemini`),await e.invalidateQueries({queryKey:i})},onError:e=>{N.error(`Failed to disconnect Gemini`,{description:e instanceof Error?e.message:String(e)})}}),c=o.data?.enabled??!1,l=o.data?.configured??!1;return(0,I.jsxs)(`div`,{className:`mx-auto w-full max-w-3xl space-y-4 p-4`,children:[(0,I.jsx)(`div`,{className:`flex items-center justify-between gap-3`,children:(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold`,children:`Gemini`}),(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Connect your Google account so Skyforge can call Gemini/Vertex on your behalf (future workflows: template generation, validation helpers).`})]})}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Connection`})}),(0,I.jsx)(U,{className:`space-y-3`,children:o.isLoading?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading`}):c?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`grid gap-2 text-sm`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:`Status`}),(0,I.jsx)(`span`,{children:l?`Connected`:`Not connected`})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:`Email`}),(0,I.jsx)(`span`,{children:o.data?.email??``})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:`Scopes`}),(0,I.jsx)(`span`,{className:`truncate`,children:o.data?.scopes??``})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:`Updated`}),(0,I.jsx)(`span`,{children:o.data?.updatedAt??``})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(L,{disabled:!c,onClick:()=>{window.location.assign(`${Dr}/user/integrations/gemini/connect`)},children:l?`Reconnect`:`Connect`}),(0,I.jsx)(L,{variant:`secondary`,disabled:!l||s.isPending,onClick:()=>s.mutate(),children:`Disconnect`})]}),(0,I.jsxs)(`p`,{className:`text-xs text-muted-foreground`,children:[`Redirect URL (configure this in your Google Cloud OAuth client):`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:o.data?.redirectUrl??``})]})]}):(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Gemini integration is disabled on this Skyforge instance.`})})]})]})}const Js=t(`/dashboard/forward`)({component:Xs});function Ys(e,t){if(e===`cloud`)return`https://fwd.app`;let n=t.trim();return n?/^https?:\/\//i.test(n)?n:`https://${n}`:``}function Xs(){let e=u(),t=W.userForwardCollectorConfigs(),n=r({queryKey:t,queryFn:ra,refetchInterval:5e3,staleTime:1e4,retry:!1}),i=(0,P.useMemo)(()=>n.data?.collectors??[],[n.data?.collectors]),[a,o]=(0,P.useState)(``),s=r({queryKey:W.userForwardCollectorConfigLogs(a),queryFn:async()=>oa(a,300),enabled:!!a,refetchInterval:a?3e3:!1,retry:!1}),[c,l]=(0,P.useState)(`cloud`),[d,f]=(0,P.useState)(``),[p,h]=(0,P.useState)(!0),[g,_]=(0,P.useState)(``),[v,y]=(0,P.useState)(!1),[b,x]=(0,P.useState)(``),[S,ee]=(0,P.useState)(``),[C,te]=(0,P.useState)(!0),w=r({queryKey:W.userGitCredentials(),queryFn:$r,staleTime:6e4,retry:!1});(0,P.useEffect)(()=>{h(c!==`cloud`)},[c]),(0,P.useEffect)(()=>{if(v||g.trim())return;let e=(w.data?.username??``).trim();e&&_(`skyforge-${e}`)},[v,g,w.data?.username]);let T=m({mutationFn:async()=>{let e=g.trim();if(!e)throw Error(`Collector name is required`);let t=Ys(c,d);if(!t)throw Error(`Forward URL is required`);if(!b.trim()||!S.trim())throw Error(`Forward username/password are required`);return ia({name:e,baseUrl:t,skipTlsVerify:c===`onprem`?p:!1,username:b.trim(),password:S,setDefault:C})},onSuccess:async()=>{N.success(`Collector created`),ee(``),await e.invalidateQueries({queryKey:t})},onError:e=>N.error(`Failed to create collector`,{description:e.message})}),E=m({mutationFn:async e=>sa(e),onSuccess:async()=>{N.success(`Collector restarted`),await e.invalidateQueries({queryKey:t})},onError:e=>N.error(`Failed to restart collector`,{description:e.message})}),ne=m({mutationFn:async e=>aa(e),onSuccess:async(n,r)=>{N.success(`Collector deleted`),o(``),e.setQueryData(t,e=>{let t=e?.collectors??[];return{...e??{},collectors:t.filter(e=>String(e?.id??``)!==String(r))}}),await e.invalidateQueries({queryKey:t})},onError:e=>N.error(`Failed to delete collector`,{description:e.message})}),D=m({mutationFn:async e=>{for(let t of e)await aa(t)},onSuccess:async()=>{N.success(`Collectors deleted`),o(``),e.setQueryData(t,e=>({...e??{},collectors:[]})),await e.invalidateQueries({queryKey:t})},onError:e=>N.error(`Failed to delete collectors`,{description:e.message})});return(0,I.jsxs)(`div`,{className:`p-6 space-y-6`,children:[(0,I.jsx)(`div`,{className:`flex items-start justify-between gap-4`,children:(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold`,children:`Collector`}),(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground mt-1`,children:`Create one or more per-user in-cluster Forward collectors. Select a collector per deployment.`})]})}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Create collector`}),(0,I.jsx)(H,{children:`Creates a Forward collector and deploys a matching in-cluster Deployment. Deleting here only deletes the in-cluster Deployment and the saved credentials; it does not delete the Forward-side collector.`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Collector name`}),(0,I.jsx)(J,{value:g,onChange:e=>{y(!0),_(e.target.value)},placeholder:`skyforge-yourname`})]}),(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Forward target`}),(0,I.jsxs)(Y,{value:c,onValueChange:e=>l(e),children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`cloud`,children:`fwd.app (cloud)`}),(0,I.jsx)($,{value:`onprem`,children:`on-prem`})]})]})]}),c===`onprem`?(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`On-prem host`}),(0,I.jsx)(J,{value:d,onChange:e=>f(e.target.value),placeholder:`forward.example.com (:port)`})]}):null]}),c===`onprem`?(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(rs,{checked:p,onCheckedChange:e=>h(!!e)}),(0,I.jsx)(q,{className:`text-sm`,children:`Skip TLS verification`})]}):null,(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Forward username`}),(0,I.jsx)(J,{value:b,onChange:e=>x(e.target.value),placeholder:`you@company.com`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Forward password`}),(0,I.jsx)(J,{type:`password`,value:S,onChange:e=>ee(e.target.value),placeholder:``})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(rs,{checked:C,onCheckedChange:e=>te(!!e)}),(0,I.jsx)(q,{className:`text-sm`,children:`Make default`})]}),(0,I.jsx)(L,{onClick:()=>T.mutate(),disabled:T.isPending,children:T.isPending?`Creating`:`Create`})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-4`,children:[(0,I.jsx)(V,{children:`Configured collectors`}),i.length>0?(0,I.jsx)(L,{variant:`destructive`,size:`sm`,disabled:D.isPending,onClick:()=>{let e=i.map(e=>String(e.id)).filter(Boolean);e.length!==0&&confirm(`Delete ${e.length} collector(s)? This removes in-cluster Deployments and saved credentials.`)&&D.mutate(e)},children:D.isPending?`Deleting`:`Delete all`}):null]}),(0,I.jsx)(H,{children:`Each entry maps to one in-cluster Deployment and one Forward collector.`})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[n.isLoading?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading`}):null,n.isError?(0,I.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load collectors.`}):i.length===0?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No collectors configured yet.`}):null,i.map(e=>{let t=!!e.runtime?.ready,n=typeof e.forwardCollector?.connected==`boolean`?e.forwardCollector.connected:void 0;return(0,I.jsxs)(`div`,{className:`rounded-md border p-3 space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2 min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-medium truncate`,children:e.name}),e.isDefault?(0,I.jsx)(No,{variant:`secondary`,children:`default`}):null,e.decryptionFailed?(0,I.jsx)(No,{variant:`destructive`,children:`re-save creds`}):null]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:e.id})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(L,{variant:`outline`,size:`sm`,onClick:()=>o(t=>t===e.id?``:e.id),children:a===e.id?`Hide logs`:`Logs`}),(0,I.jsx)(L,{variant:`outline`,size:`sm`,onClick:()=>E.mutate(e.id),disabled:E.isPending,children:`Restart`}),(0,I.jsx)(L,{variant:`destructive`,size:`sm`,onClick:()=>{confirm(`Delete collector "${e.name}"?`)&&ne.mutate(e.id)},disabled:ne.isPending,children:`Delete`})]})]}),(0,I.jsxs)(`div`,{className:`text-sm`,children:[`Status:`,` `,(0,I.jsx)(`span`,{className:t?`text-emerald-600`:`text-muted-foreground`,children:t?`Running`:`Starting`})]}),(0,I.jsxs)(`div`,{className:`text-sm`,children:[`Forward:`,` `,typeof n==`boolean`?(0,I.jsx)(`span`,{className:n?`text-emerald-600`:`text-muted-foreground`,children:n?`Connected`:`Not connected`}):(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:`Unknown`})]}),e.forwardCollector?.version?(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Version:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:String(e.forwardCollector.version)})]}):null,e.forwardCollector?.updateStatus?(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Update:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:String(e.forwardCollector.updateStatus)})]}):null,e.forwardCollector?.externalIp?(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`External IP:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:String(e.forwardCollector.externalIp)})]}):null,Array.isArray(e.forwardCollector?.internalIps)&&(e.forwardCollector?.internalIps??[]).length>0?(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Internal IPs:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:(e.forwardCollector?.internalIps??[]).filter(Boolean).join(`, `)})]}):null,e.runtime?.podName?(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Pod:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:String(e.runtime.podName)}),` `,`(`,String(e.runtime.podPhase??``),`)`]}):null,a===e.id?(0,I.jsx)(`pre`,{className:`bg-muted p-3 rounded-md overflow-auto font-mono text-xs whitespace-pre-wrap`,children:s.isLoading?`Loading`:(s.data?.logs??``).trim()||`No logs yet.`}):null]},e.id)})]})]})]})}const Zs=t(`/dashboard/claude`)({component:Qs});function Qs(){return(0,I.jsxs)(`div`,{className:`mx-auto w-full max-w-3xl space-y-4 p-4`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold`,children:`Claude`}),(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Connector placeholder. This will support bringing your own Anthropic API key for template generation workflows.`})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Status`})}),(0,I.jsx)(U,{className:`text-sm text-muted-foreground`,children:`Not configured yet.`})]})]})}const $s=t(`/dashboard/chatgpt`)({component:ec});function ec(){return(0,I.jsxs)(`div`,{className:`mx-auto w-full max-w-3xl space-y-4 p-4`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold`,children:`ChatGPT`}),(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Connector placeholder. This will support bringing your own OpenAI API key for template generation workflows.`})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Status`})}),(0,I.jsx)(U,{className:`text-sm text-muted-foreground`,children:`Not configured yet.`})]})]})}const tc=t(`/admin/settings`)({component:nc});function nc(){let e=r({queryKey:W.session(),queryFn:Ar,staleTime:3e4,retry:!1}),t=!!e.data?.isAdmin,[n,i]=(0,P.useState)(`200`),a=r({queryKey:W.adminAudit(n),queryFn:()=>Ca({limit:n}),enabled:t,staleTime:15e3,retry:!1}),o=r({queryKey:W.adminConfig(),queryFn:Sa,enabled:t,staleTime:15e3,retry:!1}),s=r({queryKey:W.adminImpersonateStatus(),queryFn:wa,enabled:t,staleTime:5e3,retry:!1}),c=m({mutationFn:async e=>Da({limit:e}),onSuccess:e=>{N.success(`Reconciled queued tasks`,{description:`Considered ${e.consideredTasks}, republished ${e.republished}, errors ${e.publishErrors}`})},onError:e=>{N.error(`Failed to reconcile queued tasks`,{description:e.message})}}),l=m({mutationFn:async e=>Oa({limit:e.limit,hardMaxRuntimeMinutes:e.hardMaxRuntimeMinutes,maxIdleMinutes:e.maxIdleMinutes}),onSuccess:e=>{N.success(`Reconciled running tasks`,{description:`Considered ${e.consideredTasks}, marked failed ${e.markedFailed}, errors ${e.finishErrors}`})},onError:e=>{N.error(`Failed to reconcile running tasks`,{description:e.message})}}),[u,d]=(0,P.useState)(``),f=m({mutationFn:async()=>Ta({username:u}),onSuccess:()=>{N.success(`Impersonation started`),s.refetch(),window.location.reload()},onError:e=>{N.error(`Failed to impersonate`,{description:e.message})}}),p=m({mutationFn:async()=>Ea(),onSuccess:()=>{N.success(`Impersonation stopped`),s.refetch(),window.location.reload()},onError:e=>{N.error(`Failed to stop impersonation`,{description:e.message})}}),[h,g]=(0,P.useState)(``),_=m({mutationFn:async()=>ka({username:h,confirm:h}),onSuccess:e=>{N.success(`User purged`,{description:`Deleted workspaces: ${e.deletedWorkspaces}`})},onError:e=>{N.error(`Failed to purge user`,{description:e.message})}}),v=(0,P.useMemo)(()=>[{id:`createdAt`,header:`Time`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:e.createdAt}),width:220},{id:`actor`,header:`Actor`,cell:e=>(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`font-medium`,children:e.actorUsername}),e.actorIsAdmin?(0,I.jsx)(No,{variant:`secondary`,children:`admin`}):null,e.impersonatedUsername?(0,I.jsxs)(No,{variant:`outline`,children:[`as `,e.impersonatedUsername]}):null]}),width:260},{id:`action`,header:`Action`,cell:e=>e.action,width:260},{id:`workspaceId`,header:`Workspace`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:e.workspaceId}),width:220},{id:`details`,header:`Details`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.details})}],[]);return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`System settings`}),(0,I.jsx)(H,{children:`Admin-only settings for Skyforge.`})]})}),!t&&(0,I.jsx)(z,{variant:`danger`,children:(0,I.jsx)(U,{className:`pt-6`,children:(0,I.jsx)(`div`,{className:`text-center font-medium`,children:`Admin access required.`})})}),t&&(0,I.jsxs)(fs,{defaultValue:`overview`,children:[(0,I.jsxs)(ps,{children:[(0,I.jsx)(ms,{value:`overview`,children:`Overview`}),(0,I.jsx)(ms,{value:`audit`,children:`Audit`}),(0,I.jsx)(ms,{value:`tasks`,children:`Tasks`}),(0,I.jsx)(ms,{value:`users`,children:`Users`})]}),(0,I.jsxs)(hs,{value:`overview`,className:`space-y-6`,children:[(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Effective config`}),(0,I.jsx)(H,{children:`Read-only view of the running server's non-secret Encore config.`})]}),(0,I.jsx)(U,{children:o.isLoading?(0,I.jsx)(K,{className:`h-40 w-full`}):o.data?(0,I.jsxs)(`div`,{className:`space-y-3`,children:[o.data.missing?.length?(0,I.jsxs)(`div`,{className:`rounded-md border border-destructive/40 bg-destructive/10 p-3 text-sm`,children:[(0,I.jsx)(`div`,{className:`font-medium`,children:`Missing config`}),(0,I.jsx)(`ul`,{className:`list-disc pl-5 text-muted-foreground`,children:o.data.missing.map(e=>(0,I.jsx)(`li`,{children:e},e))})]}):null,(0,I.jsx)(`pre`,{className:`max-h-[420px] overflow-auto rounded-md border bg-muted/50 p-3 text-xs`,children:JSON.stringify(o.data,null,2)})]}):(0,I.jsx)(To,{title:`No config`,description:`Could not load effective config.`})})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Impersonation`}),(0,I.jsx)(H,{children:`Impersonate another user to reproduce issues or verify UX.`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(qe,{className:`h-5 w-5 text-muted-foreground`}),(0,I.jsxs)(`div`,{className:`text-sm`,children:[(0,I.jsx)(`span`,{className:`font-medium`,children:s.data?.actorUsername||e.data?.username||``}),s.data?.impersonating?(0,I.jsxs)(I.Fragment,{children:[` `,``,` `,(0,I.jsx)(`span`,{className:`font-medium`,children:s.data.effectiveUsername}),(0,I.jsx)(No,{className:`ml-2`,variant:`secondary`,children:`impersonating`})]}):(0,I.jsx)(No,{className:`ml-2`,variant:`outline`,children:`not impersonating`})]})]}),(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center`,children:[(0,I.jsx)(J,{placeholder:`user@example.com`,value:u,onChange:e=>d(e.target.value)}),(0,I.jsxs)(L,{onClick:()=>f.mutate(),disabled:f.isPending||!u.trim()||s.data?.impersonating,children:[(0,I.jsx)(oe,{className:`mr-2 h-4 w-4`}),`Impersonate`]}),(0,I.jsx)(L,{variant:`outline`,onClick:()=>p.mutate(),disabled:p.isPending||!s.data?.impersonating,children:`Stop`})]})]})]})]}),(0,I.jsx)(hs,{value:`audit`,className:`space-y-6`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Audit log`}),(0,I.jsx)(H,{children:`Recent admin and user actions.`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`Limit`}),(0,I.jsx)(J,{className:`w-28`,value:n,onChange:e=>i(e.target.value)})]}),(0,I.jsx)(No,{variant:`outline`,children:a.data?.timestamp??``})]}),(0,I.jsx)(wo,{rows:a.data?.events??[],columns:v,getRowId:e=>String(e.id),isLoading:a.isLoading,emptyText:`No audit events.`,minWidthClassName:`min-w-[1100px]`})]})]})}),(0,I.jsx)(hs,{value:`tasks`,className:`space-y-6`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Task reconciliation`}),(0,I.jsx)(H,{children:`Manual guardrails for stuck queued/running jobs.`})]}),(0,I.jsxs)(U,{className:`space-y-6`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`font-medium`,children:`Queued tasks`}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Republish missing queue events.`})]}),(0,I.jsx)(L,{variant:`outline`,disabled:c.isPending,onClick:()=>c.mutate(200),children:c.isPending?`Running`:`Reconcile queued`})]}),(0,I.jsxs)(`div`,{className:`flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`font-medium`,children:`Running tasks`}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Mark long-running/no-log tasks failed.`})]}),(0,I.jsx)(L,{variant:`outline`,disabled:l.isPending,onClick:()=>l.mutate({limit:50,hardMaxRuntimeMinutes:720,maxIdleMinutes:120}),children:l.isPending?`Running`:`Reconcile running`})]})]})]})}),(0,I.jsx)(hs,{value:`users`,className:`space-y-6`,children:(0,I.jsxs)(z,{variant:`danger`,children:[(0,I.jsxs)(B,{children:[(0,I.jsxs)(V,{className:`flex items-center gap-2`,children:[(0,I.jsx)(Oe,{className:`h-5 w-5`}),`Purge user (dev-only)`]}),(0,I.jsx)(H,{children:`Removes user state and associated workspaces to rerun first-login bootstrap.`})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsx)(J,{placeholder:`user@example.com`,value:h,onChange:e=>g(e.target.value)}),(0,I.jsx)(L,{variant:`destructive`,disabled:!h.trim()||_.isPending,onClick:()=>_.mutate(),children:_.isPending?`Purging`:`Purge user`})]})]})})]})]})}var rc=Ln({q:zn().optional().catch(``),tab:Un([`policy`,`resources`,`costs`,`usage`]).optional().catch(`policy`)});const ic=t(`/admin/governance`)({validateSearch:e=>rc.parse(e),loaderDeps:({search:{q:e,tab:t}})=>({q:e,tab:t}),loader:async({context:{queryClient:e}})=>{(await e.ensureQueryData({queryKey:W.session(),queryFn:Ar,staleTime:3e4,retry:!1}))?.isAdmin&&await Promise.all([e.ensureQueryData({queryKey:W.governancePolicy(),queryFn:Aa}),e.ensureQueryData({queryKey:W.governanceSummary(),queryFn:_a}),e.ensureQueryData({queryKey:W.governanceResources(`500`),queryFn:()=>va({limit:`500`})}),e.ensureQueryData({queryKey:W.governanceCosts(`50`),queryFn:()=>ya({limit:`50`})}),e.ensureQueryData({queryKey:W.governanceUsage(`500`),queryFn:()=>ba({limit:`500`})})])},component:ac});function ac(){let e=u(),t=ic.useNavigate(),{q:n,tab:i}=ic.useSearch(),a=!!r({queryKey:W.session(),queryFn:Ar,staleTime:3e4,retry:!1}).data?.isAdmin,o=r({queryKey:W.governanceSummary(),queryFn:_a,staleTime:3e4,enabled:a}),s=r({queryKey:W.governancePolicy(),queryFn:Aa,staleTime:3e4,enabled:a,retry:!1}),c=r({queryKey:W.governanceResources(`500`),queryFn:()=>va({limit:`500`}),staleTime:3e4,enabled:a}),l=r({queryKey:W.governanceCosts(`50`),queryFn:()=>ya({limit:`50`}),staleTime:3e4,enabled:a}),d=r({queryKey:W.governanceUsage(`500`),queryFn:()=>ba({limit:`500`}),staleTime:3e4,enabled:a}),f=d.data?.usage??[],p=(0,P.useMemo)(()=>{let e=new Map;for(let t of f){if(t.scopeType!==`cluster`)continue;let n=String(t.metric??``);if(!n)continue;let r=e.get(n);if(!r){e.set(n,t);continue}new Date(String(t.collectedAt)).getTime()>new Date(String(r.collectedAt)).getTime()&&e.set(n,t)}return e},[f]),h=(0,P.useMemo)(()=>{let e=new Map;for(let t of f){if(t.scopeType!==`user`)continue;let n=String(t.scopeId??``).trim();if(!n)continue;let r=String(t.metric??``).trim();if(!r)continue;let i=Number(t.value??0),a=String(t.collectedAt??``),o=e.get(n)??{user:n,deploymentsActive:0,deploymentsTotal:0,collectorsTotal:0,tasksRunning:0,lastSeenAt:a};switch(r){case`deployments.active`:o.deploymentsActive=i;break;case`deployments.total`:o.deploymentsTotal=i;break;case`collectors.total`:o.collectorsTotal=i;break;case`tasks.running`:o.tasksRunning=i;break;default:break}new Date(a).getTime()>new Date(o.lastSeenAt).getTime()&&(o.lastSeenAt=a),e.set(n,o)}return Array.from(e.values()).sort((e,t)=>t.deploymentsActive===e.deploymentsActive?t.tasksRunning===e.tasksRunning?e.user.localeCompare(t.user):t.tasksRunning-e.tasksRunning:t.deploymentsActive-e.deploymentsActive)},[f]),g=(0,P.useMemo)(()=>{let e=c.data?.resources??[],t=n?.trim().toLowerCase()||``;return t?e.filter(e=>[e.name,e.resourceId,e.resourceType,e.workspaceName,e.owner,e.provider].filter(Boolean).join(` `).toLowerCase().includes(t)):e},[c.data?.resources,n]),_=m({mutationFn:async()=>{await xa()},onSuccess:async()=>{N.success(`Governance sources synced`,{description:`Resource inventory updated.`}),await Promise.all([e.invalidateQueries({queryKey:W.governanceSummary()}),e.invalidateQueries({queryKey:W.governanceResources(`500`)}),e.invalidateQueries({queryKey:W.governanceCosts(`50`)}),e.invalidateQueries({queryKey:W.governanceUsage(`500`)})])},onError:e=>{N.error(`Failed to sync governance sources`,{description:e.message})}}),[v,b]=(0,P.useState)({maxDeploymentsPerUser:0,maxCollectorsPerUser:0});(0,P.useEffect)(()=>{s.data?.policy&&b({maxDeploymentsPerUser:s.data.policy.maxDeploymentsPerUser??0,maxCollectorsPerUser:s.data.policy.maxCollectorsPerUser??0})},[s.data?.policy?.maxDeploymentsPerUser,s.data?.policy?.maxCollectorsPerUser]);let x=m({mutationFn:async()=>ja({policy:{maxDeploymentsPerUser:Math.max(0,v.maxDeploymentsPerUser),maxCollectorsPerUser:Math.max(0,v.maxCollectorsPerUser)}}),onSuccess:async()=>{N.success(`Governance policy saved`),await e.invalidateQueries({queryKey:W.governancePolicy()})},onError:e=>{N.error(`Failed to save governance policy`,{description:e.message})}}),S=o.data,ee=e=>{t({search:t=>({...t,q:e}),replace:!0})};return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(V,{children:`Governance`}),(0,I.jsx)(H,{children:`Admin-only guardrails, inventory, cost, and usage telemetry.`})]}),(0,I.jsxs)(L,{variant:`outline`,size:`sm`,disabled:_.isPending||!a,onClick:()=>_.mutate(),children:[(0,I.jsx)(ot,{className:`mr-2 h-4 w-4 ${_.isPending?`animate-spin`:``}`}),_.isPending?`Syncing`:`Sync sources`]})]})})}),!a&&(0,I.jsx)(z,{variant:`danger`,children:(0,I.jsx)(U,{className:`pt-6`,children:(0,I.jsx)(`div`,{className:`text-center font-medium text-destructive`,children:`Admin access required.`})})}),(s.isError||o.isError||c.isError||l.isError||d.isError)&&(0,I.jsx)(z,{variant:`danger`,children:(0,I.jsx)(U,{className:`pt-6`,children:(0,I.jsx)(`div`,{className:`text-center font-medium`,children:`Failed to load governance data.`})})}),o.isLoading?(0,I.jsx)(Fo,{children:[1,2,3,4].map(e=>(0,I.jsxs)(Io,{className:`h-32`,children:[(0,I.jsx)(K,{className:`h-4 w-24 mb-4`}),(0,I.jsx)(K,{className:`h-8 w-16`})]},e))}):(0,I.jsxs)(Fo,{children:[(0,I.jsx)(Lo,{title:`Resources tracked`,value:String(S?.resourceCount??``),icon:(0,I.jsx)(Bt,{className:`h-5 w-5`}),gradient:`blue`}),(0,I.jsx)(Lo,{title:`Active resources`,value:String(S?.activeResources??``),icon:(0,I.jsx)(ge,{className:`h-5 w-5`}),gradient:`green`}),(0,I.jsx)(Lo,{title:`Workspaces tracked`,value:String(S?.workspacesTracked??``),icon:(0,I.jsx)(bt,{className:`h-5 w-5`}),gradient:`purple`}),(0,I.jsx)(Lo,{title:`Last 30d spend`,value:S?`${S.costLast30Days} ${S.costCurrency}`:``,icon:(0,I.jsx)(Ae,{className:`h-5 w-5`}),gradient:`orange`})]}),(0,I.jsxs)(fs,{value:i,onValueChange:e=>{t({search:t=>({...t,tab:e}),replace:!0})},className:`space-y-6`,children:[(0,I.jsxs)(ps,{children:[(0,I.jsxs)(ms,{value:`policy`,className:`gap-2`,children:[(0,I.jsx)(Kt,{className:`h-4 w-4`}),`Policy`]}),(0,I.jsxs)(ms,{value:`resources`,className:`gap-2`,children:[(0,I.jsx)(Bt,{className:`h-4 w-4`}),`Resources`]}),(0,I.jsxs)(ms,{value:`costs`,className:`gap-2`,children:[(0,I.jsx)(y,{className:`h-4 w-4`}),`Financials`]}),(0,I.jsxs)(ms,{value:`usage`,className:`gap-2`,children:[(0,I.jsx)(de,{className:`h-4 w-4`}),`Telemetry`]})]}),(0,I.jsx)(hs,{value:`policy`,className:`space-y-6 animate-in fade-in-50`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Policy`}),(0,I.jsx)(H,{children:`Optional guardrails. Use 0 for unlimited.`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Max deployments per user`}),(0,I.jsx)(J,{inputMode:`numeric`,value:String(v.maxDeploymentsPerUser),onChange:e=>b(t=>({...t,maxDeploymentsPerUser:Number.parseInt(e.target.value||`0`,10)||0}))}),(0,I.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Applies when creating new deployment definitions.`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Max collectors per user`}),(0,I.jsx)(J,{inputMode:`numeric`,value:String(v.maxCollectorsPerUser),onChange:e=>b(t=>({...t,maxCollectorsPerUser:Number.parseInt(e.target.value||`0`,10)||0}))}),(0,I.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Applies when creating in-cluster Forward collectors.`})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:s.data?.retrievedAt?`Loaded ${s.data.retrievedAt}`:``}),(0,I.jsx)(L,{onClick:()=>x.mutate(),disabled:x.isPending||!a,children:x.isPending?`Saving`:`Save policy`})]})]})]})}),(0,I.jsx)(hs,{value:`resources`,className:`space-y-6 animate-in fade-in-50`,children:(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsx)(V,{children:`Resource Inventory`}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(`div`,{className:`relative`,children:[(0,I.jsx)(an,{className:`absolute left-2 top-2.5 h-4 w-4 text-muted-foreground`}),(0,I.jsx)(J,{className:`pl-8 w-full sm:w-[300px]`,placeholder:`Search resources`,value:n||``,onChange:e=>ee(e.target.value)})]}),!c.isLoading&&(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground whitespace-nowrap hidden sm:block`,children:[g.length,` shown`]})]})]})}),(0,I.jsx)(U,{children:c.isLoading?(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsx)(K,{className:`h-10 w-full`}),(0,I.jsx)(K,{className:`h-10 w-full`}),(0,I.jsx)(K,{className:`h-10 w-full`})]}):g.length===0?(0,I.jsx)(To,{icon:Kt,title:`No resources found`,description:`No resources match your search criteria.`}):(0,I.jsx)(wo,{columns:[{id:`name`,header:`Name`,width:`minmax(220px, 1fr)`,cell:e=>(0,I.jsx)(`span`,{className:`font-medium`,children:e.name})},{id:`provider`,header:`Provider`,width:140,cell:e=>e.provider},{id:`type`,header:`Type`,width:160,cell:e=>e.resourceType},{id:`workspace`,header:`Workspace`,width:200,cell:e=>e.workspaceName},{id:`owner`,header:`Owner`,width:160,cell:e=>e.owner},{id:`status`,header:`Status`,width:120,cell:e=>(0,I.jsx)(No,{variant:e.status===`active`?`default`:`secondary`,children:e.status??`unknown`})}],rows:g.slice(0,500),getRowId:e=>String(e.resourceId),maxHeightClassName:`max-h-[60vh]`,minWidthClassName:`min-w-[1100px]`})})]})}),(0,I.jsx)(hs,{value:`costs`,className:`space-y-6 animate-in fade-in-50`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Cost Snapshots`}),(0,I.jsx)(H,{children:`Historical spend data per provider.`})]}),(0,I.jsx)(U,{children:l.isLoading?(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(K,{className:`h-12 w-full`}),(0,I.jsx)(K,{className:`h-12 w-full`})]}):(l.data?.costs??[]).length===0?(0,I.jsx)(To,{icon:y,title:`No cost data`,description:`No financial snapshots available.`}):(0,I.jsx)(wo,{columns:[{id:`provider`,header:`Provider`,width:180,cell:e=>(0,I.jsx)(`span`,{className:`font-medium`,children:e.provider})},{id:`currency`,header:`Currency`,width:120,cell:e=>e.currency},{id:`amount`,header:`Amount`,width:140,cell:e=>e.amount},{id:`periodEnd`,header:`Period End`,width:200,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:e.periodEnd})}],rows:(l.data?.costs??[]).slice(0,50),getRowId:e=>`${e.provider}:${e.periodEnd}:${e.amount}`,maxHeightClassName:`max-h-[50vh]`,minWidthClassName:`min-w-[900px]`})})]})}),(0,I.jsx)(hs,{value:`usage`,className:`space-y-6 animate-in fade-in-50`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Usage Telemetry`}),(0,I.jsx)(H,{children:`Lightweight snapshots of cluster load and user activity (no Prometheus).`})]}),(0,I.jsx)(U,{children:d.isLoading?(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(K,{className:`h-12 w-full`}),(0,I.jsx)(K,{className:`h-12 w-full`})]}):(d.data?.usage??[]).length===0?(0,I.jsx)(To,{icon:de,title:`No usage data`,description:`No telemetry snapshots available.`}):(0,I.jsxs)(`div`,{className:`space-y-6`,children:[(0,I.jsxs)(Fo,{children:[(0,I.jsx)(Lo,{title:`CPU p95`,value:p.get(`node.cpu_active.p95`)?.value??``,subtitle:`Last snapshot`,icon:(0,I.jsx)(ge,{className:`h-4 w-4`})}),(0,I.jsx)(Lo,{title:`Mem p95`,value:p.get(`node.mem_used.p95`)?.value??``,subtitle:`Last snapshot`,icon:(0,I.jsx)(bt,{className:`h-4 w-4`})}),(0,I.jsx)(Lo,{title:`Disk p95`,value:p.get(`node.disk_used.p95`)?.value??``,subtitle:`Last snapshot`,icon:(0,I.jsx)(Bt,{className:`h-4 w-4`})}),(0,I.jsx)(Lo,{title:`Active users (24h)`,value:p.get(`users.active_24h`)?.value??``,subtitle:`Distinct users`,icon:(0,I.jsx)(Kt,{className:`h-4 w-4`})})]}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{className:`text-base`,children:`Top Users`}),(0,I.jsx)(H,{children:`Latest per-user activity snapshots (sorted by active deployments).`})]}),(0,I.jsx)(U,{children:h.length===0?(0,I.jsx)(To,{icon:de,title:`No user activity`,description:`No per-user snapshots available yet.`}):(0,I.jsx)(wo,{columns:[{id:`user`,header:`User`,width:240,cell:e=>(0,I.jsx)(`span`,{className:`font-medium`,children:e.user})},{id:`deploymentsActive`,header:`Active Deployments`,width:180,cell:e=>e.deploymentsActive},{id:`tasksRunning`,header:`Running Tasks`,width:160,cell:e=>e.tasksRunning},{id:`collectorsTotal`,header:`Collectors`,width:140,cell:e=>e.collectorsTotal},{id:`deploymentsTotal`,header:`Total Deployments`,width:170,cell:e=>e.deploymentsTotal},{id:`lastSeenAt`,header:`Last Updated`,align:`right`,width:220,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:e.lastSeenAt})}],rows:h.slice(0,50),getRowId:e=>e.user,maxHeightClassName:`max-h-[45vh]`,minWidthClassName:`min-w-[1000px]`})})]}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{className:`text-base`,children:`Raw Snapshots`}),(0,I.jsx)(H,{children:`Most recent usage snapshot records (for debugging).`})]}),(0,I.jsx)(U,{children:(0,I.jsx)(wo,{columns:[{id:`scope`,header:`Scope`,width:180,cell:e=>e.scopeType===`user`?`user:${e.scopeId??``}`:e.scopeType},{id:`metric`,header:`Metric`,cell:e=>e.metric},{id:`value`,header:`Value`,width:160,cell:e=>typeof e.value==`number`?e.value:String(e.value)},{id:`collectedAt`,header:`Collected At`,width:220,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:e.collectedAt})}],rows:(d.data?.usage??[]).slice(0,200),getRowId:e=>`${e.provider}:${e.scopeType}:${e.scopeId??``}:${e.metric}:${e.collectedAt}`,maxHeightClassName:`max-h-[50vh]`,minWidthClassName:`min-w-[900px]`})})]})]})})]})})]})]})}const oc=t(`/dashboard/workspaces/`)({component:sc});function sc(){let e=r({queryKey:W.workspaces(),queryFn:Mr,staleTime:3e4}),t=e.data?.workspaces??[],[n,i]=(0,P.useState)(``),a=(0,P.useMemo)(()=>{let e=n.trim().toLowerCase();return e?t.filter(t=>t.name.toLowerCase().includes(e)||t.slug.toLowerCase().includes(e)||(t.description??``).toLowerCase().includes(e)):t},[n,t]);return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Workspaces`}),(0,I.jsxs)(`p`,{className:`text-sm text-muted-foreground`,children:[`Workspaces primarily organize shared resources and team access. Per-user defaults live in`,` `,(0,I.jsx)(f,{className:`underline`,to:`/dashboard/settings`,children:`My Settings`}),`.`]})]}),(0,I.jsx)(L,{asChild:!0,children:(0,I.jsxs)(f,{to:`/dashboard/workspaces/new`,children:[(0,I.jsx)(_,{className:`mr-2 h-4 w-4`}),`New workspace`]})})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(J,{placeholder:`Filter workspaces`,value:n,onChange:e=>i(e.target.value)}),(0,I.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[a.length,` shown`]})]}),e.isLoading?(0,I.jsx)(z,{className:`border-dashed`,children:(0,I.jsx)(U,{className:`pt-6 text-sm text-muted-foreground`,children:`Loading workspaces`})}):a.length===0?(0,I.jsx)(z,{className:`border-dashed`,children:(0,I.jsx)(U,{className:`pt-6 text-sm text-muted-foreground`,children:`No workspaces match your filter.`})}):(0,I.jsx)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:a.map(e=>(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{className:`truncate`,children:e.name}),(0,I.jsxs)(H,{className:`truncate`,children:[e.slug,e.isPublic?`  public`:``]})]}),(0,I.jsxs)(U,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`min-w-0 text-sm text-muted-foreground truncate`,children:e.description||``}),(0,I.jsx)(L,{asChild:!0,variant:`outline`,children:(0,I.jsx)(f,{to:`/dashboard/workspaces/$workspaceId`,params:{workspaceId:e.id},children:`Open`})})]})]},e.id))})]})}function cc(e){let t=u(),n=(0,P.useMemo)(()=>`${Dr}/dashboard/events`,[]);(0,P.useEffect)(()=>{if(!e)return;let r=vo(n,{snapshot:e=>{try{let n=JSON.parse(e.data);t.setQueryData(W.dashboardSnapshot(),n)}catch{}}});return()=>{r.close()}},[e,t,n])}const lc=t(`/dashboard/runs/`)({component:uc});function uc(){cc(!0);let e=u(),t=r({queryKey:W.dashboardSnapshot(),queryFn:Nr,initialData:()=>e.getQueryData(W.dashboardSnapshot())??null,retry:!1,staleTime:1/0}),n=t.data?.runs??[],[i,a]=(0,P.useState)(``),o=(0,P.useMemo)(()=>{let e=i.trim().toLowerCase();return e?n.filter(t=>JSON.stringify(t).toLowerCase().includes(e)):n},[i,n]);return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Runs`}),(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Recent task runs across all deployments.`})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(J,{placeholder:`Filter runs`,value:i,onChange:e=>a(e.target.value)}),(0,I.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[o.length,` shown`]})]}),t.data?o.length===0?(0,I.jsx)(z,{className:`border-dashed`,children:(0,I.jsx)(U,{className:`pt-6 text-sm text-muted-foreground`,children:`No runs match your filter.`})}):(0,I.jsx)(`div`,{className:`space-y-3`,children:o.map(e=>{let t=String(e.id??``),n=String(e.status??``),r=String(e.workspaceId??``),i=String(e.tpl_alias??e.type??``),a=String(e.created??``),o=String(e.start??``),s=String(e.end??``);return(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(V,{className:`truncate`,children:(0,I.jsxs)(f,{className:`underline`,to:`/dashboard/runs/$runId`,params:{runId:t},children:[`Run `,t]})}),(0,I.jsxs)(H,{className:`truncate`,children:[i||`run`,`  ws `,r||``]})]}),(0,I.jsx)(No,{variant:dc(n),children:n||`unknown`})]})}),(0,I.jsxs)(U,{className:`grid gap-2 text-sm text-muted-foreground md:grid-cols-3`,children:[(0,I.jsxs)(`div`,{className:`truncate`,children:[`Created: `,a||``]}),(0,I.jsxs)(`div`,{className:`truncate`,children:[`Started: `,o||``]}),(0,I.jsxs)(`div`,{className:`truncate`,children:[`Finished: `,s||``]})]})]},t)})}):(0,I.jsx)(z,{className:`border-dashed`,children:(0,I.jsx)(U,{className:`pt-6 text-sm text-muted-foreground`,children:`Loading dashboard`})})]})}function dc(e){let t=e.toLowerCase();return t===`success`||t===`succeeded`||t===`complete`?`default`:t===`failed`||t===`error`?`destructive`:t===`running`?`default`:`secondary`}var fc=[{slug:`getting-started`,title:`Getting started`,description:`First-time flow: configure settings, select templates, deploy.`,tags:[`start`,`deployments`,`settings`]},{slug:`my-settings`,title:`My Settings`,description:`Per-user defaults, external repos, BYOL servers, credentials.`,tags:[`settings`,`repos`,`byol`,`cloud`]},{slug:`deployments`,title:`Deployments`,description:`Create deployments, validate templates, and understand statuses.`,tags:[`deployments`,`templates`,`validate`]},{slug:`servicenow`,title:`ServiceNow demo workflow`,description:`Install and configure the Forward Connectivity Ticket demo into a ServiceNow PDI.`,tags:[`servicenow`,`forward`,`workflow`]}];const pc=t(`/dashboard/docs/`)({component:mc});function mc(){let[e,t]=(0,P.useState)(``),n=(0,P.useMemo)(()=>{let t=e.trim().toLowerCase();return t?fc.filter(e=>`${e.title} ${e.description} ${e.tags.join(` `)}`.toLowerCase().includes(t)):fc},[e]);return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsx)(B,{children:(0,I.jsxs)(V,{className:`flex items-center gap-2`,children:[(0,I.jsx)(Qe,{className:`h-5 w-5`}),`Docs & Workflows`]})}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Practical guides for first-time users and repeatable workflows.`}),(0,I.jsx)(J,{placeholder:`Search docs`,value:e,onChange:e=>t(e.target.value)})]})]}),(0,I.jsx)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:n.map(e=>(0,I.jsx)(f,{to:`/dashboard/docs/$slug`,params:{slug:e.slug},className:`group`,children:(0,I.jsxs)(z,{className:`h-full transition-colors hover:bg-accent/40`,children:[(0,I.jsx)(B,{children:(0,I.jsxs)(V,{className:`flex items-center justify-between gap-2 text-base`,children:[(0,I.jsx)(`span`,{className:`truncate`,children:e.title}),(0,I.jsx)(M,{className:`h-4 w-4 text-muted-foreground group-hover:text-foreground`})]})}),(0,I.jsxs)(U,{className:`space-y-2`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:e.description}),(0,I.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:e.tags.slice(0,4).map(e=>(0,I.jsx)(`span`,{className:`rounded border px-2 py-0.5 text-[10px] text-muted-foreground`,children:e},e))})]})]})},e.slug))})]})}function hc(e,t){if(!t)return`none`;let n=String(e?.username??``).trim();return e?.isAdmin?`admin`:n?String(t.createdBy??``).toLowerCase()===n.toLowerCase()||(t.owners??[]).some(e=>String(e).toLowerCase()===n.toLowerCase())?`owner`:(t.editors??[]).some(e=>String(e).toLowerCase()===n.toLowerCase())?`editor`:(t.viewers??[]).some(e=>String(e).toLowerCase()===n.toLowerCase())||t.isPublic?`viewer`:`none`:`none`}function gc(e){return e===`admin`||e===`owner`||e===`editor`}function _c(e){return e===`admin`||e===`owner`}var vc=Ln({workspace:zn().optional().catch(``)});const yc=t(`/dashboard/deployments/`)({validateSearch:e=>vc.parse(e),loaderDeps:({search:{workspace:e}})=>({workspace:e}),loader:async({context:{queryClient:e}})=>{await e.ensureQueryData({queryKey:W.workspaces(),queryFn:Mr,staleTime:3e4})},component:bc});function bc(){cc(!0);let e=n(),t=u(),{workspace:i}=yc.useSearch(),a=r({queryKey:W.dashboardSnapshot(),queryFn:Nr,initialData:()=>t.getQueryData(W.dashboardSnapshot())??null,retry:!1,staleTime:1/0}),[o,s]=(0,P.useState)(null),[c,l]=(0,P.useState)(!1),[d,p]=(0,P.useState)(!1),m=r({queryKey:W.session(),queryFn:Ar,staleTime:3e4,retry:!1}),[h,g]=(0,P.useState)(``),[v,y]=(0,P.useState)(`all`),[b,x]=(0,P.useState)(`all`),[S,ee]=(0,P.useState)(!0),C=r({queryKey:W.workspaces(),queryFn:Mr,staleTime:3e4}).data?.workspaces??[],te=`skyforge.lastWorkspaceId.deployments`,w=(0,P.useMemo)(()=>{if(i&&C.some(e=>e.id===i))return i;let e=typeof window<`u`?window.localStorage.getItem(te)??``:``;return e&&C.some(t=>t.id===e)?e:C[0]?.id??``},[i,C]);(0,P.useEffect)(()=>{w&&(typeof window<`u`&&window.localStorage.setItem(te,w),i!==w&&e({search:{workspace:w},replace:!0}))},[w]);let T=(0,P.useMemo)(()=>C.find(e=>e.id===w)??null,[C,w]),E=(0,P.useMemo)(()=>gc(hc(m.data,T)),[m.data,T]),ne=t=>{typeof window<`u`&&window.localStorage.setItem(te,t),e({search:{workspace:t},replace:!0})},D=(0,P.useMemo)(()=>{let e=a.data?.deployments??[];return w?e.filter(e=>e.workspaceId===w):e},[w,a.data?.deployments]),O=(0,P.useMemo)(()=>D.filter(e=>{if(h&&!e.name.toLowerCase().includes(h.toLowerCase()))return!1;if(v!==`all`){let t=(e.activeTaskStatus??e.lastStatus??`unknown`).toLowerCase();if(v===`running`&&![`running`,`active`,`healthy`].includes(t)||v===`stopped`&&![`created`,`stopped`,`success`,`succeeded`,`ready`].includes(t)||v===`failed`&&![`failed`,`error`,`crashloopbackoff`].includes(t))return!1}return!(b!==`all`&&(b===`netlab`&&!e.type.startsWith(`netlab`)||b===`containerlab`&&![`containerlab`,`clabernetes`].includes(e.type)||b===`terraform`&&e.type!==`terraform`))}),[D,h,v,b]),ie=async e=>{try{await Ma(e.workspaceId,e.id),N.success(`Deployment starting`,{description:`${e.name} is queued to start.`})}catch(e){N.error(`Failed to start`,{description:e.message})}},oe=async e=>{try{await Na(e.workspaceId,e.id),N.success(`Deployment stopping`,{description:`${e.name} is queued to stop.`})}catch(e){N.error(`Failed to stop`,{description:e.message})}},se=(0,P.useMemo)(()=>[{id:`name`,header:`Name`,width:`minmax(240px, 1fr)`,cell:e=>(0,I.jsx)(f,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e.id},className:`hover:underline flex items-center gap-2 font-medium text-foreground`,children:e.name})},{id:`type`,header:`Type`,width:160,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:fe(e.type)})},{id:`status`,header:`Status`,width:150,cell:e=>(0,I.jsx)(xc,{status:e.activeTaskStatus??e.lastStatus??`unknown`})},{id:`actions`,header:`Actions`,width:120,align:`right`,cell:t=>{let n=(t.activeTaskStatus??t.lastStatus??`unknown`).toLowerCase(),r=[`running`,`active`,`healthy`].includes(n),i=!!t.activeTaskId;return(0,I.jsxs)(hr,{children:[(0,I.jsx)(gr,{asChild:!0,children:(0,I.jsxs)(L,{variant:`ghost`,size:`icon`,className:`h-8 w-8`,children:[(0,I.jsx)(re,{className:`h-4 w-4`}),(0,I.jsx)(`span`,{className:`sr-only`,children:`Open menu`})]})}),(0,I.jsxs)(yr,{align:`end`,children:[(0,I.jsx)(Cr,{children:`Actions`}),(0,I.jsxs)(br,{onClick:()=>e({to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:t.id}}),children:[(0,I.jsx)(en,{className:`mr-2 h-4 w-4`}),`Details`]}),(0,I.jsx)(wr,{}),(0,I.jsxs)(br,{onClick:()=>ie(t),disabled:i||r,children:[(0,I.jsx)(St,{className:`mr-2 h-4 w-4`}),`Start`]}),(0,I.jsxs)(br,{onClick:()=>oe(t),disabled:i||!r,children:[(0,I.jsx)(ae,{className:`mr-2 h-4 w-4`}),`Stop`]}),(0,I.jsx)(wr,{}),(0,I.jsxs)(br,{onClick:()=>{s(t),l(!0)},className:`text-destructive focus:text-destructive`,disabled:i,children:[(0,I.jsx)(Mn,{className:`mr-2 h-4 w-4`}),`Delete`]})]})]})}}],[ie,oe,e]),ce=(0,P.useMemo)(()=>{let e=a.data?.runs??[];return w?e.filter(e=>String(e.workspaceId??``)===w):e},[w,a.data?.runs]),ue=Or(window.location.pathname+window.location.search),de=async()=>{if(o)try{await Pa(o.workspaceId,o.id,{forwardDelete:d}),N.success(`Deployment deleted`,{description:`${o.name} has been removed.`}),await t.invalidateQueries({queryKey:W.dashboardSnapshot()}),l(!1),s(null),p(!1)}catch(e){N.error(`Failed to delete`,{description:e.message})}},fe=e=>{switch(e){case`netlab`:return`Netlab (BYOS)`;case`netlab-c9s`:return`Netlab`;case`containerlab`:return`Containerlab (BYOS)`;case`clabernetes`:return`Containerlab`;default:return e}},pe=!!o?.config?.forwardNetworkId;return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between border-b pb-6`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Deployments`}),(0,I.jsx)(`p`,{className:`text-muted-foreground text-sm`,children:`Manage deployments and monitor workspace activity.`})]}),(0,I.jsx)(`div`,{className:`flex items-center gap-3`,children:(0,I.jsxs)(`div`,{className:`flex items-center gap-2 bg-muted/50 p-1 rounded-lg border`,children:[(0,I.jsxs)(Y,{value:w,onValueChange:ne,disabled:C.length===0,children:[(0,I.jsx)(Z,{className:`w-[200px] h-8 bg-transparent border-0 focus:ring-0 shadow-none`,children:(0,I.jsx)(X,{placeholder:`Select workspace`})}),(0,I.jsx)(Q,{children:C.map(e=>(0,I.jsxs)($,{value:e.id,children:[e.name,` (`,e.slug,`)`]},e.id))})]}),(0,I.jsx)(`div`,{className:`h-4 w-px bg-border`}),(0,I.jsx)(f,{to:`/dashboard/workspaces/new`,title:`Create workspace`,className:mr({variant:`ghost`,size:`icon`,className:`h-8 w-8`}),children:(0,I.jsx)(_,{className:`h-4 w-4`})}),(0,I.jsx)(f,{to:`/dashboard/workspaces/$workspaceId`,params:{workspaceId:w},title:`Workspace Settings`,className:mr({variant:`ghost`,size:`icon`,className:`h-8 w-8`}),disabled:!w||!E,children:(0,I.jsx)(le,{className:`h-4 w-4`})})]})})]}),!a.data&&(0,I.jsx)(z,{className:`border-dashed`,children:(0,I.jsx)(U,{className:`pt-6`,children:(0,I.jsxs)(`div`,{className:`flex flex-col items-center justify-center space-y-4 py-8`,children:[(0,I.jsx)(K,{className:`h-4 w-64`}),(0,I.jsxs)(`div`,{className:`text-center text-muted-foreground`,children:[`Loading dashboard`,(0,I.jsxs)(`div`,{className:`mt-2 text-xs`,children:[`If you are logged out,`,` `,(0,I.jsx)(`a`,{className:`text-primary underline hover:no-underline`,href:ue,onClick:e=>{e.preventDefault(),(async()=>{if(!await fo({loginHref:ue})){window.location.href=ue;return}await t.invalidateQueries({queryKey:W.session()})})()},children:`login`}),`.`]})]})]})})}),(0,I.jsxs)(`div`,{className:`flex flex-col lg:flex-row gap-6 relative items-start`,children:[(0,I.jsxs)(`div`,{className:`flex-1 min-w-0 space-y-4 w-full`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col sm:flex-row gap-3`,children:[(0,I.jsxs)(`div`,{className:`relative flex-1`,children:[(0,I.jsx)(an,{className:`absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground`}),(0,I.jsx)(J,{placeholder:`Search deployments...`,className:`pl-9`,value:h,onChange:e=>g(e.target.value)})]}),(0,I.jsxs)(Y,{value:v,onValueChange:y,children:[(0,I.jsxs)(Z,{className:`w-[140px]`,children:[(0,I.jsx)(yn,{className:`mr-2 h-4 w-4 text-muted-foreground`}),(0,I.jsx)(X,{placeholder:`Status`})]}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All Status`}),(0,I.jsx)($,{value:`running`,children:`Running`}),(0,I.jsx)($,{value:`stopped`,children:`Stopped`}),(0,I.jsx)($,{value:`failed`,children:`Failed`})]})]}),(0,I.jsxs)(Y,{value:b,onValueChange:x,children:[(0,I.jsxs)(Z,{className:`w-[140px]`,children:[(0,I.jsx)(Ke,{className:`mr-2 h-4 w-4 text-muted-foreground`}),(0,I.jsx)(X,{placeholder:`Type`})]}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All Types`}),(0,I.jsx)($,{value:`netlab`,children:`Netlab`}),(0,I.jsx)($,{value:`containerlab`,children:`Containerlab`}),(0,I.jsx)($,{value:`terraform`,children:`Terraform`})]})]}),(0,I.jsxs)(f,{to:`/dashboard/deployments/new`,search:{workspace:w},className:mr({variant:`default`}),children:[(0,I.jsx)(_,{className:`mr-2 h-4 w-4`}),` Create`]})]}),(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`p-0`,children:a.data?O.length===0?(0,I.jsx)(To,{icon:Kt,title:`No deployments found`,description:h||v!==`all`?`Try adjusting your filters.`:`You haven't created any deployments in this workspace yet.`,action:!h&&v===`all`?{label:`Create deployment`,onClick:()=>e({to:`/dashboard/deployments/new`,search:{workspace:w}})}:void 0}):(0,I.jsx)(wo,{columns:se,rows:O,getRowId:e=>e.id,maxHeightClassName:`max-h-[60vh]`,minWidthClassName:`min-w-[900px]`}):(0,I.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,I.jsx)(K,{className:`h-10 w-full`}),(0,I.jsx)(K,{className:`h-10 w-full`}),(0,I.jsx)(K,{className:`h-10 w-full`})]})})})]}),(0,I.jsxs)(`div`,{className:F(`transition-all duration-300 ease-in-out border-l space-y-4 shrink-0`,S?`w-full lg:w-80 xl:w-96 pl-6 opacity-100`:`w-0 lg:w-12 pl-0 opacity-100 border-none lg:border-l`),children:[(0,I.jsx)(`div`,{className:F(`flex items-center gap-2 h-[40px]`,!S&&`justify-center`),children:S?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(ge,{className:`h-4 w-4 text-muted-foreground`}),(0,I.jsx)(`h3`,{className:`flex-1 text-sm font-semibold text-muted-foreground uppercase tracking-wider`,children:`Activity Feed`}),(0,I.jsx)(L,{variant:`ghost`,size:`icon`,className:`h-6 w-6 text-muted-foreground hover:text-foreground`,onClick:()=>ee(!1),title:`Collapse feed`,children:(0,I.jsx)(M,{className:`h-4 w-4`})})]}):(0,I.jsx)(L,{variant:`ghost`,size:`icon`,className:`h-8 w-8 text-muted-foreground hover:text-foreground`,onClick:()=>ee(!0),title:`Expand activity feed`,children:(0,I.jsx)(jn,{className:`h-4 w-4`})})}),(0,I.jsx)(`div`,{className:F(`space-y-3`,!S&&`hidden`),children:a.data?ce.length===0?(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`p-6 text-center text-sm text-muted-foreground`,children:`No recent activity.`})}):(0,I.jsx)(`div`,{className:`space-y-3`,children:ce.slice(0,15).map(e=>([`success`,`failed`,`canceled`,`error`].includes(String(e.status??``).toLowerCase()),(0,I.jsx)(f,{to:`/dashboard/runs/$runId`,params:{runId:String(e.id??``)},className:`block group`,children:(0,I.jsx)(z,{className:`hover:border-primary/50 transition-colors`,children:(0,I.jsxs)(U,{className:`p-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-start justify-between gap-2`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col gap-1 min-w-0`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(`span`,{className:`font-mono text-xs font-medium text-foreground`,children:[`#`,String(e.id??``)]}),(0,I.jsx)(`span`,{className:`text-xs text-muted-foreground truncate max-w-[120px]`,children:String(e.tpl_alias??e.type??`Run`)})]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground truncate`,children:String(e.message||`No message`)})]}),(0,I.jsx)(xc,{status:String(e.status??``),size:`xs`})]}),(0,I.jsxs)(`div`,{className:`mt-2 flex items-center justify-between text-[10px] text-muted-foreground`,children:[(0,I.jsx)(`span`,{children:String(e.user_name??`system`)}),(0,I.jsx)(`span`,{children:new Date(String(e.created)).toLocaleString(void 0,{month:`short`,day:`numeric`,hour:`numeric`,minute:`numeric`})})]})]})})},String(e.id??Math.random()))))}):(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsx)(K,{className:`h-20 w-full`}),(0,I.jsx)(K,{className:`h-20 w-full`})]})})]})]}),(0,I.jsx)(qo,{open:c,onOpenChange:l,children:(0,I.jsxs)(Xo,{children:[(0,I.jsxs)(Zo,{children:[(0,I.jsx)($o,{children:`Delete deployment?`}),(0,I.jsxs)(es,{children:[`This will remove "`,o?.name,`" from Skyforge and trigger provider cleanup. This action cannot be undone.`]})]}),pe&&(0,I.jsxs)(`div`,{className:`flex items-start gap-3 rounded-md border p-3`,children:[(0,I.jsx)(rs,{checked:d,onCheckedChange:e=>p(!!e),id:`delete-forward-network`}),(0,I.jsx)(`label`,{htmlFor:`delete-forward-network`,className:`text-sm leading-tight cursor-pointer`,children:`Also delete the Forward network associated with this deployment.`})]}),(0,I.jsxs)(Qo,{children:[(0,I.jsx)(ns,{children:`Cancel`}),(0,I.jsx)(ts,{onClick:de,className:mr({variant:`destructive`}),children:`Delete`})]})]})})]})}function xc({status:e,size:t=`default`}){let n=`secondary`,r=e.toLowerCase(),i=r===`success`||r===`succeeded`?`ready`:r===`crashloopbackoff`?`crashloop`:e;return[`running`,`active`,`healthy`].includes(r)&&(n=`default`),[`failed`,`error`,`crashloopbackoff`].includes(r)&&(n=`destructive`),(0,I.jsx)(No,{variant:n,className:`capitalize ${t===`xs`?`px-1.5 py-0 text-[10px] h-5`:``}`,children:i})}var Sc=Ln({name:zn().min(2,`Name must be at least 2 characters`),slug:zn().min(2,`Slug must be at least 2 characters`).regex(/^[a-z0-9-]+$/,`Slug must contain only lowercase letters, numbers, and dashes`),description:zn().optional(),isPublic:Vn().default(!1),blueprint:zn().optional(),sharedUsers:zn().optional()});const Cc=t(`/dashboard/workspaces/new`)({component:wc});function wc(){let e=n(),t=u(),r=Dn({resolver:At(Sc),defaultValues:{name:``,slug:``,description:``,isPublic:!1,blueprint:`skyforge/blueprints`,sharedUsers:``}}),i=m({mutationFn:e=>Zi({name:e.name,slug:e.slug,description:e.description||``,isPublic:!!e.isPublic,allowCustomEveServers:!1,allowCustomNetlabServers:!1,allowCustomContainerlabServers:!1,allowExternalTemplateRepos:!1,blueprint:(e.blueprint||``).trim(),externalTemplateRepos:[],sharedUsers:(e.sharedUsers||``).split(`,`).map(e=>e.trim()).filter(Boolean)}),onSuccess:async n=>{N.success(`Workspace created`,{description:`Workspace "${n.name}" has been created successfully.`}),await t.invalidateQueries({queryKey:W.workspaces()}),await e({to:`/dashboard/workspaces/${n.id}`})},onError:e=>{N.error(`Failed to create workspace`,{description:e.message})}});function a(e){i.mutate(e)}function o(e){let t=e.target.value;if(r.setValue(`name`,t),!r.getFieldState(`slug`).isDirty){let e=t.toLowerCase().replace(/[^a-z0-9]+/g,`-`).replace(/^-|-$/g,``);r.setValue(`slug`,e)}}return(0,I.jsxs)(`div`,{className:`max-w-2xl mx-auto p-6 space-y-6`,children:[(0,I.jsx)(`div`,{className:`flex items-center justify-between`,children:(0,I.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Create Workspace`})}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Workspace Details`}),(0,I.jsx)(H,{children:`Workspaces organize deployments and shared resources for a team. You can set per-user defaults under My Settings.`})]}),(0,I.jsx)(U,{children:(0,I.jsx)(ws,{...r,children:(0,I.jsxs)(`form`,{onSubmit:r.handleSubmit(a),className:`space-y-6`,children:[(0,I.jsx)(Es,{control:r.control,name:`name`,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{children:`Name`}),(0,I.jsx)(js,{children:(0,I.jsx)(J,{placeholder:`My Project`,...e,onChange:t=>{e.onChange(t),o(t)}})}),(0,I.jsx)(Ms,{children:`A display name for your workspace.`}),(0,I.jsx)(Ns,{})]})}),(0,I.jsx)(Es,{control:r.control,name:`slug`,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{children:`Slug`}),(0,I.jsx)(js,{children:(0,I.jsx)(J,{placeholder:`my-project`,...e})}),(0,I.jsx)(Ms,{children:`Unique identifier used in URLs. Only lowercase letters, numbers, and dashes.`}),(0,I.jsx)(Ns,{})]})}),(0,I.jsx)(Es,{control:r.control,name:`description`,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{children:`Description`}),(0,I.jsx)(js,{children:(0,I.jsx)(Ps,{placeholder:`Describe the purpose of this workspace...`,...e})}),(0,I.jsx)(Ms,{children:`Optional description for your team.`}),(0,I.jsx)(Ns,{})]})}),(0,I.jsx)(Es,{control:r.control,name:`isPublic`,render:({field:e})=>(0,I.jsxs)(ks,{className:`flex items-center justify-between rounded-lg border p-4`,children:[(0,I.jsxs)(`div`,{className:`space-y-0.5`,children:[(0,I.jsx)(As,{children:`Public workspace`}),(0,I.jsxs)(Ms,{children:[`Required for BYOS Netlab via`,` `,(0,I.jsx)(`code`,{className:`font-mono`,children:`topologyUrl`}),` when using workspace templates.`]})]}),(0,I.jsx)(js,{children:(0,I.jsx)(as,{checked:e.value,onCheckedChange:e.onChange})})]})}),(0,I.jsx)(Es,{control:r.control,name:`blueprint`,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{children:`Blueprint repo`}),(0,I.jsx)(js,{children:(0,I.jsx)(J,{placeholder:`skyforge/blueprints`,...e})}),(0,I.jsx)(Ms,{children:`Default template catalog repo (format: owner/repo).`}),(0,I.jsx)(Ns,{})]})}),(0,I.jsx)(Es,{control:r.control,name:`sharedUsers`,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{children:`Shared users (viewers)`}),(0,I.jsx)(js,{children:(0,I.jsx)(J,{placeholder:`alice,bob`,...e})}),(0,I.jsx)(Ms,{children:`Comma-separated usernames.`}),(0,I.jsx)(Ns,{})]})}),(0,I.jsxs)(`div`,{className:`flex justify-end gap-4`,children:[(0,I.jsx)(L,{type:`button`,variant:`ghost`,onClick:()=>e({to:`/dashboard/deployments`}),children:`Cancel`}),(0,I.jsx)(L,{type:`submit`,disabled:i.isPending,children:i.isPending?`Creating...`:`Create Workspace`})]})]})})})]})]})}var Tc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`div`,{className:`relative w-full overflow-auto`,children:(0,I.jsx)(`table`,{ref:n,className:F(`w-full caption-bottom text-sm`,e),...t})}));Tc.displayName=`Table`;var Ec=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`thead`,{ref:n,className:F(`[&_tr]:border-b`,e),...t}));Ec.displayName=`TableHeader`;var Dc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`tbody`,{ref:n,className:F(`[&_tr:last-child]:border-0`,e),...t}));Dc.displayName=`TableBody`;var Oc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`tfoot`,{ref:n,className:F(`border-t bg-muted/50 font-medium [&>tr]:last:border-b-0`,e),...t}));Oc.displayName=`TableFooter`;var kc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`tr`,{ref:n,className:F(`border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted`,e),...t}));kc.displayName=`TableRow`;var Ac=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`th`,{ref:n,className:F(`h-10 px-3 text-left align-middle text-xs font-medium uppercase tracking-wide text-muted-foreground [&:has([role=checkbox])]:pr-0`,e),...t}));Ac.displayName=`TableHead`;var jc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`td`,{ref:n,className:F(`px-3 py-2 align-middle [&:has([role=checkbox])]:pr-0`,e),...t}));jc.displayName=`TableCell`;var Mc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`caption`,{ref:n,className:F(`mt-4 text-sm text-muted-foreground`,e),...t}));Mc.displayName=`TableCaption`;function Nc({workspaceId:e,allowEdit:t}){let n=u(),[i,a]=(0,P.useState)(!1),[o,s]=(0,P.useState)(null),[c,l]=(0,P.useState)(null),d=r({queryKey:[`workspaceVariableGroups`,e],queryFn:async()=>Ra(e),staleTime:3e4}),f=d.data?.groups??[],p=m({mutationFn:async t=>Va(e,t),onSuccess:()=>{N.success(`Variable group deleted`),n.invalidateQueries({queryKey:[`workspaceVariableGroups`,e]}),l(null)},onError:e=>N.error(`Failed to delete group`,{description:e.message})});return(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(V,{children:`Variable Groups`}),(0,I.jsx)(H,{children:`Define sets of environment variables that can be injected into deployments.`})]}),(0,I.jsxs)(L,{size:`sm`,onClick:()=>a(!0),disabled:!t,children:[(0,I.jsx)(_,{className:`mr-2 h-4 w-4`}),`New Group`]})]})}),(0,I.jsx)(U,{children:d.isLoading?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading groups`}):f.length===0?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground border border-dashed rounded-lg p-8 text-center`,children:`No variable groups defined.`}):(0,I.jsx)(`div`,{className:`rounded-md border`,children:(0,I.jsxs)(Tc,{children:[(0,I.jsx)(Ec,{children:(0,I.jsxs)(kc,{children:[(0,I.jsx)(Ac,{children:`Name`}),(0,I.jsx)(Ac,{children:`Variables`}),(0,I.jsx)(Ac,{className:`text-right`,children:`Actions`})]})}),(0,I.jsx)(Dc,{children:f.map(e=>(0,I.jsxs)(kc,{children:[(0,I.jsx)(jc,{className:`font-medium`,children:e.name}),(0,I.jsxs)(jc,{className:`text-muted-foreground text-xs`,children:[Object.keys(e.variables??{}).length,` variables`]}),(0,I.jsx)(jc,{className:`text-right`,children:(0,I.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[(0,I.jsx)(L,{variant:`ghost`,size:`icon`,className:`h-8 w-8`,onClick:()=>s(e),disabled:!t,children:(0,I.jsx)(pn,{className:`h-4 w-4`})}),(0,I.jsx)(L,{variant:`ghost`,size:`icon`,className:`h-8 w-8 text-destructive hover:text-destructive`,onClick:()=>l(e),disabled:!t,children:(0,I.jsx)(Mn,{className:`h-4 w-4`})})]})})]},e.id))})]})})}),(0,I.jsx)(Pc,{open:i,onOpenChange:a,workspaceId:e,allowEdit:t,mode:`create`}),o&&(0,I.jsx)(Pc,{open:!!o,onOpenChange:e=>!e&&s(null),workspaceId:e,allowEdit:t,mode:`edit`,initialData:o}),(0,I.jsx)(qo,{open:!!c,onOpenChange:e=>!e&&l(null),children:(0,I.jsxs)(Xo,{children:[(0,I.jsxs)(Zo,{children:[(0,I.jsx)($o,{children:`Delete variable group?`}),(0,I.jsxs)(es,{children:[`This will permanently delete `,(0,I.jsx)(`strong`,{children:c?.name}),`.`]})]}),(0,I.jsxs)(Qo,{children:[(0,I.jsx)(ns,{children:`Cancel`}),(0,I.jsx)(ts,{className:`bg-destructive text-destructive-foreground hover:bg-destructive/90`,onClick:()=>c&&p.mutate(c.id),children:p.isPending?`Deleting`:`Delete`})]})]})})]})}function Pc({open:e,onOpenChange:t,workspaceId:n,allowEdit:r,mode:i,initialData:a}){let o=u(),[s,c]=(0,P.useState)(a?.name??``),[l,d]=(0,P.useState)(!1),[f,p]=(0,P.useState)(()=>a?.variables?Object.entries(a.variables).map(([e,t])=>({key:e,value:t})):[{key:``,value:``}]),h=m({mutationFn:async()=>{let e={};for(let t of f)t.key.trim()&&(e[t.key.trim()]=t.value);let t={name:s.trim(),variables:e};if(i===`create`)return za(n,t);if(!a)throw Error(`Missing initial data for edit`);return Ba(n,a.id,t)},onSuccess:()=>{N.success(i===`create`?`Group created`:`Group updated`),o.invalidateQueries({queryKey:[`workspaceVariableGroups`,n]}),t(!1),i===`create`&&(c(``),p([{key:``,value:``}]))},onError:e=>N.error(`Failed to save group`,{description:e.message})});return(0,I.jsxs)(Kn,{open:e,onOpenChange:t,children:[(0,I.jsxs)(Yn,{className:`max-w-2xl`,children:[(0,I.jsxs)(Xn,{children:[(0,I.jsx)(Qn,{children:i===`create`?`Create Variable Group`:`Edit Variable Group`}),(0,I.jsx)($n,{children:`Define environment variables as key-value pairs.`})]}),(0,I.jsxs)(`div`,{className:`space-y-4 py-4`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Group Name`}),(0,I.jsx)(J,{value:s,onChange:e=>c(e.target.value),placeholder:`e.g. Production Vars`,disabled:!r})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(q,{children:`Variables`}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(L,{type:`button`,variant:`ghost`,size:`sm`,onClick:()=>d(!0),children:`Supported vars`}),(0,I.jsxs)(L,{type:`button`,variant:`outline`,size:`sm`,onClick:()=>p([...f,{key:``,value:``}]),disabled:!r,children:[(0,I.jsx)(_,{className:`mr-2 h-3 w-3`}),` Add Variable`]})]})]}),(0,I.jsx)(`div`,{className:`space-y-2 max-h-[320px] overflow-y-auto pr-2`,children:f.map((e,t)=>{let n=String(e.key??``).trim(),i=Fs.some(e=>e.key===n)?n:`__custom__`,a=Ls(n),o=Rs(n),s=e=>{p(n=>{let r=[...n];return r[t]={...r[t],...e},r})};return(0,I.jsxs)(`div`,{className:`grid grid-cols-12 gap-2 items-start`,children:[(0,I.jsxs)(`div`,{className:`col-span-5 space-y-1`,children:[(0,I.jsx)(q,{className:`text-xs text-muted-foreground`,children:`Key`}),(0,I.jsxs)(Y,{value:i,onValueChange:e=>s({key:e===`__custom__`?``:e}),disabled:!r,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select key`})}),(0,I.jsxs)(Q,{children:[Fs.map(e=>(0,I.jsx)($,{value:e.key,children:e.label},e.key)),(0,I.jsx)($,{value:`__custom__`,children:`Custom`})]})]}),i===`__custom__`&&(0,I.jsx)(J,{placeholder:`KEY`,value:e.key,onChange:e=>s({key:e.target.value}),className:`font-mono text-xs`,disabled:!r})]}),(0,I.jsxs)(`div`,{className:`col-span-6 space-y-1`,children:[(0,I.jsx)(q,{className:`text-xs text-muted-foreground`,children:`Value`}),a?(0,I.jsx)(Ps,{value:e.value,onChange:e=>s({value:e.target.value}),placeholder:`One \`key=value\` per line.
Example:
addressing.p2p.ipv4=198.18.0.0/16`,className:`font-mono text-xs min-h-[120px]`,disabled:!r}):o?(0,I.jsx)(`div`,{className:`space-y-2`,children:(()=>{let t=String(e.value??``).trim(),n=o.some(e=>e.value===t),i=t?n?t:`__custom__`:`none`;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(Y,{value:i,onValueChange:e=>{s(e===`none`?{value:``}:e===`__custom__`?{value:n?``:t}:{value:e})},disabled:!r,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select value`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`none`,children:`None`}),o.map(e=>(0,I.jsx)($,{value:e.value,children:e.label},e.value)),(0,I.jsx)($,{value:`__custom__`,children:`Custom`})]})]}),i===`__custom__`&&(0,I.jsx)(J,{placeholder:`VALUE`,value:e.value,onChange:e=>s({value:e.target.value}),className:`font-mono text-xs`,disabled:!r})]})})()}):(0,I.jsx)(J,{placeholder:`VALUE`,value:e.value,onChange:e=>s({value:e.target.value}),className:`font-mono text-xs`,disabled:!r})]}),(0,I.jsx)(`div`,{className:`col-span-1 flex justify-end pt-6`,children:(0,I.jsx)(L,{type:`button`,variant:`ghost`,size:`icon`,className:`h-8 w-8`,onClick:()=>{p(e=>{let n=e.filter((e,n)=>n!==t);return n.length?n:[{key:``,value:``}]})},disabled:!r,children:(0,I.jsx)(Mn,{className:`h-4 w-4 text-muted-foreground`})})})]},t)})})]})]}),(0,I.jsxs)(Zn,{children:[(0,I.jsx)(L,{variant:`outline`,onClick:()=>t(!1),children:`Cancel`}),(0,I.jsxs)(L,{onClick:()=>h.mutate(),disabled:!r||h.isPending||!s.trim(),children:[h.isPending&&(0,I.jsx)(un,{className:`mr-2 h-4 w-4 animate-spin`}),`Save Group`]})]})]}),(0,I.jsx)(qo,{open:l,onOpenChange:d,children:(0,I.jsxs)(Xo,{children:[(0,I.jsxs)(Zo,{children:[(0,I.jsx)($o,{children:`Supported NETLAB_ variables`}),(0,I.jsx)(es,{children:"These are the most useful Netlab defaults you can override via environment variables (plus Skyforges multiline `SKYFORGE_NETLAB_SET_OVERRIDES`)."})]}),(0,I.jsx)(`div`,{className:`max-h-[50vh] overflow-auto rounded-md border bg-muted/30 p-3 font-mono text-xs`,children:Fs.map(e=>(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsx)(`span`,{className:`text-foreground`,children:e.key}),(0,I.jsxs)(`span`,{className:`text-muted-foreground`,children:[` `,e.label]})]},e.key))}),(0,I.jsx)(Qo,{children:(0,I.jsx)(ts,{children:`Close`})})]})})]})}const Fc=t(`/dashboard/workspaces/$workspaceId`)({component:Rc});function Ic(e){let t=String(e??``).trim();if(!t)return``;try{return new URL(t).hostname||t}catch{return t.replace(/^https?:\/\//,``).split(`/`)[0]??t}}function Lc(e){return Ic(e)||`server`}function Rc(){let{workspaceId:e}=Fc.useParams(),t=n(),i=u(),a=r({queryKey:W.session(),queryFn:Ar,staleTime:3e4,retry:!1}),o=r({queryKey:W.workspaces(),queryFn:Mr}),s=(0,P.useMemo)(()=>(o.data?.workspaces??[]).find(t=>t.id===e)??null,[o.data,e]),c=(0,P.useMemo)(()=>hc(a.data,s),[a.data,s]),l=(0,P.useMemo)(()=>gc(c),[c]),d=(0,P.useMemo)(()=>_c(c),[c]),[p,h]=(0,P.useState)(``),[g,_]=(0,P.useState)(``),[v,y]=(0,P.useState)(``),[b,x]=(0,P.useState)([]),[S,ee]=(0,P.useState)(!1),[C,te]=(0,P.useState)(!1),[w,T]=(0,P.useState)(!1),[E,ne]=(0,P.useState)(!1),[D,re]=(0,P.useState)(``),[O,ie]=(0,P.useState)(``),[ae,oe]=(0,P.useState)(``),[se,ce]=(0,P.useState)(``),[le,ue]=(0,P.useState)(!0),[de,fe]=(0,P.useState)(``),[pe,me]=(0,P.useState)(``),[k,he]=(0,P.useState)(``),[ge,_e]=(0,P.useState)(!0),[ve,ye]=(0,P.useState)(``),[be,xe]=(0,P.useState)(``),Se=m({mutationFn:async()=>na(e,{confirm:D.trim()||(s?.slug??e)}),onSuccess:async()=>{N.success(`Workspace deleted`),await i.invalidateQueries({queryKey:W.workspaces()}),await t({to:`/dashboard/deployments`})},onError:e=>N.error(`Failed to delete workspace`,{description:e.message})});(0,P.useEffect)(()=>{s&&(_((s.owners??[]).join(`,`)),y((s.editors??[]).join(`,`)),h((s.viewers??[]).join(`,`)),ee(!!s.allowExternalTemplateRepos),te(!!s.allowCustomNetlabServers),T(!!s.allowCustomEveServers),ne(!!s.allowCustomContainerlabServers),x((s.externalTemplateRepos??[]).filter(e=>!!e&&typeof e.id==`string`&&typeof e.name==`string`&&typeof e.repo==`string`).map(e=>({id:String(e.id??``).trim(),name:String(e.name??``).trim(),repo:String(e.repo??``).trim(),defaultBranch:String(e.defaultBranch??``).trim()||void 0}))))},[s]);let Ce=r({queryKey:[`userGitCredentials`],queryFn:$r,staleTime:3e4});(0,P.useEffect)(()=>{let e=Ce.data;e&&ie(e.httpsUsername??``)},[Ce.data]);let we=m({mutationFn:async e=>ei(e),onSuccess:async()=>{N.success(`Git credentials updated`),oe(``),await i.invalidateQueries({queryKey:[`userGitCredentials`]})},onError:e=>N.error(`Failed to update git credentials`,{description:e.message})}),Te=m({mutationFn:ti,onSuccess:async()=>{N.success(`Deploy key rotated`),await i.invalidateQueries({queryKey:[`userGitCredentials`]})},onError:e=>N.error(`Failed to rotate deploy key`,{description:e.message})}),Ee=m({mutationFn:async t=>Qi(e,{isPublic:t.isPublic,owners:t.owners,ownerGroups:s?.ownerGroups??[],editors:t.editors,editorGroups:s?.editorGroups??[],viewers:t.viewers,viewerGroups:s?.viewerGroups??[]}),onSuccess:async()=>{N.success(`Workspace updated`),await i.invalidateQueries({queryKey:W.workspaces()})},onError:e=>N.error(`Failed to update workspace`,{description:e.message})}),De=m({mutationFn:async t=>ca(e,{allowExternalTemplateRepos:S,allowCustomEveServers:w,allowCustomNetlabServers:C,allowCustomContainerlabServers:E,externalTemplateRepos:t.externalTemplateRepos??[]}),onSuccess:async()=>{N.success(`Workspace feature flags updated`),await i.invalidateQueries({queryKey:W.workspaces()})},onError:e=>N.error(`Failed to update settings`,{description:e.message})}),A=r({queryKey:W.workspaceNetlabServers(e),queryFn:async()=>Rr(e),staleTime:3e4}),Oe=r({queryKey:[`workspaceEveServers`,e],queryFn:async()=>Vr(e),staleTime:3e4}),ke=m({mutationFn:async()=>zr(e,{name:Lc(se),apiUrl:se.trim(),apiInsecure:le,apiUser:de.trim()||void 0,apiPassword:pe.trim()||void 0}),onSuccess:async()=>{N.success(`Netlab server saved`),ce(``),ue(!0),fe(``),me(``),await i.invalidateQueries({queryKey:W.workspaceNetlabServers(e)})},onError:e=>N.error(`Failed to save Netlab server`,{description:e.message})}),Ae=m({mutationFn:async t=>Br(e,t),onSuccess:async()=>{N.success(`Netlab server deleted`),await i.invalidateQueries({queryKey:W.workspaceNetlabServers(e)})},onError:e=>N.error(`Failed to delete Netlab server`,{description:e.message})}),je=m({mutationFn:async()=>Hr(e,{name:Lc(k),apiUrl:k.trim(),skipTlsVerify:ge,apiUser:ve.trim()||void 0,apiPassword:be.trim()||void 0}),onSuccess:async()=>{N.success(`EVE-NG server saved`),he(``),_e(!0),ye(``),xe(``),await i.invalidateQueries({queryKey:[`workspaceEveServers`,e]})},onError:e=>N.error(`Failed to save EVE-NG server`,{description:e.message})}),Me=m({mutationFn:async t=>Ur(e,t),onSuccess:async()=>{N.success(`EVE-NG server deleted`),await i.invalidateQueries({queryKey:[`workspaceEveServers`,e]})},onError:e=>N.error(`Failed to delete EVE-NG server`,{description:e.message})}),j=e=>e.split(`,`).map(e=>e.trim()).filter(Boolean);return o.isLoading?(0,I.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,I.jsx)(K,{className:`h-8 w-64`}),(0,I.jsx)(K,{className:`h-28 w-full`})]}):s?(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between border-b pb-6`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:s.name}),(0,I.jsxs)(`div`,{className:`mt-1 text-sm text-muted-foreground`,children:[(0,I.jsx)(`span`,{className:`font-mono`,children:s.slug}),` `,(0,I.jsx)(No,{variant:s.isPublic?`default`:`secondary`,children:s.isPublic?`Public`:`Private`})]})]}),(0,I.jsx)(f,{to:`/dashboard/deployments`,search:{workspace:s.id},children:(0,I.jsx)(L,{variant:`outline`,children:`Back to deployments`})})]}),(0,I.jsxs)(fs,{defaultValue:`access`,className:`space-y-6`,children:[(0,I.jsxs)(ps,{children:[(0,I.jsx)(ms,{value:`access`,children:`Access`}),(0,I.jsx)(ms,{value:`variables`,children:`Variables`}),(0,I.jsx)(ms,{value:`features`,children:`Features`}),d&&(0,I.jsx)(ms,{value:`danger`,children:`Danger`})]}),(0,I.jsxs)(hs,{value:`access`,className:`space-y-6`,children:[!l&&(0,I.jsx)(z,{children:(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Read-only access`}),(0,I.jsx)(H,{children:`You can view this workspace but cannot edit or delete it.`})]})}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Visibility`}),(0,I.jsx)(H,{children:"BYOS Netlab via `topologyUrl` requires public access to the selected topology."})]}),(0,I.jsxs)(U,{className:`flex items-center justify-between`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Public workspace`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Controls Gitea repo visibility and template accessibility.`})]}),(0,I.jsx)(as,{checked:!!s.isPublic,disabled:!l,onCheckedChange:e=>{let t=j(g);Ee.mutate({isPublic:e,owners:t,editors:j(v),viewers:j(p)})}})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Members`}),(0,I.jsx)(H,{children:`Comma-separated usernames. (Groups are not editable here yet.)`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Owners`}),(0,I.jsx)(J,{value:g,onChange:e=>_(e.target.value),placeholder:`alice,bob`,disabled:!l})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Editors`}),(0,I.jsx)(J,{value:v,onChange:e=>y(e.target.value),placeholder:`alice,bob`,disabled:!l})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Viewers`}),(0,I.jsx)(J,{value:p,onChange:e=>h(e.target.value),placeholder:`alice,bob`,disabled:!l})]}),(0,I.jsx)(`div`,{className:`flex justify-end`,children:(0,I.jsx)(L,{variant:`default`,disabled:!l||Ee.isPending,onClick:()=>Ee.mutate({isPublic:!!s.isPublic,owners:j(g),editors:j(v),viewers:j(p)}),children:Ee.isPending?`Saving`:`Save members`})})]})]})]}),(0,I.jsx)(hs,{value:`variables`,className:`space-y-6`,children:(0,I.jsx)(Nc,{workspaceId:e,allowEdit:l})}),(0,I.jsx)(hs,{value:`features`,className:`space-y-6`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Workspace features`}),(0,I.jsxs)(H,{children:[`Workspaces are primarily for access control and shared resources. Most deployment-time defaults live in`,` `,(0,I.jsx)(f,{className:`underline`,to:`/dashboard/settings`,children:`My Settings`}),`.`]})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`rounded-md border p-3 space-y-3`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Feature gates`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`These toggles control what members are allowed to use. BYOL and external repo configuration lives in user settings; these gates only enable/disable usage per workspace.`}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Allow external template repos`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Enables template source = External.`})]}),(0,I.jsx)(as,{checked:S,onCheckedChange:ee,disabled:!l})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Allow custom Netlab servers`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Allows members to select user-scoped Netlab BYOL servers.`})]}),(0,I.jsx)(as,{checked:C,onCheckedChange:te,disabled:!l})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Allow custom Containerlab servers`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Allows members to select user-scoped Containerlab BYOL servers.`})]}),(0,I.jsx)(as,{checked:E,onCheckedChange:ne,disabled:!l})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Allow custom EVE-NG servers`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Allows members to select user-scoped EVE-NG (LabPP) servers.`})]}),(0,I.jsx)(as,{checked:w,onCheckedChange:T,disabled:!l})]})]})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-3 space-y-3`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Legacy: workspace-scoped Netlab servers (deprecated)`}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Prefer configuring user-scoped Netlab servers in`,` `,(0,I.jsx)(f,{className:`underline`,to:`/dashboard/settings`,children:`My Settings`}),`. These workspace-scoped servers remain for legacy workflows and will be removed once migration is complete.`]}),(0,I.jsx)(`div`,{className:`space-y-2`,children:(A.data?.servers??[]).length===0?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No Netlab servers configured.`}):(A.data?.servers??[]).map(e=>(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3 rounded-md border p-3`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-medium`,children:Ic(e.apiUrl)||e.name}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground truncate`,children:[e.apiUrl,` `,e.apiInsecure?`(insecure)`:``,` `,e.apiUser?` ${e.apiUser}`:``,` `,e.hasPassword?` password set`:``]})]}),(0,I.jsx)(L,{type:`button`,variant:`destructive`,size:`sm`,disabled:!l||Ae.isPending,onClick:()=>Ae.mutate(e.id),children:`Delete`})]},e.id))}),(0,I.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`API URL`}),(0,I.jsx)(J,{value:se,disabled:!l,onChange:e=>ce(e.target.value),placeholder:`https://netlab.local.forwardnetworks.com:8080`}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Custom ports are supported (e.g.`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`:8080`}),`) but wont be shown in dropdown labels.`]})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3 md:col-span-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Skip TLS verification`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Disable certificate verification for this server.`})]}),(0,I.jsx)(as,{checked:le,onCheckedChange:ue,disabled:!l})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Username`}),(0,I.jsx)(J,{value:de,disabled:!l,onChange:e=>fe(e.target.value),placeholder:`user`})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Password`}),(0,I.jsx)(J,{value:pe,disabled:!l,onChange:e=>me(e.target.value),placeholder:`password`,type:`password`})]})]}),(0,I.jsx)(`div`,{className:`flex justify-end`,children:(0,I.jsx)(L,{type:`button`,disabled:!l||ke.isPending||!se.trim(),onClick:()=>ke.mutate(),children:ke.isPending?`Saving`:`Add Netlab server`})})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-3 space-y-3`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Legacy: workspace-scoped EVE-NG servers (deprecated)`}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Prefer configuring user-scoped EVE-NG servers in`,` `,(0,I.jsx)(f,{className:`underline`,to:`/dashboard/settings`,children:`My Settings`}),`. These workspace-scoped servers remain for legacy workflows and will be removed once migration is complete.`]}),(0,I.jsx)(`div`,{className:`space-y-2`,children:(Oe.data?.servers??[]).length===0?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No EVE-NG servers configured.`}):(Oe.data?.servers??[]).map(e=>(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3 rounded-md border p-3`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-medium`,children:Ic(e.apiUrl)||e.name}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground truncate`,children:[e.apiUrl,` `,e.skipTlsVerify?`(skip TLS verify)`:``,` `,e.apiUser?` ${e.apiUser}`:``,` `,e.hasPassword?` password set`:``]})]}),(0,I.jsx)(L,{type:`button`,variant:`destructive`,size:`sm`,disabled:!l||Me.isPending,onClick:()=>Me.mutate(e.id),children:`Delete`})]},e.id))}),(0,I.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`API URL`}),(0,I.jsx)(J,{value:k,disabled:!l,onChange:e=>he(e.target.value),placeholder:`https://eve.example:8080/api`}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Custom ports are supported (e.g.`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`:8080`}),`) but wont be shown in dropdown labels.`]})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3 md:col-span-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Skip TLS verification`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Disable certificate verification for this server.`})]}),(0,I.jsx)(as,{checked:ge,onCheckedChange:_e,disabled:!l})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Username`}),(0,I.jsx)(J,{value:ve,disabled:!l,onChange:e=>ye(e.target.value),placeholder:`user`})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Password`}),(0,I.jsx)(J,{value:be,disabled:!l,onChange:e=>xe(e.target.value),placeholder:`password`,type:`password`})]})]}),(0,I.jsx)(`div`,{className:`flex justify-end`,children:(0,I.jsx)(L,{type:`button`,disabled:!l||je.isPending||!k.trim(),onClick:()=>je.mutate(),children:je.isPending?`Saving`:`Add EVE-NG server`})})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(q,{children:`External template repos`}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Prefer configuring external repos in`,` `,(0,I.jsx)(f,{className:`underline`,to:`/dashboard/settings`,children:`My Settings`}),`. This workspace-scoped list remains for legacy workflows and will be removed once migration is complete.`]})]}),(0,I.jsx)(L,{type:`button`,variant:`outline`,size:`sm`,disabled:!l,onClick:()=>x(e=>[...e,{id:`repo-${e.length+1}`,name:`Repo ${e.length+1}`,repo:``,defaultBranch:``}]),children:`Add repo`})]}),(0,I.jsx)(`div`,{className:`space-y-3`,children:b.length===0?(0,I.jsx)(`div`,{className:`rounded-md border bg-muted/30 p-3 text-sm text-muted-foreground`,children:`No external repos configured.`}):b.map((e,t)=>(0,I.jsxs)(`div`,{className:`rounded-md border p-3 space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{className:`text-sm font-medium`,children:[`Repo `,t+1]}),(0,I.jsx)(L,{type:`button`,variant:`ghost`,size:`sm`,disabled:!l,onClick:()=>x(e=>e.filter((e,n)=>n!==t)),children:`Remove`})]}),(0,I.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`ID`}),(0,I.jsx)(J,{value:e.id,disabled:!l,onChange:e=>x(n=>n.map((n,r)=>r===t?{...n,id:e.target.value}:n)),placeholder:`my-repo`})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Name`}),(0,I.jsx)(J,{value:e.name,disabled:!l,onChange:e=>x(n=>n.map((n,r)=>r===t?{...n,name:e.target.value}:n)),placeholder:`My templates`})]}),(0,I.jsxs)(`div`,{className:`space-y-1 md:col-span-2`,children:[(0,I.jsx)(q,{children:`Repo`}),(0,I.jsx)(J,{value:e.repo,disabled:!l,onChange:e=>x(n=>n.map((n,r)=>r===t?{...n,repo:e.target.value}:n)),placeholder:`owner/repo`})]}),(0,I.jsxs)(`div`,{className:`space-y-1 md:col-span-2`,children:[(0,I.jsx)(q,{children:`Default branch`}),(0,I.jsx)(J,{value:e.defaultBranch??``,disabled:!l,onChange:e=>x(n=>n.map((n,r)=>r===t?{...n,defaultBranch:e.target.value}:n)),placeholder:`main`})]})]})]},`${e.id}-${t}`))})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-3 space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Git credentials (your user)`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Use this deploy key for SSH-based repos and an HTTPS token for https:// clones.`})]}),(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsx)(L,{type:`button`,variant:`outline`,size:`sm`,disabled:Te.isPending||Ce.isLoading,onClick:()=>Te.mutate(),children:`Rotate key`}),(0,I.jsx)(L,{type:`button`,variant:`outline`,size:`sm`,disabled:!Ce.data?.sshPublicKey,onClick:async()=>{let e=Ce.data?.sshPublicKey??``;try{await navigator.clipboard.writeText(e),N.success(`Copied public key`)}catch{N.error(`Failed to copy`)}},children:`Copy public key`})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`SSH deploy key (public)`}),(0,I.jsx)(Ps,{readOnly:!0,value:Ce.data?.sshPublicKey??``,placeholder:`Loading`})]}),(0,I.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`HTTPS username`}),(0,I.jsx)(J,{value:O,disabled:we.isPending,onChange:e=>ie(e.target.value),placeholder:`username`})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`HTTPS token`}),(0,I.jsx)(J,{value:ae,disabled:we.isPending,onChange:e=>oe(e.target.value),placeholder:`token`,type:`password`})]})]}),(0,I.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[(0,I.jsx)(L,{type:`button`,variant:`secondary`,disabled:we.isPending||Ce.isLoading||!Ce.data?.hasHttpsToken,onClick:()=>we.mutate({httpsUsername:O,clearToken:!0}),children:`Clear token`}),(0,I.jsx)(L,{type:`button`,disabled:we.isPending||Ce.isLoading,onClick:()=>we.mutate({httpsUsername:O,httpsToken:ae}),children:`Save git credentials`})]})]}),(0,I.jsx)(`div`,{className:`flex justify-end`,children:(0,I.jsx)(L,{variant:`default`,disabled:!l||De.isPending,onClick:()=>{let e=b.map(e=>({id:String(e.id??``).trim(),name:String(e.name??``).trim(),repo:String(e.repo??``).trim(),defaultBranch:String(e.defaultBranch??``).trim()||void 0})).filter(e=>e.id&&e.name&&e.repo);if(e.some(e=>!e.id||!e.name||!e.repo)){N.error(`External repos must include id, name, and repo`);return}De.mutate({externalTemplateRepos:e})},children:De.isPending?`Saving`:`Save settings`})})]})]})}),d&&(0,I.jsx)(hs,{value:`danger`,className:`space-y-6`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Delete workspace`}),(0,I.jsx)(H,{children:`Deletes the workspace and backing resources. This cannot be undone.`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Type `,(0,I.jsx)(`span`,{className:`font-mono`,children:s.slug}),` to confirm.`]}),(0,I.jsx)(J,{value:D,onChange:e=>re(e.target.value),placeholder:s.slug}),(0,I.jsx)(`div`,{className:`flex justify-end`,children:(0,I.jsx)(L,{variant:`destructive`,disabled:Se.isPending||D.trim().toLowerCase()!==s.slug.toLowerCase(),onClick:()=>Se.mutate(),children:Se.isPending?`Deleting`:`Delete workspace`})})]})]})})]})]}):(0,I.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Workspace not found.`}),(0,I.jsx)(L,{variant:`outline`,onClick:()=>t({to:`/dashboard/workspaces`}),children:`Back`})]})}function zc(e,t){let n=u(),r=(0,P.useMemo)(()=>`${Dr}/runs/${encodeURIComponent(e)}/events`,[e]);(0,P.useEffect)(()=>{if(!t||!e)return;let i=vo(r,{output:t=>{try{console.log(`Run event:`,t.data);let r=JSON.parse(t.data);if(!r||!Array.isArray(r.entries))return;n.setQueryData(W.runLogs(e),e=>{let t=(e?.entries??[]).concat(r.entries);return{cursor:Number(r.cursor??e?.cursor??0),entries:t}})}catch{}}});return()=>{i.close()}},[t,n,e,r])}const Bc=t(`/dashboard/runs/$runId`)({component:Vc});function Vc(){let{runId:e}=Bc.useParams();zc(e,!0);let t=u(),i=n(),a=r({queryKey:W.dashboardSnapshot(),queryFn:Nr,initialData:()=>t.getQueryData(W.dashboardSnapshot())??null,retry:!1,staleTime:1/0}),o=(a.data?.runs??[]).find(t=>String(t.id??``)===e),s=String(o?.status??``).toLowerCase(),c=s===`queued`||s===`running`,l=r({queryKey:W.runLogs(e),queryFn:async()=>({cursor:0,entries:[]}),retry:!1,staleTime:1/0}),d=Or(window.location.pathname+window.location.search);return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsx)(`div`,{children:(0,I.jsxs)(V,{children:[`Run `,e]})}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(f,{className:mr({variant:`outline`,size:`sm`}),to:`/dashboard/deployments`,children:`Back`}),(0,I.jsx)(L,{variant:`destructive`,size:`sm`,disabled:!o||!c,onClick:()=>{if(!o)return;let n=String(o.workspaceId??``);if(!n){N.error(`Cannot cancel run`,{description:`Missing workspace ID.`});return}(async()=>{try{await La(e,n),N.success(`Run canceled`),await t.invalidateQueries({queryKey:W.dashboardSnapshot()}),i({to:`/dashboard/deployments`,search:{workspace:n}})}catch(e){N.error(`Cancel failed`,{description:e.message})}})()},children:`Cancel`}),(0,I.jsx)(L,{variant:`outline`,size:`sm`,onClick:()=>t.setQueryData(W.runLogs(e),{cursor:0,entries:[]}),children:`Clear`})]})]})})}),!a.data&&(0,I.jsx)(z,{className:`border-dashed`,children:(0,I.jsxs)(U,{className:`pt-6 text-center text-muted-foreground`,children:[`Loading dashboard`,(0,I.jsxs)(`div`,{className:`mt-2 text-xs`,children:[`If you are logged out,`,` `,(0,I.jsx)(`a`,{className:`text-primary underline hover:no-underline`,href:d,onClick:e=>{e.preventDefault(),(async()=>{if(!await fo({loginHref:d})){window.location.href=d;return}await t.invalidateQueries({queryKey:W.session()})})()},children:`login`}),`.`]})]})}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(V,{children:`Metadata`}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Cursor: `,String(l.data?.cursor??0)]})]})}),(0,I.jsx)(U,{children:(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-4 md:grid-cols-3`,children:[(0,I.jsx)(Hc,{label:`Type`,value:String(o?.tpl_alias??``)}),(0,I.jsx)(Hc,{label:`Status`,value:String(o?.status??``)}),(0,I.jsx)(Hc,{label:`Workspace`,value:String(o?.workspaceId??``)}),(0,I.jsx)(Hc,{label:`Created`,value:String(o?.created??``)}),(0,I.jsx)(Hc,{label:`Started`,value:String(o?.start??``)}),(0,I.jsx)(Hc,{label:`Finished`,value:String(o?.end??``)})]})})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Output`})}),(0,I.jsx)(U,{children:(0,I.jsx)(`div`,{className:`rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100`,children:(0,I.jsx)(Uc,{entries:l.data?.entries??[]})})})]})]})}function Hc(e){return(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-[11px] uppercase tracking-wide text-muted-foreground`,children:e.label}),(0,I.jsx)(`div`,{className:`break-all font-medium text-sm`,children:e.value||``})]})}function Uc(e){let t=(0,P.useRef)(null);return(0,P.useEffect)(()=>{let e=t.current;e&&(e.scrollTop=e.scrollHeight)},[e.entries.length]),e.entries.length===0?(0,I.jsx)(`div`,{className:`text-zinc-500`,children:`Waiting for output`}):(0,I.jsx)(`div`,{ref:t,className:`max-h-[65vh] overflow-auto whitespace-pre-wrap`,children:e.entries.map((e,t)=>(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`span`,{className:`text-zinc-500 select-none`,children:e.time?`${e.time} `:``}),(0,I.jsx)(`span`,{children:e.output})]},`${e.time}-${t}`))})}function Wc({workspaceId:e,deploymentId:t,nodeId:n,nodeKind:i,nodeIp:a,onClose:o,className:s}){let c=(0,P.useMemo)(()=>{let e=[n];return i&&e.push(String(i)),e.join(`  `)},[n,i]),l=r({queryKey:[`deploymentNodeDescribe`,e,t,n],enabled:!!e&&!!t&&!!n,queryFn:async()=>Li(e,t,n),refetchOnWindowFocus:!1,retry:1});return(0,I.jsxs)(`div`,{className:`flex flex-col h-full w-full ${s??``}`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2 p-2 border-b bg-muted/40 text-xs`,children:[(0,I.jsxs)(`div`,{className:`truncate flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`font-mono font-medium`,children:c}),a?(0,I.jsx)(`span`,{className:`font-mono text-muted-foreground`,children:a}):null]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(L,{variant:`outline`,size:`sm`,className:`h-7`,onClick:()=>l.refetch(),disabled:l.isFetching,children:[(0,I.jsx)(tt,{className:l.isFetching?`mr-2 h-3 w-3 animate-spin`:`mr-2 h-3 w-3`}),`Refresh`]}),o?(0,I.jsx)(L,{variant:`ghost`,size:`sm`,className:`h-7`,onClick:o,children:`Close`}):null]})]}),(0,I.jsx)(`div`,{className:`flex-1 overflow-auto bg-muted/10 p-4`,children:(0,I.jsx)(`pre`,{className:`text-xs font-mono whitespace-pre-wrap`,children:l.isLoading?`Loading`:l.isError?`Failed to load node status: ${String(l.error)}`:JSON.stringify(l.data??{},null,2)})})]})}function Gc({open:e,onOpenChange:t,workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,nodeIp:o}){return(0,I.jsx)(Kn,{open:e,onOpenChange:t,children:(0,I.jsxs)(Yn,{className:`max-w-5xl h-[70vh] flex flex-col p-0 gap-0 overflow-hidden`,children:[(0,I.jsx)(Xn,{className:`px-6 py-4 border-b`,children:(0,I.jsxs)(Qn,{className:`flex items-center gap-2`,children:[(0,I.jsx)(ee,{className:`h-4 w-4`}),`Node status`]})}),(0,I.jsx)(`div`,{className:`flex-1 min-h-0`,children:e?(0,I.jsx)(Wc,{workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,nodeIp:o,onClose:()=>t(!1)}):null})]})})}function Kc({workspaceId:e,deploymentId:t,nodeId:n,nodeKind:i,nodeIp:a,onClose:o,className:s}){let c=(0,P.useMemo)(()=>{let e=[n];return i&&e.push(String(i)),e.join(`  `)},[n,i]),l=r({queryKey:[`deploymentNodeLogs`,e,t,n,400],enabled:!!e&&!!t&&!!n,queryFn:async()=>Ii(e,t,n,{tail:400,container:n}),refetchOnWindowFocus:!1,retry:1});return(0,I.jsxs)(`div`,{className:`flex flex-col h-full w-full ${s??``}`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2 p-2 border-b bg-muted/40 text-xs`,children:[(0,I.jsxs)(`div`,{className:`truncate flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`font-mono font-medium`,children:c}),a?(0,I.jsx)(`span`,{className:`font-mono text-muted-foreground`,children:a}):null,l.data?.namespace&&l.data?.podName?(0,I.jsxs)(`span`,{className:`text-muted-foreground`,children:[l.data.namespace,`/`,l.data.podName]}):null]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(L,{variant:`outline`,size:`sm`,className:`h-7`,onClick:()=>l.refetch(),disabled:l.isFetching,children:[(0,I.jsx)(tt,{className:l.isFetching?`mr-2 h-3 w-3 animate-spin`:`mr-2 h-3 w-3`}),`Refresh`]}),o?(0,I.jsx)(L,{variant:`ghost`,size:`sm`,className:`h-7`,onClick:o,children:`Close`}):null]})]}),(0,I.jsx)(`div`,{className:`flex-1 overflow-auto bg-muted/10 p-4`,children:(0,I.jsx)(`pre`,{className:`text-xs font-mono whitespace-pre-wrap`,children:l.isLoading?`Loading`:l.isError?`Failed to load logs: ${String(l.error)}`:l.data?.logs||``})})]})}function qc({open:e,onOpenChange:t,workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,nodeIp:o}){return(0,I.jsx)(Kn,{open:e,onOpenChange:t,children:(0,I.jsxs)(Yn,{className:`max-w-5xl h-[70vh] flex flex-col p-0 gap-0 overflow-hidden`,children:[(0,I.jsx)(Xn,{className:`px-6 py-4 border-b`,children:(0,I.jsxs)(Qn,{className:`flex items-center gap-2`,children:[(0,I.jsx)(ee,{className:`h-4 w-4`}),`Node logs`]})}),(0,I.jsx)(`div`,{className:`flex-1 min-h-0`,children:e?(0,I.jsx)(Kc,{workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,nodeIp:o,onClose:()=>t(!1)}):null})]})})}var Jc=Rn(),Yc=Hn();function Xc({workspaceId:e,deploymentId:t,nodeId:n,nodeKind:r,onClose:i,className:a}){let o=(0,P.useRef)(null),s=(0,P.useRef)(null),c=(0,P.useRef)(null),l=(0,P.useRef)(null),[u,d]=(0,P.useState)(`disconnected`),f=(0,P.useMemo)(()=>{let e=String(r??``).toLowerCase();return e.includes(`eos`)||e.includes(`ceos`)?`Cli`:`sh`},[r]),p=(0,P.useMemo)(()=>{if(!e||!t||!n)return``;let r=`${window.location.protocol===`https:`?`wss`:`ws`}://${window.location.host}/api/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/terminal/ws`,i=new URLSearchParams;return i.set(`node`,n),i.set(`command`,f),`${r}?${i.toString()}`},[f,t,n,e]);return(0,P.useEffect)(()=>{if(!o.current||!p)return;let e=new Yc.Terminal({convertEol:!0,cursorBlink:!0,fontFamily:`ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace`,fontSize:12,theme:{background:`#09090b`}}),t=new Jc.FitAddon;e.loadAddon(t),e.open(o.current),t.fit(),e.writeln(`\x1B[1mSkyforge Terminal\x1B[0m`),e.writeln(`Node: ${n}  Command: ${f}`),e.writeln(``),s.current=e,c.current=t;let r=new WebSocket(p);l.current=r,d(`connecting`);let i=()=>{let e=s.current;if(!e)return;let t=e.cols??80,n=e.rows??24;try{r.send(JSON.stringify({type:`resize`,cols:t,rows:n}))}catch{}};r.onopen=()=>{d(`connected`),i(),e.focus()},r.onmessage=t=>{let n=null;try{n=JSON.parse(String(t.data))}catch{e.write(String(t.data));return}if(n){if(n.type===`output`){e.write(n.data??``);return}if(n.type===`info`){e.writeln(`\r\n[info] ${n.data??``}`);return}if(n.type===`error`){e.writeln(`\r\n[error] ${n.data??``}`);return}}},r.onclose=t=>{d(`closed`);let n=typeof t.code==`number`?t.code:0,r=t.reason?` ${t.reason}`:``;e.writeln(`\r\n[disconnected]${n?` (code ${n})`:``}${r}`)},r.onerror=()=>{d(`error`),e.writeln(`\r
[error] websocket error (check browser console/network)`)};let a=e.onData(e=>{try{r.send(JSON.stringify({type:`stdin`,data:e}))}catch{}}),u=()=>{t.fit(),i()};return window.addEventListener(`resize`,u),()=>{window.removeEventListener(`resize`,u),a.dispose();try{r.close()}catch{}l.current=null,e.dispose(),s.current=null,c.current=null,d(`disconnected`)}},[f,n,p]),(0,I.jsxs)(`div`,{className:`flex flex-col h-full w-full ${a??``}`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2 p-2 text-xs text-muted-foreground bg-zinc-900 border-b border-zinc-800`,children:[(0,I.jsxs)(`div`,{className:`truncate`,children:[(0,I.jsx)(`span`,{className:`font-mono text-zinc-300`,children:n}),(0,I.jsx)(`span`,{className:`mx-2 text-zinc-600`,children:`/`}),(0,I.jsx)(`span`,{children:u})]}),i?(0,I.jsx)(L,{variant:`ghost`,size:`sm`,className:`h-6 px-2 text-xs`,onClick:()=>{let e=l.current;if(e&&e.readyState===WebSocket.OPEN)try{e.close()}catch{}i()},children:`Close`}):null]}),(0,I.jsx)(`div`,{className:`flex-1 bg-zinc-950 p-2 min-h-0`,children:(0,I.jsx)(`div`,{ref:o,className:`h-full w-full`})})]})}function Zc({open:e,onOpenChange:t,workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a}){let o=`${n}-${r}-${i}-${e}`;return(0,I.jsx)(Kn,{open:e,onOpenChange:t,children:(0,I.jsxs)(Yn,{className:`max-w-5xl h-[70vh] flex flex-col p-0 gap-0 overflow-hidden`,children:[(0,I.jsx)(Xn,{className:`px-6 py-4 border-b`,children:(0,I.jsxs)(Qn,{className:`flex items-center gap-2`,children:[(0,I.jsx)(ee,{className:`h-4 w-4`}),`Terminal`]})}),(0,I.jsx)(`div`,{className:`flex-1 min-h-0`,children:e?(0,I.jsx)(Xc,{workspaceId:n,deploymentId:r,nodeId:i,nodeKind:a,onClose:()=>t(!1)},o):null})]})})}function Qc(){return{downloadImage:(0,P.useCallback)((e,t)=>{e&&Bn(e,{cacheBust:!0,backgroundColor:`#18181b`}).then(e=>{let n=document.createElement(`a`);n.download=t,n.href=e,n.click()}).catch(e=>{console.error(`Failed to download image`,e)})},[])}}function $c(e,t,n){let r=u(),i=(0,P.useMemo)(()=>`${Dr}/workspaces/${encodeURIComponent(e)}/deployments/${encodeURIComponent(t)}/ui-events/events`,[t,e]);(0,P.useEffect)(()=>{if(!n||!e||!t)return;let a=n=>{try{let i=JSON.parse(n.data);if(!i||!Array.isArray(i.events))return;r.setQueryData(W.deploymentUIEvents(e,t),e=>{let t=(e?.events??[]).concat(i.events),n=t.slice(Math.max(0,t.length-300));return{cursor:Number(i.cursor??e?.cursor??0),events:n}})}catch{}},o=vo(i,{"ui-events":a});return()=>o.close()},[t,n,r,i,e])}var el={custom:({data:e})=>{let t=e.icon===`switch`?sn:e.icon===`cloud`?A:e.icon===`client`?Tt:be,n=e.status===`running`?`default`:e.status===`stopped`?`secondary`:`destructive`,r=!!e?.highlight,i=String(e?.vendor??``);return(0,I.jsxs)(z,{className:`min-w-[180px] border-2 shadow-md ${r?`border-primary ring-2 ring-primary/30`:``}`,children:[(0,I.jsx)(B,{className:`p-3 pb-2`,children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(({vendor:e})=>{let t=String(e).toLowerCase();return t===`cisco`?(0,I.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center`,title:`Cisco`,style:{background:`rgba(0, 142, 204, 0.15)`,color:`rgb(0, 142, 204)`},children:(0,I.jsx)(`svg`,{viewBox:`0 0 24 24`,width:`16`,height:`16`,"aria-hidden":`true`,children:[{x:4,h:8},{x:7,h:10},{x:10,h:12},{x:13,h:10},{x:16,h:8}].map(e=>(0,I.jsx)(`rect`,{x:e.x,y:14-e.h,width:`2`,height:e.h,rx:`1`,fill:`currentColor`},e.x))})}):t===`arista`?(0,I.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center`,title:`Arista`,style:{background:`rgba(232, 43, 44, 0.14)`,color:`rgb(232, 43, 44)`},children:(0,I.jsx)(`svg`,{viewBox:`0 0 24 24`,width:`16`,height:`16`,"aria-hidden":`true`,children:(0,I.jsx)(`path`,{d:`M12 3 4.5 21h3.6l1.6-4h4.6l1.6 4h3.6L12 3zm-1 11 1-2.6 1 2.6h-2z`,fill:`currentColor`})})}):t===`linux`?(0,I.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center`,title:`Linux`,style:{background:`rgba(34, 197, 94, 0.12)`,color:`rgb(34, 197, 94)`},children:(0,I.jsxs)(`svg`,{viewBox:`0 0 24 24`,width:`16`,height:`16`,"aria-hidden":`true`,children:[(0,I.jsx)(`circle`,{cx:`12`,cy:`9`,r:`4`,fill:`#111827`}),(0,I.jsx)(`ellipse`,{cx:`12`,cy:`16`,rx:`5`,ry:`6`,fill:`#111827`}),(0,I.jsx)(`ellipse`,{cx:`12`,cy:`17`,rx:`3.3`,ry:`4.2`,fill:`#ffffff`}),(0,I.jsx)(`path`,{d:`M12 10l2 1-2 1-2-1 2-1z`,fill:`#f59e0b`})]})}):(0,I.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center bg-muted text-[11px] font-bold`,title:`Unknown`,children:`?`})},{vendor:i}),(0,I.jsx)(`div`,{className:`p-1.5 bg-muted rounded-md`,title:String(e?.kind??``),children:(0,I.jsx)(t,{className:`w-4 h-4`})})]}),(0,I.jsx)(No,{variant:n,className:`text-[10px] h-5`,children:String(e.status)})]})}),(0,I.jsxs)(U,{className:`p-3 pt-0`,children:[(0,I.jsx)(V,{className:`text-sm font-bold truncate`,children:String(e.label)}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground mt-1 truncate font-mono`,children:String(e.ip||`10.0.0.x`)}),(0,I.jsx)(ln,{type:`target`,position:$t.Top,className:`!bg-muted-foreground`}),(0,I.jsx)(ln,{type:`source`,position:$t.Bottom,className:`!bg-muted-foreground`})]})]})}};function tl({topology:e,workspaceId:t,deploymentId:n,enableTerminal:i,fullHeight:a,className:o}){let s=(0,P.useCallback)(e=>{let t=String(e??``).toLowerCase();return t?t.includes(`arista`)||t.includes(`eos`)||t.includes(`ceos`)||t.includes(`veos`)?`arista`:t.includes(`cisco`)||t.includes(`ios`)||t.includes(`nxos`)||t.includes(`csr`)||t.includes(`c8k`)||t.includes(`iosxr`)?`cisco`:t.includes(`linux`)||t.includes(`ubuntu`)||t.includes(`debian`)||t.includes(`alpine`)||t.includes(`rocky`)||t.includes(`centos`)?`linux`:`unknown`:`unknown`},[]),c=(0,P.useMemo)(()=>{if(!e||!Array.isArray(e.nodes)||e.nodes.length===0)return{nodes:[],edges:[]};let t=Math.max(1,Math.ceil(Math.sqrt(e.nodes.length)));return{nodes:e.nodes.map((e,n)=>{let r=n%t,i=Math.floor(n/t),a=String(e.kind??``),o=s(a),c=o===`linux`?`client`:o===`arista`||o===`cisco`?`switch`:`server`,l=String(e.status??`unknown`),u=String(e.pingIp??e.mgmtIp??``),d=String(e.mgmtHost??``);return{id:String(e.id),position:{x:r*240,y:i*160},data:{label:String(e.label??e.id),icon:c,status:l,ip:u,mgmtHost:d,kind:a,vendor:o},type:`custom`}}),edges:(e.edges??[]).map(e=>({id:String(e.id),source:String(e.source),target:String(e.target),label:e.label?String(e.label):void 0,animated:!1}))}},[e,s]),[l,u,d]=wt(c.nodes),[f,p,h]=yt(c.edges),g=(0,P.useRef)(null),{downloadImage:_}=Qc(),[v,y]=(0,P.useState)(null),[b,x]=(0,P.useState)(null),[S,ee]=(0,P.useState)(null),[C,te]=(0,P.useState)(null),[w,T]=(0,P.useState)(null),[ne,D]=(0,P.useState)(null),[re,O]=(0,P.useState)(!1),[ie,ae]=(0,P.useState)(!1),[oe,se]=(0,P.useState)(!1),[ce,le]=(0,P.useState)(null),[ue,de]=(0,P.useState)({}),fe=(0,P.useRef)(null),pe=(0,P.useRef)({}),me=(0,P.useRef)(!1),[k,he]=(0,P.useState)(``),[_e,ve]=(0,P.useState)(`grid`),ye=(0,P.useMemo)(()=>!t||!n?``:`skyforge.topology.positions.${t}.${n}`,[n,t]),[be,xe]=(0,P.useState)(()=>({})),[Se,Ce]=(0,P.useState)(null),[we,Te]=(0,P.useState)(!1),[Ee,De]=(0,P.useState)(null),[A,Oe]=(0,P.useState)(!1),[ke,Ae]=(0,P.useState)(!1),[je,Me]=(0,P.useState)(null),[j,Ne]=(0,P.useState)({side:`source`,duration:`10`,packets:`2500`,snaplen:`192`}),[Pe,Fe]=(0,P.useState)(!1),[Ie,Le]=(0,P.useState)(null),[M,Re]=(0,P.useState)({delayMs:``,jitterMs:``,lossPct:``,dupPct:``,corruptPct:``,reorderPct:``,rateKbps:``});(0,P.useEffect)(()=>{if(ye)try{let e=window.localStorage.getItem(ye);if(!e)return;let t=JSON.parse(e);t&&typeof t==`object`&&xe(t)}catch{}},[ye]);let ze=!!(t&&n);$c(t??``,n??``,ze);let Be=r({queryKey:t&&n?W.deploymentUIEvents(t,n):[`deploymentUIEvents`,`none`],queryFn:async()=>({cursor:0,events:[]}),initialData:{cursor:0,events:[]},staleTime:1/0,enabled:ze}),Ve=(0,P.useMemo)(()=>il(Be.data?.events??[]),[Be.data?.events]);(0,P.useEffect)(()=>{u(ol(c.nodes,_e,be,k)),pe.current=Object.fromEntries(c.edges.map(e=>[String(e.id),typeof e.label==`string`?e.label:void 0])),p(al(c.edges,ue,oe,pe.current,Ve))},[c.edges,c.nodes,Ve,ue,_e,be,k,p,u,oe]),(0,P.useEffect)(()=>{p(e=>al(e,ue,oe,pe.current,Ve))},[Ve,ue,p,oe]),(0,P.useEffect)(()=>{if(!t||!n||me.current)return;let e=new URLSearchParams(window.location.search),r=e.get(`node`)?.trim(),i=e.get(`action`)?.trim();if(!r||!i){me.current=!0;return}i===`terminal`&&y({id:r}),i===`logs`&&x({id:r}),i===`describe`&&ee({id:r}),i===`interfaces`&&(Ce({id:r}),Te(!0)),i===`running-config`&&(De({id:r}),Oe(!0)),me.current=!0,e.delete(`node`),e.delete(`action`);let a=e.toString(),o=`${window.location.pathname}${a?`?${a}`:``}${window.location.hash||``}`;window.history.replaceState(null,``,o)},[n,t]),(0,P.useEffect)(()=>{if(!C)return;let e=()=>te(null),t=e=>{e.key===`Escape`&&te(null)};return window.addEventListener(`click`,e),window.addEventListener(`keydown`,t),()=>{window.removeEventListener(`click`,e),window.removeEventListener(`keydown`,t)}},[C]);let He=m({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return Ri(t,n,e)},onSuccess:(e,t)=>{if(e?.skipped){N.message(`Save config skipped`,{description:e.message||`Node ${t}`});return}N.success(`Save config queued/applied`,{description:e.stdout||`Node ${t}`})},onError:e=>{N.error(`Save config failed`,{description:e?.message??String(e)})}}),Ue=m({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return ji(t,n,e)},onSuccess:e=>{let t=e.results.filter(e=>e.error);if(t.length){N.error(`Link admin applied with errors`,{description:t.map(e=>`${e.node}: ${e.error}`).join(`; `)});return}N.success(`Link ${e.action} applied`)},onError:e=>N.error(`Link admin failed`,{description:e?.message??String(e)})}),We=m({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return Mi(t,n,e)},onSuccess:e=>{N.success(`Pcap captured`,{description:`${e.sizeBytes} bytes  ${e.artifactKey}`})},onError:e=>N.error(`Pcap capture failed`,{description:e?.message??String(e)})}),Ge=m({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return Ni(t,n,e)},onError:e=>N.error(`Failed to load interfaces`,{description:e?.message??String(e)})}),Ke=m({mutationFn:async e=>{if(!t||!n)throw Error(`missing workspace/deployment`);return Pi(t,n,e)},onError:e=>N.error(`Failed to load running config`,{description:e?.message??String(e)})}),qe=(0,P.useCallback)(async e=>{if(!t)return;let n=await ua(t,e),r=String(n?.fileData??``);if(!r)throw Error(`missing fileData`);let i=Uint8Array.from(atob(r),e=>e.charCodeAt(0)),a=new Blob([i],{type:`application/vnd.tcpdump.pcap`}),o=URL.createObjectURL(a),s=document.createElement(`a`);s.href=o,s.download=e.split(`/`).pop()||`capture.pcap`,s.click(),URL.revokeObjectURL(o)},[t]),Je=(0,P.useCallback)(async()=>{if(!t||!n)return;let e=await Fi(t,n,`csv`),r=String(e.csv??``);if(!r.trim())throw Error(`empty inventory csv`);let i=new Blob([r],{type:`text/csv`}),a=URL.createObjectURL(i),o=document.createElement(`a`);o.href=a,o.download=`${n}-inventory.csv`,o.click(),URL.revokeObjectURL(a)},[n,t]);(0,P.useEffect)(()=>{if(!w)return;let e=()=>T(null),t=e=>{e.key===`Escape`&&T(null)};return window.addEventListener(`click`,e),window.addEventListener(`keydown`,t),()=>{window.removeEventListener(`click`,e),window.removeEventListener(`keydown`,t)}},[w]),(0,P.useEffect)(()=>{we&&Se?.id&&Ge.mutate(Se.id)},[Ge,Se?.id,we]),(0,P.useEffect)(()=>{if(!we||!Pe||!Se?.id)return;let e=window.setInterval(()=>{Ge.mutate(Se.id)},2e3);return()=>window.clearInterval(e)},[Ge,Pe,Se?.id,we]),(0,P.useEffect)(()=>{A&&Ee?.id&&Ke.mutate(Ee.id)},[Ke,Ee?.id,A]);let Ye=(0,P.useCallback)(e=>p(t=>Gt(e,t)),[p]),Xe=(0,P.useCallback)((e,r)=>{if(e.preventDefault(),!t||!n)return;let i=g.current?.getBoundingClientRect();T({x:i?e.clientX-i.left:e.clientX,y:i?e.clientY-i.top:e.clientY,node:r})},[n,t]),Ze=(0,P.useCallback)((e,r)=>{if(!t||!n)return;e.preventDefault();let i=g.current?.getBoundingClientRect();te({x:i?e.clientX-i.left:e.clientX,y:i?e.clientY-i.top:e.clientY,edge:r})},[n,t]),Qe=(0,P.useCallback)(async(e,r)=>{if(!(!t||!n))try{ae(!0);let i={edgeId:r,action:e};if(e===`set`){let e=M.delayMs.trim()?Number(M.delayMs.trim()):void 0,t=M.jitterMs.trim()?Number(M.jitterMs.trim()):void 0,n=M.lossPct.trim()?Number(M.lossPct.trim()):void 0,r=M.dupPct.trim()?Number(M.dupPct.trim()):void 0,a=M.corruptPct.trim()?Number(M.corruptPct.trim()):void 0,o=M.reorderPct.trim()?Number(M.reorderPct.trim()):void 0,s=M.rateKbps.trim()?Number(M.rateKbps.trim()):void 0;Number.isFinite(e)&&(i.delayMs=e),Number.isFinite(t)&&(i.jitterMs=t),Number.isFinite(n)&&(i.lossPct=n),Number.isFinite(r)&&(i.dupPct=r),Number.isFinite(a)&&(i.corruptPct=a),Number.isFinite(o)&&(i.reorderPct=o),Number.isFinite(s)&&(i.rateKbps=s)}let a=(await Ai(t,n,i)).results.filter(e=>e.error);a.length?N.error(`Link impairment applied with errors`,{description:a.map(e=>`${e.node}: ${e.error}`).join(`; `)}):N.success(e===`clear`?`Link impairment cleared`:`Link impairment applied`)}catch(e){N.error(`Failed to apply link impairment`,{description:e?.message??String(e)})}finally{ae(!1)}},[n,M.corruptPct,M.delayMs,M.dupPct,M.jitterMs,M.lossPct,M.rateKbps,M.reorderPct,t]);return(0,P.useEffect)(()=>{if(!oe||!t||!n)return;le(null),fe.current=null;let e=`/api/workspaces/${encodeURIComponent(t)}/deployments/${encodeURIComponent(n)}/links/stats/events`,r=new EventSource(e,{withCredentials:!0}),i=e=>{try{let t=JSON.parse(String(e.data??`{}`));if(t.type===`error`){le(t.error||`failed to stream link stats`);return}if(t.type!==`snapshot`||!t.snapshot)return;let n=t.snapshot,r=Date.parse(n.generatedAt||``);if(!Number.isFinite(r))return;let i={};for(let e of n.edges??[])i[String(e.edgeId)]=e;let a=fe.current;if(fe.current={atMs:r,byEdge:i},!a)return;let o=(r-a.atMs)/1e3;if(!(o>0))return;let s={};for(let[e,t]of Object.entries(i)){let n=a.byEdge[e];if(!n)continue;let r=(e,t)=>Math.max(0,e-t),i=r(t.sourceTxBytes,n.sourceTxBytes),c=r(t.sourceRxBytes,n.sourceRxBytes),l=r(t.targetTxBytes,n.targetTxBytes),u=r(t.targetRxBytes,n.targetRxBytes),d=Math.max(i,u)+Math.max(l,c),f=r(t.sourceTxPackets,n.sourceTxPackets),p=r(t.sourceRxPackets,n.sourceRxPackets),m=r(t.targetTxPackets,n.targetTxPackets),h=r(t.targetRxPackets,n.targetRxPackets),g=(Math.max(f,h)+Math.max(m,p))/o,_=(r(t.sourceRxDropped,n.sourceRxDropped)+r(t.sourceTxDropped,n.sourceTxDropped)+r(t.targetRxDropped,n.targetRxDropped)+r(t.targetTxDropped,n.targetTxDropped))/o;s[e]={bps:d*8/o,pps:g,drops:_}}de(s)}catch(e){le(e?.message??String(e))}};return r.addEventListener(`stats`,i),r.onerror=()=>le(`link stats stream disconnected`),zi(t,n).catch(()=>{}),()=>{r.removeEventListener(`stats`,i),r.close()}},[n,oe,t]),(0,I.jsxs)(`div`,{className:`w-full bg-background/50 overflow-hidden relative ${a?`h-full`:`h-[600px]`} border rounded-xl ${o??``}`,ref:g,children:[(0,I.jsxs)(hn,{nodes:l,edges:f,onNodesChange:d,onEdgesChange:h,onConnect:Ye,onNodeContextMenu:Xe,onEdgeContextMenu:Ze,onEdgeMouseEnter:(e,t)=>{let n=g.current?.getBoundingClientRect(),r=n?e.clientX-n.left:e.clientX,i=n?e.clientY-n.top:e.clientY;Le({id:String(t.id),x:r,y:i})},onEdgeMouseMove:e=>{if(!Ie)return;let t=g.current?.getBoundingClientRect(),n=t?e.clientX-t.left:e.clientX,r=t?e.clientY-t.top:e.clientY;Le(e=>e?{...e,x:n,y:r}:null)},onEdgeMouseLeave:()=>Le(null),onNodeDragStop:(e,t)=>{ye&&xe(e=>{let n={...e,[String(t.id)]:{x:t.position.x,y:t.position.y}};try{window.localStorage.setItem(ye,JSON.stringify(n))}catch{}return n})},nodeTypes:el,fitView:!0,className:`bg-muted/10`,children:[(0,I.jsx)(Ht,{position:`top-right`,children:(0,I.jsxs)(z,{className:`shadow-sm border bg-background/85 backdrop-blur`,children:[(0,I.jsx)(B,{className:`p-3 pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`Tools`})}),(0,I.jsxs)(U,{className:`p-3 pt-0 space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2 rounded-md border bg-background/70 px-2 py-1`,children:[(0,I.jsx)(an,{className:`h-4 w-4 text-muted-foreground`}),(0,I.jsx)(J,{value:k,onChange:e=>he(e.target.value),placeholder:`Search nodes`,className:`h-7 w-56 border-0 bg-transparent p-0 text-sm focus-visible:ring-0`}),k.trim()?(0,I.jsx)(L,{variant:`ghost`,size:`sm`,className:`h-7 px-2`,onClick:()=>he(``),children:`Clear`}):null]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsxs)(L,{variant:oe?`default`:`outline`,size:`sm`,onClick:()=>{se(e=>{let t=!e;return t||(le(null),de({}),fe.current=null),t})},disabled:!t||!n,title:`Show live link utilization (SSE)`,children:[(0,I.jsx)(ge,{className:`mr-2 h-4 w-4`}),`Live stats`]}),(0,I.jsxs)(L,{variant:`outline`,size:`sm`,onClick:()=>ve(e=>e===`grid`?`circle`:`grid`),title:`Toggle layout`,children:[(0,I.jsx)(Ut,{className:`mr-2 h-4 w-4`}),_e===`grid`?`Grid`:`Circle`]}),(0,I.jsx)(L,{variant:`outline`,size:`sm`,onClick:()=>{if(xe({}),ye)try{window.localStorage.removeItem(ye)}catch{}},title:`Reset pinned node positions`,children:`Reset`}),(0,I.jsx)(L,{variant:`outline`,size:`sm`,onClick:()=>Je().catch(e=>N.error(`Failed to download inventory`,{description:e.message})),disabled:!t||!n,title:`Download inventory CSV`,children:`Inventory`}),(0,I.jsxs)(L,{variant:`outline`,size:`sm`,onClick:()=>g.current&&_(g.current,`topology.png`),children:[(0,I.jsx)(E,{className:`mr-2 h-4 w-4`}),`PNG`]})]}),(0,I.jsx)(`div`,{className:`text-[11px] text-muted-foreground`,children:`Tip: Right-click a node or link for actions.`})]})]})}),(0,I.jsx)(Xt,{}),(0,I.jsx)(gt,{zoomable:!0,pannable:!0,className:`bg-background border rounded-lg`}),(0,I.jsx)(ut,{gap:12,size:1})]}),oe&&ce?(0,I.jsxs)(`div`,{className:`absolute bottom-2 left-2 z-40 rounded-md border bg-background/90 px-3 py-2 text-xs text-muted-foreground shadow-sm`,children:[`Live stats: `,ce]}):null,Ie&&oe&&ue[Ie.id]?(0,I.jsxs)(`div`,{className:`absolute z-40 rounded-md border bg-background/90 px-3 py-2 text-xs shadow-sm`,style:{left:Ie.x+12,top:Ie.y+12},children:[(0,I.jsx)(`div`,{className:`font-mono`,children:Ie.id}),(0,I.jsxs)(`div`,{className:`text-muted-foreground`,children:[nl(ue[Ie.id].bps),` `,` `,Math.round(ue[Ie.id].pps),` pps `,` `,ue[Ie.id].drops.toFixed(1),` drops/s`]})]}):null,ze&&(Be.data?.events?.length??0)>0?(0,I.jsx)(`div`,{className:`absolute bottom-2 right-2 z-40 w-[420px] max-w-[92vw]`,children:(0,I.jsxs)(z,{className:`shadow-sm border bg-background/90 backdrop-blur`,children:[(0,I.jsx)(B,{className:`p-3 pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`Recent activity`})}),(0,I.jsx)(U,{className:`p-3 pt-0 space-y-2`,children:(Be.data?.events??[]).slice(-8).reverse().map(e=>(0,I.jsxs)(`div`,{className:`flex items-start justify-between gap-2 text-xs`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-mono truncate`,children:e.eventType}),(0,I.jsx)(`div`,{className:`text-muted-foreground truncate`,children:e.createdAt})]}),(0,I.jsx)(`div`,{className:`text-muted-foreground font-mono truncate`,children:e.createdBy?e.createdBy:``})]},String(e.id)))})]})}):null,i&&t&&n?(0,I.jsx)(Zc,{open:!!v,onOpenChange:e=>{e||y(null)},workspaceId:t,deploymentId:n,nodeId:v?.id??``,nodeKind:v?.kind??``}):null,t&&n?(0,I.jsx)(qc,{open:!!b,onOpenChange:e=>{e||x(null)},workspaceId:t,deploymentId:n,nodeId:b?.id??``,nodeKind:b?.kind??``,nodeIp:b?.ip??``}):null,t&&n?(0,I.jsx)(Gc,{open:!!S,onOpenChange:e=>{e||ee(null)},workspaceId:t,deploymentId:n,nodeId:S?.id??``,nodeKind:S?.kind??``,nodeIp:S?.ip??``}):null,(0,I.jsx)(Kn,{open:we,onOpenChange:e=>{Te(e),e||Ce(null)},children:(0,I.jsxs)(Yn,{className:`max-w-3xl`,children:[(0,I.jsx)(Xn,{children:(0,I.jsx)(Qn,{children:`Interfaces`})}),(0,I.jsx)(sl,{node:Se?.id??``,data:Ge.data,loading:Ge.isPending,error:Ge.isError?Ge.error?.message??`failed`:``,autoRefresh:Pe,onToggleAutoRefresh:()=>Fe(e=>!e)})]})}),(0,I.jsx)(Kn,{open:A,onOpenChange:e=>{Oe(e),e||De(null)},children:(0,I.jsxs)(Yn,{className:`max-w-4xl`,children:[(0,I.jsx)(Xn,{children:(0,I.jsx)(Qn,{children:`Running config`})}),(0,I.jsx)(cl,{node:Ee?.id??``,data:Ke.data,loading:Ke.isPending,error:Ke.isError?Ke.error?.message??`failed`:``})]})}),w&&t&&n?(0,I.jsx)(`div`,{className:`absolute z-50`,style:{left:w.x,top:w.y},onContextMenu:e=>e.preventDefault(),children:(0,I.jsxs)(z,{className:`w-64 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,I.jsxs)(B,{className:`p-3 pb-2`,children:[(0,I.jsx)(V,{className:`text-sm`,children:`Node Actions`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:String(w.node?.data?.label??w.node.id)})]}),(0,I.jsxs)(U,{className:`p-3 pt-0 space-y-2`,children:[(0,I.jsx)(L,{size:`sm`,className:`w-full`,disabled:!i,onClick:()=>{let e=String(w.node?.data?.kind??``);T(null),y({id:String(w.node.id),kind:e})},children:`Open terminal`}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,className:`w-full`,disabled:!i,onClick:()=>{let e=String(w.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=terminal`;window.open(t,`_blank`,`noopener,noreferrer`),T(null)},children:`Open terminal (new tab)`}),(0,I.jsx)(L,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(w.node?.data?.kind??``),t=String(w.node?.data?.ip??``);T(null),x({id:String(w.node.id),kind:e,ip:t})},children:`View logs`}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(w.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=logs`;window.open(t,`_blank`,`noopener,noreferrer`),T(null)},children:`View logs (new tab)`}),(0,I.jsx)(L,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(w.node?.data?.kind??``),t=String(w.node?.data?.ip??``);T(null),ee({id:String(w.node.id),kind:e,ip:t})},children:`Describe`}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(w.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=describe`;window.open(t,`_blank`,`noopener,noreferrer`),T(null)},children:`Describe (new tab)`}),(0,I.jsx)(L,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(w.node?.data?.kind??``),t=String(w.node?.data?.ip??``),n=String(w.node.id);T(null),Ce({id:n,kind:e,ip:t}),Te(!0)},children:`Interfaces`}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(w.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=interfaces`;window.open(t,`_blank`,`noopener,noreferrer`),T(null)},children:`Interfaces (new tab)`}),(0,I.jsx)(L,{size:`sm`,variant:`secondary`,className:`w-full`,disabled:He.isPending,onClick:()=>{let e=String(w.node.id);T(null),He.mutate(e)},children:He.isPending?`Saving`:`Save config`}),(0,I.jsx)(L,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(w.node.id);T(null),De({id:e}),Oe(!0)},children:`Running config`}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(w.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=running-config`;window.open(t,`_blank`,`noopener,noreferrer`),T(null)},children:`Running config (new tab)`}),(0,I.jsx)(L,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>{let e=String(w.node?.data?.ip??``).trim();if(!e){N.error(`No management IP available`);return}navigator.clipboard?.writeText(e),N.success(`Copied management IP`),T(null)},children:`Copy management IP`}),(0,I.jsx)(L,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>{let e=String(w.node.id);navigator.clipboard?.writeText(e),N.success(`Copied node name`),T(null)},children:`Copy node name`}),(0,I.jsx)(L,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>{let e=String(w.node?.data?.ip??``).trim();if(!e){N.error(`No management IP available`);return}let t=`ssh admin@${e}`;navigator.clipboard?.writeText(t),N.success(`Copied SSH command`),T(null)},children:`Copy SSH command`}),(0,I.jsx)(L,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>T(null),children:`Close`})]})]})}):null,C&&t&&n?(0,I.jsx)(`div`,{className:`absolute z-50`,style:{left:C.x,top:C.y},onContextMenu:e=>e.preventDefault(),children:(0,I.jsxs)(z,{className:`w-64 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,I.jsxs)(B,{className:`p-3 pb-2`,children:[(0,I.jsx)(V,{className:`text-sm`,children:`Link Actions`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:String(C.edge.label??C.edge.id)})]}),(0,I.jsxs)(U,{className:`p-3 pt-0 space-y-2`,children:[(0,I.jsx)(L,{size:`sm`,variant:Ve.edgeDown.has(String(C.edge.id))?`secondary`:`destructive`,className:`w-full`,disabled:Ue.isPending,onClick:()=>{let e=String(C.edge.id),t=Ve.edgeDown.has(e);te(null),Ue.mutate({edgeId:e,action:t?`up`:`down`})},children:Ve.edgeDown.has(String(C.edge.id))?`Bring link up`:`Bring link down`}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,className:`w-full`,disabled:We.isPending,onClick:()=>{Me({id:String(C.edge.id),label:String(C.edge.label??``)}),te(null),Ae(!0)},children:`Capture pcap`}),Ve.lastCaptureByEdge[String(C.edge.id)]?(0,I.jsx)(L,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=Ve.lastCaptureByEdge[String(C.edge.id)];te(null),qe(e).catch(e=>N.error(`Failed to download pcap`,{description:e.message}))},children:`Download last pcap`}):null,(0,I.jsx)(L,{size:`sm`,className:`w-full`,onClick:()=>{D({id:String(C.edge.id),label:String(C.edge.label??``)}),te(null),O(!0)},children:`Configure impairment`}),(0,I.jsx)(L,{size:`sm`,variant:`secondary`,className:`w-full`,disabled:ie,onClick:()=>{let e=String(C.edge.id);te(null),Qe(`clear`,e)},children:`Clear impairment`}),(0,I.jsx)(L,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>te(null),children:`Close`})]})]})}):null,(0,I.jsx)(Kn,{open:ke,onOpenChange:e=>{Ae(e),e||Me(null)},children:(0,I.jsxs)(Yn,{className:`max-w-lg`,children:[(0,I.jsx)(Xn,{children:(0,I.jsx)(Qn,{children:`Capture pcap`})}),(0,I.jsxs)(`div`,{className:`space-y-4`,children:[je?.label?(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:je.label}):null,(0,I.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`capSide`,children:`Side`}),(0,I.jsxs)(`select`,{id:`capSide`,className:`h-9 w-full rounded-md border bg-background px-3 text-sm`,value:j.side,onChange:e=>Ne(t=>({...t,side:e.target.value})),children:[(0,I.jsx)(`option`,{value:`source`,children:`Source`}),(0,I.jsx)(`option`,{value:`target`,children:`Target`})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`capDuration`,children:`Duration (s)`}),(0,I.jsx)(J,{id:`capDuration`,inputMode:`numeric`,value:j.duration,onChange:e=>Ne(t=>({...t,duration:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`capPackets`,children:`Max packets`}),(0,I.jsx)(J,{id:`capPackets`,inputMode:`numeric`,value:j.packets,onChange:e=>Ne(t=>({...t,packets:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`capSnaplen`,children:`Snaplen`}),(0,I.jsx)(J,{id:`capSnaplen`,inputMode:`numeric`,value:j.snaplen,onChange:e=>Ne(t=>({...t,snaplen:e.target.value}))})]})]}),(0,I.jsxs)(`div`,{className:`flex gap-2 justify-end`,children:[(0,I.jsx)(L,{variant:`secondary`,onClick:()=>Ae(!1),disabled:We.isPending,children:`Cancel`}),(0,I.jsx)(L,{onClick:()=>{let e=String(je?.id??``);if(!e){N.error(`No link selected`);return}let t=Number(j.duration.trim()||`10`),n=Number(j.packets.trim()||`2500`),r=Number(j.snaplen.trim()||`192`);We.mutateAsync({edgeId:e,side:j.side,durationSeconds:t,maxPackets:n,snaplen:r}).then(e=>(N.success(`Pcap ready`,{description:e.artifactKey}),qe(e.artifactKey).catch(()=>{}))).finally(()=>Ae(!1))},disabled:We.isPending,children:We.isPending?`Capturing`:`Capture`})]})]})]})}),(0,I.jsx)(Kn,{open:re,onOpenChange:e=>{O(e),e||D(null)},children:(0,I.jsxs)(Yn,{className:`max-w-lg`,children:[(0,I.jsx)(Xn,{children:(0,I.jsx)(Qn,{children:`Configure Link Impairment`})}),(0,I.jsxs)(`div`,{className:`space-y-4`,children:[ne?.label?(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:ne.label}):null,(0,I.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`delayMs`,children:`Delay (ms)`}),(0,I.jsx)(J,{id:`delayMs`,inputMode:`numeric`,placeholder:`e.g. 50`,value:M.delayMs,onChange:e=>Re(t=>({...t,delayMs:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`jitterMs`,children:`Jitter (ms)`}),(0,I.jsx)(J,{id:`jitterMs`,inputMode:`numeric`,placeholder:`e.g. 10`,value:M.jitterMs,onChange:e=>Re(t=>({...t,jitterMs:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`lossPct`,children:`Loss (%)`}),(0,I.jsx)(J,{id:`lossPct`,inputMode:`decimal`,placeholder:`e.g. 1.0`,value:M.lossPct,onChange:e=>Re(t=>({...t,lossPct:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`dupPct`,children:`Duplicate (%)`}),(0,I.jsx)(J,{id:`dupPct`,inputMode:`decimal`,placeholder:`e.g. 0.1`,value:M.dupPct,onChange:e=>Re(t=>({...t,dupPct:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`corruptPct`,children:`Corrupt (%)`}),(0,I.jsx)(J,{id:`corruptPct`,inputMode:`decimal`,placeholder:`e.g. 0.05`,value:M.corruptPct,onChange:e=>Re(t=>({...t,corruptPct:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`reorderPct`,children:`Reorder (%)`}),(0,I.jsx)(J,{id:`reorderPct`,inputMode:`decimal`,placeholder:`e.g. 0.2`,value:M.reorderPct,onChange:e=>Re(t=>({...t,reorderPct:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`rateKbps`,children:`Rate (kbit/s)`}),(0,I.jsx)(J,{id:`rateKbps`,inputMode:`numeric`,placeholder:`e.g. 100000`,value:M.rateKbps,onChange:e=>Re(t=>({...t,rateKbps:e.target.value}))})]})]}),(0,I.jsxs)(`div`,{className:`flex gap-2 justify-end`,children:[(0,I.jsx)(L,{variant:`secondary`,onClick:()=>O(!1),disabled:ie,children:`Cancel`}),(0,I.jsx)(L,{onClick:()=>{let e=String(ne?.id??``);if(!e){N.error(`No link selected`);return}Qe(`set`,e).finally(()=>O(!1))},disabled:ie,children:`Apply`})]})]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Tip: Right-click a link in the topology to configure impairment.`})]})})]})}function nl(e){return e>0?e>=1e9?`${(e/1e9).toFixed(2)} Gbps`:e>=1e6?`${(e/1e6).toFixed(1)} Mbps`:e>=1e3?`${(e/1e3).toFixed(0)} Kbps`:`${Math.round(e)} bps`:`0 bps`}function rl(e){if(!Number.isFinite(e)||e<=0)return`0 B`;let t=[`B`,`KB`,`MB`,`GB`,`TB`],n=e,r=0;for(;n>=1024&&r<t.length-1;)n/=1024,r++;let i=r===0||r===1?0:1;return`${n.toFixed(i)} ${t[r]}`}function il(e){let t=new Set,n={};for(let r of e??[]){let e=String(r?.eventType??``),i=r?.payload??{},a=String(i?.edgeId??``).trim();if(a&&(e===`link.down`&&t.add(a),e===`link.up`&&t.delete(a),e===`link.capture`)){let e=String(i?.artifactKey??``).trim();e&&(n[a]=e)}}return{edgeDown:t,lastCaptureByEdge:n}}function al(e,t,n,r,i){return e.map(e=>{let a=String(e.id),o=r[a]??(typeof e.label==`string`?e.label:void 0),s=i.edgeDown.has(a);if(!n)return{...e,label:s?o?`${o}  DOWN`:`DOWN`:o,animated:!1,style:s?{stroke:`hsl(var(--destructive))`,strokeWidth:2,strokeDasharray:`6 6`}:void 0};let c=t[a];if(!c)return{...e,label:s?o?`${o}  DOWN`:`DOWN`:o,animated:!1,style:s?{stroke:`hsl(var(--destructive))`,strokeWidth:2,strokeDasharray:`6 6`}:void 0};let l=c.bps??0,u=1+Math.min(9,Math.log10(Math.max(1,l))/1.2),d=o?`${o}  ${nl(l)}`:nl(l),f=s?`${d}  DOWN`:d;return{...e,label:f,animated:!s&&l>0,style:{...e.style??{},strokeWidth:u,...s?{stroke:`hsl(var(--destructive))`,strokeDasharray:`6 6`}:{}}}})}function ol(e,t,n,r){let i=r.trim().toLowerCase(),a=new Set;if(i)for(let t of e){let e=String(t?.data?.label??t.id).toLowerCase(),n=String(t.id).toLowerCase(),r=String(t?.data?.ip??``).toLowerCase();(e.includes(i)||n.includes(i)||r.includes(i))&&a.add(String(t.id))}let o=e.length||1,s=Math.max(260,o*30);return e.map((e,r)=>{let c=String(e.id),l=n[c],u=l??e.position;if(!l&&t===`circle`){let e=r/o*Math.PI*2;u={x:Math.cos(e)*s,y:Math.sin(e)*s}}let d=i?a.has(c):!1,f=i?!a.has(c):!1;return{...e,position:u,data:{...e.data,highlight:d},style:f?{...e.style??{},opacity:.25}:e.style}})}function sl(e){if(e.loading)return(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading`});if(e.error)return(0,I.jsx)(`div`,{className:`text-sm text-destructive`,children:e.error});let t=e.data?.interfaces??[];return t.length?(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:e.node}),(0,I.jsx)(L,{size:`sm`,variant:e.autoRefresh?`default`:`outline`,onClick:e.onToggleAutoRefresh,children:e.autoRefresh?`Auto refresh: on`:`Auto refresh: off`})]}),(0,I.jsx)(`div`,{className:`rounded-md border overflow-auto max-h-[60vh]`,children:(0,I.jsxs)(`table`,{className:`w-full text-xs`,children:[(0,I.jsx)(`thead`,{className:`bg-muted/50 sticky top-0`,children:(0,I.jsxs)(`tr`,{children:[(0,I.jsx)(`th`,{className:`text-left p-2`,children:`Interface`}),(0,I.jsx)(`th`,{className:`text-left p-2`,children:`Peer`}),(0,I.jsx)(`th`,{className:`text-left p-2`,children:`State`}),(0,I.jsx)(`th`,{className:`text-right p-2`,children:`RX`}),(0,I.jsx)(`th`,{className:`text-right p-2`,children:`TX`}),(0,I.jsx)(`th`,{className:`text-right p-2`,children:`Drops`})]})}),(0,I.jsx)(`tbody`,{children:t.map(e=>(0,I.jsxs)(`tr`,{className:`border-t`,children:[(0,I.jsx)(`td`,{className:`p-2 font-mono`,children:e.ifName}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-muted-foreground`,children:e.peerNode?`${e.peerNode}:${e.peerIf??``}`:``}),(0,I.jsx)(`td`,{className:`p-2`,children:e.operState??``}),(0,I.jsx)(`td`,{className:`p-2 text-right font-mono`,children:rl(Number(e.rxBytes??0))}),(0,I.jsx)(`td`,{className:`p-2 text-right font-mono`,children:rl(Number(e.txBytes??0))}),(0,I.jsx)(`td`,{className:`p-2 text-right font-mono`,children:Number(e.rxDropped??0)+Number(e.txDropped??0)})]},e.ifName))})]})})]}):(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No interfaces found.`})}function cl(e){if(e.loading)return(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading`});if(e.error)return(0,I.jsx)(`div`,{className:`text-sm text-destructive`,children:e.error});if(e.data?.skipped)return(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:e.data.message||`Skipped`});let t=String(e.data?.stdout??``);return(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:e.node}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(t),N.success(`Copied running config`)},disabled:!t,children:`Copy`})]}),(0,I.jsx)(`pre`,{className:`max-h-[65vh] overflow-auto rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100 whitespace-pre-wrap`,children:t||`No output`}),e.data?.stderr?(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground whitespace-pre-wrap`,children:e.data.stderr}):null]})}const ll=t(`/dashboard/labs/map`)({component:dl});function ul(e){let t=Wn.parse(String(e??``))?.topology??{},n=t?.nodes??{},r=Object.entries(n).map(([e,t])=>{let n=String(t?.kind??``);return{id:String(e),label:String(e),kind:n,status:`unknown`,mgmtIp:``}}),i=[],a=Array.isArray(t?.links)?t.links:[];for(let e=0;e<a.length;e++){let t=a[e],n=Array.isArray(t?.endpoints)?t.endpoints:[];if(n.length!==2)continue;let r=String(n[0]??``),o=String(n[1]??``),s=r.split(`:`)[0],c=o.split(`:`)[0];!s||!c||i.push({id:`e${e+1}`,source:s,target:c,label:`${r}  ${o}`})}return{nodes:r,edges:i}}function dl(){let e=ll.useSearch(),t=String(e?.workspaceId??``),n=String(e?.source??`workspace`),i=String(e?.dir??`containerlab/designer`),a=String(e?.file??``),o=r({queryKey:W.workspaces(),queryFn:Mr,retry:!1,staleTime:3e4}),s=r({queryKey:t?[`containerlabTemplateMap`,t,n,i,a]:[`containerlabTemplateMap`,`none`],queryFn:async()=>{if(!t)throw Error(`workspaceId is required`);if(!a)throw Error(`file is required`);return Gi(t,{source:n,dir:i,file:a})},enabled:!!t&&!!a,retry:!1,staleTime:3e4}),c=(0,P.useMemo)(()=>{if(!s.data?.yaml)return null;try{return ul(s.data.yaml)}catch{return null}},[s.data?.yaml]);return!t||!a?(0,I.jsx)(`div`,{className:`h-screen w-screen p-6`,children:(0,I.jsxs)(`div`,{className:`max-w-2xl space-y-4`,children:[(0,I.jsx)(`div`,{className:`text-2xl font-bold tracking-tight`,children:`Lab map`}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Open this page from the Lab Designer Open map button, or provide query params.`}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Parameters`})}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Workspace`}),(0,I.jsx)(J,{value:t,readOnly:!0,placeholder:o.isLoading?`Loading`:`workspaceId missing`})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`File`}),(0,I.jsx)(J,{value:a,readOnly:!0,placeholder:`file missing`})]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Example:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`/dashboard/labs/map?workspaceId=<id>&source=workspace&dir=containerlab/designer&file=lab.clab.yml`})]})]})]})]})}):s.isLoading||s.isFetching?(0,I.jsxs)(`div`,{className:`h-screen w-screen p-6`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(K,{className:`h-9 w-9`}),(0,I.jsx)(K,{className:`h-8 w-64`})]}),(0,I.jsx)(`div`,{className:`mt-6`,children:(0,I.jsx)(K,{className:`h-[75vh] w-full`})})]}):!s.data||!c?(0,I.jsx)(`div`,{className:`h-screen w-screen p-6`,children:(0,I.jsx)(To,{title:`Map unavailable`,description:s.isError?`Failed to load template.`:`Template YAML could not be parsed into a topology.`,action:{label:`Close`,onClick:()=>window.close()}})}):(0,I.jsxs)(`div`,{className:`h-screen w-screen flex flex-col bg-background`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3 border-b px-4 py-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3 min-w-0`,children:[(0,I.jsx)(f,{to:`/dashboard/labs/designer`,search:{},className:mr({variant:`outline`,size:`icon`,className:`h-9 w-9`}),title:`Back to designer`,children:(0,I.jsx)(ye,{className:`h-4 w-4`})}),(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-semibold truncate`,children:`Lab map`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:s.data.path})]})]}),(0,I.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,I.jsx)(L,{variant:`outline`,size:`sm`,onClick:()=>{navigator.clipboard?.writeText(s.data.yaml)},children:`Copy YAML`})})]}),(0,I.jsxs)(`div`,{className:`flex-1 min-h-0 grid grid-cols-1 lg:grid-cols-[1fr_520px]`,children:[(0,I.jsx)(`div`,{className:`min-h-0 p-3`,children:(0,I.jsx)(`div`,{className:`h-full rounded-xl border overflow-hidden`,children:(0,I.jsx)(tl,{topology:c,workspaceId:t,enableTerminal:!1,fullHeight:!0})})}),(0,I.jsx)(`div`,{className:`min-h-0 border-l bg-background p-3`,children:(0,I.jsxs)(z,{className:`h-full`,children:[(0,I.jsx)(B,{className:`pb-3`,children:(0,I.jsx)(V,{children:`YAML`})}),(0,I.jsx)(U,{className:`h-[calc(100%-56px)]`,children:(0,I.jsx)(Ps,{value:s.data.yaml,readOnly:!0,className:`h-full font-mono text-xs`})})]})})]})]})}function fl(e){let[t,n]=(0,P.useState)(``),[i,a]=(0,P.useState)(``),[o,s]=(0,P.useState)(``),c=r({queryKey:W.registryRepos(t),queryFn:async()=>ea({q:t,n:500}),retry:!1,staleTime:3e4}),l=r({queryKey:o?W.registryTags(o,i):[`registryTags`,`none`],queryFn:async()=>ta(o,{q:i}),enabled:!!o,retry:!1,staleTime:3e4}),u=(0,P.useMemo)(()=>{let t=(e.value||``).trim(),n=t.lastIndexOf(`:`);return n<=0?{repo:t,tag:``}:{repo:t.slice(0,n),tag:t.slice(n+1)}},[e.value]);return(0,I.jsxs)(`div`,{className:`space-y-3 ${e.className??``}`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Image`}),(0,I.jsx)(J,{value:e.value,onChange:t=>e.onChange(t.target.value),placeholder:`repo:tag`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:"Registry-backed picker. Requires server env `SKYFORGE_REGISTRY_URL`."})]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsx)(q,{children:`Repository`}),(0,I.jsx)(L,{size:`sm`,variant:`ghost`,onClick:()=>{u.repo&&(s(u.repo),N.message(`Repository selected`,{description:u.repo}))},children:`Use current`})]}),(0,I.jsx)(J,{value:t,onChange:e=>n(e.target.value),placeholder:`Search repos`}),(0,I.jsx)(`div`,{className:`max-h-40 overflow-auto rounded-md border`,children:c.isError?(0,I.jsx)(`div`,{className:`p-2 text-xs text-destructive`,children:`Failed to load repos.`}):c.isLoading?(0,I.jsx)(`div`,{className:`p-2 text-xs text-muted-foreground`,children:`Loading`}):(0,I.jsx)(`div`,{className:`divide-y`,children:(c.data?.repositories??[]).slice(0,200).map(e=>(0,I.jsx)(`button`,{type:`button`,className:`w-full text-left px-2 py-1.5 text-xs font-mono hover:bg-accent ${o===e?`bg-accent`:``}`,onClick:()=>s(e),children:e},e))})})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsx)(q,{children:`Tag`}),(0,I.jsx)(L,{size:`sm`,variant:`ghost`,onClick:()=>{if(!o)return;let t=`${o}:${u.tag||`latest`}`;e.onChange(t)},disabled:!o,children:`Set image`})]}),(0,I.jsx)(J,{value:i,onChange:e=>a(e.target.value),placeholder:`Search tags`,disabled:!o}),(0,I.jsx)(`div`,{className:`max-h-40 overflow-auto rounded-md border`,children:o?l.isError?(0,I.jsx)(`div`,{className:`p-2 text-xs text-destructive`,children:`Failed to load tags.`}):l.isLoading?(0,I.jsx)(`div`,{className:`p-2 text-xs text-muted-foreground`,children:`Loading`}):(0,I.jsx)(`div`,{className:`divide-y`,children:(l.data?.tags??[]).slice(0,300).map(t=>(0,I.jsx)(`button`,{type:`button`,className:`w-full text-left px-2 py-1.5 text-xs font-mono hover:bg-accent`,onClick:()=>e.onChange(`${o}:${t}`),children:t},t))}):(0,I.jsx)(`div`,{className:`p-2 text-xs text-muted-foreground`,children:`Select a repo`})})]})]})]})}function pl(e){let t=String(e??``).trim();return t&&t.toLowerCase().replace(/[^a-z0-9-]+/g,`-`).replace(/^-+|-+$/g,``).slice(0,48)||`node`}function ml(e){let t=new Set,n=new Map;for(let r of e){let e=pl(r.id||r.label||`node`),i=e,a=2;for(;t.has(i);)i=`${e}-${a++}`;t.add(i),n.set(r.id,i)}return n}function hl(e){let t=[],n=pl(e.name||`lab`),r=ml(e.nodes),i=new Map,a=e=>{let t=(i.get(e)??0)+1;return i.set(e,t),`eth${t}`},o={};for(let n of e.nodes){let e=r.get(n.id)||pl(n.id),i=String(n.id||n.label||``).trim();i&&pl(i)!==i&&t.push(`Node ${i}: name will be '${pl(i)}'`),i&&pl(i)!==e&&t.push(`Node ${i}: name adjusted to '${e}'`);let a=(n.kind||``).trim()||void 0,s=(n.image||``).trim()||void 0;s||t.push(`Node ${e}: missing image`),o[e]={...a?{kind:a}:{},...s?{image:s}:{},...n.env&&Object.keys(n.env).length?{env:n.env}:{},...n.mgmtIpv4?{mgmt_ipv4:n.mgmtIpv4}:{}}}let s=[];for(let n of e.links){let e=r.get(n.source),i=r.get(n.target);if(!e||!i){t.push(`Link ${n.id}: missing endpoint(s)`);continue}let o=a(n.source),c=a(n.target);s.push({endpoints:[`${e}:${o}`,`${i}:${c}`]})}let c={name:n,topology:{nodes:o,...s.length?{links:s}:{}}},l=(e,t=0)=>{let n=`  `.repeat(t);if(e==null)return`null`;if(typeof e==`string`)return JSON.stringify(e);if(typeof e==`number`||typeof e==`boolean`)return String(e);if(Array.isArray(e))return e.length===0?`[]`:e.map(e=>{if(typeof e==`object`&&e&&!Array.isArray(e)){let r=l(e,t+1).split(`
`);return`${n}- ${r[0].trimStart()}\n${r.slice(1).map(e=>`${n}  ${e}`).join(`
`)}`}return`${n}- ${l(e,0)}`}).join(`
`);if(typeof e==`object`){let r=Object.keys(e);return r.length===0?`{}`:r.map(r=>{let i=e[r];return i===void 0?``:typeof i==`object`&&i?`${n}${r}:\n${l(i,t+1)}`:`${n}${r}: ${l(i,0)}`}).filter(Boolean).join(`
`)}return JSON.stringify(String(e))};return{yaml:l(c,0)+`
`,warnings:t}}var gl=Ln({workspaceId:zn().optional().catch(``),importDeploymentId:zn().optional().catch(``)});const _l=t(`/dashboard/labs/designer`)({validateSearch:e=>gl.parse(e),component:Cl});var vl=`application/x-skyforge-palette-item`;function yl(e){let t=String(e??``).trim().replace(/^\/+|\/+$/g,``),n=t.toLowerCase(),r=t.split(`/`).pop()??t,i=e=>({id:`${e.kind}:${e.repo??``}`,...e});return n.includes(`endhost`)||n.includes(`linux`)||n.includes(`ubuntu`)||n.includes(`alpine`)?i({label:`Host  ${r}`,category:`Hosts`,kind:`linux`,repo:t,vendor:`Linux`,model:r,role:`host`}):r===`ceos`||n.endsWith(`/ceos`)||n.includes(`/ceos:`)?i({label:`Switch/Router  Arista cEOS`,category:`Switches`,kind:`ceos`,repo:t,vendor:`Arista`,model:`cEOS`,role:`switch`}):n.includes(`vrnetlab/cisco_iol`)?i({label:`Router  Cisco IOL (IOS)`,category:`Routers`,kind:`cisco_iol`,repo:t,vendor:`Cisco`,model:`IOL`,role:`router`}):n.includes(`vrnetlab/cisco_viosl2`)?i({label:`Switch  Cisco vIOS L2`,category:`Switches`,kind:`cisco_viosl2`,repo:t,vendor:`Cisco`,model:`vIOS L2`,role:`switch`}):n.includes(`vrnetlab/vr-n9kv`)||n.includes(`vrnetlab/nxos`)?i({label:`Switch  Cisco NX-OSv (N9Kv)`,category:`Switches`,kind:`vr-n9kv`,repo:t,vendor:`Cisco`,model:`NX-OSv9k`,role:`switch`}):n.includes(`vrnetlab/vr-vmx`)||n.includes(`/vr-vmx`)?i({label:`Router  Juniper vMX`,category:`Routers`,kind:`vr-vmx`,repo:t,vendor:`Juniper`,model:`vMX`,role:`router`}):n.includes(`vrnetlab/juniper_vjunos-router`)?i({label:`Router  Juniper vJunos Router`,category:`Routers`,kind:`juniper_vjunos-router`,repo:t,vendor:`Juniper`,model:`vJunos-router`,role:`router`}):n.includes(`vrnetlab/juniper_vjunos-switch`)?i({label:`Switch  Juniper vJunos Switch`,category:`Switches`,kind:`juniper_vjunos-switch`,repo:t,vendor:`Juniper`,model:`vJunos-switch`,role:`switch`}):n.includes(`vrnetlab/juniper_vsrx`)||n.includes(`vr-vsrx`)||n.includes(`vsrx`)||n.includes(`/srx`)?i({label:`Firewall  Juniper SRX`,category:`Firewalls`,kind:`vr-vsrx`,repo:t,vendor:`Juniper`,model:`SRX`,role:`firewall`}):n.includes(`vrnetlab/vr-fortios`)||n.includes(`fortios`)?i({label:`Firewall  Fortinet FortiOS`,category:`Firewalls`,kind:`vr-fortios`,repo:t,vendor:`Fortinet`,model:`FortiOS`,role:`firewall`}):n.includes(`vrnetlab/vr-ftosv`)||n.includes(`os10`)?i({label:`Switch  Dell OS10`,category:`Switches`,kind:`vr-ftosv`,repo:t,vendor:`Dell`,model:`OS10`,role:`switch`}):n.includes(`vrnetlab/`)&&(n.includes(`asa`)||n.includes(`pan`)||n.includes(`palo`)||n.includes(`checkpoint`))?i({label:`Firewall  ${r}`,category:`Firewalls`,kind:r,repo:t,role:`firewall`}):i({label:`Node  ${r}`,category:`Other`,kind:r,repo:t,role:`other`})}function bl(e){let t=e.item,n=t.role===`firewall`?qe:t.role===`host`?be:Ee,r=t.vendor?`${t.vendor}${t.model?`  ${t.model}`:``}`:t.label,i=t.role===`router`?`Router`:t.role===`switch`?`Switch`:t.role===`firewall`?`Firewall`:t.role===`host`?`Host`:`Node`;return(0,I.jsx)(`div`,{className:`cursor-grab select-none rounded-lg border bg-background px-3 py-2 text-sm hover:bg-accent`,draggable:!0,onDragStart:e=>{e.dataTransfer.setData(vl,JSON.stringify(t)),e.dataTransfer.effectAllowed=`copy`},title:t.repo?`${t.label}\n${t.repo}`:t.label,children:(0,I.jsxs)(`div`,{className:`flex items-start gap-2`,children:[(0,I.jsx)(n,{className:`mt-0.5 h-4 w-4 text-muted-foreground`}),(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsxs)(`div`,{className:`truncate flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`truncate`,children:r}),(0,I.jsx)(`span`,{className:`shrink-0 rounded-full bg-muted px-2 py-0.5 text-[10px] font-medium text-muted-foreground`,children:i})]}),(0,I.jsx)(`div`,{className:`truncate text-[11px] text-muted-foreground font-mono`,children:t.repo??t.kind})]})]})})}async function xl(e){let t=String(e.repo??``).trim().replace(/^\/+|\/+$/g,``);if(!t)return`latest`;try{let n=await e.queryClient.fetchQuery({queryKey:W.registryTags(t,``),queryFn:async()=>ta(t,{q:``}),retry:!1,staleTime:3e4}),r=Array.isArray(n?.tags)?n.tags:[];return r.includes(`latest`)?`latest`:r.length>0?String(r[r.length-1]):`latest`}catch{return`latest`}}function Sl(e){let t=String(e.data?.kind??``),n=String(e.data?.label??e.id),r=t.toLowerCase(),i=r.includes(`forti`)||r.includes(`vsrx`)||r.includes(`srx`)||r.includes(`asa`)||r.includes(`pan`),a=r.includes(`linux`)||r.includes(`host`),o=i?qe:a?be:Lt,s=i?`border-amber-500/60`:a?`border-emerald-500/60`:`border-sky-500/60`;return(0,I.jsxs)(`div`,{className:[`rounded-xl border bg-background/95 px-3 py-2 shadow-sm min-w-[140px]`,e.selected?`ring-2 ring-primary/60`:``,s].join(` `),children:[(0,I.jsx)(ln,{type:`target`,position:$t.Top}),(0,I.jsx)(ln,{type:`target`,position:$t.Left}),(0,I.jsx)(ln,{type:`source`,position:$t.Right}),(0,I.jsx)(ln,{type:`source`,position:$t.Bottom}),(0,I.jsxs)(`div`,{className:`flex items-start gap-2`,children:[(0,I.jsx)(`div`,{className:`mt-0.5 rounded-md border bg-muted p-1.5`,children:(0,I.jsx)(o,{className:`h-4 w-4`})}),(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-medium leading-tight truncate`,children:n}),(0,I.jsx)(`div`,{className:`text-[11px] text-muted-foreground truncate`,children:t||`node`})]})]})]})}function Cl(){let e=_l.useSearch(),t=String(e.importDeploymentId??``).trim(),n=`skyforge.labDesigner.v1`,i=(0,P.useRef)(null),a=u(),[o,s]=(0,P.useState)(`lab`),[c,l]=(0,P.useState)(``),[d,f]=(0,P.useState)(`clabernetes`),[p,h]=(0,P.useState)(``),[g,v]=(0,P.useState)(!0),[y,b]=(0,P.useState)(null),[x,S]=(0,P.useState)(`containerlab/designer`),[ee,C]=(0,P.useState)(``),[te,w]=(0,P.useState)(!0),[T,ne]=(0,P.useState)(``),[D,re]=(0,P.useState)(`all`),[O,ie]=(0,P.useState)(`all`),[ae,oe]=(0,P.useState)(null),[se,ce]=(0,P.useState)(``),[le,ue]=(0,P.useState)(!1),[de,fe]=(0,P.useState)(``),[pe,me]=(0,P.useState)(`generated`),[k,he]=(0,P.useState)(``),[ge,ve]=(0,P.useState)(!1),[ye,be]=(0,P.useState)(`blueprints`),[xe,Se]=(0,P.useState)(`containerlab`),[Ce,we]=(0,P.useState)(``),[Ee,De]=(0,P.useState)(!0),[A,Oe]=(0,P.useState)(null),[ke,Ae]=(0,P.useState)(null),[je,Me]=(0,P.useState)(null),[j,Ne,Pe]=wt([{id:`r1`,position:{x:80,y:80},data:{label:`r1`,kind:`linux`,image:``},type:`designerNode`}]),[Fe,Ie,Le]=yt([]),M=(0,P.useMemo)(()=>j.find(e=>e.id===se)??null,[j,se]),Re=(0,P.useMemo)(()=>({name:o,nodes:j.map(e=>({id:String(e.id),label:String(e.data?.label??e.id),kind:String(e.data?.kind??``),image:String(e.data?.image??``),position:{x:e.position.x,y:e.position.y}})),links:Fe.map(e=>({id:String(e.id),source:String(e.source),target:String(e.target)}))}),[Fe,o,j]),{yaml:ze,warnings:Be}=(0,P.useMemo)(()=>hl(Re),[Re]),Ve=(0,P.useMemo)(()=>pe===`custom`?String(k??``):ze,[k,ze,pe]),He=(0,P.useMemo)(()=>String(x??``).trim().replace(/^\/+|\/+$/g,``)||`containerlab/designer`,[x]),We=(0,P.useMemo)(()=>{let e=String(ee??``).trim()||`${o||`lab`}.clab.yml`;return e.endsWith(`.yml`)||e.endsWith(`.yaml`)?e:`${e}.yml`},[o,ee]);(0,P.useEffect)(()=>{if(!ge||!c)return;let e=`skyforge.labDesigner.importPrefs.${c}`;try{let t=window.localStorage.getItem(e);if(!t)return;let n=JSON.parse(t);(n?.source===`workspace`||n?.source===`blueprints`)&&be(n.source),typeof n?.dir==`string`&&Se(n.dir)}catch{}},[ge,c]),(0,P.useEffect)(()=>{if(!c)return;let e=`skyforge.labDesigner.importPrefs.${c}`;try{window.localStorage.setItem(e,JSON.stringify({source:ye,dir:xe}))}catch{}},[xe,ye,c]);let Ge=()=>{let e=j.length+1,t=`n${e}`,n=new Set(j.map(e=>e.id));for(;n.has(t);)e++,t=`n${e}`;let r={x:120+j.length*40,y:120+j.length*30},i={id:t,position:r,data:{label:t,kind:`linux`,image:``},type:`designerNode`};Ne(e=>[...e,i]),ce(t)},Ke=()=>{let e=j.length;if(!e)return;let t=Math.max(1,Math.ceil(Math.sqrt(e)));Ne(e=>e.map((e,n)=>({...e,position:{x:120+n%t*260,y:120+Math.floor(n/t)*180}}))),requestAnimationFrame(()=>ae?.fitView({padding:.15,duration:300}))},qe=()=>{Oe(null),Ae(null),Me(null)},Je=e=>{if(!t)return;let n=new URLSearchParams;n.set(`action`,e.action),n.set(`node`,e.node);let r=`/dashboard/deployments/${encodeURIComponent(t)}?${n.toString()}`;window.open(r,`_blank`,`noopener,noreferrer`)},Ye=e=>{let t=j.find(t=>String(t.id)===e);if(!t)return;let n=String(t.data?.label??t.id),r=window.prompt(`Node name`,n);if(r==null)return;let i=r.trim();if(!i)return;let a=new Set(j.map(e=>String(e.id)));a.delete(e);let o=i,s=2;for(;a.has(o);)o=`${i}-${s++}`;Ne(t=>t.map(t=>String(t.id)===e?{...t,id:o,data:{...t.data,label:i}}:t)),Ie(t=>t.map(t=>({...t,source:String(t.source)===e?o:t.source,target:String(t.target)===e?o:t.target,label:String(t.source)===e||String(t.target)===e?`${String(t.source)===e?o:t.source}  ${String(t.target)===e?o:t.target}`:t.label}))),se===e&&ce(o),Oe(t=>t&&t.nodeId===e?{...t,nodeId:o}:t)};(0,P.useEffect)(()=>{let e=e=>{e.key===`Escape`&&qe()};return window.addEventListener(`keydown`,e),()=>window.removeEventListener(`keydown`,e)},[]);let Xe=()=>{let e=new Blob([Ve],{type:`text/yaml`}),t=document.createElement(`a`);t.href=URL.createObjectURL(e),t.download=`${o||`lab`}.clab.yml`,document.body.appendChild(t),t.click(),t.remove(),setTimeout(()=>URL.revokeObjectURL(t.href),5e3)};(0,P.useEffect)(()=>{let t=String(e.workspaceId??``).trim(),n=String(e.importDeploymentId??``).trim();if(!t||!n)return;l(t),v(!1),b(null);let r=!1;return(async()=>{try{let e=await $i(t,n);if(r)return;let i=(e.nodes??[]).map((e,t)=>({id:String(e.id),position:{x:120+t%4*260,y:120+Math.floor(t/4)*180},data:{label:String(e.label||e.id),kind:String(e.kind||``),image:``},type:`designerNode`})),a=(e.edges??[]).map(e=>({id:String(e.id),source:String(e.source),target:String(e.target),label:e.label||`${e.source}  ${e.target}`}));if(!i.length)throw Error(`No nodes found in deployment topology`);Ne(i),Ie(a),ce(String(i[0].id)),N.success(`Imported running topology`,{description:`Deployment ${n}`}),requestAnimationFrame(()=>ae?.fitView({padding:.15,duration:250}))}catch(e){if(r)return;N.error(`Failed to import deployment topology`,{description:e.message})}})(),()=>{r=!0}},[e.importDeploymentId,e.workspaceId]);let Ze=()=>{try{let e={labName:o,workspaceId:c,runtime:d,netlabServer:p,useSavedConfig:g,lastSaved:y,nodes:j,edges:Fe};window.localStorage.setItem(n,JSON.stringify(e)),N.success(`Draft saved`)}catch(e){N.error(`Failed to save draft`,{description:e.message})}},Qe=()=>{try{let e=window.localStorage.getItem(n);if(!e){N.message(`No saved draft`);return}let t=JSON.parse(e);typeof t?.labName==`string`&&s(t.labName),typeof t?.workspaceId==`string`&&l(t.workspaceId),(t?.runtime===`clabernetes`||t?.runtime===`containerlab`)&&f(t.runtime),typeof t?.netlabServer==`string`&&h(t.netlabServer),typeof t?.useSavedConfig==`boolean`&&v(t.useSavedConfig),t?.lastSaved&&typeof t.lastSaved==`object`&&b(t.lastSaved),Array.isArray(t?.nodes)&&Ne(t.nodes),Array.isArray(t?.edges)&&Ie(t.edges),N.success(`Draft loaded`)}catch(e){N.error(`Failed to load draft`,{description:e.message})}},$e=r({queryKey:W.workspaces(),queryFn:Mr,retry:!1,staleTime:3e4}),et=r({queryKey:W.registryRepos(``),queryFn:async()=>ea({q:``,n:2e3}),retry:!1,staleTime:6e4}),tt=r({queryKey:c?W.workspaceNetlabServers(c):[`workspaceNetlabServers`,`none`],queryFn:async()=>Rr(c),enabled:!!c&&d===`containerlab`,retry:!1,staleTime:3e4}),nt=r({queryKey:c?[`containerlabTemplates`,c,ye,xe]:[`containerlabTemplates`,`none`],queryFn:async()=>Ui(c,{source:ye,dir:xe}),enabled:!!c&&ge,retry:!1,staleTime:3e4}),rt=r({queryKey:c?[`containerlabTemplate`,c,ye,xe,Ce]:[`containerlabTemplate`,`none`],queryFn:async()=>{if(!c)throw Error(`missing workspace`);return Ce?Gi(c,{source:ye,dir:xe,file:Ce}):null},enabled:!!c&&ge&&!!Ce,retry:!1,staleTime:3e4}),at=m({mutationFn:async()=>{if(!c)throw Error(`Select a workspace`);if(!Ve.trim())throw Error(`YAML is empty`);if(!/^\s*topology\s*:/m.test(Ve))throw Error(`YAML must contain a top-level 'topology:' section`);if(He!==`containerlab`&&!He.startsWith(`containerlab/`))throw Error(`Repo path must be under containerlab/`);let e=g&&y?.workspaceId===c?y:await Ji(c,{name:o,topologyYAML:Ve,templatesDir:He,template:We}).then(e=>{let t={workspaceId:e.workspaceId,templatesDir:e.templatesDir,template:e.template,filePath:e.filePath,branch:e.branch};return b(t),t});if(d===`containerlab`){if(!p)throw Error(`Select a netlab server`);return Xi(c,{name:o,netlabServer:p,templateSource:`workspace`,templatesDir:e.templatesDir,template:e.template,autoDeploy:!0})}return Yi(c,{name:o,templateSource:`workspace`,templatesDir:e.templatesDir,template:e.template,autoDeploy:!0})},onSuccess:async e=>{N.success(`Deployment created`,{description:e.deployment?.name??o}),await a.invalidateQueries({queryKey:W.dashboardSnapshot()});let t=e.deployment?.id;Ee&&t&&window.open(`/dashboard/deployments/${t}`,`_blank`,`noopener,noreferrer`)},onError:e=>N.error(`Create deployment failed`,{description:e.message})}),ot=m({mutationFn:async()=>{if(!c)throw Error(`Select a workspace`);if(!Ve.trim())throw Error(`YAML is empty`);if(!/^\s*topology\s*:/m.test(Ve))throw Error(`YAML must contain a top-level 'topology:' section`);if(He!==`containerlab`&&!He.startsWith(`containerlab/`))throw Error(`Repo path must be under containerlab/`);return Ji(c,{name:o,topologyYAML:Ve,templatesDir:He,template:We})},onSuccess:e=>{b({workspaceId:e.workspaceId,templatesDir:e.templatesDir,template:e.template,filePath:e.filePath,branch:e.branch}),N.success(`Saved to repo`,{description:`${e.filePath} (${e.branch})`})},onError:e=>N.error(`Save failed`,{description:e.message})}),st=m({mutationFn:async()=>{if(!c)throw Error(`Select a workspace`);let e=Ce.trim();if(!e)throw Error(`Select a template`);return Gi(c,{source:ye,dir:xe,file:e})},onSuccess:e=>{me(`custom`),he(e.yaml),ve(!1),N.success(`Template imported`,{description:e.path})},onError:e=>N.error(`Import failed`,{description:e.message})}),ct=e=>{e.preventDefault(),e.dataTransfer.dropEffect=`move`},lt=async e=>{if(e.preventDefault(),!i.current||!ae)return;let t=e.dataTransfer.getData(vl),n=e.dataTransfer.getData(`application/x-skyforge-kind`),r=t?(()=>{try{return JSON.parse(t)}catch{return null}})():null,o=r?.kind||n;if(!o)return;let s=i.current.getBoundingClientRect(),c=ae.screenToFlowPosition({x:e.clientX-s.left,y:e.clientY-s.top}),l=r?.role,u=l===`host`?`h`:l===`router`?`r`:l===`switch`?`s`:l===`firewall`?`f`:o===`linux`?`h`:`n`,d=j.length+1,f=`${u}${d}`,p=new Set(j.map(e=>e.id));for(;p.has(f);)d++,f=`${u}${d}`;let m=String(r?.repo??``).trim(),h=m?await xl({repo:m,queryClient:a}):``,g=m?`${m}:${h}`:``,_={id:f,position:c,data:{label:f,kind:o,image:g},type:`designerNode`};Ne(e=>[...e,_]),ce(f)},dt=async()=>{if(!c){N.error(`Select a workspace first`);return}try{let e=y?.workspaceId===c?y:await Ji(c,{name:o,topologyYAML:Ve,templatesDir:He,template:We}).then(e=>{let t={workspaceId:e.workspaceId,templatesDir:e.templatesDir,template:e.template,filePath:e.filePath,branch:e.branch};return b(t),t}),t=new URLSearchParams;t.set(`workspaceId`,c),t.set(`source`,`workspace`),t.set(`dir`,e.templatesDir),t.set(`file`,e.template);let n=`/dashboard/labs/map?${t.toString()}`;window.open(n,`_blank`,`noopener,noreferrer`)}catch(e){N.error(`Failed to open map`,{description:e.message})}},ft=e=>{let t=e.target,n=t?.tagName?.toUpperCase?.()??``;if(n===`INPUT`||n===`TEXTAREA`||t?.isContentEditable)return;if(e.key===`Escape`){qe();return}if(e.key!==`Delete`&&e.key!==`Backspace`)return;let r=new Set(j.filter(e=>e.selected).map(e=>String(e.id))),i=new Set(Fe.filter(e=>e.selected).map(e=>String(e.id)));r.size===0&&i.size===0||(e.preventDefault(),Ne(e=>e.filter(e=>!r.has(String(e.id)))),Ie(e=>e.filter(e=>!(i.has(String(e.id))||r.has(String(e.source))||r.has(String(e.target))))))},pt=(0,P.useMemo)(()=>({designerNode:Sl}),[]),ht=(0,P.useMemo)(()=>(et.data?.repositories??[]).map(yl),[et.data?.repositories]),vt=(0,P.useMemo)(()=>{let e=new Set;for(let t of ht){let n=String(t.vendor??``).trim();n&&e.add(n)}return Array.from(e).sort((e,t)=>e.localeCompare(t))},[ht]),bt=(0,P.useMemo)(()=>{let e=ht,t=T.trim().toLowerCase(),n=e.filter(e=>D===`all`?!0:String(e.vendor??``)===D).filter(e=>O===`all`?!0:String(e.role??`other`)===O).filter(e=>t?`${e.label} ${e.kind} ${e.category} ${e.repo??``}`.toLowerCase().includes(t):!0),r={Hosts:0,Routers:1,Switches:2,Firewalls:3,Other:4};return n.sort((e,t)=>{let n=r[e.category]??99,i=r[t.category]??99;return n===i?e.label.localeCompare(t.label):n-i})},[ht,O,T,D]);return(0,I.jsxs)(`div`,{className:`h-full w-full p-4 flex flex-col gap-4 min-h-0`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-2xl font-bold tracking-tight`,children:`Lab Designer (Containerlab)`}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Drag nodes, wire links, generate Containerlab YAML, and deploy.`})]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsxs)(L,{variant:`outline`,size:`sm`,onClick:()=>ve(!0),disabled:!c,children:[(0,I.jsx)(mt,{className:`mr-2 h-4 w-4`}),`Import template`]}),(0,I.jsx)(L,{variant:`outline`,size:`sm`,onClick:Qe,children:`Load draft`}),(0,I.jsx)(L,{variant:`outline`,size:`sm`,onClick:Ze,children:`Save draft`}),(0,I.jsxs)(L,{variant:`outline`,size:`sm`,onClick:()=>ot.mutate(),disabled:ot.isPending,children:[(0,I.jsx)(_e,{className:`mr-2 h-4 w-4`}),`Save config`]}),(0,I.jsxs)(L,{variant:`outline`,size:`sm`,onClick:Xe,children:[(0,I.jsx)(E,{className:`mr-2 h-4 w-4`}),`Download YAML`]})]})]}),(0,I.jsxs)(`div`,{className:`grid gap-4 lg:grid-cols-[1fr_420px] flex-1 min-h-0`,children:[(0,I.jsxs)(z,{className:`flex flex-col min-h-0`,children:[(0,I.jsx)(B,{className:`pb-3`,children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(V,{children:`Topology`}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(L,{size:`sm`,variant:`outline`,onClick:()=>w(e=>!e),children:te?`Snap: on`:`Snap: off`}),(0,I.jsxs)(L,{size:`sm`,variant:le?`default`:`outline`,onClick:()=>{ue(e=>{let t=!e;return t||fe(``),t})},title:`Create links by clicking a source node, then a target node`,children:[(0,I.jsx)(_t,{className:`mr-2 h-4 w-4`}),le?`Link: on`:`Link: off`]}),(0,I.jsxs)(L,{size:`sm`,variant:`outline`,onClick:Ke,disabled:j.length<2,children:[(0,I.jsx)(Ut,{className:`mr-2 h-4 w-4`}),`Auto-layout`]}),(0,I.jsxs)(L,{size:`sm`,variant:`outline`,onClick:Ge,children:[(0,I.jsx)(_,{className:`mr-2 h-4 w-4`}),`Add node`]})]})]})}),(0,I.jsx)(U,{className:`flex-1 min-h-0`,children:(0,I.jsxs)(`div`,{className:`flex h-full w-full border rounded-xl overflow-hidden bg-background/50`,children:[(0,I.jsxs)(`div`,{className:`w-[180px] border-r bg-background p-3`,children:[(0,I.jsx)(`div`,{className:`text-xs font-semibold text-muted-foreground`,children:`Palette`}),(0,I.jsx)(`div`,{className:`mt-2`,children:(0,I.jsx)(J,{value:T,onChange:e=>ne(e.target.value),placeholder:`Search`,className:`h-8`})}),(0,I.jsxs)(`div`,{className:`mt-2 grid gap-2`,children:[(0,I.jsxs)(Y,{value:D,onValueChange:re,children:[(0,I.jsx)(Z,{className:`h-8`,children:(0,I.jsx)(X,{placeholder:`Vendor`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All vendors`}),vt.map(e=>(0,I.jsx)($,{value:e,children:e},e))]})]}),(0,I.jsxs)(Y,{value:O,onValueChange:ie,children:[(0,I.jsx)(Z,{className:`h-8`,children:(0,I.jsx)(X,{placeholder:`Role`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All roles`}),(0,I.jsx)($,{value:`router`,children:`Routers`}),(0,I.jsx)($,{value:`switch`,children:`Switches`}),(0,I.jsx)($,{value:`firewall`,children:`Firewalls`}),(0,I.jsx)($,{value:`host`,children:`Hosts`}),(0,I.jsx)($,{value:`other`,children:`Other`})]})]})]}),(0,I.jsx)(`div`,{className:`mt-3 space-y-2`,children:et.isError?(0,I.jsx)(`div`,{className:`rounded-lg border bg-background px-3 py-2 text-xs text-destructive`,children:`Registry not available.`}):et.isLoading?(0,I.jsx)(`div`,{className:`rounded-lg border bg-background px-3 py-2 text-xs text-muted-foreground`,children:`Loading images`}):bt.length===0?(0,I.jsx)(`div`,{className:`rounded-lg border bg-background px-3 py-2 text-xs text-muted-foreground`,children:`No images found.`}):(0,I.jsx)(`div`,{className:`space-y-3`,children:[`Hosts`,`Routers`,`Switches`,`Firewalls`,`Other`].map(e=>({category:e,items:bt.filter(t=>t.category===e)})).filter(e=>e.items.length>0).map(e=>(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-[11px] font-semibold text-muted-foreground`,children:e.category}),(0,I.jsx)(`div`,{className:`space-y-2`,children:e.items.slice(0,60).map(e=>(0,I.jsx)(bl,{item:e},e.id))})]},e.category))})})]}),(0,I.jsxs)(`div`,{className:`flex-1 outline-none relative`,ref:i,onDrop:lt,onDragOver:ct,tabIndex:0,onKeyDown:ft,onMouseDown:e=>{e.currentTarget.focus(),qe()},onContextMenu:e=>e.preventDefault(),children:[le?(0,I.jsx)(`div`,{className:`absolute z-10 m-3 rounded-lg border bg-background/80 px-3 py-2 text-xs text-muted-foreground backdrop-blur`,children:de?(0,I.jsxs)(I.Fragment,{children:[`Link mode: select target for`,` `,(0,I.jsx)(`span`,{className:`font-mono text-foreground`,children:de})]}):(0,I.jsx)(I.Fragment,{children:`Link mode: click a source node, then click a target node`})}):null,(0,I.jsxs)(hn,{nodes:j,edges:Fe,onNodesChange:Pe,onEdgesChange:Le,onConnect:e=>{let t=e.source&&e.target?`${e.source}  ${e.target}`:void 0;Ie(n=>Gt({...e,label:t},n))},fitView:!0,onNodeClick:(e,t)=>{let n=String(t.id);if(le){if(!de){fe(n);return}if(de===n){fe(``);return}let e=`e-${de}-${n}-${Date.now()}`;Ie(t=>Gt({id:e,source:de,target:n,label:`${de}  ${n}`},t)),fe(``);return}ce(n)},onNodeContextMenu:(e,t)=>{e.preventDefault();let n=i.current?.getBoundingClientRect();Oe({x:n?e.clientX-n.left:e.clientX,y:n?e.clientY-n.top:e.clientY,nodeId:String(t.id)}),Ae(null),Me(null)},onEdgeContextMenu:(e,t)=>{e.preventDefault();let n=i.current?.getBoundingClientRect();Ae({x:n?e.clientX-n.left:e.clientX,y:n?e.clientY-n.top:e.clientY,edgeId:String(t.id)}),Oe(null),Me(null)},onPaneContextMenu:e=>{e.preventDefault();let t=i.current?.getBoundingClientRect();Me({x:t?e.clientX-t.left:e.clientX,y:t?e.clientY-t.top:e.clientY}),Oe(null),Ae(null)},onInit:oe,snapToGrid:te,snapGrid:[12,12],nodeTypes:pt,children:[(0,I.jsx)(Xt,{}),(0,I.jsx)(gt,{zoomable:!0,pannable:!0,className:`bg-background border rounded-lg`}),(0,I.jsx)(ut,{gap:12,size:1})]}),A?(0,I.jsx)(`div`,{className:`absolute z-50`,style:{left:A.x,top:A.y},onContextMenu:e=>e.preventDefault(),children:(0,I.jsxs)(z,{className:`w-64 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,I.jsxs)(B,{className:`p-3 pb-2`,children:[(0,I.jsx)(V,{className:`text-sm`,children:`Node`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:String(j.find(e=>String(e.id)===A.nodeId)?.data?.label??A.nodeId)})]}),(0,I.jsxs)(U,{className:`p-3 pt-0 space-y-2`,children:[(0,I.jsx)(L,{size:`sm`,className:`w-full`,onClick:()=>{ce(A.nodeId),qe()},children:`Edit`}),t?(0,I.jsxs)(`div`,{className:`grid grid-cols-3 gap-2`,children:[(0,I.jsx)(L,{size:`sm`,variant:`outline`,onClick:()=>{Je({action:`terminal`,node:A.nodeId}),qe()},children:`Terminal`}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,onClick:()=>{Je({action:`logs`,node:A.nodeId}),qe()},children:`Logs`}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,onClick:()=>{Je({action:`describe`,node:A.nodeId}),qe()},children:`Describe`})]}):null,(0,I.jsx)(L,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{Ye(A.nodeId),qe()},children:`Rename`}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=j.find(e=>String(e.id)===A.nodeId);if(!e)return;let t=new Set(j.map(e=>String(e.id))),n=j.length+1,r=`${String(e.id)}-${n}`;for(;t.has(r);)n++,r=`${String(e.id)}-${n}`;let i={...e,id:r,position:{x:e.position.x+32,y:e.position.y+32},data:{...e.data,label:r}};Ne(e=>[...e,i]),ce(r),qe()},children:`Duplicate`}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{ue(!0),fe(A.nodeId),qe()},children:`Start link`}),(0,I.jsx)(L,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=j.find(e=>String(e.id)===A.nodeId)?.data?.label??A.nodeId;navigator.clipboard?.writeText(String(e)),N.success(`Copied`),qe()},children:`Copy name`}),(0,I.jsx)(L,{size:`sm`,variant:`destructive`,className:`w-full`,onClick:()=>{let e=A.nodeId;Ne(t=>t.filter(t=>String(t.id)!==e)),Ie(t=>t.filter(t=>String(t.source)!==e&&String(t.target)!==e)),se===e&&ce(``),qe()},children:`Delete`})]})]})}):null,ke?(0,I.jsx)(`div`,{className:`absolute z-50`,style:{left:ke.x,top:ke.y},onContextMenu:e=>e.preventDefault(),children:(0,I.jsxs)(z,{className:`w-60 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,I.jsxs)(B,{className:`p-3 pb-2`,children:[(0,I.jsx)(V,{className:`text-sm`,children:`Link`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:Fe.find(e=>String(e.id)===ke.edgeId)?.label??ke.edgeId})]}),(0,I.jsxs)(U,{className:`p-3 pt-0 space-y-2`,children:[(0,I.jsx)(L,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=Fe.find(e=>String(e.id)===ke.edgeId);if(!e)return;let t=window.prompt(`Link label`,String(e.label??``));t!=null&&(Ie(e=>e.map(e=>String(e.id)===ke.edgeId?{...e,label:t}:e)),qe())},children:`Rename`}),(0,I.jsx)(L,{size:`sm`,variant:`destructive`,className:`w-full`,onClick:()=>{Ie(e=>e.filter(e=>String(e.id)!==ke.edgeId)),qe()},children:`Delete`})]})]})}):null,je?(0,I.jsx)(`div`,{className:`absolute z-50`,style:{left:je.x,top:je.y},onContextMenu:e=>e.preventDefault(),children:(0,I.jsxs)(z,{className:`w-60 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,I.jsx)(B,{className:`p-3 pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`Canvas`})}),(0,I.jsxs)(U,{className:`p-3 pt-0 space-y-2`,children:[(0,I.jsx)(L,{size:`sm`,className:`w-full`,onClick:()=>{Ge(),qe()},children:`Add node`}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{Ke(),qe()},disabled:j.length<2,children:`Auto-layout`}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{ae?.fitView({padding:.15,duration:250}),qe()},disabled:!ae,children:`Fit view`})]})]})}):null]})]})})]}),(0,I.jsxs)(`div`,{className:`space-y-6`,children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Lab`})}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Lab name`}),(0,I.jsx)(J,{value:o,onChange:e=>s(e.target.value)})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Workspace`}),(0,I.jsxs)(Y,{value:c,onValueChange:e=>l(e),children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:$e.isLoading?`Loading`:`Select workspace`})}),(0,I.jsx)(Q,{children:($e.data?.workspaces??[]).map(e=>(0,I.jsx)($,{value:String(e.id),children:String(e.name??e.slug??e.id)},String(e.id)))})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Runtime`}),(0,I.jsxs)(Y,{value:d,onValueChange:e=>f(e),disabled:!c,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:c?`Select runtime`:`Select workspace first`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`clabernetes`,children:`Clabernetes (in-cluster)`}),(0,I.jsx)($,{value:`containerlab`,children:`Containerlab (BYOS)`})]})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Repo path`}),(0,I.jsxs)(`div`,{className:`grid grid-cols-2 gap-2`,children:[(0,I.jsx)(J,{value:x,onChange:e=>S(e.target.value),placeholder:`containerlab/designer`}),(0,I.jsx)(J,{value:ee,onChange:e=>C(e.target.value),placeholder:`${o||`lab`}.clab.yml`})]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsx)(L,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(`${He}/${We}`),N.success(`Copied path`)},disabled:!c,children:`Copy path`}),(0,I.jsxs)(L,{size:`sm`,variant:`outline`,onClick:dt,disabled:!c,children:[(0,I.jsx)(Ue,{className:`mr-2 h-4 w-4`}),`Open map`]})]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:[He,`/`,We]})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3 rounded-lg border p-3`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Use saved config`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground truncate`,children:y?.workspaceId===c?`${y.filePath} (${y.branch})`:`Auto-saves before deploy`})]}),(0,I.jsx)(as,{checked:g,onCheckedChange:e=>v(!!e)})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Netlab server`}),(0,I.jsxs)(Y,{value:p,onValueChange:e=>h(e),disabled:!c||d!==`containerlab`,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:d===`containerlab`?c?tt.isLoading?`Loading`:`Select server`:`Select workspace first`:`Not required for clabernetes`})}),(0,I.jsx)(Q,{children:(tt.data?.servers??[]).map(e=>(0,I.jsx)($,{value:`ws:${String(e.id)}`,children:String(e.name)},String(e.id)))})]})]}),(0,I.jsx)(`div`,{children:(0,I.jsxs)(L,{className:`w-full`,disabled:at.isPending,onClick:()=>at.mutate(),children:[(0,I.jsx)(it,{className:`mr-2 h-4 w-4`}),at.isPending?`Creating`:`Create deployment + deploy`]})}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded-lg border px-3 py-2`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Open deployment on create`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Keeps the Designer open in this tab.`})]}),(0,I.jsx)(as,{checked:Ee,onCheckedChange:e=>De(!!e)})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Node`})}),(0,I.jsx)(U,{className:`space-y-4`,children:M?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Name`}),(0,I.jsx)(J,{value:String(M.data?.label??M.id),onChange:e=>{let t=e.target.value;Ne(e=>e.map(e=>e.id===M.id?{...e,data:{...e.data,label:t}}:e))}})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Kind`}),(0,I.jsx)(J,{value:String(M.data?.kind??``),onChange:e=>{let t=e.target.value;Ne(e=>e.map(e=>e.id===M.id?{...e,data:{...e.data,kind:t}}:e))},placeholder:`linux, ceos, ...`})]}),(0,I.jsx)(fl,{value:String(M.data?.image??``),onChange:e=>{Ne(t=>t.map(t=>t.id===M.id?{...t,data:{...t.data,image:e}}:t))}})]}):(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Click a node to edit.`})})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-3`,children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(V,{children:`YAML`}),(0,I.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,I.jsxs)(L,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(Ve),N.success(`Copied YAML`)},children:[(0,I.jsx)(Te,{className:`mr-2 h-4 w-4`}),`Copy`]})})]})}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(L,{size:`sm`,variant:pe===`generated`?`default`:`outline`,onClick:()=>me(`generated`),children:`Generated`}),(0,I.jsx)(L,{size:`sm`,variant:pe===`custom`?`default`:`outline`,onClick:()=>{me(`custom`),k.trim()||he(Ve)},children:`Custom`})]}),Be.length?(0,I.jsx)(`div`,{className:`rounded-md border bg-amber-500/10 text-amber-900 dark:text-amber-200 px-3 py-2 text-xs`,children:Be.slice(0,6).map(e=>(0,I.jsx)(`div`,{children:e},e))}):null,(0,I.jsx)(Ps,{value:pe===`custom`?k:ze,onChange:e=>he(e.target.value),readOnly:pe!==`custom`,className:`font-mono text-xs h-[320px]`})]})]})]})]}),(0,I.jsx)(Kn,{open:ge,onOpenChange:e=>ve(e),children:(0,I.jsxs)(Yn,{children:[(0,I.jsxs)(Xn,{children:[(0,I.jsx)(Qn,{children:`Import template`}),(0,I.jsx)($n,{children:`Load an existing containerlab YAML from templates/blueprints into the editor.`})]}),(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Source`}),(0,I.jsxs)(Y,{value:ye,onValueChange:e=>{let t=e;be(t),Se(t===`workspace`?`containerlab/designer`:`containerlab`),we(``)},children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`blueprints`,children:`Blueprints`}),(0,I.jsx)($,{value:`workspace`,children:`Workspace repo`})]})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Directory`}),(0,I.jsx)(J,{value:xe,onChange:e=>Se(e.target.value)})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Template`}),(0,I.jsxs)(Y,{value:Ce,onValueChange:e=>we(e),disabled:!c,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:nt.isLoading?`Loading`:`Select template`})}),(0,I.jsx)(Q,{children:(nt.data?.templates??[]).map(e=>(0,I.jsx)($,{value:e,children:e},e))})]}),nt.isError?(0,I.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to list templates`}):null]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Preview`}),(0,I.jsx)(Ps,{value:rt.data?.yaml??``,readOnly:!0,placeholder:Ce?rt.isLoading?`Loading preview`:`No preview`:`Select a template to preview`,className:`font-mono text-xs h-[220px]`})]})]}),(0,I.jsxs)(Zn,{children:[(0,I.jsx)(L,{variant:`outline`,onClick:()=>ve(!1),children:`Cancel`}),(0,I.jsx)(L,{onClick:()=>st.mutate(),disabled:st.isPending||!Ce,children:`Import`})]})]})})]})}var wl=[{slug:`getting-started`,title:`Getting started`,content:(0,I.jsxs)(`div`,{className:`space-y-4 text-sm`,children:[(0,I.jsx)(`p`,{children:`Skyforge is optimized for a happy path workflow. You can still run tools manually, but the goal is to make repeatable automation the default.`}),(0,I.jsxs)(`ol`,{className:`list-decimal pl-5 space-y-2`,children:[(0,I.jsxs)(`li`,{children:[`Go to`,` `,(0,I.jsx)(f,{className:`underline`,to:`/dashboard/settings`,children:`My Settings`}),` `,`and configure:`,(0,I.jsxs)(`ul`,{className:`list-disc pl-5 mt-2 space-y-1`,children:[(0,I.jsx)(`li`,{children:`External template repos (optional)`}),(0,I.jsx)(`li`,{children:`BYOL servers (optional)`}),(0,I.jsx)(`li`,{children:`Collector + integrations (optional)`})]})]}),(0,I.jsxs)(`li`,{children:[`Create a deployment from`,` `,(0,I.jsx)(f,{className:`underline`,to:`/dashboard/deployments/new`,children:`Create deployment`}),`.`]}),(0,I.jsxs)(`li`,{children:[`Use `,(0,I.jsx)(`span`,{className:`font-mono`,children:`Validate`}),` before starting, especially when overriding env vars.`]})]})]})},{slug:`my-settings`,title:`My Settings`,content:(0,I.jsxs)(`div`,{className:`space-y-4 text-sm`,children:[(0,I.jsxs)(`p`,{children:[`The current model is`,` `,(0,I.jsx)(`strong`,{children:`per-user settings applied to deployments`}),`. Workspaces are primarily for sharing and feature gates.`]}),(0,I.jsxs)(`ul`,{className:`list-disc pl-5 space-y-2`,children:[(0,I.jsxs)(`li`,{children:[(0,I.jsx)(`strong`,{children:`Defaults`}),`: environment variables applied to new deployments.`]}),(0,I.jsxs)(`li`,{children:[(0,I.jsx)(`strong`,{children:`External Template Repos`}),`: add Git repos once and reuse them across deployments.`]}),(0,I.jsxs)(`li`,{children:[(0,I.jsx)(`strong`,{children:`BYOL Servers`}),`: register Netlab / Containerlab / EVE-NG servers (using `,(0,I.jsx)(`span`,{className:`font-mono`,children:`user:`}),` `,`refs).`]}),(0,I.jsxs)(`li`,{children:[(0,I.jsx)(`strong`,{children:`Cloud credentials`}),`: stored per-user; UI only shows configured status.`]})]})]})},{slug:`deployments`,title:`Deployments`,content:(0,I.jsxs)(`div`,{className:`space-y-4 text-sm`,children:[(0,I.jsx)(`p`,{children:`Deployments are created from templates and then executed as runs. Template validation should use the same env overrides youll apply at runtime.`}),(0,I.jsxs)(`ul`,{className:`list-disc pl-5 space-y-2`,children:[(0,I.jsxs)(`li`,{children:[`Use the `,(0,I.jsx)(`span`,{className:`font-mono`,children:`View`}),` button to inspect a selected template.`]}),(0,I.jsxs)(`li`,{children:[`Use `,(0,I.jsx)(`span`,{className:`font-mono`,children:`Validate`}),` to catch obvious netlab errors early.`]})]})]})},{slug:`servicenow`,title:`ServiceNow demo workflow`,content:(0,I.jsxs)(`div`,{className:`space-y-4 text-sm`,children:[(0,I.jsx)(`p`,{children:`This workflow installs a demo app into a ServiceNow PDI. The demo app calls Forward SaaS directly; Skyforge only installs/configures ServiceNow resources.`}),(0,I.jsxs)(`ol`,{className:`list-decimal pl-5 space-y-2`,children:[(0,I.jsx)(`li`,{children:`Create (and wake) a PDI from ServiceNow developer portal.`}),(0,I.jsxs)(`li`,{children:[`In Skyforge, open`,` `,(0,I.jsx)(f,{className:`underline`,to:`/dashboard/servicenow`,children:`ServiceNow`}),` `,`and save your instance URL + admin credentials.`]}),(0,I.jsxs)(`li`,{children:[`Click `,(0,I.jsx)(`strong`,{children:`Install demo app`}),`.`]}),(0,I.jsx)(`li`,{children:`If schema setup is required, create the required tables in ServiceNow Studio (first time per PDI), then re-run install.`})]})]})}];const Tl=t(`/dashboard/docs/$slug`)({component:El});function El(){let{slug:e}=Tl.useParams(),t=wl.find(t=>t.slug===e);return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(`div`,{className:`flex items-center gap-3`,children:(0,I.jsxs)(f,{to:`/dashboard/docs`,className:`inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground`,children:[(0,I.jsx)(ye,{className:`h-4 w-4`}),`Back to Docs`]})}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsx)(B,{children:(0,I.jsxs)(V,{className:`flex items-center gap-2`,children:[(0,I.jsx)(Qe,{className:`h-5 w-5`}),t?.title??`Page not found`]})}),(0,I.jsx)(U,{children:t?t.content:(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`This doc page doesnt exist.`})})]})]})}var Dl=Jt,Ol=on,kl=Nt,Al=P.forwardRef(({className:e,sideOffset:t=4,...n},r)=>(0,I.jsx)(fn,{ref:r,sideOffset:t,className:F(`z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,e),...n}));Al.displayName=fn.displayName;var jl=Ln({workspace:zn().optional().catch(``)});const Ml=t(`/dashboard/deployments/new`)({validateSearch:e=>jl.parse(e),component:Fl});var Nl=Ln({workspaceId:zn().min(1,`Workspace is required`),name:zn().min(1,`Deployment name is required`).max(100),kind:Un([`netlab-c9s`,`netlab`,`containerlab`,`clabernetes`,`terraform`,`labpp`]),source:Un([`workspace`,`blueprints`,`external`]),templateRepoId:zn().optional(),template:zn().min(1,`Template is required`),netlabServer:zn().optional(),eveServer:zn().optional(),forwardCollectorId:zn().optional(),variableGroupId:zn().optional(),env:In(Ln({key:zn(),value:zn()})).optional()});function Pl(e){let t=String(e??``).trim();if(!t)return``;try{return new URL(t).hostname||t}catch{return t.replace(/^https?:\/\//,``).split(`/`)[0]??t}}function Fl(){let e=n(),t=u(),{workspace:i}=Ml.useSearch(),[a,o]=(0,P.useState)(!1),[s,c]=(0,P.useState)(!1),[l,d]=(0,P.useState)(`all`),[f,p]=(0,P.useState)(0);cc(!0);let h=r({queryKey:W.dashboardSnapshot(),queryFn:Nr,initialData:()=>t.getQueryData(W.dashboardSnapshot())??null,retry:!1,staleTime:1/0}),g=r({queryKey:W.userSettings(),queryFn:ni,staleTime:3e4,retry:!1}),v=r({queryKey:W.workspaces(),queryFn:Mr,staleTime:3e4}).data?.workspaces??[],y=Dn({resolver:At(Nl),defaultValues:{workspaceId:i||``,name:``,kind:`netlab-c9s`,source:`blueprints`,templateRepoId:``,template:``,netlabServer:``,eveServer:``,forwardCollectorId:`none`,variableGroupId:`none`,env:[]}}),{watch:b,setValue:x,control:S}=y,{fields:ee,append:C,remove:te}=vn({control:S,name:`env`});(0,P.useEffect)(()=>{let e=f===0?`deploy-step-template`:f===1?`deploy-step-params`:`deploy-step-review`;document.getElementById(e)?.scrollIntoView({behavior:`smooth`,block:`start`})},[f]),(0,P.useEffect)(()=>{let e=g.data?.defaultEnv??[];e.length&&((y.getValues(`env`)??[]).length||x(`env`,e,{shouldDirty:!1,shouldTouch:!1,shouldValidate:!0}))},[g.data?.defaultEnv,y,x]);let w=b(`workspaceId`),T=b(`kind`),E=b(`source`),ne=b(`templateRepoId`),D=b(`template`),re=b(`name`),O=b(`forwardCollectorId`);b(`env`);let ie=h.data?.templatesIndexUpdatedAt??``,ae=`skyforge.lastWorkspaceId.deployments`;(0,P.useEffect)(()=>{if(w||v.length===0)return;let e=String(i??``).trim();if(e&&v.some(t=>t.id===e)){x(`workspaceId`,e);return}let t=typeof window<`u`?window.localStorage.getItem(ae)??``:``;if(t&&v.some(e=>e.id===t)){x(`workspaceId`,t);return}x(`workspaceId`,v[0].id)},[w,v,x]),(0,P.useEffect)(()=>{if(w&&!(typeof window>`u`))try{window.localStorage.setItem(ae,w)}catch{}},[w]),(0,P.useEffect)(()=>{x(`name`,`${(D||T).split(`/`).pop()||T}-${new Date().toISOString().replace(/[-:]/g,``).replace(/\..+/,``).slice(0,15)}`)},[D,T,x]);let oe=(0,P.useMemo)(()=>v.find(e=>e.id===w)??null,[w,v]),se=r({queryKey:W.workspaceNetlabServers(w),queryFn:async()=>Rr(w),enabled:!!w,staleTime:3e4}),ce=r({queryKey:W.userNetlabServers(),queryFn:yi,staleTime:3e4,retry:!1}),le=r({queryKey:W.userContainerlabServers(),queryFn:Ti,staleTime:3e4,retry:!1}),ue=r({queryKey:[`workspaceEveServers`,w],queryFn:async()=>Vr(w),enabled:!!w,staleTime:3e4}),de=r({queryKey:[`workspaceVariableGroups`,w],queryFn:async()=>Ra(w),enabled:!!w,staleTime:3e4}),fe=r({queryKey:W.userForwardCollectorConfigs(),queryFn:ra,enabled:[`netlab-c9s`,`clabernetes`,`terraform`].includes(T),staleTime:3e4,retry:!1}),pe=(0,P.useMemo)(()=>(fe.data?.collectors??[]).filter(e=>e&&typeof e.id==`string`&&typeof e.name==`string`).filter(e=>!e.decryptionFailed),[fe.data?.collectors]);(0,P.useEffect)(()=>{if(![`netlab-c9s`,`clabernetes`,`terraform`].includes(T)){(O??`none`)!==`none`&&x(`forwardCollectorId`,`none`);return}if((O??`none`)!==`none`)return;let e=String(g.data?.defaultForwardCollectorConfigId??``).trim(),t=(e?pe.find(t=>t.id===e):null)??pe.find(e=>e.isDefault)??pe[0];t?.id&&x(`forwardCollectorId`,String(t.id))},[T,O,pe,x,g.data?.defaultForwardCollectorConfigId]);let me=(0,P.useMemo)(()=>T===`netlab`||T===`netlab-c9s`?E===`workspace`?`workspace`:`blueprints`:T===`labpp`?`blueprints`:T===`containerlab`||T===`clabernetes`||T===`terraform`?E:`workspace`,[T,E]),k=r({queryKey:W.workspaceTemplates(w,T,me,ne||void 0,void 0),enabled:!!w,queryFn:async()=>{let e={source:me};switch(me===`external`&&ne&&(e.repo=ne),T){case`netlab`:case`netlab-c9s`:return Bi(w,e);case`labpp`:return Ki(w,e);case`containerlab`:case`clabernetes`:return Ui(w,e);case`terraform`:return Wi(w,e);default:return Bi(w,e)}},staleTime:5*6e4,refetchOnWindowFocus:!1});(0,P.useEffect)(()=>{ie&&t.invalidateQueries({queryKey:[`workspaceTemplates`]})},[ie,t]);let he=(0,P.useMemo)(()=>{let e=k.data?.templates??[];if(T!==`terraform`)return e;let t=String(l??`all`).trim().toLowerCase();return!t||t===`all`?e:e.filter(e=>String(e).toLowerCase().startsWith(`${t}/`)||String(e).toLowerCase()===t)},[k.data?.templates,l,T]),ge=(0,P.useMemo)(()=>{if(T!==`terraform`)return[];let e=k.data?.templates??[],t=new Set;for(let n of e){let e=String(n??``).split(`/`)[0]?.trim();e&&t.add(e)}return Array.from(t).sort((e,t)=>e.localeCompare(t))},[k.data?.templates,T]);(0,P.useEffect)(()=>{if(T!==`terraform`){d(`all`);return}l!==`all`&&!ge.includes(l)&&d(`all`)},[l,ge,T]);let _e=r({queryKey:[`workspaceTemplate`,T,w,me,ne,k.data?.dir,D],queryFn:async()=>{if(!w)throw Error(`workspaceId is required`);if(!D)throw Error(`template is required`);let e={source:me};return me===`external`&&ne&&(e.repo=ne),k.data?.dir&&(e.dir=k.data.dir),T===`containerlab`||T===`clabernetes`?Gi(w,{...e,file:D}):Vi(w,{...e,template:D})},enabled:a&&!!w&&!!D&&(T===`netlab`||T===`netlab-c9s`||T===`containerlab`||T===`clabernetes`),retry:!1,staleTime:3e4}),ve=(g.data?.externalTemplateRepos??[]).filter(e=>!!e&&typeof e.id==`string`&&typeof e.repo==`string`),ye=!!oe?.allowExternalTemplateRepos&&ve.length>0,be=m({mutationFn:async e=>{let t={template:e.template};if(e.variableGroupId&&e.variableGroupId!==`none`&&(t.envGroupIds=[Number.parseInt(e.variableGroupId,10)]),e.env&&e.env.length>0){let n={};for(let t of e.env)t.key.trim()&&(n[t.key.trim()]=t.value);Object.keys(n).length>0&&(t.environment=n)}if([`netlab-c9s`,`clabernetes`,`terraform`].includes(e.kind)){let n=String(e.forwardCollectorId??`none`).trim();n&&n!==`none`&&(t.forwardEnabled=!0,t.forwardCollectorId=n)}if(e.kind===`netlab`||e.kind===`containerlab`){let n=(e.netlabServer||oe?.netlabServer||``).trim();if(!n)throw Error(`netlab server is required`);t.netlabServer=n,t.templateSource=me,me===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),k.data?.dir&&(t.templatesDir=k.data.dir)}if(e.kind===`netlab-c9s`&&(t.templateSource=me,me===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),k.data?.dir&&(t.templatesDir=k.data.dir)),e.kind===`clabernetes`&&(t.templateSource=me,me===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),k.data?.dir&&(t.templatesDir=k.data.dir)),e.kind===`terraform`&&(t.templateSource=me,me===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),k.data?.dir&&(t.templatesDir=k.data.dir)),e.kind===`labpp`){t.templateSource=`blueprints`,k.data?.dir&&(t.templatesDir=k.data.dir);let n=(e.eveServer||``).trim();if(!n)throw Error(`EVE-NG server is required`);t.eveServer=n}let n={name:e.name,type:e.kind,config:t};return qi(e.workspaceId,n)},onSuccess:async(n,r)=>{N.success(`Deployment created successfully`,{description:`${r.name} is now queued for provisioning.`}),await t.invalidateQueries({queryKey:W.dashboardSnapshot()}),await e({to:`/dashboard/deployments`,search:{workspace:r.workspaceId}})},onError:e=>{N.error(`Failed to create deployment`,{description:e.message})}}),xe=m({mutationFn:async()=>{if(!w)throw Error(`Select a workspace first.`);if(!D)throw Error(`Select a template first.`);let e=new Map;for(let t of y.getValues(`env`)||[]){let n=(t?.key??``).trim();n&&e.set(n,String(t?.value??``))}let t=String(y.getValues(`variableGroupId`)??`none`),n=t===`none`?null:Number(t),r={...(n?De.find(e=>e.id===n)?.variables:void 0)??{}};for(let[t,n]of e.entries())r[t]=n;let i={source:me,template:D,environment:r};return me===`external`&&ne&&(i.repo=ne),k.data?.dir&&(i.dir=k.data.dir),Hi(w,i)},onSuccess:async t=>{let n=String(t?.task?.id??t?.task?.task_id??``).trim();N.success(`Validation queued`,{description:n?`Run ${n} started.`:`Validation run started.`}),n&&e({to:`/dashboard/runs/$runId`,params:{runId:n}})},onError:e=>{N.error(`Validation failed`,{description:String(e?.message??e)})}});function Se(e){be.mutate(e)}let Ce=se.data?.servers??[],we=ce.data?.servers??[],Te=le.data?.servers??[],Ee=ue.data?.servers??[],De=de.data?.groups??[],A=Ce.length>0||!!oe?.allowCustomNetlabServers&&we.length>0||!!oe?.allowCustomContainerlabServers&&Te.length>0,Oe=Ee.length>0,ke=(()=>{let e=[];for(let t of Ce)e.push({value:`ws:${t.id}`,label:Pl(t.apiUrl)||t.name});if(oe?.allowCustomNetlabServers)for(let t of we)t?.id&&e.push({value:`user:${t.id}`,label:`${Pl(t.apiUrl)||t.name} (user)`});if(oe?.allowCustomContainerlabServers)for(let t of Te)t?.id&&e.push({value:`user:${t.id}`,label:`${Pl(t.apiUrl)||t.name} (user)`});let t=new Set;return e.filter(e=>t.has(e.value)?!1:(t.add(e.value),!0))})();return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(V,{children:`Create deployment`}),(0,I.jsx)(H,{children:`Configure and launch a new infrastructure deployment.`})]}),(0,I.jsx)(L,{variant:`outline`,onClick:()=>e({to:`/dashboard/deployments`,search:{workspace:w}}),children:`Cancel`})]})})}),(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`pt-6`,children:(0,I.jsx)(ws,{...y,children:(0,I.jsxs)(`form`,{onSubmit:y.handleSubmit(Se),className:`space-y-8`,children:[(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2 rounded-md border bg-muted/20 p-2`,children:[(0,I.jsx)(L,{type:`button`,variant:f===0?`default`:`ghost`,size:`sm`,onClick:()=>p(0),children:`1. Template`}),(0,I.jsx)(L,{type:`button`,variant:f===1?`default`:`ghost`,size:`sm`,onClick:()=>p(1),children:`2. Parameters`}),(0,I.jsx)(L,{type:`button`,variant:f===2?`default`:`ghost`,size:`sm`,onClick:()=>p(2),children:`3. Review`})]}),(0,I.jsx)(`div`,{id:`deploy-step-template`,className:`scroll-mt-24`}),(0,I.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:[(0,I.jsx)(Es,{control:y.control,name:`workspaceId`,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{children:`Workspace`}),(0,I.jsxs)(Y,{onValueChange:e.onChange,defaultValue:e.value,value:e.value,children:[(0,I.jsx)(js,{children:(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select workspace`})})}),(0,I.jsx)(Q,{children:v.map(e=>(0,I.jsxs)($,{value:e.id,children:[e.name,` (`,e.slug,`)`]},e.id))})]}),(0,I.jsx)(Ns,{})]})}),(0,I.jsx)(Es,{control:y.control,name:`kind`,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{children:`Provider`}),(0,I.jsxs)(Y,{onValueChange:t=>{e.onChange(t),y.setValue(`template`,``)},defaultValue:e.value,children:[(0,I.jsx)(js,{children:(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select provider`})})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`netlab-c9s`,children:`Netlab`}),A&&(0,I.jsx)($,{value:`netlab`,children:`Netlab (BYOS)`}),Oe&&(0,I.jsx)($,{value:`labpp`,children:`LabPP`}),A&&(0,I.jsx)($,{value:`containerlab`,children:`Containerlab (BYOS)`}),(0,I.jsx)($,{value:`clabernetes`,children:`Containerlab`}),(0,I.jsx)($,{value:`terraform`,children:`Terraform`})]})]}),(0,I.jsx)(Ns,{})]})}),[`netlab-c9s`,`clabernetes`,`terraform`].includes(T)&&(0,I.jsx)(Es,{control:y.control,name:`forwardCollectorId`,render:({field:e})=>(0,I.jsxs)(ks,{className:`rounded-md border p-3 md:col-span-2 space-y-2`,children:[(0,I.jsx)(As,{children:`Forward collector`}),(0,I.jsxs)(Ms,{children:[`Optional. Select a per-user in-cluster Collector. Configure collectors under`,` `,(0,I.jsx)(`code`,{className:`font-mono`,children:`Dashboard  Collector`}),`.`]}),fe.isError?(0,I.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to load collectors.`}):null,fe.data&&pe.length===0?(0,I.jsx)(`div`,{className:`text-xs text-destructive`,children:`No collectors configured yet.`}):null,(0,I.jsxs)(Y,{value:String(e.value??`none`),onValueChange:t=>e.onChange(t),disabled:fe.isLoading,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select a collector (or None)`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`none`,children:`None`}),pe.map(e=>(0,I.jsx)($,{value:String(e.id),children:String(e.name)},String(e.id)))]})]})]})}),(0,I.jsx)(Es,{control:y.control,name:`source`,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsxs)(As,{className:`flex items-center gap-2`,children:[`Template source`,(0,I.jsx)(Dl,{children:(0,I.jsxs)(Ol,{children:[(0,I.jsx)(kl,{asChild:!0,children:(0,I.jsx)(en,{className:`h-4 w-4 text-muted-foreground`})}),(0,I.jsx)(Al,{children:(0,I.jsx)(`p`,{children:`Git repository or URL containing deployment templates`})})]})})]}),(0,I.jsxs)(Y,{onValueChange:t=>{e.onChange(t),y.setValue(`templateRepoId`,``),y.setValue(`template`,``)},defaultValue:e.value,children:[(0,I.jsx)(js,{children:(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select source`})})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`workspace`,children:`Workspace repo`}),(0,I.jsx)($,{value:`blueprints`,children:`Blueprints`}),(0,I.jsx)($,{value:`external`,disabled:!ye||T!==`containerlab`&&T!==`clabernetes`&&T!==`terraform`,children:`External repo`})]})]}),!ye&&(T===`containerlab`||T===`clabernetes`||T===`terraform`)&&(0,I.jsx)(Ms,{children:`External repos disabled or not configured for this workspace.`}),(0,I.jsx)(Ns,{})]})}),me===`external`&&(0,I.jsx)(Es,{control:y.control,name:`templateRepoId`,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{children:`External repo`}),(0,I.jsxs)(Y,{onValueChange:t=>{e.onChange(t),y.setValue(`template`,``)},defaultValue:e.value,children:[(0,I.jsx)(js,{children:(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select repo`})})}),(0,I.jsx)(Q,{children:ve.map(e=>(0,I.jsxs)($,{value:e.id,children:[e.name,` (`,e.repo,`)`]},e.id))})]}),(0,I.jsx)(Ns,{})]})}),(T===`netlab`||T===`containerlab`)&&(0,I.jsx)(Es,{control:y.control,name:`netlabServer`,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{children:`Netlab server`}),(0,I.jsxs)(Y,{onValueChange:e.onChange,defaultValue:e.value||oe?.netlabServer||``,value:e.value||oe?.netlabServer||``,children:[(0,I.jsx)(js,{children:(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select server`})})}),(0,I.jsx)(Q,{children:ke.map(e=>(0,I.jsx)($,{value:e.value,children:e.label},e.value))})]}),se.isLoading&&(0,I.jsx)(Ms,{children:`Loading servers`}),(0,I.jsx)(Ns,{})]})}),T===`labpp`&&(0,I.jsx)(Es,{control:y.control,name:`eveServer`,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{children:`EVE-NG server`}),(0,I.jsxs)(Y,{onValueChange:e.onChange,defaultValue:e.value||``,value:e.value||``,children:[(0,I.jsx)(js,{children:(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select server`})})}),(0,I.jsx)(Q,{children:Ee.map(e=>(0,I.jsx)($,{value:`ws:${e.id}`,children:Pl(e.apiUrl)||e.name},e.id))})]}),ue.isLoading&&(0,I.jsx)(Ms,{children:`Loading servers`}),(0,I.jsx)(Ns,{})]})}),(0,I.jsx)(Es,{control:y.control,name:`template`,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(As,{children:`Template`}),(T===`netlab`||T===`netlab-c9s`||T===`containerlab`||T===`clabernetes`)&&(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(L,{type:`button`,variant:`outline`,size:`sm`,disabled:!D,onClick:()=>o(!0),children:`View`}),T===`netlab`||T===`netlab-c9s`?(0,I.jsx)(L,{type:`button`,variant:`outline`,size:`sm`,disabled:!D||xe.isPending,onClick:()=>xe.mutate(),children:xe.isPending?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(un,{className:`mr-2 h-3 w-3 animate-spin`}),` `,`Validating`]}):`Validate`}):null]})]}),T===`terraform`?(0,I.jsxs)(`div`,{className:`grid gap-2 rounded-md border p-3`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Terraform templates are grouped by provider (folder name). Select a provider to filter the template list.`}),(0,I.jsxs)(Y,{value:l,onValueChange:e=>d(e),disabled:k.isLoading||ge.length===0&&he.length===0,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Provider filter`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All providers`}),ge.map(e=>(0,I.jsx)($,{value:e,children:e},e)),(0,I.jsx)($,{value:`ibm`,disabled:!0,children:`ibm (coming soon)`})]})]})]}):null,(0,I.jsxs)(Y,{onValueChange:e.onChange,defaultValue:e.value,disabled:k.isLoading||he.length===0,children:[(0,I.jsx)(js,{children:(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:k.isLoading?`Loading`:he.length?`Select template`:`No templates`})})}),(0,I.jsx)(Q,{children:he.map(e=>(0,I.jsx)($,{value:e,children:e},e))})]}),k.isError&&(0,I.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to load templates.`}),(0,I.jsx)(Ns,{})]})}),(0,I.jsx)(Es,{control:y.control,name:`name`,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{children:`Deployment name`}),(0,I.jsx)(js,{children:(0,I.jsx)(J,{placeholder:`My Deployment`,...e})}),(0,I.jsx)(Ms,{children:`Custom name for this specific deployment instance.`}),(0,I.jsx)(Ns,{})]})})]}),(0,I.jsx)(`div`,{id:`deploy-step-params`,className:`scroll-mt-24`}),(0,I.jsxs)(`div`,{className:`rounded-md border p-4 space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(As,{children:`Environment Variables`}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(T===`netlab-c9s`||T===`netlab`)&&(0,I.jsx)(L,{type:`button`,variant:`outline`,size:`sm`,onClick:()=>c(!0),children:`Supported NETLAB_ vars`}),(0,I.jsxs)(L,{type:`button`,variant:`outline`,size:`sm`,onClick:()=>C({key:``,value:``}),children:[(0,I.jsx)(_,{className:`mr-2 h-3 w-3`}),` Add Variable`]})]})]}),(0,I.jsx)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:(0,I.jsx)(Es,{control:y.control,name:`variableGroupId`,render:({field:e})=>(0,I.jsxs)(ks,{children:[(0,I.jsx)(As,{className:`text-xs text-muted-foreground`,children:`Variable Group`}),(0,I.jsxs)(Y,{onValueChange:e.onChange,defaultValue:e.value||`none`,value:e.value||`none`,children:[(0,I.jsx)(js,{children:(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`None`})})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`none`,children:`None`}),De.map(e=>(0,I.jsx)($,{value:String(e.id),children:e.name},e.id))]})]})]})})}),ee.length>0&&(0,I.jsx)(`div`,{className:`space-y-2`,children:ee.map((e,t)=>(0,I.jsxs)(`div`,{className:`flex gap-2 items-start`,children:[T===`netlab-c9s`||T===`netlab`?(0,I.jsx)(Es,{control:y.control,name:`env.${t}.key`,render:({field:e})=>{let t=String(e.value??``).trim(),n=Fs.some(e=>e.key===t)?t:`__custom__`;return(0,I.jsxs)(ks,{className:`flex-1 space-y-2`,children:[(0,I.jsx)(js,{children:(0,I.jsxs)(Y,{value:n,onValueChange:t=>{t===`__custom__`?e.onChange(``):e.onChange(t)},children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select env var`})}),(0,I.jsxs)(Q,{children:[Fs.map(e=>(0,I.jsx)($,{value:e.key,children:e.label},e.key)),(0,I.jsx)($,{value:`__custom__`,children:`Custom`})]})]})}),n===`__custom__`&&(0,I.jsx)(js,{children:(0,I.jsx)(J,{...e,placeholder:`KEY`,className:`font-mono text-xs`})}),(0,I.jsx)(Ns,{})]})}}):(0,I.jsx)(Es,{control:y.control,name:`env.${t}.key`,render:({field:e})=>(0,I.jsxs)(ks,{className:`flex-1`,children:[(0,I.jsx)(js,{children:(0,I.jsx)(J,{...e,placeholder:`KEY`,className:`font-mono text-xs`})}),(0,I.jsx)(Ns,{})]})}),(0,I.jsx)(Es,{control:y.control,name:`env.${t}.value`,render:({field:e})=>(0,I.jsxs)(ks,{className:`flex-1`,children:[(0,I.jsx)(js,{children:(()=>{let n=String(y.getValues(`env.${t}.key`)??``).trim();if(Ls(n))return(0,I.jsx)(Ps,{...e,placeholder:`One \`key=value\` per line.
Example:
addressing.p2p.ipv4=198.18.0.0/16`,className:`font-mono text-xs min-h-[120px]`});let r=Rs(n);if(!r)return(0,I.jsx)(J,{...e,placeholder:`VALUE`,className:`font-mono text-xs`});let i=String(e.value??``).trim(),a=r.some(e=>e.value===i),o=i?a?i:`__custom__`:`none`;return(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(Y,{value:o,onValueChange:t=>{t===`none`?e.onChange(``):t===`__custom__`?e.onChange(i&&!a?i:``):e.onChange(t)},children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select value`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`none`,children:`None`}),r.map(e=>(0,I.jsx)($,{value:e.value,children:e.label},e.value)),(0,I.jsx)($,{value:`__custom__`,children:`Custom`})]})]}),o===`__custom__`&&(0,I.jsx)(J,{...e,placeholder:`VALUE`,className:`font-mono text-xs`})]})})()}),(0,I.jsx)(Ns,{})]})}),(0,I.jsx)(L,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>te(t),className:`shrink-0`,children:(0,I.jsx)(Mn,{className:`h-4 w-4 text-muted-foreground`})})]},e.id))})]}),(0,I.jsx)(Kn,{open:s,onOpenChange:c,children:(0,I.jsxs)(Yn,{className:`max-w-2xl`,children:[(0,I.jsxs)(Xn,{children:[(0,I.jsx)(Qn,{children:`Supported Netlab overrides`}),(0,I.jsxs)($n,{children:[`These variables are passed into the Netlab generator. Use`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`NETLAB_*`}),` for native Netlab defaults, and`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`SKYFORGE_NETLAB_SET_OVERRIDES`}),` `,`for generator-only`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`netlab --set`}),` overrides.`]})]}),(0,I.jsx)(`div`,{className:`space-y-2 text-sm`,children:Fs.map(e=>(0,I.jsx)(`div`,{className:`flex items-start justify-between gap-3 rounded-md border p-3`,children:(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-medium`,children:e.label}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono break-all`,children:e.key})]})},e.key))})]})}),(0,I.jsx)(`div`,{id:`deploy-step-review`,className:`scroll-mt-24`}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{className:`text-base`,children:`Review`}),(0,I.jsx)(H,{children:`Confirm your selections before creating the deployment.`})]}),(0,I.jsxs)(U,{className:`grid gap-2 text-sm`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`Workspace`}),(0,I.jsx)(`div`,{className:`font-mono text-xs`,children:w||``})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`Provider`}),(0,I.jsx)(`div`,{className:`font-mono text-xs`,children:T})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`Template source`}),(0,I.jsx)(`div`,{className:`font-mono text-xs`,children:me})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`Template`}),(0,I.jsx)(`div`,{className:`font-mono text-xs`,children:D||``})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`Name`}),(0,I.jsx)(`div`,{className:`font-mono text-xs`,children:re||``})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`Env vars`}),(0,I.jsx)(`div`,{className:`font-mono text-xs`,children:(y.getValues(`env`)??[]).filter(e=>e.key?.trim()).length||0})]})]})]}),be.isError&&(0,I.jsx)(`div`,{className:`rounded-md bg-destructive/15 p-3 text-sm text-destructive border border-destructive/20`,children:be.error?.message||`Create failed.`}),(0,I.jsxs)(`div`,{className:`flex gap-3`,children:[f===2?(0,I.jsxs)(L,{type:`submit`,disabled:be.isPending,children:[be.isPending&&(0,I.jsx)(un,{className:`mr-2 h-4 w-4 animate-spin`}),be.isPending?`Creating`:`Create Deployment`]}):(0,I.jsx)(L,{type:`button`,onClick:async()=>{f===0&&!await y.trigger([`workspaceId`,`kind`,`source`,`template`,`name`])||p(e=>e<2?e+1:e)},disabled:be.isPending,children:`Next`}),(0,I.jsx)(L,{type:`button`,variant:`secondary`,onClick:()=>{if(f>0){p(e=>e>0?e-1:e);return}e({to:`/dashboard/deployments`,search:{workspace:w}})},disabled:be.isPending,children:`Back`}),(0,I.jsx)(L,{type:`button`,variant:`outline`,onClick:()=>p(2),disabled:be.isPending,children:`Review`})]})]})})})}),(0,I.jsx)(Kn,{open:a,onOpenChange:o,children:(0,I.jsxs)(Yn,{className:`max-w-4xl`,children:[(0,I.jsxs)(Xn,{children:[(0,I.jsx)(Qn,{children:`Template`}),(0,I.jsx)($n,{className:`font-mono text-xs truncate`,children:String(_e.data?.path??D)})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[_e.isError&&(0,I.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load template.`}),(0,I.jsx)(Ps,{readOnly:!0,value:String(_e.data?.yaml??``),className:`h-[60vh] font-mono text-xs`,placeholder:_e.isLoading?`Loading`:`No template loaded.`})]})]})})]})}const Il=t(`/dashboard/deployments/$deploymentId/`)({component:Ll,validateSearch:e=>{let t={};return typeof e.action==`string`&&e.action.trim()&&(t.action=e.action.trim()),typeof e.node==`string`&&e.node.trim()&&(t.node=e.node.trim()),t}});function Ll(){let{deploymentId:e}=Il.useParams(),{action:t,node:i}=Il.useSearch(),a=n(),o=u();cc(!0);let[s,c]=(0,P.useState)(!1),[l,d]=(0,P.useState)(!1),[p,h]=(0,P.useState)(``),g=r({queryKey:W.dashboardSnapshot(),queryFn:async()=>null,initialData:null,retry:!1,staleTime:1/0}),_=(0,P.useMemo)(()=>(g.data?.deployments??[]).find(t=>t.id===e),[g.data?.deployments,e]),v=String(_?.workspaceId??``),y=String(_?.type??``);(0,P.useEffect)(()=>{let e=!!(_?.config??{}).forwardEnabled,t=String((_?.config??{}).forwardCollectorId??``).trim();d(e),h(t)},[_?.id,_?.config]);let b=String(_?.activeTaskId??``);zc(b,!!b);let x=r({queryKey:W.runLogs(b),queryFn:async()=>({cursor:0,entries:[]}),retry:!1,staleTime:1/0,enabled:!!b}),S=async()=>{try{if(!_)throw Error(`deployment not found`);await Ma(_.workspaceId,_.id),N.success(`Deployment starting`,{description:`${_.name} is queued to start.`})}catch(e){N.error(`Failed to start`,{description:e.message})}},C=async()=>{try{if(!_)throw Error(`deployment not found`);await Na(_.workspaceId,_.id),N.success(`Deployment stopping`,{description:`${_.name} is queued to stop.`})}catch(e){N.error(`Failed to stop`,{description:e.message})}},w=async()=>{try{if(!_)throw Error(`deployment not found`);await Pa(_.workspaceId,_.id),N.success(`Deployment deleted`),await o.invalidateQueries({queryKey:W.dashboardSnapshot()}),a({to:`/dashboard/deployments`,search:{workspace:_.workspaceId}})}catch(e){N.error(`Failed to delete`,{description:e.message})}},T=_?.activeTaskStatus??_?.lastStatus??`unknown`,ne=!!_?.activeTaskId,D=(0,P.useMemo)(()=>{if(!_)return[];let e=(g.data?.runs??[]).filter(e=>String(e.workspaceId??``)===_.workspaceId),t=e.filter(e=>String(e.deploymentId??``)===_.id);return t.length>0?t:e},[_,g.data?.runs]),re=r({queryKey:W.deploymentTopology(v,e),queryFn:async()=>{if(!_)throw Error(`deployment not found`);return $i(_.workspaceId,_.id)},enabled:!!_&&[`containerlab`,`netlab-c9s`,`clabernetes`].includes(y),retry:!1,staleTime:1e4}),O=m({mutationFn:async e=>{if(!_)throw Error(`deployment not found`);return Ri(_.workspaceId,_.id,e)},onSuccess:(e,t)=>{if(e?.skipped){N.message(`Save config skipped`,{description:e.message||`Node ${t}`});return}N.success(`Save config queued/applied`,{description:e.stdout||`Node ${t}`})},onError:e=>N.error(`Save config failed`,{description:e.message})}),ie=async()=>{if(!_)return;let e=re.data?.nodes??[];if(!e.length){N.message(`No nodes to save`);return}if(O.isPending)return;N.message(`Saving configs`,{description:`Nodes: ${e.length}`});let t=e.map(e=>String(e.id)),n=0,r=0,i=0,a=0;if(await Promise.all(Array.from({length:Math.min(3,t.length)},async()=>{for(;n<t.length;){let e=t[n++];try{(await Ri(_.workspaceId,_.id,e))?.skipped?i++:r++}catch{a++}}})),a){N.error(`Save configs finished with errors`,{description:`ok=${r} skipped=${i} failed=${a}`});return}N.success(`Save configs finished`,{description:`ok=${r} skipped=${i}`})},oe=()=>{try{if(!_){N.error(`Cannot download config`,{description:`Deployment not found.`});return}let e=new Blob([JSON.stringify(_.config??{},null,2)],{type:`application/json`}),t=document.createElement(`a`),n=String(_.name??`deployment`).replace(/[^a-zA-Z0-9._-]+/g,`_`);t.href=URL.createObjectURL(e),t.download=`${n}.config.json`,document.body.appendChild(t),t.click(),t.remove(),setTimeout(()=>URL.revokeObjectURL(t.href),5e3),N.success(`Downloaded config`)}catch(e){N.error(`Failed to download config`,{description:e.message})}},se=r({queryKey:W.userForwardCollectorConfigs(),queryFn:ra,enabled:l,retry:!1,staleTime:3e4}),ce=se.data?.collectors??[],le=m({mutationFn:async e=>{if(!_)throw Error(`deployment not found`);return Oi(_.workspaceId,_.id,e)},onSuccess:async()=>{N.success(`Forward settings updated`),await o.invalidateQueries({queryKey:W.dashboardSnapshot()})},onError:e=>N.error(`Failed to update Forward settings`,{description:e.message})}),ue=m({mutationFn:async()=>{if(!_)throw Error(`deployment not found`);return ki(_.workspaceId,_.id)},onSuccess:async e=>{N.success(`Forward sync queued`,{description:`Run ${String(e.run?.id??``)}`}),await o.invalidateQueries({queryKey:W.dashboardSnapshot()})},onError:e=>N.error(`Failed to sync to Forward`,{description:e.message})});if(t&&i&&_){if(t===`terminal`)return(0,I.jsx)(`div`,{className:`h-screen w-screen bg-zinc-950 flex flex-col`,children:(0,I.jsx)(Xc,{workspaceId:v,deploymentId:e,nodeId:i,className:`flex-1`})});if(t===`logs`)return(0,I.jsx)(`div`,{className:`h-screen w-screen bg-background flex flex-col`,children:(0,I.jsx)(Kc,{workspaceId:v,deploymentId:e,nodeId:i,className:`flex-1`})});if(t===`describe`)return(0,I.jsx)(`div`,{className:`h-screen w-screen bg-background flex flex-col`,children:(0,I.jsx)(Wc,{workspaceId:v,deploymentId:e,nodeId:i,className:`flex-1`})})}return _?(0,I.jsxs)(`div`,{className:`space-y-6 p-6 pb-20`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(f,{to:`/dashboard/deployments`,className:mr({variant:`outline`,size:`icon`,className:`h-9 w-9`}),children:(0,I.jsx)(ye,{className:`h-4 w-4`})}),(0,I.jsxs)(`div`,{children:[(0,I.jsxs)(`h1`,{className:`text-2xl font-bold tracking-tight flex items-center gap-3`,children:[_.name,(0,I.jsx)(Rl,{status:T})]}),(0,I.jsxs)(`p`,{className:`text-sm text-muted-foreground flex items-center gap-2 mt-1`,children:[(0,I.jsx)(`span`,{className:`font-mono text-xs bg-muted px-1.5 py-0.5 rounded`,children:_.id}),(0,I.jsx)(`span`,{children:``}),(0,I.jsx)(`span`,{className:`capitalize`,children:_.type})]})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(L,{variant:`outline`,size:`sm`,onClick:S,disabled:ne,children:[(0,I.jsx)(St,{className:`mr-2 h-4 w-4`}),` Start`]}),(0,I.jsxs)(L,{variant:`outline`,size:`sm`,onClick:C,disabled:ne,children:[(0,I.jsx)(ae,{className:`mr-2 h-4 w-4`}),` Stop`]}),(0,I.jsxs)(L,{variant:`destructive`,size:`sm`,onClick:()=>c(!0),disabled:ne,children:[(0,I.jsx)(Mn,{className:`mr-2 h-4 w-4`}),` Delete`]})]})]}),(0,I.jsxs)(fs,{defaultValue:`topology`,className:`space-y-6`,children:[(0,I.jsxs)(ps,{children:[(0,I.jsxs)(ms,{value:`topology`,className:`gap-2`,children:[(0,I.jsx)(sn,{className:`h-4 w-4`}),` Topology`]}),(0,I.jsxs)(ms,{value:`logs`,className:`gap-2`,children:[(0,I.jsx)(ee,{className:`h-4 w-4`}),` Logs & Events`]}),(0,I.jsxs)(ms,{value:`config`,className:`gap-2`,children:[(0,I.jsx)(te,{className:`h-4 w-4`}),` Configuration`]})]}),(0,I.jsxs)(hs,{value:`topology`,className:`space-y-6 animate-in fade-in-50`,children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-3`,children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(V,{children:`Network Topology`}),(0,I.jsx)(H,{children:_.type===`containerlab`?`Derived from containerlab after deploy (includes resolved mgmt IPs).`:_.type===`netlab-c9s`||_.type===`clabernetes`?`Derived from clabernetes after deploy (includes resolved mgmt IPs).`:`Topology is provider-dependent; not yet implemented for this deployment type.`})]}),(0,I.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,I.jsxs)(L,{variant:`outline`,size:`sm`,onClick:()=>{let e=window.location.pathname,t=e.endsWith(`/`)?e.slice(0,-1):e;window.open(`${t}/map`,`_blank`,`noopener,noreferrer`)},title:`Open the full-screen map view in a new tab`,children:[(0,I.jsx)(Ue,{className:`mr-2 h-4 w-4`}),`Open map`]})})]})}),(0,I.jsx)(U,{children:(0,I.jsx)(tl,{topology:re.data,workspaceId:_.workspaceId,deploymentId:_.id,enableTerminal:[`netlab-c9s`,`clabernetes`].includes(_.type)})})]}),re.data?.nodes?.length?(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-3`,children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(V,{children:`Nodes`}),(0,I.jsx)(H,{children:`Quick actions (opens in a new tab where applicable).`})]}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,disabled:O.isPending,onClick:ie,children:O.isPending?`Saving`:`Save all configs`})]})}),(0,I.jsx)(U,{children:(0,I.jsx)(`div`,{className:`space-y-2`,children:re.data.nodes.map(e=>{let t=String(e.id),n=String(e.kind??``),r=String(e.mgmtIp??``),i=String(e.status??``),a=`${window.location.pathname}?node=${encodeURIComponent(t)}`;return(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 rounded-md border p-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:t}),i?(0,I.jsx)(No,{variant:`secondary`,className:`capitalize`,children:i}):null,n?(0,I.jsx)(`span`,{className:`text-xs text-muted-foreground truncate`,children:n}):null]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate mt-1`,children:r||``})]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsx)(L,{size:`sm`,variant:`outline`,disabled:![`netlab-c9s`,`clabernetes`].includes(_.type),onClick:()=>window.open(`${a}&action=terminal`,`_blank`,`noopener,noreferrer`),children:`Terminal`}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,onClick:()=>window.open(`${a}&action=logs`,`_blank`,`noopener,noreferrer`),children:`Logs`}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,onClick:()=>window.open(`${a}&action=describe`,`_blank`,`noopener,noreferrer`),children:`Describe`}),(0,I.jsx)(L,{size:`sm`,variant:`outline`,disabled:O.isPending,onClick:()=>O.mutate(t),children:O.isPending?`Saving`:`Save config`}),(0,I.jsx)(L,{size:`sm`,variant:`ghost`,onClick:()=>{if(!r.trim()){N.error(`No management IP available`);return}navigator.clipboard?.writeText(r),N.success(`Copied management IP`)},children:`Copy IP`})]})]},t)})})})]}):null]}),(0,I.jsx)(hs,{value:`logs`,className:`space-y-6 animate-in fade-in-50`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Logs & Events`}),(0,I.jsx)(H,{children:`Live task output.`})]}),(0,I.jsxs)(U,{children:[_.activeTaskId?(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsxs)(`div`,{className:`text-sm font-medium`,children:[`Active run: `,String(_.activeTaskId)]}),(0,I.jsx)(f,{to:`/dashboard/runs/$runId`,params:{runId:String(_.activeTaskId)},className:mr({variant:`outline`,size:`sm`}),children:`Open run details`})]}),(0,I.jsx)(`div`,{className:`rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100`,children:(0,I.jsx)(zl,{entries:x.data?.entries??[]})})]}):(0,I.jsxs)(`div`,{className:`flex flex-col items-center justify-center py-10 text-center text-muted-foreground border-2 border-dashed rounded-lg`,children:[(0,I.jsx)(ee,{className:`h-10 w-10 mb-3 opacity-20`}),(0,I.jsx)(`p`,{children:`No active run.`}),(0,I.jsx)(`p`,{className:`text-xs mt-1`,children:`Start/stop/destroy will queue runs that appear here.`})]}),(0,I.jsxs)(`div`,{className:`mt-8 space-y-3`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Recent runs`}),(0,I.jsx)(`div`,{className:`space-y-2`,children:D.length===0?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No runs yet.`}):D.slice(0,10).map(e=>{let t=String(e.id??``);return(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3 rounded-md border p-3`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:t}),(0,I.jsx)(No,{variant:`secondary`,className:`capitalize`,children:String(e.status??``)}),(0,I.jsx)(`span`,{className:`text-xs text-muted-foreground truncate`,children:String(e.tpl_alias??e.type??``)})]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground truncate mt-1`,children:String(e.status_text??e.message??``)})]}),(0,I.jsx)(f,{to:`/dashboard/runs/$runId`,params:{runId:t},className:mr({variant:`outline`,size:`sm`}),children:`View`})]},t)})})]})]})]})}),(0,I.jsxs)(hs,{value:`config`,className:`space-y-6 animate-in fade-in-50`,children:[(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Forward Networks`}),(0,I.jsx)(H,{children:`Optional: sync device IPs into Forward for collection.`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Enable Forward collection`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Requires configuring your Collector first.`})]}),(0,I.jsx)(as,{checked:l,disabled:le.isPending,onCheckedChange:e=>{d(e);let t=e?p.trim():``;le.mutate({enabled:e,collectorConfigId:t||void 0})}})]}),l?(0,I.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Collector`}),(0,I.jsxs)(Y,{value:p,onValueChange:e=>{h(e),le.mutate({enabled:!0,collectorConfigId:e})},disabled:se.isLoading||se.isError||le.isPending,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:se.isLoading?`Loading`:se.isError?`Configure Collector first`:`Select collector`})}),(0,I.jsx)(Q,{children:ce.map(e=>(0,I.jsx)($,{value:e.id,children:e.name},e.id))})]})]}),(0,I.jsx)(`div`,{className:`flex items-end gap-2`,children:(0,I.jsx)(L,{variant:`outline`,onClick:()=>ue.mutate(),disabled:!p.trim()||ue.isPending||le.isPending,children:ue.isPending?`Queueing`:`Sync now`})})]}):null]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(V,{children:`Configuration`}),(0,I.jsx)(H,{children:`Read-only view of the deployment parameters.`})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(L,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(JSON.stringify(_.config??{},null,2)),N.success(`Copied config JSON`)},children:[(0,I.jsx)(Te,{className:`mr-2 h-4 w-4`}),`Copy`]}),(0,I.jsxs)(L,{size:`sm`,variant:`outline`,onClick:oe,children:[(0,I.jsx)(E,{className:`mr-2 h-4 w-4`}),`Download`]})]})]})}),(0,I.jsx)(U,{children:(0,I.jsx)(`pre`,{className:`bg-muted p-4 rounded-lg overflow-auto font-mono text-xs max-h-[500px]`,children:JSON.stringify(_.config,null,2)})})]})]})]}),(0,I.jsx)(qo,{open:s,onOpenChange:c,children:(0,I.jsxs)(Xo,{children:[(0,I.jsxs)(Zo,{children:[(0,I.jsx)($o,{children:`Delete deployment?`}),(0,I.jsxs)(es,{children:[`This will remove `,(0,I.jsx)(`strong`,{children:_.name}),` from Skyforge and trigger provider cleanup. This action cannot be undone.`]})]}),(0,I.jsxs)(Qo,{children:[(0,I.jsx)(ns,{children:`Cancel`}),(0,I.jsx)(ts,{onClick:w,className:mr({variant:`destructive`}),children:`Delete Deployment`})]})]})})]}):g.isLoading||g.isFetching?(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,I.jsx)(K,{className:`h-10 w-32`}),(0,I.jsx)(K,{className:`h-10 w-48`})]}),(0,I.jsx)(K,{className:`h-[400px] w-full`})]}):(0,I.jsx)(`div`,{className:`p-6`,children:(0,I.jsx)(To,{icon:Ke,title:`Deployment not found`,description:`This deployment may have been deleted or you don't have access.`,action:{label:`Back to Deployments`,onClick:()=>a({to:`/dashboard/deployments`})}})})}function Rl({status:e}){let t=`secondary`,n=e.toLowerCase();return[`running`,`active`,`healthy`,`succeeded`,`success`].includes(n)&&(t=`default`),[`failed`,`error`,`stopped`,`crashloopbackoff`].includes(n)&&(t=`destructive`),(0,I.jsx)(No,{variant:t,className:`capitalize`,children:e})}function zl(e){let t=(0,P.useRef)(null);return(0,P.useEffect)(()=>{let e=t.current;e&&(e.scrollTop=e.scrollHeight)},[e.entries.length]),e.entries.length===0?(0,I.jsx)(`div`,{className:`text-zinc-500`,children:`Waiting for output`}):(0,I.jsx)(`div`,{ref:t,className:`max-h-[65vh] overflow-auto whitespace-pre-wrap`,children:e.entries.map((e,t)=>(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`span`,{className:`text-zinc-500 select-none`,children:e.time?`${e.time} `:``}),(0,I.jsx)(`span`,{children:e.output})]},`${e.time}-${t}`))})}const Bl=t(`/dashboard/deployments/$deploymentId/map`)({component:Vl});function Vl(){let{deploymentId:e}=Bl.useParams();cc(!0);let t=r({queryKey:W.dashboardSnapshot(),queryFn:async()=>null,initialData:null,retry:!1,staleTime:1/0}),n=(0,P.useMemo)(()=>(t.data?.deployments??[]).find(t=>t.id===e),[e,t.data?.deployments]),i=String(n?.workspaceId??``),a=String(n?.type??``),o=n?.activeTaskStatus??n?.lastStatus??`unknown`,s=r({queryKey:W.deploymentTopology(i,e),queryFn:async()=>{if(!n)throw Error(`deployment not found`);return $i(n.workspaceId,n.id)},enabled:!!n&&[`containerlab`,`netlab-c9s`,`clabernetes`].includes(a),retry:!1,staleTime:1e4});return n?(0,I.jsxs)(`div`,{className:`h-screen w-screen flex flex-col bg-background`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3 border-b px-4 py-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3 min-w-0`,children:[(0,I.jsx)(f,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e},className:mr({variant:`outline`,size:`icon`,className:`h-9 w-9`}),title:`Back to deployment`,children:(0,I.jsx)(ye,{className:`h-4 w-4`})}),(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2 min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-semibold truncate`,children:n.name}),(0,I.jsx)(No,{variant:`secondary`,className:`capitalize`,children:o}),(0,I.jsx)(No,{variant:`outline`,className:`capitalize`,children:a||`unknown`})]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:n.id})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(`a`,{href:`/dashboard/labs/designer?workspaceId=${encodeURIComponent(i)}&importDeploymentId=${encodeURIComponent(e)}`,target:`_blank`,rel:`noreferrer noopener`,className:mr({variant:`outline`,size:`sm`}),title:`Open this running topology in the Lab Designer (new tab)`,children:[(0,I.jsx)(jt,{className:`mr-2 h-4 w-4`}),`Edit in Designer`]}),(0,I.jsxs)(f,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e},className:mr({variant:`outline`,size:`sm`}),title:`Open the deployment page`,children:[(0,I.jsx)(Ue,{className:`mr-2 h-4 w-4`}),`Details`]})]})]}),(0,I.jsx)(`div`,{className:`flex-1 min-h-0 p-3`,children:(0,I.jsx)(`div`,{className:`h-full`,children:(0,I.jsx)(tl,{topology:s.data,workspaceId:n.workspaceId,deploymentId:n.id,enableTerminal:[`netlab-c9s`,`clabernetes`].includes(n.type),fullHeight:!0})})})]}):t.isLoading||t.isFetching?(0,I.jsxs)(`div`,{className:`h-screen w-screen p-6`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(K,{className:`h-9 w-9`}),(0,I.jsx)(K,{className:`h-8 w-64`})]}),(0,I.jsx)(`div`,{className:`mt-6`,children:(0,I.jsx)(K,{className:`h-[75vh] w-full`})})]}):(0,I.jsx)(`div`,{className:`h-screen w-screen p-6`,children:(0,I.jsx)(To,{title:`Deployment not found`,description:`This deployment may have been deleted or you don't have access.`,action:{label:`Back`,onClick:()=>window.close()}})})}var Hl=Do.update({id:`/webhooks`,path:`/webhooks`,getParentRoute:()=>G}),Ul=Ao.update({id:`/syslog`,path:`/syslog`,getParentRoute:()=>G}),Wl=Ho.update({id:`/status`,path:`/status`,getParentRoute:()=>G}),Gl=Go.update({id:`/snmp`,path:`/snmp`,getParentRoute:()=>G}),Kl=os.update({id:`/notifications`,path:`/notifications`,getParentRoute:()=>G}),ql=gs.update({id:`/design`,path:`/design`,getParentRoute:()=>G}),Jl=vs.update({id:`/`,path:`/`,getParentRoute:()=>G}),Yl=bs.update({id:`/dashboard/`,path:`/dashboard/`,getParentRoute:()=>G}),Xl=Ss.update({id:`/admin/`,path:`/admin/`,getParentRoute:()=>G}),Zl=zs.update({id:`/dashboard/settings`,path:`/dashboard/settings`,getParentRoute:()=>G}),Ql=Hs.update({id:`/dashboard/servicenow`,path:`/dashboard/servicenow`,getParentRoute:()=>G}),$l=Ws.update({id:`/dashboard/s3`,path:`/dashboard/s3`,getParentRoute:()=>G}),eu=Ks.update({id:`/dashboard/gemini`,path:`/dashboard/gemini`,getParentRoute:()=>G}),tu=Js.update({id:`/dashboard/forward`,path:`/dashboard/forward`,getParentRoute:()=>G}),nu=Zs.update({id:`/dashboard/claude`,path:`/dashboard/claude`,getParentRoute:()=>G}),ru=$s.update({id:`/dashboard/chatgpt`,path:`/dashboard/chatgpt`,getParentRoute:()=>G}),iu=tc.update({id:`/admin/settings`,path:`/admin/settings`,getParentRoute:()=>G}),au=ic.update({id:`/admin/governance`,path:`/admin/governance`,getParentRoute:()=>G}),ou=oc.update({id:`/dashboard/workspaces/`,path:`/dashboard/workspaces/`,getParentRoute:()=>G}),su=lc.update({id:`/dashboard/runs/`,path:`/dashboard/runs/`,getParentRoute:()=>G}),cu=pc.update({id:`/dashboard/docs/`,path:`/dashboard/docs/`,getParentRoute:()=>G}),lu=yc.update({id:`/dashboard/deployments/`,path:`/dashboard/deployments/`,getParentRoute:()=>G}),uu=Cc.update({id:`/dashboard/workspaces/new`,path:`/dashboard/workspaces/new`,getParentRoute:()=>G}),du=Fc.update({id:`/dashboard/workspaces/$workspaceId`,path:`/dashboard/workspaces/$workspaceId`,getParentRoute:()=>G}),fu=Bc.update({id:`/dashboard/runs/$runId`,path:`/dashboard/runs/$runId`,getParentRoute:()=>G}),pu=ll.update({id:`/dashboard/labs/map`,path:`/dashboard/labs/map`,getParentRoute:()=>G}),mu=_l.update({id:`/dashboard/labs/designer`,path:`/dashboard/labs/designer`,getParentRoute:()=>G}),hu=Tl.update({id:`/dashboard/docs/$slug`,path:`/dashboard/docs/$slug`,getParentRoute:()=>G}),gu=Ml.update({id:`/dashboard/deployments/new`,path:`/dashboard/deployments/new`,getParentRoute:()=>G}),_u=Il.update({id:`/dashboard/deployments/$deploymentId/`,path:`/dashboard/deployments/$deploymentId/`,getParentRoute:()=>G}),vu={IndexRoute:Jl,DesignRoute:ql,NotificationsRoute:Kl,SnmpRoute:Gl,StatusRoute:Wl,SyslogRoute:Ul,WebhooksRoute:Hl,AdminGovernanceRoute:au,AdminSettingsRoute:iu,DashboardChatgptRoute:ru,DashboardClaudeRoute:nu,DashboardForwardRoute:tu,DashboardGeminiRoute:eu,DashboardS3Route:$l,DashboardServicenowRoute:Ql,DashboardSettingsRoute:Zl,AdminIndexRoute:Xl,DashboardIndexRoute:Yl,DashboardDeploymentsNewRoute:gu,DashboardDocsSlugRoute:hu,DashboardLabsDesignerRoute:mu,DashboardLabsMapRoute:pu,DashboardRunsRunIdRoute:fu,DashboardWorkspacesWorkspaceIdRoute:du,DashboardWorkspacesNewRoute:uu,DashboardDeploymentsIndexRoute:lu,DashboardDocsIndexRoute:cu,DashboardRunsIndexRoute:su,DashboardWorkspacesIndexRoute:ou,DashboardDeploymentsDeploymentIdMapRoute:Bl.update({id:`/dashboard/deployments/$deploymentId/map`,path:`/dashboard/deployments/$deploymentId/map`,getParentRoute:()=>G}),DashboardDeploymentsDeploymentIdIndexRoute:_u};const yu=d({routeTree:G._addFileChildren(vu)._addFileTypes(),defaultPreload:`intent`,defaultPreloadDelay:50,context:{queryClient:void 0}});var bu=new s({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1,staleTime:1e4}}});Gn.createRoot(document.getElementById(`root`)).render((0,I.jsx)(P.StrictMode,{children:(0,I.jsx)(i,{client:bu,children:(0,I.jsx)(c,{router:yu,context:{queryClient:bu}})})}));