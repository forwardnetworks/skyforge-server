import{a as e}from"./rolldown-runtime-DAKAggwm.js";import{a as t,c as n,d as r,f as i,g as a,h as o,i as s,l as c,m as l,n as u,o as d,p as f,r as p,s as m,t as h,u as g}from"./tanstack-BOXgL2W4.js";import{$ as _,$t as v,A as y,An as b,At as x,B as ee,Bn as S,Bt as C,C as w,Cn as te,Ct as T,D as E,Dn as D,Dt as O,E as ne,En as re,Et as k,F as ie,Fn as A,Ft as ae,G as oe,Gn as se,Gt as ce,H as le,Hn as ue,Ht as de,I as fe,In as pe,It as me,J as he,Jn as ge,Jt as _e,K as j,Kn as ve,Kt as ye,L as be,Ln as xe,Lt as Se,M as Ce,Mn as we,Mt as Te,N as Ee,Nn as De,Nt as Oe,O as M,On as N,Ot as ke,P as Ae,Pn as je,Pt as Me,Q as Ne,Qn as Pe,Qt as Fe,R as Ie,Rn as Le,Rt as Re,S as ze,Sn as Be,St as Ve,T as He,Tn as Ue,Tt as We,U as Ge,Un as Ke,Ut as qe,V as Je,Vn as Ye,Vt as Xe,W as Ze,Wn as Qe,Wt as $e,X as et,Xn as tt,Xt as nt,Y as rt,Yn as it,Yt as at,Z as ot,Zn as st,Zt as ct,_ as lt,_n as ut,_t as dt,a as ft,an as pt,at as mt,b as ht,bn as gt,bt as _t,c as vt,cn as yt,ct as bt,d as xt,dn as St,dt as Ct,en as wt,et as Tt,f as Et,fn as Dt,ft as Ot,g as kt,gn as At,gt as jt,h as Mt,hn as Nt,ht as Pt,i as Ft,in as It,it as Lt,j as Rt,jn as zt,jt as Bt,k as Vt,kn as Ht,kt as Ut,l as Wt,ln as Gt,lt as Kt,m as qt,mn as Jt,mt as Yt,n as Xt,nn as Zt,nr as Qt,nt as $t,o as en,on as tn,ot as nn,p as rn,pn as an,pt as on,q as sn,qn as cn,qt as ln,r as un,rn as dn,rt as fn,s as pn,sn as mn,st as hn,t as gn,tn as _n,tr as vn,tt as yn,u as bn,un as xn,ut as Sn,v as Cn,vn as wn,vt as Tn,w as En,wn as Dn,wt as On,x as kn,xn as An,xt as jn,y as Mn,yn as Nn,yt as Pn,z as Fn,zn as In,zt as Ln}from"./react-DeK1qnWO.js";import{n as Rn,r as zn,t as Bn}from"./ui-utils-l2x0dF3k.js";import{a as Vn,c as Hn,i as Un,n as Wn,o as Gn,r as Kn,s as qn,t as Jn}from"./vendor-eD_tp6fL.js";(function(){let e=document.createElement(`link`).relList;if(e&&e.supports&&e.supports(`modulepreload`))return;for(let e of document.querySelectorAll(`link[rel="modulepreload"]`))n(e);new MutationObserver(e=>{for(let t of e)if(t.type===`childList`)for(let e of t.addedNodes)e.tagName===`LINK`&&e.rel===`modulepreload`&&n(e)}).observe(document,{childList:!0,subtree:!0});function t(e){let t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin===`use-credentials`?t.credentials=`include`:e.crossOrigin===`anonymous`?t.credentials=`omit`:t.credentials=`same-origin`,t}function n(e){if(e.ep)return;e.ep=!0;let n=t(e);fetch(e.href,n)}})();var Yn=e(Pe(),1),P=e(Qt(),1);function F(...e){return Rn(zn(e))}var I=vn(),Xn=T,Zn=Ve,Qn=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(jn,{ref:n,className:F(`fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t}));Qn.displayName=jn.displayName;var $n=P.forwardRef(({className:e,children:t,...n},r)=>(0,I.jsxs)(Zn,{children:[(0,I.jsx)(Qn,{}),(0,I.jsxs)(Pn,{ref:r,className:F(`fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg`,e),...n,children:[t,(0,I.jsxs)(Tn,{className:`absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground`,children:[(0,I.jsx)(ke,{className:`h-4 w-4`}),(0,I.jsx)(`span`,{className:`sr-only`,children:`Close`})]})]})]}));$n.displayName=Pn.displayName;var er=({className:e,...t})=>(0,I.jsx)(`div`,{className:F(`flex flex-col space-y-1.5 text-center sm:text-left`,e),...t});er.displayName=`DialogHeader`;var tr=({className:e,...t})=>(0,I.jsx)(`div`,{className:F(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});tr.displayName=`DialogFooter`;var nr=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(On,{ref:n,className:F(`text-lg font-semibold leading-none tracking-tight`,e),...t}));nr.displayName=On.displayName;var rr=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(_t,{ref:n,className:F(`text-sm text-muted-foreground`,e),...t}));rr.displayName=_t.displayName;var ir=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(jt,{ref:n,className:F(`flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground`,e),...t}));ir.displayName=jt.displayName;var ar=({children:e,...t})=>(0,I.jsx)(Xn,{...t,children:(0,I.jsx)($n,{className:`overflow-hidden p-0 shadow-lg`,children:(0,I.jsx)(ir,{className:`[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5`,children:e})})}),or=P.forwardRef(({className:e,...t},n)=>(0,I.jsxs)(`div`,{className:`flex items-center border-b px-3`,"cmdk-input-wrapper":``,children:[(0,I.jsx)(ln,{className:`mr-2 h-4 w-4 shrink-0 opacity-50`}),(0,I.jsx)(jt.Input,{ref:n,className:F(`flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50`,e),...t})]}));or.displayName=jt.Input.displayName;var sr=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(jt.List,{ref:n,className:F(`max-h-[300px] overflow-y-auto overflow-x-hidden`,e),...t}));sr.displayName=jt.List.displayName;var cr=P.forwardRef((e,t)=>(0,I.jsx)(jt.Empty,{ref:t,className:`py-6 text-center text-sm`,...e}));cr.displayName=jt.Empty.displayName;var lr=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(jt.Group,{ref:n,className:F(`overflow-hidden p-1 text-popover-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground`,e),...t}));lr.displayName=jt.Group.displayName;var ur=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(jt.Separator,{ref:n,className:F(`-mx-1 h-px bg-border`,e),...t}));ur.displayName=jt.Separator.displayName;var dr=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(jt.Item,{ref:n,className:F(`relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none aria-selected:bg-accent aria-selected:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...t}));dr.displayName=jt.Item.displayName;var fr=({className:e,...t})=>(0,I.jsx)(`span`,{className:F(`ml-auto text-xs tracking-widest text-muted-foreground`,e),...t});fr.displayName=`CommandShortcut`;const pr=`/api`;function mr(e){let t=e.startsWith(`/`)?e:`/`;return`${pr}/oidc/login?next=${encodeURIComponent(t)}`}var hr=class extends Error{status;bodyText;constructor(e,t,n){super(e),this.name=`ApiError`,this.status=t,this.bodyText=n}};function gr(e){let t=(e??``).trim();if(!t)return``;try{let e=JSON.parse(t);if(typeof e?.message==`string`&&e.message.trim())return e.message.trim();if(typeof e?.error?.message==`string`&&e.error.message.trim())return e.error.message.trim()}catch{}return t}async function L(e,t){let n=(t?.method??`GET`).toUpperCase(),r=await fetch(`${e}`,{credentials:`include`,...t,headers:{"Content-Type":`application/json`,...t?.headers??{}}});if(r.status===401){let e=await r.text().catch(()=>``);if(n===`GET`&&typeof window<`u`){let e=window.location.pathname+(window.location.search??``);window.location.href=mr(e)}throw new hr(`unauthorized`,r.status,e)}if(r.status===403){let e=await r.text().catch(()=>``),t=gr(e);throw new hr(t?`forbidden: ${t}`:`forbidden`,r.status,e)}if(!r.ok){let e=await r.text().catch(()=>``),t=gr(e);throw new hr(t?`request failed (${r.status}): ${t}`:`request failed (${r.status})`,r.status,e)}return r.status===204?{}:await r.json()}async function _r(){return L(`/api/session`)}async function vr(){let e=await fetch(`/auth/logout`,{method:`POST`,credentials:`include`,headers:{"Content-Type":`application/json`},body:`{}`});if(!e.ok){let t=await e.text().catch(()=>``);throw Error(`logout failed (${e.status}): ${t}`)}}async function yr(){let e=await L(`/api/dashboard/snapshot`),t=Array.isArray(e?.deployments)?e.deployments.map(e=>({...e,ownerUsername:String(e?.ownerUsername??``)})):[];return{...e,deployments:t}}async function br(e,t){let n=new URLSearchParams;t?.include_read&&n.set(`include_read`,t.include_read),t?.limit&&n.set(`limit`,t.limit);let r=n.toString();return L(`/notifications/for-user/${encodeURIComponent(e)}${r?`?${r}`:``}`)}async function xr(e){return L(`/notifications/for-user/${encodeURIComponent(e)}/read-all`,{method:`PUT`})}async function Sr(e){return L(`/notifications/single/${encodeURIComponent(e)}/read`,{method:`PUT`})}async function Cr(e){return L(`/notifications/single/${encodeURIComponent(e)}`,{method:`DELETE`})}async function wr(e,t){let n=new URLSearchParams;t?.server&&n.set(`server`,t.server),t?.path&&n.set(`path`,t.path),t?.recursive&&n.set(`recursive`,`true`);let r=n.toString();return L(`/api/eve/labs${r?`?${r}`:``}`)}async function Tr(e,t){return L(`/api/eve/import`,{method:`POST`,body:JSON.stringify(t)})}async function Er(e,t){return L(`/api/eve/convert`,{method:`POST`,body:JSON.stringify(t)})}async function Dr(){return L(`/api/user/integrations/servicenow`)}async function Or(e){return L(`/api/user/integrations/servicenow`,{method:`PUT`,body:JSON.stringify(e)})}async function kr(){return L(`/api/user/integrations/servicenow/install`,{method:`POST`,body:`{}`})}async function Ar(){return L(`/api/user/integrations/servicenow/pdiStatus`)}async function jr(){return L(`/api/user/integrations/servicenow/schemaStatus`)}async function Mr(){return L(`/api/user/integrations/servicenow/wake`,{method:`POST`,body:`{}`})}async function Nr(){return L(`/api/user/integrations/servicenow/configureForwardTicketing`,{method:`POST`,body:`{}`})}async function Pr(){return L(`/api/user/integrations/elastic`)}async function Fr(e){return L(`/api/user/integrations/elastic`,{method:`PUT`,body:JSON.stringify(e)})}async function Ir(){await L(`/api/user/integrations/elastic/clear`,{method:`POST`,body:`{}`})}async function Lr(){return L(`/api/user/integrations/elastic/test`,{method:`POST`,body:`{}`})}async function Rr(e){return L(`/api/user/ai/validate`,{method:`POST`,body:JSON.stringify(e)})}async function zr(e){return L(`/api/user/ai/autofix`,{method:`POST`,body:JSON.stringify(e)})}async function Br(e){return L(`/api/user/ai/generate-topology-spec`,{method:`POST`,body:JSON.stringify(e)})}async function Vr(){return L(`/api/system/elastic/tools/status`)}async function Hr(){return L(`/api/system/elastic/tools/wake`,{method:`POST`,body:`{}`})}async function Ur(){return L(`/api/user/git-credentials`)}async function Wr(){return L(`/api/user/settings`)}async function Gr(e){return L(`/api/user/settings`,{method:`PUT`,body:JSON.stringify(e)})}async function Kr(){return L(`/api/blueprints/sync`,{method:`POST`,body:`{}`})}async function qr(e){let t=new URLSearchParams;e?.credentialId&&t.set(`credentialId`,e.credentialId);let n=t.toString();return L(`/api/forward/networks${n?`?${n}`:``}`)}async function Jr(){return L(`/api/user/api-tokens`)}async function Yr(e){return L(`/api/user/api-tokens`,{method:`POST`,body:JSON.stringify(e??{})})}async function Xr(e){await L(`/api/user/api-tokens/${encodeURIComponent(e)}`,{method:`DELETE`})}async function Zr(){return L(`/api/aws/sso/config`)}async function Qr(){return L(`/api/aws/sso/status`)}async function $r(){return L(`/api/aws/sso/start`,{method:`POST`,body:`{}`})}async function ei(e){return L(`/api/aws/sso/poll`,{method:`POST`,body:JSON.stringify(e)})}async function ti(){return L(`/api/aws/sso/logout`,{method:`POST`,body:`{}`})}async function ni(){return L(`/api/user/cloud/aws-static`)}async function ri(e){return L(`/api/user/cloud/aws-static`,{method:`PUT`,body:JSON.stringify(e)})}async function ii(){await L(`/api/user/cloud/aws-static`,{method:`DELETE`})}async function ai(){return L(`/api/user/cloud/azure`)}async function oi(e){return L(`/api/user/cloud/azure`,{method:`PUT`,body:JSON.stringify(e)})}async function si(){await L(`/api/user/cloud/azure`,{method:`DELETE`})}async function ci(){return L(`/api/user/cloud/gcp`)}async function li(e){return L(`/api/user/cloud/gcp`,{method:`PUT`,body:JSON.stringify(e)})}async function ui(){await L(`/api/user/cloud/gcp`,{method:`DELETE`})}async function di(){return L(`/api/user/cloud/ibm`)}async function fi(e){return L(`/api/user/cloud/ibm`,{method:`PUT`,body:JSON.stringify(e)})}async function pi(){await L(`/api/user/cloud/ibm`,{method:`DELETE`})}async function mi(){return L(`/api/user/netlab/servers`)}async function hi(e){return L(`/api/user/netlab/servers`,{method:`PUT`,body:JSON.stringify(e)})}async function gi(e){await L(`/api/user/netlab/servers/${encodeURIComponent(e)}`,{method:`DELETE`})}async function _i(){return L(`/api/user/eve/servers`)}async function vi(e){return L(`/api/user/eve/servers`,{method:`PUT`,body:JSON.stringify(e)})}async function yi(e){await L(`/api/user/eve/servers/${encodeURIComponent(e)}`,{method:`DELETE`})}async function bi(){return L(`/api/user/containerlab/servers`)}async function xi(e){return L(`/api/user/containerlab/servers`,{method:`PUT`,body:JSON.stringify(e)})}async function Si(e){await L(`/api/user/containerlab/servers/${encodeURIComponent(e)}`,{method:`DELETE`})}async function Ci(e,t){return L(`/api/deployments/${encodeURIComponent(e)}/forward`,{method:`PUT`,body:JSON.stringify(t)})}async function wi(e){return L(`/api/deployments/${encodeURIComponent(e)}/forward/sync`,{method:`POST`,body:`{}`})}async function Ti(e){return L(`/api/deployments/${encodeURIComponent(e)}/capacity/summary`)}async function Ei(e){return L(`/api/deployments/${encodeURIComponent(e)}/capacity/rollups/refresh`,{method:`POST`,body:`{}`})}async function Di(e){return L(`/api/fwd/${encodeURIComponent(e)}/capacity/summary`)}async function Oi(e){return L(`/api/fwd/${encodeURIComponent(e)}/capacity/rollups/refresh`,{method:`POST`,body:`{}`})}async function ki(e){return L(`/api/fwd/${encodeURIComponent(e)}/assurance/summary`)}async function Ai(e){return L(`/api/fwd/${encodeURIComponent(e)}/assurance/refresh`,{method:`POST`,body:`{}`})}async function ji(e,t){let n=new URLSearchParams;t&&n.set(`limit`,t);let r=n.toString()?`?${n.toString()}`:``;return L(`/api/fwd/${encodeURIComponent(e)}/assurance/summary/history${r}`)}async function Mi(e){return L(`/api/fwd/${encodeURIComponent(e)}/assurance/demo/seed`,{method:`POST`,body:`{}`})}async function Ni(e){return L(`/api/fwd/${encodeURIComponent(e)}/capacity/coverage`)}async function Pi(e){return L(`/api/fwd/${encodeURIComponent(e)}/capacity/snapshot-delta`)}async function Fi(e,t={}){let n=new URLSearchParams;t.window&&n.set(`window`,t.window);let r=n.toString()?`?${n.toString()}`:``,i=await L(`/api/fwd/${encodeURIComponent(e)}/capacity/upgrade-candidates${r}`);return{...i,items:(i.items??[]).map(e=>({...e,objectType:String(e.objectType??``)}))}}async function Ii(e){return L(`/api/deployments/${encodeURIComponent(e)}/capacity/inventory`)}async function Li(e){return L(`/api/fwd/${encodeURIComponent(e)}/capacity/inventory`)}async function Ri(e,t){let n=new URLSearchParams;return n.set(`metric`,t.metric),n.set(`window`,t.window),t.objectType&&n.set(`objectType`,t.objectType),t.compareHours&&n.set(`compareHours`,String(t.compareHours)),t.limit&&n.set(`limit`,String(t.limit)),L(`/api/deployments/${encodeURIComponent(e)}/capacity/growth?${n.toString()}`)}async function zi(e,t){let n=new URLSearchParams;return n.set(`metric`,t.metric),n.set(`window`,t.window),t.objectType&&n.set(`objectType`,t.objectType),t.compareHours&&n.set(`compareHours`,String(t.compareHours)),t.limit&&n.set(`limit`,String(t.limit)),L(`/api/fwd/${encodeURIComponent(e)}/capacity/growth?${n.toString()}`)}async function Bi(e,t){return L(`/api/deployments/${encodeURIComponent(e)}/capacity/perf/interface-metrics-history`,{method:`POST`,body:JSON.stringify(t)})}async function Vi(e,t){return L(`/api/fwd/${encodeURIComponent(e)}/capacity/perf/interface-metrics-history`,{method:`POST`,body:JSON.stringify(t)})}async function Hi(e,t){return L(`/api/deployments/${encodeURIComponent(e)}/capacity/perf/device-metrics-history`,{method:`POST`,body:JSON.stringify(t)})}async function Ui(e,t){return L(`/api/fwd/${encodeURIComponent(e)}/capacity/perf/device-metrics-history`,{method:`POST`,body:JSON.stringify(t)})}async function Wi(e,t){let n=new URLSearchParams;t.snapshotId&&n.set(`snapshotId`,t.snapshotId),t.endTime&&n.set(`endTime`,t.endTime);let r=n.toString()?`?${n.toString()}`:``;return L(`/api/deployments/${encodeURIComponent(e)}/capacity/perf/unhealthy-devices${r}`)}async function Gi(e,t){let n=new URLSearchParams;t.snapshotId&&n.set(`snapshotId`,t.snapshotId),t.endTime&&n.set(`endTime`,t.endTime);let r=n.toString()?`?${n.toString()}`:``;return L(`/api/fwd/${encodeURIComponent(e)}/capacity/perf/unhealthy-devices${r}`)}async function Ki(e,t){return L(`/api/deployments/${encodeURIComponent(e)}/links/impair`,{method:`POST`,body:JSON.stringify(t)})}async function qi(e,t){return L(`/api/deployments/${encodeURIComponent(e)}/links/admin`,{method:`POST`,body:JSON.stringify(t)})}async function Ji(e,t){return L(`/api/deployments/${encodeURIComponent(e)}/links/capture`,{method:`POST`,body:JSON.stringify(t)})}async function Yi(e,t){return L(`/api/deployments/${encodeURIComponent(e)}/nodes/${encodeURIComponent(t)}/interfaces`)}async function Xi(e,t){return L(`/api/deployments/${encodeURIComponent(e)}/nodes/${encodeURIComponent(t)}/running-config`)}async function Zi(e,t=`json`){let n=new URLSearchParams;return n.set(`format`,t),L(`/api/deployments/${encodeURIComponent(e)}/inventory?${n.toString()}`)}async function Qi(e,t,n){let r=new URLSearchParams;n?.tail&&r.set(`tail`,String(n.tail)),n?.container&&r.set(`container`,n.container);let i=r.toString();return L(`/api/deployments/${encodeURIComponent(e)}/nodes/${encodeURIComponent(t)}/logs${i?`?${i}`:``}`)}async function $i(e,t){return L(`/api/deployments/${encodeURIComponent(e)}/nodes/${encodeURIComponent(t)}/describe`)}async function ea(e,t){return L(`/api/deployments/${encodeURIComponent(e)}/nodes/${encodeURIComponent(t)}/save-config`,{method:`POST`,body:`{}`})}async function ta(e){return L(`/api/deployments/${encodeURIComponent(e)}/links/stats`)}async function na(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return L(`/api/netlab/templates${r?`?${r}`:``}`)}async function ra(e,t){let n=new URLSearchParams;return t.source&&n.set(`source`,t.source),t.repo&&n.set(`repo`,t.repo),t.dir&&n.set(`dir`,t.dir),n.set(`template`,t.template),L(`/api/netlab/template?${n.toString()}`)}async function ia(e,t){return L(`/api/netlab/validate`,{method:`POST`,body:JSON.stringify(t)})}async function aa(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return L(`/api/containerlab/templates${r?`?${r}`:``}`)}async function oa(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return L(`/api/terraform/templates${r?`?${r}`:``}`)}async function sa(e,t){let n=new URLSearchParams;return t.source&&n.set(`source`,t.source),t.repo&&n.set(`repo`,t.repo),t.dir&&n.set(`dir`,t.dir),n.set(`file`,t.file),L(`/api/containerlab/template?${n.toString()}`)}async function ca(e,t){let n=new URLSearchParams;t?.source&&n.set(`source`,t.source),t?.repo&&n.set(`repo`,t.repo),t?.dir&&n.set(`dir`,t.dir);let r=n.toString();return L(`/api/eve-ng/templates${r?`?${r}`:``}`)}async function la(e,t){return L(`/api/deployments`,{method:`POST`,body:JSON.stringify(t)})}async function ua(e,t){let n=await L(`/api/containerlab/topologies`,{method:`POST`,body:JSON.stringify(t)});return{...n,ownerUsername:String(n?.ownerUsername??n.ownerUsername??e)}}async function da(e,t){let n=await L(`/api/netlab/topologies`,{method:`POST`,body:JSON.stringify(t)});return{...n,ownerUsername:String(n?.ownerUsername??n.ownerUsername??e)}}async function fa(e,t){return L(`/api/deployments-designer/clabernetes/from-template`,{method:`POST`,body:JSON.stringify(t)})}async function pa(e,t){return L(`/api/deployments-designer/containerlab/from-template`,{method:`POST`,body:JSON.stringify(t)})}async function ma(e){return L(`/api/deployments/${encodeURIComponent(e)}/topology`)}async function ha(e){let t=new URLSearchParams;e?.q&&t.set(`q`,e.q),e?.n&&t.set(`n`,String(e.n));let n=t.toString();return L(`/api/registry/repos${n?`?${n}`:``}`)}async function ga(e,t){let n=new URLSearchParams;t?.q&&n.set(`q`,t.q);let r=n.toString();return L(`/api/registry/repos/${encodeURIComponent(e)}/tags${r?`?${r}`:``}`)}async function _a(){return L(`/api/forward/collector-configs`)}async function va(e){return L(`/api/forward/collector-configs`,{method:`POST`,body:JSON.stringify(e)})}async function ya(e){return L(`/api/forward/collector-configs/${encodeURIComponent(e)}`,{method:`DELETE`})}async function ba(e,t){let n=new URLSearchParams;t&&t>0&&n.set(`tail`,String(t));let r=n.toString();return L(`/api/forward/collector-configs/${encodeURIComponent(e)}/logs${r?`?${r}`:``}`)}async function xa(e){return L(`/api/forward/collector-configs/${encodeURIComponent(e)}/restart`,{method:`POST`,body:`{}`})}async function Sa(){return L(`/api/forward/credential-sets`)}async function Ca(e){return L(`/api/forward/credential-sets`,{method:`POST`,body:JSON.stringify(e)})}async function wa(e,t){return L(`/api/forward/credential-sets/${encodeURIComponent(e)}`,{method:`PUT`,body:JSON.stringify(t)})}async function Ta(e){return L(`/api/forward/credential-sets/${encodeURIComponent(e)}`,{method:`DELETE`})}async function Ea(){return L(`/api/integrations/forward`)}async function Da(e){let t=typeof e==`string`?{credentialId:e}:e;return L(`/api/integrations/forward/apply-credential-set`,{method:`POST`,body:JSON.stringify(t)})}async function Oa(){return L(`/api/integrations/forward`,{method:`DELETE`})}async function ka(e,t){let n=new URLSearchParams;t?.prefix&&n.set(`prefix`,t.prefix),t?.limit&&n.set(`limit`,t.limit);let r=n.toString();return L(`/api/artifacts${r?`?${r}`:``}`)}async function Aa(e,t){return L(`/api/artifacts/download?${new URLSearchParams({key:t}).toString()}`)}async function ja(e,t){return L(`/api/artifacts/object`,{method:`POST`,body:JSON.stringify(t)})}async function Ma(e,t){return L(`/api/artifacts/object?${new URLSearchParams({key:t}).toString()}`,{method:`DELETE`})}async function Na(e,t){return L(`/api/artifacts/folder`,{method:`POST`,body:JSON.stringify({prefix:t})})}async function Pa(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit),e?.before_id&&t.set(`before_id`,e.before_id);let n=t.toString();return L(`/api/webhooks/events${n?`?${n}`:``}`)}async function Fa(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit),e?.before_id&&t.set(`before_id`,e.before_id),e?.source_ip&&t.set(`source_ip`,e.source_ip),e?.unassigned&&t.set(`unassigned`,e.unassigned);let n=t.toString();return L(`/api/syslog/events${n?`?${n}`:``}`)}async function Ia(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit),e?.before_id&&t.set(`before_id`,e.before_id);let n=t.toString();return L(`/api/snmp/traps/events${n?`?${n}`:``}`)}async function La(){let e=await L(`/api/admin/governance/summary`);return{...e,usersTracked:Number(e?.usersTracked??0)}}async function Ra(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString(),r=await L(`/api/admin/governance/resources${n?`?${n}`:``}`);return{...r,resources:(r.resources??[]).map(e=>({...e,ownerUsername:String(e?.ownerUsername??``),ownerLabel:String(e?.ownerLabel??e?.ownerUsername??``)}))}}async function za(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString(),r=await L(`/api/admin/governance/costs${n?`?${n}`:``}`);return{...r,costs:(r.costs??[]).map(e=>({...e,ownerUsername:String(e?.ownerUsername??``),ownerLabel:String(e?.ownerLabel??e?.ownerUsername??``)}))}}async function Ba(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString(),r=await L(`/api/admin/governance/usage${n?`?${n}`:``}`);return{...r,usage:(r.usage??[]).map(e=>({...e,ownerUsername:String(e?.ownerUsername??``),ownerLabel:String(e?.ownerLabel??e?.ownerUsername??``),userType:String(e?.userType??``)}))}}async function Va(){await L(`/api/admin/governance/sync`,{method:`POST`,body:`{}`})}async function Ha(){return L(`/api/admin/config`)}async function Ua(e){let t=new URLSearchParams;e?.limit&&t.set(`limit`,e.limit);let n=t.toString(),r=await L(`/api/admin/audit${n?`?${n}`:``}`);return{...r,events:(r.events??[]).map(e=>({...e,ownerUsername:String(e?.ownerUsername??e?.ownerUsername??``)}))}}async function Wa(){return L(`/api/admin/impersonate/status`)}async function Ga(e){return L(`/api/admin/impersonate/start`,{method:`POST`,body:JSON.stringify(e)})}async function Ka(){return L(`/api/admin/impersonate/stop`,{method:`POST`,body:`{}`})}async function qa(e){return L(`/api/admin/tasks/reconcile`,{method:`POST`,body:JSON.stringify(e)})}async function Ja(e){return L(`/api/admin/tasks/reconcile-running`,{method:`POST`,body:JSON.stringify(e)})}async function Ya(e){let t=await L(`/api/admin/users/purge`,{method:`POST`,body:JSON.stringify(e)});return{...t,deletedOwners:Number(t?.deletedOwners??0)}}async function Xa(){return L(`/api/admin/governance/policy`)}async function Za(e){return L(`/api/admin/governance/policy`,{method:`PUT`,body:JSON.stringify(e)})}async function Qa(e){return L(`/api/deployments/${encodeURIComponent(e)}/start`,{method:`POST`,body:`{}`})}async function $a(e){return L(`/api/deployments/${encodeURIComponent(e)}/stop`,{method:`POST`,body:`{}`})}async function eo(e,t){let n=new URLSearchParams;t?.forwardDelete&&n.set(`forward_delete`,`true`);let r=n.toString();return L(`/api/deployments/${encodeURIComponent(e)}${r?`?${r}`:``}`,{method:`DELETE`})}async function to(){return L(`/api/ui/config`)}async function no(){return L(`/status/summary`)}async function ro(e,t){return L(`/api/runs/${encodeURIComponent(String(e))}/cancel`,{method:`POST`,body:`{}`})}async function io(){return L(`/api/user/variable-groups`)}async function ao(e){return L(`/api/user/variable-groups`,{method:`POST`,body:JSON.stringify(e)})}async function oo(e,t){return L(`/api/user/variable-groups/${encodeURIComponent(e)}`,{method:`PUT`,body:JSON.stringify(t)})}async function so(e){return L(`/api/user/variable-groups/${encodeURIComponent(e)}`,{method:`DELETE`})}async function co(e){return L(`/api/fwd`,{method:`POST`,body:JSON.stringify(e)})}async function lo(){return L(`/api/fwd`)}async function uo(e){return L(`/api/fwd/${encodeURIComponent(e)}`,{method:`DELETE`})}function fo(e,t){let n=e.features;return n?!!n[t]:!0}var po=[{id:`operate`,label:`Operate`,icon:Dt,defaultExpanded:!0,items:[{id:`status`,label:`Status`,href:`/status`,icon:Dt,matchPrefixes:[`/status`]},{id:`deployments`,label:`Deployments`,href:`/dashboard/deployments`,icon:te,matchPrefixes:[`/dashboard/deployments`]},{id:`runs`,label:`Runs`,href:`/dashboard/runs`,icon:Ut,matchPrefixes:[`/dashboard/runs`]},{id:`notifications`,label:`Notifications`,href:`/notifications`,icon:ge,matchPrefixes:[`/notifications`]}]},{id:`labs`,label:`Labs`,icon:ut,items:[{id:`designer`,label:`Designer`,href:`/dashboard/labs/designer`,icon:ut,matchPrefixes:[`/dashboard/labs/designer`]},{id:`labs-map`,label:`Topology Map`,href:`/dashboard/labs/map`,icon:mn,matchPrefixes:[`/dashboard/labs/map`]}]},{id:`forward`,label:`Forward`,icon:dn,defaultExpanded:!0,items:[{id:`fwd`,label:`Assurance Hub`,href:`/dashboard/fwd`,icon:dn,matchPrefixes:[`/dashboard/fwd`],visible:e=>fo(e,`forwardEnabled`)},{id:`forward-onprem`,label:`Forward On-Prem`,href:`/fwd/`,icon:dn,external:!0,newTab:!0,matchPrefixes:[`/fwd`],visible:e=>fo(e,`forwardEnabled`)},{id:`forward-collector`,label:`Forward Collector`,href:`/dashboard/fwd/collector`,icon:Fe,matchPrefixes:[`/dashboard/fwd/collector`],visible:e=>fo(e,`forwardEnabled`)},{id:`policy-compliance`,label:`Routing & Compliance`,href:`/dashboard/policy-reports`,icon:$e,matchPrefixes:[`/dashboard/policy-reports`],searchTerms:[`Policy Reports`],visible:e=>fo(e,`forwardEnabled`)}]},{id:`integrations`,label:`Integrations`,icon:dn,defaultExpanded:!0,items:[{id:`integrations-overview`,label:`Integrations Overview`,href:`/dashboard/integrations`,icon:Ut,matchPrefixes:[`/dashboard/integrations`]},{id:`servicenow`,label:`ServiceNow`,href:`/dashboard/servicenow`,icon:Ut,matchPrefixes:[`/dashboard/servicenow`],visible:e=>fo(e,`forwardEnabled`)},{id:`elastic`,label:`Elastic`,href:`/dashboard/elastic`,icon:b,matchPrefixes:[`/dashboard/elastic`],visible:e=>fo(e,`forwardEnabled`)&&fo(e,`elasticEnabled`)},{id:`artifacts`,label:`Artifacts`,href:`/dashboard/s3`,icon:ye,matchPrefixes:[`/dashboard/s3`],visible:e=>fo(e,`minioEnabled`)},{id:`git`,label:`Git`,href:`/git/`,icon:Nn,external:!0,matchPrefixes:[`/git`],visible:e=>fo(e,`giteaEnabled`)},{id:`dns`,label:`DNS`,href:`${pr}/dns/sso?next=/dns/`,icon:dn,external:!0,visible:e=>fo(e,`dnsEnabled`)},{id:`coder`,label:`Coder`,href:`${pr}/coder/launch`,icon:je,external:!0,matchPrefixes:[`/coder`],visible:e=>fo(e,`coderEnabled`)},{id:`coder-admin`,label:`Coder Admin`,href:`/coder/`,icon:je,external:!0,matchPrefixes:[`/coder`],adminOnly:!0,visible:e=>fo(e,`coderEnabled`)},{id:`kibana`,label:`Kibana`,href:`/kibana/`,icon:b,external:!0,matchPrefixes:[`/kibana`],visible:e=>fo(e,`forwardEnabled`)&&fo(e,`elasticEnabled`)},{id:`netbox`,label:`NetBox`,href:`/netbox/`,icon:dn,external:!0,matchPrefixes:[`/netbox`],visible:e=>fo(e,`netboxEnabled`)},{id:`nautobot`,label:`Nautobot`,href:`/nautobot/`,icon:dn,external:!0,matchPrefixes:[`/nautobot`],visible:e=>fo(e,`nautobotEnabled`)}]},{id:`observability-apis`,label:`Observability & APIs`,icon:Zt,items:[{id:`webhooks`,label:`Webhooks`,href:`/webhooks`,icon:x,matchPrefixes:[`/webhooks`]},{id:`syslog`,label:`Syslog`,href:`/syslog`,icon:At,matchPrefixes:[`/syslog`]},{id:`snmp`,label:`SNMP`,href:`/snmp`,icon:$e,matchPrefixes:[`/snmp`]},{id:`api-docs`,label:`API Docs`,href:`/redoc/`,icon:cn,external:!0,matchPrefixes:[`/redoc`]},{id:`api-testing`,label:`API Testing`,href:`${pr}/yaade/sso`,icon:Zt,external:!0,visible:e=>fo(e,`yaadeEnabled`)},{id:`docs`,label:`Docs`,href:`/dashboard/docs`,icon:cn,matchPrefixes:[`/dashboard/docs`]}]},{id:`settings`,label:`Settings`,icon:ce,items:[{id:`my-settings`,label:`My Settings`,href:`/dashboard/settings`,icon:ce,matchPrefixes:[`/dashboard/settings`]},{id:`admin-settings`,label:`Admin Settings`,href:`/admin/settings`,icon:ce,adminOnly:!0,matchPrefixes:[`/admin/settings`]},{id:`governance`,label:`Governance`,href:`/admin/governance`,icon:$e,adminOnly:!0,matchPrefixes:[`/admin/governance`]}]}];function mo(e,t){return!(e.adminOnly&&!t.isAdmin||e.visible&&!e.visible(t))}function ho(e){return po.map(t=>({...t,items:t.items.filter(t=>mo(t,e))})).filter(e=>e.items.length>0)}function go(e,t){let n=t.matchPrefixes??[];for(let t of n)if(e===t||e.startsWith(`${t}/`))return!0;return!t.href||t.href.startsWith(`http://`)||t.href.startsWith(`https://`)?!1:t.href===`/`?e===`/`:t.href.endsWith(`/`)?e.startsWith(t.href):e===t.href||e.startsWith(`${t.href}/`)}function _o(e){let[t,n]=P.useState(!1),r=c(),i=P.useMemo(()=>ho({isAdmin:e.isAdmin,features:e.features}),[e.isAdmin,e.features]);P.useEffect(()=>{let e=e=>{e.key===`k`&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),n(e=>!e))};return document.addEventListener(`keydown`,e),()=>document.removeEventListener(`keydown`,e)},[]);let a=P.useCallback(e=>{if(e.external||e.newTab){window.open(e.href,`_blank`,`noopener,noreferrer`);return}r({to:e.href})},[r]),o=P.useCallback(e=>{n(!1),a(e)},[a]);return(0,I.jsxs)(ar,{open:t,onOpenChange:n,children:[(0,I.jsx)(or,{placeholder:`Type a command or search...`}),(0,I.jsxs)(sr,{children:[(0,I.jsx)(cr,{children:`No results found.`}),i.map((e,t)=>(0,I.jsxs)(P.Fragment,{children:[(0,I.jsx)(lr,{heading:e.label,children:e.items.map(e=>(0,I.jsxs)(dr,{value:[e.label,...e.searchTerms??[]].join(` `),onSelect:()=>o(e),children:[(0,I.jsx)(e.icon,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:e.label})]},e.id))}),t<i.length-1?(0,I.jsx)(ur,{}):null]},e.id))]})]})}function vo(){let e=g({select:e=>e.status===`pending`}),[t,n]=P.useState(!1);return P.useEffect(()=>{let t;return e?n(!0):t=setTimeout(()=>n(!1),500),()=>clearTimeout(t)},[e]),t?(0,I.jsx)(`div`,{className:F(`fixed top-0 left-0 z-[100] h-1 w-full bg-transparent overflow-hidden`),children:(0,I.jsx)(`div`,{className:F(`h-full w-full bg-primary/80 origin-left animate-progress`)})}):null}var yo=(0,P.createContext)({theme:`system`,setTheme:()=>null});function bo({children:e,defaultTheme:t=`system`,storageKey:n=`vite-ui-theme`}){let[r,i]=(0,P.useState)(()=>localStorage.getItem(n)||t);(0,P.useEffect)(()=>{let e=window.document.documentElement;if(e.classList.remove(`light`,`dark`),r===`system`){let t=window.matchMedia(`(prefers-color-scheme: dark)`).matches?`dark`:`light`;e.classList.add(t);return}e.classList.add(r)},[r]);let a={theme:r,setTheme:e=>{localStorage.setItem(n,e),i(e)}};return(0,I.jsx)(yo.Provider,{value:a,children:e})}const xo=()=>{let e=(0,P.useContext)(yo);if(e===void 0)throw Error(`useTheme must be used within a ThemeProvider`);return e};var So=Bn(`inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0`,{variants:{variant:{default:`bg-primary text-primary-foreground hover:bg-primary/90`,destructive:`bg-destructive text-destructive-foreground hover:bg-destructive/90`,outline:`border border-input bg-background hover:bg-accent hover:text-accent-foreground`,secondary:`bg-secondary text-secondary-foreground hover:bg-secondary/80`,ghost:`hover:bg-accent hover:text-accent-foreground`,link:`text-primary underline-offset-4 hover:underline`},size:{default:`h-10 px-4 py-2`,sm:`h-9 rounded-md px-3`,lg:`h-11 rounded-md px-8`,icon:`h-10 w-10`}},defaultVariants:{variant:`default`,size:`default`}}),R=P.forwardRef(({className:e,variant:t,size:n,...r},i)=>(0,I.jsx)(`button`,{className:F(So({variant:t,size:n,className:e})),ref:i,...r}));R.displayName=`Button`;var Co=Sn,wo=Pt,To=P.forwardRef(({className:e,inset:t,children:n,...r},i)=>(0,I.jsxs)(Yt,{ref:i,className:F(`flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent`,t&&`pl-8`,e),...r,children:[n,(0,I.jsx)(S,{className:`ml-auto h-4 w-4`})]}));To.displayName=Yt.displayName;var Eo=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(on,{ref:n,className:F(`z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,e),...t}));Eo.displayName=on.displayName;var Do=P.forwardRef(({className:e,sideOffset:t=4,...n},r)=>(0,I.jsx)(hn,{children:(0,I.jsx)($t,{ref:r,sideOffset:t,className:F(`z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,e),...n})}));Do.displayName=$t.displayName;var Oo=P.forwardRef(({className:e,inset:t,...n},r)=>(0,I.jsx)(Lt,{ref:r,className:F(`relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,t&&`pl-8`,e),...n}));Oo.displayName=Lt.displayName;var ko=P.forwardRef(({className:e,children:t,checked:n,...r},i)=>(0,I.jsxs)(yn,{ref:i,className:F(`relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),checked:n,...r,children:[(0,I.jsx)(`span`,{className:`absolute left-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,I.jsx)(mt,{children:(0,I.jsx)(Ke,{className:`h-4 w-4`})})}),t]}));ko.displayName=yn.displayName;var Ao=P.forwardRef(({className:e,children:t,...n},r)=>(0,I.jsxs)(Kt,{ref:r,className:F(`relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...n,children:[(0,I.jsx)(`span`,{className:`absolute left-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,I.jsx)(mt,{children:(0,I.jsx)(pe,{className:`h-2 w-2 fill-current`})})}),t]}));Ao.displayName=Kt.displayName;var jo=P.forwardRef(({className:e,inset:t,...n},r)=>(0,I.jsx)(nn,{ref:r,className:F(`px-2 py-1.5 text-sm font-semibold`,t&&`pl-8`,e),...n}));jo.displayName=nn.displayName;var Mo=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(Ct,{ref:n,className:F(`-mx-1 my-1 h-px bg-muted`,e),...t}));Mo.displayName=Ct.displayName;var No=({className:e,...t})=>(0,I.jsx)(`span`,{className:F(`ml-auto text-xs tracking-widest opacity-60`,e),...t});No.displayName=`DropdownMenuShortcut`;function Po(){let{setTheme:e}=xo();return(0,I.jsxs)(Co,{children:[(0,I.jsx)(wo,{asChild:!0,children:(0,I.jsxs)(R,{variant:`outline`,size:`icon`,children:[(0,I.jsx)(Xe,{className:`h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0`}),(0,I.jsx)(It,{className:`absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100`}),(0,I.jsx)(`span`,{className:`sr-only`,children:`Toggle theme`})]})}),(0,I.jsxs)(Do,{align:`end`,children:[(0,I.jsx)(Oo,{onClick:()=>e(`light`),children:`Light`}),(0,I.jsx)(Oo,{onClick:()=>e(`dark`),children:`Dark`}),(0,I.jsx)(Oo,{onClick:()=>e(`system`),children:`System`})]})]})}function Fo(e){let t=g({select:e=>e.location.pathname}),n=(0,P.useMemo)(()=>ho({isAdmin:e.isAdmin,features:e.features}),[e.isAdmin,e.features]),[r,i]=(0,P.useState)({operate:!0,forward:!0,integrations:!0});(0,P.useEffect)(()=>{i(e=>{let t={...e};for(let e of n)t[e.id]===void 0&&(t[e.id]=!!e.defaultExpanded);return t})},[n]);let a=`_blank`,o=`noreferrer noopener`,s=e=>{i(t=>({...t,[e]:!t[e]}))};return(0,I.jsx)(`nav`,{className:`grid items-start gap-2`,children:(0,I.jsx)(`div`,{className:`space-y-2`,children:(0,I.jsx)(`div`,{className:`grid gap-1`,children:n.map(n=>{let i=n.icon,c=n.items.some(e=>go(t,e)),l=r[n.id];return e.collapsed?(0,I.jsxs)(Co,{children:[(0,I.jsx)(wo,{asChild:!0,children:(0,I.jsx)(`button`,{className:F(`group flex items-center justify-center rounded-md px-2 py-2 text-sm font-medium transition-colors w-full`,`hover:bg-accent hover:text-accent-foreground`,c?`bg-accent text-accent-foreground`:`transparent`),title:n.label,children:(0,I.jsx)(i,{className:`h-5 w-5`})})}),(0,I.jsxs)(Do,{side:`right`,align:`start`,sideOffset:10,children:[(0,I.jsx)(jo,{children:n.label}),(0,I.jsx)(Mo,{}),n.items.map(e=>(0,I.jsx)(Oo,{asChild:!0,children:e.external||e.newTab?(0,I.jsxs)(`a`,{href:e.href,target:a,rel:o,className:`flex items-center gap-2 cursor-pointer w-full`,children:[(0,I.jsx)(e.icon,{className:`h-4 w-4 mr-2`}),e.label]}):(0,I.jsxs)(m,{to:e.href,className:`flex items-center gap-2 cursor-pointer w-full`,children:[(0,I.jsx)(e.icon,{className:`h-4 w-4 mr-2`}),e.label]})},e.id))]})]},n.id):(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsxs)(`button`,{onClick:()=>s(n.id),className:F(`group flex w-full items-center justify-between rounded-md px-3 py-2 text-sm font-medium transition-colors`,`hover:bg-accent hover:text-accent-foreground`,c?`text-foreground font-semibold`:`text-muted-foreground`),children:[(0,I.jsxs)(`div`,{className:`flex items-center`,children:[(0,I.jsx)(i,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:n.label})]}),l?(0,I.jsx)(ue,{className:`h-4 w-4 opacity-50`}):(0,I.jsx)(S,{className:`h-4 w-4 opacity-50`})]}),l?(0,I.jsx)(`div`,{className:`grid gap-1 pl-4 border-l ml-4 border-border/50`,children:n.items.map(e=>{let n=F(`group flex items-center rounded-md px-3 py-2 text-sm font-medium transition-colors`,`hover:bg-accent hover:text-accent-foreground`,go(t,e)?`bg-accent text-accent-foreground`:`text-muted-foreground`);return e.external||e.newTab?(0,I.jsxs)(`a`,{href:e.href,target:a,rel:o,className:n,children:[(0,I.jsx)(e.icon,{className:`mr-2 h-4 w-4 opacity-70 group-hover:opacity-100`}),(0,I.jsx)(`span`,{children:e.label})]},e.id):(0,I.jsxs)(m,{to:e.href,className:n,children:[(0,I.jsx)(e.icon,{className:`mr-2 h-4 w-4 opacity-70 group-hover:opacity-100`}),(0,I.jsx)(`span`,{children:e.label})]},e.id)})}):null]},n.id)})})})})}var Io=P.forwardRef(({...e},t)=>(0,I.jsx)(`nav`,{ref:t,"aria-label":`breadcrumb`,...e}));Io.displayName=`Breadcrumb`;var Lo=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`ol`,{ref:n,className:F(`flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5`,e),...t}));Lo.displayName=`BreadcrumbList`;var Ro=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`li`,{ref:n,className:F(`inline-flex items-center gap-1.5`,e),...t}));Ro.displayName=`BreadcrumbItem`;var zo=P.forwardRef(({asChild:e,className:t,...n},r)=>(0,I.jsx)(e?dt:`a`,{ref:r,className:F(`transition-colors hover:text-foreground`,t),...n}));zo.displayName=`BreadcrumbLink`;var Bo=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`span`,{ref:n,role:`link`,"aria-disabled":`true`,"aria-current":`page`,className:F(`font-normal text-foreground`,e),...t}));Bo.displayName=`BreadcrumbPage`;var Vo=({children:e,className:t,...n})=>(0,I.jsx)(`li`,{role:`presentation`,"aria-hidden":`true`,className:F(`[&>svg]:size-3.5`,t),...n,children:e??(0,I.jsx)(S,{})});Vo.displayName=`BreadcrumbSeparator`;var Ho=({className:e,...t})=>(0,I.jsxs)(`span`,{role:`presentation`,"aria-hidden":`true`,className:F(`flex h-9 w-9 items-center justify-center`,e),...t,children:[(0,I.jsx)(D,{className:`h-4 w-4`}),(0,I.jsx)(`span`,{className:`sr-only`,children:`More`})]});Ho.displayName=`BreadcrumbEllipsis`;var Uo=Bn(`rounded-lg border text-card-foreground shadow-sm`,{variants:{variant:{default:`bg-card`,elevated:`bg-card shadow-lg`,gradient:`bg-gradient-to-br from-card to-card/60`,glass:`bg-card/95 backdrop-blur supports-[backdrop-filter]:bg-card/60`,glow:`bg-card shadow-lg shadow-primary/10`,interactive:`bg-card hover:shadow-md transition-shadow cursor-pointer`,success:`border-green-500/50 bg-green-500/5`,warning:`border-amber-500/50 bg-amber-500/5`,danger:`border-red-500/50 bg-red-500/5`,info:`border-blue-500/50 bg-blue-500/5`,flat:`bg-card shadow-none`},size:{default:``,compact:`p-3`,comfortable:`p-6`}},defaultVariants:{variant:`default`,size:`default`}}),z=P.forwardRef(({className:e,variant:t,size:n,...r},i)=>(0,I.jsx)(`div`,{ref:i,className:F(Uo({variant:t,size:n,className:e})),...r}));z.displayName=`Card`;var B=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`div`,{ref:n,className:F(`flex flex-col space-y-1.5 p-6`,e),...t}));B.displayName=`CardHeader`;var V=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`div`,{ref:n,className:F(`text-2xl font-semibold leading-none tracking-tight`,e),...t}));V.displayName=`CardTitle`;var H=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`div`,{ref:n,className:F(`text-sm text-muted-foreground`,e),...t}));H.displayName=`CardDescription`;var U=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`div`,{ref:n,className:F(`p-6 pt-0`,e),...t}));U.displayName=`CardContent`;var Wo=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`div`,{ref:n,className:F(`flex items-center p-6 pt-0`,e),...t}));Wo.displayName=`CardFooter`;var Go=T,Ko=We,qo=Ve,Jo=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(jn,{className:F(`fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t,ref:n}));Jo.displayName=jn.displayName;var Yo=Bn(`fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500`,{variants:{side:{top:`inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top`,bottom:`inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom`,left:`inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm`,right:`inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm`}},defaultVariants:{side:`right`}}),Xo=P.forwardRef(({side:e=`right`,className:t,children:n,...r},i)=>(0,I.jsxs)(qo,{children:[(0,I.jsx)(Jo,{}),(0,I.jsxs)(Pn,{ref:i,className:F(Yo({side:e}),t),...r,children:[n,(0,I.jsxs)(Tn,{className:`absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary`,children:[(0,I.jsx)(ke,{className:`h-4 w-4`}),(0,I.jsx)(`span`,{className:`sr-only`,children:`Close`})]})]})]}));Xo.displayName=Pn.displayName;var Zo=({className:e,...t})=>(0,I.jsx)(`div`,{className:F(`flex flex-col space-y-2 text-center sm:text-left`,e),...t});Zo.displayName=`SheetHeader`;var Qo=({className:e,...t})=>(0,I.jsx)(`div`,{className:F(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});Qo.displayName=`SheetFooter`;var $o=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(On,{ref:n,className:F(`text-lg font-semibold text-foreground`,e),...t}));$o.displayName=On.displayName;var es=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(_t,{ref:n,className:F(`text-sm text-muted-foreground`,e),...t}));es.displayName=_t.displayName;var ts=({...e})=>(0,I.jsx)(k,{className:`toaster group`,toastOptions:{classNames:{toast:`group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg`,description:`group-[.toast]:text-muted-foreground`,actionButton:`group-[.toast]:bg-primary group-[.toast]:text-primary-foreground`,cancelButton:`group-[.toast]:bg-muted group-[.toast]:text-muted-foreground`}},...e});async function ns(){try{let e=await fetch(`/api/session`,{credentials:`include`,headers:{"Content-Type":`application/json`}});return e.ok?await e.json():null}catch{return null}}async function rs(e){if(typeof window>`u`)return!1;let t=e.pollIntervalMs??750,n=e.timeoutMs??2*6e4;if((await ns())?.authenticated)return!0;let r=Math.max(0,Math.floor((window.screen.width-520)/2)),i=Math.max(0,Math.floor((window.screen.height-720)/2)),a=[`popup=yes`,`width=520`,`height=720`,`left=${r}`,`top=${i}`].join(`,`),o=window.open(e.loginHref,`skyforge_login`,a);if(!o)return!1;try{o.focus()}catch{}return await new Promise(e=>{let r=Date.now(),i=window.setInterval(async()=>{try{if(o.closed){window.clearInterval(i),e(!1);return}if(Date.now()-r>n){window.clearInterval(i);try{o.close()}catch{}e(!1);return}if((await ns())?.authenticated){window.clearInterval(i);try{o.close()}catch{}e(!0)}}catch{}},t)})}const W={session:()=>[`session`],uiConfig:()=>[`uiConfig`],dashboardSnapshot:()=>[`dashboardSnapshot`],statusSummary:()=>[`statusSummary`],runLogs:e=>[`runLogs`,e],deploymentTopology:e=>[`deploymentTopology`,e],deploymentUIEvents:e=>[`deploymentUIEvents`,e],deploymentCapacitySummary:e=>[`deploymentCapacitySummary`,e],deploymentCapacityInventory:e=>[`deploymentCapacityInventory`,e],deploymentCapacityGrowth:(e,t,n,r,i)=>[`deploymentCapacityGrowth`,e,t,n,String(r),i],userForwardNetworks:()=>[`userForwardNetworks`],assuranceStudioScenarios:e=>[`assuranceStudioScenarios`,e],assuranceStudioScenario:(e,t)=>[`assuranceStudioScenario`,e,t],assuranceStudioRuns:e=>[`assuranceStudioRuns`,e],assuranceStudioRun:(e,t)=>[`assuranceStudioRun`,e,t],forwardNetworkAssuranceSummary:e=>[`forwardNetworkAssuranceSummary`,e],forwardNetworkAssuranceHistory:(e,t)=>[`forwardNetworkAssuranceHistory`,e,t??``],forwardNetworkCapacitySummary:e=>[`forwardNetworkCapacitySummary`,e],forwardNetworkCapacityInventory:e=>[`forwardNetworkCapacityInventory`,e],forwardNetworkCapacityCoverage:e=>[`forwardNetworkCapacityCoverage`,e],forwardNetworkCapacitySnapshotDelta:e=>[`forwardNetworkCapacitySnapshotDelta`,e],forwardNetworkCapacityUpgradeCandidates:(e,t)=>[`forwardNetworkCapacityUpgradeCandidates`,e,t],forwardNetworkCapacityPortfolio:()=>[`forwardNetworkCapacityPortfolio`],forwardNetworkCapacityGrowth:(e,t,n,r,i)=>[`forwardNetworkCapacityGrowth`,e,t,n,String(r),i],users:()=>[`users`],forwardConfig:()=>[`forwardConfig`],forwardCollectors:()=>[`forwardCollectors`],userForwardCollector:()=>[`userForwardCollector`],userCollectorRuntime:()=>[`userCollectorRuntime`],userCollectorLogs:()=>[`userCollectorLogs`],userGitCredentials:()=>[`userGitCredentials`],userSettings:()=>[`userSettings`],userApiTokens:()=>[`userApiTokens`],userVariableGroups:()=>[`userVariableGroups`],userNetlabServers:()=>[`userNetlabServers`],userEveServers:()=>[`userEveServers`],userContainerlabServers:()=>[`userContainerlabServers`],userAwsStaticCredentials:()=>[`userAwsStaticCredentials`],userAwsSsoCredentials:()=>[`userAwsSsoCredentials`],awsSsoConfig:()=>[`awsSsoConfig`],awsSsoStatus:()=>[`awsSsoStatus`],userAzureCredentials:()=>[`userAzureCredentials`],userGcpCredentials:()=>[`userGcpCredentials`],userIbmCredentials:()=>[`userIbmCredentials`],userForwardCollectorConfigs:()=>[`userForwardCollectorConfigs`],userForwardCredentialSets:()=>[`userForwardCredentialSets`],userForwardCollectorConfigRuntime:e=>[`userForwardCollectorConfigRuntime`,e],userForwardCollectorConfigLogs:e=>[`userForwardCollectorConfigLogs`,e],userServiceNowConfig:()=>[`userServiceNowConfig`],userServiceNowPdiStatus:()=>[`userServiceNowPdiStatus`],userServiceNowSchemaStatus:()=>[`userServiceNowSchemaStatus`],userElasticConfig:()=>[`userElasticConfig`],elasticToolsStatus:()=>[`elasticToolsStatus`],storageFiles:()=>[`storageFiles`],userArtifacts:e=>[`userArtifacts`,e],userEveLabs:(e,t,n,r)=>[`userEveLabs`,e,t,n,r?`1`:`0`],userNetlabServersByOwner:e=>[`userNetlabServersByOwner`,e],notifications:(e,t)=>[`notifications`,e?`1`:`0`,t??``],syslogEvents:e=>[`syslogEvents`,e??``],snmpTrapEvents:e=>[`snmpTrapEvents`,e??``],userTemplates:(e,t,n,r,i)=>[`userTemplates`,e,t,n,r??``,i??``],pkiRoot:()=>[`pkiRoot`],pkiCerts:()=>[`pkiCerts`],pkiSshRoot:()=>[`pkiSshRoot`],pkiSshCerts:()=>[`pkiSshCerts`],webhookEvents:e=>[`webhookEvents`,e??``],notificationSettings:()=>[`notificationSettings`],governanceSummary:()=>[`governanceSummary`],governanceResources:e=>[`governanceResources`,e??``],governanceCosts:e=>[`governanceCosts`,e??``],governanceUsage:e=>[`governanceUsage`,e??``],governancePolicy:()=>[`governancePolicy`],adminConfig:()=>[`adminConfig`],adminAudit:e=>[`adminAudit`,e??``],adminImpersonateStatus:()=>[`adminImpersonateStatus`],registryRepos:e=>[`registryRepos`,e],registryTags:(e,t)=>[`registryTags`,e,t],policyReportsChecks:()=>[`policyReportsChecks`],policyReportsPacks:()=>[`policyReportsPacks`],policyReportsSnapshots:e=>[`policyReportsSnapshots`,e],policyReportsRecertCampaigns:e=>[`policyReportsRecertCampaigns`,e??``],policyReportsRecertCampaign:e=>[`policyReportsRecertCampaign`,e],policyReportsRecertAssignments:(e,t,n)=>[`policyReportsRecertAssignments`,e??``,t??``,n??``],policyReportsExceptions:(e,t)=>[`policyReportsExceptions`,e??``,t??``],policyReportsZones:e=>[`policyReportsZones`,e],policyReportsRuns:(e,t,n)=>[`policyReportsRuns`,e??``,t??``,n??``],policyReportsRun:e=>[`policyReportsRun`,e],policyReportsRunFindings:(e,t)=>[`policyReportsRunFindings`,e,t??``],policyReportsFindings:(e,t,n)=>[`policyReportsFindings`,e??``,t??``,n??``]};var is=new Map;function as(e){for(let[t,n]of e.handlers.entries())for(let r of n.values())e.es.addEventListener(t,r)}function os(e){let t=new EventSource(e.url,{withCredentials:!0});return t.onopen=()=>{e.retryMs=500},t.onerror=()=>{if(e.closed||e.reconnectTimer)return;try{t.close()}catch{}let n=e.retryMs;e.retryMs=Math.min(e.retryMs*2,15e3),e.reconnectTimer=window.setTimeout(()=>{e.reconnectTimer=void 0,!e.closed&&(e.es=os(e),as(e))},n)},t}function ss(e){let t=is.get(e);if(t)return t.refs+=1,t;let n={url:e,es:void 0,refs:1,handlers:new Map,retryMs:500,closed:!1};return n.es=os(n),is.set(e,n),n}function cs(e){let t=is.get(e);if(t&&(--t.refs,!(t.refs>0))){is.delete(e),t.closed=!0,t.reconnectTimer&&=(window.clearTimeout(t.reconnectTimer),void 0);try{t.es.close()}catch{}}}function ls(e,t){let n=ss(e);for(let[e,r]of Object.entries(t)){let t=n.handlers.get(e);t||(t=new Set,n.handlers.set(e,t)),t.add(r),n.es.addEventListener(e,r)}return{close:()=>{for(let[e,r]of Object.entries(t)){try{n.es.removeEventListener(e,r)}catch{}let t=n.handlers.get(e);t&&(t.delete(r),t.size===0&&n.handlers.delete(e))}cs(e)}}}function us(e,t,n){let r=o(),i=(0,P.useMemo)(()=>{let e=new URLSearchParams;return e.set(`include_read`,t?`true`:`false`),e.set(`limit`,n),`${pr}/notifications/events?${e.toString()}`},[t,n]);(0,P.useEffect)(()=>{if(!e)return;let a=ls(i,{snapshot:e=>{try{let i=JSON.parse(e.data);if(!i||!Array.isArray(i.notifications))return;r.setQueryData(W.notifications(t,n),i)}catch{}}});return()=>{a.close()}},[e,t,n,r,i])}const ds=d()({component:fs,errorComponent:ms,notFoundComponent:ps});function fs(){let e=g({select:e=>e.location}),t=c(),n=o(),[r,a]=(0,P.useState)(!1),[l,u]=(0,P.useState)(!1),[d,p]=(0,P.useState)(!1),[m,h]=(0,P.useState)(!1),_=(0,P.useMemo)(()=>e.pathname===`/dashboard/labs/designer`,[e.pathname]),v=(0,P.useMemo)(()=>_||e.pathname===`/dashboard/labs/map`,[_,e.pathname]);(0,P.useEffect)(()=>{_&&p(!0)},[_]),(0,P.useEffect)(()=>{window.location.pathname===`/index.html`&&t({to:`/`,replace:!0})},[t]);let y=f({queryKey:W.session(),queryFn:_r,retry:!1,staleTime:3e4}),b=f({queryKey:W.uiConfig(),queryFn:to,staleTime:5*6e4}),x=b.data?.productName||`Skyforge`,ee=b.data?.productSubtitle||`Automation Platform`,C=(0,P.useMemo)(()=>`${e.pathname}${e.searchStr??``}${e.hash??``}`,[e.pathname,e.searchStr,e.hash]),w=(0,P.useMemo)(()=>mr(C),[C]),te=(0,P.useMemo)(()=>[`/dashboard`,`/admin`,`/webhooks`,`/syslog`,`/snmp`].some(t=>e.pathname.startsWith(t)),[e.pathname]);(0,P.useEffect)(()=>{h(!1)},[e.pathname]);let T=y.data?.displayName||y.data?.username||``,E=String(y.data?.authProvider??``).trim(),D=!!y.data?.isAdmin,ne=te&&!y.isLoading&&!y.data?.authenticated,re=f({queryKey:W.adminImpersonateStatus(),queryFn:Wa,enabled:!!y.data?.authenticated&&D,staleTime:5e3,retry:!1}),k=i({mutationFn:async()=>Ka(),onSuccess:async()=>{await n.invalidateQueries({queryKey:W.session()}),await n.invalidateQueries({queryKey:W.adminImpersonateStatus()}),window.location.reload()},onError:e=>{O.error(`Failed to stop impersonation`,{description:e instanceof Error?e.message:`Unable to restore admin session`})}}),ie=y.data?.username??``;us(!!ie,!1,`20`);let A=f({queryKey:W.notifications(!1,`20`),enabled:!!ie,queryFn:async()=>({notifications:(await br(ie,{include_read:`false`,limit:`20`})).notifications??[]}),staleTime:1/0,initialData:{notifications:[]}}),ae=(0,P.useMemo)(()=>(A.data?.notifications??[]).filter(e=>!e.is_read).length,[A.data?.notifications]),oe=!!(y.data?.impersonating||re.data?.impersonating),se=String(re.data?.actorUsername??y.data?.actorUsername??``).trim(),ce=String(re.data?.effectiveUsername??y.data?.username??``).trim();return(0,I.jsx)(bo,{defaultTheme:`dark`,storageKey:`vite-ui-theme`,children:(0,I.jsxs)(`div`,{className:`min-h-full`,children:[(0,I.jsx)(vo,{}),(0,I.jsx)(`header`,{className:`sticky top-0 z-40 border-b glass-header`,children:(0,I.jsxs)(`div`,{className:`mx-auto flex h-16 max-w-[1600px] items-center justify-between gap-4 px-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-6`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,I.jsxs)(Go,{open:m,onOpenChange:h,children:[(0,I.jsx)(Ko,{asChild:!0,children:(0,I.jsxs)(R,{variant:`ghost`,size:`icon`,className:`lg:hidden`,children:[(0,I.jsx)(tn,{className:`h-5 w-5`}),(0,I.jsx)(`span`,{className:`sr-only`,children:`Toggle menu`})]})}),(0,I.jsx)(Xo,{side:`left`,className:`w-[240px] p-0`,children:(0,I.jsx)(`div`,{className:`px-2 py-6`,children:(0,I.jsx)(Fo,{collapsed:!1,isAdmin:D,features:b.data?.features})})})]}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`text-[10px] uppercase tracking-wider text-muted-foreground leading-none`,children:ee}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2 text-base font-semibold tracking-tight`,children:[(0,I.jsx)(tt,{className:`h-5 w-5 text-primary`}),(0,I.jsx)(`span`,{children:x})]})]}),(0,I.jsx)(`div`,{className:`h-8 w-px bg-border hidden md:block`}),(0,I.jsx)(`img`,{src:`/assets/skyforge/FN-logo.svg`,alt:`Forward Networks`,className:`h-6 w-auto hidden sm:block`})]}),(0,I.jsxs)(R,{variant:`outline`,className:`hidden md:flex h-9 w-64 items-center justify-start px-3 text-sm text-muted-foreground font-normal`,onClick:()=>{let e=new KeyboardEvent(`keydown`,{key:`k`,metaKey:!0,bubbles:!0});document.dispatchEvent(e)},children:[(0,I.jsx)(ln,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:`Search...`}),(0,I.jsxs)(`kbd`,{className:`pointer-events-none ml-auto inline-flex h-5 select-none items-center gap-1 rounded border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100`,children:[(0,I.jsx)(`span`,{className:`text-xs`,children:``}),`K`]})]})]}),(0,I.jsxs)(`nav`,{className:`flex items-center gap-4 text-sm`,children:[(0,I.jsxs)(R,{variant:`ghost`,size:`icon`,className:`relative text-muted-foreground hover:text-foreground`,"aria-label":`Notifications`,onClick:()=>void t({to:`/notifications`}),children:[(0,I.jsx)(ge,{className:`h-4 w-4`}),ae>0?(0,I.jsx)(`span`,{className:`absolute -right-1 -top-1 inline-flex h-4 min-w-[16px] items-center justify-center rounded-full bg-primary px-1 text-[10px] font-semibold text-primary-foreground`,children:ae>99?`99+`:ae}):null]}),(0,I.jsx)(Po,{}),y.data?.authenticated?(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsxs)(`div`,{className:`hidden md:flex flex-col items-end`,children:[(0,I.jsx)(`span`,{className:`text-[10px] text-muted-foreground uppercase leading-none`,children:E?`Signed in with ${E}`:`Signed in as`}),(0,I.jsx)(`span`,{className:`text-xs font-medium leading-none mt-1`,children:T})]}),(0,I.jsx)(R,{variant:`outline`,size:`sm`,disabled:r,onClick:async()=>{try{a(!0),await vr(),window.location.href=`/status?signin=1`}finally{a(!1)}},children:r?``:`Logout`})]}):(0,I.jsx)(R,{variant:`outline`,size:`sm`,disabled:l,onClick:async()=>{try{if(u(!0),!await rs({loginHref:w})){window.location.href=w;return}await n.invalidateQueries({queryKey:W.session()})}finally{u(!1)}},children:l?``:`Login`})]})]})}),(0,I.jsxs)(`div`,{className:F(`mx-auto flex min-h-[calc(100vh-4rem)]`,v?`max-w-none`:`max-w-[1600px]`),children:[y.data?.authenticated&&(0,I.jsx)(`aside`,{className:F(`hidden lg:block border-r bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60`,`transition-all duration-300 ease-in-out`,d?`w-[64px]`:`w-[220px]`),children:(0,I.jsxs)(`div`,{className:`relative h-full`,children:[(0,I.jsx)(`div`,{className:F(`h-full px-4 py-4`,d&&`px-2`),children:(0,I.jsx)(Fo,{collapsed:d,isAdmin:D,features:b.data?.features})}),(0,I.jsx)(`button`,{className:F(`absolute -right-3 top-4 flex h-7 w-7 items-center justify-center rounded-full border bg-background text-foreground shadow-sm`,`hover:bg-accent hover:text-accent-foreground transition-colors`),onClick:()=>p(e=>!e),"aria-label":d?`Expand navigation`:`Collapse navigation`,children:d?(0,I.jsx)(S,{className:`h-4 w-4`}):(0,I.jsx)(Ye,{className:`h-4 w-4`})})]})}),(0,I.jsx)(`main`,{className:F(`flex-1 w-full overflow-hidden flex flex-col`,v?`px-0 py-0`:`px-4 py-6`),children:ne?(0,I.jsx)(`div`,{className:`mx-auto max-w-xl`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Login Required`}),(0,I.jsx)(H,{children:`Sign in to access this page.`})]}),(0,I.jsxs)(U,{className:`flex flex-col gap-3`,children:[(0,I.jsx)(R,{variant:`default`,disabled:l,onClick:async()=>{try{if(u(!0),!await rs({loginHref:w})){window.location.href=w;return}await n.invalidateQueries({queryKey:W.session()})}finally{u(!1)}},children:l?``:`Login`}),(0,I.jsx)(`a`,{className:`text-sm text-muted-foreground underline`,href:w,children:`Login with redirect instead`})]})]})}):(0,I.jsxs)(I.Fragment,{children:[oe?(0,I.jsxs)(`div`,{className:`mb-4 flex flex-col gap-2 rounded-md border border-amber-500/40 bg-amber-500/10 px-4 py-3 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsxs)(`div`,{className:`text-sm`,children:[(0,I.jsx)(`span`,{className:`font-medium`,children:`Impersonation active:`}),` `,(0,I.jsxs)(`span`,{className:`font-mono`,children:[se||`admin`,` `,` `,ce||`user`]})]}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>k.mutate(),disabled:k.isPending,children:k.isPending?`Stopping`:`Stop impersonation`})]}):null,v?null:(0,I.jsx)(`div`,{className:`mb-6`,children:(0,I.jsx)(Io,{children:(0,I.jsxs)(Lo,{children:[(0,I.jsx)(Ro,{children:(0,I.jsx)(zo,{href:`/status`,children:`Dashboard`})}),` `,(()=>{let t=e.pathname.split(`/`).filter(Boolean),n=t;for(;n[0]===`dashboard`;)n=n.slice(1);let r=t[0]===`dashboard`?`/dashboard`:``;return n.map((e,t,n)=>{let i=`${r}/${n.slice(0,t+1).join(`/`)}`,a=t===n.length-1;return(0,I.jsxs)(P.Fragment,{children:[(0,I.jsx)(Vo,{}),(0,I.jsx)(Ro,{children:a?(0,I.jsx)(Bo,{className:`capitalize`,children:e}):(0,I.jsx)(zo,{href:i,className:`capitalize`,children:e})})]},i)})})()]})})}),(0,I.jsx)(s,{}),v?null:(0,I.jsxs)(`footer`,{className:`mt-auto pt-12 pb-6 flex items-center justify-between text-xs text-muted-foreground border-t`,children:[(0,I.jsx)(`div`,{className:`flex gap-4`,children:(0,I.jsxs)(`span`,{children:[`Questions? Reach out at`,` `,(0,I.jsx)(`span`,{className:`font-mono text-primary`,children:`#ask-skyforge`})]})}),(0,I.jsx)(`a`,{className:`hover:text-foreground transition-colors underline hover:no-underline`,href:`/git/skyforge/skyforge/issues/new`,target:`_blank`,rel:`noreferrer`,children:`File an issue`})]})]})})]}),(0,I.jsx)(_o,{isAdmin:D,features:b.data?.features}),(0,I.jsx)(ts,{})]})})}function ps(){return(0,I.jsx)(`div`,{className:`flex flex-col items-center justify-center min-h-[50vh] space-y-4 text-center`,children:(0,I.jsxs)(z,{variant:`glass`,className:`max-w-md`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{className:`text-2xl`,children:`Page not found`}),(0,I.jsx)(H,{children:`This route hasnt been migrated yet (or the URL is incorrect).`})]}),(0,I.jsxs)(U,{className:`flex flex-wrap justify-center gap-3`,children:[(0,I.jsx)(R,{variant:`default`,asChild:!0,children:(0,I.jsx)(m,{to:`/dashboard/deployments`,children:`Go to deployments`})}),(0,I.jsx)(R,{variant:`outline`,asChild:!0,children:(0,I.jsx)(m,{to:`/status`,children:`Platform status`})})]})]})})}function ms(e){let t=e.error instanceof Error?e.error.message:typeof e.error==`string`?e.error:`Unknown error`;return(0,I.jsxs)(`div`,{className:`space-y-6`,children:[(0,I.jsxs)(z,{variant:`danger`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Application error`}),(0,I.jsx)(H,{className:`text-red-200/80`,children:t})]}),(0,I.jsxs)(U,{className:`flex flex-wrap gap-3`,children:[(0,I.jsx)(R,{variant:`outline`,className:`border-red-500/50 bg-red-500/10 hover:bg-red-500/20 text-red-100`,onClick:()=>e.reset(),children:`Try again`}),(0,I.jsx)(R,{variant:`secondary`,asChild:!0,children:(0,I.jsx)(m,{to:`/dashboard/deployments`,children:`Go to deployments`})})]})]}),e.error instanceof Error&&e.error.stack&&(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{className:`text-sm`,children:`Error Stack Trace`})}),(0,I.jsx)(U,{children:(0,I.jsx)(`pre`,{className:`overflow-auto whitespace-pre-wrap text-xs text-muted-foreground p-4 rounded-md bg-muted`,children:e.error.stack})})]})]})}function hs(e){return e===void 0?`minmax(0, 1fr)`:typeof e==`number`?`${e}px`:e}function gs({columns:e,rows:t,getRowId:n,onRowClick:r,getRowClassName:i,getRowAriaSelected:a,isLoading:o,emptyText:s=`No results.`,scrollable:c=!0,maxHeightClassName:l=`max-h-[70vh]`,minWidthClassName:u=`min-w-[900px]`,estimateRowHeight:d=34}){let f=P.useRef(null),p=u!==`min-w-0`,m=P.useMemo(()=>e.map(e=>hs(e.width)).join(` `),[e]),g=h({count:t.length,getScrollElement:()=>c?f.current:null,estimateSize:()=>d,overscan:10}),_=g.getVirtualItems();return(0,I.jsx)(`div`,{className:F(`w-full rounded-md border`,p?`overflow-x-auto overflow-y-hidden`:`overflow-hidden`),children:(0,I.jsx)(`div`,{className:F(u),children:(0,I.jsxs)(`div`,{role:`table`,"aria-rowcount":t.length,className:`w-full text-sm`,style:{gridTemplateColumns:m},children:[(0,I.jsx)(`div`,{role:`rowgroup`,className:`sticky top-0 z-10 border-b bg-background/90 backdrop-blur`,children:(0,I.jsx)(`div`,{role:`row`,className:`grid`,style:{gridTemplateColumns:m},children:e.map(e=>(0,I.jsx)(`div`,{role:`columnheader`,className:F(`px-3 py-2 text-xs font-medium uppercase tracking-wide text-muted-foreground`,e.align===`center`&&`text-center`,e.align===`right`&&`text-right`,e.headerClassName),children:e.header},e.id))})}),(0,I.jsx)(`div`,{role:`rowgroup`,ref:c?f:void 0,className:F(`relative`,c&&`overflow-auto`,c&&l),children:o?(0,I.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:`Loading`}):t.length===0?(0,I.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:s}):c?(0,I.jsx)(`div`,{className:`relative`,style:{height:`${g.getTotalSize()}px`},children:_.map(o=>{let s=t[o.index],c=n(s),l=!!r,u=i?.(s,o.index),d=a?.(s,o.index);return(0,I.jsx)(`div`,{role:`row`,"aria-rowindex":o.index+1,"aria-selected":d,className:F(`absolute left-0 right-0 grid border-b last:border-b-0`,o.index%2==0&&`bg-background`,o.index%2==1&&`bg-muted/20`,l&&`cursor-pointer hover:bg-muted/40`,u),style:{gridTemplateColumns:m,transform:`translateY(${o.start}px)`},onClick:l?()=>r?.(s):void 0,children:e.map(e=>(0,I.jsx)(`div`,{role:`cell`,className:F(`px-3 py-2 align-middle`,e.align===`center`&&`text-center`,e.align===`right`&&`text-right`,e.className),children:e.cell(s)},e.id))},c)})}):(0,I.jsx)(`div`,{className:`relative`,children:t.map((t,o)=>{let s=n(t),c=!!r,l=i?.(t,o),u=a?.(t,o);return(0,I.jsx)(`div`,{role:`row`,"aria-rowindex":o+1,"aria-selected":u,className:F(`grid border-b last:border-b-0`,o%2==0&&`bg-background`,o%2==1&&`bg-muted/20`,c&&`cursor-pointer hover:bg-muted/40`,l),style:{gridTemplateColumns:m},onClick:c?()=>r?.(t):void 0,children:e.map(e=>(0,I.jsx)(`div`,{role:`cell`,className:F(`px-3 py-2 align-middle`,e.align===`center`&&`text-center`,e.align===`right`&&`text-right`,e.className),children:e.cell(t)},e.id))},s)})})})]})})})}function _s({title:e,description:t,icon:n,action:r,className:i,...a}){return(0,I.jsx)(`div`,{className:F(`flex min-h-[400px] flex-col items-center justify-center rounded-md border border-dashed p-8 text-center animate-in fade-in zoom-in duration-300`,i),...a,children:(0,I.jsxs)(`div`,{className:`mx-auto flex max-w-[420px] flex-col items-center justify-center text-center`,children:[n&&(0,I.jsx)(`div`,{className:`flex h-20 w-20 items-center justify-center rounded-full bg-muted`,children:(0,I.jsx)(n,{className:`h-10 w-10 text-muted-foreground`})}),(0,I.jsx)(`h3`,{className:`mt-4 text-lg font-semibold`,children:e}),t&&(0,I.jsx)(`p`,{className:`mb-4 mt-2 text-sm text-muted-foreground`,children:t}),r&&(0,I.jsx)(R,{onClick:r.onClick,variant:`outline`,size:`sm`,children:r.label})]})})}function G({className:e,...t}){return(0,I.jsx)(`div`,{className:F(`animate-pulse rounded-md bg-muted`,e),...t})}function vs(e,t){let n=o(),r=(0,P.useMemo)(()=>`${pr}/webhooks/events/stream?limit=${encodeURIComponent(t)}`,[t]);(0,P.useEffect)(()=>{if(!e)return;let i=ls(r,{snapshot:e=>{try{let r=JSON.parse(e.data);n.setQueryData(W.webhookEvents(t),r)}catch{}}});return()=>{i.close()}},[e,t,n,r])}const ys=t(`/webhooks`)({component:bs});function bs(){vs(!0,`200`);let e=f({queryKey:W.webhookEvents(`200`),queryFn:()=>Pa({limit:`200`}),staleTime:1/0}),t=e.data?.events??[];return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Webhook inbox`}),(0,I.jsx)(H,{children:`Recent webhook events routed to your user.`})]})}),(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`p-0`,children:e.isLoading?(0,I.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,I.jsx)(G,{className:`h-12 w-full`}),(0,I.jsx)(G,{className:`h-12 w-full`}),(0,I.jsx)(G,{className:`h-12 w-full`})]}):e.isError?(0,I.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load webhook events.`}):t.length===0?(0,I.jsx)(_s,{icon:At,title:`No webhook events`,description:`No webhook events have been received yet.`}):(0,I.jsx)(gs,{columns:[{id:`time`,header:`Time`,width:190,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground whitespace-nowrap text-xs`,children:e.receivedAt??``})},{id:`source`,header:`Source`,width:160,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.sourceIp??``})},{id:`event`,header:`Event`,cell:e=>(0,I.jsxs)(`span`,{className:`font-medium text-sm`,children:[e.method,` `,e.path]})},{id:`id`,header:`ID`,width:120,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:String(e.id)})}],rows:t,getRowId:e=>String(e.id),maxHeightClassName:`max-h-[65vh]`})})})]})}function xs(e,t){let n=o(),r=(0,P.useMemo)(()=>`${pr}/syslog/events/stream?limit=${encodeURIComponent(t)}`,[t]);(0,P.useEffect)(()=>{if(!e)return;let i=ls(r,{snapshot:e=>{try{let r=JSON.parse(e.data);n.setQueryData(W.syslogEvents(t),r)}catch{}}});return()=>{i.close()}},[e,t,n,r])}const Ss=t(`/syslog`)({component:Cs});function Cs(){xs(!0,`200`);let e=f({queryKey:W.syslogEvents(`200`),queryFn:()=>Fa({limit:`200`}),staleTime:1/0}),t=e.data?.events??[];return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Syslog inbox`}),(0,I.jsx)(H,{children:`Recent syslog events mapped to your user.`})]})}),(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`p-0`,children:e.isLoading?(0,I.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,I.jsx)(G,{className:`h-12 w-full`}),(0,I.jsx)(G,{className:`h-12 w-full`}),(0,I.jsx)(G,{className:`h-12 w-full`})]}):e.isError?(0,I.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load syslog events.`}):t.length===0?(0,I.jsx)(_s,{icon:At,title:`No syslog events`,description:`No syslog messages have been received yet.`}):(0,I.jsx)(gs,{columns:[{id:`time`,header:`Time`,width:190,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground whitespace-nowrap text-xs`,children:e.receivedAt??``})},{id:`source`,header:`Source`,width:160,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.sourceIp??``})},{id:`app`,header:`App`,width:160,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.appName??``})},{id:`message`,header:`Message`,cell:e=>(0,I.jsx)(`span`,{className:`font-medium text-foreground text-sm line-clamp-2`,children:e.message??``})}],rows:t,getRowId:e=>String(e.id),maxHeightClassName:`max-h-[65vh]`})})})]})}var ws=Bn(`inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2`,{variants:{variant:{default:`border-transparent bg-primary text-primary-foreground hover:bg-primary/80`,secondary:`border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80`,destructive:`border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80`,outline:`text-foreground`}},defaultVariants:{variant:`default`}});function K({className:e,variant:t,...n}){return(0,I.jsx)(`div`,{className:F(ws({variant:t}),e),...n})}function Ts(e){let t=o(),n=(0,P.useMemo)(()=>`/status/summary/events`,[]);(0,P.useEffect)(()=>{if(!e)return;let r=ls(n,{snapshot:e=>{try{let n=JSON.parse(e.data);t.setQueryData(W.statusSummary(),n)}catch{}}});return()=>{r.close()}},[e,t,n])}const Es=t(`/status`)({component:ks});function Ds(e){return String(e||``).trim().toLowerCase()}function Os(e,t){let n=t.map(Ds).filter(Boolean);if(!n.length)return`unknown`;for(let t of e){let e=Ds(t.name);if(n.some(t=>e.includes(t)))return t.status===`up`||t.status===`ok`?`up`:`down`}return`unknown`}function ks(){Ts(!0);let e=f({queryKey:W.statusSummary(),queryFn:no,staleTime:1/0}),t=f({queryKey:W.uiConfig(),queryFn:to,staleTime:1/0}),n=e.data,r=n?.checks??[],i=r.filter(e=>e.status!==`up`&&e.status!==`ok`),a=t.data?.features,o=[{id:`git`,name:`Git`,href:`/git/`,icon:Nn,external:!0,enabled:a?.giteaEnabled??!0,matchers:[`gitea`,`git`]},{id:`coder`,name:`Coder`,href:`${pr}/coder/launch`,icon:je,external:!0,enabled:a?.coderEnabled??!1,matchers:[`coder`]},{id:`netbox`,name:`NetBox`,href:`/netbox/`,icon:dn,external:!0,enabled:a?.netboxEnabled??!1,matchers:[`netbox`]},{id:`kibana`,name:`Kibana`,href:`/kibana/`,icon:b,external:!0,enabled:(a?.forwardEnabled??!1)&&(a?.elasticEnabled??!1),matchers:[`kibana`,`elastic`]},{id:`forward`,name:`Forward Collector`,href:`/dashboard/fwd/collector`,icon:st,external:!1,enabled:a?.forwardEnabled??!0,matchers:[`forward`,`collector`]},{id:`webhooks`,name:`Webhooks`,href:`/webhooks`,icon:x,external:!1,enabled:!0,matchers:[`webhook`]}].filter(e=>e.enabled);return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-4`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h1`,{className:`text-2xl font-semibold tracking-tight`,children:`Platform Status`}),(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Live health, active alerts, and quick operator actions.`})]}),t.data?.externalUrl?(0,I.jsxs)(`a`,{className:`text-sm text-primary hover:underline inline-flex items-center gap-1`,href:t.data.externalUrl,target:`_blank`,rel:`noreferrer`,children:[(0,I.jsx)(wn,{className:`h-4 w-4`}),`Public URL`]}):null]}),e.isLoading?(0,I.jsx)(`div`,{className:`grid gap-4 md:grid-cols-2 xl:grid-cols-4`,children:Array.from({length:4}).map((e,t)=>(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-2`,children:(0,I.jsx)(G,{className:`h-4 w-28`})}),(0,I.jsx)(U,{children:(0,I.jsx)(G,{className:`h-8 w-20`})})]},`status-skeleton-${t}`))}):(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2 xl:grid-cols-4`,children:[(0,I.jsx)(z,{children:(0,I.jsxs)(B,{className:`pb-2`,children:[(0,I.jsx)(H,{children:`Overall`}),(0,I.jsx)(V,{className:`text-2xl uppercase`,children:n?.status??`unknown`})]})}),(0,I.jsx)(z,{children:(0,I.jsxs)(B,{className:`pb-2`,children:[(0,I.jsx)(H,{children:`Services Healthy`}),(0,I.jsxs)(V,{className:`text-2xl`,children:[n?.up??0,` / `,r.length]})]})}),(0,I.jsx)(z,{children:(0,I.jsxs)(B,{className:`pb-2`,children:[(0,I.jsx)(H,{children:`Services Degraded`}),(0,I.jsx)(V,{className:`text-2xl`,children:n?.down??0})]})}),(0,I.jsx)(z,{children:(0,I.jsxs)(B,{className:`pb-2`,children:[(0,I.jsx)(H,{children:`Active Deployments`}),(0,I.jsx)(V,{className:`text-2xl`,children:n?.deploymentsActive??0})]})})]}),(0,I.jsxs)(`div`,{className:`grid gap-4 xl:grid-cols-3`,children:[(0,I.jsxs)(z,{className:`xl:col-span-2`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{className:`text-lg`,children:`Active Alerts`}),(0,I.jsx)(H,{children:`Only non-healthy service checks are shown here.`})]}),(0,I.jsx)(U,{className:`space-y-2`,children:i.length===0?(0,I.jsxs)(`div`,{className:`flex items-center gap-2 text-emerald-600`,children:[(0,I.jsx)(Le,{className:`h-4 w-4`}),(0,I.jsx)(`span`,{className:`text-sm`,children:`No active alerts.`})]}):(0,I.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:i.map(e=>(0,I.jsxs)(K,{variant:`destructive`,children:[e.name,`: `,e.status]},e.name))})})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{className:`text-lg`,children:`Quick Actions`})}),(0,I.jsxs)(U,{className:`space-y-2 text-sm`,children:[(0,I.jsx)(m,{className:`block text-primary hover:underline`,to:`/dashboard/deployments/new`,children:`Create deployment`}),(0,I.jsx)(m,{className:`block text-primary hover:underline`,to:`/dashboard/runs`,children:`View run queue`}),(0,I.jsx)(m,{className:`block text-primary hover:underline`,to:`/webhooks`,children:`Webhooks`}),(0,I.jsx)(`a`,{className:`block text-primary hover:underline`,href:`/redoc/`,target:`_blank`,rel:`noreferrer`,children:`API Docs`})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{className:`text-lg`,children:`Tool Integrations`}),(0,I.jsx)(H,{children:`Link into enabled tools and see service health mapping.`})]}),(0,I.jsx)(U,{children:(0,I.jsx)(`div`,{className:`grid gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6`,children:o.map(e=>{let t=Os(r,e.matchers),n=e.icon;return(0,I.jsxs)(`a`,{href:e.href,target:e.external?`_blank`:`_self`,rel:e.external?`noreferrer noopener`:void 0,className:`rounded-lg border p-3 hover:bg-muted/40 transition-colors`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(n,{className:`h-4 w-4 text-muted-foreground`}),t===`up`?(0,I.jsx)(K,{className:`bg-emerald-600 hover:bg-emerald-600`,children:`up`}):t===`down`?(0,I.jsx)(K,{variant:`destructive`,children:`down`}):(0,I.jsxs)(K,{variant:`secondary`,children:[(0,I.jsx)(me,{className:`mr-1 h-3 w-3`}),`unknown`]})]}),(0,I.jsx)(`div`,{className:`mt-2 text-sm font-medium`,children:e.name})]},e.id)})})})]})]})}function As(e,t){let n=o(),r=(0,P.useMemo)(()=>`${pr}/snmp/traps/events/stream?limit=${encodeURIComponent(t)}`,[t]);(0,P.useEffect)(()=>{if(!e)return;let i=ls(r,{snapshot:e=>{try{let r=JSON.parse(e.data);n.setQueryData(W.snmpTrapEvents(t),r)}catch{}}});return()=>{i.close()}},[e,t,n,r])}const js=t(`/snmp`)({component:Ms});function Ms(){As(!0,`200`);let e=f({queryKey:W.snmpTrapEvents(`200`),queryFn:()=>Ia({limit:`200`}),staleTime:1/0}),t=e.data?.events??[];return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`SNMP trap inbox`}),(0,I.jsx)(H,{children:`Recent SNMP trap events routed to your user.`})]})}),(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`p-0`,children:e.isLoading?(0,I.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,I.jsx)(G,{className:`h-12 w-full`}),(0,I.jsx)(G,{className:`h-12 w-full`}),(0,I.jsx)(G,{className:`h-12 w-full`})]}):e.isError?(0,I.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load SNMP trap events.`}):t.length===0?(0,I.jsx)(_s,{icon:At,title:`No trap events`,description:`No SNMP traps have been received yet.`}):(0,I.jsx)(gs,{columns:[{id:`time`,header:`Time`,width:190,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground whitespace-nowrap text-xs`,children:e.receivedAt??``})},{id:`source`,header:`Source`,width:160,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.sourceIp??``})},{id:`oid`,header:`OID`,cell:e=>(0,I.jsx)(`span`,{className:`font-medium text-foreground text-sm font-mono`,children:e.oid??``})},{id:`id`,header:`ID`,width:120,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:String(e.id)})}],rows:t,getRowId:e=>String(e.id),maxHeightClassName:`max-h-[65vh]`})})})]})}var Ns=Ne,Ps=ot,Fs=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(et,{className:F(`fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0`,e),...t,ref:n}));Fs.displayName=et.displayName;var Is=P.forwardRef(({className:e,...t},n)=>(0,I.jsxs)(Ps,{children:[(0,I.jsx)(Fs,{}),(0,I.jsx)(he,{ref:n,className:F(`fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg`,e),...t})]}));Is.displayName=he.displayName;var Ls=({className:e,...t})=>(0,I.jsx)(`div`,{className:F(`flex flex-col space-y-2 text-center sm:text-left`,e),...t});Ls.displayName=`AlertDialogHeader`;var Rs=({className:e,...t})=>(0,I.jsx)(`div`,{className:F(`flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2`,e),...t});Rs.displayName=`AlertDialogFooter`;var zs=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(_,{ref:n,className:F(`text-lg font-semibold`,e),...t}));zs.displayName=_.displayName;var Bs=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(rt,{ref:n,className:F(`text-sm text-muted-foreground`,e),...t}));Bs.displayName=rt.displayName;var Vs=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(j,{ref:n,className:F(So(),e),...t}));Vs.displayName=j.displayName;var Hs=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(sn,{ref:n,className:F(So({variant:`outline`}),`mt-2 sm:mt-0`,e),...t}));Hs.displayName=sn.displayName;var Us=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(Ze,{ref:n,className:F(`peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground`,e),...t,children:(0,I.jsx)(oe,{className:F(`flex items-center justify-center text-current`),children:(0,I.jsx)(Ke,{className:`h-4 w-4`})})}));Us.displayName=Ze.displayName;var Ws=Bn(`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70`),q=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(Ge,{ref:n,className:F(Ws(),e),...t}));q.displayName=Ge.displayName;var Gs=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(Je,{className:F(`peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input`,e),...t,ref:n,children:(0,I.jsx)(le,{className:F(`pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0`)})}));Gs.displayName=Je.displayName;const Ks=t(`/notifications`)({component:qs});function qs(){let[e,t]=(0,P.useState)(!1),[n,r]=(0,P.useState)(null),[i,a]=(0,P.useState)(!1),[s,c]=(0,P.useState)(new Set),l=o(),u=f({queryKey:W.session(),queryFn:_r,staleTime:3e4,retry:!1}).data?.username??``;us(!!u,e,`50`);let d=f({queryKey:W.notifications(e,`50`),enabled:!!u,queryFn:async()=>({notifications:(await br(u,{include_read:e?`true`:`false`,limit:`50`})).notifications??[]}),staleTime:1/0,initialData:{notifications:[]}}),p=(0,P.useMemo)(()=>d.data?.notifications??[],[d.data?.notifications]),m=(0,P.useMemo)(()=>p.filter(e=>!e.is_read).length,[p]),h=e=>{c(e?new Set(p.map(e=>String(e.id))):new Set)},g=(e,t)=>{let n=new Set(s);t?n.add(e):n.delete(e),c(n)},_=async()=>{try{let t=Array.from(s).map(e=>Sr(e));await Promise.all(t),O.success(`${s.size} notifications marked as read`),c(new Set),await l.invalidateQueries({queryKey:W.notifications(e,`50`)})}catch(e){O.error(`Failed to mark selection as read`,{description:e.message})}},v=async()=>{try{let t=Array.from(s).map(e=>Cr(e));await Promise.all(t),O.success(`${s.size} notifications deleted`),c(new Set),await l.invalidateQueries({queryKey:W.notifications(e,`50`)})}catch(e){O.error(`Failed to delete selection`,{description:e.message})}},y=async()=>{try{await xr(u),O.success(`All notifications marked as read`)}catch(e){O.error(`Failed to mark notifications as read`,{description:e.message})}},b=async e=>{try{await Sr(e),O.success(`Notification marked as read`)}catch(e){O.error(`Failed to mark notification as read`,{description:e.message})}},x=async()=>{if(n)try{await Cr(n),O.success(`Notification deleted`),a(!1),r(null)}catch(e){O.error(`Failed to delete notification`,{description:e.message})}},ee=[{id:`select`,header:(0,I.jsx)(Us,{checked:p.length>0&&s.size===p.length,onCheckedChange:e=>h(!!e),"aria-label":`Select all`}),width:54,headerClassName:`px-2 py-0`,className:`px-2 py-0`,cell:e=>{let t=String(e.id);return(0,I.jsx)(Us,{checked:s.has(t),onCheckedChange:e=>g(t,e),"aria-label":`Select notification ${t}`})}},{id:`time`,header:`Time`,width:190,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs whitespace-nowrap`,children:e.created_at??``})},{id:`message`,header:`Title & Message`,cell:e=>(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`font-medium text-sm`,children:e.title??``}),e.message?(0,I.jsx)(`div`,{className:`mt-1 text-xs text-muted-foreground line-clamp-2`,children:e.message}):null]})},{id:`category`,header:`Category`,width:160,cell:e=>(0,I.jsx)(`span`,{className:`inline-flex items-center rounded-full bg-muted px-2 py-0.5 text-[10px] font-medium text-muted-foreground capitalize`,children:e.category??`System`})},{id:`actions`,header:`Actions`,width:120,align:`right`,cell:e=>{let t=String(e.id);return(0,I.jsxs)(Co,{children:[(0,I.jsx)(wo,{asChild:!0,children:(0,I.jsxs)(R,{variant:`ghost`,size:`icon`,className:`h-8 w-8`,children:[(0,I.jsx)(D,{className:`h-4 w-4`}),(0,I.jsx)(`span`,{className:`sr-only`,children:`Open menu`})]})}),(0,I.jsxs)(Do,{align:`end`,children:[!e.is_read&&(0,I.jsxs)(Oo,{onClick:()=>b(t),children:[(0,I.jsx)(Ke,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:`Mark as read`})]}),(0,I.jsxs)(Oo,{className:`text-destructive focus:text-destructive`,onClick:()=>{r(t),a(!0)},children:[(0,I.jsx)(Ln,{className:`mr-2 h-4 w-4`}),(0,I.jsx)(`span`,{children:`Delete`})]})]})]})}}];return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(`div`,{className:`p-2 rounded-full bg-primary/10`,children:(0,I.jsx)(ge,{className:`h-6 w-6 text-primary`})}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(V,{children:`Notifications`}),(0,I.jsx)(H,{children:`Stay updated with platform events and system alerts.`})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(Gs,{id:`show-read`,checked:e,onCheckedChange:t}),(0,I.jsx)(q,{htmlFor:`show-read`,className:`cursor-pointer`,children:`Show read`})]}),(0,I.jsx)(R,{variant:`outline`,size:`sm`,disabled:!u||m===0,onClick:y,children:`Mark all read`})]})]})})}),s.size>0&&(0,I.jsxs)(`div`,{className:`fixed bottom-6 left-1/2 -translate-x-1/2 z-50 flex items-center gap-4 rounded-full border bg-background/95 p-2 px-6 shadow-xl backdrop-blur animate-in slide-in-from-bottom-10 fade-in duration-300`,children:[(0,I.jsxs)(`span`,{className:`text-sm font-medium`,children:[s.size,` selected`]}),(0,I.jsx)(`div`,{className:`h-4 w-px bg-border`}),(0,I.jsxs)(R,{size:`sm`,variant:`ghost`,onClick:_,children:[(0,I.jsx)(Ke,{className:`mr-2 h-4 w-4`}),`Mark read`]}),(0,I.jsxs)(R,{size:`sm`,variant:`destructive`,onClick:v,children:[(0,I.jsx)(Ln,{className:`mr-2 h-4 w-4`}),`Delete`]}),(0,I.jsx)(R,{size:`sm`,variant:`ghost`,onClick:()=>c(new Set),children:`Cancel`})]}),(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`p-0`,children:d.isLoading?(0,I.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,I.jsx)(G,{className:`h-12 w-full`}),(0,I.jsx)(G,{className:`h-12 w-full`}),(0,I.jsx)(G,{className:`h-12 w-full`})]}):d.isError?(0,I.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to load notifications.`}):p.length===0?(0,I.jsx)(_s,{icon:At,title:`No notifications`,description:e?`You don't have any notifications at the moment.`:`You've read all your notifications!`}):(0,I.jsx)(gs,{columns:ee,rows:p,getRowId:e=>String(e.id),getRowClassName:e=>{let t=String(e.id),n=s.has(t);return[e.is_read?`opacity-60 grayscale-[0.5]`:``,n?`bg-primary/10 hover:bg-primary/10`:``].filter(Boolean).join(` `)},getRowAriaSelected:e=>s.has(String(e.id)),maxHeightClassName:`max-h-[65vh]`,minWidthClassName:`min-w-[900px]`})})}),(0,I.jsx)(Ns,{open:i,onOpenChange:a,children:(0,I.jsxs)(Is,{children:[(0,I.jsxs)(Ls,{children:[(0,I.jsx)(zs,{children:`Delete notification?`}),(0,I.jsx)(Bs,{children:`This action cannot be undone.`})]}),(0,I.jsxs)(Rs,{children:[(0,I.jsx)(Hs,{children:`Cancel`}),(0,I.jsx)(Vs,{onClick:x,className:So({variant:`destructive`}),children:`Delete`})]})]})})]})}var Js={blue:`from-blue-500/10 via-blue-500/5 to-transparent`,green:`from-emerald-500/10 via-emerald-500/5 to-transparent`,purple:`from-purple-500/10 via-purple-500/5 to-transparent`,orange:`from-orange-500/10 via-orange-500/5 to-transparent`,red:`from-red-500/10 via-red-500/5 to-transparent`};const Ys=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`div`,{ref:n,className:F(`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4`,e),...t}));Ys.displayName=`BentoGrid`;const Xs=P.forwardRef(({className:e,gradient:t=`blue`,children:n,...r},i)=>(0,I.jsx)(`div`,{ref:i,className:F(`relative overflow-hidden rounded-xl border border-border bg-card p-6`,`bg-gradient-to-br`,Js[t],e),...r,children:n}));Xs.displayName=`BentoItem`;const Zs=P.forwardRef(({title:e,value:t,gradient:n=`blue`,icon:r,subtitle:i,trend:a,className:o},s)=>(0,I.jsxs)(Xs,{ref:s,gradient:n,className:o,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2 mb-2`,children:[r&&(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:r}),(0,I.jsx)(`h3`,{className:`text-sm font-medium text-muted-foreground/80`,children:e})]}),(0,I.jsxs)(`div`,{className:`flex items-end justify-between`,children:[(0,I.jsx)(`div`,{className:`text-3xl font-bold`,children:t}),a&&(0,I.jsxs)(`div`,{className:F(`flex items-center gap-1 text-sm`,a.direction===`up`?`text-emerald-500`:`text-red-500`),children:[a.direction===`up`?(0,I.jsx)(Se,{className:`w-4 h-4`}):(0,I.jsx)(Re,{className:`w-4 h-4`}),a.value,`%`]})]}),i&&(0,I.jsx)(`p`,{className:`text-xs text-muted-foreground/70 mt-2`,children:i})]}));Zs.displayName=`BentoStatCard`;const Qs=P.forwardRef(({userName:e,subtitle:t,className:n},r)=>(0,I.jsx)(Xs,{ref:r,gradient:`purple`,className:F(`md:col-span-2`,n),children:(0,I.jsxs)(`div`,{className:`flex items-center gap-3 mb-3`,children:[(0,I.jsx)(`div`,{className:`p-2 rounded-full bg-purple-500/10`,children:(0,I.jsx)(Oe,{className:`w-5 h-5 text-purple-500`})}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h2`,{className:`text-xl font-bold`,children:e?`Welcome back, ${e}`:`Welcome to Skyforge`}),t&&(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground/80`,children:t})]})]})}));Qs.displayName=`BentoWelcomeCard`;const $s=P.forwardRef(({actions:e,className:t},n)=>(0,I.jsxs)(Xs,{ref:n,gradient:`blue`,className:F(`md:col-span-2`,t),children:[(0,I.jsx)(`h3`,{className:`font-semibold mb-4`,children:`Quick Actions`}),(0,I.jsx)(`div`,{className:`grid grid-cols-2 gap-3`,children:e.map((e,t)=>(0,I.jsxs)(ee.button,{onClick:e.onClick,className:`flex items-center gap-2 p-3 rounded-lg bg-muted/50 hover:bg-muted transition-colors text-left`,whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.icon,(0,I.jsx)(`span`,{className:`text-sm font-medium`,children:e.label})]},t))})]}));$s.displayName=`BentoQuickActions`;const ec=P.forwardRef(({servers:e,className:t},n)=>(0,I.jsxs)(Xs,{ref:n,gradient:`green`,className:F(`md:col-span-2`,t),children:[(0,I.jsx)(`h3`,{className:`font-semibold mb-4`,children:`Server Status`}),(0,I.jsx)(`div`,{className:`grid grid-cols-2 gap-3`,children:e.map((e,t)=>(0,I.jsxs)(`div`,{className:`flex items-center justify-between p-3 rounded-lg bg-muted/30`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`div`,{className:F(`w-2 h-2 rounded-full`,e.status===`online`?`bg-emerald-500`:e.status===`degraded`?`bg-amber-500`:`bg-red-500`)}),(0,I.jsx)(`span`,{className:`text-sm font-medium`,children:e.name})]}),e.cpu!==void 0&&(0,I.jsxs)(K,{variant:`secondary`,className:`text-xs`,children:[e.cpu,`%`]})]},t))})]}));ec.displayName=`BentoServerStatus`;var J=P.forwardRef(({className:e,type:t,...n},r)=>(0,I.jsx)(`input`,{type:t,className:F(`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm`,e),ref:r,...n}));J.displayName=`Input`;var Y=Ee,X=Ie,Z=P.forwardRef(({className:e,children:t,...n},r)=>(0,I.jsxs)(be,{ref:r,className:F(`flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1`,e),...n,children:[t,(0,I.jsx)(E,{asChild:!0,children:(0,I.jsx)(ue,{className:`h-4 w-4 opacity-50`})})]}));Z.displayName=be.displayName;var tc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(ie,{ref:n,className:F(`flex cursor-default items-center justify-center py-1`,e),...t,children:(0,I.jsx)(In,{className:`h-4 w-4`})}));tc.displayName=ie.displayName;var nc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(Ae,{ref:n,className:F(`flex cursor-default items-center justify-center py-1`,e),...t,children:(0,I.jsx)(ue,{className:`h-4 w-4`})}));nc.displayName=Ae.displayName;var Q=P.forwardRef(({className:e,children:t,position:n=`popper`,...r},i)=>(0,I.jsx)(Ce,{children:(0,I.jsxs)(He,{ref:i,className:F(`relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,n===`popper`&&`data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1`,e),position:n,...r,children:[(0,I.jsx)(tc,{}),(0,I.jsx)(Fn,{className:F(`p-1`,n===`popper`&&`h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]`),children:t}),(0,I.jsx)(nc,{})]})}));Q.displayName=He.displayName;var rc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(Rt,{ref:n,className:F(`py-1.5 pl-8 pr-2 text-sm font-semibold`,e),...t}));rc.displayName=Rt.displayName;var $=P.forwardRef(({className:e,children:t,...n},r)=>(0,I.jsxs)(M,{ref:r,className:F(`relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50`,e),...n,children:[(0,I.jsx)(`span`,{className:`absolute left-2 flex h-3.5 w-3.5 items-center justify-center`,children:(0,I.jsx)(Vt,{children:(0,I.jsx)(Ke,{className:`h-4 w-4`})})}),(0,I.jsx)(y,{children:t})]}));$.displayName=M.displayName;var ic=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(fe,{ref:n,className:F(`-mx-1 my-1 h-px bg-muted`,e),...t}));ic.displayName=fe.displayName;var ac=w,oc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(ze,{ref:n,className:F(`inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground`,e),...t}));oc.displayName=ze.displayName;var sc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(En,{ref:n,className:F(`inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm`,e),...t}));sc.displayName=En.displayName;var cc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(kn,{ref:n,className:F(`mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2`,e),...t}));cc.displayName=kn.displayName;const lc=t(`/design`)({component:uc});function uc(){return(0,I.jsxs)(`div`,{className:`space-y-10 p-6 pb-20`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(`h1`,{className:`text-3xl font-bold tracking-tight`,children:`Design System`}),(0,I.jsx)(`p`,{className:`text-muted-foreground`,children:`A catalog of all reusable UI components available in the portal.`})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Buttons`}),(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-4`,children:[(0,I.jsx)(R,{variant:`default`,children:`Default`}),(0,I.jsx)(R,{variant:`secondary`,children:`Secondary`}),(0,I.jsx)(R,{variant:`destructive`,children:`Destructive`}),(0,I.jsx)(R,{variant:`outline`,children:`Outline`}),(0,I.jsx)(R,{variant:`ghost`,children:`Ghost`}),(0,I.jsx)(R,{variant:`link`,children:`Link`}),(0,I.jsx)(R,{size:`sm`,children:`Small`}),(0,I.jsx)(R,{size:`lg`,children:`Large`}),(0,I.jsx)(R,{size:`icon`,children:(0,I.jsx)(ce,{className:`h-4 w-4`})}),(0,I.jsx)(R,{disabled:!0,children:`Disabled`}),(0,I.jsxs)(R,{variant:`outline`,className:`gap-2`,children:[(0,I.jsx)(yt,{className:`h-4 w-4`}),` With Icon`]})]})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Badges`}),(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-4`,children:[(0,I.jsx)(K,{children:`Default`}),(0,I.jsx)(K,{variant:`secondary`,children:`Secondary`}),(0,I.jsx)(K,{variant:`outline`,children:`Outline`}),(0,I.jsx)(K,{variant:`destructive`,children:`Destructive`})]})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Cards`}),(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2 lg:grid-cols-4`,children:[(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Default Card`}),(0,I.jsx)(H,{children:`Standard container style`})]}),(0,I.jsx)(U,{children:`Content goes here`})]}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Glass Card`}),(0,I.jsx)(H,{children:`Backdrop blur effect`})]}),(0,I.jsx)(U,{children:`Popular for headers`})]}),(0,I.jsxs)(z,{variant:`flat`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Flat Card`}),(0,I.jsx)(H,{children:`No shadow, border only`})]}),(0,I.jsx)(U,{children:`Clean look`})]}),(0,I.jsxs)(z,{variant:`danger`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Danger Card`}),(0,I.jsx)(H,{children:`For error states`})]}),(0,I.jsx)(U,{className:`text-sm`,children:`Something went wrong`})]})]})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Bento Grid`}),(0,I.jsxs)(Ys,{children:[(0,I.jsx)(Zs,{title:`Total Revenue`,value:`$45,231.89`,icon:(0,I.jsx)(zt,{className:`h-4 w-4`}),gradient:`blue`}),(0,I.jsx)(Zs,{title:`Active Users`,value:`+2350`,icon:(0,I.jsx)(Oe,{className:`h-4 w-4`}),gradient:`green`}),(0,I.jsx)(Xs,{gradient:`purple`,className:`md:col-span-2`,children:(0,I.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,I.jsx)(`div`,{className:`p-2 bg-background/20 rounded-full`,children:(0,I.jsx)(je,{className:`h-6 w-6`})}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h3`,{className:`font-semibold text-lg`,children:`Cloud Infrastructure`}),(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground/80`,children:`Manage your cloud resources and deployments from a single dashboard.`})]})]})})]})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Form Inputs`}),(0,I.jsx)(z,{children:(0,I.jsxs)(U,{className:`pt-6 space-y-4 max-w-md`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{htmlFor:`email`,children:`Email address`}),(0,I.jsx)(J,{type:`email`,id:`email`,placeholder:`name@example.com`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Framework`}),(0,I.jsxs)(Y,{children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select framework`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`react`,children:`React`}),(0,I.jsx)($,{value:`vue`,children:`Vue`}),(0,I.jsx)($,{value:`svelte`,children:`Svelte`})]})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center space-x-2`,children:[(0,I.jsx)(Gs,{id:`airplane-mode`}),(0,I.jsx)(q,{htmlFor:`airplane-mode`,children:`Airplane Mode`})]})]})})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Tabs`}),(0,I.jsxs)(ac,{defaultValue:`account`,className:`w-[400px]`,children:[(0,I.jsxs)(oc,{children:[(0,I.jsx)(sc,{value:`account`,children:`Account`}),(0,I.jsx)(sc,{value:`password`,children:`Password`})]}),(0,I.jsx)(cc,{value:`account`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Account`}),(0,I.jsx)(H,{children:`Make changes to your account here.`})]}),(0,I.jsx)(U,{className:`space-y-2`,children:(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`name`,children:`Name`}),(0,I.jsx)(J,{id:`name`,defaultValue:`Pedro Duarte`})]})}),(0,I.jsx)(Wo,{children:(0,I.jsx)(R,{children:`Save changes`})})]})}),(0,I.jsx)(cc,{value:`password`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Password`}),(0,I.jsx)(H,{children:`Change your password here.`})]}),(0,I.jsx)(U,{className:`space-y-2`,children:(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`current`,children:`Current password`}),(0,I.jsx)(J,{id:`current`,type:`password`})]})}),(0,I.jsx)(Wo,{children:(0,I.jsx)(R,{children:`Save password`})})]})})]})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Feedback & Status`}),(0,I.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsx)(`h3`,{className:`text-sm font-medium text-muted-foreground`,children:`Empty State`}),(0,I.jsx)(`div`,{className:`border rounded-lg p-4`,children:(0,I.jsx)(_s,{icon:At,title:`No items found`,description:`You haven't created any items yet.`,action:{label:`Create Item`,onClick:()=>O(`Clicked create`)},className:`min-h-[200px]`})})]}),(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsx)(`h3`,{className:`text-sm font-medium text-muted-foreground`,children:`Skeleton Loading`}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(G,{className:`h-5 w-[140px] mb-2`}),(0,I.jsx)(G,{className:`h-4 w-[250px]`})]}),(0,I.jsxs)(U,{className:`space-y-2`,children:[(0,I.jsx)(G,{className:`h-4 w-full`}),(0,I.jsx)(G,{className:`h-4 w-full`}),(0,I.jsx)(G,{className:`h-4 w-3/4`})]})]})]})]})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Toast Notifications`}),(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-4`,children:[(0,I.jsx)(R,{variant:`outline`,onClick:()=>O(`Event has been created`),children:`Simple Toast`}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>O.success(`Event created successfully`),children:`Success`}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>O.error(`Failed to create event`),children:`Error`}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>O.info(`New updates available`,{description:`Refresh to see changes`}),children:`With Description`}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>O(`Event deleted`,{action:{label:`Undo`,onClick:()=>console.log(`Undo`)}}),children:`With Action`})]})]}),(0,I.jsxs)(`section`,{className:`space-y-4`,children:[(0,I.jsx)(`h2`,{className:`text-xl font-semibold`,children:`Breadcrumbs`}),(0,I.jsx)(`div`,{className:`p-4 border rounded-lg`,children:(0,I.jsx)(Io,{children:(0,I.jsxs)(Lo,{children:[(0,I.jsx)(Ro,{children:(0,I.jsx)(zo,{href:`/status`,children:`Dashboard`})}),` `,(0,I.jsx)(Vo,{}),(0,I.jsx)(Ro,{children:(0,I.jsx)(zo,{href:`/components`,children:`Components`})}),(0,I.jsx)(Vo,{}),(0,I.jsx)(Ro,{children:(0,I.jsx)(Bo,{children:`Breadcrumb`})})]})})})]})]})}const dc=t(`/`)({component:fc});function fc(){let e=c(),t=f({queryKey:W.session(),queryFn:_r,retry:!1,staleTime:3e4});return(0,P.useEffect)(()=>{t.isLoading||(t.data?.authenticated?e({to:`/dashboard/deployments`,replace:!0}):e({to:`/status`,replace:!0}))},[t.data?.authenticated,t.isLoading,e]),null}const pc=t(`/docs/`)({beforeLoad:()=>{throw r({to:`/dashboard/docs`})}}),mc=t(`/dashboard/`)({component:hc});function hc(){let e=c();return(0,P.useEffect)(()=>{e({to:`/status`,replace:!0})},[e]),null}const gc=t(`/admin/`)({component:_c});function _c(){let e=c();return(0,P.useEffect)(()=>{e({to:`/admin/settings`,replace:!0})},[e]),null}const vc=t(`/docs/$slug`)({beforeLoad:({params:e})=>{let t=String(e.slug??``);throw r({to:`/dashboard/docs/$slug`,params:{slug:t.endsWith(`.html`)?t.slice(0,-5):t}})}});var yc=lt,bc=P.createContext({}),xc=({...e})=>(0,I.jsx)(bc.Provider,{value:{name:e.name},children:(0,I.jsx)(kt,{...e})}),Sc=()=>{let e=P.useContext(bc),t=P.useContext(Cc),{getFieldState:n,formState:r}=ht(),i=n(e.name,r);if(!e)throw Error(`useFormField should be used within <FormField>`);let{id:a}=t;return{id:a,name:e.name,formItemId:`${a}-form-item`,formDescriptionId:`${a}-form-item-description`,formMessageId:`${a}-form-item-message`,...i}},Cc=P.createContext({}),wc=P.forwardRef(({className:e,...t},n)=>{let r=P.useId();return(0,I.jsx)(Cc.Provider,{value:{id:r},children:(0,I.jsx)(`div`,{ref:n,className:F(`space-y-2`,e),...t})})});wc.displayName=`FormItem`;var Tc=P.forwardRef(({className:e,...t},n)=>{let{error:r,formItemId:i}=Sc();return(0,I.jsx)(q,{ref:n,className:F(r&&`text-destructive`,e),htmlFor:i,...t})});Tc.displayName=`FormLabel`;var Ec=P.forwardRef(({...e},t)=>{let{error:n,formItemId:r,formDescriptionId:i,formMessageId:a}=Sc();return(0,I.jsx)(dt,{ref:t,id:r,"aria-describedby":n?`${i} ${a}`:`${i}`,"aria-invalid":!!n,...e})});Ec.displayName=`FormControl`;var Dc=P.forwardRef(({className:e,...t},n)=>{let{formDescriptionId:r}=Sc();return(0,I.jsx)(`p`,{ref:n,id:r,className:F(`text-sm text-muted-foreground`,e),...t})});Dc.displayName=`FormDescription`;var Oc=P.forwardRef(({className:e,children:t,...n},r)=>{let{error:i,formMessageId:a}=Sc(),o=i?String(i?.message):t;return o?(0,I.jsx)(`p`,{ref:r,id:a,className:F(`text-sm font-medium text-destructive`,e),...n,children:o}):null});Oc.displayName=`FormMessage`;var kc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`textarea`,{className:F(`flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm`,e),ref:n,...t}));kc.displayName=`Textarea`;var Ac=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`div`,{className:`relative w-full overflow-auto`,children:(0,I.jsx)(`table`,{ref:n,className:F(`w-full caption-bottom text-sm`,e),...t})}));Ac.displayName=`Table`;var jc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`thead`,{ref:n,className:F(`[&_tr]:border-b`,e),...t}));jc.displayName=`TableHeader`;var Mc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`tbody`,{ref:n,className:F(`[&_tr:last-child]:border-0`,e),...t}));Mc.displayName=`TableBody`;var Nc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`tfoot`,{ref:n,className:F(`border-t bg-muted/50 font-medium [&>tr]:last:border-b-0`,e),...t}));Nc.displayName=`TableFooter`;var Pc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`tr`,{ref:n,className:F(`border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted`,e),...t}));Pc.displayName=`TableRow`;var Fc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`th`,{ref:n,className:F(`h-10 px-3 text-left align-middle text-xs font-medium uppercase tracking-wide text-muted-foreground [&:has([role=checkbox])]:pr-0`,e),...t}));Fc.displayName=`TableHead`;var Ic=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`td`,{ref:n,className:F(`px-3 py-2 align-middle [&:has([role=checkbox])]:pr-0`,e),...t}));Ic.displayName=`TableCell`;var Lc=P.forwardRef(({className:e,...t},n)=>(0,I.jsx)(`caption`,{ref:n,className:F(`mt-4 text-sm text-muted-foreground`,e),...t}));Lc.displayName=`TableCaption`;function Rc({allowEdit:e}){let t=o(),[n,r]=(0,P.useState)(!1),[a,s]=(0,P.useState)(null),[c,l]=(0,P.useState)(null),u=f({queryKey:W.userVariableGroups(),queryFn:io,staleTime:3e4}),d=u.data?.groups??[],p=i({mutationFn:async e=>so(e),onSuccess:()=>{O.success(`Variable group deleted`),t.invalidateQueries({queryKey:W.userVariableGroups()}),l(null)},onError:e=>O.error(`Failed to delete group`,{description:e.message})});return(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(V,{children:`Variable Groups`}),(0,I.jsx)(H,{children:`Define reusable environment variables for your deployments.`})]}),(0,I.jsxs)(R,{size:`sm`,onClick:()=>r(!0),disabled:!e,children:[(0,I.jsx)(v,{className:`mr-2 h-4 w-4`}),`New Group`]})]})}),(0,I.jsx)(U,{children:u.isLoading?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading groups`}):d.length===0?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground border border-dashed rounded-lg p-8 text-center`,children:`No variable groups defined.`}):(0,I.jsx)(`div`,{className:`rounded-md border`,children:(0,I.jsxs)(Ac,{children:[(0,I.jsx)(jc,{children:(0,I.jsxs)(Pc,{children:[(0,I.jsx)(Fc,{children:`Name`}),(0,I.jsx)(Fc,{children:`Variables`}),(0,I.jsx)(Fc,{className:`text-right`,children:`Actions`})]})}),(0,I.jsx)(Mc,{children:d.map(t=>(0,I.jsxs)(Pc,{children:[(0,I.jsx)(Ic,{className:`font-medium`,children:t.name}),(0,I.jsxs)(Ic,{className:`text-muted-foreground text-xs`,children:[Object.keys(t.variables??{}).length,` variables`]}),(0,I.jsx)(Ic,{className:`text-right`,children:(0,I.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[(0,I.jsx)(R,{variant:`ghost`,size:`icon`,className:`h-8 w-8`,onClick:()=>s(t),disabled:!e,children:(0,I.jsx)(_n,{className:`h-4 w-4`})}),(0,I.jsx)(R,{variant:`ghost`,size:`icon`,className:`h-8 w-8 text-destructive hover:text-destructive`,onClick:()=>l(t),disabled:!e,children:(0,I.jsx)(Ln,{className:`h-4 w-4`})})]})})]},t.id))})]})})}),(0,I.jsx)(zc,{open:n,onOpenChange:r,allowEdit:e,mode:`create`}),a&&(0,I.jsx)(zc,{open:!!a,onOpenChange:e=>!e&&s(null),allowEdit:e,mode:`edit`,initialData:a}),(0,I.jsx)(Ns,{open:!!c,onOpenChange:e=>!e&&l(null),children:(0,I.jsxs)(Is,{children:[(0,I.jsxs)(Ls,{children:[(0,I.jsx)(zs,{children:`Delete variable group?`}),(0,I.jsxs)(Bs,{children:[`This will permanently delete `,(0,I.jsx)(`strong`,{children:c?.name}),`.`]})]}),(0,I.jsxs)(Rs,{children:[(0,I.jsx)(Hs,{children:`Cancel`}),(0,I.jsx)(Vs,{className:`bg-destructive text-destructive-foreground hover:bg-destructive/90`,onClick:()=>c&&p.mutate(c.id),children:p.isPending?`Deleting`:`Delete`})]})]})})]})}function zc({open:e,onOpenChange:t,allowEdit:n,mode:r,initialData:a}){let s=o(),[c,l]=(0,P.useState)(a?.name??``),[u,d]=(0,P.useState)(()=>a?.variables?Object.entries(a.variables).map(([e,t])=>({key:e,value:t})):[{key:``,value:``}]),f=i({mutationFn:async()=>{let e={};for(let t of u)t.key.trim()&&(e[t.key.trim()]=t.value);let t={name:c.trim(),variables:e};return r===`create`?ao(t):oo(a?.id??0,t)},onSuccess:()=>{s.invalidateQueries({queryKey:W.userVariableGroups()}),O.success(r===`create`?`Variable group created`:`Saved`),t(!1)},onError:e=>O.error(`Failed to save group`,{description:e.message})}),p=(e,t)=>{d(n=>n.map((n,r)=>r===e?t:n))};return(0,I.jsx)(Xn,{open:e,onOpenChange:t,children:(0,I.jsxs)($n,{children:[(0,I.jsxs)(er,{children:[(0,I.jsx)(nr,{children:r===`create`?`New variable group`:`Edit variable group`}),(0,I.jsx)(rr,{children:`Group common environment variables to reuse across deployments.`})]}),(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Name`}),(0,I.jsx)(J,{value:c,onChange:e=>l(e.target.value),placeholder:`Defaults`,disabled:!n})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(q,{children:`Variables`}),(0,I.jsx)(R,{type:`button`,variant:`outline`,size:`sm`,onClick:()=>d(e=>[...e,{key:``,value:``}]),disabled:!n,children:`Add variable`})]}),(0,I.jsx)(`div`,{className:`space-y-2 max-h-[320px] overflow-y-auto pr-2`,children:u.map((e,t)=>(0,I.jsxs)(`div`,{className:`grid grid-cols-12 gap-2`,children:[(0,I.jsx)(J,{value:e.key,onChange:n=>p(t,{key:n.target.value,value:e.value}),placeholder:`KEY`,className:`col-span-5 font-mono text-xs`,disabled:!n}),(0,I.jsx)(kc,{value:e.value,onChange:n=>p(t,{key:e.key,value:n.target.value}),placeholder:`Value`,rows:1,className:`col-span-7 text-xs`,disabled:!n})]},t))})]})]}),(0,I.jsxs)(tr,{children:[(0,I.jsx)(R,{type:`button`,variant:`outline`,onClick:()=>t(!1),children:`Cancel`}),(0,I.jsx)(R,{type:`button`,onClick:()=>f.mutate(),disabled:!n||f.isPending,children:f.isPending?`Saving`:`Save`})]})]})})}const Bc=[{label:"Device (`NETLAB_DEVICE`)",key:`NETLAB_DEVICE`},{label:"BGP AS (`NETLAB_BGP_AS`)",key:`NETLAB_BGP_AS`},{label:"P2P IPv4 pool (`NETLAB_ADDRESSING_P2P_IPV4`)",key:`NETLAB_ADDRESSING_P2P_IPV4`},{label:"P2P IPv6 mode (`NETLAB_ADDRESSING_P2P_IPV6`)",key:`NETLAB_ADDRESSING_P2P_IPV6`},{label:"Loopback IPv4 pool (`NETLAB_ADDRESSING_LOOPBACK_IPV4`)",key:`NETLAB_ADDRESSING_LOOPBACK_IPV4`},{label:"LAN IPv4 pool (`NETLAB_ADDRESSING_LAN_IPV4`)",key:`NETLAB_ADDRESSING_LAN_IPV4`},{label:"Netlab `--set` overrides (`SKYFORGE_NETLAB_SET_OVERRIDES`)",key:`SKYFORGE_NETLAB_SET_OVERRIDES`}],Vc=[{label:`Arista EOS (eos)`,value:`eos`},{label:`Cisco IOL (iol)`,value:`iol`},{label:`Cisco IOSv (iosv)`,value:`iosv`},{label:`Cisco IOSvL2 (iosvl2)`,value:`iosvl2`},{label:`Cisco CSR1000v (csr)`,value:`csr`},{label:`Cisco ASA (asav)`,value:`asav`},{label:`Cisco NX-OSv9k (nxos)`,value:`nxos`},{label:`Juniper SRX`,value:`vsrx`},{label:`Juniper vMX (vmx)`,value:`vmx`},{label:`Juniper vJunos Router (vjunos-router)`,value:`vjunos-router`},{label:`Juniper vJunos Switch (vjunos-switch)`,value:`vjunos-switch`},{label:`Nokia SR OS (sros)`,value:`sros`},{label:`Linux (linux)`,value:`linux`}];function Hc(e){return String(e??``).trim().toUpperCase()===`SKYFORGE_NETLAB_SET_OVERRIDES`}function Uc(e){switch(String(e??``).trim().toUpperCase()){case`NETLAB_DEVICE`:return Vc;case`NETLAB_BGP_AS`:return[{label:`65000`,value:`65000`},{label:`65100`,value:`65100`},{label:`65200`,value:`65200`},{label:`65500`,value:`65500`}];case`NETLAB_ADDRESSING_P2P_IPV4`:return[{label:`198.18.0.0/16 (benchmark range)`,value:`198.18.0.0/16`},{label:`172.16.0.0/12`,value:`172.16.0.0/12`},{label:`100.64.0.0/10`,value:`100.64.0.0/10`}];case`NETLAB_ADDRESSING_P2P_IPV6`:return[{label:`false (disable / avoid LLA-only)`,value:`false`},{label:`true`,value:`true`}];case`NETLAB_ADDRESSING_LOOPBACK_IPV4`:return[{label:`10.0.0.0/24`,value:`10.0.0.0/24`},{label:`198.18.1.0/24`,value:`198.18.1.0/24`},{label:`172.16.0.0/24`,value:`172.16.0.0/24`}];case`NETLAB_ADDRESSING_LAN_IPV4`:return[{label:`172.18.0.0/16`,value:`172.18.0.0/16`},{label:`198.18.128.0/17`,value:`198.18.128.0/17`}];default:return null}}const Wc=t(`/dashboard/settings`)({component:Kc});var Gc=qn({defaultForwardCollectorConfigId:Hn().optional(),defaultForwardCredentialId:Hn().optional(),defaultForwardNetworkId:Hn().optional(),defaultEnv:Vn(qn({key:Hn().min(1),value:Hn()})).optional(),externalTemplateRepos:Vn(qn({id:Hn().optional(),name:Hn().optional(),repo:Hn().min(1),defaultBranch:Hn().optional()})).optional()});function Kc(){let e=o(),t=f({queryKey:W.userForwardCollectorConfigs(),queryFn:_a,staleTime:1e4}),n=f({queryKey:W.userForwardCredentialSets(),queryFn:Sa,staleTime:1e4,retry:!1}),r=f({queryKey:W.userSettings(),queryFn:Wr,staleTime:1e4}),a=t.data?.collectors??[],s=n.data?.credentialSets??[],c=(0,P.useMemo)(()=>r.data?.defaultForwardCollectorConfigId||(a.find(e=>e.name===`default`)?.id??a[0]?.id??``),[a,r.data?.defaultForwardCollectorConfigId]),l=Mn({resolver:Mt(Gc),values:{defaultForwardCollectorConfigId:c||void 0,defaultForwardCredentialId:r.data?.defaultForwardCredentialId||void 0,defaultForwardNetworkId:r.data?.defaultForwardNetworkId||void 0,defaultEnv:r.data?.defaultEnv??[],externalTemplateRepos:r.data?.externalTemplateRepos??[]}}),u=Cn({control:l.control,name:`defaultEnv`}),d=Cn({control:l.control,name:`externalTemplateRepos`}),p=i({mutationFn:async e=>{let t=(e.externalTemplateRepos??[]).map(e=>{let t=e.repo.trim(),n=t.split(`/`).filter(Boolean).at(-1)?.replace(/\.git$/,``)??`repo`;return{id:e.id??globalThis.crypto?.randomUUID?.()??n,name:e.name?.trim()||n,repo:t,defaultBranch:e.defaultBranch?.trim()||`main`}});return Gr({defaultForwardCollectorConfigId:e.defaultForwardCollectorConfigId,defaultForwardCredentialId:e.defaultForwardCredentialId,defaultForwardNetworkId:e.defaultForwardNetworkId,defaultEnv:e.defaultEnv??[],externalTemplateRepos:t})},onSuccess:async()=>{await e.invalidateQueries({queryKey:W.userSettings()}),O.success(`Saved`)},onError:e=>{O.error(e instanceof Error?e.message:`Failed to save user settings`)}}),h=i({mutationFn:Kr,onSuccess:()=>{O.success(`Blueprints synced`)},onError:e=>{O.error(`Failed to sync blueprints`,{description:e instanceof Error?e.message:`request failed`})}}),g=t.isLoading||r.isLoading||p.isPending,_=String(l.watch(`defaultForwardCredentialId`)??``).trim(),v=(0,P.useMemo)(()=>_?s.find(e=>String(e?.id??``)===_)??null:null,[s,_]),[y,b]=(0,P.useState)(`https://fwd.app`),[x,ee]=(0,P.useState)(!1),[S,C]=(0,P.useState)(``),[w,te]=(0,P.useState)(``),[T,E]=(0,P.useState)(!1);(0,P.useEffect)(()=>{if(T)return;let e=v;e&&(b(String(e.baseUrl??``).trim()||`https://fwd.app`),ee(!!e.skipTlsVerify),C(String(e.username??``).trim()))},[v,T]);let D=f({queryKey:[`forwardNetworks`,_],queryFn:()=>qr({credentialId:_}),enabled:!!_,staleTime:3e4,retry:!1}),ne=(0,P.useMemo)(()=>(D.data?.networks??[]).filter(e=>e&&typeof e.id==`string`&&e.id.trim()).map(e=>({id:String(e.id),name:String(e.name??``)})),[D.data?.networks]),re=i({mutationFn:async()=>{let t=y.trim()||`https://fwd.app`,n=S.trim(),r=w;if(!n)throw Error(`Forward username is required`);let i=String(v?.name??`My Forward`).trim()||`My Forward`,a=_;if(a)await wa(a,{name:i,baseUrl:t,skipTlsVerify:x,username:n,...r.trim()?{password:r}:{}});else{if(!r.trim())throw Error(`Forward password is required`);let e=await Ca({name:i,baseUrl:t,skipTlsVerify:x,username:n,password:r});if(a=String(e?.id??``).trim(),!a)throw Error(`Failed to create credential set`);l.setValue(`defaultForwardCredentialId`,a,{shouldDirty:!0,shouldTouch:!0,shouldValidate:!0})}return await e.invalidateQueries({queryKey:W.userForwardCredentialSets()}),te(``),E(!1),p.mutateAsync(l.getValues())},onSuccess:async()=>{O.success(`Forward account saved`),await e.invalidateQueries({queryKey:W.userSettings()}),await e.invalidateQueries({queryKey:[`forwardNetworks`,_]})},onError:e=>O.error(`Failed to save Forward account`,{description:String(e?.message??e)})}),k=i({mutationFn:async e=>Ta(e),onSuccess:async()=>{l.setValue(`defaultForwardCredentialId`,``,{shouldDirty:!0,shouldTouch:!0,shouldValidate:!0}),l.setValue(`defaultForwardNetworkId`,``,{shouldDirty:!0,shouldTouch:!0,shouldValidate:!0}),b(`https://fwd.app`),ee(!1),C(``),te(``),E(!1),await e.invalidateQueries({queryKey:W.userForwardCredentialSets()}),O.success(`Forward credential set deleted`)},onError:e=>O.error(`Failed to delete Forward credential set`,{description:String(e?.message??e)})}),ie=f({queryKey:W.userAwsStaticCredentials(),queryFn:ni,staleTime:1e4,retry:!1}),A=f({queryKey:W.awsSsoConfig(),queryFn:Zr,staleTime:1e4,retry:!1}),ae=f({queryKey:W.awsSsoStatus(),queryFn:Qr,staleTime:1e4,retry:!1}),oe=f({queryKey:W.userAzureCredentials(),queryFn:ai,staleTime:1e4,retry:!1}),se=f({queryKey:W.userGcpCredentials(),queryFn:ci,staleTime:1e4,retry:!1}),ce=f({queryKey:W.userIbmCredentials(),queryFn:di,staleTime:1e4,retry:!1}),le=f({queryKey:W.userNetlabServers(),queryFn:mi,staleTime:1e4,retry:!1}),ue=f({queryKey:W.userEveServers(),queryFn:_i,staleTime:1e4,retry:!1}),de=f({queryKey:W.userContainerlabServers(),queryFn:bi,staleTime:1e4,retry:!1}),fe=f({queryKey:W.userServiceNowConfig(),queryFn:Dr,staleTime:1e4,retry:!1}),pe=f({queryKey:W.userApiTokens(),queryFn:Jr,staleTime:1e4,retry:!1}),[me,he]=(0,P.useState)(``),[ge,j]=(0,P.useState)(null),ve=i({mutationFn:async()=>Yr({name:me.trim()||void 0}),onSuccess:async t=>{j(t.secret??``),he(``),await e.invalidateQueries({queryKey:W.userApiTokens()}),O.success(`API token created`,{description:`Secret shown once. Copy it now.`})},onError:e=>{O.error(`Failed to create API token`,{description:e instanceof Error?e.message:String(e)})}}),ye=i({mutationFn:async e=>Xr(e),onSuccess:async()=>{await e.invalidateQueries({queryKey:W.userApiTokens()}),O.success(`API token revoked`)},onError:e=>{O.error(`Failed to revoke API token`,{description:e instanceof Error?e.message:String(e)})}}),[be,xe]=(0,P.useState)(``),[Se,Ce]=(0,P.useState)(``),[we,Te]=(0,P.useState)(``),[Ee,De]=(0,P.useState)(``),[Oe,M]=(0,P.useState)(``),[N,ke]=(0,P.useState)(``),[Ae,je]=(0,P.useState)(``),[Me,Ne]=(0,P.useState)(``),[Pe,Fe]=(0,P.useState)(``),[Ie,Le]=(0,P.useState)(``),[Re,ze]=(0,P.useState)(``),[Be,Ve]=(0,P.useState)(``),[He,Ue]=(0,P.useState)(!0),[We,Ge]=(0,P.useState)(``),[Ke,qe]=(0,P.useState)(``),[Je,Ye]=(0,P.useState)(``),[Xe,Ze]=(0,P.useState)(!0),[Qe,$e]=(0,P.useState)(``),[et,tt]=(0,P.useState)(``),[rt,it]=(0,P.useState)(``),[at,ot]=(0,P.useState)(``),[st,ct]=(0,P.useState)(!0),[lt,ut]=(0,P.useState)(``),[dt,ft]=(0,P.useState)(``),pt=e=>{try{return new URL(e).hostname||e}catch{return e}},mt=i({mutationFn:async()=>ri({accessKeyId:be.trim(),secretAccessKey:Se}),onSuccess:async()=>{Ce(``),await e.invalidateQueries({queryKey:W.userAwsStaticCredentials()}),O.success(`AWS static credentials saved`)},onError:e=>O.error(`Failed to save AWS static credentials`,{description:e instanceof Error?e.message:String(e)})}),ht=i({mutationFn:async()=>ii(),onSuccess:async()=>{xe(``),Ce(``),await e.invalidateQueries({queryKey:W.userAwsStaticCredentials()}),O.success(`AWS static credentials deleted`)},onError:e=>O.error(`Failed to delete AWS static credentials`,{description:e instanceof Error?e.message:String(e)})}),[gt,_t]=(0,P.useState)(null),[vt,yt]=(0,P.useState)(``),bt=i({mutationFn:$r,onSuccess:e=>{_t(e),yt(`pending`),window.open(e.verificationUriComplete,`_blank`,`noopener,noreferrer`)},onError:e=>O.error(`Failed to start AWS SSO`,{description:e instanceof Error?e.message:String(e)})}),xt=i({mutationFn:ti,onSuccess:async()=>{_t(null),yt(``),await e.invalidateQueries({queryKey:W.awsSsoStatus()}),O.success(`AWS SSO disconnected`)},onError:e=>O.error(`Failed to disconnect AWS SSO`,{description:e instanceof Error?e.message:String(e)})});(0,P.useEffect)(()=>{if(!gt||!gt.requestId)return;let t=!1,n=null,r=async()=>{try{let i=await ei({requestId:gt.requestId});if(t)return;if(yt(i.status),i.status===`ok`){_t(null),await e.invalidateQueries({queryKey:W.awsSsoStatus()}),O.success(`AWS SSO connected`);return}if(i.status===`pending`){n=setTimeout(r,Math.max(1,gt.intervalSeconds)*1e3);return}_t(null),O.error(`AWS SSO authorization did not complete`,{description:i.status})}catch(e){if(t)return;_t(null),O.error(`AWS SSO polling failed`,{description:e instanceof Error?e.message:String(e)})}};return n=setTimeout(r,Math.max(1,gt.intervalSeconds)*1e3),()=>{t=!0,n&&clearTimeout(n)}},[gt,e]);let St=i({mutationFn:async()=>oi({tenantId:we.trim(),clientId:Ee.trim(),clientSecret:Oe,subscriptionId:N.trim()||void 0}),onSuccess:async()=>{M(``),await e.invalidateQueries({queryKey:W.userAzureCredentials()}),O.success(`Azure credentials saved`)},onError:e=>O.error(`Failed to save Azure credentials`,{description:e instanceof Error?e.message:String(e)})}),Ct=i({mutationFn:async()=>si(),onSuccess:async()=>{Te(``),De(``),M(``),ke(``),await e.invalidateQueries({queryKey:W.userAzureCredentials()}),O.success(`Azure credentials deleted`)},onError:e=>O.error(`Failed to delete Azure credentials`,{description:e instanceof Error?e.message:String(e)})}),wt=i({mutationFn:async()=>li({projectId:Ae.trim(),serviceAccountJSON:Me}),onSuccess:async()=>{Ne(``),await e.invalidateQueries({queryKey:W.userGcpCredentials()}),O.success(`GCP credentials saved`)},onError:e=>O.error(`Failed to save GCP credentials`,{description:e instanceof Error?e.message:String(e)})}),Tt=i({mutationFn:async()=>ui(),onSuccess:async()=>{je(``),Ne(``),await e.invalidateQueries({queryKey:W.userGcpCredentials()}),O.success(`GCP credentials deleted`)},onError:e=>O.error(`Failed to delete GCP credentials`,{description:e instanceof Error?e.message:String(e)})}),Et=i({mutationFn:async()=>fi({apiKey:Pe,region:Ie.trim(),resourceGroupId:Re.trim()||void 0}),onSuccess:async()=>{Fe(``),await e.invalidateQueries({queryKey:W.userIbmCredentials()}),O.success(`IBM Cloud credentials saved`)},onError:e=>O.error(`Failed to save IBM Cloud credentials`,{description:e instanceof Error?e.message:String(e)})}),Dt=i({mutationFn:async()=>pi(),onSuccess:async()=>{Fe(``),Le(``),ze(``),await e.invalidateQueries({queryKey:W.userIbmCredentials()}),O.success(`IBM Cloud credentials deleted`)},onError:e=>O.error(`Failed to delete IBM Cloud credentials`,{description:e instanceof Error?e.message:String(e)})}),Ot=i({mutationFn:async()=>hi({name:pt(Be).trim(),apiUrl:Be.trim(),apiInsecure:He,apiUser:We.trim()||void 0,apiPassword:Ke.trim()||void 0}),onSuccess:async()=>{Ve(``),Ue(!0),Ge(``),qe(``),await e.invalidateQueries({queryKey:W.userNetlabServers()}),O.success(`Netlab server saved`)},onError:e=>O.error(`Failed to save Netlab server`,{description:e instanceof Error?e.message:String(e)})}),kt=i({mutationFn:async e=>gi(e),onSuccess:async()=>{await e.invalidateQueries({queryKey:W.userNetlabServers()}),O.success(`Netlab server deleted`)},onError:e=>O.error(`Failed to delete Netlab server`,{description:e instanceof Error?e.message:String(e)})}),At=i({mutationFn:async()=>xi({name:pt(Je).trim(),apiUrl:Je.trim(),apiInsecure:Xe,apiUser:Qe.trim()||void 0,apiPassword:et.trim()||void 0}),onSuccess:async()=>{Ye(``),Ze(!0),$e(``),tt(``),await e.invalidateQueries({queryKey:W.userContainerlabServers()}),O.success(`Containerlab server saved`)},onError:e=>O.error(`Failed to save Containerlab server`,{description:e instanceof Error?e.message:String(e)})}),jt=i({mutationFn:async e=>Si(e),onSuccess:async()=>{await e.invalidateQueries({queryKey:W.userContainerlabServers()}),O.success(`Containerlab server deleted`)},onError:e=>O.error(`Failed to delete Containerlab server`,{description:e instanceof Error?e.message:String(e)})}),Nt=i({mutationFn:async()=>vi({name:pt(rt).trim(),apiUrl:rt.trim(),webUrl:at.trim()||void 0,skipTlsVerify:st,apiUser:lt.trim()||void 0,apiPassword:dt.trim()||void 0}),onSuccess:async()=>{it(``),ot(``),ct(!0),ut(``),ft(``),await e.invalidateQueries({queryKey:W.userEveServers()}),O.success(`EVE-NG server saved`)},onError:e=>O.error(`Failed to save EVE-NG server`,{description:e instanceof Error?e.message:String(e)})}),Pt=i({mutationFn:async e=>yi(e),onSuccess:async()=>{await e.invalidateQueries({queryKey:W.userEveServers()}),O.success(`EVE-NG server deleted`)},onError:e=>O.error(`Failed to delete EVE-NG server`,{description:e instanceof Error?e.message:String(e)})});return(0,I.jsxs)(`div`,{className:`mx-auto w-full max-w-4xl space-y-6 p-6`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`My Settings`}),(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Defaults that pre-fill new deployments. These do not change existing deployments.`})]}),(0,I.jsx)(yc,{...l,children:(0,I.jsxs)(`form`,{onSubmit:l.handleSubmit(e=>p.mutate(e)),className:`space-y-6`,children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Integrations`})}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Forward collector`}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:a.length?`${a.length} configured`:`None configured`})]}),(0,I.jsx)(R,{asChild:!0,variant:`outline`,children:(0,I.jsx)(m,{to:`/dashboard/fwd/collector`,children:`Open`})})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Forward credentials`}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:n.isLoading?`Loading`:s.length?`${s.length} credential set(s)`:`None configured`})]}),(0,I.jsx)(R,{asChild:!0,variant:`outline`,children:(0,I.jsx)(m,{to:`/dashboard/settings`,hash:`forward-account`,children:`Manage`})})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`ServiceNow`}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:fe.data?.configured?`Configured`:`Not configured`})]}),(0,I.jsx)(R,{asChild:!0,variant:`outline`,children:(0,I.jsx)(m,{to:`/dashboard/servicenow`,children:`Open`})})]})]})]}),(0,I.jsxs)(z,{id:`forward-account`,children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Forward account`})}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Configure Forward once here, then reuse it across Capacity, Assurance, and collectors. Network selection is used as a default for demos and views.`}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Credential set`}),(0,I.jsxs)(R,{type:`button`,variant:`outline`,size:`sm`,disabled:!_||k.isPending,onClick:()=>{if(!_)return;let e=v,t=String(e?.name??_);confirm(`Delete Forward credential set "${t}"? This cannot be undone.`)&&k.mutate(_)},children:[(0,I.jsx)(Ln,{className:`h-4 w-4 mr-2`}),`Delete`]})]}),(0,I.jsxs)(Y,{value:_||`none`,onValueChange:e=>{l.setValue(`defaultForwardCredentialId`,e===`none`?``:e,{shouldDirty:!0,shouldTouch:!0,shouldValidate:!0}),te(``),E(!1)},children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select or create`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`none`,children:`Create new`}),s.map(e=>(0,I.jsxs)($,{value:String(e.id),children:[String(e.name??e.id),e.username?` (${e.username})`:``]},String(e.id)))]})]}),v&&!v.hasPassword?(0,I.jsx)(`div`,{className:`text-xs text-destructive`,children:`Selected credential set has no stored password.`}):null]}),(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Forward URL`}),(0,I.jsx)(J,{value:y,onChange:e=>{E(!0),b(e.target.value)},placeholder:`https://fwd.app`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Username`}),(0,I.jsx)(J,{value:S,onChange:e=>{E(!0),C(e.target.value)},placeholder:`you@company.com`})]})]}),(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Password`}),(0,I.jsx)(J,{type:`password`,value:w,onChange:e=>{E(!0),te(e.target.value)},placeholder:_?`Leave blank to keep existing`:``})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2 mt-6`,children:[(0,I.jsx)(Us,{checked:x,onCheckedChange:e=>{E(!0),ee(!!e)},id:`forward-skip-tls-verify`}),(0,I.jsx)(`label`,{htmlFor:`forward-skip-tls-verify`,className:`text-sm leading-tight cursor-pointer`,children:`Skip TLS verification`})]})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Default Forward network`}),(0,I.jsx)(R,{type:`button`,variant:`outline`,size:`sm`,onClick:()=>void D.refetch(),disabled:!_||D.isFetching,children:D.isFetching?`Refreshing`:`Refresh list`})]}),(0,I.jsxs)(Y,{value:String(l.watch(`defaultForwardNetworkId`)??``)||`none`,onValueChange:e=>l.setValue(`defaultForwardNetworkId`,e===`none`?``:e,{shouldDirty:!0,shouldTouch:!0,shouldValidate:!0}),disabled:!_,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select a network`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`none`,children:`None`}),ne.map(e=>(0,I.jsx)($,{value:e.id,children:e.name?`${e.name} (${e.id})`:e.id},e.id))]})]}),D.isError?(0,I.jsxs)(`div`,{className:`text-xs text-destructive`,children:[`Failed to load networks:`,` `,D.error.message]}):null]}),(0,I.jsx)(`div`,{className:`flex items-center justify-end gap-2 pt-2`,children:(0,I.jsx)(R,{type:`button`,onClick:()=>re.mutate(),disabled:re.isPending||p.isPending,children:re.isPending?`Saving`:`Save Forward account`})})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`API Tokens`})}),(0,I.jsxs)(U,{className:`space-y-3 text-sm`,children:[(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`For MCP clients and scripts. Token secrets are shown once at creation time.`}),(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 md:flex-row md:items-center`,children:[(0,I.jsx)(J,{placeholder:`Token name (optional)`,value:me,onChange:e=>he(e.target.value)}),(0,I.jsx)(R,{onClick:()=>ve.mutate(),disabled:ve.isPending,children:ve.isPending?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Gt,{className:`mr-2 h-4 w-4 animate-spin`}),`Creating`]}):`Create token`})]}),ge?(0,I.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,I.jsx)(`div`,{className:`text-xs font-medium`,children:`New token secret`}),(0,I.jsxs)(`div`,{className:`mt-2 flex flex-col gap-2 md:flex-row md:items-center`,children:[(0,I.jsx)(J,{readOnly:!0,value:ge}),(0,I.jsx)(R,{variant:`secondary`,onClick:async()=>{try{await navigator.clipboard.writeText(ge),O.success(`Copied token secret`)}catch(e){O.error(`Copy failed`,{description:e instanceof Error?e.message:String(e)})}},children:`Copy`}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>j(null),children:`Dismiss`})]})]}):null,(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(`div`,{className:`text-xs font-medium`,children:`Your tokens`}),pe.isLoading?(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Loading`}):pe.isError?(0,I.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to load API tokens.`}):(pe.data?.tokens??[]).length===0?(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`No tokens yet.`}):(0,I.jsx)(`div`,{className:`divide-y rounded-md border`,children:(pe.data?.tokens??[]).map(e=>(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3 px-3 py-2`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`truncate text-sm font-medium`,children:e.name||`API token`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:(0,I.jsx)(`span`,{className:`font-mono`,children:e.prefix})})]}),(0,I.jsx)(R,{variant:`outline`,disabled:ye.isPending,onClick:()=>ye.mutate(e.id),children:`Revoke`})]},e.id))})]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`MCP endpoint: `,(0,I.jsx)(`span`,{className:`font-mono`,children:`/api/mcp/rpc`}),` or`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`/api/mcp/forward/<networkId>/rpc`}),`.`]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Defaults`})}),(0,I.jsxs)(U,{className:`space-y-6`,children:[(0,I.jsx)(xc,{control:l.control,name:`defaultForwardCollectorConfigId`,render:({field:e})=>(0,I.jsxs)(wc,{children:[(0,I.jsx)(Tc,{children:`Default Forward collector`}),(0,I.jsxs)(Y,{value:e.value??``,onValueChange:t=>e.onChange(t),disabled:a.length===0,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:a.length?`Select collector`:`No collectors`})}),(0,I.jsx)(Q,{children:a.slice().sort((e,t)=>e.name===`default`?-1:t.name===`default`?1:0).map(e=>(0,I.jsx)($,{value:e.id,children:e.name},e.id))})]}),(0,I.jsx)(Oc,{})]})}),(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Default environment variables`}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Used for Netlab/Clabernetes generator env overrides.`})]}),(0,I.jsx)(R,{type:`button`,variant:`outline`,onClick:()=>u.append({key:`NETLAB_DEVICE`,value:``}),children:`Add variable`})]}),u.fields.length===0?(0,I.jsx)(`div`,{className:`rounded border p-4 text-sm text-muted-foreground`,children:`No default variables.`}):(0,I.jsx)(`div`,{className:`space-y-3`,children:u.fields.map((e,t)=>{let n=`defaultEnv.${t}.key`,r=`defaultEnv.${t}.value`,i=l.watch(n)||e.key,a=Uc(i),o=Hc(i);return(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsx)(xc,{control:l.control,name:n,render:({field:e})=>(0,I.jsxs)(wc,{className:`w-1/2`,children:[(0,I.jsx)(Tc,{className:`sr-only`,children:`Key`}),(0,I.jsxs)(Y,{value:e.value,onValueChange:t=>e.onChange(t),children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select key`})}),(0,I.jsx)(Q,{children:Bc.map(e=>(0,I.jsx)($,{value:e.key,children:e.label},e.key))})]}),(0,I.jsx)(Oc,{})]})}),(0,I.jsx)(xc,{control:l.control,name:r,render:({field:e})=>(0,I.jsxs)(wc,{className:`w-1/2`,children:[(0,I.jsx)(Tc,{className:`sr-only`,children:`Value`}),a?(0,I.jsxs)(Y,{value:e.value,onValueChange:t=>e.onChange(t),children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select value`})}),(0,I.jsx)(Q,{children:a.map(e=>(0,I.jsx)($,{value:e.value,children:e.label},e.value))})]}):(0,I.jsx)(J,{...e,placeholder:o?`Enter value`:`Value`}),(0,I.jsx)(Oc,{})]})}),(0,I.jsx)(R,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>u.remove(t),children:(0,I.jsx)(Ln,{className:`h-4 w-4`})})]},e.id)})})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(V,{children:`External Template Repos`}),(0,I.jsxs)(R,{type:`button`,variant:`outline`,size:`sm`,onClick:()=>h.mutate(),disabled:h.isPending,children:[(0,I.jsx)(nt,{className:`mr-2 h-4 w-4 ${h.isPending?`animate-spin`:``}`}),`Sync default blueprints`]})]})}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-4`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`IDs referenced when selecting template source = External.`}),(0,I.jsx)(R,{type:`button`,variant:`outline`,onClick:()=>d.append({name:``,repo:``,defaultBranch:``}),children:`Add repo`})]}),d.fields.length===0?(0,I.jsx)(`div`,{className:`rounded border p-4 text-sm text-muted-foreground`,children:`No external repos configured.`}):(0,I.jsx)(`div`,{className:`space-y-3`,children:d.fields.map((e,t)=>{let n=`externalTemplateRepos.${t}.id`,r=`externalTemplateRepos.${t}.name`,i=`externalTemplateRepos.${t}.repo`,a=`externalTemplateRepos.${t}.defaultBranch`;return(0,I.jsxs)(`div`,{className:`grid gap-2 rounded border p-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`ID:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:l.watch(n)||e.id||`(new)`})]}),(0,I.jsx)(R,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>d.remove(t),children:(0,I.jsx)(Ln,{className:`h-4 w-4`})})]}),(0,I.jsx)(xc,{control:l.control,name:n,render:({field:e})=>(0,I.jsxs)(wc,{className:`hidden`,children:[(0,I.jsx)(Tc,{className:`sr-only`,children:`ID`}),(0,I.jsx)(J,{...e})]})}),(0,I.jsx)(xc,{control:l.control,name:r,render:({field:e})=>(0,I.jsxs)(wc,{children:[(0,I.jsx)(Tc,{children:`Name (optional)`}),(0,I.jsx)(J,{...e,placeholder:`My repo`}),(0,I.jsx)(Oc,{})]})}),(0,I.jsx)(xc,{control:l.control,name:i,render:({field:e})=>(0,I.jsxs)(wc,{children:[(0,I.jsx)(Tc,{children:`Repo`}),(0,I.jsx)(J,{...e,placeholder:`owner/repo or git URL`}),(0,I.jsx)(Oc,{})]})}),(0,I.jsx)(xc,{control:l.control,name:a,render:({field:e})=>(0,I.jsxs)(wc,{children:[(0,I.jsx)(Tc,{children:`Default branch (optional)`}),(0,I.jsx)(J,{...e,placeholder:`main`}),(0,I.jsx)(Oc,{})]})})]},e.id)})})]})]}),(0,I.jsx)(`div`,{className:`flex items-center justify-end gap-2`,children:(0,I.jsx)(R,{type:`submit`,disabled:g||!l.formState.isDirty,children:p.isPending?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Gt,{className:`mr-2 h-4 w-4 animate-spin`}),`Saving`]}):(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(_e,{className:`mr-2 h-4 w-4`}),`Save`]})})})]})}),(0,I.jsx)(Rc,{allowEdit:!0}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Cloud Credentials`})}),(0,I.jsxs)(U,{className:`space-y-8`,children:[(0,I.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`rounded border p-4 space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`AWS (static)`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:ie.data?.configured?`Configured (${ie.data?.accessKeyLast4??``})`:`Not configured`})]}),(0,I.jsx)(J,{placeholder:`Access key id`,value:be,onChange:e=>xe(e.target.value)}),(0,I.jsx)(J,{placeholder:`Secret access key`,type:`password`,value:Se,onChange:e=>Ce(e.target.value)}),(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsx)(R,{type:`button`,onClick:()=>mt.mutate(),disabled:mt.isPending,children:`Save`}),(0,I.jsx)(R,{type:`button`,variant:`outline`,onClick:()=>ht.mutate(),disabled:ht.isPending,children:`Delete`})]})]}),(0,I.jsxs)(`div`,{className:`rounded border p-4 space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`AWS (SSO)`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:A.data?.configured?ae.data?.connected?`Connected`:`Not connected`:`Not configured`})]}),ae.data?.lastAuthenticatedAt?(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Last authenticated:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:ae.data.lastAuthenticatedAt})]}):null,ae.data?.expiresAt?(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Expires:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:ae.data.expiresAt})]}):null,gt?(0,I.jsxs)(`div`,{className:`rounded border bg-muted/30 p-3 text-xs space-y-1`,children:[(0,I.jsx)(`div`,{className:`font-medium`,children:`Complete sign-in`}),(0,I.jsxs)(`div`,{children:[`Code:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:gt.userCode})]}),(0,I.jsxs)(`div`,{className:`text-muted-foreground`,children:[`Open:`,` `,(0,I.jsx)(`span`,{className:`font-mono break-all`,children:gt.verificationUriComplete})]}),vt?(0,I.jsxs)(`div`,{className:`text-muted-foreground`,children:[`Status: `,vt]}):null]}):null,(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsx)(R,{type:`button`,onClick:()=>bt.mutate(),disabled:!A.data?.configured||bt.isPending||!!gt,children:`Connect`}),(0,I.jsx)(R,{type:`button`,variant:`outline`,onClick:()=>xt.mutate(),disabled:!ae.data?.connected||xt.isPending,children:`Disconnect`})]})]})]}),(0,I.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-3`,children:[(0,I.jsxs)(`div`,{className:`rounded border p-4 space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Azure`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:oe.data?.configured?`Configured`:`Not configured`})]}),(0,I.jsx)(J,{placeholder:`Tenant ID`,value:we,onChange:e=>Te(e.target.value)}),(0,I.jsx)(J,{placeholder:`Client ID`,value:Ee,onChange:e=>De(e.target.value)}),(0,I.jsx)(J,{placeholder:`Client secret`,type:`password`,value:Oe,onChange:e=>M(e.target.value)}),(0,I.jsx)(J,{placeholder:`Subscription ID (optional)`,value:N,onChange:e=>ke(e.target.value)}),(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsx)(R,{type:`button`,onClick:()=>St.mutate(),disabled:St.isPending,children:`Save`}),(0,I.jsx)(R,{type:`button`,variant:`outline`,onClick:()=>Ct.mutate(),disabled:Ct.isPending,children:`Delete`})]})]}),(0,I.jsxs)(`div`,{className:`rounded border p-4 space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`GCP`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:se.data?.configured?`Configured`:`Not configured`})]}),(0,I.jsx)(J,{placeholder:`Project ID`,value:Ae,onChange:e=>je(e.target.value)}),(0,I.jsx)(kc,{placeholder:`Service account JSON`,className:`min-h-[140px] font-mono text-xs`,value:Me,onChange:e=>Ne(e.target.value)}),(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsx)(R,{type:`button`,onClick:()=>wt.mutate(),disabled:wt.isPending,children:`Save`}),(0,I.jsx)(R,{type:`button`,variant:`outline`,onClick:()=>Tt.mutate(),disabled:Tt.isPending,children:`Delete`})]})]}),(0,I.jsxs)(`div`,{className:`rounded border p-4 space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`IBM Cloud`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:ce.data?.configured?`Configured`:`Not configured`})]}),(0,I.jsx)(J,{placeholder:`Region`,value:Ie,onChange:e=>Le(e.target.value)}),(0,I.jsx)(J,{placeholder:`API key`,type:`password`,value:Pe,onChange:e=>Fe(e.target.value)}),(0,I.jsx)(J,{placeholder:`Resource group ID (optional)`,value:Re,onChange:e=>ze(e.target.value)}),(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsx)(R,{type:`button`,onClick:()=>Et.mutate(),disabled:Et.isPending,children:`Save`}),(0,I.jsx)(R,{type:`button`,variant:`outline`,onClick:()=>Dt.mutate(),disabled:Dt.isPending,children:`Delete`})]})]})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`BYOL Servers`})}),(0,I.jsxs)(U,{className:`space-y-8`,children:[(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Netlab`}),(0,I.jsxs)(`div`,{className:`grid gap-2 md:grid-cols-2`,children:[(0,I.jsx)(J,{placeholder:`https://netlab.example.com`,value:Be,onChange:e=>Ve(e.target.value)}),(0,I.jsx)(J,{placeholder:`API username (optional)`,value:We,onChange:e=>Ge(e.target.value)}),(0,I.jsx)(J,{placeholder:`API password (optional)`,type:`password`,value:Ke,onChange:e=>qe(e.target.value)}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:He,onChange:e=>Ue(e.target.checked)}),(0,I.jsx)(`div`,{className:`text-sm`,children:`Skip TLS verify`})]})]}),(0,I.jsx)(R,{type:`button`,variant:`outline`,onClick:()=>Ot.mutate(),disabled:!Be.trim()||Ot.isPending,children:`Add/Update`}),(0,I.jsx)(`div`,{className:`space-y-2`,children:(le.data?.servers??[]).map(e=>(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded border px-3 py-2`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`truncate text-sm font-medium`,children:e.name}),(0,I.jsx)(`div`,{className:`truncate text-xs text-muted-foreground font-mono`,children:e.apiUrl})]}),(0,I.jsx)(R,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>e.id&&kt.mutate(e.id),children:(0,I.jsx)(Ln,{className:`h-4 w-4`})})]},e.id))})]}),(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Containerlab`}),(0,I.jsxs)(`div`,{className:`grid gap-2 md:grid-cols-2`,children:[(0,I.jsx)(J,{placeholder:`https://clab.example.com`,value:Je,onChange:e=>Ye(e.target.value)}),(0,I.jsx)(J,{placeholder:`API username (optional)`,value:Qe,onChange:e=>$e(e.target.value)}),(0,I.jsx)(J,{placeholder:`API password (optional)`,type:`password`,value:et,onChange:e=>tt(e.target.value)}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:Xe,onChange:e=>Ze(e.target.checked)}),(0,I.jsx)(`div`,{className:`text-sm`,children:`Skip TLS verify`})]})]}),(0,I.jsx)(R,{type:`button`,variant:`outline`,onClick:()=>At.mutate(),disabled:!Je.trim()||At.isPending,children:`Add/Update`}),(0,I.jsx)(`div`,{className:`space-y-2`,children:(de.data?.servers??[]).map(e=>(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded border px-3 py-2`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`truncate text-sm font-medium`,children:e.name}),(0,I.jsx)(`div`,{className:`truncate text-xs text-muted-foreground font-mono`,children:e.apiUrl})]}),(0,I.jsx)(R,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>e.id&&jt.mutate(e.id),children:(0,I.jsx)(Ln,{className:`h-4 w-4`})})]},e.id))})]}),(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`EVE-NG`}),(0,I.jsxs)(`div`,{className:`grid gap-2 md:grid-cols-2`,children:[(0,I.jsx)(J,{placeholder:`https://eve.example.com/api`,value:rt,onChange:e=>it(e.target.value)}),(0,I.jsx)(J,{placeholder:`Web URL (optional)`,value:at,onChange:e=>ot(e.target.value)}),(0,I.jsx)(J,{placeholder:`API username (optional)`,value:lt,onChange:e=>ut(e.target.value)}),(0,I.jsx)(J,{placeholder:`API password (optional)`,type:`password`,value:dt,onChange:e=>ft(e.target.value)}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:st,onChange:e=>ct(e.target.checked)}),(0,I.jsx)(`div`,{className:`text-sm`,children:`Skip TLS verify`})]})]}),(0,I.jsx)(R,{type:`button`,variant:`outline`,onClick:()=>Nt.mutate(),disabled:!rt.trim()||Nt.isPending,children:`Add/Update`}),(0,I.jsx)(`div`,{className:`space-y-2`,children:(ue.data?.servers??[]).map(e=>(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded border px-3 py-2`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`truncate text-sm font-medium`,children:e.name}),(0,I.jsx)(`div`,{className:`truncate text-xs text-muted-foreground font-mono`,children:e.apiUrl})]}),(0,I.jsx)(R,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>e.id&&Pt.mutate(e.id),children:(0,I.jsx)(Ln,{className:`h-4 w-4`})})]},e.id))})]})]})]})]})}const qc=t(`/dashboard/servicenow`)({component:Jc});function Jc(){let e=o(),t=W.userServiceNowConfig(),n=W.userServiceNowPdiStatus(),r=W.userServiceNowSchemaStatus(),a=W.userForwardCollectorConfigs(),s=f({queryKey:t,queryFn:Dr,retry:!1}).data,[c,l]=(0,P.useState)(``),[u,d]=(0,P.useState)(``),[p,m]=(0,P.useState)(``),[h,g]=(0,P.useState)(``),[_,v]=(0,P.useState)(``),[y,b]=(0,P.useState)(`collector`),[x,ee]=(0,P.useState)(``),[S,C]=(0,P.useState)(``),[w,te]=(0,P.useState)(!0);(0,P.useEffect)(()=>{s&&(l(s.instanceUrl??``),d(s.adminUsername??``),g(s.forwardCollectorConfigId??``),v(s.forwardCredentialId??``),b(s.forwardCollectorConfigId?`collector`:s.forwardCredentialId?`credentialSet`:s.forwardUsername?`custom`:`collector`),ee(s.forwardUsername??``))},[s]);let T=f({queryKey:a,queryFn:_a,retry:!1,staleTime:3e4}),E=(0,P.useMemo)(()=>T.data?.collectors??[],[T.data]),D=f({queryKey:W.userForwardCredentialSets(),queryFn:Sa,retry:!1,staleTime:3e4}),ne=(0,P.useMemo)(()=>D.data?.credentialSets??[],[D.data?.credentialSets]);(0,P.useEffect)(()=>{if(y!==`collector`||h)return;let e=E.find(e=>e.isDefault)??E[0];e?.id&&g(e.id)},[s,E,h,y]);let re=f({queryKey:n,queryFn:Ar,enabled:!!s?.configured,retry:!1,refetchOnWindowFocus:!0,staleTime:0,refetchInterval:e=>{if(document.visibilityState===`hidden`)return!1;let t=e.state.data?.status??``;return t===`awake`?12e4:t===`sleeping`||t===`waking`||t===`unreachable`?3e4:6e4}}),k=f({queryKey:r,queryFn:jr,enabled:!!s?.configured,retry:!1,refetchOnWindowFocus:!0,staleTime:0}),ie=(0,P.useMemo)(()=>(k.data?.missing??[]).some(e=>e.startsWith(`table:`)),[k.data?.missing]),A=(0,P.useMemo)(()=>{let e=(c||s?.instanceUrl||``).trim().replace(/\/+$/,``);return e?`${e}/sp?id=connectivity_ticket`:``},[s?.instanceUrl,c]),ae=i({mutationFn:async()=>Mr(),onSuccess:async()=>{O.success(`Wake requested`),await e.invalidateQueries({queryKey:n})},onError:e=>O.error(`Failed to wake PDI`,{description:e.message})}),oe=i({mutationFn:async()=>{if(!c.trim())throw Error(`ServiceNow instance URL is required`);if(!u.trim())throw Error(`ServiceNow admin username is required`);let e=y===`collector`,t=y===`credentialSet`;if(e){if(!h.trim())throw Error(`Select a Forward collector (or choose Custom)`)}else if(t){if(!_.trim())throw Error(`Select a credential set (or choose Custom)`)}else if(!x.trim())throw Error(`Forward username is required`);return Or({instanceUrl:c.trim(),adminUsername:u.trim(),adminPassword:p,forwardCollectorConfigId:e?h.trim():``,forwardCredentialId:t?_.trim():``,forwardUsername:e||t?``:x.trim(),forwardPassword:e||t?``:S})},onSuccess:async()=>{O.success(`Saved ServiceNow settings`),m(``),C(``),await e.invalidateQueries({queryKey:t}),await e.invalidateQueries({queryKey:n}),await e.invalidateQueries({queryKey:r}),w&&ce.mutate()},onError:e=>O.error(`Failed to save ServiceNow settings`,{description:e.message})}),se=i({mutationFn:async()=>kr(),onSuccess:async i=>{i.installed?O.success(`ServiceNow demo installed`):O.error(`ServiceNow install failed`,{description:i.message}),await e.invalidateQueries({queryKey:t}),await e.invalidateQueries({queryKey:n}),await e.invalidateQueries({queryKey:r})},onError:e=>O.error(`Failed to install ServiceNow demo`,{description:e.message})}),ce=i({mutationFn:async()=>Nr(),onSuccess:async e=>{e.configured?O.success(`Configured Forward ticketing integration`):O.error(`Failed to configure Forward`,{description:e.message})},onError:e=>O.error(`Failed to configure Forward`,{description:e.message})});return(0,I.jsxs)(`div`,{className:`p-6 space-y-6`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold`,children:`ServiceNow`}),(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground mt-1`,children:`Install the Forward Connectivity Ticket demo into a ServiceNow PDI. ServiceNow calls Forward SaaS directly; Skyforge only installs and configures the app.`})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Quick links`}),(0,I.jsx)(H,{children:`Create a ServiceNow PDI (manual step).`})]}),(0,I.jsxs)(U,{className:`space-y-2`,children:[(0,I.jsx)(`a`,{className:`text-sm underline`,href:`https://developer.servicenow.com/dev.do#!/guides/now-platform/pdi-guide/obtaining-a-pdi`,target:`_blank`,rel:`noreferrer`,children:`Create a Personal Developer Instance (PDI)`}),(0,I.jsx)(`a`,{className:`text-sm underline`,href:`/dashboard/docs/servicenow`,target:`_blank`,rel:`noreferrer`,children:`Open Skyforge ServiceNow docs`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Create and wake your PDI in the ServiceNow portal; then paste the instance URL and admin creds below.`}),A?(0,I.jsx)(`a`,{className:`text-sm underline`,href:A,target:`_blank`,rel:`noreferrer`,children:`Open the demo portal page (after install)`}):null,s?.configured&&(c||s?.instanceUrl)?(0,I.jsx)(`a`,{className:`text-sm underline`,href:`${(c||s?.instanceUrl||``).replace(/\/+$/,``)}/sys_app_application_list.do?sysparm_query=title=Forward%20Connectivity%20Ticket`,target:`_blank`,rel:`noreferrer`,children:`Find the demo app menu in ServiceNow (after install)`}):null]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`PDI status`}),(0,I.jsx)(H,{children:`ServiceNow PDIs can sleep after inactivity. Skyforge can detect this and attempt to wake the instance.`})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsx)(`div`,{className:`text-sm`,children:s?.configured?(0,I.jsxs)(I.Fragment,{children:[`Status:`,` `,(0,I.jsx)(`span`,{className:`font-medium`,children:re.data?.status??(re.isFetching?`checking`:`unknown`)}),re.data?.httpStatus?` (HTTP ${re.data.httpStatus})`:``,re.data?.detail?`  ${re.data.detail}`:``]}):(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:`Save configuration first.`})}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(R,{variant:`secondary`,onClick:()=>void re.refetch(),disabled:!s?.configured||re.isFetching||ae.isPending,children:`Check now`}),(0,I.jsx)(R,{variant:`secondary`,onClick:()=>ae.mutate(),disabled:!s?.configured||ae.isPending,children:`Wake up`})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Schema status`}),(0,I.jsx)(H,{children:`The demo requires two custom tables. Create the tables once in the PDI; Skyforge can auto-create the required fields and choice lists when you install the demo app.`})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsx)(`div`,{className:`text-sm`,children:s?.configured?(0,I.jsxs)(I.Fragment,{children:[`Status:`,` `,(0,I.jsx)(`span`,{className:`font-medium`,children:k.data?.status??(k.isFetching?`checking`:`unknown`)}),k.data?.checkedAt?` (checked ${k.data.checkedAt})`:``,k.data?.detail?`  ${k.data.detail}`:``]}):(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:`Save configuration first.`})}),s?.configured&&c?(0,I.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Portal page:`,` `,(0,I.jsx)(`a`,{className:`underline`,href:`${c.replace(/\/+$/,``)}/sp?id=connectivity_ticket`,target:`_blank`,rel:`noreferrer`,children:`/sp?id=connectivity_ticket`})]}):null,s?.configured&&c?(0,I.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Find records:`,` `,(0,I.jsx)(`a`,{className:`underline`,href:`${c.replace(/\/+$/,``)}/sp_widget_list.do?sysparm_query=name=Connectivity%20Ticket%20Analyzer`,target:`_blank`,rel:`noreferrer`,children:`widget`}),`  `,(0,I.jsx)(`a`,{className:`underline`,href:`${c.replace(/\/+$/,``)}/sp_page_list.do?sysparm_query=id=connectivity_ticket`,target:`_blank`,rel:`noreferrer`,children:`page`}),`  `,(0,I.jsx)(`a`,{className:`underline`,href:`${c.replace(/\/+$/,``)}/sys_rest_message_list.do?sysparm_query=name=Forward%20API`,target:`_blank`,rel:`noreferrer`,children:`REST message`})]}):null,k.data?.status===`missing`&&k.data.missing?.length?(0,I.jsxs)(`div`,{className:`rounded-md border p-3 bg-muted/30`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground mb-2`,children:`Missing items:`}),ie?(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground mb-2`,children:[`Create the missing `,(0,I.jsx)(`span`,{className:`font-medium`,children:`tables`}),` `,`in ServiceNow first; then click`,` `,(0,I.jsx)(`span`,{className:`font-medium`,children:`Install demo app`}),` to let Skyforge auto-create the rest.`]}):(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground mb-2`,children:[`Click `,(0,I.jsx)(`span`,{className:`font-medium`,children:`Install demo app`}),` to let Skyforge auto-create these fields/choices.`]}),(0,I.jsx)(`ul`,{className:`text-xs font-mono space-y-1`,children:k.data.missing.map(e=>(0,I.jsxs)(`li`,{children:[`- `,e]},e))})]}):null,(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(R,{variant:`secondary`,onClick:()=>void k.refetch(),disabled:!s?.configured||k.isFetching,children:`Check schema`}),(0,I.jsx)(`a`,{className:`text-sm underline text-muted-foreground`,href:`/dashboard/docs/servicenow`,target:`_blank`,rel:`noreferrer`,children:`Docs`})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Configuration`}),(0,I.jsx)(H,{children:`Skyforge uses ServiceNow admin creds to install/configure. Forward creds are stored in ServiceNow as a Basic Auth credential for the demo REST Message.`})]}),(0,I.jsxs)(U,{className:`space-y-6`,children:[(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`ServiceNow instance URL`}),(0,I.jsx)(J,{value:c,onChange:e=>l(e.target.value),placeholder:`https://dev12345.service-now.com`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`ServiceNow admin username`}),(0,I.jsx)(J,{value:u,onChange:e=>d(e.target.value),placeholder:`admin`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`ServiceNow admin password`}),(0,I.jsx)(J,{type:`password`,value:p,onChange:e=>m(e.target.value),placeholder:s?.hasAdminPassword?`(leave blank to keep stored)`:``})]})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Forward credentials`}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Uses Forward SaaS (`,(0,I.jsx)(`code`,{children:`https://fwd.app`}),`).`]}),(0,I.jsxs)(Y,{value:y===`custom`?`custom`:y===`credentialSet`?`credset:${_||``}`:h||``,onValueChange:e=>{if(e===`custom`){b(`custom`),g(``),v(``);return}if(e.startsWith(`credset:`)){b(`credentialSet`),g(``),v(e.replace(/^credset:/,``));return}b(`collector`),g(e),v(``)},children:[(0,I.jsx)(Z,{className:`w-full`,children:(0,I.jsx)(X,{placeholder:`Select a collector`})}),(0,I.jsxs)(Q,{children:[E.map(e=>(0,I.jsxs)($,{value:e.id,children:[e.name,e.isDefault?` (default)`:``]},e.id)),ne.length?(0,I.jsx)(I.Fragment,{children:ne.map(e=>(0,I.jsxs)($,{value:`credset:${e.id}`,children:[`Credential set: `,e.name,e.username?` (${e.username})`:``]},e.id))}):null,(0,I.jsx)($,{value:`custom`,children:`Custom`})]})]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:(0,I.jsx)(`a`,{className:`underline`,href:`/dashboard/fwd/collector`,children:`Manage credential sets`})}),D.isError?(0,I.jsxs)(`p`,{className:`text-xs text-destructive`,children:[`Failed to load credential sets:`,` `,D.error.message]}):null]}),y===`custom`?(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Forward username`}),(0,I.jsx)(J,{value:x,onChange:e=>ee(e.target.value),placeholder:`you@example.com`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Forward password`}),(0,I.jsx)(J,{type:`password`,value:S,onChange:e=>C(e.target.value),placeholder:s?.hasForwardPassword?`(leave blank to keep stored)`:``})]})]}):null,(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Forward integration`}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(Us,{id:`snow-configure-ticketing-on-save`,checked:w,onCheckedChange:e=>te(!!e)}),(0,I.jsx)(q,{htmlFor:`snow-configure-ticketing-on-save`,className:`font-normal text-sm`,children:`Configure Forward ticketing integration on save`})]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Configures Forward SaaS to auto-create and auto-update incidents in this ServiceNow instance.`})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(R,{onClick:()=>oe.mutate(),disabled:oe.isPending||se.isPending,children:`Save`}),(0,I.jsx)(R,{variant:`secondary`,onClick:()=>se.mutate(),disabled:se.isPending||oe.isPending||!s?.configured||ie,children:`Install demo app`}),A?(0,I.jsx)(R,{variant:`outline`,asChild:!0,disabled:!s?.configured||ie,children:(0,I.jsx)(`a`,{href:A,target:`_blank`,rel:`noreferrer`,children:`Open in ServiceNow`})}):null,(0,I.jsx)(R,{variant:`secondary`,onClick:()=>ce.mutate(),disabled:ce.isPending||oe.isPending||!s?.configured,children:`Configure Forward (ticketing)`}),(0,I.jsx)(`a`,{className:`text-sm underline text-muted-foreground ml-2`,href:`/dashboard/docs/servicenow`,target:`_blank`,rel:`noreferrer`,children:`Docs`}),s?.lastInstallStatus?(0,I.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Status: `,s.lastInstallStatus,s.lastInstallError?` (${s.lastInstallError})`:``]}):null]})]})]})]})}const Yc=t(`/dashboard/s3`)({component:Xc});function Xc(){let[e,t]=(0,P.useState)(``),n=f({queryKey:W.userArtifacts(`me`),queryFn:async()=>ka(`me`,{prefix:e||void 0}),staleTime:1e4,enabled:!0}),r=n.data?.items??[],i=(0,P.useMemo)(()=>[{id:`object`,header:`Object`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.key})},{id:`actions`,header:`Actions`,width:300,align:`right`,cell:e=>(0,I.jsxs)(`div`,{className:`flex justify-end gap-2`,children:[e.key.toLowerCase().endsWith(`.json`)&&(0,I.jsxs)(R,{variant:`outline`,size:`sm`,onClick:async()=>{try{let t=await Aa(`me`,e.key),n=atob(t.fileData),r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);let i=new TextDecoder().decode(r),a=JSON.stringify(JSON.parse(i),null,2),o=new Blob([a],{type:`application/json`}),s=URL.createObjectURL(o);window.open(s,`_blank`,`noopener,noreferrer`),window.setTimeout(()=>URL.revokeObjectURL(s),1e4)}catch(e){O.error(`View failed`,{description:e.message})}},disabled:!1,children:[(0,I.jsx)(Ue,{className:`mr-2 h-3 w-3`}),`View`]}),(0,I.jsxs)(R,{variant:`outline`,size:`sm`,onClick:async()=>{try{let t=await Aa(`me`,e.key),n=atob(t.fileData),r=new Uint8Array(n.length);for(let e=0;e<n.length;e++)r[e]=n.charCodeAt(e);let i=new Blob([r]),a=URL.createObjectURL(i),o=document.createElement(`a`);o.href=a,o.download=e.key.split(`/`).pop()||`artifact`,document.body.appendChild(o),o.click(),o.remove(),URL.revokeObjectURL(a)}catch(e){O.error(`Download failed`,{description:e.message})}},disabled:!1,children:[(0,I.jsx)(N,{className:`mr-2 h-3 w-3`}),`Download`]}),(0,I.jsxs)(R,{variant:`destructive`,size:`sm`,onClick:async()=>{if(confirm(`Delete ${e.key}?`))try{await Ma(`me`,e.key),O.success(`Deleted`,{description:e.key}),await n.refetch()}catch(e){O.error(`Delete failed`,{description:e.message})}},disabled:!1,children:[(0,I.jsx)(Ln,{className:`mr-2 h-3 w-3`}),`Delete`]})]})}],[n.refetch,`me`]),a=(0,I.jsx)(`div`,{className:`p-4 border-b flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center`,children:[(0,I.jsx)(J,{placeholder:`Prefix (e.g. topology/)`,value:e,onChange:e=>t(e.target.value),className:`w-[260px]`}),(0,I.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>n.refetch(),disabled:!1,children:`Refresh`}),(0,I.jsxs)(R,{variant:`outline`,size:`sm`,onClick:async()=>{let e=window.prompt(`Folder prefix (e.g. uploads/)`);if(e)try{await Na(`me`,e),O.success(`Folder created`),await n.refetch()}catch(e){O.error(`Create folder failed`,{description:e.message})}},disabled:!1,children:[(0,I.jsx)(An,{className:`mr-2 h-3 w-3`}),`Folder`]}),(0,I.jsxs)(R,{variant:`outline`,size:`sm`,onClick:()=>{let t=document.createElement(`input`);t.type=`file`,t.onchange=()=>{let r=t.files?.[0];r&&(async()=>{try{let t=new Uint8Array(await r.arrayBuffer()),i=``,a=32*1024;for(let e=0;e<t.length;e+=a){let n=t.subarray(e,e+a);i+=btoa(String.fromCharCode(...n))}let o=(e||``)+r.name;await ja(`me`,{key:o,contentBase64:i,contentType:r.type||`application/octet-stream`}),O.success(`Uploaded`,{description:o}),await n.refetch()}catch(e){O.error(`Upload failed`,{description:e.message})}})()},t.click()},disabled:!1,children:[(0,I.jsx)(ae,{className:`mr-2 h-3 w-3`}),`Upload`]})]})});return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`S3`}),(0,I.jsx)(H,{children:`Personal artifacts and generated files (backed by the platform object store).`})]})}),(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`p-0`,children:n.isLoading?(0,I.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,I.jsx)(G,{className:`h-12 w-full`}),(0,I.jsx)(G,{className:`h-12 w-full`}),(0,I.jsx)(G,{className:`h-12 w-full`})]}):(0,I.jsxs)(`div`,{children:[a,n.isError?(0,I.jsx)(`div`,{className:`p-8 text-center text-destructive`,children:`Failed to list objects.`}):r.length===0?(0,I.jsx)(`div`,{className:`p-6`,children:(0,I.jsx)(_s,{icon:At,title:`No objects found`,description:`No artifacts found.`})}):(0,I.jsx)(gs,{columns:i,rows:r,getRowId:e=>e.key,maxHeightClassName:`max-h-[60vh]`,minWidthClassName:`min-w-[900px]`})]})})})]})}const Zc=t(`/dashboard/policy-reports`)({component:Qc});function Qc(){return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsxs)(`div`,{className:`space-y-1 border-b pb-6`,children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Policy & Compliance`}),(0,I.jsx)(`p`,{className:`text-muted-foreground text-sm`,children:`Policy workflows are per-user. Select a Forward network in Assurance Hub to run checks.`})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Assurance Hub`}),(0,I.jsx)(H,{children:`Configure Forward credentials and network bindings, then launch assurance/capacity/compliance flows.`})]}),(0,I.jsx)(U,{children:(0,I.jsx)(m,{to:`/dashboard/fwd`,className:`text-sm text-primary underline hover:no-underline`,children:`Open Assurance Hub`})})]}),(0,I.jsx)(_s,{title:`Shared model removed`,description:`Policy and compliance now run directly from your personal account and selected Forward network.`,icon:$e})]})}const $c=t(`/dashboard/integrations`)({component:el});function el(){let e=f({queryKey:W.userServiceNowConfig(),queryFn:Dr,retry:!1,staleTime:1e4}),t=f({queryKey:W.userForwardCollectorConfigs(),queryFn:_a,retry:!1,staleTime:1e4}),n=f({queryKey:W.userElasticConfig(),queryFn:Pr,retry:!1,staleTime:1e4}),r=t.data?.collectors?.length??0,i=r>0;return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold`,children:`Integrations`}),(0,I.jsx)(`p`,{className:`mt-1 text-sm text-muted-foreground`,children:`Connect optional tools and accounts that enhance Skyforge workflows.`})]}),(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsx)(B,{children:(0,I.jsxs)(V,{className:`flex items-center gap-2`,children:[(0,I.jsx)(Ut,{className:`h-5 w-5`}),`Forward collector`]})}),(0,I.jsxs)(U,{className:`space-y-3 text-sm`,children:[(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:t.isLoading?`Loading`:i?`${r} collector(s) configured`:`No collectors configured`}),(0,I.jsx)(`div`,{className:`flex gap-2`,children:(0,I.jsx)(R,{asChild:!0,size:`sm`,children:(0,I.jsx)(m,{to:`/dashboard/fwd/collector`,children:`Open`})})})]})]}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`ServiceNow`})}),(0,I.jsxs)(U,{className:`space-y-3 text-sm`,children:[(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:e.isLoading?`Loading`:e.data?.configured?`Configured (${e.data.instanceUrl??`instance`})`:`Not configured`}),(0,I.jsxs)(`div`,{className:`flex gap-2`,children:[(0,I.jsx)(R,{asChild:!0,size:`sm`,children:(0,I.jsx)(m,{to:`/dashboard/servicenow`,children:`Open`})}),(0,I.jsx)(R,{asChild:!0,size:`sm`,variant:`secondary`,children:(0,I.jsx)(m,{to:`/dashboard/docs/$slug`,params:{slug:`servicenow`},children:`Docs`})})]})]})]}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Elastic`})}),(0,I.jsxs)(U,{className:`space-y-3 text-sm`,children:[(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:n.isLoading?`Loading`:n.data?.enabled?n.data?.configured?`Configured (${n.data.url??`endpoint`})`:`Not configured`:`Disabled`}),(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,I.jsx)(R,{asChild:!0,size:`sm`,children:(0,I.jsx)(m,{to:`/dashboard/elastic`,children:`Open`})}),(0,I.jsx)(R,{asChild:!0,size:`sm`,variant:`secondary`,children:(0,I.jsxs)(`a`,{href:`/kibana/`,children:[`Kibana `,(0,I.jsx)(re,{className:`ml-1 inline h-4 w-4`})]})})]})]})]}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Advanced settings`})}),(0,I.jsxs)(U,{className:`space-y-3 text-sm`,children:[(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`Cloud creds, BYOL servers, defaults, and external template repos.`}),(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,I.jsx)(R,{asChild:!0,size:`sm`,variant:`secondary`,children:(0,I.jsx)(m,{to:`/dashboard/settings`,children:`Open My Settings`})}),(0,I.jsx)(R,{asChild:!0,size:`sm`,variant:`secondary`,children:(0,I.jsxs)(`a`,{href:`/dashboard/docs/getting-started`,children:[`Getting started`,` `,(0,I.jsx)(re,{className:`ml-1 inline h-4 w-4`})]})})]})]})]})]})]})}const tl=t(`/dashboard/forward`)({component:nl});function nl(){return(0,I.jsx)(n,{to:`/dashboard/fwd/collector`,replace:!0})}const rl=t(`/dashboard/elastic`)({component:sl});function il(e,t){return e?.services?.find(e=>String(e.id)===t)}function al(e){let t=il(e,`elasticsearch`),n=il(e,`kibana`);return(t?.desiredReplicas??0)===0&&(n?.desiredReplicas??0)===0}function ol(e){let t=il(e,`elasticsearch`);return(t?.desiredReplicas??0)>0&&(t?.availableReplicas??0)>0}function sl(){let e=o(),t=f({queryKey:W.userElasticConfig(),queryFn:Pr,retry:!1,staleTime:1e4}),n=t.data,r=n?.enabled??!1,a=n?.defaultUrl??``,s=n?.defaultIndexPrefix??``,c=f({queryKey:W.elasticToolsStatus(),queryFn:Vr,retry:!1,staleTime:5e3,enabled:r}),[l,u]=(0,P.useState)(``),[d,p]=(0,P.useState)(``),[h,g]=(0,P.useState)(`none`),[_,v]=(0,P.useState)(``),[y,x]=(0,P.useState)(``),[ee,S]=(0,P.useState)(``),[C,w]=(0,P.useState)(!1);(0,P.useEffect)(()=>{if(!n)return;u(n.url??n.defaultUrl??``),p(n.indexPrefix??n.defaultIndexPrefix??``);let e=String(n.authType??`none`).toLowerCase();g(e===`basic`||e===`api_key`?e:`none`),x(n.basicUsername??``),v(``),S(``)},[n]);let te=(0,P.useMemo)(()=>({url:l,indexPrefix:d,authType:h,apiKey:_,basicUsername:y,basicPassword:ee,verifyTls:!0}),[_,h,ee,y,d,l]),T=(0,P.useMemo)(()=>!(!l.trim()&&!a.trim()||!d.trim()&&!s.trim()||h===`api_key`&&!_.trim()&&!n?.hasApiKey||h===`basic`&&!y.trim()||h===`basic`&&!ee.trim()&&!n?.hasBasicPassword),[_,h,ee,y,s,a,d,n,l]),E=i({mutationFn:async()=>Hr(),onSuccess:async()=>{await e.invalidateQueries({queryKey:W.elasticToolsStatus()})}}),D=async()=>{let e;try{e=await Vr()}catch{return}if(!e?.autosleepEnabled||!al(e))return;try{await Hr()}catch{return}let t=Date.now()+6e4;for(;Date.now()<t;){try{let e=await Vr();if(!al(e)&&ol(e))return}catch{}await new Promise(e=>setTimeout(e,2e3))}},ne=i({mutationFn:async()=>Fr(te),onSuccess:async()=>{O.success(`Elastic config saved`),await e.invalidateQueries({queryKey:W.userElasticConfig()})},onError:e=>O.error(`Failed to save Elastic config`,{description:e.message})}),k=i({mutationFn:async()=>Ir(),onSuccess:async()=>{O.success(`Elastic config cleared`),await e.invalidateQueries({queryKey:W.userElasticConfig()})},onError:e=>O.error(`Failed to clear Elastic config`,{description:e.message})}),ie=i({mutationFn:async()=>(await D(),Lr()),onSuccess:e=>{String(e.status).toLowerCase()===`ok`?O.success(`Elastic reachable`):O.error(`Elastic test failed`,{description:e.detail??`unknown error`})},onError:e=>O.error(`Failed to test Elastic`,{description:e.message})});return(0,P.useEffect)(()=>{r&&c.data?.autosleepEnabled&&al(c.data)&&(E.isPending||C||(w(!0),E.mutate()))},[r,c.data,C]),(0,I.jsxs)(`div`,{className:`space-y-6 p-6 pb-20`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(m,{to:`/dashboard/integrations`,className:So({variant:`outline`,size:`icon`,className:`h-9 w-9`}),children:(0,I.jsx)(it,{className:`h-4 w-4`})}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Elastic`}),(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Optional per-user Elasticsearch settings for indexing Skyforge events.`})]})]}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsx)(B,{children:(0,I.jsxs)(V,{className:`flex items-center gap-2`,children:[(0,I.jsx)(b,{className:`h-5 w-5`}),`Integration Status`]})}),(0,I.jsxs)(U,{className:`space-y-3 text-sm`,children:[t.isLoading?(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`Loading`}):t.isError?(0,I.jsxs)(`div`,{className:`text-destructive`,children:[`Failed to load:`,` `,t.error instanceof Error?t.error.message:String(t.error)]}):r?(0,I.jsxs)(`div`,{className:`space-y-1 text-muted-foreground`,children:[(0,I.jsxs)(`div`,{children:[t.data?.configured?`Configured`:`Not configured`,`  Default: `,(0,I.jsx)(`span`,{className:`font-mono`,children:a||``})]}),c.isLoading?(0,I.jsx)(`div`,{children:`Tools: loading`}):c.isError?(0,I.jsx)(`div`,{children:`Tools: status unavailable`}):c.data?(0,I.jsxs)(`div`,{children:[`Tools:`,` `,al(c.data)?E.isPending?`waking`:`asleep`:ol(c.data)?`ready`:`starting`,c.data.autosleepEnabled?`  autosleep ${c.data.idleMinutes}m`:``]}):null]}):(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:"Elastic is disabled on this Skyforge instance. Ask an admin to enable `skyforge.elastic.enabled` in the Helm values."}),(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,I.jsxs)(R,{size:`sm`,variant:`secondary`,disabled:t.isLoading||t.isError||ie.isPending||E.isPending,onClick:()=>ie.mutate(),children:[(0,I.jsx)(nt,{className:`mr-2 h-4 w-4`}),`Test`]}),(0,I.jsx)(R,{size:`sm`,variant:`secondary`,asChild:!0,children:(0,I.jsxs)(`a`,{href:`/kibana/`,target:`_blank`,rel:`noreferrer noopener`,children:[`Open Kibana `,(0,I.jsx)(re,{className:`ml-1 inline h-4 w-4`})]})}),(0,I.jsxs)(R,{size:`sm`,variant:`outline`,disabled:k.isPending||t.isLoading||t.isError,onClick:()=>k.mutate(),children:[(0,I.jsx)(Ln,{className:`mr-2 h-4 w-4`}),`Clear`]})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Configuration`})}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{htmlFor:`elastic-url`,children:`Elasticsearch URL`}),(0,I.jsx)(J,{id:`elastic-url`,value:l,onChange:e=>u(e.target.value),placeholder:a||`http://elasticsearch:9200`}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Leave blank to use the instance default`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:a||`http://elasticsearch:9200`}),`.`]})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{htmlFor:`elastic-index`,children:`Index prefix`}),(0,I.jsx)(J,{id:`elastic-index`,value:d,onChange:e=>p(e.target.value),placeholder:s||`skyforge`}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Leave blank to use the instance default`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:s||`skyforge`}),`.`]})]}),(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Auth`}),(0,I.jsxs)(Y,{value:h,onValueChange:e=>g(e),children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select auth`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`none`,children:`None`}),(0,I.jsx)($,{value:`api_key`,children:`API key`}),(0,I.jsx)($,{value:`basic`,children:`Basic auth`})]})]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:h===`api_key`&&t.data?.hasApiKey?`API key stored. Leave blank to keep.`:h===`basic`&&t.data?.hasBasicPassword?`Password stored. Leave blank to keep.`:`Secrets are stored encrypted; they are not shown again.`})]}),h===`api_key`?(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{htmlFor:`elastic-api-key`,children:`API key`}),(0,I.jsx)(J,{id:`elastic-api-key`,value:_,onChange:e=>v(e.target.value),placeholder:t.data?.hasApiKey?`(stored)`:`ApiKey ...`})]}):h===`basic`?(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{htmlFor:`elastic-basic-user`,children:`Username`}),(0,I.jsx)(J,{id:`elastic-basic-user`,value:y,onChange:e=>x(e.target.value),placeholder:`elastic`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{htmlFor:`elastic-basic-pass`,children:`Password`}),(0,I.jsx)(J,{id:`elastic-basic-pass`,value:ee,onChange:e=>S(e.target.value),placeholder:t.data?.hasBasicPassword?`(stored)`:``})]})]}):(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No auth headers will be sent.`})]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,I.jsx)(R,{disabled:!T||ne.isPending,onClick:()=>ne.mutate(),children:`Save`}),(0,I.jsx)(R,{variant:`secondary`,disabled:ie.isPending||E.isPending||t.isLoading||t.isError,onClick:()=>ie.mutate(),children:`Test`})]})]})]})]})}const cl=t(`/admin/settings`)({component:ll});function ll(){let e=f({queryKey:W.session(),queryFn:_r,staleTime:3e4,retry:!1}),t=!!e.data?.isAdmin,[n,r]=(0,P.useState)(`200`),a=f({queryKey:W.adminAudit(n),queryFn:()=>Ua({limit:n}),enabled:t,staleTime:15e3,retry:!1}),o=f({queryKey:W.adminConfig(),queryFn:Ha,enabled:t,staleTime:15e3,retry:!1}),s=f({queryKey:W.adminImpersonateStatus(),queryFn:Wa,enabled:t,staleTime:5e3,retry:!1}),c=i({mutationFn:async e=>qa({limit:e}),onSuccess:e=>{O.success(`Reconciled queued tasks`,{description:`Considered ${e.consideredTasks}, republished ${e.republished}, errors ${e.publishErrors}`})},onError:e=>{O.error(`Failed to reconcile queued tasks`,{description:e.message})}}),l=i({mutationFn:async e=>Ja({limit:e.limit,hardMaxRuntimeMinutes:e.hardMaxRuntimeMinutes,maxIdleMinutes:e.maxIdleMinutes}),onSuccess:e=>{O.success(`Reconciled running tasks`,{description:`Considered ${e.consideredTasks}, marked failed ${e.markedFailed}, errors ${e.finishErrors}`})},onError:e=>{O.error(`Failed to reconcile running tasks`,{description:e.message})}}),[u,d]=(0,P.useState)(``),p=i({mutationFn:async()=>Ga({username:u}),onSuccess:()=>{O.success(`Impersonation started`),s.refetch(),window.location.reload()},onError:e=>{O.error(`Failed to impersonate`,{description:e.message})}}),m=i({mutationFn:async()=>Ka(),onSuccess:()=>{O.success(`Impersonation stopped`),s.refetch(),window.location.reload()},onError:e=>{O.error(`Failed to stop impersonation`,{description:e.message})}}),[h,g]=(0,P.useState)(``),_=i({mutationFn:async()=>Ya({username:h,confirm:h}),onSuccess:e=>{O.success(`User purged`,{description:`Deleted personal resources: ${e.deletedOwners}`})},onError:e=>{O.error(`Failed to purge user`,{description:e.message})}}),v=(0,P.useMemo)(()=>[{id:`createdAt`,header:`Time`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:e.createdAt}),width:220},{id:`actor`,header:`Actor`,cell:e=>(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`font-medium`,children:e.actorUsername}),e.actorIsAdmin?(0,I.jsx)(K,{variant:`secondary`,children:`admin`}):null,e.impersonatedUsername?(0,I.jsxs)(K,{variant:`outline`,children:[`as `,e.impersonatedUsername]}):null]}),width:260},{id:`action`,header:`Action`,cell:e=>e.action,width:260},{id:`ownerUsername`,header:`Context`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:e.ownerUsername}),width:220},{id:`details`,header:`Details`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.details})}],[]);return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`System settings`}),(0,I.jsx)(H,{children:`Admin-only settings for Skyforge.`})]})}),!t&&(0,I.jsx)(z,{variant:`danger`,children:(0,I.jsx)(U,{className:`pt-6`,children:(0,I.jsx)(`div`,{className:`text-center font-medium`,children:`Admin access required.`})})}),t&&(0,I.jsxs)(ac,{defaultValue:`overview`,children:[(0,I.jsxs)(oc,{children:[(0,I.jsx)(sc,{value:`overview`,children:`Overview`}),(0,I.jsx)(sc,{value:`audit`,children:`Audit`}),(0,I.jsx)(sc,{value:`tasks`,children:`Tasks`}),(0,I.jsx)(sc,{value:`users`,children:`Users`})]}),(0,I.jsxs)(cc,{value:`overview`,className:`space-y-6`,children:[(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Effective config`}),(0,I.jsx)(H,{children:`Read-only view of the running server's non-secret Encore config.`})]}),(0,I.jsx)(U,{children:o.isLoading?(0,I.jsx)(G,{className:`h-40 w-full`}):o.data?(0,I.jsxs)(`div`,{className:`space-y-3`,children:[o.data.missing?.length?(0,I.jsxs)(`div`,{className:`rounded-md border border-destructive/40 bg-destructive/10 p-3 text-sm`,children:[(0,I.jsx)(`div`,{className:`font-medium`,children:`Missing config`}),(0,I.jsx)(`ul`,{className:`list-disc pl-5 text-muted-foreground`,children:o.data.missing.map(e=>(0,I.jsx)(`li`,{children:e},e))})]}):null,(0,I.jsx)(`pre`,{className:`max-h-[420px] overflow-auto rounded-md border bg-muted/50 p-3 text-xs`,children:JSON.stringify(o.data,null,2)})]}):(0,I.jsx)(_s,{title:`No config`,description:`Could not load effective config.`})})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Impersonation`}),(0,I.jsx)(H,{children:`Impersonate another user to reproduce issues or verify UX.`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(qe,{className:`h-5 w-5 text-muted-foreground`}),(0,I.jsxs)(`div`,{className:`text-sm`,children:[(0,I.jsx)(`span`,{className:`font-medium`,children:s.data?.actorUsername||e.data?.username||``}),s.data?.impersonating?(0,I.jsxs)(I.Fragment,{children:[` `,``,` `,(0,I.jsx)(`span`,{className:`font-medium`,children:s.data.effectiveUsername}),(0,I.jsx)(K,{className:`ml-2`,variant:`secondary`,children:`impersonating`})]}):(0,I.jsx)(K,{className:`ml-2`,variant:`outline`,children:`not impersonating`})]})]}),(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center`,children:[(0,I.jsx)(J,{placeholder:`user@example.com`,value:u,onChange:e=>d(e.target.value)}),(0,I.jsxs)(R,{onClick:()=>p.mutate(),disabled:p.isPending||!u.trim()||s.data?.impersonating,children:[(0,I.jsx)(Me,{className:`mr-2 h-4 w-4`}),`Impersonate`]}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>m.mutate(),disabled:m.isPending||!s.data?.impersonating,children:`Stop`})]})]})]})]}),(0,I.jsx)(cc,{value:`audit`,className:`space-y-6`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Audit log`}),(0,I.jsx)(H,{children:`Recent admin and user actions.`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`Limit`}),(0,I.jsx)(J,{className:`w-28`,value:n,onChange:e=>r(e.target.value)})]}),(0,I.jsx)(K,{variant:`outline`,children:a.data?.timestamp??``})]}),(0,I.jsx)(gs,{rows:a.data?.events??[],columns:v,getRowId:e=>String(e.id),isLoading:a.isLoading,emptyText:`No audit events.`,minWidthClassName:`min-w-[1100px]`})]})]})}),(0,I.jsx)(cc,{value:`tasks`,className:`space-y-6`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Task reconciliation`}),(0,I.jsx)(H,{children:`Manual guardrails for stuck queued/running jobs.`})]}),(0,I.jsxs)(U,{className:`space-y-6`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`font-medium`,children:`Queued tasks`}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Republish missing queue events.`})]}),(0,I.jsx)(R,{variant:`outline`,disabled:c.isPending,onClick:()=>c.mutate(200),children:c.isPending?`Running`:`Reconcile queued`})]}),(0,I.jsxs)(`div`,{className:`flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`font-medium`,children:`Running tasks`}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Mark long-running/no-log tasks failed.`})]}),(0,I.jsx)(R,{variant:`outline`,disabled:l.isPending,onClick:()=>l.mutate({limit:50,hardMaxRuntimeMinutes:720,maxIdleMinutes:120}),children:l.isPending?`Running`:`Reconcile running`})]})]})]})}),(0,I.jsx)(cc,{value:`users`,className:`space-y-6`,children:(0,I.jsxs)(z,{variant:`danger`,children:[(0,I.jsxs)(B,{children:[(0,I.jsxs)(V,{className:`flex items-center gap-2`,children:[(0,I.jsx)(Te,{className:`h-5 w-5`}),`Purge user (dev-only)`]}),(0,I.jsx)(H,{children:`Removes user state and associated personal resources to rerun first-login bootstrap.`})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsx)(J,{placeholder:`user@example.com`,value:h,onChange:e=>g(e.target.value)}),(0,I.jsx)(R,{variant:`destructive`,disabled:!h.trim()||_.isPending,onClick:()=>_.mutate(),children:_.isPending?`Purging`:`Purge user`})]})]})})]})]})}function ul(e){let t=Number(e);if(!Number.isFinite(t)||t<=0)return``;if(t<60)return`${Math.round(t)}s`;let n=Math.round(t/60);if(n<60)return`${n}m`;let r=Math.round(n/60);return r<48?`${r}h`:`${Math.round(r/24)}d`}var dl=qn({q:Hn().optional().catch(``),tab:Gn([`policy`,`resources`,`costs`,`usage`]).optional().catch(`policy`)});const fl=t(`/admin/governance`)({validateSearch:e=>dl.parse(e),loaderDeps:({search:{q:e,tab:t}})=>({q:e,tab:t}),loader:async({context:{queryClient:e}})=>{(await e.ensureQueryData({queryKey:W.session(),queryFn:_r,staleTime:3e4,retry:!1}))?.isAdmin&&await Promise.all([e.ensureQueryData({queryKey:W.governancePolicy(),queryFn:Xa}),e.ensureQueryData({queryKey:W.governanceSummary(),queryFn:La}),e.ensureQueryData({queryKey:W.governanceResources(`500`),queryFn:()=>Ra({limit:`500`})}),e.ensureQueryData({queryKey:W.governanceCosts(`50`),queryFn:()=>za({limit:`50`})}),e.ensureQueryData({queryKey:W.governanceUsage(`500`),queryFn:()=>Ba({limit:`500`})})])},component:pl});function pl(){let e=o(),t=fl.useNavigate(),{q:n,tab:r}=fl.useSearch(),a=!!f({queryKey:W.session(),queryFn:_r,staleTime:3e4,retry:!1}).data?.isAdmin,s=f({queryKey:W.governanceSummary(),queryFn:La,staleTime:3e4,enabled:a}),c=f({queryKey:W.governancePolicy(),queryFn:Xa,staleTime:3e4,enabled:a,retry:!1}),l=f({queryKey:W.governanceResources(`500`),queryFn:()=>Ra({limit:`500`}),staleTime:3e4,enabled:a}),u=f({queryKey:W.governanceCosts(`50`),queryFn:()=>za({limit:`50`}),staleTime:3e4,enabled:a}),d=f({queryKey:W.governanceUsage(`500`),queryFn:()=>Ba({limit:`500`}),staleTime:3e4,enabled:a}),p=(0,P.useMemo)(()=>(d.data?.usage??[]).map(e=>({...e,userType:String(e?.userType??``)})),[d.data?.usage]),m=(0,P.useMemo)(()=>(l.data?.resources??[]).map(e=>({...e,ownerLabel:String(e?.ownerLabel??e?.ownerUsername??``)})),[l.data?.resources]),h=(0,P.useMemo)(()=>{let e=new Map;for(let t of p){if(t.userType!==`cluster`)continue;let n=String(t.metric??``);if(!n)continue;let r=e.get(n);if(!r){e.set(n,t);continue}new Date(String(t.collectedAt)).getTime()>new Date(String(r.collectedAt)).getTime()&&e.set(n,t)}return e},[p]),g=(0,P.useMemo)(()=>{let e=new Map;for(let t of p){if(t.userType!==`user`)continue;let n=String(t.ownerUsername??``).trim();if(!n)continue;let r=String(t.metric??``).trim();if(!r)continue;let i=Number(t.value??0),a=String(t.collectedAt??``),o=e.get(n)??{user:n,deploymentsActive:0,deploymentsTotal:0,collectorsTotal:0,tasksRunning:0,lastSeenAt:a};switch(r){case`deployments.active`:o.deploymentsActive=i;break;case`deployments.total`:o.deploymentsTotal=i;break;case`collectors.total`:o.collectorsTotal=i;break;case`tasks.running`:o.tasksRunning=i;break;default:break}new Date(a).getTime()>new Date(o.lastSeenAt).getTime()&&(o.lastSeenAt=a),e.set(n,o)}return Array.from(e.values()).sort((e,t)=>t.deploymentsActive===e.deploymentsActive?t.tasksRunning===e.tasksRunning?e.user.localeCompare(t.user):t.tasksRunning-e.tasksRunning:t.deploymentsActive-e.deploymentsActive)},[p]),_=(0,P.useMemo)(()=>{let e=m,t=n?.trim().toLowerCase()||``;return t?e.filter(e=>[e.name,e.resourceId,e.resourceType,e.ownerLabel,e.owner,e.provider].filter(Boolean).join(` `).toLowerCase().includes(t)):e},[m,n]),v=i({mutationFn:async()=>{await Va()},onSuccess:async()=>{O.success(`Governance sources synced`,{description:`Resource inventory updated.`}),await Promise.all([e.invalidateQueries({queryKey:W.governanceSummary()}),e.invalidateQueries({queryKey:W.governanceResources(`500`)}),e.invalidateQueries({queryKey:W.governanceCosts(`50`)}),e.invalidateQueries({queryKey:W.governanceUsage(`500`)})])},onError:e=>{O.error(`Failed to sync governance sources`,{description:e.message})}}),[y,x]=(0,P.useState)({maxDeploymentsPerUser:0,maxCollectorsPerUser:0,allowUserByosNetlabServers:!0,allowUserByosContainerlabServers:!0,allowUserExternalTemplateRepos:!0,allowCustomTemplateRepos:!0});(0,P.useEffect)(()=>{c.data?.policy&&x({maxDeploymentsPerUser:c.data.policy.maxDeploymentsPerUser??0,maxCollectorsPerUser:c.data.policy.maxCollectorsPerUser??0,allowUserByosNetlabServers:c.data.policy.allowUserByosNetlabServers??!0,allowUserByosContainerlabServers:c.data.policy.allowUserByosContainerlabServers??!0,allowUserExternalTemplateRepos:c.data.policy.allowUserExternalTemplateRepos??!0,allowCustomTemplateRepos:c.data.policy.allowCustomTemplateRepos??!0})},[c.data?.policy?.maxDeploymentsPerUser,c.data?.policy?.maxCollectorsPerUser,c.data?.policy?.allowUserByosNetlabServers,c.data?.policy?.allowUserByosContainerlabServers,c.data?.policy?.allowUserExternalTemplateRepos,c.data?.policy?.allowCustomTemplateRepos]);let ee=i({mutationFn:async()=>Za({policy:{maxDeploymentsPerUser:Math.max(0,y.maxDeploymentsPerUser),maxCollectorsPerUser:Math.max(0,y.maxCollectorsPerUser),allowUserByosNetlabServers:!!y.allowUserByosNetlabServers,allowUserByosContainerlabServers:!!y.allowUserByosContainerlabServers,allowUserExternalTemplateRepos:!!y.allowUserExternalTemplateRepos,allowCustomTemplateRepos:!!y.allowCustomTemplateRepos}}),onSuccess:async()=>{O.success(`Governance policy saved`),await e.invalidateQueries({queryKey:W.governancePolicy()})},onError:e=>{O.error(`Failed to save governance policy`,{description:e.message})}}),S=s.data,C=e=>{t({search:t=>({...t,q:e}),replace:!0})};return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(V,{children:`Governance`}),(0,I.jsx)(H,{children:`Admin-only guardrails, inventory, cost, and usage telemetry.`})]}),(0,I.jsxs)(R,{variant:`outline`,size:`sm`,disabled:v.isPending||!a,onClick:()=>v.mutate(),children:[(0,I.jsx)(ct,{className:`mr-2 h-4 w-4 ${v.isPending?`animate-spin`:``}`}),v.isPending?`Syncing`:`Sync sources`]})]})})}),!a&&(0,I.jsx)(z,{variant:`danger`,children:(0,I.jsx)(U,{className:`pt-6`,children:(0,I.jsx)(`div`,{className:`text-center font-medium text-destructive`,children:`Admin access required.`})})}),(c.isError||s.isError||l.isError||u.isError||d.isError)&&(0,I.jsx)(z,{variant:`danger`,children:(0,I.jsx)(U,{className:`pt-6`,children:(0,I.jsx)(`div`,{className:`text-center font-medium`,children:`Failed to load governance data.`})})}),s.isLoading?(0,I.jsx)(Ys,{children:[1,2,3,4].map(e=>(0,I.jsxs)(Xs,{className:`h-32`,children:[(0,I.jsx)(G,{className:`h-4 w-24 mb-4`}),(0,I.jsx)(G,{className:`h-8 w-16`})]},e))}):(0,I.jsxs)(Ys,{children:[(0,I.jsx)(Zs,{title:`Resources tracked`,value:String(S?.resourceCount??``),icon:(0,I.jsx)(b,{className:`h-5 w-5`}),gradient:`blue`}),(0,I.jsx)(Zs,{title:`Active resources`,value:String(S?.activeResources??``),icon:(0,I.jsx)(st,{className:`h-5 w-5`}),gradient:`green`}),(0,I.jsx)(Zs,{title:`Users tracked`,value:String(S?.usersTracked??``),icon:(0,I.jsx)(an,{className:`h-5 w-5`}),gradient:`purple`}),(0,I.jsx)(Zs,{title:`Last 30d spend`,value:S?`${S.costLast30Days} ${S.costCurrency}`:``,icon:(0,I.jsx)(Ht,{className:`h-5 w-5`}),gradient:`orange`})]}),(0,I.jsxs)(ac,{value:r,onValueChange:e=>{t({search:t=>({...t,tab:e}),replace:!0})},className:`space-y-6`,children:[(0,I.jsxs)(oc,{children:[(0,I.jsxs)(sc,{value:`policy`,className:`gap-2`,children:[(0,I.jsx)(At,{className:`h-4 w-4`}),`Policy`]}),(0,I.jsxs)(sc,{value:`resources`,className:`gap-2`,children:[(0,I.jsx)(b,{className:`h-4 w-4`}),`Resources`]}),(0,I.jsxs)(sc,{value:`costs`,className:`gap-2`,children:[(0,I.jsx)(zt,{className:`h-4 w-4`}),`Financials`]}),(0,I.jsxs)(sc,{value:`usage`,className:`gap-2`,children:[(0,I.jsx)(Qe,{className:`h-4 w-4`}),`Telemetry`]})]}),(0,I.jsx)(cc,{value:`policy`,className:`space-y-6 animate-in fade-in-50`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Policy`}),(0,I.jsx)(H,{children:`Optional guardrails. Use 0 for unlimited.`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Max deployments per user`}),(0,I.jsx)(J,{inputMode:`numeric`,value:String(y.maxDeploymentsPerUser),onChange:e=>x(t=>({...t,maxDeploymentsPerUser:Number.parseInt(e.target.value||`0`,10)||0}))}),(0,I.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Applies when creating new deployment definitions.`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Max collectors per user`}),(0,I.jsx)(J,{inputMode:`numeric`,value:String(y.maxCollectorsPerUser),onChange:e=>x(t=>({...t,maxCollectorsPerUser:Number.parseInt(e.target.value||`0`,10)||0}))}),(0,I.jsx)(`p`,{className:`text-xs text-muted-foreground`,children:`Applies when creating in-cluster Forward collectors.`})]})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-3 space-y-3`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Feature access`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Global toggles for user-owned integrations. Admin users are not restricted by these flags.`}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`User BYOS Netlab servers`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:"Allows using user-owned Netlab BYOS servers (serverRef = `user:...`)."})]}),(0,I.jsx)(Gs,{checked:y.allowUserByosNetlabServers,onCheckedChange:e=>x(t=>({...t,allowUserByosNetlabServers:!!e})),disabled:!a})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`User BYOS Containerlab servers`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:"Allows using user-owned Containerlab BYOS servers (serverRef = `user:...`)."})]}),(0,I.jsx)(Gs,{checked:y.allowUserByosContainerlabServers,onCheckedChange:e=>x(t=>({...t,allowUserByosContainerlabServers:!!e})),disabled:!a})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`User external template repos`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:"Allows `templateSource=external` using repos configured in user settings."})]}),(0,I.jsx)(Gs,{checked:y.allowUserExternalTemplateRepos,onCheckedChange:e=>x(t=>({...t,allowUserExternalTemplateRepos:!!e})),disabled:!a})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded-md border p-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Custom template repos`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:"Allows `templateSource=custom`. Keep disabled unless you trust users to reference safe repos."})]}),(0,I.jsx)(Gs,{checked:y.allowCustomTemplateRepos,onCheckedChange:e=>x(t=>({...t,allowCustomTemplateRepos:!!e})),disabled:!a})]})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:c.data?.retrievedAt?`Loaded ${c.data.retrievedAt}`:``}),(0,I.jsx)(R,{onClick:()=>ee.mutate(),disabled:ee.isPending||!a,children:ee.isPending?`Saving`:`Save policy`})]})]})]})}),(0,I.jsx)(cc,{value:`resources`,className:`space-y-6 animate-in fade-in-50`,children:(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsx)(V,{children:`Resource Inventory`}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(`div`,{className:`relative`,children:[(0,I.jsx)(ln,{className:`absolute left-2 top-2.5 h-4 w-4 text-muted-foreground`}),(0,I.jsx)(J,{className:`pl-8 w-full sm:w-[300px]`,placeholder:`Search resources`,value:n||``,onChange:e=>C(e.target.value)})]}),!l.isLoading&&(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground whitespace-nowrap hidden sm:block`,children:[_.length,` shown`]})]})]})}),(0,I.jsx)(U,{children:l.isLoading?(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsx)(G,{className:`h-10 w-full`}),(0,I.jsx)(G,{className:`h-10 w-full`}),(0,I.jsx)(G,{className:`h-10 w-full`})]}):_.length===0?(0,I.jsx)(_s,{icon:At,title:`No resources found`,description:`No resources match your search criteria.`}):(0,I.jsx)(gs,{columns:[{id:`name`,header:`Name`,width:`minmax(220px, 1fr)`,cell:e=>(0,I.jsx)(`span`,{className:`font-medium`,children:e.name})},{id:`provider`,header:`Provider`,width:140,cell:e=>e.provider},{id:`type`,header:`Type`,width:160,cell:e=>e.resourceType},{id:`ownerLabel`,header:`User`,width:200,cell:e=>e.ownerLabel},{id:`owner`,header:`Owner`,width:160,cell:e=>e.owner},{id:`status`,header:`Status`,width:120,cell:e=>(0,I.jsx)(K,{variant:e.status===`active`?`default`:`secondary`,children:e.status??`unknown`})}],rows:_.slice(0,500),getRowId:e=>String(e.resourceId),maxHeightClassName:`max-h-[60vh]`,minWidthClassName:`min-w-[1100px]`})})]})}),(0,I.jsx)(cc,{value:`costs`,className:`space-y-6 animate-in fade-in-50`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Cost Snapshots`}),(0,I.jsx)(H,{children:`Historical spend data per provider.`})]}),(0,I.jsx)(U,{children:u.isLoading?(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(G,{className:`h-12 w-full`}),(0,I.jsx)(G,{className:`h-12 w-full`})]}):(u.data?.costs??[]).length===0?(0,I.jsx)(_s,{icon:zt,title:`No cost data`,description:`No financial snapshots available.`}):(0,I.jsx)(gs,{columns:[{id:`provider`,header:`Provider`,width:180,cell:e=>(0,I.jsx)(`span`,{className:`font-medium`,children:e.provider})},{id:`currency`,header:`Currency`,width:120,cell:e=>e.currency},{id:`amount`,header:`Amount`,width:140,cell:e=>e.amount},{id:`periodEnd`,header:`Period End`,width:200,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:e.periodEnd})}],rows:(u.data?.costs??[]).slice(0,50),getRowId:e=>`${e.provider}:${e.periodEnd}:${e.amount}`,maxHeightClassName:`max-h-[50vh]`,minWidthClassName:`min-w-[900px]`})})]})}),(0,I.jsx)(cc,{value:`usage`,className:`space-y-6 animate-in fade-in-50`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Usage Telemetry`}),(0,I.jsx)(H,{children:`Lightweight snapshots of cluster load and user activity (no Prometheus).`})]}),(0,I.jsx)(U,{children:d.isLoading?(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(G,{className:`h-12 w-full`}),(0,I.jsx)(G,{className:`h-12 w-full`})]}):(d.data?.usage??[]).length===0?(0,I.jsx)(_s,{icon:Qe,title:`No usage data`,description:`No telemetry snapshots available.`}):(0,I.jsxs)(`div`,{className:`space-y-6`,children:[(0,I.jsxs)(Ys,{children:[(0,I.jsx)(Zs,{title:`CPU p95`,value:h.get(`node.cpu_active.p95`)?.value??``,subtitle:`Last snapshot`,icon:(0,I.jsx)(st,{className:`h-4 w-4`})}),(0,I.jsx)(Zs,{title:`Mem p95`,value:h.get(`node.mem_used.p95`)?.value??``,subtitle:`Last snapshot`,icon:(0,I.jsx)(an,{className:`h-4 w-4`})}),(0,I.jsx)(Zs,{title:`Disk p95`,value:h.get(`node.disk_used.p95`)?.value??``,subtitle:`Last snapshot`,icon:(0,I.jsx)(b,{className:`h-4 w-4`})}),(0,I.jsx)(Zs,{title:`Active users (24h)`,value:h.get(`users.active_24h`)?.value??``,subtitle:`Distinct users`,icon:(0,I.jsx)(At,{className:`h-4 w-4`})}),(0,I.jsx)(Zs,{title:`Active deployments`,value:h.get(`deployments.active`)?.value??``,subtitle:`Last snapshot`,icon:(0,I.jsx)(st,{className:`h-4 w-4`}),gradient:`green`}),(0,I.jsx)(Zs,{title:`Queued tasks`,value:h.get(`tasks.queued`)?.value??``,subtitle:`Oldest: ${ul(h.get(`tasks.oldest_queued_age_seconds`)?.value)}`,icon:(0,I.jsx)(A,{className:`h-4 w-4`}),gradient:`orange`}),(0,I.jsx)(Zs,{title:`Pods`,value:h.get(`k8s.pods.total`)?.value??``,subtitle:`Pending: ${h.get(`k8s.pods.pending`)?.value??``}`,icon:(0,I.jsx)(se,{className:`h-4 w-4`}),gradient:`purple`}),(0,I.jsx)(Zs,{title:`Lab pods`,value:h.get(`k8s.pods.ws.total`)?.value??``,subtitle:`Pending: ${h.get(`k8s.pods.ws.pending`)?.value??``}`,icon:(0,I.jsx)(se,{className:`h-4 w-4`}),gradient:`purple`}),(0,I.jsx)(Zs,{title:`Lab namespaces`,value:h.get(`k8s.namespaces.ws`)?.value??``,subtitle:`All namespaces: ${h.get(`k8s.namespaces.total`)?.value??``}`,icon:(0,I.jsx)(se,{className:`h-4 w-4`}),gradient:`purple`})]}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{className:`text-base`,children:`Top Users`}),(0,I.jsx)(H,{children:`Latest per-user activity snapshots (sorted by active deployments).`})]}),(0,I.jsx)(U,{children:g.length===0?(0,I.jsx)(_s,{icon:Qe,title:`No user activity`,description:`No per-user snapshots available yet.`}):(0,I.jsx)(gs,{columns:[{id:`user`,header:`User`,width:240,cell:e=>(0,I.jsx)(`span`,{className:`font-medium`,children:e.user})},{id:`deploymentsActive`,header:`Active Deployments`,width:180,cell:e=>e.deploymentsActive},{id:`tasksRunning`,header:`Running Tasks`,width:160,cell:e=>e.tasksRunning},{id:`collectorsTotal`,header:`Collectors`,width:140,cell:e=>e.collectorsTotal},{id:`deploymentsTotal`,header:`Total Deployments`,width:170,cell:e=>e.deploymentsTotal},{id:`lastSeenAt`,header:`Last Updated`,align:`right`,width:220,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:e.lastSeenAt})}],rows:g.slice(0,50),getRowId:e=>e.user,maxHeightClassName:`max-h-[45vh]`,minWidthClassName:`min-w-[1000px]`})})]}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{className:`text-base`,children:`Raw Snapshots`}),(0,I.jsx)(H,{children:`Most recent usage snapshot records (for debugging).`})]}),(0,I.jsx)(U,{children:(0,I.jsx)(gs,{columns:[{id:`ownerScope`,header:`User`,width:180,cell:e=>e.userType===`user`?`user:${e.ownerUsername??``}`:e.userType},{id:`metric`,header:`Metric`,cell:e=>e.metric},{id:`value`,header:`Value`,width:160,cell:e=>typeof e.value==`number`?e.value:String(e.value)},{id:`collectedAt`,header:`Collected At`,width:220,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:e.collectedAt})}],rows:p.slice(0,200),getRowId:e=>`${e.provider}:${e.userType}:${e.ownerUsername??``}:${e.metric}:${e.collectedAt}`,maxHeightClassName:`max-h-[50vh]`,minWidthClassName:`min-w-[900px]`})})]})]})})]})})]})]})}function ml(e){let t=o(),n=(0,P.useMemo)(()=>`${pr}/dashboard/events`,[]);(0,P.useEffect)(()=>{if(!e)return;let r=ls(n,{snapshot:e=>{try{let n=JSON.parse(e.data);t.setQueryData(W.dashboardSnapshot(),n)}catch{}}});return()=>{r.close()}},[e,t,n])}const hl=t(`/dashboard/runs/`)({component:gl});function gl(){ml(!0);let e=o(),t=f({queryKey:W.dashboardSnapshot(),queryFn:yr,initialData:()=>e.getQueryData(W.dashboardSnapshot())??null,retry:!1,staleTime:1/0}),n=t.data?.runs??[],[r,i]=(0,P.useState)(``),a=(0,P.useMemo)(()=>{let e=r.trim().toLowerCase();return e?n.filter(t=>JSON.stringify(t).toLowerCase().includes(e)):n},[r,n]);return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Runs`}),(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground`,children:`Recent task runs across all deployments.`})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(J,{placeholder:`Filter runs`,value:r,onChange:e=>i(e.target.value)}),(0,I.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[a.length,` shown`]})]}),t.data?a.length===0?(0,I.jsx)(z,{className:`border-dashed`,children:(0,I.jsx)(U,{className:`pt-6 text-sm text-muted-foreground`,children:`No runs match your filter.`})}):(0,I.jsx)(`div`,{className:`space-y-3`,children:a.map(e=>{let t=String(e.id??``),n=String(e.status??``),r=String(e.tpl_alias??e.type??``),i=String(e.created??``),a=String(e.start??``),o=String(e.end??``);return(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(V,{className:`truncate`,children:(0,I.jsxs)(m,{className:`underline`,to:`/dashboard/runs/$runId`,params:{runId:t},children:[`Run `,t]})}),(0,I.jsx)(H,{className:`truncate`,children:r||`run`})]}),(0,I.jsx)(K,{variant:_l(n),children:n||`unknown`})]})}),(0,I.jsxs)(U,{className:`grid gap-2 text-sm text-muted-foreground md:grid-cols-3`,children:[(0,I.jsxs)(`div`,{className:`truncate`,children:[`Created: `,i||``]}),(0,I.jsxs)(`div`,{className:`truncate`,children:[`Started: `,a||``]}),(0,I.jsxs)(`div`,{className:`truncate`,children:[`Finished: `,o||``]})]})]},t)})}):(0,I.jsx)(z,{className:`border-dashed`,children:(0,I.jsx)(U,{className:`pt-6 text-sm text-muted-foreground`,children:`Loading dashboard`})})]})}function _l(e){let t=e.toLowerCase();return t===`success`||t===`succeeded`||t===`complete`?`default`:t===`failed`||t===`error`?`destructive`:t===`running`?`default`:`secondary`}const vl=t(`/dashboard/fwd/`)({component:yl});function yl(){let e=o(),t=f({queryKey:W.userForwardNetworks(),queryFn:()=>lo(),enabled:!0,staleTime:1e4,retry:!1}),n=(0,P.useMemo)(()=>t.data?.networks??[],[t.data?.networks]),r=f({queryKey:W.userForwardCollectorConfigs(),queryFn:_a,staleTime:3e4,retry:!1}),a=(0,P.useMemo)(()=>r.data?.collectors??[],[r.data?.collectors]),s=f({queryKey:[`forwardNetworksAvailable`],queryFn:()=>qr(),staleTime:3e4,retry:!1}),c=(0,P.useMemo)(()=>s.data?.networks??[],[s.data?.networks]),l=f({queryKey:W.forwardConfig(),queryFn:()=>Ea(),enabled:!0,staleTime:1e4,retry:!1}),u=f({queryKey:W.userForwardCredentialSets(),queryFn:Sa,staleTime:3e4,retry:!1}),d=(0,P.useMemo)(()=>u.data?.credentialSets??[],[u.data?.credentialSets]),[p,h]=(0,P.useState)(``),[g,_]=(0,P.useState)(``),[y,b]=(0,P.useState)(``),[x,ee]=(0,P.useState)(`__default__`),[S,C]=(0,P.useState)(``),w=(0,P.useMemo)(()=>{let e=g.trim();return e?c.some(t=>String(t.id??``).trim()===e)?e:`__custom__`:`__none__`},[g,c]),te=i({mutationFn:async()=>{let e=p.trim(),t=g.trim();if(!e)throw Error(`Name is required`);if(!t)throw Error(`Forward Network ID is required`);return co({name:e,forwardNetworkId:t,description:y.trim()||void 0,collectorConfigId:x&&x!==`__default__`?x:void 0})},onSuccess:async()=>{O.success(`Forward network saved`),h(``),_(``),b(``),ee(`__default__`),await e.invalidateQueries({queryKey:W.userForwardNetworks()})},onError:e=>O.error(`Failed to save network`,{description:e.message})}),T=i({mutationFn:async e=>uo(e),onSuccess:async()=>{O.success(`Forward network deleted`),await e.invalidateQueries({queryKey:W.userForwardNetworks()})},onError:e=>O.error(`Failed to delete network`,{description:e.message})});(0,P.useEffect)(()=>{S||d.length!==0&&C(String(d[0]?.id??``))},[S,d]);let E=i({mutationFn:async()=>{let e=S.trim();if(!e)throw Error(`Select a credential set`);return Da(e)},onSuccess:async()=>{O.success(`Forward credentials applied`),await e.invalidateQueries({queryKey:W.forwardConfig()})},onError:e=>O.error(`Failed to apply credential set`,{description:e.message})}),D=i({mutationFn:async()=>Oa(),onSuccess:async()=>{O.success(`Forward credentials cleared`),await e.invalidateQueries({queryKey:W.forwardConfig()})},onError:e=>O.error(`Failed to clear credentials`,{description:e.message})});return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(`div`,{className:`flex flex-col gap-4 border-b pb-6`,children:(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Forward Networks`}),(0,I.jsx)(`p`,{className:`text-muted-foreground text-sm`,children:`Manage Forward credentials, save Forward network IDs, and launch the Assurance Hub for routing, capacity, and security checks.`})]})}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Forward credentials`}),(0,I.jsx)(H,{children:`Apply a credential set used to query Forward data for Assurance Studio and NQE execution.`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Forward status`}),(0,I.jsx)(`div`,{className:`mt-1 text-sm text-muted-foreground`,children:l.isLoading?`Loading`:l.isError?`Failed to load Forward config`:l.data?.configured?`Configured for ${l.data?.username??``}`:`Not configured`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Apply credential set`}),(0,I.jsxs)(Y,{value:S||`__none__`,onValueChange:e=>C(e===`__none__`?``:e),children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select a credential set`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`__none__`,children:`(Select)`}),d.map(e=>(0,I.jsxs)($,{value:e.id,children:[e.name,e.username?` (${e.username})`:``]},e.id))]})]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Manage credential sets in`,` `,(0,I.jsx)(m,{className:`underline`,to:`/dashboard/settings`,hash:`forward-account`,children:`Settings`}),`.`]}),u.isError?(0,I.jsxs)(`div`,{className:`text-xs text-destructive`,children:[`Failed to load credential sets:`,` `,u.error.message]}):null]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(R,{onClick:()=>E.mutate(),disabled:E.isPending||!S.trim(),children:E.isPending?`Applying`:`Apply`}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>D.mutate(),disabled:D.isPending,children:D.isPending?`Clearing`:`Clear`})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Add Forward network`}),(0,I.jsx)(H,{children:`Save a Forward network ID, associate it with credentials, then open Assurance Hub to run preset checks.`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Name`}),(0,I.jsx)(J,{value:p,onChange:e=>h(e.target.value),placeholder:`prod-edge`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Forward Network ID`}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(Y,{value:w,onValueChange:e=>{if(e===`__none__`){_(``);return}e!==`__custom__`&&_(e)},children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select a network`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`__none__`,children:`(Select)`}),c.map(e=>(0,I.jsx)($,{value:String(e.id),children:e.name?`${String(e.name)} (${String(e.id)})`:String(e.id)},String(e.id))),(0,I.jsx)($,{value:`__custom__`,children:`Custom network id`})]})]}),(0,I.jsx)(R,{type:`button`,variant:`outline`,size:`sm`,onClick:()=>void s.refetch(),disabled:s.isFetching,children:s.isFetching?`Refreshing`:`Refresh`})]}),w===`__custom__`?(0,I.jsx)(J,{value:g,onChange:e=>_(e.target.value),placeholder:`abc123...`}):null,s.isError?(0,I.jsxs)(`div`,{className:`text-xs text-destructive`,children:[`Failed to load Forward networks:`,` `,s.error.message]}):null]})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Description (optional)`}),(0,I.jsx)(J,{value:y,onChange:e=>b(e.target.value),placeholder:`Notes for humans`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Forward collector config (optional)`}),(0,I.jsxs)(Y,{value:x,onValueChange:e=>ee(e),children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Use my default Forward config`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`__default__`,children:`Use my default`}),a.map(e=>(0,I.jsx)($,{value:String(e.id),children:String(e.name??e.id)},String(e.id)))]})]})]}),(0,I.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,I.jsxs)(R,{onClick:()=>te.mutate(),disabled:te.isPending,children:[(0,I.jsx)(v,{className:`h-4 w-4 mr-2`}),`Save network`]})})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Forward networks`}),(0,I.jsx)(H,{children:`These networks are saved for your account in Assurance Hub.`})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[n.length===0?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No saved networks yet.`}):null,n.map(e=>(0,I.jsxs)(`div`,{className:`flex flex-col md:flex-row md:items-center md:justify-between gap-3 rounded-lg border p-3`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-medium truncate`,children:e.name}),(0,I.jsxs)(`div`,{className:`text-sm text-muted-foreground truncate`,children:[(0,I.jsx)(`span`,{className:`font-mono`,children:e.forwardNetworkId}),e.description?`  ${e.description}`:``]})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(R,{asChild:!0,variant:`outline`,size:`sm`,children:(0,I.jsx)(m,{to:`/dashboard/fwd/$networkRef/hub`,params:{networkRef:e.id},children:`Open Hub`})}),(0,I.jsx)(R,{asChild:!0,variant:`ghost`,size:`sm`,children:(0,I.jsx)(m,{to:`/dashboard/fwd/$networkRef/assurance-studio`,params:{networkRef:e.id},children:`Advanced`})})]}),(0,I.jsxs)(R,{variant:`outline`,size:`sm`,onClick:()=>T.mutate(e.id),disabled:T.isPending,children:[(0,I.jsx)(Ln,{className:`h-4 w-4 mr-2`}),`Delete`]})]})]},e.id))]})]})]})}var bl=[{slug:`getting-started`,title:`Getting started`,description:`First-time flow: configure settings, select templates, deploy.`,tags:[`start`,`deployments`,`settings`]},{slug:`my-settings`,title:`My Settings`,description:`Per-user defaults, external repos, BYOL servers, credentials.`,tags:[`settings`,`repos`,`byol`,`cloud`]},{slug:`deployments`,title:`Deployments`,description:`Create deployments, validate templates, and understand statuses.`,tags:[`deployments`,`templates`,`validate`]},{slug:`servicenow`,title:`ServiceNow demo workflow`,description:`Install and configure the Forward Connectivity Ticket demo into a ServiceNow PDI.`,tags:[`servicenow`,`forward`,`workflow`]}];const xl=t(`/dashboard/docs/`)({component:Sl});function Sl(){let[e,t]=(0,P.useState)(``),n=(0,P.useMemo)(()=>{let t=e.trim().toLowerCase();return t?bl.filter(e=>`${e.title} ${e.description} ${e.tags.join(` `)}`.toLowerCase().includes(t)):bl},[e]);return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsx)(B,{children:(0,I.jsxs)(V,{className:`flex items-center gap-2`,children:[(0,I.jsx)(cn,{className:`h-5 w-5`}),`Docs & Workflows`]})}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Practical guides for first-time users and repeatable workflows.`}),(0,I.jsx)(J,{placeholder:`Search docs`,value:e,onChange:e=>t(e.target.value)})]})]}),(0,I.jsx)(`div`,{className:`grid gap-4 md:grid-cols-2`,children:n.map(e=>(0,I.jsx)(m,{to:`/dashboard/docs/$slug`,params:{slug:e.slug},className:`group`,children:(0,I.jsxs)(z,{className:`h-full transition-colors hover:bg-accent/40`,children:[(0,I.jsx)(B,{children:(0,I.jsxs)(V,{className:`flex items-center justify-between gap-2 text-base`,children:[(0,I.jsx)(`span`,{className:`truncate`,children:e.title}),(0,I.jsx)(S,{className:`h-4 w-4 text-muted-foreground group-hover:text-foreground`})]})}),(0,I.jsxs)(U,{className:`space-y-2`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:e.description}),(0,I.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:e.tags.slice(0,4).map(e=>(0,I.jsx)(`span`,{className:`rounded border px-2 py-0.5 text-[10px] text-muted-foreground`,children:e},e))})]})]})},e.slug))})]})}const Cl=t(`/dashboard/deployments/`)({component:wl});function wl(){ml(!0);let e=c(),t=o(),n=f({queryKey:W.dashboardSnapshot(),queryFn:yr,initialData:()=>t.getQueryData(W.dashboardSnapshot())??null,retry:!1,staleTime:1/0}),[r,i]=(0,P.useState)(null),[a,s]=(0,P.useState)(!1),[l,u]=(0,P.useState)(!1);f({queryKey:W.session(),queryFn:_r,staleTime:3e4,retry:!1});let[d,p]=(0,P.useState)(``),[h,g]=(0,P.useState)(`all`),[_,y]=(0,P.useState)(`all`),[b,x]=(0,P.useState)(!0),ee=(0,P.useMemo)(()=>n.data?.deployments??[],[n.data?.deployments]),C=(0,P.useMemo)(()=>ee.filter(e=>{if(d&&!e.name.toLowerCase().includes(d.toLowerCase()))return!1;if(h!==`all`){let t=(e.activeTaskStatus??e.lastStatus??`unknown`).toLowerCase();if(h===`running`&&![`running`,`active`,`healthy`].includes(t)||h===`stopped`&&![`created`,`stopped`,`success`,`succeeded`,`ready`].includes(t)||h===`failed`&&![`failed`,`error`,`crashloopbackoff`].includes(t))return!1}return!(_!==`all`&&(_===`netlab`&&!e.type.startsWith(`netlab`)||_===`containerlab`&&![`containerlab`,`clabernetes`].includes(e.type)||_===`terraform`&&e.type!==`terraform`))}),[ee,d,h,_]),w=async e=>{try{await Qa(e.id),O.success(`Deployment starting`,{description:`${e.name} is queued to start.`})}catch(e){O.error(`Failed to start`,{description:e.message})}},te=async e=>{try{await $a(e.id),O.success(`Deployment stopping`,{description:`${e.name} is queued to stop.`})}catch(e){O.error(`Failed to stop`,{description:e.message})}},T=(0,P.useMemo)(()=>[{id:`name`,header:`Name`,width:`minmax(240px, 1fr)`,cell:e=>(0,I.jsx)(m,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e.id},className:`hover:underline flex items-center gap-2 font-medium text-foreground`,children:e.name})},{id:`type`,header:`Type`,width:160,cell:e=>(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:k(e.type)})},{id:`status`,header:`Status`,width:150,cell:e=>(0,I.jsx)(Tl,{status:e.activeTaskStatus??e.lastStatus??`unknown`})},{id:`actions`,header:`Actions`,width:120,align:`right`,cell:t=>{let n=(t.activeTaskStatus??t.lastStatus??`unknown`).toLowerCase(),r=[`running`,`active`,`healthy`].includes(n),a=!!t.activeTaskId;return(0,I.jsxs)(Co,{children:[(0,I.jsx)(wo,{asChild:!0,children:(0,I.jsxs)(R,{variant:`ghost`,size:`icon`,className:`h-8 w-8`,children:[(0,I.jsx)(D,{className:`h-4 w-4`}),(0,I.jsx)(`span`,{className:`sr-only`,children:`Open menu`})]})}),(0,I.jsxs)(Do,{align:`end`,children:[(0,I.jsx)(jo,{children:`Actions`}),(0,I.jsxs)(Oo,{onClick:()=>e({to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:t.id}}),children:[(0,I.jsx)(Nt,{className:`mr-2 h-4 w-4`}),`Details`]}),(0,I.jsx)(Mo,{}),(0,I.jsxs)(Oo,{onClick:()=>w(t),disabled:a||r,children:[(0,I.jsx)(wt,{className:`mr-2 h-4 w-4`}),`Start`]}),(0,I.jsxs)(Oo,{onClick:()=>te(t),disabled:a||!r,children:[(0,I.jsx)(xe,{className:`mr-2 h-4 w-4`}),`Stop`]}),(0,I.jsx)(Mo,{}),(0,I.jsxs)(Oo,{onClick:()=>{i(t),s(!0)},className:`text-destructive focus:text-destructive`,disabled:a,children:[(0,I.jsx)(Ln,{className:`mr-2 h-4 w-4`}),`Delete`]})]})]})}}],[w,te,e]),E=(0,P.useMemo)(()=>n.data?.runs??[],[n.data?.runs]),ne=mr(window.location.pathname+window.location.search),re=async()=>{if(r)try{await eo(r.id,{forwardDelete:l}),O.success(`Deployment deleted`,{description:`${r.name} has been removed.`}),await t.invalidateQueries({queryKey:W.dashboardSnapshot()}),s(!1),i(null),u(!1)}catch(e){O.error(`Failed to delete`,{description:e.message})}},k=e=>{switch(e){case`netlab`:return`Netlab (BYOS)`;case`netlab-c9s`:return`Netlab`;case`containerlab`:return`Containerlab (BYOS)`;case`clabernetes`:return`Containerlab`;default:return e}},ie=!!r?.config?.forwardNetworkId;return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between border-b pb-6`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Deployments`}),(0,I.jsx)(`p`,{className:`text-muted-foreground text-sm`,children:`Manage deployments and monitor personal activity.`})]}),(0,I.jsx)(`div`,{className:`flex items-center gap-3`,children:(0,I.jsx)(K,{variant:`secondary`,children:`Access: Personal`})})]}),!n.data&&(0,I.jsx)(z,{className:`border-dashed`,children:(0,I.jsx)(U,{className:`pt-6`,children:(0,I.jsxs)(`div`,{className:`flex flex-col items-center justify-center space-y-4 py-8`,children:[(0,I.jsx)(G,{className:`h-4 w-64`}),(0,I.jsxs)(`div`,{className:`text-center text-muted-foreground`,children:[`Loading dashboard`,(0,I.jsxs)(`div`,{className:`mt-2 text-xs`,children:[`If you are logged out,`,` `,(0,I.jsx)(`a`,{className:`text-primary underline hover:no-underline`,href:ne,onClick:e=>{e.preventDefault(),(async()=>{if(!await rs({loginHref:ne})){window.location.href=ne;return}await t.invalidateQueries({queryKey:W.session()})})()},children:`login`}),`.`]})]})]})})}),(0,I.jsxs)(`div`,{className:`flex flex-col lg:flex-row gap-6 relative items-start`,children:[(0,I.jsxs)(`div`,{className:`flex-1 min-w-0 space-y-4 w-full`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col sm:flex-row gap-3`,children:[(0,I.jsxs)(`div`,{className:`relative flex-1`,children:[(0,I.jsx)(ln,{className:`absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground`}),(0,I.jsx)(J,{placeholder:`Search deployments...`,className:`pl-9`,value:d,onChange:e=>p(e.target.value)})]}),(0,I.jsxs)(Y,{value:h,onValueChange:g,children:[(0,I.jsxs)(Z,{className:`w-[140px]`,children:[(0,I.jsx)(gt,{className:`mr-2 h-4 w-4 text-muted-foreground`}),(0,I.jsx)(X,{placeholder:`Status`})]}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All Status`}),(0,I.jsx)($,{value:`running`,children:`Running`}),(0,I.jsx)($,{value:`stopped`,children:`Stopped`}),(0,I.jsx)($,{value:`failed`,children:`Failed`})]})]}),(0,I.jsxs)(Y,{value:_,onValueChange:y,children:[(0,I.jsxs)(Z,{className:`w-[140px]`,children:[(0,I.jsx)(ve,{className:`mr-2 h-4 w-4 text-muted-foreground`}),(0,I.jsx)(X,{placeholder:`Type`})]}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All Types`}),(0,I.jsx)($,{value:`netlab`,children:`Netlab`}),(0,I.jsx)($,{value:`containerlab`,children:`Containerlab`}),(0,I.jsx)($,{value:`terraform`,children:`Terraform`})]})]}),(0,I.jsxs)(m,{to:`/dashboard/deployments/new`,className:So({variant:`default`}),children:[(0,I.jsx)(v,{className:`mr-2 h-4 w-4`}),` Create`]})]}),(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`p-0`,children:n.data?C.length===0?(0,I.jsx)(_s,{icon:At,title:`No deployments found`,description:d||h!==`all`?`Try adjusting your filters.`:`You haven't created any deployments yet.`,action:!d&&h===`all`?{label:`Create deployment`,onClick:()=>e({to:`/dashboard/deployments/new`})}:void 0}):(0,I.jsx)(gs,{columns:T,rows:C,getRowId:e=>e.id,minWidthClassName:`min-w-0`,scrollable:!1}):(0,I.jsxs)(`div`,{className:`p-6 space-y-4`,children:[(0,I.jsx)(G,{className:`h-10 w-full`}),(0,I.jsx)(G,{className:`h-10 w-full`}),(0,I.jsx)(G,{className:`h-10 w-full`})]})})})]}),(0,I.jsxs)(`div`,{className:F(`transition-all duration-300 ease-in-out border-l space-y-4 shrink-0`,b?`w-full lg:w-80 xl:w-96 pl-6 opacity-100`:`w-0 lg:w-12 pl-0 opacity-100 border-none lg:border-l`),children:[(0,I.jsx)(`div`,{className:F(`flex items-center gap-2 h-[40px]`,!b&&`justify-center`),children:b?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(st,{className:`h-4 w-4 text-muted-foreground`}),(0,I.jsx)(`h3`,{className:`flex-1 text-sm font-semibold text-muted-foreground uppercase tracking-wider`,children:`Activity Feed`}),(0,I.jsx)(R,{variant:`ghost`,size:`icon`,className:`h-6 w-6 text-muted-foreground hover:text-foreground`,onClick:()=>x(!1),title:`Collapse feed`,children:(0,I.jsx)(S,{className:`h-4 w-4`})})]}):(0,I.jsx)(R,{variant:`ghost`,size:`icon`,className:`h-8 w-8 text-muted-foreground hover:text-foreground`,onClick:()=>x(!0),title:`Expand activity feed`,children:(0,I.jsx)(Ye,{className:`h-4 w-4`})})}),(0,I.jsx)(`div`,{className:F(`space-y-3`,!b&&`hidden`),children:n.data?E.length===0?(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`p-6 text-center text-sm text-muted-foreground`,children:`No recent activity.`})}):(0,I.jsx)(`div`,{className:`space-y-3`,children:E.slice(0,15).map(e=>([`success`,`failed`,`canceled`,`error`].includes(String(e.status??``).toLowerCase()),(0,I.jsx)(m,{to:`/dashboard/runs/$runId`,params:{runId:String(e.id??``)},className:`block group`,children:(0,I.jsx)(z,{className:`hover:border-primary/50 transition-colors`,children:(0,I.jsxs)(U,{className:`p-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-start justify-between gap-2`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col gap-1 min-w-0`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(`span`,{className:`font-mono text-xs font-medium text-foreground`,children:[`#`,String(e.id??``)]}),(0,I.jsx)(`span`,{className:`text-xs text-muted-foreground truncate max-w-[120px]`,children:String(e.tpl_alias??e.type??`Run`)})]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground truncate`,children:String(e.message||`No message`)})]}),(0,I.jsx)(Tl,{status:String(e.status??``),size:`xs`})]}),(0,I.jsxs)(`div`,{className:`mt-2 flex items-center justify-between text-[10px] text-muted-foreground`,children:[(0,I.jsx)(`span`,{children:String(e.user_name??`system`)}),(0,I.jsx)(`span`,{children:new Date(String(e.created)).toLocaleString(void 0,{month:`short`,day:`numeric`,hour:`numeric`,minute:`numeric`})})]})]})})},String(e.id??Math.random()))))}):(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsx)(G,{className:`h-20 w-full`}),(0,I.jsx)(G,{className:`h-20 w-full`})]})})]})]}),(0,I.jsx)(Ns,{open:a,onOpenChange:s,children:(0,I.jsxs)(Is,{children:[(0,I.jsxs)(Ls,{children:[(0,I.jsx)(zs,{children:`Delete deployment?`}),(0,I.jsxs)(Bs,{children:[`This will remove "`,r?.name,`" from Skyforge and trigger provider cleanup. This action cannot be undone.`]})]}),ie&&(0,I.jsxs)(`div`,{className:`flex items-start gap-3 rounded-md border p-3`,children:[(0,I.jsx)(Us,{checked:l,onCheckedChange:e=>u(!!e),id:`delete-forward-network`}),(0,I.jsx)(`label`,{htmlFor:`delete-forward-network`,className:`text-sm leading-tight cursor-pointer`,children:`Also delete the Forward network associated with this deployment.`})]}),(0,I.jsxs)(Rs,{children:[(0,I.jsx)(Hs,{children:`Cancel`}),(0,I.jsx)(Vs,{onClick:re,className:So({variant:`destructive`}),children:`Delete`})]})]})})]})}function Tl({status:e,size:t=`default`}){let n=`secondary`,r=e.toLowerCase(),i=r===`success`||r===`succeeded`?`ready`:r===`crashloopbackoff`?`crashloop`:e;return[`running`,`active`,`healthy`].includes(r)&&(n=`default`),[`failed`,`error`,`crashloopbackoff`].includes(r)&&(n=`destructive`),(0,I.jsx)(K,{variant:n,className:`capitalize ${t===`xs`?`px-1.5 py-0 text-[10px] h-5`:``}`,children:i})}function El(e,t){let n=o(),r=(0,P.useMemo)(()=>`${pr}/runs/${encodeURIComponent(e)}/events`,[e]);(0,P.useEffect)(()=>{if(!t||!e)return;let i=ls(r,{output:t=>{try{console.log(`Run event:`,t.data);let r=JSON.parse(t.data);if(!r||!Array.isArray(r.entries))return;n.setQueryData(W.runLogs(e),e=>{let t=(e?.entries??[]).concat(r.entries);return{cursor:Number(r.cursor??e?.cursor??0),entries:t}})}catch{}}});return()=>{i.close()}},[t,n,e,r])}const Dl=t(`/dashboard/runs/$runId`)({component:Ol});function Ol(){let{runId:e}=Dl.useParams();El(e,!0);let t=o(),n=c(),r=f({queryKey:W.dashboardSnapshot(),queryFn:yr,initialData:()=>t.getQueryData(W.dashboardSnapshot())??null,retry:!1,staleTime:1/0}),i=(r.data?.runs??[]).find(t=>String(t.id??``)===e),a=String(i?.status??``).toLowerCase(),s=a===`queued`||a===`running`,l=f({queryKey:W.runLogs(e),queryFn:async()=>({cursor:0,entries:[]}),retry:!1,staleTime:1/0}),u=mr(window.location.pathname+window.location.search);return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsx)(`div`,{children:(0,I.jsxs)(V,{children:[`Run `,e]})}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(m,{className:So({variant:`outline`,size:`sm`}),to:`/dashboard/deployments`,children:`Back`}),(0,I.jsx)(R,{variant:`destructive`,size:`sm`,disabled:!i||!s,onClick:()=>{i&&(async()=>{try{await ro(e),O.success(`Run canceled`),await t.invalidateQueries({queryKey:W.dashboardSnapshot()}),n({to:`/dashboard/deployments`})}catch(e){O.error(`Cancel failed`,{description:e.message})}})()},children:`Cancel`}),(0,I.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>t.setQueryData(W.runLogs(e),{cursor:0,entries:[]}),children:`Clear`})]})]})})}),!r.data&&(0,I.jsx)(z,{className:`border-dashed`,children:(0,I.jsxs)(U,{className:`pt-6 text-center text-muted-foreground`,children:[`Loading dashboard`,(0,I.jsxs)(`div`,{className:`mt-2 text-xs`,children:[`If you are logged out,`,` `,(0,I.jsx)(`a`,{className:`text-primary underline hover:no-underline`,href:u,onClick:e=>{e.preventDefault(),(async()=>{if(!await rs({loginHref:u})){window.location.href=u;return}await t.invalidateQueries({queryKey:W.session()})})()},children:`login`}),`.`]})]})}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(V,{children:`Metadata`}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Cursor: `,String(l.data?.cursor??0)]})]})}),(0,I.jsx)(U,{children:(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-4 md:grid-cols-3`,children:[(0,I.jsx)(kl,{label:`Type`,value:String(i?.tpl_alias??``)}),(0,I.jsx)(kl,{label:`Status`,value:String(i?.status??``)}),(0,I.jsx)(kl,{label:`Created`,value:String(i?.created??``)}),(0,I.jsx)(kl,{label:`Started`,value:String(i?.start??``)}),(0,I.jsx)(kl,{label:`Finished`,value:String(i?.end??``)})]})})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Output`})}),(0,I.jsx)(U,{children:(0,I.jsx)(`div`,{className:`rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100`,children:(0,I.jsx)(Al,{entries:l.data?.entries??[]})})})]})]})}function kl(e){return(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-[11px] uppercase tracking-wide text-muted-foreground`,children:e.label}),(0,I.jsx)(`div`,{className:`break-all font-medium text-sm`,children:e.value||``})]})}function Al(e){let t=(0,P.useRef)(null);return(0,P.useEffect)(()=>{let e=t.current;e&&(e.scrollTop=e.scrollHeight)},[e.entries.length]),e.entries.length===0?(0,I.jsx)(`div`,{className:`text-zinc-500`,children:`Waiting for output`}):(0,I.jsx)(`div`,{ref:t,className:`max-h-[65vh] overflow-auto whitespace-pre-wrap`,children:e.entries.map((e,t)=>(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`span`,{className:`text-zinc-500 select-none`,children:e.time?`${e.time} `:``}),(0,I.jsx)(`span`,{children:e.output})]},`${e.time}-${t}`))})}function jl({deploymentId:e,nodeId:t,nodeKind:n,nodeIp:r,onClose:i,className:a}){let o=(0,P.useMemo)(()=>{let e=[t];return n&&e.push(String(n)),e.join(`  `)},[t,n]),s=f({queryKey:[`deploymentNodeDescribe`,e,t],enabled:!!e&&!!t,queryFn:async()=>$i(e,t),refetchOnWindowFocus:!1,retry:1});return(0,I.jsxs)(`div`,{className:`flex flex-col h-full w-full ${a??``}`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2 p-2 border-b bg-muted/40 text-xs`,children:[(0,I.jsxs)(`div`,{className:`truncate flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`font-mono font-medium`,children:o}),r?(0,I.jsx)(`span`,{className:`font-mono text-muted-foreground`,children:r}):null]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(R,{variant:`outline`,size:`sm`,className:`h-7`,onClick:()=>s.refetch(),disabled:s.isFetching,children:[(0,I.jsx)(nt,{className:s.isFetching?`mr-2 h-3 w-3 animate-spin`:`mr-2 h-3 w-3`}),`Refresh`]}),i?(0,I.jsx)(R,{variant:`ghost`,size:`sm`,className:`h-7`,onClick:i,children:`Close`}):null]})]}),(0,I.jsx)(`div`,{className:`flex-1 overflow-auto bg-muted/10 p-4`,children:(0,I.jsx)(`pre`,{className:`text-xs font-mono whitespace-pre-wrap`,children:s.isLoading?`Loading`:s.isError?`Failed to load node status: ${String(s.error)}`:JSON.stringify(s.data??{},null,2)})})]})}function Ml({open:e,onOpenChange:t,deploymentId:n,nodeId:r,nodeKind:i,nodeIp:a}){return(0,I.jsx)(Xn,{open:e,onOpenChange:t,children:(0,I.jsxs)($n,{className:`max-w-5xl h-[70vh] flex flex-col p-0 gap-0 overflow-hidden`,children:[(0,I.jsx)(er,{className:`px-6 py-4 border-b`,children:(0,I.jsxs)(nr,{className:`flex items-center gap-2`,children:[(0,I.jsx)(C,{className:`h-4 w-4`}),`Node status`]})}),(0,I.jsx)(`div`,{className:`flex-1 min-h-0`,children:e?(0,I.jsx)(jl,{deploymentId:n,nodeId:r,nodeKind:i,nodeIp:a,onClose:()=>t(!1)}):null})]})})}function Nl({deploymentId:e,nodeId:t,nodeKind:n,nodeIp:r,onClose:i,className:a}){let o=(0,P.useMemo)(()=>{let e=[t];return n&&e.push(String(n)),e.join(`  `)},[t,n]),s=f({queryKey:[`deploymentNodeLogs`,e,t,400],enabled:!!e&&!!t,queryFn:async()=>Qi(e,t,{tail:400,container:t}),refetchOnWindowFocus:!1,retry:1});return(0,I.jsxs)(`div`,{className:`flex flex-col h-full w-full ${a??``}`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2 p-2 border-b bg-muted/40 text-xs`,children:[(0,I.jsxs)(`div`,{className:`truncate flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`font-mono font-medium`,children:o}),r?(0,I.jsx)(`span`,{className:`font-mono text-muted-foreground`,children:r}):null,s.data?.namespace&&s.data?.podName?(0,I.jsxs)(`span`,{className:`text-muted-foreground`,children:[s.data.namespace,`/`,s.data.podName]}):null]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(R,{variant:`outline`,size:`sm`,className:`h-7`,onClick:()=>s.refetch(),disabled:s.isFetching,children:[(0,I.jsx)(nt,{className:s.isFetching?`mr-2 h-3 w-3 animate-spin`:`mr-2 h-3 w-3`}),`Refresh`]}),i?(0,I.jsx)(R,{variant:`ghost`,size:`sm`,className:`h-7`,onClick:i,children:`Close`}):null]})]}),(0,I.jsx)(`div`,{className:`flex-1 overflow-auto bg-muted/10 p-4`,children:(0,I.jsx)(`pre`,{className:`text-xs font-mono whitespace-pre-wrap`,children:s.isLoading?`Loading`:s.isError?`Failed to load logs: ${String(s.error)}`:s.data?.logs||``})})]})}function Pl({open:e,onOpenChange:t,deploymentId:n,nodeId:r,nodeKind:i,nodeIp:a}){return(0,I.jsx)(Xn,{open:e,onOpenChange:t,children:(0,I.jsxs)($n,{className:`max-w-5xl h-[70vh] flex flex-col p-0 gap-0 overflow-hidden`,children:[(0,I.jsx)(er,{className:`px-6 py-4 border-b`,children:(0,I.jsxs)(nr,{className:`flex items-center gap-2`,children:[(0,I.jsx)(C,{className:`h-4 w-4`}),`Node logs`]})}),(0,I.jsx)(`div`,{className:`flex-1 min-h-0`,children:e?(0,I.jsx)(Nl,{deploymentId:n,nodeId:r,nodeKind:i,nodeIp:a,onClose:()=>t(!1)}):null})]})})}var Fl=Un(),Il=Kn();function Ll({deploymentId:e,nodeId:t,nodeKind:n,onClose:r,className:i}){let a=(0,P.useRef)(null),o=(0,P.useRef)(null),s=(0,P.useRef)(null),c=(0,P.useRef)(null),[l,u]=(0,P.useState)(`disconnected`),d=(0,P.useMemo)(()=>`cli`,[]),f=(0,P.useMemo)(()=>{if(!e||!t)return``;let n=`${window.location.protocol===`https:`?`wss`:`ws`}://${window.location.host}/api/deployments/${encodeURIComponent(e)}/terminal/ws`,r=new URLSearchParams;return r.set(`node`,t),r.set(`command`,d),`${n}?${r.toString()}`},[d,e,t]);return(0,P.useEffect)(()=>{if(!a.current||!f)return;let e=new Il.Terminal({convertEol:!0,cursorBlink:!0,fontFamily:`ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace`,fontSize:12,theme:{background:`#09090b`}}),n=new Fl.FitAddon;e.loadAddon(n),e.open(a.current),n.fit(),e.writeln(`\x1B[1mSkyforge Terminal\x1B[0m`),e.writeln(`Node: ${t}  Command: ${d}`),e.writeln(``),o.current=e,s.current=n;let r=new WebSocket(f);c.current=r,u(`connecting`);let i=()=>{let e=o.current;if(!e)return;let t=e.cols??80,n=e.rows??24;try{r.send(JSON.stringify({type:`resize`,cols:t,rows:n}))}catch{}};r.onopen=()=>{u(`connected`),i(),e.focus()},r.onmessage=t=>{let n=null;try{n=JSON.parse(String(t.data))}catch{e.write(String(t.data));return}if(n){if(n.type===`output`){e.write(n.data??``);return}if(n.type===`info`){e.writeln(`\r\n[info] ${n.data??``}`);return}if(n.type===`error`){e.writeln(`\r\n[error] ${n.data??``}`);return}}},r.onclose=t=>{u(`closed`);let n=typeof t.code==`number`?t.code:0,r=t.reason?` ${t.reason}`:``;e.writeln(`\r\n[disconnected]${n?` (code ${n})`:``}${r}`)},r.onerror=()=>{u(`error`),e.writeln(`\r
[error] websocket error (check browser console/network)`)};let l=e.onData(e=>{try{r.send(JSON.stringify({type:`stdin`,data:e}))}catch{}}),p=()=>{n.fit(),i()};return window.addEventListener(`resize`,p),()=>{window.removeEventListener(`resize`,p),l.dispose();try{r.close()}catch{}c.current=null,e.dispose(),o.current=null,s.current=null,u(`disconnected`)}},[d,t,f]),(0,I.jsxs)(`div`,{className:`flex flex-col h-full w-full ${i??``}`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2 p-2 text-xs text-muted-foreground bg-zinc-900 border-b border-zinc-800`,children:[(0,I.jsxs)(`div`,{className:`truncate`,children:[(0,I.jsx)(`span`,{className:`font-mono text-zinc-300`,children:t}),(0,I.jsx)(`span`,{className:`mx-2 text-zinc-600`,children:`/`}),(0,I.jsx)(`span`,{children:l})]}),r?(0,I.jsx)(R,{variant:`ghost`,size:`sm`,className:`h-6 px-2 text-xs`,onClick:()=>{let e=c.current;if(e&&e.readyState===WebSocket.OPEN)try{e.close()}catch{}r()},children:`Close`}):null]}),(0,I.jsx)(`div`,{className:`flex-1 bg-zinc-950 p-2 min-h-0`,children:(0,I.jsx)(`div`,{ref:a,className:`h-full w-full`})})]})}function Rl({open:e,onOpenChange:t,deploymentId:n,nodeId:r,nodeKind:i}){let a=`${n}-${r}-${e}`;return(0,I.jsx)(Xn,{open:e,onOpenChange:t,children:(0,I.jsxs)($n,{className:`max-w-5xl h-[70vh] flex flex-col p-0 gap-0 overflow-hidden`,children:[(0,I.jsx)(er,{className:`px-6 py-4 border-b`,children:(0,I.jsxs)(nr,{className:`flex items-center gap-2`,children:[(0,I.jsx)(C,{className:`h-4 w-4`}),`Terminal`]})}),(0,I.jsx)(`div`,{className:`flex-1 min-h-0`,children:e?(0,I.jsx)(Ll,{deploymentId:n,nodeId:r,nodeKind:i,onClose:()=>t(!1)},a):null})]})})}function zl({open:e,onOpenChange:t,deploymentId:n,nodeId:r,port:i=443}){let a=`/api/deployments/${encodeURIComponent(n)}/nodes/${encodeURIComponent(r)}/webui/?port=${encodeURIComponent(String(i))}&embed=1`,o=`${n}-${r}-${i}-${e}`;return(0,I.jsx)(Xn,{open:e,onOpenChange:t,children:(0,I.jsxs)($n,{className:`max-w-6xl h-[80vh] flex flex-col p-0 gap-0 overflow-hidden`,children:[(0,I.jsx)(er,{className:`px-6 py-4 border-b`,children:(0,I.jsxs)(nr,{className:`flex items-center justify-between gap-4`,children:[(0,I.jsxs)(`span`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(pt,{className:`h-4 w-4`}),`Web UI`]}),(0,I.jsxs)(R,{size:`sm`,variant:`outline`,onClick:()=>{window.open(a,`_blank`,`noopener,noreferrer`)},children:[(0,I.jsx)(re,{className:`h-4 w-4 mr-2`}),`Open in new tab`]})]})}),(0,I.jsx)(`div`,{className:`flex-1 min-h-0 bg-background`,children:e?(0,I.jsx)(`iframe`,{title:`webui-${r}`,src:a,className:`w-full h-full`},o):null})]})})}function Bl(){return{downloadImage:(0,P.useCallback)((e,t)=>{e&&Wn(e,{cacheBust:!0,backgroundColor:`#18181b`}).then(e=>{let n=document.createElement(`a`);n.download=t,n.href=e,n.click()}).catch(e=>{console.error(`Failed to download image`,e)})},[])}}function Vl(e,t){let n=o(),r=(0,P.useMemo)(()=>`/api/deployments/${encodeURIComponent(e)}/ui-events/events`,[e]);(0,P.useEffect)(()=>{if(!t||!e)return;let i=t=>{try{let r=JSON.parse(t.data);if(!r||!Array.isArray(r.events))return;n.setQueryData(W.deploymentUIEvents(e),e=>{let t=(e?.events??[]).concat(r.events),n=t.slice(Math.max(0,t.length-300));return{cursor:Number(r.cursor??e?.cursor??0),events:n}})}catch{}},a=ls(r,{"ui-events":i});return()=>a.close()},[e,t,n,r])}var Hl={custom:({data:e})=>{let t=e.icon===`switch`?dn:e.icon===`cloud`?je:e.icon===`client`?Jt:ye,n=e.status===`running`?`default`:e.status===`stopped`?`secondary`:`destructive`,r=!!e?.highlight,i=String(e?.vendor??``);return(0,I.jsxs)(z,{className:`min-w-[180px] border-2 shadow-md ${r?`border-primary ring-2 ring-primary/30`:``}`,children:[(0,I.jsx)(B,{className:`p-3 pb-2`,children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(({vendor:e})=>{let t=String(e).toLowerCase();return t===`cisco`?(0,I.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center`,title:`Cisco`,style:{background:`rgba(0, 142, 204, 0.15)`,color:`rgb(0, 142, 204)`},children:(0,I.jsx)(`svg`,{viewBox:`0 0 24 24`,width:`16`,height:`16`,"aria-hidden":`true`,children:[{x:4,h:8},{x:7,h:10},{x:10,h:12},{x:13,h:10},{x:16,h:8}].map(e=>(0,I.jsx)(`rect`,{x:e.x,y:14-e.h,width:`2`,height:e.h,rx:`1`,fill:`currentColor`},e.x))})}):t===`arista`?(0,I.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center`,title:`Arista`,style:{background:`rgba(232, 43, 44, 0.14)`,color:`rgb(232, 43, 44)`},children:(0,I.jsx)(`svg`,{viewBox:`0 0 24 24`,width:`16`,height:`16`,"aria-hidden":`true`,children:(0,I.jsx)(`path`,{d:`M12 3 4.5 21h3.6l1.6-4h4.6l1.6 4h3.6L12 3zm-1 11 1-2.6 1 2.6h-2z`,fill:`currentColor`})})}):t===`linux`?(0,I.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center`,title:`Linux`,style:{background:`rgba(34, 197, 94, 0.12)`,color:`rgb(34, 197, 94)`},children:(0,I.jsxs)(`svg`,{viewBox:`0 0 24 24`,width:`16`,height:`16`,"aria-hidden":`true`,children:[(0,I.jsx)(`circle`,{cx:`12`,cy:`9`,r:`4`,fill:`#111827`}),(0,I.jsx)(`ellipse`,{cx:`12`,cy:`16`,rx:`5`,ry:`6`,fill:`#111827`}),(0,I.jsx)(`ellipse`,{cx:`12`,cy:`17`,rx:`3.3`,ry:`4.2`,fill:`#ffffff`}),(0,I.jsx)(`path`,{d:`M12 10l2 1-2 1-2-1 2-1z`,fill:`#f59e0b`})]})}):(0,I.jsx)(`div`,{className:`h-6 w-6 rounded-md flex items-center justify-center bg-muted text-[11px] font-bold`,title:`Unknown`,children:`?`})},{vendor:i}),(0,I.jsx)(`div`,{className:`p-1.5 bg-muted rounded-md`,title:String(e?.kind??``),children:(0,I.jsx)(t,{className:`w-4 h-4`})})]}),(0,I.jsx)(K,{variant:n,className:`text-[10px] h-5`,children:String(e.status)})]})}),(0,I.jsxs)(U,{className:`p-3 pt-0`,children:[(0,I.jsx)(V,{className:`text-sm font-bold truncate`,children:String(e.label)}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground mt-1 truncate font-mono`,children:String(e.ip||`10.0.0.x`)}),(0,I.jsx)(pn,{type:`target`,position:rn.Top,className:`!bg-muted-foreground`}),(0,I.jsx)(pn,{type:`source`,position:rn.Bottom,className:`!bg-muted-foreground`})]})]})}};function Ul({topology:e,deploymentId:t,enableTerminal:n,fullHeight:r,className:a}){let o=(0,P.useCallback)(e=>{let t=String(e??``).toLowerCase();return t?t.includes(`arista`)||t.includes(`eos`)||t.includes(`ceos`)||t.includes(`veos`)?`arista`:t.includes(`cisco`)||t.includes(`ios`)||t.includes(`nxos`)||t.includes(`csr`)||t.includes(`c8k`)||t.includes(`iosxr`)?`cisco`:t.includes(`linux`)||t.includes(`ubuntu`)||t.includes(`debian`)||t.includes(`alpine`)||t.includes(`rocky`)||t.includes(`centos`)?`linux`:`unknown`:`unknown`},[]),s=(0,P.useMemo)(()=>{if(!e||!Array.isArray(e.nodes)||e.nodes.length===0)return{nodes:[],edges:[]};let t=Math.max(1,Math.ceil(Math.sqrt(e.nodes.length)));return{nodes:e.nodes.map((e,n)=>{let r=n%t,i=Math.floor(n/t),a=String(e.kind??``),s=o(a),c=s===`linux`?`client`:s===`arista`||s===`cisco`?`switch`:`server`,l=String(e.status??`unknown`),u=String(e.pingIp??e.mgmtIp??``),d=String(e.mgmtHost??``);return{id:String(e.id),position:{x:r*240,y:i*160},data:{label:String(e.label??e.id),icon:c,status:l,ip:u,mgmtHost:d,kind:a,vendor:s},type:`custom`}}),edges:(e.edges??[]).map(e=>({id:String(e.id),source:String(e.source),target:String(e.target),label:e.label?String(e.label):void 0,animated:!1}))}},[e,o]),[c,l,u]=Et(s.nodes),[d,p,m]=xt(s.edges),h=(0,P.useRef)(null),{downloadImage:g}=Bl(),[_,v]=(0,P.useState)(null),[y,b]=(0,P.useState)(null),[x,ee]=(0,P.useState)(null),[S,C]=(0,P.useState)(null),[w,te]=(0,P.useState)(null),[T,E]=(0,P.useState)(null),[D,ne]=(0,P.useState)(null),[re,k]=(0,P.useState)(!1),[ie,A]=(0,P.useState)(!1),[ae,oe]=(0,P.useState)(!1),[se,ce]=(0,P.useState)(null),[le,ue]=(0,P.useState)({}),de=(0,P.useRef)(null),fe=(0,P.useRef)({}),pe=(0,P.useRef)(!1),[me,he]=(0,P.useState)(``),[ge,_e]=(0,P.useState)(`grid`),j=(0,P.useMemo)(()=>t?`skyforge.topology.positions.me.${t}`:``,[t]),[ve,ye]=(0,P.useState)(()=>({})),[be,xe]=(0,P.useState)(null),[Se,Ce]=(0,P.useState)(!1),[we,Te]=(0,P.useState)(null),[Ee,De]=(0,P.useState)(!1),[Oe,M]=(0,P.useState)(!1),[ke,Ae]=(0,P.useState)(null),[je,Me]=(0,P.useState)({side:`source`,duration:`10`,packets:`2500`,snaplen:`192`}),[Ne,Pe]=(0,P.useState)(!1),[Fe,Ie]=(0,P.useState)(null),[Le,Re]=(0,P.useState)({delayMs:``,jitterMs:``,lossPct:``,dupPct:``,corruptPct:``,reorderPct:``,rateKbps:``});(0,P.useEffect)(()=>{if(j)try{let e=window.localStorage.getItem(j);if(!e)return;let t=JSON.parse(e);t&&typeof t==`object`&&ye(t)}catch{}},[j]);let ze=!!t;Vl(t??``,ze);let Be=f({queryKey:t?W.deploymentUIEvents(t):[`deploymentUIEvents`,`none`],queryFn:async()=>({cursor:0,events:[]}),initialData:{cursor:0,events:[]},staleTime:1/0,enabled:ze}),Ve=(0,P.useMemo)(()=>Kl(Be.data?.events??[]),[Be.data?.events]);(0,P.useEffect)(()=>{l(Jl(s.nodes,ge,ve,me)),fe.current=Object.fromEntries(s.edges.map(e=>[String(e.id),typeof e.label==`string`?e.label:void 0])),p(ql(s.edges,le,ae,fe.current,Ve))},[s.edges,s.nodes,Ve,le,ge,ve,me,p,l,ae]),(0,P.useEffect)(()=>{p(e=>ql(e,le,ae,fe.current,Ve))},[Ve,le,p,ae]),(0,P.useEffect)(()=>{if(!t||pe.current)return;let e=new URLSearchParams(window.location.search),n=e.get(`node`)?.trim(),r=e.get(`action`)?.trim();if(!n||!r){pe.current=!0;return}let i=s.nodes.find(e=>String(e.id)===n);if(!i)return;let a=String(i?.data?.kind??``),o=String(i?.data?.ip??``);r===`terminal`&&v({id:n,kind:a}),r===`webui`&&b({id:n}),r===`logs`&&ee({id:n,kind:a,ip:o}),r===`describe`&&C({id:n,kind:a,ip:o}),r===`interfaces`&&(xe({id:n,kind:a,ip:o}),Ce(!0)),r===`running-config`&&(Te({id:n}),De(!0)),pe.current=!0,e.delete(`node`),e.delete(`action`);let c=e.toString(),l=`${window.location.pathname}${c?`?${c}`:``}${window.location.hash||``}`;window.history.replaceState(null,``,l)},[t,s.nodes]),(0,P.useEffect)(()=>{if(!w)return;let e=()=>te(null),t=e=>{e.key===`Escape`&&te(null)};return window.addEventListener(`click`,e),window.addEventListener(`keydown`,t),()=>{window.removeEventListener(`click`,e),window.removeEventListener(`keydown`,t)}},[w]);let He=i({mutationFn:async e=>{if(!t)throw Error(`missing deployment context`);return ea(t,e)},onSuccess:(e,t)=>{if(e?.skipped){O.message(`Save config skipped`,{description:e.message||`Node ${t}`});return}O.success(`Save config queued/applied`,{description:e.stdout||`Node ${t}`})},onError:e=>{O.error(`Save config failed`,{description:e?.message??String(e)})}}),Ue=i({mutationFn:async e=>{if(!t)throw Error(`missing deployment context`);return qi(t,e)},onSuccess:e=>{let t=e.results.filter(e=>e.error);if(t.length){O.error(`Link admin applied with errors`,{description:t.map(e=>`${e.node}: ${e.error}`).join(`; `)});return}O.success(`Link ${e.action} applied`)},onError:e=>O.error(`Link admin failed`,{description:e?.message??String(e)})}),We=i({mutationFn:async e=>{if(!t)throw Error(`missing deployment context`);return Ji(t,e)},onSuccess:e=>{O.success(`Pcap captured`,{description:`${e.sizeBytes} bytes  ${e.artifactKey}`})},onError:e=>O.error(`Pcap capture failed`,{description:e?.message??String(e)})}),Ge=i({mutationFn:async e=>{if(!t)throw Error(`missing deployment context`);return Yi(t,e)},onError:e=>O.error(`Failed to load interfaces`,{description:e?.message??String(e)})}),Ke=i({mutationFn:async e=>{if(!t)throw Error(`missing deployment context`);return Xi(t,e)},onError:e=>O.error(`Failed to load running config`,{description:e?.message??String(e)})}),qe=(0,P.useCallback)(async e=>{let t=await Aa(`me`,e),n=String(t?.fileData??``);if(!n)throw Error(`missing fileData`);let r=Uint8Array.from(atob(n),e=>e.charCodeAt(0)),i=new Blob([r],{type:`application/vnd.tcpdump.pcap`}),a=URL.createObjectURL(i),o=document.createElement(`a`);o.href=a,o.download=e.split(`/`).pop()||`capture.pcap`,o.click(),URL.revokeObjectURL(a)},[]),Je=(0,P.useCallback)(async()=>{if(!t)return;let e=await Zi(t,`csv`),n=String(e.csv??``);if(!n.trim())throw Error(`empty inventory csv`);let r=new Blob([n],{type:`text/csv`}),i=URL.createObjectURL(r),a=document.createElement(`a`);a.href=i,a.download=`${t}-inventory.csv`,a.click(),URL.revokeObjectURL(i)},[t]);(0,P.useEffect)(()=>{if(!T)return;let e=()=>E(null),t=e=>{e.key===`Escape`&&E(null)};return window.addEventListener(`click`,e),window.addEventListener(`keydown`,t),()=>{window.removeEventListener(`click`,e),window.removeEventListener(`keydown`,t)}},[T]),(0,P.useEffect)(()=>{Se&&be?.id&&Ge.mutate(be.id)},[Ge,be?.id,Se]),(0,P.useEffect)(()=>{if(!Se||!Ne||!be?.id)return;let e=window.setInterval(()=>{Ge.mutate(be.id)},2e3);return()=>window.clearInterval(e)},[Ge,Ne,be?.id,Se]),(0,P.useEffect)(()=>{Ee&&we?.id&&Ke.mutate(we.id)},[Ke,we?.id,Ee]);let Ye=(0,P.useCallback)(e=>p(t=>qt(e,t)),[p]),Xe=(0,P.useCallback)((e,n)=>{if(e.preventDefault(),!t)return;let r=h.current?.getBoundingClientRect();E({x:r?e.clientX-r.left:e.clientX,y:r?e.clientY-r.top:e.clientY,node:n})},[t]),Ze=(0,P.useCallback)((e,n)=>{if(!t)return;e.preventDefault();let r=h.current?.getBoundingClientRect();te({x:r?e.clientX-r.left:e.clientX,y:r?e.clientY-r.top:e.clientY,edge:n})},[t]),Qe=(0,P.useCallback)(async(e,n)=>{if(t)try{A(!0);let r={edgeId:n,action:e};if(e===`set`){let e=Le.delayMs.trim()?Number(Le.delayMs.trim()):void 0,t=Le.jitterMs.trim()?Number(Le.jitterMs.trim()):void 0,n=Le.lossPct.trim()?Number(Le.lossPct.trim()):void 0,i=Le.dupPct.trim()?Number(Le.dupPct.trim()):void 0,a=Le.corruptPct.trim()?Number(Le.corruptPct.trim()):void 0,o=Le.reorderPct.trim()?Number(Le.reorderPct.trim()):void 0,s=Le.rateKbps.trim()?Number(Le.rateKbps.trim()):void 0;Number.isFinite(e)&&(r.delayMs=e),Number.isFinite(t)&&(r.jitterMs=t),Number.isFinite(n)&&(r.lossPct=n),Number.isFinite(i)&&(r.dupPct=i),Number.isFinite(a)&&(r.corruptPct=a),Number.isFinite(o)&&(r.reorderPct=o),Number.isFinite(s)&&(r.rateKbps=s)}let i=(await Ki(t,r)).results.filter(e=>e.error);i.length?O.error(`Link impairment applied with errors`,{description:i.map(e=>`${e.node}: ${e.error}`).join(`; `)}):O.success(e===`clear`?`Link impairment cleared`:`Link impairment applied`)}catch(e){O.error(`Failed to apply link impairment`,{description:e?.message??String(e)})}finally{A(!1)}},[t,Le.corruptPct,Le.delayMs,Le.dupPct,Le.jitterMs,Le.lossPct,Le.rateKbps,Le.reorderPct]);return(0,P.useEffect)(()=>{if(!ae||!t)return;ce(null),de.current=null;let e=`/api/deployments/${encodeURIComponent(t)}/links/stats/events`,n=new EventSource(e,{withCredentials:!0}),r=!1;n.onopen=()=>{r=!0,ce(null)};let i=e=>{try{let t=JSON.parse(String(e.data??`{}`));if(t.type===`error`){ce(t.error||`failed to stream link stats`);return}if(t.type!==`snapshot`||!t.snapshot)return;let n=t.snapshot,r=Date.parse(n.generatedAt||``);if(!Number.isFinite(r))return;let i={};for(let e of n.edges??[])i[String(e.edgeId)]=e;let a=de.current;if(de.current={atMs:r,byEdge:i},!a)return;let o=(r-a.atMs)/1e3;if(!(o>0))return;let s={};for(let[e,t]of Object.entries(i)){let n=a.byEdge[e];if(!n)continue;let r=(e,t)=>Math.max(0,e-t),i=r(t.sourceTxBytes,n.sourceTxBytes),c=r(t.sourceRxBytes,n.sourceRxBytes),l=r(t.targetTxBytes,n.targetTxBytes),u=r(t.targetRxBytes,n.targetRxBytes),d=Math.max(i,u)+Math.max(l,c),f=r(t.sourceTxPackets,n.sourceTxPackets),p=r(t.sourceRxPackets,n.sourceRxPackets),m=r(t.targetTxPackets,n.targetTxPackets),h=r(t.targetRxPackets,n.targetRxPackets),g=(Math.max(f,h)+Math.max(m,p))/o,_=(r(t.sourceRxDropped,n.sourceRxDropped)+r(t.sourceTxDropped,n.sourceTxDropped)+r(t.targetRxDropped,n.targetRxDropped)+r(t.targetTxDropped,n.targetTxDropped))/o;s[e]={bps:d*8/o,pps:g,drops:_}}ue(s)}catch(e){ce(e?.message??String(e))}};return n.addEventListener(`stats`,i),n.onerror=()=>{r&&ce(`link stats stream disconnected`)},ta(t).catch(()=>{}),()=>{n.removeEventListener(`stats`,i),n.close()}},[t,ae]),(0,I.jsxs)(`div`,{className:`w-full bg-background/50 overflow-hidden relative ${r?`h-full`:`h-[600px]`} border rounded-xl ${a??``}`,ref:h,children:[(0,I.jsxs)(bn,{nodes:c,edges:d,onNodesChange:u,onEdgesChange:m,onConnect:Ye,onNodeContextMenu:Xe,onEdgeContextMenu:Ze,onEdgeMouseEnter:(e,t)=>{let n=h.current?.getBoundingClientRect(),r=n?e.clientX-n.left:e.clientX,i=n?e.clientY-n.top:e.clientY;Ie({id:String(t.id),x:r,y:i})},onEdgeMouseMove:e=>{if(!Fe)return;let t=h.current?.getBoundingClientRect(),n=t?e.clientX-t.left:e.clientX,r=t?e.clientY-t.top:e.clientY;Ie(e=>e?{...e,x:n,y:r}:null)},onEdgeMouseLeave:()=>Ie(null),onNodeDragStop:(e,t)=>{j&&ye(e=>{let n={...e,[String(t.id)]:{x:t.position.x,y:t.position.y}};try{window.localStorage.setItem(j,JSON.stringify(n))}catch{}return n})},nodeTypes:Hl,fitView:!0,className:`bg-muted/10`,children:[(0,I.jsx)(Wt,{position:`top-right`,children:(0,I.jsxs)(z,{className:`shadow-sm border bg-background/85 backdrop-blur`,children:[(0,I.jsx)(B,{className:`p-3 pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`Tools`})}),(0,I.jsxs)(U,{className:`p-3 pt-0 space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2 rounded-md border bg-background/70 px-2 py-1`,children:[(0,I.jsx)(ln,{className:`h-4 w-4 text-muted-foreground`}),(0,I.jsx)(J,{value:me,onChange:e=>he(e.target.value),placeholder:`Search nodes`,className:`h-7 w-56 border-0 bg-transparent p-0 text-sm focus-visible:ring-0`}),me.trim()?(0,I.jsx)(R,{variant:`ghost`,size:`sm`,className:`h-7 px-2`,onClick:()=>he(``),children:`Clear`}):null]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsxs)(R,{variant:ae?`default`:`outline`,size:`sm`,onClick:()=>{oe(e=>{let t=!e;return t||(ce(null),ue({}),de.current=null),t})},disabled:!t,title:`Show live link utilization (SSE)`,children:[(0,I.jsx)(st,{className:`mr-2 h-4 w-4`}),`Live stats`]}),(0,I.jsxs)(R,{variant:`outline`,size:`sm`,onClick:()=>_e(e=>e===`grid`?`circle`:`grid`),title:`Toggle layout`,children:[(0,I.jsx)(St,{className:`mr-2 h-4 w-4`}),ge===`grid`?`Grid`:`Circle`]}),(0,I.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>{if(ye({}),j)try{window.localStorage.removeItem(j)}catch{}},title:`Reset pinned node positions`,children:`Reset`}),(0,I.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>Je().catch(e=>O.error(`Failed to download inventory`,{description:e.message})),disabled:!t,title:`Download inventory CSV`,children:`Inventory`}),(0,I.jsxs)(R,{variant:`outline`,size:`sm`,onClick:()=>h.current&&g(h.current,`topology.png`),children:[(0,I.jsx)(N,{className:`mr-2 h-4 w-4`}),`PNG`]})]}),(0,I.jsx)(`div`,{className:`text-[11px] text-muted-foreground`,children:`Tip: Right-click a node or link for actions.`})]})]})}),(0,I.jsx)(en,{}),(0,I.jsx)(vt,{zoomable:!0,pannable:!0,className:`bg-background border rounded-lg`}),(0,I.jsx)(ft,{gap:12,size:1})]}),ae&&se?(0,I.jsxs)(`div`,{className:`absolute bottom-2 left-2 z-40 rounded-md border bg-background/90 px-3 py-2 text-xs text-muted-foreground shadow-sm`,children:[`Live stats: `,se]}):null,Fe&&ae&&le[Fe.id]?(0,I.jsxs)(`div`,{className:`absolute z-40 rounded-md border bg-background/90 px-3 py-2 text-xs shadow-sm`,style:{left:Fe.x+12,top:Fe.y+12},children:[(0,I.jsx)(`div`,{className:`font-mono`,children:Fe.id}),(0,I.jsxs)(`div`,{className:`text-muted-foreground`,children:[Wl(le[Fe.id].bps),` `,` `,Math.round(le[Fe.id].pps),` pps `,` `,le[Fe.id].drops.toFixed(1),` drops/s`]})]}):null,ze&&(Be.data?.events?.length??0)>0?(0,I.jsx)(`div`,{className:`absolute bottom-2 right-2 z-40 w-[420px] max-w-[92vw]`,children:(0,I.jsxs)(z,{className:`shadow-sm border bg-background/90 backdrop-blur`,children:[(0,I.jsx)(B,{className:`p-3 pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`Recent activity`})}),(0,I.jsx)(U,{className:`p-3 pt-0 space-y-2`,children:(Be.data?.events??[]).slice(-8).reverse().map(e=>(0,I.jsxs)(`div`,{className:`flex items-start justify-between gap-2 text-xs`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-mono truncate`,children:e.eventType}),(0,I.jsx)(`div`,{className:`text-muted-foreground truncate`,children:e.createdAt})]}),(0,I.jsx)(`div`,{className:`text-muted-foreground font-mono truncate`,children:e.createdBy?e.createdBy:``})]},String(e.id)))})]})}):null,n&&t?(0,I.jsx)(Rl,{open:!!_,onOpenChange:e=>{e||v(null)},deploymentId:t,nodeId:_?.id??``,nodeKind:_?.kind??``}):null,t?(0,I.jsx)(zl,{open:!!y,onOpenChange:e=>{e||b(null)},deploymentId:t,nodeId:y?.id??``}):null,t?(0,I.jsx)(Pl,{open:!!x,onOpenChange:e=>{e||ee(null)},deploymentId:t,nodeId:x?.id??``,nodeKind:x?.kind??``,nodeIp:x?.ip??``}):null,t?(0,I.jsx)(Ml,{open:!!S,onOpenChange:e=>{e||C(null)},deploymentId:t,nodeId:S?.id??``,nodeKind:S?.kind??``,nodeIp:S?.ip??``}):null,(0,I.jsx)(Xn,{open:Se,onOpenChange:e=>{Ce(e),e||xe(null)},children:(0,I.jsxs)($n,{className:`max-w-3xl`,children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{children:`Interfaces`})}),(0,I.jsx)(Yl,{node:be?.id??``,data:Ge.data,loading:Ge.isPending,error:Ge.isError?Ge.error?.message??`failed`:``,autoRefresh:Ne,onToggleAutoRefresh:()=>Pe(e=>!e)})]})}),(0,I.jsx)(Xn,{open:Ee,onOpenChange:e=>{De(e),e||Te(null)},children:(0,I.jsxs)($n,{className:`max-w-4xl`,children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{children:`Running config`})}),(0,I.jsx)(Xl,{node:we?.id??``,data:Ke.data,loading:Ke.isPending,error:Ke.isError?Ke.error?.message??`failed`:``})]})}),T&&t?(0,I.jsx)(`div`,{className:`absolute z-50`,style:{left:T.x,top:T.y},onContextMenu:e=>e.preventDefault(),children:(0,I.jsxs)(z,{className:`w-64 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,I.jsxs)(B,{className:`p-3 pb-2`,children:[(0,I.jsx)(V,{className:`text-sm`,children:`Node Actions`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:String(T.node?.data?.label??T.node.id)})]}),(0,I.jsxs)(U,{className:`p-3 pt-0 space-y-2`,children:[(0,I.jsx)(R,{size:`sm`,className:`w-full`,disabled:!n,onClick:()=>{let e=String(T.node?.data?.kind??``);E(null),v({id:String(T.node.id),kind:e})},children:`Open terminal`}),(0,I.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{E(null),b({id:String(T.node.id)})},children:`Open Web UI`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,disabled:!n,onClick:()=>{let e=String(T.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=terminal`;window.open(t,`_blank`,`noopener,noreferrer`),E(null)},children:`Open terminal (new tab)`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(T.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=webui`;window.open(t,`_blank`,`noopener,noreferrer`),E(null)},children:`Open Web UI (new tab)`}),(0,I.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(T.node?.data?.kind??``),t=String(T.node?.data?.ip??``);E(null),ee({id:String(T.node.id),kind:e,ip:t})},children:`View logs`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(T.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=logs`;window.open(t,`_blank`,`noopener,noreferrer`),E(null)},children:`View logs (new tab)`}),(0,I.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(T.node?.data?.kind??``),t=String(T.node?.data?.ip??``);E(null),C({id:String(T.node.id),kind:e,ip:t})},children:`Describe`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(T.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=describe`;window.open(t,`_blank`,`noopener,noreferrer`),E(null)},children:`Describe (new tab)`}),(0,I.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(T.node?.data?.kind??``),t=String(T.node?.data?.ip??``),n=String(T.node.id);E(null),xe({id:n,kind:e,ip:t}),Ce(!0)},children:`Interfaces`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(T.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=interfaces`;window.open(t,`_blank`,`noopener,noreferrer`),E(null)},children:`Interfaces (new tab)`}),(0,I.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,disabled:He.isPending,onClick:()=>{let e=String(T.node.id);E(null),He.mutate(e)},children:He.isPending?`Saving`:`Save config`}),(0,I.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=String(T.node.id);E(null),Te({id:e}),De(!0)},children:`Running config`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=String(T.node.id),t=`${window.location.pathname}?node=${encodeURIComponent(e)}&action=running-config`;window.open(t,`_blank`,`noopener,noreferrer`),E(null)},children:`Running config (new tab)`}),(0,I.jsx)(R,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>{let e=String(T.node?.data?.ip??``).trim();if(!e){O.error(`No management IP available`);return}navigator.clipboard?.writeText(e),O.success(`Copied management IP`),E(null)},children:`Copy management IP`}),(0,I.jsx)(R,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>{let e=String(T.node.id);navigator.clipboard?.writeText(e),O.success(`Copied node name`),E(null)},children:`Copy node name`}),(0,I.jsx)(R,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>{let e=String(T.node?.data?.ip??``).trim();if(!e){O.error(`No management IP available`);return}let t=`ssh admin@${e}`;navigator.clipboard?.writeText(t),O.success(`Copied SSH command`),E(null)},children:`Copy SSH command`}),(0,I.jsx)(R,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>E(null),children:`Close`})]})]})}):null,w&&t?(0,I.jsx)(`div`,{className:`absolute z-50`,style:{left:w.x,top:w.y},onContextMenu:e=>e.preventDefault(),children:(0,I.jsxs)(z,{className:`w-64 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,I.jsxs)(B,{className:`p-3 pb-2`,children:[(0,I.jsx)(V,{className:`text-sm`,children:`Link Actions`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:String(w.edge.label??w.edge.id)})]}),(0,I.jsxs)(U,{className:`p-3 pt-0 space-y-2`,children:[(0,I.jsx)(R,{size:`sm`,variant:Ve.edgeDown.has(String(w.edge.id))?`secondary`:`destructive`,className:`w-full`,disabled:Ue.isPending,onClick:()=>{let e=String(w.edge.id),t=Ve.edgeDown.has(e);te(null),Ue.mutate({edgeId:e,action:t?`up`:`down`})},children:Ve.edgeDown.has(String(w.edge.id))?`Bring link up`:`Bring link down`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,disabled:We.isPending,onClick:()=>{Ae({id:String(w.edge.id),label:String(w.edge.label??``)}),te(null),M(!0)},children:`Capture pcap`}),Ve.lastCaptureByEdge[String(w.edge.id)]?(0,I.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=Ve.lastCaptureByEdge[String(w.edge.id)];te(null),qe(e).catch(e=>O.error(`Failed to download pcap`,{description:e.message}))},children:`Download last pcap`}):null,(0,I.jsx)(R,{size:`sm`,className:`w-full`,onClick:()=>{ne({id:String(w.edge.id),label:String(w.edge.label??``)}),te(null),k(!0)},children:`Configure impairment`}),(0,I.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,disabled:ie,onClick:()=>{let e=String(w.edge.id);te(null),Qe(`clear`,e)},children:`Clear impairment`}),(0,I.jsx)(R,{size:`sm`,variant:`ghost`,className:`w-full`,onClick:()=>te(null),children:`Close`})]})]})}):null,(0,I.jsx)(Xn,{open:Oe,onOpenChange:e=>{M(e),e||Ae(null)},children:(0,I.jsxs)($n,{className:`max-w-lg`,children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{children:`Capture pcap`})}),(0,I.jsxs)(`div`,{className:`space-y-4`,children:[ke?.label?(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:ke.label}):null,(0,I.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`capSide`,children:`Side`}),(0,I.jsxs)(`select`,{id:`capSide`,className:`h-9 w-full rounded-md border bg-background px-3 text-sm`,value:je.side,onChange:e=>Me(t=>({...t,side:e.target.value})),children:[(0,I.jsx)(`option`,{value:`source`,children:`Source`}),(0,I.jsx)(`option`,{value:`target`,children:`Target`})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`capDuration`,children:`Duration (s)`}),(0,I.jsx)(J,{id:`capDuration`,inputMode:`numeric`,value:je.duration,onChange:e=>Me(t=>({...t,duration:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`capPackets`,children:`Max packets`}),(0,I.jsx)(J,{id:`capPackets`,inputMode:`numeric`,value:je.packets,onChange:e=>Me(t=>({...t,packets:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`capSnaplen`,children:`Snaplen`}),(0,I.jsx)(J,{id:`capSnaplen`,inputMode:`numeric`,value:je.snaplen,onChange:e=>Me(t=>({...t,snaplen:e.target.value}))})]})]}),(0,I.jsxs)(`div`,{className:`flex gap-2 justify-end`,children:[(0,I.jsx)(R,{variant:`secondary`,onClick:()=>M(!1),disabled:We.isPending,children:`Cancel`}),(0,I.jsx)(R,{onClick:()=>{let e=String(ke?.id??``);if(!e){O.error(`No link selected`);return}let t=Number(je.duration.trim()||`10`),n=Number(je.packets.trim()||`2500`),r=Number(je.snaplen.trim()||`192`);We.mutateAsync({edgeId:e,side:je.side,durationSeconds:t,maxPackets:n,snaplen:r}).then(e=>(O.success(`Pcap ready`,{description:e.artifactKey}),qe(e.artifactKey).catch(()=>{}))).finally(()=>M(!1))},disabled:We.isPending,children:We.isPending?`Capturing`:`Capture`})]})]})]})}),(0,I.jsx)(Xn,{open:re,onOpenChange:e=>{k(e),e||ne(null)},children:(0,I.jsxs)($n,{className:`max-w-lg`,children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{children:`Configure Link Impairment`})}),(0,I.jsxs)(`div`,{className:`space-y-4`,children:[D?.label?(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:D.label}):null,(0,I.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`delayMs`,children:`Delay (ms)`}),(0,I.jsx)(J,{id:`delayMs`,inputMode:`numeric`,placeholder:`e.g. 50`,value:Le.delayMs,onChange:e=>Re(t=>({...t,delayMs:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`jitterMs`,children:`Jitter (ms)`}),(0,I.jsx)(J,{id:`jitterMs`,inputMode:`numeric`,placeholder:`e.g. 10`,value:Le.jitterMs,onChange:e=>Re(t=>({...t,jitterMs:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`lossPct`,children:`Loss (%)`}),(0,I.jsx)(J,{id:`lossPct`,inputMode:`decimal`,placeholder:`e.g. 1.0`,value:Le.lossPct,onChange:e=>Re(t=>({...t,lossPct:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`dupPct`,children:`Duplicate (%)`}),(0,I.jsx)(J,{id:`dupPct`,inputMode:`decimal`,placeholder:`e.g. 0.1`,value:Le.dupPct,onChange:e=>Re(t=>({...t,dupPct:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`corruptPct`,children:`Corrupt (%)`}),(0,I.jsx)(J,{id:`corruptPct`,inputMode:`decimal`,placeholder:`e.g. 0.05`,value:Le.corruptPct,onChange:e=>Re(t=>({...t,corruptPct:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`reorderPct`,children:`Reorder (%)`}),(0,I.jsx)(J,{id:`reorderPct`,inputMode:`decimal`,placeholder:`e.g. 0.2`,value:Le.reorderPct,onChange:e=>Re(t=>({...t,reorderPct:e.target.value}))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{htmlFor:`rateKbps`,children:`Rate (kbit/s)`}),(0,I.jsx)(J,{id:`rateKbps`,inputMode:`numeric`,placeholder:`e.g. 100000`,value:Le.rateKbps,onChange:e=>Re(t=>({...t,rateKbps:e.target.value}))})]})]}),(0,I.jsxs)(`div`,{className:`flex gap-2 justify-end`,children:[(0,I.jsx)(R,{variant:`secondary`,onClick:()=>k(!1),disabled:ie,children:`Cancel`}),(0,I.jsx)(R,{onClick:()=>{let e=String(D?.id??``);if(!e){O.error(`No link selected`);return}Qe(`set`,e).finally(()=>k(!1))},disabled:ie,children:`Apply`})]})]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Tip: Right-click a link in the topology to configure impairment.`})]})})]})}function Wl(e){return e>0?e>=1e9?`${(e/1e9).toFixed(2)} Gbps`:e>=1e6?`${(e/1e6).toFixed(1)} Mbps`:e>=1e3?`${(e/1e3).toFixed(0)} Kbps`:`${Math.round(e)} bps`:`0 bps`}function Gl(e){if(!Number.isFinite(e)||e<=0)return`0 B`;let t=[`B`,`KB`,`MB`,`GB`,`TB`],n=e,r=0;for(;n>=1024&&r<t.length-1;)n/=1024,r++;let i=r===0||r===1?0:1;return`${n.toFixed(i)} ${t[r]}`}function Kl(e){let t=new Set,n={};for(let r of e??[]){let e=String(r?.eventType??``),i=r?.payload??{},a=String(i?.edgeId??``).trim();if(a&&(e===`link.down`&&t.add(a),e===`link.up`&&t.delete(a),e===`link.capture`)){let e=String(i?.artifactKey??``).trim();e&&(n[a]=e)}}return{edgeDown:t,lastCaptureByEdge:n}}function ql(e,t,n,r,i){return e.map(e=>{let a=String(e.id),o=r[a]??(typeof e.label==`string`?e.label:void 0),s=i.edgeDown.has(a);if(!n)return{...e,label:s?o?`${o}  DOWN`:`DOWN`:o,animated:!1,style:s?{stroke:`hsl(var(--destructive))`,strokeWidth:2,strokeDasharray:`6 6`}:void 0};let c=t[a];if(!c)return{...e,label:s?o?`${o}  DOWN`:`DOWN`:o,animated:!1,style:s?{stroke:`hsl(var(--destructive))`,strokeWidth:2,strokeDasharray:`6 6`}:void 0};let l=c.bps??0,u=1+Math.min(9,Math.log10(Math.max(1,l))/1.2),d=o?`${o}  ${Wl(l)}`:Wl(l),f=s?`${d}  DOWN`:d;return{...e,label:f,animated:!s&&l>0,style:{...e.style??{},strokeWidth:u,...s?{stroke:`hsl(var(--destructive))`,strokeDasharray:`6 6`}:{}}}})}function Jl(e,t,n,r){let i=r.trim().toLowerCase(),a=new Set;if(i)for(let t of e){let e=String(t?.data?.label??t.id).toLowerCase(),n=String(t.id).toLowerCase(),r=String(t?.data?.ip??``).toLowerCase();(e.includes(i)||n.includes(i)||r.includes(i))&&a.add(String(t.id))}let o=e.length||1,s=Math.max(260,o*30);return e.map((e,r)=>{let c=String(e.id),l=n[c],u=l??e.position;if(!l&&t===`circle`){let e=r/o*Math.PI*2;u={x:Math.cos(e)*s,y:Math.sin(e)*s}}let d=i?a.has(c):!1,f=i?!a.has(c):!1;return{...e,position:u,data:{...e.data,highlight:d},style:f?{...e.style??{},opacity:.25}:e.style}})}function Yl(e){if(e.loading)return(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading`});if(e.error)return(0,I.jsx)(`div`,{className:`text-sm text-destructive`,children:e.error});let t=e.data?.interfaces??[];return t.length?(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:e.node}),(0,I.jsx)(R,{size:`sm`,variant:e.autoRefresh?`default`:`outline`,onClick:e.onToggleAutoRefresh,children:e.autoRefresh?`Auto refresh: on`:`Auto refresh: off`})]}),(0,I.jsx)(`div`,{className:`rounded-md border overflow-auto max-h-[60vh]`,children:(0,I.jsxs)(`table`,{className:`w-full text-xs`,children:[(0,I.jsx)(`thead`,{className:`bg-muted/50 sticky top-0`,children:(0,I.jsxs)(`tr`,{children:[(0,I.jsx)(`th`,{className:`text-left p-2`,children:`Interface`}),(0,I.jsx)(`th`,{className:`text-left p-2`,children:`Peer`}),(0,I.jsx)(`th`,{className:`text-left p-2`,children:`State`}),(0,I.jsx)(`th`,{className:`text-right p-2`,children:`RX`}),(0,I.jsx)(`th`,{className:`text-right p-2`,children:`TX`}),(0,I.jsx)(`th`,{className:`text-right p-2`,children:`Drops`})]})}),(0,I.jsx)(`tbody`,{children:t.map(e=>(0,I.jsxs)(`tr`,{className:`border-t`,children:[(0,I.jsx)(`td`,{className:`p-2 font-mono`,children:e.ifName}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-muted-foreground`,children:e.peerNode?`${e.peerNode}:${e.peerIf??``}`:``}),(0,I.jsx)(`td`,{className:`p-2`,children:e.operState??``}),(0,I.jsx)(`td`,{className:`p-2 text-right font-mono`,children:Gl(Number(e.rxBytes??0))}),(0,I.jsx)(`td`,{className:`p-2 text-right font-mono`,children:Gl(Number(e.txBytes??0))}),(0,I.jsx)(`td`,{className:`p-2 text-right font-mono`,children:Number(e.rxDropped??0)+Number(e.txDropped??0)})]},e.ifName))})]})})]}):(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No interfaces found.`})}function Xl(e){if(e.loading)return(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading`});if(e.error)return(0,I.jsx)(`div`,{className:`text-sm text-destructive`,children:e.error});if(e.data?.skipped)return(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:e.data.message||`Skipped`});let t=String(e.data?.stdout??``);return(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:e.node}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(t),O.success(`Copied running config`)},disabled:!t,children:`Copy`})]}),(0,I.jsx)(`pre`,{className:`max-h-[65vh] overflow-auto rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100 whitespace-pre-wrap`,children:t||`No output`}),e.data?.stderr?(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground whitespace-pre-wrap`,children:e.data.stderr}):null]})}const Zl=t(`/dashboard/labs/map`)({component:$l});function Ql(e){let t=Jn.parse(String(e??``))?.topology??{},n=t?.nodes??{},r=Object.entries(n).map(([e,t])=>{let n=String(t?.kind??``);return{id:String(e),label:String(e),kind:n,status:`unknown`,mgmtIp:``}}),i=[],a=Array.isArray(t?.links)?t.links:[];for(let e=0;e<a.length;e++){let t=a[e],n=Array.isArray(t?.endpoints)?t.endpoints:[];if(n.length!==2)continue;let r=String(n[0]??``),o=String(n[1]??``),s=r.split(`:`)[0],c=o.split(`:`)[0];!s||!c||i.push({id:`e${e+1}`,source:s,target:c,label:`${r}  ${o}`})}return{nodes:r,edges:i}}function $l(){let e=Zl.useSearch(),t=String(e?.source??`user`).trim().toLowerCase(),n=t===`personal`?`user`:t===`blueprints`||t===`custom`||t===`external`||t===`user`?t:`user`,r=String(e?.dir??`containerlab/designer`),i=String(e?.file??``),a=f({queryKey:[`containerlabTemplateMap`,`me`,n,r,i],queryFn:async()=>{if(!i)throw Error(`file is required`);return sa(`me`,{source:n,dir:r,file:i})},enabled:!!i,retry:!1,staleTime:3e4}),o=(0,P.useMemo)(()=>{if(!a.data?.yaml)return null;try{return Ql(a.data.yaml)}catch{return null}},[a.data?.yaml]);return i?a.isLoading||a.isFetching?(0,I.jsxs)(`div`,{className:`h-screen w-screen p-6`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(G,{className:`h-9 w-9`}),(0,I.jsx)(G,{className:`h-8 w-64`})]}),(0,I.jsx)(`div`,{className:`mt-6`,children:(0,I.jsx)(G,{className:`h-[75vh] w-full`})})]}):!a.data||!o?(0,I.jsx)(`div`,{className:`h-screen w-screen p-6`,children:(0,I.jsx)(_s,{title:`Map unavailable`,description:a.isError?`Failed to load template.`:`Template YAML could not be parsed into a topology.`,action:{label:`Close`,onClick:()=>window.close()}})}):(0,I.jsxs)(`div`,{className:`h-screen w-screen flex flex-col bg-background`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3 border-b px-4 py-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3 min-w-0`,children:[(0,I.jsx)(m,{to:`/dashboard/labs/designer`,search:{},className:So({variant:`outline`,size:`icon`,className:`h-9 w-9`}),title:`Back to designer`,children:(0,I.jsx)(it,{className:`h-4 w-4`})}),(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-semibold truncate`,children:`Lab map`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:a.data.path})]})]}),(0,I.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,I.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>{navigator.clipboard?.writeText(a.data.yaml)},children:`Copy YAML`})})]}),(0,I.jsxs)(`div`,{className:`flex-1 min-h-0 grid grid-cols-1 lg:grid-cols-[1fr_520px]`,children:[(0,I.jsx)(`div`,{className:`min-h-0 p-3`,children:(0,I.jsx)(`div`,{className:`h-full rounded-xl border overflow-hidden`,children:(0,I.jsx)(Ul,{topology:o,enableTerminal:!1,fullHeight:!0})})}),(0,I.jsx)(`div`,{className:`min-h-0 border-l bg-background p-3`,children:(0,I.jsxs)(z,{className:`h-full`,children:[(0,I.jsx)(B,{className:`pb-3`,children:(0,I.jsx)(V,{children:`YAML`})}),(0,I.jsx)(U,{className:`h-[calc(100%-56px)]`,children:(0,I.jsx)(kc,{value:a.data.yaml,readOnly:!0,className:`h-full font-mono text-xs`})})]})})]})]}):(0,I.jsx)(`div`,{className:`h-screen w-screen p-6`,children:(0,I.jsxs)(`div`,{className:`max-w-2xl space-y-4`,children:[(0,I.jsx)(`div`,{className:`text-2xl font-bold tracking-tight`,children:`Lab map`}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Open this page from the Lab Designer Open map button, or provide query params.`}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Parameters`})}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`File`}),(0,I.jsx)(J,{value:i,readOnly:!0,placeholder:`file missing`})]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Example:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`/dashboard/labs/map?source=user&dir=containerlab/designer&file=lab.clab.yml`})]})]})]})]})})}function eu(e){let[t,n]=(0,P.useState)(``),[r,i]=(0,P.useState)(``),[a,o]=(0,P.useState)(``),s=f({queryKey:W.registryRepos(t),queryFn:async()=>ha({q:t,n:500}),retry:!1,staleTime:3e4}),c=f({queryKey:a?W.registryTags(a,r):[`registryTags`,`none`],queryFn:async()=>ga(a,{q:r}),enabled:!!a,retry:!1,staleTime:3e4}),l=(0,P.useMemo)(()=>{let t=(e.value||``).trim(),n=t.lastIndexOf(`:`);return n<=0?{repo:t,tag:``}:{repo:t.slice(0,n),tag:t.slice(n+1)}},[e.value]);return(0,I.jsxs)(`div`,{className:`space-y-3 ${e.className??``}`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Image`}),(0,I.jsx)(J,{value:e.value,onChange:t=>e.onChange(t.target.value),placeholder:`repo:tag`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:"Registry-backed picker. Requires server env `SKYFORGE_REGISTRY_URL`."})]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsx)(q,{children:`Repository`}),(0,I.jsx)(R,{size:`sm`,variant:`ghost`,onClick:()=>{l.repo&&(o(l.repo),O.message(`Repository selected`,{description:l.repo}))},children:`Use current`})]}),(0,I.jsx)(J,{value:t,onChange:e=>n(e.target.value),placeholder:`Search repos`}),(0,I.jsx)(`div`,{className:`max-h-40 overflow-auto rounded-md border`,children:s.isError?(0,I.jsx)(`div`,{className:`p-2 text-xs text-destructive`,children:`Failed to load repos.`}):s.isLoading?(0,I.jsx)(`div`,{className:`p-2 text-xs text-muted-foreground`,children:`Loading`}):(0,I.jsx)(`div`,{className:`divide-y`,children:(s.data?.repositories??[]).slice(0,200).map(e=>(0,I.jsx)(`button`,{type:`button`,className:`w-full text-left px-2 py-1.5 text-xs font-mono hover:bg-accent ${a===e?`bg-accent`:``}`,onClick:()=>o(e),children:e},e))})})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsx)(q,{children:`Tag`}),(0,I.jsx)(R,{size:`sm`,variant:`ghost`,onClick:()=>{if(!a)return;let t=`${a}:${l.tag||`latest`}`;e.onChange(t)},disabled:!a,children:`Set image`})]}),(0,I.jsx)(J,{value:r,onChange:e=>i(e.target.value),placeholder:`Search tags`,disabled:!a}),(0,I.jsx)(`div`,{className:`max-h-40 overflow-auto rounded-md border`,children:a?c.isError?(0,I.jsx)(`div`,{className:`p-2 text-xs text-destructive`,children:`Failed to load tags.`}):c.isLoading?(0,I.jsx)(`div`,{className:`p-2 text-xs text-muted-foreground`,children:`Loading`}):(0,I.jsx)(`div`,{className:`divide-y`,children:(c.data?.tags??[]).slice(0,300).map(t=>(0,I.jsx)(`button`,{type:`button`,className:`w-full text-left px-2 py-1.5 text-xs font-mono hover:bg-accent`,onClick:()=>e.onChange(`${a}:${t}`),children:t},t))}):(0,I.jsx)(`div`,{className:`p-2 text-xs text-muted-foreground`,children:`Select a repo`})})]})]})]})}function tu(e){let t=String(e??``).trim();return t&&t.toLowerCase().replace(/[^a-z0-9-]+/g,`-`).replace(/^-+|-+$/g,``).slice(0,48)||`node`}function nu(e){let t=new Set,n=new Map;for(let r of e){let e=tu(r.id||r.label||`node`),i=e,a=2;for(;t.has(i);)i=`${e}-${a++}`;t.add(i),n.set(r.id,i)}return n}function ru(e){let t=[],n=tu(e.name||`lab`),r=nu(e.nodes),i=new Map,a=e=>{let t=(i.get(e)??0)+1;return i.set(e,t),`eth${t}`},o={};for(let n of e.nodes){let e=r.get(n.id)||tu(n.id),i=String(n.id||n.label||``).trim();i&&tu(i)!==i&&t.push(`Node ${i}: name will be '${tu(i)}'`),i&&tu(i)!==e&&t.push(`Node ${i}: name adjusted to '${e}'`);let a=(n.kind||``).trim()||void 0,s=(n.image||``).trim()||void 0;s||t.push(`Node ${e}: missing image`),o[e]={...a?{kind:a}:{},...s?{image:s}:{},...n.env&&Object.keys(n.env).length?{env:n.env}:{},...n.mgmtIpv4?{mgmt_ipv4:n.mgmtIpv4}:{}}}let s=[];for(let n of e.links){let e=r.get(n.source),i=r.get(n.target);if(!e||!i){t.push(`Link ${n.id}: missing endpoint(s)`);continue}let o=a(n.source),c=a(n.target);s.push({endpoints:[`${e}:${o}`,`${i}:${c}`]})}let c={name:n,topology:{nodes:o,...s.length?{links:s}:{}}},l=(e,t=0)=>{let n=`  `.repeat(t);if(e==null)return`null`;if(typeof e==`string`)return JSON.stringify(e);if(typeof e==`number`||typeof e==`boolean`)return String(e);if(Array.isArray(e))return e.length===0?`[]`:e.map(e=>{if(typeof e==`object`&&e&&!Array.isArray(e)){let r=l(e,t+1).split(`
`);return`${n}- ${r[0].trimStart()}\n${r.slice(1).map(e=>`${n}  ${e}`).join(`
`)}`}return`${n}- ${l(e,0)}`}).join(`
`);if(typeof e==`object`){let r=Object.keys(e);return r.length===0?`{}`:r.map(r=>{let i=e[r];return i===void 0?``:typeof i==`object`&&i?`${n}${r}:\n${l(i,t+1)}`:`${n}${r}: ${l(i,0)}`}).filter(Boolean).join(`
`)}return JSON.stringify(String(e))};return{yaml:l(c,0)+`
`,warnings:t}}var iu=qn({importDeploymentId:Hn().optional().catch(``)});const au=t(`/dashboard/labs/designer`)({validateSearch:e=>iu.parse(e),component:gu});var ou=`application/x-skyforge-palette-item`;function su(e){return`name: ${String(e||`lab`).trim().replace(/\s+/g,`-`).toLowerCase()||`lab`}
provider: clab
defaults:
  device: eos
nodes: {}
`}function cu(e){let t=e.runtime===`netlab-c9s`,n=t?`${e.labName||`lab`}.yml`:`${e.labName||`lab`}.clab.yml`,r=e.templatesDir,i=e.importDir,a=e.templateFile;return t?((!r.trim()||uu(r))&&(r=`netlab/designer`),(!i.trim()||i.startsWith(`containerlab`))&&(i=`netlab`),(!a.trim()||a.endsWith(`.clab.yml`))&&(a=n)):((!r.trim()||du(r))&&(r=`containerlab/designer`),(!i.trim()||i.startsWith(`netlab`))&&(i=`containerlab`),a.trim()||(a=n)),{templatesDir:r,importDir:i,templateFile:a}}function lu(e){let t=String(e??``).trim();if(!t)return``;try{return new URL(t).hostname||t}catch{return t.replace(/^https?:\/\//,``).split(`/`)[0]??t}}function uu(e){let t=String(e??``).trim().replace(/^\/+|\/+$/g,``);return t===`containerlab`||t.startsWith(`containerlab/`)}function du(e){let t=String(e??``).trim().replace(/^\/+|\/+$/g,``);return t===`netlab`||t.startsWith(`netlab/`)||t===`blueprints/netlab`||t.startsWith(`blueprints/netlab/`)}function fu(e){let t=String(e??``).trim().replace(/^\/+|\/+$/g,``),n=t.toLowerCase(),r=t.split(`/`).pop()??t,i=e=>({id:`${e.kind}:${e.repo??``}`,...e});return n.includes(`endhost`)||n.includes(`linux`)||n.includes(`ubuntu`)||n.includes(`alpine`)?i({label:`Host  ${r}`,category:`Hosts`,kind:`linux`,repo:t,vendor:`Linux`,model:r,role:`host`}):r===`ceos`||n.endsWith(`/ceos`)||n.includes(`/ceos:`)?i({label:`Switch  Arista cEOS`,category:`Switches`,kind:`ceos`,repo:t,vendor:`Arista`,model:`cEOS`,role:`switch`}):n.includes(`vrnetlab/cisco_iol`)?i({label:`Router  Cisco IOL (IOS)`,category:`Routers`,kind:`cisco_iol`,repo:t,vendor:`Cisco`,model:`IOL`,role:`router`}):n.includes(`vrnetlab/cisco_viosl2`)?i({label:`Switch  Cisco vIOS L2`,category:`Switches`,kind:`cisco_viosl2`,repo:t,vendor:`Cisco`,model:`vIOS L2`,role:`switch`}):n.includes(`vrnetlab/vr-n9kv`)||n.includes(`vrnetlab/nxos`)?i({label:`Switch  Cisco NX-OSv (N9Kv)`,category:`Switches`,kind:`vr-n9kv`,repo:t,vendor:`Cisco`,model:`NX-OSv9k`,role:`switch`}):n.includes(`vrnetlab/vr-vmx`)||n.includes(`/vr-vmx`)?i({label:`Router  Juniper vMX`,category:`Routers`,kind:`vr-vmx`,repo:t,vendor:`Juniper`,model:`vMX`,role:`router`}):n.includes(`vrnetlab/juniper_vjunos-router`)?i({label:`Router  Juniper vJunos Router`,category:`Routers`,kind:`juniper_vjunos-router`,repo:t,vendor:`Juniper`,model:`vJunos-router`,role:`router`}):n.includes(`vrnetlab/juniper_vjunos-switch`)?i({label:`Switch  Juniper vJunos Switch`,category:`Switches`,kind:`juniper_vjunos-switch`,repo:t,vendor:`Juniper`,model:`vJunos-switch`,role:`switch`}):n.includes(`vrnetlab/juniper_vsrx`)||n.includes(`vr-vsrx`)||n.includes(`vsrx`)||n.includes(`/srx`)?i({label:`Firewall  Juniper SRX`,category:`Firewalls`,kind:`vr-vsrx`,repo:t,vendor:`Juniper`,model:`SRX`,role:`firewall`}):n.includes(`vrnetlab/vr-fortios`)||n.includes(`fortios`)?i({label:`Firewall  Fortinet FortiOS`,category:`Firewalls`,kind:`vr-fortios`,repo:t,vendor:`Fortinet`,model:`FortiOS`,role:`firewall`}):n.includes(`vrnetlab/vr-ftosv`)||n.includes(`os10`)?i({label:`Switch  Dell OS10`,category:`Switches`,kind:`vr-ftosv`,repo:t,vendor:`Dell`,model:`OS10`,role:`switch`}):n.includes(`vrnetlab/`)&&(n.includes(`asa`)||n.includes(`pan`)||n.includes(`palo`)||n.includes(`checkpoint`))?i({label:`Firewall  ${r}`,category:`Firewalls`,kind:r,repo:t,role:`firewall`}):i({label:`Node  ${r}`,category:`Other`,kind:r,repo:t,role:`other`})}function pu(e){let t=e.item,n=t.role===`firewall`?qe:t.role===`host`?ye:Bt,r=t.vendor?`${t.vendor}${t.model?`  ${t.model}`:``}`:t.label,i=t.role===`router`?`Router`:t.role===`switch`?`Switch`:t.role===`firewall`?`Firewall`:t.role===`host`?`Host`:`Node`;return(0,I.jsx)(`div`,{className:`cursor-grab select-none rounded-lg border bg-background px-3 py-2 text-sm hover:bg-accent ${e.selected?`ring-2 ring-primary/50 border-primary/50`:``}`,draggable:!0,onDragStart:n=>{e.onSelect?.(t),n.dataTransfer.setData(ou,JSON.stringify(t)),n.dataTransfer.effectAllowed=`copy`},onClick:()=>e.onSelect?.(t),title:t.repo?`${t.label}\n${t.repo}`:t.label,children:(0,I.jsxs)(`div`,{className:`flex items-start gap-2`,children:[(0,I.jsx)(n,{className:`mt-0.5 h-4 w-4 text-muted-foreground`}),(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsxs)(`div`,{className:`truncate flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`truncate`,children:r}),(0,I.jsx)(`span`,{className:`shrink-0 rounded-full bg-muted px-2 py-0.5 text-[10px] font-medium text-muted-foreground`,children:i})]}),(0,I.jsx)(`div`,{className:`truncate text-[11px] text-muted-foreground font-mono`,children:t.repo??t.kind})]})]})})}async function mu(e){let t=String(e.repo??``).trim().replace(/^\/+|\/+$/g,``);if(!t)return`latest`;try{let n=await e.queryClient.fetchQuery({queryKey:W.registryTags(t,``),queryFn:async()=>ga(t,{q:``}),retry:!1,staleTime:3e4}),r=Array.isArray(n?.tags)?n.tags:[];return r.includes(`latest`)?`latest`:r.length>0?String(r[r.length-1]):`latest`}catch{return`latest`}}function hu(e){let t=String(e.data?.kind??``),n=String(e.data?.label??e.id),r=t.toLowerCase(),i=r.includes(`forti`)||r.includes(`vsrx`)||r.includes(`srx`)||r.includes(`asa`)||r.includes(`pan`),a=r.includes(`linux`)||r.includes(`host`),o=i?qe:a?ye:we,s=i?`border-amber-500/60`:a?`border-emerald-500/60`:`border-sky-500/60`;return(0,I.jsxs)(`div`,{className:[`rounded-xl border bg-background/95 px-3 py-2 shadow-sm min-w-[140px]`,e.selected?`ring-2 ring-primary/60`:``,s].join(` `),children:[(0,I.jsx)(pn,{type:`target`,position:rn.Top}),(0,I.jsx)(pn,{type:`target`,position:rn.Left}),(0,I.jsx)(pn,{type:`source`,position:rn.Right}),(0,I.jsx)(pn,{type:`source`,position:rn.Bottom}),(0,I.jsxs)(`div`,{className:`flex items-start gap-2`,children:[(0,I.jsx)(`div`,{className:`mt-0.5 rounded-md border bg-muted p-1.5`,children:(0,I.jsx)(o,{className:`h-4 w-4`})}),(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-medium leading-tight truncate`,children:n}),(0,I.jsx)(`div`,{className:`text-[11px] text-muted-foreground truncate`,children:t||`node`})]})]})]})}function gu(){let e=au.useSearch(),t=String(e.importDeploymentId??``).trim(),n=`skyforge.labDesigner.v1`,r=(0,P.useRef)(null),a=o(),[s,c]=(0,P.useState)(`lab`),[l,u]=(0,P.useState)(`clabernetes`),[d,p]=(0,P.useState)(`build`),[m,h]=(0,P.useState)(``),[g,_]=(0,P.useState)(!0),[y,b]=(0,P.useState)(null),[x,ee]=(0,P.useState)(`containerlab/designer`),[S,C]=(0,P.useState)(``),[w,te]=(0,P.useState)(!0),[T,E]=(0,P.useState)(``),[D,ne]=(0,P.useState)(`all`),[k,ie]=(0,P.useState)(`all`),[A,ae]=(0,P.useState)(``),[oe,se]=(0,P.useState)(null),[ce,le]=(0,P.useState)(null),[ue,fe]=(0,P.useState)(``),[pe,me]=(0,P.useState)(!1),[he,ge]=(0,P.useState)(``),[j,ve]=(0,P.useState)(`graph-generated`),[ye,be]=(0,P.useState)(``),[xe,Se]=(0,P.useState)(!1),[Ce,we]=(0,P.useState)(`blueprints`),[Te,Ee]=(0,P.useState)(`containerlab`),[Oe,M]=(0,P.useState)(``),[ke,Ae]=(0,P.useState)(!1),[je,Me]=(0,P.useState)(`clos`),[Ne,Pe]=(0,P.useState)(2),[Fe,Ie]=(0,P.useState)(4),[Le,Re]=(0,P.useState)(1),[ze,Ve]=(0,P.useState)(`ceos`),[He,Ue]=(0,P.useState)(``),[We,Ge]=(0,P.useState)(`linux`),[Ke,qe]=(0,P.useState)(``),[Je,Ye]=(0,P.useState)(!0),[Xe,Ze]=(0,P.useState)(null),[Qe,$e]=(0,P.useState)(null),[et,tt]=(0,P.useState)(null),[nt,rt]=(0,P.useState)(!1),[it,ot]=(0,P.useState)(``),[st,ct]=(0,P.useState)(``),[lt,ut]=(0,P.useState)(!0),[dt,pt]=(0,P.useState)(null),[mt,ht]=(0,P.useState)(`assumptions`),[gt,_t]=(0,P.useState)(!0),[yt,bt]=(0,P.useState)(null),[Ct,wt]=(0,P.useState)(null),Tt=l===`netlab-c9s`,[Dt,Ot,kt]=Et([{id:`r1`,position:{x:80,y:80},data:{label:`r1`,kind:`linux`,image:``},type:`designerNode`}]),[At,jt,Mt]=xt([]),Nt=(0,P.useCallback)(()=>{rt(!0)},[]),Pt=(0,P.useCallback)(e=>{e.some(e=>e.type!==`select`)&&Nt(),kt(e)},[Nt,kt]),Ft=(0,P.useCallback)(e=>{e.some(e=>e.type!==`select`)&&Nt(),Mt(e)},[Nt,Mt]),It=(0,P.useMemo)(()=>Dt.find(e=>e.id===ue)??null,[Dt,ue]),Lt=(0,P.useMemo)(()=>({name:s,nodes:Dt.map(e=>({id:String(e.id),label:String(e.data?.label??e.id),kind:String(e.data?.kind??``),image:String(e.data?.image??``),position:{x:e.position.x,y:e.position.y}})),links:At.map(e=>({id:String(e.id),source:String(e.source),target:String(e.target)}))}),[At,s,Dt]),{yaml:Rt,warnings:zt}=(0,P.useMemo)(()=>ru(Lt),[Lt]),Vt=(0,P.useMemo)(()=>zt.filter(e=>e.toLowerCase().includes(`missing image`)),[zt]),Ht=(0,P.useMemo)(()=>zt.filter(e=>!e.toLowerCase().includes(`missing image`)),[zt]),Ut=(0,P.useMemo)(()=>j===`graph-generated`?Rt:String(ye??``),[ye,Rt,j]),Wt=i({mutationFn:async()=>{if(!Ut.trim())throw Error(`YAML is empty`);if(Tt){if(!du(Yt))throw Error(`Repo path must be under netlab/ or blueprints/netlab/`);let e=await da(`me`,{name:s,topologyYAML:Ut,templatesDir:Yt,template:Xt});return b({userContextId:e.ownerUsername,templatesDir:e.templatesDir,template:e.template,filePath:e.filePath,branch:e.branch}),ia(`me`,{source:`user`,dir:e.templatesDir,template:e.template})}return Rr({kind:`containerlab`,content:Ut})}}),Gt=i({mutationFn:async()=>{if(!Ut.trim())throw Error(`YAML is empty`);if(Tt)throw Error(`Auto-fix is only supported for containerlab YAML`);return zr({kind:`containerlab`,content:Ut,maxIterations:5})},onSuccess:e=>{ve(`manual-custom`),bt(null),be(e.content??``),e.ok?O.success(`Auto-fix succeeded`,{description:`Iterations: ${e.iterations}`}):O.error(`Auto-fix still has errors`,{description:`Iterations: ${e.iterations}`})}}),Kt=(0,P.useMemo)(()=>{let e=Wt.data?.task,t=String(e?.id??e?.task_id??``).trim(),n=Tt?!!t:e?.ok===!0,r=e?.errors,i=[];if(Array.isArray(r))for(let e of r)i.push(String(e));else if(typeof r==`string`)i.push(r);else if(r!=null)try{i.push(JSON.stringify(r))}catch{i.push(String(r))}return{ok:n,errs:i,runId:t}},[Tt,Wt.data]),Jt=(0,P.useMemo)(()=>({ok:Gt.data?.ok===!0,errs:Array.isArray(Gt.data?.errors)?(Gt.data?.errors??[]).map(e=>String(e)):[]}),[Gt.data]),Yt=(0,P.useMemo)(()=>String(x??``).trim().replace(/^\/+|\/+$/g,``)||(Tt?`netlab/designer`:`containerlab/designer`),[Tt,x]),Xt=(0,P.useMemo)(()=>{let e=String(S??``).trim(),t=Tt?`${s||`lab`}.yml`:`${s||`lab`}.clab.yml`,n=e||t;return n.endsWith(`.yml`)||n.endsWith(`.yaml`)?n:`${n}.yml`},[Tt,s,S]);(0,P.useEffect)(()=>{let e=cu({runtime:l,labName:s,templatesDir:x,importDir:Te,templateFile:S});e.templatesDir!==x&&ee(e.templatesDir),e.importDir!==Te&&Ee(e.importDir),e.templateFile!==S&&C(e.templateFile),l===`netlab-c9s`&&j===`graph-generated`&&(ve(`manual-custom`),ye.trim()||be(su(s)))},[ye,Te,s,l,S,x,j]),(0,P.useEffect)(()=>{if(xe)try{let e=window.localStorage.getItem(`skyforge.labDesigner.importPrefs.me`);if(!e)return;let t=JSON.parse(e);t?.source===`blueprints`?we(`blueprints`):t?.source&&we(`user`),typeof t?.dir==`string`&&Ee(t.dir)}catch{}},[xe,`me`]),(0,P.useEffect)(()=>{try{window.localStorage.setItem(`skyforge.labDesigner.importPrefs.me`,JSON.stringify({source:Ce,dir:Te}))}catch{}},[Te,Ce,`me`]);let Zt=(0,P.useCallback)(async e=>{let t=e?.item??oe??null;if(!t){O.error(`Select a node image first`,{description:`Choose a node type from the palette, then add a node.`});return}let n=t.role,r=n===`host`?`h`:n===`router`?`r`:n===`switch`?`s`:n===`firewall`?`f`:t.kind===`linux`?`h`:`n`,i=String(t.repo??``).trim(),o=i?await mu({repo:i,queryClient:a}):``,s=i?`${i}:${o}`:``,c=``;Ot(n=>{let i=n.length+1,a=`${r}${i}`,o=new Set(n.map(e=>String(e.id)));for(;o.has(a);)i++,a=`${r}${i}`;let l=e?.position??{x:120+n.length*40,y:120+n.length*30};c=a;let u={id:a,position:{x:l.x,y:l.y},data:{label:a,kind:t.kind,image:s},type:`designerNode`};return[...n,u]}),ae(t.id),se(t),c&&fe(c),Nt()},[Nt,a,oe,Ot]),Qt=()=>{let e=Math.max(1,Math.min(16,Number.isFinite(Ne)?Ne:2)),t=Math.max(1,Math.min(64,Number.isFinite(Fe)?Fe:4)),n=Math.max(0,Math.min(16,Number.isFinite(Le)?Le:1));c((je||`clos`).trim()||`clos`);let r=(e,t,n,r,i)=>({id:e,position:{x:t,y:n},data:{label:e,kind:r,image:i},type:`designerNode`}),i=[],a=[],o=Array.from({length:e},(e,t)=>`s${t+1}`),s=Array.from({length:t},(e,t)=>`l${t+1}`);for(let e=0;e<o.length;e++)i.push(r(o[e],120+e*260,120,ze,He));for(let e=0;e<s.length;e++)i.push(r(s[e],120+e*260,320,ze,He));for(let e of s)for(let t of o)a.push({id:`e-${e}-${t}`,source:e,target:t});let l=1;for(let e=0;e<s.length;e++){let t=s[e];for(let o=0;o<n;o++){let n=`h${l++}`,s=120+e*260+o*70;i.push(r(n,s,520,We,Ke)),a.push({id:`e-${n}-${t}`,source:n,target:t})}}Ot(i),jt(a),ve(`graph-generated`),bt(null),wt(null),be(``),fe(``),Ae(!1),requestAnimationFrame(()=>ce?.fitView({padding:.15,duration:250})),i.filter(e=>!String(e.data?.image??``).trim()).length?O.message(`Quickstart created (missing images)`,{description:`Pick images per-node (or use defaults) before deploying.`}):O.success(`Starter topology created`)},$t=()=>{let e=Dt.length;if(!e)return;let t=Math.max(1,Math.ceil(Math.sqrt(e)));Ot(e=>e.map((e,n)=>({...e,position:{x:120+n%t*260,y:120+Math.floor(n/t)*180}}))),requestAnimationFrame(()=>ce?.fitView({padding:.15,duration:300}))},tn=()=>{Ze(null),$e(null),tt(null)},nn=e=>{if(!t)return;let n=new URLSearchParams;n.set(`action`,e.action),n.set(`node`,e.node);let r=`/dashboard/deployments/${encodeURIComponent(t)}?${n.toString()}`;window.open(r,`_blank`,`noopener,noreferrer`)},rn=e=>{let t=Dt.find(t=>String(t.id)===e);if(!t)return;let n=String(t.data?.label??t.id),r=window.prompt(`Node name`,n);if(r==null)return;let i=r.trim();if(!i)return;let a=new Set(Dt.map(e=>String(e.id)));a.delete(e);let o=i,s=2;for(;a.has(o);)o=`${i}-${s++}`;Ot(t=>t.map(t=>String(t.id)===e?{...t,id:o,data:{...t.data,label:i}}:t)),jt(t=>t.map(t=>({...t,source:String(t.source)===e?o:t.source,target:String(t.target)===e?o:t.target,label:String(t.source)===e||String(t.target)===e?`${String(t.source)===e?o:t.source}  ${String(t.target)===e?o:t.target}`:t.label}))),ue===e&&fe(o),Ze(t=>t&&t.nodeId===e?{...t,nodeId:o}:t)};(0,P.useEffect)(()=>{let e=e=>{e.key===`Escape`&&tn()};return window.addEventListener(`keydown`,e),()=>window.removeEventListener(`keydown`,e)},[]);let an=()=>{let e=new Blob([Ut],{type:`text/yaml`}),t=document.createElement(`a`);t.href=URL.createObjectURL(e),t.download=Xt,document.body.appendChild(t),t.click(),t.remove(),setTimeout(()=>URL.revokeObjectURL(t.href),5e3)};(0,P.useEffect)(()=>{let t=String(e.importDeploymentId??``).trim();if(!t)return;_(!1),b(null);let n=!1;return(async()=>{try{let e=await ma(t);if(n)return;let r=(e.nodes??[]).map((e,t)=>({id:String(e.id),position:{x:120+t%4*260,y:120+Math.floor(t/4)*180},data:{label:String(e.label||e.id),kind:String(e.kind||``),image:``},type:`designerNode`})),i=(e.edges??[]).map(e=>({id:String(e.id),source:String(e.source),target:String(e.target),label:e.label||`${e.source}  ${e.target}`}));if(!r.length)throw Error(`No nodes found in deployment topology`);Ot(r),jt(i),fe(String(r[0].id)),O.success(`Imported running topology`,{description:`Deployment ${t}`}),requestAnimationFrame(()=>ce?.fitView({padding:.15,duration:250}))}catch(e){if(n)return;O.error(`Failed to import deployment topology`,{description:e.message})}})(),()=>{n=!0}},[e.importDeploymentId]);let on=()=>{try{let e={labName:s,userContextId:`me`,runtime:l,containerlabServer:m,useSavedConfig:g,lastSaved:y,nodes:Dt,edges:At};window.localStorage.setItem(n,JSON.stringify(e)),O.success(`Draft saved`)}catch(e){O.error(`Failed to save draft`,{description:e.message})}},sn=()=>{try{let e=window.localStorage.getItem(n);if(!e){O.message(`No saved draft`);return}let t=JSON.parse(e);typeof t?.labName==`string`&&c(t.labName),(t?.runtime===`clabernetes`||t?.runtime===`containerlab`||t?.runtime===`netlab-c9s`)&&u(t.runtime),typeof t?.containerlabServer==`string`?h(t.containerlabServer):typeof t?.netlabServer==`string`&&h(t.netlabServer),typeof t?.useSavedConfig==`boolean`&&_(t.useSavedConfig),t?.lastSaved&&typeof t.lastSaved==`object`&&b(t.lastSaved),Array.isArray(t?.nodes)&&Ot(t.nodes),Array.isArray(t?.edges)&&jt(t.edges),O.success(`Draft loaded`)}catch(e){O.error(`Failed to load draft`,{description:e.message})}},cn=f({queryKey:W.registryRepos(``),queryFn:async()=>ha({q:``,n:2e3}),retry:!1,staleTime:6e4}),ln=f({queryKey:W.userContainerlabServers(),queryFn:bi,enabled:l===`containerlab`,retry:!1,staleTime:3e4}),un=f({queryKey:[Tt?`netlabTemplates`:`containerlabTemplates`,`me`,Ce,Te],queryFn:async()=>Tt?na(`me`,{source:Ce,dir:Te}):aa(`me`,{source:Ce,dir:Te}),enabled:xe,retry:!1,staleTime:3e4}),dn=f({queryKey:[Tt?`netlabTemplate`:`containerlabTemplate`,`me`,Ce,Te,Oe],queryFn:async()=>Oe?Tt?ra(`me`,{source:Ce,dir:Te,template:Oe}):sa(`me`,{source:Ce,dir:Te,file:Oe}):null,enabled:xe&&!!Oe,retry:!1,staleTime:3e4}),fn=i({mutationFn:async()=>{let e=j===`generated-draft`&&!!yt;if(e&&!(e&&Ct===yt))throw Error(`Review generated assumptions before deploying`);if(!Ut.trim())throw Error(`YAML is empty`);let t=g&&y?.userContextId===`me`;if(Tt){if(!du(Yt))throw Error(`Repo path must be under netlab/ or blueprints/netlab/`);let e=t?y:await da(`me`,{name:s,topologyYAML:Ut,templatesDir:Yt,template:Xt}).then(e=>{let t={userContextId:e.ownerUsername,templatesDir:e.templatesDir,template:e.template,filePath:e.filePath,branch:e.branch};return b(t),t}),n=await la(`me`,{name:s,type:`netlab-c9s`,config:{templateSource:`user`,templatesDir:e.templatesDir,template:e.template}});return{deployment:n,run:await Qa(String(n.id))}}if(!/^\s*topology\s*:/m.test(Ut))throw Error(`YAML must contain a top-level 'topology:' section`);if(!uu(Yt))throw Error(`Repo path must be under containerlab/`);let n=t?y:await ua(`me`,{name:s,topologyYAML:Ut,templatesDir:Yt,template:Xt}).then(e=>{let t={userContextId:e.ownerUsername,templatesDir:e.templatesDir,template:e.template,filePath:e.filePath,branch:e.branch};return b(t),t});if(l===`containerlab`){if(!m)throw Error(`Select a containerlab server`);return pa(`me`,{name:s,netlabServer:m,templateSource:`user`,templatesDir:n.templatesDir,template:n.template,autoDeploy:!0})}return fa(`me`,{name:s,templateSource:`user`,templatesDir:n.templatesDir,template:n.template,autoDeploy:!0})},onSuccess:async e=>{O.success(`Deployment created`,{description:e.deployment?.name??s}),await a.invalidateQueries({queryKey:W.dashboardSnapshot()});let t=e.deployment?.id;Je&&t&&window.open(`/dashboard/deployments/${t}`,`_blank`,`noopener,noreferrer`)},onError:e=>O.error(`Create deployment failed`,{description:e.message})}),pn=i({mutationFn:async()=>{if(!Ut.trim())throw Error(`YAML is empty`);if(Tt){if(!du(Yt))throw Error(`Repo path must be under netlab/ or blueprints/netlab/`);return da(`me`,{name:s,topologyYAML:Ut,templatesDir:Yt,template:Xt})}if(!/^\s*topology\s*:/m.test(Ut))throw Error(`YAML must contain a top-level 'topology:' section`);if(!uu(Yt))throw Error(`Repo path must be under containerlab/`);return ua(`me`,{name:s,topologyYAML:Ut,templatesDir:Yt,template:Xt})},onSuccess:e=>{b({userContextId:e.ownerUsername,templatesDir:e.templatesDir,template:e.template,filePath:e.filePath,branch:e.branch}),O.success(`Saved to repo`,{description:`${e.filePath} (${e.branch})`})},onError:e=>O.error(`Save failed`,{description:e.message})}),mn=i({mutationFn:async()=>{let e=Oe.trim();if(!e)throw Error(`Select a template`);return Tt?ra(`me`,{source:Ce,dir:Te,template:e}):sa(`me`,{source:Ce,dir:Te,file:e})},onSuccess:e=>{ve(`manual-custom`),bt(null),be(e.yaml),Se(!1),O.success(`Template imported`,{description:e.path})},onError:e=>O.error(`Import failed`,{description:e.message})}),hn=i({mutationFn:async()=>{let e=String(it??``).trim();if(!e)throw Error(`Enter a topology prompt first`);return Br({prompt:e,hints:{preferredDevice:st.trim()||void 0,includeHosts:lt}})},onSuccess:async e=>{let t={spec:e.spec,netlabYaml:e.netlabYaml,containerlabYaml:e.containerlabYaml,generatedAt:e.generatedAt};pt(t),_t(!0),ht(`assumptions`),bt(null),wt(null),s.trim()||c(t.spec.name||`ai-lab`),O.success(`Draft generated from prompt`)},onError:e=>O.error(`Generation failed`,{description:e.message})}),gn=(0,P.useCallback)(()=>{if(!dt)return;let e=(dt.spec.nodes??[]).map(e=>({id:String(e.id),position:{x:Number(e.x)||120,y:Number(e.y)||120},data:{label:String(e.label||e.id),kind:String(e.kind||`linux`),image:String(e.image||``)},type:`designerNode`})),t=(dt.spec.links??[]).map(e=>({id:String(e.id),source:String(e.a),target:String(e.b),label:`${String(e.a)}  ${String(e.b)}`}));e.length&&(Ot(e),jt(t),fe(String(e[0].id)),Nt(),requestAnimationFrame(()=>ce?.fitView({padding:.15,duration:250})),O.success(`Applied generated topology to canvas`))},[dt,Nt,ce,jt,Ot]),_n=(0,P.useCallback)(()=>{if(!dt)return;let e=String(dt.generatedAt||Date.now());ve(`generated-draft`),be(Tt?dt.netlabYaml:dt.containerlabYaml),bt(e),wt(null),p(`validate`),O.success(Tt?`Applied generated netlab YAML`:`Applied generated containerlab YAML`)},[dt,Tt]),vn=e=>{e.preventDefault(),e.dataTransfer.dropEffect=`move`},yn=async e=>{if(e.preventDefault(),!r.current||!ce)return;let t=e.dataTransfer.getData(ou),n=e.dataTransfer.getData(`application/x-skyforge-kind`),i=t?(()=>{try{return JSON.parse(t)}catch{return null}})():null,a=i?.kind||n;if(!a)return;i&&(ae(i.id),se(i));let o=r.current.getBoundingClientRect(),s=ce.screenToFlowPosition({x:e.clientX-o.left,y:e.clientY-o.top}),c={id:`${a}:${a}`,label:a,category:`Other`,kind:a,role:`other`};await Zt({position:s,item:i??c})},Sn=async()=>{if(Tt){O.message(`Map view is available for containerlab designs only`);return}try{let e=y?.userContextId===`me`?y:await ua(`me`,{name:s,topologyYAML:Ut,templatesDir:Yt,template:Xt}).then(e=>{let t={userContextId:e.ownerUsername,templatesDir:e.templatesDir,template:e.template,filePath:e.filePath,branch:e.branch};return b(t),t}),t=new URLSearchParams;t.set(`source`,`user`),t.set(`dir`,e.templatesDir),t.set(`file`,e.template);let n=`/dashboard/labs/map?${t.toString()}`;window.open(n,`_blank`,`noopener,noreferrer`)}catch(e){O.error(`Failed to open map`,{description:e.message})}},Cn=e=>{let t=e.target,n=t?.tagName?.toUpperCase?.()??``;if(n===`INPUT`||n===`TEXTAREA`||t?.isContentEditable)return;if(e.key===`Escape`){tn();return}if(e.key!==`Delete`&&e.key!==`Backspace`)return;let r=new Set(Dt.filter(e=>e.selected).map(e=>String(e.id))),i=new Set(At.filter(e=>e.selected).map(e=>String(e.id)));r.size===0&&i.size===0||(e.preventDefault(),Ot(e=>e.filter(e=>!r.has(String(e.id)))),jt(e=>e.filter(e=>!(i.has(String(e.id))||r.has(String(e.source))||r.has(String(e.target))))))},wn=(0,P.useMemo)(()=>({designerNode:hu}),[]),Tn=(0,P.useMemo)(()=>(cn.isError?[]:cn.data?.repositories??[]).map(fu),[cn.data?.repositories,cn.isError]);(0,P.useEffect)(()=>{if(Tn.length===0){ae(``),se(null);return}let e=Tn.some(e=>e.id===A)?A:Tn[0].id;e!==A&&ae(e);let t=Tn.find(t=>t.id===e)??null;se(e=>!e&&!t||e?.id===t?.id&&e?.repo===t?.repo?e:t)},[Tn,A]);let En=(0,P.useMemo)(()=>{let e=new Set;for(let t of Tn){let n=String(t.vendor??``).trim();n&&e.add(n)}return Array.from(e).sort((e,t)=>e.localeCompare(t))},[Tn]),Dn=(0,P.useMemo)(()=>{let e=Tn,t=T.trim().toLowerCase(),n=e.filter(e=>D===`all`?!0:String(e.vendor??``)===D).filter(e=>k===`all`?!0:String(e.role??`other`)===k).filter(e=>t?`${e.label} ${e.kind} ${e.category} ${e.repo??``}`.toLowerCase().includes(t):!0),r={Hosts:0,Routers:1,Switches:2,Firewalls:3,Other:4};return n.sort((e,t)=>{let n=r[e.category]??99,i=r[t.category]??99;return n===i?e.label.localeCompare(t.label):n-i})},[Tn,k,T,D]),On=Tn.length>0&&Dn.length===0,kn=cn.isError?cn.error?.message||`Registry unavailable.`:``,An=j===`graph-generated`?`generated`:`custom`,jn=j===`generated-draft`&&!!yt,Mn=jn&&Ct===yt,Nn=Ut.trim()?jn&&!Mn?`Review generated assumptions`:``:`YAML is empty`,Pn=Wt.isPending?`validating`:Wt.isError?`failed`:Wt.isSuccess?Tt?Kt.runId?`queued`:`failed`:Kt.ok?`validated`:`invalid`:`not run`,Fn=[{id:`build`,title:`1. Build`,state:dt?`draft ready`:Dt.length>0?`ready`:`empty`,description:`Topology canvas, node palette, and prompt generation.`},{id:`validate`,title:`2. Validate`,state:Pn,description:`Review YAML and run runtime-specific validation.`},{id:`deploy`,title:`3. Deploy`,state:Nn?`blocked`:`ready`,description:`Save config and create deployment run.`}];return(0,I.jsxs)(`div`,{className:`h-full w-full p-4 flex flex-col gap-4 min-h-0`,children:[(0,I.jsx)(`div`,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsxs)(`div`,{className:`text-2xl font-bold tracking-tight`,children:[`Lab Designer `,Tt?`(Netlab)`:`(Containerlab)`]}),(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:Tt?`Edit/import netlab YAML, validate it, and deploy.`:`Drag nodes, wire links, generate Containerlab YAML, and deploy.`})]})}),(0,I.jsxs)(`div`,{className:`grid gap-4 lg:grid-cols-[1fr_420px] flex-1 min-h-0`,children:[(0,I.jsxs)(z,{className:`flex flex-col min-h-0`,children:[(0,I.jsx)(B,{className:`pb-3`,children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(V,{children:`Topology`}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>te(e=>!e),children:w?`Snap: on`:`Snap: off`}),(0,I.jsxs)(R,{size:`sm`,variant:pe?`default`:`outline`,onClick:()=>{me(e=>{let t=!e;return t||ge(``),t})},title:`Create links by clicking a source node, then a target node`,children:[(0,I.jsx)(xn,{className:`mr-2 h-4 w-4`}),pe?`Link: on`:`Link: off`]}),(0,I.jsxs)(R,{size:`sm`,variant:`outline`,onClick:$t,disabled:Dt.length<2,children:[(0,I.jsx)(St,{className:`mr-2 h-4 w-4`}),`Auto-layout`]}),(0,I.jsxs)(R,{size:`sm`,variant:`outline`,onClick:()=>void Zt(),disabled:!oe,title:oe?`Add ${oe.label}`:`Select a palette item first`,children:[(0,I.jsx)(v,{className:`mr-2 h-4 w-4`}),`Add node`]})]})]})}),(0,I.jsx)(U,{className:`flex-1 min-h-0`,children:(0,I.jsxs)(`div`,{className:`flex h-full w-full border rounded-xl overflow-hidden bg-background/50`,children:[(0,I.jsxs)(`div`,{className:`w-[180px] border-r bg-background p-3`,children:[(0,I.jsx)(`div`,{className:`text-xs font-semibold text-muted-foreground`,children:`Palette`}),(0,I.jsx)(`div`,{className:`mt-2`,children:(0,I.jsx)(J,{value:T,onChange:e=>E(e.target.value),placeholder:`Search`,className:`h-8`})}),(0,I.jsxs)(`div`,{className:`mt-2 grid gap-2`,children:[(0,I.jsxs)(Y,{value:D,onValueChange:ne,children:[(0,I.jsx)(Z,{className:`h-8`,children:(0,I.jsx)(X,{placeholder:`Vendor`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All vendors`}),En.map(e=>(0,I.jsx)($,{value:e,children:e},e))]})]}),(0,I.jsxs)(Y,{value:k,onValueChange:ie,children:[(0,I.jsx)(Z,{className:`h-8`,children:(0,I.jsx)(X,{placeholder:`Role`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All roles`}),(0,I.jsx)($,{value:`router`,children:`Routers`}),(0,I.jsx)($,{value:`switch`,children:`Switches`}),(0,I.jsx)($,{value:`firewall`,children:`Firewalls`}),(0,I.jsx)($,{value:`host`,children:`Hosts`}),(0,I.jsx)($,{value:`other`,children:`Other`})]})]})]}),(0,I.jsxs)(`div`,{className:`mt-3 space-y-2`,children:[oe?(0,I.jsxs)(`div`,{className:`rounded-lg border bg-muted/30 px-2 py-1 text-[11px] text-muted-foreground`,children:[`Add-node type:`,` `,(0,I.jsx)(`span`,{className:`font-medium text-foreground`,children:oe.label})]}):null,cn.isLoading?(0,I.jsx)(`div`,{className:`rounded-lg border bg-background px-3 py-2 text-xs text-muted-foreground`,children:`Loading images`}):Dn.length===0?(0,I.jsx)(`div`,{className:`rounded-lg border bg-background px-3 py-2 text-xs text-muted-foreground`,children:cn.isError?(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`font-medium text-foreground`,children:`Registry not available`}),(0,I.jsx)(`div`,{children:kn}),(0,I.jsx)(`div`,{children:`Set SKYFORGE_REGISTRY_URL (e.g. https://ghcr.io) and optional credentials.`})]}):On?(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`font-medium text-foreground`,children:`No matches`}),(0,I.jsx)(`div`,{children:`Try clearing filters or search terms.`})]}):(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`font-medium text-foreground`,children:`No images yet`}),(0,I.jsx)(`div`,{children:`Add container images to your registry (e.g. GHCR) or adjust registry repo prefixes.`})]})}):(0,I.jsx)(`div`,{className:`space-y-3`,children:[`Hosts`,`Routers`,`Switches`,`Firewalls`,`Other`].map(e=>({category:e,items:Dn.filter(t=>t.category===e)})).filter(e=>e.items.length>0).map(e=>(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-[11px] font-semibold text-muted-foreground`,children:e.category}),(0,I.jsx)(`div`,{className:`space-y-2`,children:e.items.slice(0,60).map(e=>(0,I.jsx)(pu,{item:e,selected:A===e.id,onSelect:e=>{ae(e.id),se(e)}},e.id))})]},e.category))})]})]}),(0,I.jsxs)(`div`,{className:`flex-1 outline-none relative`,ref:r,onDrop:yn,onDragOver:vn,tabIndex:0,onKeyDown:Cn,onMouseDown:e=>{e.target?.closest?.(`[data-context-menu-root='true']`)||(e.currentTarget.focus(),tn())},onContextMenu:e=>e.preventDefault(),children:[pe?(0,I.jsx)(`div`,{className:`absolute z-10 m-3 rounded-lg border bg-background/80 px-3 py-2 text-xs text-muted-foreground backdrop-blur`,children:he?(0,I.jsxs)(I.Fragment,{children:[`Link mode: select target for`,` `,(0,I.jsx)(`span`,{className:`font-mono text-foreground`,children:he})]}):(0,I.jsx)(I.Fragment,{children:`Link mode: click a source node, then click a target node`})}):null,(0,I.jsxs)(bn,{nodes:Dt,edges:At,onNodesChange:Pt,onEdgesChange:Ft,onConnect:e=>{let t=e.source&&e.target?`${e.source}  ${e.target}`:void 0;jt(n=>qt({...e,label:t},n))},fitView:!0,onNodeClick:(e,t)=>{let n=String(t.id);if(pe){if(!he){ge(n);return}if(he===n){ge(``);return}let e=`e-${he}-${n}-${Date.now()}`;jt(t=>qt({id:e,source:he,target:n,label:`${he}  ${n}`},t)),ge(``);return}fe(n)},onNodeContextMenu:(e,t)=>{e.preventDefault();let n=r.current?.getBoundingClientRect();Ze({x:n?e.clientX-n.left:e.clientX,y:n?e.clientY-n.top:e.clientY,nodeId:String(t.id)}),$e(null),tt(null)},onEdgeContextMenu:(e,t)=>{e.preventDefault();let n=r.current?.getBoundingClientRect();$e({x:n?e.clientX-n.left:e.clientX,y:n?e.clientY-n.top:e.clientY,edgeId:String(t.id)}),Ze(null),tt(null)},onPaneContextMenu:e=>{e.preventDefault();let t=r.current?.getBoundingClientRect(),n=t?e.clientX-t.left:e.clientX,i=t?e.clientY-t.top:e.clientY;tt({x:n,y:i,flowPosition:ce?ce.screenToFlowPosition({x:n,y:i}):{x:n,y:i}}),Ze(null),$e(null)},onInit:le,snapToGrid:w,snapGrid:[12,12],nodeTypes:wn,children:[(0,I.jsx)(en,{}),(0,I.jsx)(vt,{zoomable:!0,pannable:!0,className:`bg-background border rounded-lg`}),(0,I.jsx)(ft,{gap:12,size:1})]}),Xe?(0,I.jsx)(`div`,{className:`absolute z-50`,style:{left:Xe.x,top:Xe.y},"data-context-menu-root":`true`,onMouseDown:e=>e.stopPropagation(),onClick:e=>e.stopPropagation(),onContextMenu:e=>{e.preventDefault(),e.stopPropagation()},children:(0,I.jsxs)(z,{className:`w-64 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,I.jsxs)(B,{className:`p-3 pb-2`,children:[(0,I.jsx)(V,{className:`text-sm`,children:`Node`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:String(Dt.find(e=>String(e.id)===Xe.nodeId)?.data?.label??Xe.nodeId)})]}),(0,I.jsxs)(U,{className:`p-3 pt-0 space-y-2`,children:[(0,I.jsx)(R,{size:`sm`,className:`w-full`,onClick:()=>{fe(Xe.nodeId),tn()},children:`Edit`}),t?(0,I.jsxs)(`div`,{className:`grid grid-cols-3 gap-2`,children:[(0,I.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>{nn({action:`terminal`,node:Xe.nodeId}),tn()},children:`Terminal`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>{nn({action:`logs`,node:Xe.nodeId}),tn()},children:`Logs`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>{nn({action:`describe`,node:Xe.nodeId}),tn()},children:`Describe`})]}):null,(0,I.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{rn(Xe.nodeId),tn()},children:`Rename`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=Dt.find(e=>String(e.id)===Xe.nodeId);if(!e)return;let t=new Set(Dt.map(e=>String(e.id))),n=Dt.length+1,r=`${String(e.id)}-${n}`;for(;t.has(r);)n++,r=`${String(e.id)}-${n}`;let i={...e,id:r,position:{x:e.position.x+32,y:e.position.y+32},data:{...e.data,label:r}};Ot(e=>[...e,i]),fe(r),tn()},children:`Duplicate`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{me(!0),ge(Xe.nodeId),tn()},children:`Start link`}),(0,I.jsx)(R,{size:`sm`,variant:`secondary`,className:`w-full`,onClick:()=>{let e=Dt.find(e=>String(e.id)===Xe.nodeId)?.data?.label??Xe.nodeId;navigator.clipboard?.writeText(String(e)),O.success(`Copied`),tn()},children:`Copy name`}),(0,I.jsx)(R,{size:`sm`,variant:`destructive`,className:`w-full`,onClick:()=>{let e=Xe.nodeId;Ot(t=>t.filter(t=>String(t.id)!==e)),jt(t=>t.filter(t=>String(t.source)!==e&&String(t.target)!==e)),ue===e&&fe(``),tn()},children:`Delete`})]})]})}):null,Qe?(0,I.jsx)(`div`,{className:`absolute z-50`,style:{left:Qe.x,top:Qe.y},"data-context-menu-root":`true`,onMouseDown:e=>e.stopPropagation(),onClick:e=>e.stopPropagation(),onContextMenu:e=>{e.preventDefault(),e.stopPropagation()},children:(0,I.jsxs)(z,{className:`w-60 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,I.jsxs)(B,{className:`p-3 pb-2`,children:[(0,I.jsx)(V,{className:`text-sm`,children:`Link`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:At.find(e=>String(e.id)===Qe.edgeId)?.label??Qe.edgeId})]}),(0,I.jsxs)(U,{className:`p-3 pt-0 space-y-2`,children:[(0,I.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{let e=At.find(e=>String(e.id)===Qe.edgeId);if(!e)return;let t=window.prompt(`Link label`,String(e.label??``));t!=null&&(jt(e=>e.map(e=>String(e.id)===Qe.edgeId?{...e,label:t}:e)),tn())},children:`Rename`}),(0,I.jsx)(R,{size:`sm`,variant:`destructive`,className:`w-full`,onClick:()=>{jt(e=>e.filter(e=>String(e.id)!==Qe.edgeId)),tn()},children:`Delete`})]})]})}):null,et?(0,I.jsx)(`div`,{className:`absolute z-50`,style:{left:et.x,top:et.y},"data-context-menu-root":`true`,onMouseDown:e=>e.stopPropagation(),onClick:e=>e.stopPropagation(),onContextMenu:e=>{e.preventDefault(),e.stopPropagation()},children:(0,I.jsxs)(z,{className:`w-60 shadow-lg border bg-background/95 backdrop-blur`,children:[(0,I.jsx)(B,{className:`p-3 pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`Canvas`})}),(0,I.jsxs)(U,{className:`p-3 pt-0 space-y-2`,children:[(0,I.jsx)(R,{size:`sm`,className:`w-full`,onClick:()=>{Zt({position:et.flowPosition}),tn()},children:`Add node`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{$t(),tn()},disabled:Dt.length<2,children:`Auto-layout`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,className:`w-full`,onClick:()=>{ce?.fitView({padding:.15,duration:250}),tn()},disabled:!ce,children:`Fit view`})]})]})}):null]})]})})]}),(0,I.jsxs)(`div`,{className:`space-y-4 overflow-y-auto pr-1`,children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Workflow`})}),(0,I.jsx)(U,{className:`space-y-2`,children:Fn.map(e=>(0,I.jsxs)(`button`,{type:`button`,onClick:()=>p(e.id),className:`w-full rounded-lg border px-3 py-2 text-left transition-colors ${d===e.id?`border-primary/60 bg-primary/5`:`hover:bg-muted/40`}`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:e.title}),(0,I.jsx)(`div`,{className:`rounded-full border px-2 py-0.5 text-[10px] uppercase tracking-wide text-muted-foreground`,children:e.state})]}),(0,I.jsx)(`div`,{className:`mt-1 text-xs text-muted-foreground`,children:e.description})]},e.id))})]}),d===`build`?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-3`,children:(0,I.jsx)(V,{children:`Designer Actions`})}),(0,I.jsxs)(U,{className:`space-y-2`,children:[(0,I.jsxs)(R,{className:`w-full justify-start`,variant:`outline`,size:`sm`,onClick:()=>Ae(!0),children:[(0,I.jsx)(Bt,{className:`mr-2 h-4 w-4`}),`Get started`]}),(0,I.jsxs)(R,{className:`w-full justify-start`,variant:`outline`,size:`sm`,onClick:()=>Se(!0),disabled:!1,children:[(0,I.jsx)(Be,{className:`mr-2 h-4 w-4`}),`Import template`]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-2 gap-2`,children:[(0,I.jsx)(R,{variant:`outline`,size:`sm`,onClick:sn,children:`Load draft`}),(0,I.jsx)(R,{variant:`outline`,size:`sm`,onClick:on,children:`Save draft`})]}),(0,I.jsxs)(R,{className:`w-full justify-start`,variant:`outline`,size:`sm`,onClick:an,children:[(0,I.jsx)(N,{className:`mr-2 h-4 w-4`}),`Download YAML`]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Lab Context`})}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Lab name`}),(0,I.jsx)(J,{value:s,onChange:e=>c(e.target.value)})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`User context`}),(0,I.jsx)(J,{value:`Signed-in user`,readOnly:!0})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Runtime`}),(0,I.jsxs)(Y,{value:l,onValueChange:e=>u(e),children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select runtime`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`netlab-c9s`,children:`Netlab (in-cluster)`}),(0,I.jsx)($,{value:`clabernetes`,children:`Clabernetes (in-cluster)`}),(0,I.jsx)($,{value:`containerlab`,children:`Containerlab (BYOS)`})]})]})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-3`,children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(V,{children:`Generate From Prompt`}),dt?(0,I.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>_t(e=>!e),children:gt?`Hide draft`:`Show draft`}):null]})}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Prompt`}),(0,I.jsx)(kc,{value:it,onChange:e=>ot(e.target.value),placeholder:`Example: Build a 2 spine / 4 leaf EVPN fabric with 1 host per leaf`,className:`h-24`})]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-2 gap-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Preferred NOS`}),(0,I.jsx)(J,{value:st,onChange:e=>ct(e.target.value),placeholder:`eos, iol, nxos...`})]}),(0,I.jsxs)(`div`,{className:`flex items-end justify-between rounded-lg border px-3 py-2`,children:[(0,I.jsx)(`div`,{className:`text-sm`,children:`Include hosts`}),(0,I.jsx)(Gs,{checked:lt,onCheckedChange:e=>ut(!!e)})]})]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsxs)(R,{size:`sm`,onClick:()=>hn.mutate(),disabled:hn.isPending,children:[(0,I.jsx)(de,{className:`mr-2 h-4 w-4`}),hn.isPending?`Generating`:`Generate draft`]}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,onClick:gn,disabled:!dt,children:`Apply draft to canvas`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,onClick:_n,disabled:!dt,children:`Apply draft to YAML`})]}),dt&&gt?(0,I.jsxs)(`div`,{className:`rounded-lg border p-3 space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsx)(R,{size:`sm`,variant:mt===`assumptions`?`default`:`outline`,onClick:()=>ht(`assumptions`),children:`Assumptions`}),(0,I.jsx)(R,{size:`sm`,variant:mt===`spec`?`default`:`outline`,onClick:()=>ht(`spec`),children:`Spec`}),(0,I.jsx)(R,{size:`sm`,variant:mt===`netlab`?`default`:`outline`,onClick:()=>ht(`netlab`),children:`Netlab YAML`}),(0,I.jsx)(R,{size:`sm`,variant:mt===`containerlab`?`default`:`outline`,onClick:()=>ht(`containerlab`),children:`Containerlab YAML`})]}),mt===`assumptions`?(0,I.jsxs)(`div`,{className:`space-y-2 text-xs`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`font-medium`,children:`Assumptions`}),(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:(dt.spec.assumptions??[]).length?(dt.spec.assumptions??[]).join(` | `):`None`})]}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`font-medium`,children:`Warnings`}),(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:(dt.spec.warnings??[]).length?(dt.spec.warnings??[]).join(` | `):`None`})]})]}):(0,I.jsx)(kc,{readOnly:!0,value:mt===`spec`?JSON.stringify(dt.spec,null,2):mt===`netlab`?dt.netlabYaml:dt.containerlabYaml,className:`font-mono text-xs h-[220px]`})]}):null]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Node`})}),(0,I.jsx)(U,{className:`space-y-4`,children:It?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Name`}),(0,I.jsx)(J,{value:String(It.data?.label??It.id),onChange:e=>{let t=e.target.value;Nt(),Ot(e=>e.map(e=>e.id===It.id?{...e,data:{...e.data,label:t}}:e))}})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Kind`}),(0,I.jsx)(J,{value:String(It.data?.kind??``),onChange:e=>{let t=e.target.value;Ot(e=>e.map(e=>e.id===It.id?{...e,data:{...e.data,kind:t}}:e))},placeholder:`linux, ceos, ...`})]}),(0,I.jsx)(eu,{value:String(It.data?.image??``),onChange:e=>{Nt(),Ot(t=>t.map(t=>t.id===It.id?{...t,data:{...t.data,image:e}}:t))}})]}):(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Click a node to edit.`})})]})]}):null,d===`validate`?(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-3`,children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(V,{children:`Validate YAML`}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(R,{size:`sm`,variant:`outline`,onClick:()=>pn.mutate(),disabled:pn.isPending,children:[(0,I.jsx)(_e,{className:`mr-2 h-4 w-4`}),pn.isPending?`Saving`:`Save config`]}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>Wt.mutate(),disabled:Wt.isPending,children:Wt.isPending?`Validating`:`Validate`})]})]})}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Repo path`}),(0,I.jsxs)(`div`,{className:`grid grid-cols-2 gap-2`,children:[(0,I.jsx)(J,{value:x,onChange:e=>ee(e.target.value),placeholder:Tt?`netlab/designer`:`containerlab/designer`}),(0,I.jsx)(J,{value:S,onChange:e=>C(e.target.value),placeholder:Tt?`${s||`lab`}.yml`:`${s||`lab`}.clab.yml`})]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(`${Yt}/${Xt}`),O.success(`Copied path`)},disabled:!1,children:`Copy path`}),(0,I.jsxs)(R,{size:`sm`,variant:`outline`,onClick:Sn,disabled:Tt,children:[(0,I.jsx)(re,{className:`mr-2 h-4 w-4`}),`Open map`]}),(0,I.jsxs)(R,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(Ut),O.success(`Copied YAML`)},children:[(0,I.jsx)(De,{className:`mr-2 h-4 w-4`}),`Copy YAML`]})]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:[Yt,`/`,Xt]})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(R,{size:`sm`,variant:An===`generated`?`default`:`outline`,onClick:()=>{ve(`graph-generated`),bt(null)},disabled:Tt,title:Tt?`Netlab runtime uses editable YAML mode`:void 0,children:`Generated from graph`}),(0,I.jsx)(R,{size:`sm`,variant:An===`custom`?`default`:`outline`,onClick:()=>{ve(`manual-custom`),bt(null),ye.trim()||be(Ut)},children:`Manual YAML`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>Gt.mutate(),disabled:Gt.isPending||Tt,title:Tt?`Auto-fix is only supported for containerlab YAML`:void 0,children:Gt.isPending?`Auto-fixing`:`Auto-fix`})]}),Ht.length||nt&&Vt.length?(0,I.jsxs)(`div`,{className:`rounded-md border bg-amber-500/10 text-amber-900 dark:text-amber-200 px-3 py-2 text-xs`,children:[Ht.slice(0,6).map(e=>(0,I.jsx)(`div`,{children:e},e)),nt?Vt.slice(0,6).map(e=>(0,I.jsx)(`div`,{children:e},e)):null]}):null,Wt.isError?(0,I.jsxs)(`div`,{className:`rounded-md border bg-red-500/10 text-red-900 dark:text-red-200 px-3 py-2 text-xs`,children:[`Validation failed: `,Wt.error.message]}):Wt.isSuccess&&Tt&&Kt.runId?(0,I.jsxs)(`div`,{className:`rounded-md border bg-emerald-500/10 text-emerald-900 dark:text-emerald-200 px-3 py-2 text-xs`,children:[`Netlab validation queued (run `,Kt.runId,`)`]}):Wt.isSuccess&&!Tt&&Kt.ok?(0,I.jsx)(`div`,{className:`rounded-md border bg-emerald-500/10 text-emerald-900 dark:text-emerald-200 px-3 py-2 text-xs`,children:`Valid Containerlab YAML`}):Wt.isSuccess&&!Tt&&Kt.errs.length?(0,I.jsxs)(`div`,{className:`rounded-md border bg-red-500/10 text-red-900 dark:text-red-200 px-3 py-2 text-xs space-y-1`,children:[(0,I.jsx)(`div`,{className:`font-medium`,children:`Invalid Containerlab YAML`}),Kt.errs.slice(0,8).map(e=>(0,I.jsx)(`div`,{children:e},e))]}):null,Gt.isError?(0,I.jsxs)(`div`,{className:`rounded-md border bg-red-500/10 text-red-900 dark:text-red-200 px-3 py-2 text-xs`,children:[`Auto-fix failed: `,Gt.error.message]}):Gt.isSuccess&&!Jt.ok&&Jt.errs.length?(0,I.jsxs)(`div`,{className:`rounded-md border bg-amber-500/10 text-amber-900 dark:text-amber-200 px-3 py-2 text-xs space-y-1`,children:[(0,I.jsx)(`div`,{className:`font-medium`,children:`Auto-fix incomplete (still failing schema)`}),Jt.errs.slice(0,6).map(e=>(0,I.jsx)(`div`,{children:e},e))]}):null,(0,I.jsx)(kc,{value:An===`custom`?ye:Rt,onChange:e=>{be(e.target.value),j!==`manual-custom`&&(ve(`manual-custom`),bt(null))},readOnly:An!==`custom`,className:`font-mono text-xs h-[340px]`})]})]}):null,d===`deploy`?(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Deploy`})}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3 rounded-lg border p-3`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Use saved config`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground truncate`,children:y?.userContextId===`me`?`${y.filePath} (${y.branch})`:`Auto-saves before deploy`})]}),(0,I.jsx)(Gs,{checked:g,onCheckedChange:e=>_(!!e)})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Containerlab server`}),(0,I.jsxs)(Y,{value:m,onValueChange:e=>h(e),disabled:l!==`containerlab`,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:l===`containerlab`?ln.isLoading?`Loading`:`Select server`:`Not required for in-cluster runtimes`})}),(0,I.jsx)(Q,{children:(ln.data?.servers??[]).map(e=>(0,I.jsx)($,{value:`user:${String(e.id)}`,children:lu(e.apiUrl)||e.name},String(e.id)))})]})]}),jn?(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded-lg border px-3 py-2`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Reviewed generated assumptions`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Required before deploying generated YAML`})]}),(0,I.jsx)(Gs,{checked:Mn,onCheckedChange:e=>wt(e?yt:null)})]}):null,(0,I.jsxs)(`div`,{className:`flex items-center justify-between rounded-lg border px-3 py-2`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Open deployment on create`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Keeps the Designer open in this tab.`})]}),(0,I.jsx)(Gs,{checked:Je,onCheckedChange:e=>Ye(!!e)})]}),Nn?(0,I.jsxs)(`div`,{className:`rounded-md border bg-amber-500/10 px-3 py-2 text-xs text-amber-900 dark:text-amber-200`,children:[`Deployment blocked: `,Nn]}):null,(0,I.jsxs)(R,{className:`w-full`,disabled:fn.isPending||!!Nn,onClick:()=>fn.mutate(),children:[(0,I.jsx)(at,{className:`mr-2 h-4 w-4`}),fn.isPending?`Creating`:`Create deployment + deploy`]})]})]}):null]})]}),(0,I.jsx)(Xn,{open:xe,onOpenChange:e=>Se(e),children:(0,I.jsxs)($n,{children:[(0,I.jsxs)(er,{children:[(0,I.jsx)(nr,{children:`Import template`}),(0,I.jsxs)(rr,{children:[`Load an existing `,Tt?`netlab`:`containerlab`,` `,`YAML from templates/blueprints into the editor.`]})]}),(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`grid grid-cols-2 gap-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Source`}),(0,I.jsxs)(Y,{value:Ce,onValueChange:e=>{let t=e;we(t),Ee(Tt?t===`user`?`netlab/designer`:`netlab`:t===`user`?`containerlab/designer`:`containerlab`),M(``)},children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`blueprints`,children:`Blueprints`}),(0,I.jsx)($,{value:`user`,children:`My repo`})]})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Directory`}),(0,I.jsx)(J,{value:Te,onChange:e=>Ee(e.target.value)})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Template`}),(0,I.jsxs)(Y,{value:Oe,onValueChange:e=>M(e),disabled:!1,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:un.isLoading?`Loading`:`Select template`})}),(0,I.jsx)(Q,{children:(un.data?.templates??[]).map(e=>(0,I.jsx)($,{value:e,children:e},e))})]}),un.isError?(0,I.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to list templates`}):null]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Preview`}),(0,I.jsx)(kc,{value:dn.data?.yaml??``,readOnly:!0,placeholder:Oe?dn.isLoading?`Loading preview`:`No preview`:`Select a template to preview`,className:`font-mono text-xs h-[220px]`})]})]}),(0,I.jsxs)(tr,{children:[(0,I.jsx)(R,{variant:`outline`,onClick:()=>Se(!1),children:`Cancel`}),(0,I.jsx)(R,{onClick:()=>mn.mutate(),disabled:mn.isPending||!Oe,children:`Import`})]})]})}),(0,I.jsx)(Xn,{open:ke,onOpenChange:e=>Ae(e),children:(0,I.jsxs)($n,{children:[(0,I.jsxs)(er,{children:[(0,I.jsx)(nr,{children:`Quickstart: Generate CLOS`}),(0,I.jsx)(rr,{children:"Generate a simple leaf/spine fabric (inspired by `clab generate`). This populates the designer canvas; you can edit nodes and YAML afterwards."})]}),(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Lab name`}),(0,I.jsx)(J,{value:je,onChange:e=>Me(e.target.value)})]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-3 gap-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Spines`}),(0,I.jsx)(J,{type:`number`,min:1,max:16,value:Ne,onChange:e=>Pe(Number(e.target.value||0))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Leaves`}),(0,I.jsx)(J,{type:`number`,min:1,max:64,value:Fe,onChange:e=>Ie(Number(e.target.value||0))})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Hosts/leaf`}),(0,I.jsx)(J,{type:`number`,min:0,max:16,value:Le,onChange:e=>Re(Number(e.target.value||0))})]})]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-1 md:grid-cols-2 gap-4`,children:[(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Switch kind`}),(0,I.jsx)(J,{value:ze,onChange:e=>Ve(e.target.value),placeholder:`ceos`})]}),(0,I.jsx)(eu,{value:He,onChange:Ue})]}),(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(q,{children:`Host kind`}),(0,I.jsx)(J,{value:We,onChange:e=>Ge(e.target.value),placeholder:`linux`})]}),(0,I.jsx)(eu,{value:Ke,onChange:qe})]})]})]}),(0,I.jsxs)(tr,{children:[(0,I.jsx)(R,{variant:`outline`,onClick:()=>Ae(!1),children:`Cancel`}),(0,I.jsx)(R,{onClick:Qt,children:`Generate`})]})]})})]})}const _u=t(`/dashboard/fwd/collector`)({component:vu});function vu(){let e=o(),t=W.userForwardCollectorConfigs(),n=W.userForwardCredentialSets(),r=f({queryKey:t,queryFn:_a,refetchInterval:5e3,staleTime:1e4,retry:!1}),a=(0,P.useMemo)(()=>r.data?.collectors??[],[r.data?.collectors]),[s,c]=(0,P.useState)(``),l=f({queryKey:W.userForwardCollectorConfigLogs(s),queryFn:async()=>ba(s,300),enabled:!!s,refetchInterval:s?3e3:!1,retry:!1}),[u,d]=(0,P.useState)(``),[p,h]=(0,P.useState)(!1),[g,_]=(0,P.useState)(!0),[v,y]=(0,P.useState)(``),b=f({queryKey:W.userGitCredentials(),queryFn:Ur,staleTime:6e4,retry:!1}),x=f({queryKey:n,queryFn:Sa,staleTime:3e4,retry:!1}),ee=(0,P.useMemo)(()=>x.data?.credentialSets??[],[x.data?.credentialSets]);(0,P.useEffect)(()=>{v||ee.length!==0&&y(String(ee[0]?.id??``))},[v,ee]);let S=(0,P.useMemo)(()=>v?ee.find(e=>String(e.id)===String(v))??null:null,[ee,v]);(0,P.useEffect)(()=>{},[S]),(0,P.useEffect)(()=>{if(p||u.trim())return;let e=(b.data?.username??``).trim();e&&d(`skyforge-${e}`)},[p,u,b.data?.username]);let C=i({mutationFn:async()=>{let e=u.trim();if(!e)throw Error(`Collector name is required`);if(!S)throw Error(`Select a credential set in Settings`);if(!S.hasPassword)throw Error(`Selected credential set has no stored password`);let t=String(S?.baseUrl??``).trim()||`https://fwd.app`;if(!t)throw Error(`Forward URL is required`);return va({name:e,baseUrl:t,skipTlsVerify:!!S.skipTlsVerify,username:``,password:``,setDefault:g,sourceCredentialId:S.id})},onSuccess:async()=>{O.success(`Collector created`),await e.invalidateQueries({queryKey:t})},onError:e=>O.error(`Failed to create collector`,{description:e.message})}),w=i({mutationFn:async e=>xa(e),onSuccess:async()=>{O.success(`Collector restarted`),await e.invalidateQueries({queryKey:t})},onError:e=>O.error(`Failed to restart collector`,{description:e.message})}),te=i({mutationFn:async e=>ya(e),onSuccess:async(n,r)=>{O.success(`Collector deleted`),c(``),e.setQueryData(t,e=>{let t=e?.collectors??[];return{...e??{},collectors:t.filter(e=>String(e?.id??``)!==String(r))}}),await e.invalidateQueries({queryKey:t})},onError:e=>O.error(`Failed to delete collector`,{description:e.message})}),T=i({mutationFn:async e=>{for(let t of e)await ya(t)},onSuccess:async()=>{O.success(`Collectors deleted`),c(``),e.setQueryData(t,e=>({...e??{},collectors:[]})),await e.invalidateQueries({queryKey:t})},onError:e=>O.error(`Failed to delete collectors`,{description:e.message})});return(0,I.jsxs)(`div`,{className:`p-6 space-y-6`,children:[(0,I.jsx)(`div`,{className:`flex items-start justify-between gap-4`,children:(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold`,children:`Collector`}),(0,I.jsx)(`p`,{className:`text-sm text-muted-foreground mt-1`,children:`Create one or more per-user in-cluster Forward collectors. Select a collector per deployment.`})]})}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Create collector`}),(0,I.jsx)(H,{children:`Creates a Forward collector and deploys a matching in-cluster Deployment. Deleting here only deletes the in-cluster Deployment and the saved credentials; it does not delete the Forward-side collector.`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Credential set`}),(0,I.jsxs)(Y,{value:v||`__none__`,onValueChange:e=>y(e===`__none__`?``:e),children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select a credential set`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`__none__`,children:`(Select)`}),ee.map(e=>(0,I.jsxs)($,{value:e.id,children:[e.name,e.username?` (${e.username})`:``]},e.id))]})]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Manage credential sets in`,` `,(0,I.jsx)(m,{className:`underline`,to:`/dashboard/settings`,hash:`forward-account`,children:`Settings`}),`.`]}),x.isError?(0,I.jsxs)(`p`,{className:`text-xs text-destructive`,children:[`Failed to load credential sets:`,` `,x.error.message]}):null]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Collector name`}),(0,I.jsx)(J,{value:u,onChange:e=>{h(!0),d(e.target.value)},placeholder:`skyforge-yourname`})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(Us,{checked:g,onCheckedChange:e=>_(!!e)}),(0,I.jsx)(q,{className:`text-sm`,children:`Make default`})]}),(0,I.jsx)(R,{onClick:()=>C.mutate(),disabled:C.isPending||!S||!S.hasPassword,children:C.isPending?`Creating`:`Create`})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-4`,children:[(0,I.jsx)(V,{children:`Configured collectors`}),a.length>0?(0,I.jsx)(R,{variant:`destructive`,size:`sm`,disabled:T.isPending,onClick:()=>{let e=a.map(e=>String(e.id)).filter(Boolean);e.length!==0&&confirm(`Delete ${e.length} collector(s)? This removes in-cluster Deployments and saved credentials.`)&&T.mutate(e)},children:T.isPending?`Deleting`:`Delete all`}):null]}),(0,I.jsx)(H,{children:`Each entry maps to one in-cluster Deployment and one Forward collector.`})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[r.isLoading?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading`}):null,r.isError?(0,I.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load collectors.`}):a.length===0?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No collectors configured yet.`}):null,a.map(e=>{let t=!!e.runtime?.ready,n=typeof e.forwardCollector?.connected==`boolean`?e.forwardCollector.connected:void 0;return(0,I.jsxs)(`div`,{className:`rounded-md border p-3 space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2 min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-medium truncate`,children:e.name}),e.isDefault?(0,I.jsx)(K,{variant:`secondary`,children:`default`}):null,e.decryptionFailed?(0,I.jsx)(K,{variant:`destructive`,children:`re-save creds`}):null]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:e.id})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>c(t=>t===e.id?``:e.id),children:s===e.id?`Hide logs`:`Logs`}),(0,I.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>w.mutate(e.id),disabled:w.isPending,children:`Restart`}),(0,I.jsx)(R,{variant:`destructive`,size:`sm`,onClick:()=>{confirm(`Delete collector "${e.name}"?`)&&te.mutate(e.id)},disabled:te.isPending,children:`Delete`})]})]}),(0,I.jsxs)(`div`,{className:`text-sm`,children:[`Status:`,` `,(0,I.jsx)(`span`,{className:t?`text-emerald-600`:`text-muted-foreground`,children:t?`Running`:`Starting`})]}),(0,I.jsxs)(`div`,{className:`text-sm`,children:[`Forward:`,` `,typeof n==`boolean`?(0,I.jsx)(`span`,{className:n?`text-emerald-600`:`text-muted-foreground`,children:n?`Connected`:`Not connected`}):(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:`Unknown`})]}),e.forwardCollector?.version?(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Version:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:String(e.forwardCollector.version)})]}):null,e.forwardCollector?.updateStatus?(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Update:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:String(e.forwardCollector.updateStatus)})]}):null,e.forwardCollector?.externalIp?(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`External IP:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:String(e.forwardCollector.externalIp)})]}):null,Array.isArray(e.forwardCollector?.internalIps)&&(e.forwardCollector?.internalIps??[]).length>0?(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Internal IPs:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:(e.forwardCollector?.internalIps??[]).filter(Boolean).join(`, `)})]}):null,e.runtime?.podName?(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Pod:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:String(e.runtime.podName)}),` `,`(`,String(e.runtime.podPhase??``),`)`]}):null,s===e.id?(0,I.jsx)(`pre`,{className:`bg-muted p-3 rounded-md overflow-auto font-mono text-xs whitespace-pre-wrap`,children:l.isLoading?`Loading`:(l.data?.logs??``).trim()||`No logs yet.`}):null]},e.id)})]})]})]})}var yu=[{slug:`getting-started`,title:`Getting started`,content:(0,I.jsxs)(`div`,{className:`space-y-4 text-sm`,children:[(0,I.jsx)(`p`,{children:`Skyforge is optimized for a happy path workflow. You can still run tools manually, but the goal is to make repeatable automation the default.`}),(0,I.jsxs)(`ol`,{className:`list-decimal pl-5 space-y-2`,children:[(0,I.jsxs)(`li`,{children:[`Go to`,` `,(0,I.jsx)(m,{className:`underline`,to:`/dashboard/settings`,children:`My Settings`}),` `,`and configure:`,(0,I.jsxs)(`ul`,{className:`list-disc pl-5 mt-2 space-y-1`,children:[(0,I.jsx)(`li`,{children:`External template repos (optional)`}),(0,I.jsx)(`li`,{children:`BYOL servers (optional)`}),(0,I.jsx)(`li`,{children:`Collector + integrations (optional)`})]})]}),(0,I.jsxs)(`li`,{children:[`Create a deployment from`,` `,(0,I.jsx)(m,{className:`underline`,to:`/dashboard/deployments/new`,children:`Create deployment`}),`.`]}),(0,I.jsxs)(`li`,{children:[`Use `,(0,I.jsx)(`span`,{className:`font-mono`,children:`Validate`}),` before starting, especially when overriding env vars.`]})]})]})},{slug:`my-settings`,title:`My Settings`,content:(0,I.jsxs)(`div`,{className:`space-y-4 text-sm`,children:[(0,I.jsxs)(`p`,{children:[`The current model is`,` `,(0,I.jsx)(`strong`,{children:`per-user settings applied to deployments`}),` with a personal account.`]}),(0,I.jsxs)(`ul`,{className:`list-disc pl-5 space-y-2`,children:[(0,I.jsxs)(`li`,{children:[(0,I.jsx)(`strong`,{children:`Defaults`}),`: environment variables applied to new deployments.`]}),(0,I.jsxs)(`li`,{children:[(0,I.jsx)(`strong`,{children:`External Template Repos`}),`: add Git repos once and reuse them across deployments.`]}),(0,I.jsxs)(`li`,{children:[(0,I.jsx)(`strong`,{children:`BYOL Servers`}),`: register Netlab / Containerlab / EVE-NG servers (using `,(0,I.jsx)(`span`,{className:`font-mono`,children:`user:`}),` `,`refs).`]}),(0,I.jsxs)(`li`,{children:[(0,I.jsx)(`strong`,{children:`Cloud credentials`}),`: stored per-user; UI only shows configured status.`]})]})]})},{slug:`deployments`,title:`Deployments`,content:(0,I.jsxs)(`div`,{className:`space-y-4 text-sm`,children:[(0,I.jsx)(`p`,{children:`Deployments are created from templates and then executed as runs. Template validation should use the same env overrides youll apply at runtime.`}),(0,I.jsxs)(`ul`,{className:`list-disc pl-5 space-y-2`,children:[(0,I.jsxs)(`li`,{children:[`Use the `,(0,I.jsx)(`span`,{className:`font-mono`,children:`View`}),` button to inspect a selected template.`]}),(0,I.jsxs)(`li`,{children:[`Use `,(0,I.jsx)(`span`,{className:`font-mono`,children:`Validate`}),` to catch obvious netlab errors early.`]})]})]})},{slug:`servicenow`,title:`ServiceNow demo workflow`,content:(0,I.jsxs)(`div`,{className:`space-y-4 text-sm`,children:[(0,I.jsx)(`p`,{children:`This workflow installs a demo app into a ServiceNow PDI. The demo app calls Forward SaaS directly; Skyforge only installs/configures ServiceNow resources.`}),(0,I.jsxs)(`ol`,{className:`list-decimal pl-5 space-y-2`,children:[(0,I.jsx)(`li`,{children:`Create (and wake) a PDI from ServiceNow developer portal.`}),(0,I.jsxs)(`li`,{children:[`In Skyforge, open`,` `,(0,I.jsx)(m,{className:`underline`,to:`/dashboard/servicenow`,children:`ServiceNow`}),` `,`and save your instance URL + admin credentials.`]}),(0,I.jsxs)(`li`,{children:[`Click `,(0,I.jsx)(`strong`,{children:`Install demo app`}),`.`]}),(0,I.jsx)(`li`,{children:`If schema setup is required, create the required tables in ServiceNow Studio (first time per PDI), then re-run install.`})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-3 text-xs text-muted-foreground`,children:[(0,I.jsx)(`div`,{className:`font-medium text-foreground`,children:`Where to find the demo`}),(0,I.jsxs)(`ul`,{className:`mt-2 list-disc space-y-1 pl-5`,children:[(0,I.jsxs)(`li`,{children:[`In ServiceNow App Navigator, search for`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`Forward Connectivity Ticket`}),`.`]}),(0,I.jsxs)(`li`,{children:[`Portal page:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`/sp?id=connectivity_ticket`})]}),(0,I.jsxs)(`li`,{children:[`Widget name:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`Connectivity Ticket Analyzer`})]})]})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-3 text-xs text-muted-foreground`,children:[(0,I.jsx)(`div`,{className:`font-medium text-foreground`,children:`Schema (tables)`}),(0,I.jsx)(`p`,{className:`mt-2`,children:`Skyforge prefers the simplest global table names. Create these two tables (once per PDI) and then re-run install:`}),(0,I.jsxs)(`ul`,{className:`mt-2 list-disc space-y-1 pl-5`,children:[(0,I.jsx)(`li`,{children:(0,I.jsx)(`span`,{className:`font-mono`,children:`u_forward_connectivity_ticket`})}),(0,I.jsx)(`li`,{children:(0,I.jsx)(`span`,{className:`font-mono`,children:`u_forward_connectivity_hop`})})]}),(0,I.jsx)(`p`,{className:`mt-2`,children:`To create the tables in ServiceNow:`}),(0,I.jsxs)(`ol`,{className:`mt-2 list-decimal space-y-1 pl-5`,children:[(0,I.jsxs)(`li`,{children:[`Open `,(0,I.jsx)(`span`,{className:`font-medium`,children:`App Navigator`}),` and search for `,(0,I.jsx)(`span`,{className:`font-mono`,children:`Tables`}),` (System Definition).`]}),(0,I.jsxs)(`li`,{children:[`Click `,(0,I.jsx)(`span`,{className:`font-medium`,children:`New`}),`.`]}),(0,I.jsxs)(`li`,{children:[`For the ticket table, set the`,` `,(0,I.jsx)(`span`,{className:`font-medium`,children:`Label`}),` to`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`Forward Connectivity Ticket`}),` `,`(leave the `,(0,I.jsx)(`span`,{className:`font-medium`,children:`Name`}),` blank so ServiceNow derives`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`u_forward_connectivity_ticket`}),`). Set `,(0,I.jsx)(`span`,{className:`font-medium`,children:`Extends table`}),` to`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`task`}),`.`]}),(0,I.jsxs)(`li`,{children:[`For the hop table, set the`,` `,(0,I.jsx)(`span`,{className:`font-medium`,children:`Label`}),` to`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`Forward Connectivity Hop`}),` (leave Name blank so it becomes`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`u_forward_connectivity_hop`}),`).`]})]}),(0,I.jsx)(`p`,{className:`mt-2`,children:`After the tables exist, Skyforge auto-creates required fields and choice lists via Table API.`})]})]})}];const bu=t(`/dashboard/docs/$slug`)({component:xu});function xu(){let{slug:e}=bu.useParams(),t=yu.find(t=>t.slug===e);return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(`div`,{className:`flex items-center gap-3`,children:(0,I.jsxs)(m,{to:`/dashboard/docs`,className:`inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground`,children:[(0,I.jsx)(it,{className:`h-4 w-4`}),`Back to Docs`]})}),(0,I.jsxs)(z,{variant:`glass`,children:[(0,I.jsx)(B,{children:(0,I.jsxs)(V,{className:`flex items-center gap-2`,children:[(0,I.jsx)(cn,{className:`h-5 w-5`}),t?.title??`Page not found`]})}),(0,I.jsx)(U,{children:t?t.content:(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`This doc page doesnt exist.`})})]})]})}var Su=Xt,Cu=un,wu=Ft,Tu=P.forwardRef(({className:e,sideOffset:t=4,...n},r)=>(0,I.jsx)(gn,{ref:r,sideOffset:t,className:F(`z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2`,e),...n}));Tu.displayName=gn.displayName;var Eu=qn({});const Du=t(`/dashboard/deployments/new`)({validateSearch:e=>Eu.parse(e),component:Au});var Ou=qn({name:Hn().min(1,`Deployment name is required`).max(100),kind:Gn([`netlab-c9s`,`netlab`,`containerlab`,`clabernetes`,`terraform`,`eve_ng`]),source:Gn([`user`,`blueprints`,`external`]),templateRepoId:Hn().optional(),template:Hn().min(1,`Template is required`),netlabServer:Hn().optional(),eveServer:Hn().optional(),forwardCollectorId:Hn().optional(),variableGroupId:Hn().optional(),env:Vn(qn({key:Hn(),value:Hn()})).optional()});function ku(e){let t=String(e??``).trim();if(!t)return``;try{return new URL(t).hostname||t}catch{return t.replace(/^https?:\/\//,``).split(`/`)[0]??t}}function Au(){let e=c(),t=o();Du.useSearch();let[n,r]=(0,P.useState)(!1),[a,s]=(0,P.useState)(!1),[l,u]=(0,P.useState)(`all`),[d,p]=(0,P.useState)(!1),[m,h]=(0,P.useState)(``),[g,_]=(0,P.useState)(``),[y,b]=(0,P.useState)(``),[x,ee]=(0,P.useState)(!1),[S,C]=(0,P.useState)(``);ml(!0);let w=f({queryKey:W.dashboardSnapshot(),queryFn:yr,initialData:()=>t.getQueryData(W.dashboardSnapshot())??null,retry:!1,staleTime:1/0}),te=f({queryKey:W.userSettings(),queryFn:Wr,staleTime:3e4,retry:!1}),T=Mn({resolver:Mt(Ou),defaultValues:{name:``,kind:`netlab-c9s`,source:`user`,templateRepoId:``,template:``,netlabServer:``,eveServer:``,forwardCollectorId:`none`,variableGroupId:`none`,env:[]}}),{watch:E,setValue:D,control:ne}=T,{fields:re,append:k,remove:ie}=Cn({control:ne,name:`env`});(0,P.useEffect)(()=>{let e=te.data?.defaultEnv??[];e.length&&((T.getValues(`env`)??[]).length||D(`env`,e,{shouldDirty:!1,shouldTouch:!1,shouldValidate:!0}))},[te.data?.defaultEnv,T,D]);let A=E(`kind`),ae=E(`source`),oe=E(`templateRepoId`),se=E(`template`);E(`name`);let ce=E(`forwardCollectorId`);E(`env`);let le=w.data?.templatesIndexUpdatedAt??``;(0,P.useEffect)(()=>{D(`name`,`${(se||A).split(`/`).pop()||A}-${new Date().toISOString().replace(/[-:]/g,``).replace(/\..+/,``).slice(0,15)}`)},[se,A,D]);let ue=f({queryKey:W.userNetlabServers(),queryFn:mi,staleTime:3e4,retry:!1}),de=f({queryKey:W.userContainerlabServers(),queryFn:bi,staleTime:3e4,retry:!1}),fe=f({queryKey:W.userEveServers(),queryFn:_i,staleTime:3e4,retry:!1}),pe=f({queryKey:W.userEveLabs(`me`,m,``,!0),queryFn:()=>wr(`me`,{server:m,recursive:!0}),enabled:!!(d&&m),staleTime:3e4,retry:!1}),me=f({queryKey:W.userVariableGroups(),queryFn:io,staleTime:3e4}),he=f({queryKey:W.userForwardCollectorConfigs(),queryFn:_a,enabled:[`netlab-c9s`,`clabernetes`,`terraform`].includes(A),staleTime:3e4,retry:!1}),ge=(0,P.useMemo)(()=>(he.data?.collectors??[]).filter(e=>e&&typeof e.id==`string`&&typeof e.name==`string`).filter(e=>!e.decryptionFailed),[he.data?.collectors]);(0,P.useEffect)(()=>{if(![`netlab-c9s`,`clabernetes`,`terraform`].includes(A)){(ce??`none`)!==`none`&&D(`forwardCollectorId`,`none`);return}if((ce??`none`)!==`none`)return;let e=String(te.data?.defaultForwardCollectorConfigId??``).trim(),t=(e?ge.find(t=>t.id===e):null)??ge.find(e=>e.isDefault)??ge[0];t?.id&&D(`forwardCollectorId`,String(t.id))},[A,ce,ge,D,te.data?.defaultForwardCollectorConfigId]);let _e=(0,P.useMemo)(()=>A===`netlab`||A===`netlab-c9s`?ae===`user`?`user`:`blueprints`:A===`eve_ng`?`blueprints`:A===`containerlab`||A===`clabernetes`||A===`terraform`?ae:`user`,[A,ae]),j=f({queryKey:W.userTemplates(`me`,A,_e,oe||void 0,void 0),enabled:!0,queryFn:async()=>{let e={source:_e};switch(_e===`external`&&oe&&(e.repo=oe),A){case`netlab`:case`netlab-c9s`:return na(`me`,e);case`eve_ng`:return ca(`me`,e);case`containerlab`:case`clabernetes`:return aa(`me`,e);case`terraform`:return oa(`me`,e);default:return na(`me`,e)}},staleTime:5*6e4,refetchOnWindowFocus:!1});(0,P.useEffect)(()=>{le&&t.invalidateQueries({queryKey:[`userTemplates`]})},[le,t]);let ve=(0,P.useMemo)(()=>{let e=j.data?.templates??[];if(A!==`terraform`)return e;let t=String(l??`all`).trim().toLowerCase();return!t||t===`all`?e:e.filter(e=>String(e).toLowerCase().startsWith(`${t}/`)||String(e).toLowerCase()===t)},[j.data?.templates,l,A]),ye=(0,P.useMemo)(()=>{if(A!==`terraform`)return[];let e=j.data?.templates??[],t=new Set;for(let n of e){let e=String(n??``).split(`/`)[0]?.trim();e&&t.add(e)}return Array.from(t).sort((e,t)=>e.localeCompare(t))},[j.data?.templates,A]);(0,P.useEffect)(()=>{if(A!==`terraform`){u(`all`);return}l!==`all`&&!ye.includes(l)&&u(`all`)},[l,ye,A]);let be=f({queryKey:[`userTemplate`,A,`me`,_e,oe,j.data?.dir,se],queryFn:async()=>{if(!se)throw Error(`template is required`);let e={source:_e};return _e===`external`&&oe&&(e.repo=oe),j.data?.dir&&(e.dir=j.data.dir),A===`containerlab`||A===`clabernetes`?sa(`me`,{...e,file:se}):ra(`me`,{...e,template:se})},enabled:n&&!!se&&(A===`netlab`||A===`netlab-c9s`||A===`containerlab`||A===`clabernetes`),retry:!1,staleTime:3e4}),xe=(te.data?.externalTemplateRepos??[]).filter(e=>!!e&&typeof e.id==`string`&&typeof e.repo==`string`),Se=xe.length>0,Ce=i({mutationFn:async e=>{let t={template:e.template};if(e.variableGroupId&&e.variableGroupId!==`none`&&(t.envGroupIds=[Number.parseInt(e.variableGroupId,10)],t.envGroupScope=`user`),e.env&&e.env.length>0){let n={};for(let t of e.env)t.key.trim()&&(n[t.key.trim()]=t.value);Object.keys(n).length>0&&(t.environment=n)}if([`netlab-c9s`,`clabernetes`,`terraform`].includes(e.kind)){let n=String(e.forwardCollectorId??`none`).trim();n&&n!==`none`&&(t.forwardEnabled=!0,t.forwardCollectorId=n)}if(e.kind===`netlab`||e.kind===`containerlab`){let n=(e.netlabServer||``).trim();if(!n)throw Error(`BYOS server is required`);t.netlabServer=n,t.templateSource=_e,_e===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),j.data?.dir&&(t.templatesDir=j.data.dir)}if(e.kind===`netlab-c9s`&&(t.templateSource=_e,_e===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),j.data?.dir&&(t.templatesDir=j.data.dir)),e.kind===`clabernetes`&&(t.templateSource=_e,_e===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),j.data?.dir&&(t.templatesDir=j.data.dir)),e.kind===`terraform`&&(t.templateSource=_e,_e===`external`&&e.templateRepoId&&(t.templateRepo=e.templateRepoId),j.data?.dir&&(t.templatesDir=j.data.dir)),e.kind===`eve_ng`){t.templateSource=`blueprints`,j.data?.dir&&(t.templatesDir=j.data.dir);let n=(e.eveServer||``).trim();if(!n)throw Error(`EVE-NG server is required`);t.eveServer=n}return la(`me`,{name:e.name,type:e.kind,config:t})},onSuccess:async(n,r)=>{O.success(`Deployment created successfully`,{description:`${r.name} is now queued for provisioning.`}),await t.invalidateQueries({queryKey:W.dashboardSnapshot()}),await e({to:`/dashboard/deployments`})},onError:e=>{O.error(`Failed to create deployment`,{description:e.message})}}),we=i({mutationFn:async()=>{let e=m.trim();if(!e)throw Error(`Select an EVE-NG server.`);let t=g.trim();if(!t)throw Error(`Select an EVE-NG lab.`);return Tr(`me`,{server:e,labPath:t,deploymentName:y.trim()||void 0})},onSuccess:async n=>{O.success(`EVE-NG lab imported`,{description:n?.name??`Deployment created.`}),await t.invalidateQueries({queryKey:W.dashboardSnapshot()}),p(!1),await e({to:`/dashboard/deployments`})},onError:e=>{O.error(`Failed to import EVE-NG lab`,{description:e.message})}}),Te=i({mutationFn:async()=>{let e=m.trim();if(!e)throw Error(`Select an EVE-NG server.`);let t=g.trim();if(!t)throw Error(`Select an EVE-NG lab.`);let n=x,r=S.trim();if(n&&!r)throw Error(`Select a Containerlab server.`);return Er(`me`,{server:e,labPath:t,createDeployment:n,containerlabServer:n?r:void 0})},onSuccess:async n=>{let r=n?.warnings??[];O.success(`Containerlab template created`,{description:n?.path??`Template saved.`}),r.length>0&&O.message(`Conversion warnings`,{description:r.slice(0,3).join(` | `)}),await t.invalidateQueries({queryKey:W.dashboardSnapshot()}),p(!1),n?.deployment&&await e({to:`/dashboard/deployments`})},onError:e=>{O.error(`Failed to convert EVE-NG lab`,{description:e.message})}}),Ee=i({mutationFn:async()=>{if(!se)throw Error(`Select a template first.`);let e=new Map;for(let t of T.getValues(`env`)||[]){let n=(t?.key??``).trim();n&&e.set(n,String(t?.value??``))}let t=String(T.getValues(`variableGroupId`)??`none`),n=t===`none`?null:Number(t),r={...(n?Ae.find(e=>e.id===n)?.variables:void 0)??{}};for(let[t,n]of e.entries())r[t]=n;let i={source:_e,template:se,environment:r};return _e===`external`&&oe&&(i.repo=oe),j.data?.dir&&(i.dir=j.data.dir),ia(`me`,i)},onSuccess:async t=>{let n=String(t?.task?.id??t?.task?.task_id??``).trim();O.success(`Validation queued`,{description:n?`Run ${n} started.`:`Validation run started.`}),n&&e({to:`/dashboard/runs/$runId`,params:{runId:n}})},onError:e=>{O.error(`Validation failed`,{description:String(e?.message??e)})}});function De(e){Ce.mutate(e)}let Oe=ue.data?.servers??[],M=de.data?.servers??[],ke=fe.data?.servers??[],Ae=me.data?.groups??[],je=Oe.length>0,Me=M.length>0,Ne=ke.length>0;(0,P.useEffect)(()=>{d&&!m&&ke.length>0&&h(`user:${ke[0].id}`)},[d,m,ke]),(0,P.useEffect)(()=>{d&&_(``)},[d,m]),(0,P.useEffect)(()=>{!d||!x||!S&&M.length>0&&C(`user:${M[0].id}`)},[d,x,S,M]);let Pe=(0,P.useMemo)(()=>Oe.filter(e=>!!e?.id).map(e=>({value:`user:${e.id}`,label:ku(e.apiUrl)||e.name})),[Oe]),Fe=(0,P.useMemo)(()=>M.filter(e=>!!e?.id).map(e=>({value:`user:${e.id}`,label:ku(e.apiUrl)||e.name})),[M]),Ie=(0,P.useMemo)(()=>(pe.data?.labs??[]).map(e=>({value:e.path,label:e.folder?`${e.folder}/${e.name}`:e.name})).sort((e,t)=>e.label.localeCompare(t.label)),[pe.data?.labs]),Le=A===`netlab`?Pe:A===`containerlab`?Fe:[];return(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsx)(z,{variant:`glass`,children:(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(V,{children:`Create deployment`}),(0,I.jsx)(H,{children:`Configure and launch a new infrastructure deployment.`})]}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>e({to:`/dashboard/deployments`}),children:`Cancel`})]})})}),Ne&&A===`eve_ng`&&(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Import from EVE-NG`}),(0,I.jsx)(H,{children:`Register an existing EVE-NG lab as a deployment or convert it into a Containerlab template.`})]}),(0,I.jsxs)(U,{className:`flex flex-wrap items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Select an EVE-NG lab and import it into Skyforge without rebuilding the topology.`}),(0,I.jsxs)(R,{type:`button`,variant:`outline`,onClick:()=>p(!0),children:[(0,I.jsx)(N,{className:`mr-2 h-4 w-4`}),`Import EVE-NG lab`]})]})]}),(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`pt-6`,children:(0,I.jsx)(yc,{...T,children:(0,I.jsxs)(`form`,{onSubmit:T.handleSubmit(De),className:`space-y-8`,children:[(0,I.jsxs)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:[(0,I.jsx)(xc,{control:T.control,name:`kind`,render:({field:e})=>(0,I.jsxs)(wc,{children:[(0,I.jsx)(Tc,{children:`Provider`}),(0,I.jsxs)(Y,{onValueChange:t=>{e.onChange(t),T.setValue(`template`,``)},defaultValue:e.value,children:[(0,I.jsx)(Ec,{children:(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select provider`})})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`netlab-c9s`,children:`Netlab`}),je&&(0,I.jsx)($,{value:`netlab`,children:`Netlab (BYOS)`}),Ne&&(0,I.jsx)($,{value:`eve_ng`,children:`EVE-NG`}),Me&&(0,I.jsx)($,{value:`containerlab`,children:`Containerlab (BYOS)`}),(0,I.jsx)($,{value:`clabernetes`,children:`Containerlab`}),(0,I.jsx)($,{value:`terraform`,children:`Terraform`})]})]}),(0,I.jsx)(Oc,{})]})}),[`netlab-c9s`,`clabernetes`,`terraform`].includes(A)&&(0,I.jsx)(xc,{control:T.control,name:`forwardCollectorId`,render:({field:e})=>(0,I.jsxs)(wc,{className:`rounded-md border p-3 md:col-span-2 space-y-2`,children:[(0,I.jsx)(Tc,{children:`Forward collector`}),(0,I.jsxs)(Dc,{children:[`Optional. Select a per-user in-cluster Collector. Configure collectors under`,` `,(0,I.jsx)(`code`,{className:`font-mono`,children:`Dashboard  Forward`}),`.`]}),he.isError?(0,I.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to load collectors.`}):null,he.data&&ge.length===0?(0,I.jsx)(`div`,{className:`text-xs text-destructive`,children:`No collectors configured yet.`}):null,(0,I.jsxs)(Y,{value:String(e.value??`none`),onValueChange:t=>e.onChange(t),disabled:he.isLoading,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select a collector (or None)`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`none`,children:`None`}),ge.map(e=>(0,I.jsx)($,{value:String(e.id),children:String(e.name)},String(e.id)))]})]})]})}),(0,I.jsx)(xc,{control:T.control,name:`source`,render:({field:e})=>(0,I.jsxs)(wc,{children:[(0,I.jsxs)(Tc,{className:`flex items-center gap-2`,children:[`Template source`,(0,I.jsx)(Su,{children:(0,I.jsxs)(Cu,{children:[(0,I.jsx)(wu,{asChild:!0,children:(0,I.jsx)(Nt,{className:`h-4 w-4 text-muted-foreground`})}),(0,I.jsx)(Tu,{children:(0,I.jsx)(`p`,{children:`Git repository or URL containing deployment templates`})})]})})]}),(0,I.jsxs)(Y,{onValueChange:t=>{e.onChange(t),T.setValue(`templateRepoId`,``),T.setValue(`template`,``)},defaultValue:e.value,children:[(0,I.jsx)(Ec,{children:(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select source`})})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`user`,children:`My repo`}),(0,I.jsx)($,{value:`blueprints`,children:`Blueprints`}),(0,I.jsx)($,{value:`external`,disabled:!Se||A!==`containerlab`&&A!==`clabernetes`&&A!==`terraform`,children:`External repo`})]})]}),!Se&&(A===`containerlab`||A===`clabernetes`||A===`terraform`)&&(0,I.jsx)(Dc,{children:`No external repos configured in My Settings.`}),(0,I.jsx)(Oc,{})]})}),_e===`external`&&(0,I.jsx)(xc,{control:T.control,name:`templateRepoId`,render:({field:e})=>(0,I.jsxs)(wc,{children:[(0,I.jsx)(Tc,{children:`External repo`}),(0,I.jsxs)(Y,{onValueChange:t=>{e.onChange(t),T.setValue(`template`,``)},defaultValue:e.value,children:[(0,I.jsx)(Ec,{children:(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select repo`})})}),(0,I.jsx)(Q,{children:xe.map(e=>(0,I.jsxs)($,{value:e.id,children:[e.name,` (`,e.repo,`)`]},e.id))})]}),(0,I.jsx)(Oc,{})]})}),(A===`netlab`||A===`containerlab`)&&(0,I.jsx)(xc,{control:T.control,name:`netlabServer`,render:({field:e})=>(0,I.jsxs)(wc,{children:[(0,I.jsx)(Tc,{children:`BYOS server`}),(0,I.jsxs)(Y,{onValueChange:e.onChange,defaultValue:e.value||``,value:e.value||``,children:[(0,I.jsx)(Ec,{children:(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select server`})})}),(0,I.jsx)(Q,{children:Le.map(e=>(0,I.jsx)($,{value:e.value,children:e.label},e.value))})]}),(ue.isLoading||de.isLoading)&&(0,I.jsx)(Dc,{children:`Loading servers`}),(0,I.jsxs)(Dc,{children:[`Configure servers under`,` `,(0,I.jsx)(`code`,{className:`font-mono`,children:`Dashboard  Settings`}),`.`]}),(0,I.jsx)(Oc,{})]})}),A===`eve_ng`&&(0,I.jsx)(xc,{control:T.control,name:`eveServer`,render:({field:e})=>(0,I.jsxs)(wc,{children:[(0,I.jsx)(Tc,{children:`EVE-NG server`}),(0,I.jsxs)(Y,{onValueChange:e.onChange,defaultValue:e.value||``,value:e.value||``,children:[(0,I.jsx)(Ec,{children:(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select server`})})}),(0,I.jsx)(Q,{children:ke.map(e=>(0,I.jsx)($,{value:`user:${e.id}`,children:ku(e.apiUrl)||e.name},e.id))})]}),fe.isLoading&&(0,I.jsx)(Dc,{children:`Loading servers`}),(0,I.jsxs)(Dc,{children:[`Configure servers under`,` `,(0,I.jsx)(`code`,{className:`font-mono`,children:`Dashboard  Settings`}),`.`]}),(0,I.jsx)(Oc,{})]})}),(0,I.jsx)(xc,{control:T.control,name:`template`,render:({field:e})=>(0,I.jsxs)(wc,{children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(Tc,{children:`Template`}),(A===`netlab`||A===`netlab-c9s`||A===`containerlab`||A===`clabernetes`)&&(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(R,{type:`button`,variant:`outline`,size:`sm`,disabled:!se,onClick:()=>r(!0),children:`View`}),A===`netlab`||A===`netlab-c9s`?(0,I.jsx)(R,{type:`button`,variant:`outline`,size:`sm`,disabled:!se||Ee.isPending,onClick:()=>Ee.mutate(),children:Ee.isPending?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(Gt,{className:`mr-2 h-3 w-3 animate-spin`}),` `,`Validating`]}):`Validate`}):null]})]}),A===`terraform`?(0,I.jsxs)(`div`,{className:`grid gap-2 rounded-md border p-3`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Terraform templates are grouped by provider (folder name). Select a provider to filter the template list.`}),(0,I.jsxs)(Y,{value:l,onValueChange:e=>u(e),disabled:j.isLoading||ye.length===0&&ve.length===0,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Provider filter`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All providers`}),ye.map(e=>(0,I.jsx)($,{value:e,children:e},e)),(0,I.jsx)($,{value:`ibm`,disabled:!0,children:`ibm (coming soon)`})]})]})]}):null,(0,I.jsxs)(Y,{onValueChange:e.onChange,defaultValue:e.value,disabled:j.isLoading||ve.length===0,children:[(0,I.jsx)(Ec,{children:(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:j.isLoading?`Loading`:ve.length?`Select template`:`No templates`})})}),(0,I.jsx)(Q,{children:ve.map(e=>(0,I.jsx)($,{value:e,children:e},e))})]}),j.isError&&(0,I.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to load templates.`}),(0,I.jsx)(Oc,{})]})}),(0,I.jsx)(xc,{control:T.control,name:`name`,render:({field:e})=>(0,I.jsxs)(wc,{children:[(0,I.jsx)(Tc,{children:`Deployment name`}),(0,I.jsx)(Ec,{children:(0,I.jsx)(J,{placeholder:`My Deployment`,...e})}),(0,I.jsx)(Dc,{children:`Custom name for this specific deployment instance.`}),(0,I.jsx)(Oc,{})]})})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-4 space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(Tc,{children:`Environment Variables`}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(A===`netlab-c9s`||A===`netlab`)&&(0,I.jsx)(R,{type:`button`,variant:`outline`,size:`sm`,onClick:()=>s(!0),children:`Supported NETLAB_ vars`}),(0,I.jsxs)(R,{type:`button`,variant:`outline`,size:`sm`,onClick:()=>k({key:``,value:``}),children:[(0,I.jsx)(v,{className:`mr-2 h-3 w-3`}),` Add Variable`]})]})]}),(0,I.jsx)(`div`,{className:`grid gap-6 md:grid-cols-2`,children:(0,I.jsx)(xc,{control:T.control,name:`variableGroupId`,render:({field:e})=>(0,I.jsxs)(wc,{children:[(0,I.jsx)(Tc,{className:`text-xs text-muted-foreground`,children:`Variable Group`}),(0,I.jsxs)(Y,{onValueChange:e.onChange,defaultValue:e.value||`none`,value:e.value||`none`,children:[(0,I.jsx)(Ec,{children:(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`None`})})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`none`,children:`None`}),Ae.map(e=>(0,I.jsx)($,{value:String(e.id),children:e.name},e.id))]})]})]})})}),re.length>0&&(0,I.jsx)(`div`,{className:`space-y-2`,children:re.map((e,t)=>(0,I.jsxs)(`div`,{className:`flex gap-2 items-start`,children:[A===`netlab-c9s`||A===`netlab`?(0,I.jsx)(xc,{control:T.control,name:`env.${t}.key`,render:({field:e})=>{let t=String(e.value??``).trim(),n=Bc.some(e=>e.key===t)?t:`__custom__`;return(0,I.jsxs)(wc,{className:`flex-1 space-y-2`,children:[(0,I.jsx)(Ec,{children:(0,I.jsxs)(Y,{value:n,onValueChange:t=>{t===`__custom__`?e.onChange(``):e.onChange(t)},children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select env var`})}),(0,I.jsxs)(Q,{children:[Bc.map(e=>(0,I.jsx)($,{value:e.key,children:e.label},e.key)),(0,I.jsx)($,{value:`__custom__`,children:`Custom`})]})]})}),n===`__custom__`&&(0,I.jsx)(Ec,{children:(0,I.jsx)(J,{...e,placeholder:`KEY`,className:`font-mono text-xs`})}),(0,I.jsx)(Oc,{})]})}}):(0,I.jsx)(xc,{control:T.control,name:`env.${t}.key`,render:({field:e})=>(0,I.jsxs)(wc,{className:`flex-1`,children:[(0,I.jsx)(Ec,{children:(0,I.jsx)(J,{...e,placeholder:`KEY`,className:`font-mono text-xs`})}),(0,I.jsx)(Oc,{})]})}),(0,I.jsx)(xc,{control:T.control,name:`env.${t}.value`,render:({field:e})=>(0,I.jsxs)(wc,{className:`flex-1`,children:[(0,I.jsx)(Ec,{children:(()=>{let n=String(T.getValues(`env.${t}.key`)??``).trim();if(Hc(n))return(0,I.jsx)(kc,{...e,placeholder:`One \`key=value\` per line.
Example:
addressing.p2p.ipv4=198.18.0.0/16`,className:`font-mono text-xs min-h-[120px]`});let r=Uc(n);if(!r)return(0,I.jsx)(J,{...e,placeholder:`VALUE`,className:`font-mono text-xs`});let i=String(e.value??``).trim(),a=r.some(e=>e.value===i),o=i?a?i:`__custom__`:`none`;return(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(Y,{value:o,onValueChange:t=>{t===`none`?e.onChange(``):t===`__custom__`?e.onChange(i&&!a?i:``):e.onChange(t)},children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select value`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`none`,children:`None`}),r.map(e=>(0,I.jsx)($,{value:e.value,children:e.label},e.value)),(0,I.jsx)($,{value:`__custom__`,children:`Custom`})]})]}),o===`__custom__`&&(0,I.jsx)(J,{...e,placeholder:`VALUE`,className:`font-mono text-xs`})]})})()}),(0,I.jsx)(Oc,{})]})}),(0,I.jsx)(R,{type:`button`,variant:`ghost`,size:`icon`,onClick:()=>ie(t),className:`shrink-0`,children:(0,I.jsx)(Ln,{className:`h-4 w-4 text-muted-foreground`})})]},e.id))})]}),(0,I.jsx)(Xn,{open:a,onOpenChange:s,children:(0,I.jsxs)($n,{className:`max-w-2xl`,children:[(0,I.jsxs)(er,{children:[(0,I.jsx)(nr,{children:`Supported Netlab overrides`}),(0,I.jsxs)(rr,{children:[`These variables are passed into the Netlab generator. Use`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`NETLAB_*`}),` for native Netlab defaults, and`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`SKYFORGE_NETLAB_SET_OVERRIDES`}),` `,`for generator-only`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`netlab --set`}),` overrides.`]})]}),(0,I.jsx)(`div`,{className:`space-y-2 text-sm`,children:Bc.map(e=>(0,I.jsx)(`div`,{className:`flex items-start justify-between gap-3 rounded-md border p-3`,children:(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-medium`,children:e.label}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono break-all`,children:e.key})]})},e.key))})]})}),Ce.isError&&(0,I.jsx)(`div`,{className:`rounded-md bg-destructive/15 p-3 text-sm text-destructive border border-destructive/20`,children:Ce.error?.message||`Create failed.`}),(0,I.jsxs)(`div`,{className:`flex gap-3`,children:[(0,I.jsxs)(R,{type:`submit`,disabled:Ce.isPending,children:[Ce.isPending&&(0,I.jsx)(Gt,{className:`mr-2 h-4 w-4 animate-spin`}),Ce.isPending?`Creating`:`Create Deployment`]}),(0,I.jsx)(R,{type:`button`,variant:`secondary`,onClick:()=>{e({to:`/dashboard/deployments`})},disabled:Ce.isPending,children:`Back`})]})]})})})}),(0,I.jsx)(Xn,{open:d,onOpenChange:p,children:(0,I.jsxs)($n,{className:`max-w-2xl`,children:[(0,I.jsxs)(er,{children:[(0,I.jsx)(nr,{children:`Import EVE-NG lab`}),(0,I.jsx)(rr,{children:`Pull an existing EVE-NG lab into Skyforge or convert it into a Containerlab template.`})]}),(0,I.jsxs)(`div`,{className:`grid gap-4`,children:[(0,I.jsxs)(`div`,{className:`grid gap-2`,children:[(0,I.jsx)(Tc,{children:`EVE-NG server`}),(0,I.jsxs)(Y,{value:m,onValueChange:h,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select EVE-NG server`})}),(0,I.jsx)(Q,{children:ke.map(e=>(0,I.jsx)($,{value:`user:${e.id}`,children:ku(e.apiUrl)||e.name},e.id))})]}),(0,I.jsx)(Dc,{children:`Configure EVE-NG servers in Settings if none appear.`})]}),(0,I.jsxs)(`div`,{className:`grid gap-2`,children:[(0,I.jsx)(Tc,{children:`EVE-NG lab`}),(0,I.jsxs)(Y,{value:g,onValueChange:_,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select lab`})}),(0,I.jsxs)(Q,{children:[pe.isLoading&&(0,I.jsx)(`div`,{className:`px-3 py-2 text-xs text-muted-foreground`,children:`Loading labs`}),!pe.isLoading&&Ie.length===0&&(0,I.jsx)(`div`,{className:`px-3 py-2 text-xs text-muted-foreground`,children:`No labs found.`}),Ie.map(e=>(0,I.jsx)($,{value:e.value,children:e.label},e.value))]})]}),pe.isError&&(0,I.jsx)(`div`,{className:`text-xs text-destructive`,children:`Failed to load labs.`})]}),(0,I.jsxs)(`div`,{className:`grid gap-2`,children:[(0,I.jsx)(Tc,{children:`Deployment name`}),(0,I.jsx)(J,{value:y,onChange:e=>b(e.target.value),placeholder:`Optional override`}),(0,I.jsx)(Dc,{children:`Defaults to the EVE-NG lab name if left empty.`})]}),(0,I.jsxs)(`div`,{className:`flex items-start justify-between gap-3 rounded-md border p-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(Tc,{className:`text-sm`,children:`Create Containerlab deployment`}),(0,I.jsx)(Dc,{children:`Generate a Containerlab template and optionally create a deployment.`})]}),(0,I.jsx)(Gs,{checked:x,onCheckedChange:ee})]}),x&&(0,I.jsxs)(`div`,{className:`grid gap-2`,children:[(0,I.jsx)(Tc,{children:`Containerlab server`}),(0,I.jsxs)(Y,{value:S,onValueChange:C,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select Containerlab server`})}),(0,I.jsx)(Q,{children:Fe.map(e=>(0,I.jsx)($,{value:e.value,children:e.label},e.value))})]}),(0,I.jsx)(Dc,{children:`Required to create a Containerlab deployment.`})]})]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap justify-end gap-2 pt-2`,children:[(0,I.jsx)(R,{type:`button`,variant:`outline`,onClick:()=>p(!1),children:`Cancel`}),(0,I.jsxs)(R,{type:`button`,variant:`secondary`,onClick:()=>we.mutate(),disabled:we.isPending||Te.isPending,children:[we.isPending&&(0,I.jsx)(Gt,{className:`mr-2 h-4 w-4 animate-spin`}),`Import EVE-NG`]}),(0,I.jsxs)(R,{type:`button`,onClick:()=>Te.mutate(),disabled:we.isPending||Te.isPending,children:[Te.isPending&&(0,I.jsx)(Gt,{className:`mr-2 h-4 w-4 animate-spin`}),`Convert to Containerlab`]})]})]})}),(0,I.jsx)(Xn,{open:n,onOpenChange:r,children:(0,I.jsxs)($n,{className:`max-w-4xl`,children:[(0,I.jsxs)(er,{children:[(0,I.jsx)(nr,{children:`Template`}),(0,I.jsx)(rr,{className:`font-mono text-xs truncate`,children:String(be.data?.path??se)})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[be.isError&&(0,I.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load template.`}),(0,I.jsx)(kc,{readOnly:!0,value:String(be.data?.yaml??``),className:`h-[60vh] font-mono text-xs`,placeholder:be.isLoading?`Loading`:`No template loaded.`})]})]})})]})}const ju=t(`/dashboard/deployments/$deploymentId/`)({component:Mu,validateSearch:e=>{let t={};return typeof e.action==`string`&&e.action.trim()&&(t.action=e.action.trim()),typeof e.node==`string`&&e.node.trim()&&(t.node=e.node.trim()),t}});function Mu(){let{deploymentId:e}=ju.useParams(),{action:t,node:n}=ju.useSearch(),r=c(),a=o();ml(!0);let[s,l]=(0,P.useState)(!1),[u,d]=(0,P.useState)(!1),[p,h]=(0,P.useState)(``),g=f({queryKey:W.dashboardSnapshot(),queryFn:yr,retry:!1,staleTime:1e4}),_=(0,P.useMemo)(()=>(g.data?.deployments??[]).find(t=>t.id===e),[g.data?.deployments,e]),v=String(_?.type??``);(0,P.useEffect)(()=>{let e=!!(_?.config??{}).forwardEnabled,t=String((_?.config??{}).forwardCollectorId??``).trim();d(e),h(t)},[_?.id,_?.config]);let y=String(_?.activeTaskId??``);El(y,!!y);let b=f({queryKey:W.runLogs(y),queryFn:async()=>({cursor:0,entries:[]}),retry:!1,staleTime:1/0,enabled:!!y}),x=async()=>{try{if(!_)throw Error(`deployment not found`);await Qa(_.id),O.success(`Deployment starting`,{description:`${_.name} is queued to start.`})}catch(e){O.error(`Failed to start`,{description:e.message})}},ee=async()=>{try{if(!_)throw Error(`deployment not found`);await $a(_.id),O.success(`Deployment stopping`,{description:`${_.name} is queued to stop.`})}catch(e){O.error(`Failed to stop`,{description:e.message})}},S=async()=>{try{if(!_)throw Error(`deployment not found`);await eo(_.id),O.success(`Deployment deleted`),await a.invalidateQueries({queryKey:W.dashboardSnapshot()}),r({to:`/dashboard/deployments`,search:{}})}catch(e){O.error(`Failed to delete`,{description:e.message})}},w=_?.activeTaskStatus??_?.lastStatus??`unknown`,te=!!_?.activeTaskId,T=(0,P.useMemo)(()=>{if(!_)return[];let e=g.data?.runs??[],t=e.filter(e=>String(e.deploymentId??``)===_.id);return t.length>0?t:e},[_,g.data?.runs]),E=f({queryKey:W.deploymentTopology(e),queryFn:async()=>{if(!_)throw Error(`deployment not found`);return ma(_.id)},enabled:!!_&&[`containerlab`,`netlab-c9s`,`clabernetes`].includes(v),retry:!1,staleTime:1e4}),D=i({mutationFn:async e=>{if(!_)throw Error(`deployment not found`);return ea(_.id,e)},onSuccess:(e,t)=>{if(e?.skipped){O.message(`Save config skipped`,{description:e.message||`Node ${t}`});return}O.success(`Save config queued/applied`,{description:e.stdout||`Node ${t}`})},onError:e=>O.error(`Save config failed`,{description:e.message})}),ne=async()=>{if(!_)return;let e=E.data?.nodes??[];if(!e.length){O.message(`No nodes to save`);return}if(D.isPending)return;O.message(`Saving configs`,{description:`Nodes: ${e.length}`});let t=e.map(e=>String(e.id)),n=0,r=0,i=0,a=0;if(await Promise.all(Array.from({length:Math.min(3,t.length)},async()=>{for(;n<t.length;){let e=t[n++];try{(await ea(_.id,e))?.skipped?i++:r++}catch{a++}}})),a){O.error(`Save configs finished with errors`,{description:`ok=${r} skipped=${i} failed=${a}`});return}O.success(`Save configs finished`,{description:`ok=${r} skipped=${i}`})},k=()=>{try{if(!_){O.error(`Cannot download config`,{description:`Deployment not found.`});return}let e=new Blob([JSON.stringify(_.config??{},null,2)],{type:`application/json`}),t=document.createElement(`a`),n=String(_.name??`deployment`).replace(/[^a-zA-Z0-9._-]+/g,`_`);t.href=URL.createObjectURL(e),t.download=`${n}.config.json`,document.body.appendChild(t),t.click(),t.remove(),setTimeout(()=>URL.revokeObjectURL(t.href),5e3),O.success(`Downloaded config`)}catch(e){O.error(`Failed to download config`,{description:e.message})}},ie=f({queryKey:W.userForwardCollectorConfigs(),queryFn:_a,enabled:u,retry:!1,staleTime:3e4}),A=ie.data?.collectors??[],ae=i({mutationFn:async e=>{if(!_)throw Error(`deployment not found`);return Ci(_.id,e)},onSuccess:async()=>{O.success(`Forward settings updated`),await a.invalidateQueries({queryKey:W.dashboardSnapshot()})},onError:e=>O.error(`Failed to update Forward settings`,{description:e.message})}),oe=i({mutationFn:async()=>{if(!_)throw Error(`deployment not found`);return wi(_.id)},onSuccess:async e=>{O.success(`Forward sync queued`,{description:`Run ${String(e.run?.id??``)}`}),await a.invalidateQueries({queryKey:W.dashboardSnapshot()})},onError:e=>O.error(`Failed to sync to Forward`,{description:e.message})});if(t&&n&&_){if(t===`terminal`)return(0,I.jsx)(`div`,{className:`h-screen w-screen bg-zinc-950 flex flex-col`,children:(0,I.jsx)(Ll,{deploymentId:e,nodeId:n,className:`flex-1`})});if(t===`logs`)return(0,I.jsx)(`div`,{className:`h-screen w-screen bg-background flex flex-col`,children:(0,I.jsx)(Nl,{deploymentId:e,nodeId:n,className:`flex-1`})});if(t===`describe`)return(0,I.jsx)(`div`,{className:`h-screen w-screen bg-background flex flex-col`,children:(0,I.jsx)(jl,{deploymentId:e,nodeId:n,className:`flex-1`})})}return _?(0,I.jsxs)(`div`,{className:`space-y-6 p-6 pb-20`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(m,{to:`/dashboard/deployments`,className:So({variant:`outline`,size:`icon`,className:`h-9 w-9`}),children:(0,I.jsx)(it,{className:`h-4 w-4`})}),(0,I.jsxs)(`div`,{children:[(0,I.jsxs)(`h1`,{className:`text-2xl font-bold tracking-tight flex items-center gap-3`,children:[_.name,(0,I.jsx)(Nu,{status:w})]}),(0,I.jsxs)(`p`,{className:`text-sm text-muted-foreground flex items-center gap-2 mt-1`,children:[(0,I.jsx)(`span`,{className:`font-mono text-xs bg-muted px-1.5 py-0.5 rounded`,children:_.id}),(0,I.jsx)(`span`,{children:``}),(0,I.jsx)(`span`,{className:`capitalize`,children:_.type})]})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(m,{to:`/dashboard/deployments/$deploymentId/capacity`,params:{deploymentId:e},className:So({variant:`outline`,size:`sm`}),title:`Capacity rollups and forecasting`,children:[(0,I.jsx)(Se,{className:`mr-2 h-4 w-4`}),` Capacity`]}),(0,I.jsxs)(R,{variant:`outline`,size:`sm`,onClick:x,disabled:te,children:[(0,I.jsx)(wt,{className:`mr-2 h-4 w-4`}),` Start`]}),(0,I.jsxs)(R,{variant:`outline`,size:`sm`,onClick:ee,disabled:te,children:[(0,I.jsx)(xe,{className:`mr-2 h-4 w-4`}),` Stop`]}),(0,I.jsxs)(R,{variant:`destructive`,size:`sm`,onClick:()=>l(!0),disabled:te,children:[(0,I.jsx)(Ln,{className:`mr-2 h-4 w-4`}),` Delete`]})]})]}),(0,I.jsxs)(ac,{defaultValue:`topology`,className:`space-y-6`,children:[(0,I.jsxs)(oc,{children:[(0,I.jsxs)(sc,{value:`topology`,className:`gap-2`,children:[(0,I.jsx)(dn,{className:`h-4 w-4`}),` Topology`]}),(0,I.jsxs)(sc,{value:`logs`,className:`gap-2`,children:[(0,I.jsx)(C,{className:`h-4 w-4`}),` Logs & Events`]}),(0,I.jsxs)(sc,{value:`config`,className:`gap-2`,children:[(0,I.jsx)(Dn,{className:`h-4 w-4`}),` Configuration`]})]}),(0,I.jsxs)(cc,{value:`topology`,className:`space-y-6 animate-in fade-in-50`,children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-3`,children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(V,{children:`Network Topology`}),(0,I.jsx)(H,{children:_.type===`containerlab`?`Derived from containerlab after deploy (includes resolved mgmt IPs).`:_.type===`netlab-c9s`||_.type===`clabernetes`?`Derived from clabernetes after deploy (includes resolved mgmt IPs).`:`Topology is provider-dependent; not yet implemented for this deployment type.`})]}),(0,I.jsx)(`div`,{className:`flex items-center gap-2`,children:(0,I.jsxs)(R,{variant:`outline`,size:`sm`,onClick:()=>{let e=window.location.pathname,t=e.endsWith(`/`)?e.slice(0,-1):e;window.open(`${t}/map`,`_blank`,`noopener,noreferrer`)},title:`Open the full-screen map view in a new tab`,children:[(0,I.jsx)(re,{className:`mr-2 h-4 w-4`}),`Open map`]})})]})}),(0,I.jsx)(U,{children:(0,I.jsx)(Ul,{topology:E.data,deploymentId:_.id,enableTerminal:[`netlab-c9s`,`clabernetes`].includes(_.type)})})]}),E.data?.nodes?.length?(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-3`,children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(V,{children:`Nodes`}),(0,I.jsx)(H,{children:`Quick actions (opens in a new tab where applicable).`})]}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,disabled:D.isPending,onClick:ne,children:D.isPending?`Saving`:`Save all configs`})]})}),(0,I.jsx)(U,{children:(0,I.jsx)(`div`,{className:`space-y-2`,children:E.data.nodes.map(e=>{let t=String(e.id),n=String(e.kind??``),r=String(e.mgmtIp??``),i=String(e.status??``),a=`${window.location.pathname}?node=${encodeURIComponent(t)}`;return(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 rounded-md border p-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:t}),i?(0,I.jsx)(K,{variant:`secondary`,className:`capitalize`,children:i}):null,n?(0,I.jsx)(`span`,{className:`text-xs text-muted-foreground truncate`,children:n}):null]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate mt-1`,children:r||``})]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsx)(R,{size:`sm`,variant:`outline`,disabled:![`netlab-c9s`,`clabernetes`].includes(_.type),onClick:()=>window.open(`${a}&action=terminal`,`_blank`,`noopener,noreferrer`),children:`Terminal`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>window.open(`${a}&action=logs`,`_blank`,`noopener,noreferrer`),children:`Logs`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,onClick:()=>window.open(`${a}&action=describe`,`_blank`,`noopener,noreferrer`),children:`Describe`}),(0,I.jsx)(R,{size:`sm`,variant:`outline`,disabled:D.isPending,onClick:()=>D.mutate(t),children:D.isPending?`Saving`:`Save config`}),(0,I.jsx)(R,{size:`sm`,variant:`ghost`,onClick:()=>{if(!r.trim()){O.error(`No management IP available`);return}navigator.clipboard?.writeText(r),O.success(`Copied management IP`)},children:`Copy IP`})]})]},t)})})})]}):null]}),(0,I.jsx)(cc,{value:`logs`,className:`space-y-6 animate-in fade-in-50`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Logs & Events`}),(0,I.jsx)(H,{children:`Live task output.`})]}),(0,I.jsxs)(U,{children:[_.activeTaskId?(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsxs)(`div`,{className:`text-sm font-medium`,children:[`Active run: `,String(_.activeTaskId)]}),(0,I.jsx)(m,{to:`/dashboard/runs/$runId`,params:{runId:String(_.activeTaskId)},className:So({variant:`outline`,size:`sm`}),children:`Open run details`})]}),(0,I.jsx)(`div`,{className:`rounded-md border bg-zinc-950 p-4 font-mono text-xs text-zinc-100`,children:(0,I.jsx)(Pu,{entries:b.data?.entries??[]})})]}):(0,I.jsxs)(`div`,{className:`flex flex-col items-center justify-center py-10 text-center text-muted-foreground border-2 border-dashed rounded-lg`,children:[(0,I.jsx)(C,{className:`h-10 w-10 mb-3 opacity-20`}),(0,I.jsx)(`p`,{children:`No active run.`}),(0,I.jsx)(`p`,{className:`text-xs mt-1`,children:`Start/stop/destroy will queue runs that appear here.`})]}),(0,I.jsxs)(`div`,{className:`mt-8 space-y-3`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Recent runs`}),(0,I.jsx)(`div`,{className:`space-y-2`,children:T.length===0?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No runs yet.`}):T.slice(0,10).map(e=>{let t=String(e.id??``);return(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3 rounded-md border p-3`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:t}),(0,I.jsx)(K,{variant:`secondary`,className:`capitalize`,children:String(e.status??``)}),(0,I.jsx)(`span`,{className:`text-xs text-muted-foreground truncate`,children:String(e.tpl_alias??e.type??``)})]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground truncate mt-1`,children:String(e.status_text??e.message??``)})]}),(0,I.jsx)(m,{to:`/dashboard/runs/$runId`,params:{runId:t},className:So({variant:`outline`,size:`sm`}),children:`View`})]},t)})})]})]})]})}),(0,I.jsxs)(cc,{value:`config`,className:`space-y-6 animate-in fade-in-50`,children:[(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Forward Networks`}),(0,I.jsx)(H,{children:`Optional: sync device IPs into Forward for collection.`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Enable Forward collection`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Requires configuring your Collector first.`})]}),(0,I.jsx)(Gs,{checked:u,disabled:ae.isPending,onCheckedChange:e=>{d(e);let t=e?p.trim():``;ae.mutate({enabled:e,collectorConfigId:t||void 0})}})]}),u?(0,I.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Collector`}),(0,I.jsxs)(Y,{value:p,onValueChange:e=>{h(e),ae.mutate({enabled:!0,collectorConfigId:e})},disabled:ie.isLoading||ie.isError||ae.isPending,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:ie.isLoading?`Loading`:ie.isError?`Configure Collector first`:`Select collector`})}),(0,I.jsx)(Q,{children:A.map(e=>(0,I.jsx)($,{value:e.id,children:e.name},e.id))})]})]}),(0,I.jsx)(`div`,{className:`flex items-end gap-2`,children:(0,I.jsx)(R,{variant:`outline`,onClick:()=>oe.mutate(),disabled:!p.trim()||oe.isPending||ae.isPending,children:oe.isPending?`Queueing`:`Sync now`})})]}):null]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{children:[(0,I.jsx)(V,{children:`Configuration`}),(0,I.jsx)(H,{children:`Read-only view of the deployment parameters.`})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(R,{size:`sm`,variant:`outline`,onClick:()=>{navigator.clipboard?.writeText(JSON.stringify(_.config??{},null,2)),O.success(`Copied config JSON`)},children:[(0,I.jsx)(De,{className:`mr-2 h-4 w-4`}),`Copy`]}),(0,I.jsxs)(R,{size:`sm`,variant:`outline`,onClick:k,children:[(0,I.jsx)(N,{className:`mr-2 h-4 w-4`}),`Download`]})]})]})}),(0,I.jsx)(U,{children:(0,I.jsx)(`pre`,{className:`bg-muted p-4 rounded-lg overflow-auto font-mono text-xs max-h-[500px]`,children:JSON.stringify(_.config,null,2)})})]})]})]}),(0,I.jsx)(Ns,{open:s,onOpenChange:l,children:(0,I.jsxs)(Is,{children:[(0,I.jsxs)(Ls,{children:[(0,I.jsx)(zs,{children:`Delete deployment?`}),(0,I.jsxs)(Bs,{children:[`This will remove `,(0,I.jsx)(`strong`,{children:_.name}),` from Skyforge and trigger provider cleanup. This action cannot be undone.`]})]}),(0,I.jsxs)(Rs,{children:[(0,I.jsx)(Hs,{children:`Cancel`}),(0,I.jsx)(Vs,{onClick:S,className:So({variant:`destructive`}),children:`Delete Deployment`})]})]})})]}):g.isLoading||g.isFetching?(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-4`,children:[(0,I.jsx)(G,{className:`h-10 w-32`}),(0,I.jsx)(G,{className:`h-10 w-48`})]}),(0,I.jsx)(G,{className:`h-[400px] w-full`})]}):(0,I.jsx)(`div`,{className:`p-6`,children:(0,I.jsx)(_s,{icon:ve,title:`Deployment not found`,description:`This deployment may have been deleted or you don't have access.`,action:{label:`Back to Deployments`,onClick:()=>r({to:`/dashboard/deployments`})}})})}function Nu({status:e}){let t=`secondary`,n=e.toLowerCase();return[`running`,`active`,`healthy`,`succeeded`,`success`].includes(n)&&(t=`default`),[`failed`,`error`,`stopped`,`crashloopbackoff`].includes(n)&&(t=`destructive`),(0,I.jsx)(K,{variant:t,className:`capitalize`,children:e})}function Pu(e){let t=(0,P.useRef)(null);return(0,P.useEffect)(()=>{let e=t.current;e&&(e.scrollTop=e.scrollHeight)},[e.entries.length]),e.entries.length===0?(0,I.jsx)(`div`,{className:`text-zinc-500`,children:`Waiting for output`}):(0,I.jsx)(`div`,{ref:t,className:`max-h-[65vh] overflow-auto whitespace-pre-wrap`,children:e.entries.map((e,t)=>(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`span`,{className:`text-zinc-500 select-none`,children:e.time?`${e.time} `:``}),(0,I.jsx)(`span`,{children:e.output})]},`${e.time}-${t}`))})}async function Fu(e,t){return L(`/api/fwd/${encodeURIComponent(e)}/assurance/traffic/seeds`,{method:`POST`,body:JSON.stringify(t??{})})}async function Iu(e,t){return L(`/api/fwd/${encodeURIComponent(e)}/assurance/traffic/evaluate`,{method:`POST`,body:JSON.stringify(t??{})})}var Lu=qn({});const Ru=t(`/dashboard/fwd/$networkRef/traffic-scenarios`)({validateSearch:e=>Lu.parse(e),component:Uu});function zu(e){return String(e??``).split(`,`).map(e=>e.trim()).filter(Boolean)}function Bu(e){let t=[`from,srcIp,dstIp,ipProto,srcPort,dstPort,bandwidthGbps,label`];for(let n of e??[]){let e=String(n.from??``).replaceAll(`,`,` `).trim(),r=String(n.srcIp??``).replaceAll(`,`,` `).trim(),i=String(n.dstIp??``).replaceAll(`,`,` `).trim(),a=n.ipProto===void 0?``:String(n.ipProto),o=String(n.srcPort??``).replaceAll(`,`,` `).trim(),s=String(n.dstPort??``).replaceAll(`,`,` `).trim(),c=n.bandwidthGbps===void 0?``:String(n.bandwidthGbps),l=String(n.label??``).replaceAll(`,`,` `).trim();t.push([e,r,i,a,o,s,c,l].join(`,`))}return t.join(`
`)+`
`}function Vu(e){return String(e??``).split(`,`).map(e=>e.trim())}function Hu(e){let t=[],n=String(e??``).split(/\r?\n/).map(e=>e.trim()).filter(Boolean);if(!n.length)return t;let r=n[0].toLowerCase(),i=r.includes(`dstip`)||r.includes(`bandwidth`)||r.includes(`ipproto`),a=new Map,o=0;if(i){let e=Vu(n[0]);for(let t=0;t<e.length;t++){let n=String(e[t]??``).trim().toLowerCase();n&&a.set(n,t)}o=1}let s=(e,t,n)=>{let r=a.get(t);return r===void 0?String(e[n]??``).trim():String(e[r]??``).trim()};for(let e=o;e<n.length;e++){let r=Vu(n[e]),a=!i&&r.length>=7,o=s(r,`from`,0),c=i||a?s(r,`srcip`,1):``,l=i||a?s(r,`dstip`,2):s(r,`dstip`,1);if(!l)continue;let u=i||a?s(r,`ipproto`,3):``,d=i||a?s(r,`srcport`,4):``,f=i||a?s(r,`dstport`,5):``,p=i||a?s(r,`bandwidthgbps`,6):s(r,`bandwidthgbps`,2),m=i||a?s(r,`label`,7):s(r,`label`,3),h=p?Number(p):NaN,g=u?Number(u):NaN;t.push({from:o||void 0,srcIp:c||void 0,dstIp:l,ipProto:Number.isFinite(g)?g:void 0,srcPort:d||void 0,dstPort:f||void 0,bandwidthGbps:Number.isFinite(h)?h:void 0,label:m||void 0})}return t}function Uu(){let{networkRef:e}=Ru.useParams();Ru.useSearch();let[t,n]=(0,P.useState)(`mesh`),[r,a]=(0,P.useState)(!0),[o,s]=(0,P.useState)(``),[c,l]=(0,P.useState)(``),[u,d]=(0,P.useState)(``),[p,h]=(0,P.useState)(``),[g,_]=(0,P.useState)(``),[v,y]=(0,P.useState)(``),[b,x]=(0,P.useState)(``),[ee,S]=(0,P.useState)(``),[C,w]=(0,P.useState)(``),[te,T]=(0,P.useState)(`30`),[E,D]=(0,P.useState)(`200`),[ne,re]=(0,P.useState)(``),[k,ie]=(0,P.useState)(`7d`),[A,ae]=(0,P.useState)(`0.8`),[oe,se]=(0,P.useState)(``),[ce,le]=(0,P.useState)(!1),[ue,fe]=(0,P.useState)(!0),[pe,me]=(0,P.useState)(!1),[he,ge]=(0,P.useState)(`3`),[_e,j]=(0,P.useState)(!0),ve=f({queryKey:W.userForwardNetworks(),queryFn:()=>lo(),enabled:!0,retry:!1,staleTime:3e4}),ye=f({queryKey:W.userForwardNetworks(),queryFn:lo,retry:!1,staleTime:3e4}),be=(0,P.useMemo)(()=>{let t=ve.data?.networks??[],n=ye.data?.networks??[],r=t.find(t=>String(t?.id??``)===String(e))??n.find(t=>String(t?.id??``)===String(e));return String(r?.name??``)},[ve.data?.networks,ye.data?.networks,e]),xe=i({mutationFn:async()=>{let n=String(t??`mesh`),i={snapshotId:ne.trim()||void 0,maxDevices:Number(te)||30,maxDemands:Number(E)||200,mode:n,includeGroups:r};return n===`cross`?(i.srcTagParts=zu(p),i.srcNameParts=zu(g),i.srcDeviceTypes=zu(v),i.dstTagParts=zu(b),i.dstNameParts=zu(ee),i.dstDeviceTypes=zu(C)):(i.tagParts=zu(o),i.nameParts=zu(c),i.deviceTypes=zu(u)),Fu(e,i)},onSuccess:e=>{se(Bu(e.demands??[]));let n=String(t??`mesh`),r=n===`cross`?e.srcEndpoints?.length??0:e.endpoints?.length??0,i=n===`cross`?e.dstEndpoints?.length??0:e.endpoints?.length??0;O.success(`Seeded src=${r}, dst=${i}, demands=${e.demands?.length??0}`)},onError:e=>{O.error(String(e?.message??e??`seed failed`))}}),Se=i({mutationFn:async()=>{let t=Hu(oe);if(!t.length)throw Error(`no demands parsed from CSV`);let n=Number(A),r=Number(he);return Iu(e,{snapshotId:ne.trim()||void 0,window:k,thresholdUtil:Number.isFinite(n)?n:.8,forward:{maxResults:Number.isFinite(r)&&r>0?r:3},enforcement:{requireEnforcement:_e},demands:t,includeHops:ce,includeAcl:pe,projectLoad:ue})},onError:e=>{O.error(String(e?.message??e??`evaluate failed`))}});return(0,I.jsxs)(`div`,{className:`space-y-6`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(R,{asChild:!0,variant:`ghost`,size:`sm`,children:(0,I.jsxs)(m,{to:`/dashboard/fwd`,children:[(0,I.jsx)(it,{className:`h-4 w-4`}),(0,I.jsx)(`span`,{className:`ml-2`,children:`Forward Networks`})]})}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Traffic Scenarios`}),(0,I.jsx)(`div`,{className:`text-lg font-semibold`,children:be||e})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(K,{variant:`secondary`,children:`Forward Paths + NQE`}),(0,I.jsx)(R,{asChild:!0,variant:`outline`,size:`sm`,children:(0,I.jsx)(m,{to:`/dashboard/fwd/$networkRef/assurance-studio`,params:{networkRef:e},children:`Assurance Studio`})}),ve.isLoading?(0,I.jsx)(G,{className:`h-6 w-24`}):null]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Scenario Inputs`})}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsx)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-2`,children:(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Forward snapshotId (optional)`}),(0,I.jsx)(J,{value:ne,onChange:e=>re(e.target.value),placeholder:`latest processed`})]})}),(0,I.jsxs)(ac,{defaultValue:`seed`,children:[(0,I.jsxs)(oc,{children:[(0,I.jsxs)(sc,{value:`seed`,children:[(0,I.jsx)(de,{className:`h-4 w-4`}),(0,I.jsx)(`span`,{className:`ml-2`,children:`Seed`})]}),(0,I.jsxs)(sc,{value:`demands`,children:[(0,I.jsx)(wt,{className:`h-4 w-4`}),(0,I.jsx)(`span`,{className:`ml-2`,children:`Demands`})]})]}),(0,I.jsxs)(cc,{value:`seed`,className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Mode`}),(0,I.jsxs)(Y,{value:t,onValueChange:n,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`mesh`,children:`Mesh (src=dst set)`}),(0,I.jsx)($,{value:`cross`,children:`Cross (separate src and dst sets)`})]})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Include groups in tag matching`}),(0,I.jsxs)(`div`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:r,onChange:e=>a(e.target.checked)}),(0,I.jsxs)(`span`,{className:`text-sm text-muted-foreground`,children:[`Match `,(0,I.jsx)(`span`,{className:`font-mono`,children:`tagParts`}),` against group names too`]})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Seed behavior`}),(0,I.jsx)(`div`,{className:`rounded-md border bg-muted/20 p-3 text-xs text-muted-foreground`,children:`Seeds demands from device management IPs discovered via NQE against the Forward snapshot.`})]})]}),t===`cross`?(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2 rounded-md border p-3`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Source endpoints`}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Src tag parts`}),(0,I.jsx)(J,{value:p,onChange:e=>h(e.target.value),placeholder:`core,bng`})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Src name parts`}),(0,I.jsx)(J,{value:g,onChange:e=>_(e.target.value),placeholder:`nyc,den`})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Src device types`}),(0,I.jsx)(J,{value:v,onChange:e=>y(e.target.value),placeholder:`ROUTER,SWITCH`})]})]}),(0,I.jsxs)(`div`,{className:`space-y-2 rounded-md border p-3`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Destination endpoints`}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Dst tag parts`}),(0,I.jsx)(J,{value:b,onChange:e=>x(e.target.value),placeholder:`peering,edge`})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Dst name parts`}),(0,I.jsx)(J,{value:ee,onChange:e=>S(e.target.value),placeholder:`sjc,iad`})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Dst device types`}),(0,I.jsx)(J,{value:C,onChange:e=>w(e.target.value),placeholder:`ROUTER`})]})]})]}):(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Tag parts (comma-separated)`}),(0,I.jsx)(J,{value:o,onChange:e=>s(e.target.value),placeholder:`core,bng,peering`})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Name parts (comma-separated)`}),(0,I.jsx)(J,{value:c,onChange:e=>l(e.target.value),placeholder:`nyc,den`})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Device types (comma-separated)`}),(0,I.jsx)(J,{value:u,onChange:e=>d(e.target.value),placeholder:`ROUTER,SWITCH`})]})]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Max devices`}),(0,I.jsx)(J,{value:te,onChange:e=>T(e.target.value)})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Max demands`}),(0,I.jsx)(J,{value:E,onChange:e=>D(e.target.value)})]}),(0,I.jsx)(`div`,{className:`flex items-end`,children:(0,I.jsx)(R,{disabled:xe.isPending,onClick:()=>xe.mutate(),children:`Seed demands`})})]})]}),(0,I.jsxs)(cc,{value:`demands`,className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-4`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Window`}),(0,I.jsxs)(Y,{value:k,onValueChange:ie,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`24h`,children:`24h`}),(0,I.jsx)($,{value:`7d`,children:`7d`}),(0,I.jsx)($,{value:`30d`,children:`30d`})]})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Threshold util (0-1)`}),(0,I.jsx)(J,{value:A,onChange:e=>ae(e.target.value)})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Max results`}),(0,I.jsx)(J,{value:he,onChange:e=>ge(e.target.value)})]}),(0,I.jsxs)(`div`,{className:`flex items-end gap-2`,children:[(0,I.jsx)(R,{disabled:Se.isPending,onClick:()=>Se.mutate(),children:`Evaluate`}),(0,I.jsx)(R,{variant:`secondary`,onClick:()=>se(``),children:`Clear`})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Demands CSV:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:`from,srcIp,dstIp,ipProto,srcPort,dstPort,bandwidthGbps,label`})]}),(0,I.jsx)(`textarea`,{className:`min-h-[220px] w-full rounded-md border bg-background p-3 font-mono text-sm`,value:oe,onChange:e=>se(e.target.value),placeholder:`from,srcIp,dstIp,ipProto,srcPort,dstPort,bandwidthGbps,label\\ncore-r1,,10.0.0.1,,,,2.5,svc-a`}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2 text-sm text-muted-foreground`,children:[(0,I.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:ce,onChange:e=>le(e.target.checked)}),`Include hops`]}),(0,I.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:ue,onChange:e=>{let t=e.target.checked;fe(t),t&&le(!0)}}),`Project load (needs bandwidthGbps; turns on hops)`]}),(0,I.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:_e,onChange:e=>j(e.target.checked)}),`Require enforcement traversal`]}),(0,I.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:pe,onChange:e=>me(e.target.checked)}),`Include ACL/NF details (slower)`]})]})]})]})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Results`})}),(0,I.jsxs)(U,{className:`space-y-3`,children:[Se.isPending?(0,I.jsx)(G,{className:`h-20 w-full`}):null,Se.data?(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,I.jsxs)(K,{variant:`secondary`,children:[`Demands: `,Se.data.summary.totalDemands]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`Delivered: `,Se.data.summary.delivered]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`Timed out: `,Se.data.summary.timedOut]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`Missing enforcement:`,` `,Se.data.summary.missingEnforcement]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`Crosses threshold:`,` `,Se.data.summary.crossesThreshold]})]}),(Se.data.interfaceImpacts??[]).length>0?(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Interface impacts`}),(0,I.jsx)(`div`,{className:`overflow-x-auto`,children:(0,I.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,I.jsx)(`thead`,{children:(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Device`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Interface`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Dir`}),(0,I.jsx)(`th`,{className:`p-2 text-right`,children:`Base p95`}),(0,I.jsx)(`th`,{className:`p-2 text-right`,children:`Added (Gbps)`}),(0,I.jsx)(`th`,{className:`p-2 text-right`,children:`Projected`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Crosses`})]})}),(0,I.jsx)(`tbody`,{children:[...Se.data.interfaceImpacts??[]].sort((e,t)=>Number(t.projectedUtil??0)-Number(e.projectedUtil??0)).slice(0,50).map(e=>(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.deviceName}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.interfaceName}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.direction}),(0,I.jsx)(`td`,{className:`p-2 text-right font-mono text-xs`,children:e.baseP95Util===void 0?``:e.baseP95Util.toFixed(3)}),(0,I.jsx)(`td`,{className:`p-2 text-right font-mono text-xs`,children:e.addedGbps===void 0?``:e.addedGbps.toFixed(3)}),(0,I.jsx)(`td`,{className:`p-2 text-right font-mono text-xs`,children:e.projectedUtil===void 0?``:e.projectedUtil.toFixed(3)}),(0,I.jsx)(`td`,{className:`p-2`,children:e.crossesThreshold?(0,I.jsx)(`span`,{className:`text-amber-600`,children:`yes`}):(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:`no`})})]},`${e.deviceName}:${e.interfaceName}:${e.direction}`))})]})}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Showing top 50 by projected utilization.`})]}):null,(0,I.jsx)(`div`,{className:`overflow-x-auto`,children:(0,I.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,I.jsx)(`thead`,{children:(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`#`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Demand`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Forward`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Recommended`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Outcome`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Bottleneck`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Candidates`})]})}),(0,I.jsx)(`tbody`,{children:Se.data.items.map(e=>{let t=e.candidates?.[e.recommended],n=t?.bottleneck;return(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`td`,{className:`p-2 text-muted-foreground`,children:e.index+1}),(0,I.jsxs)(`td`,{className:`p-2`,children:[(0,I.jsxs)(`div`,{className:`font-mono`,children:[String(e.demand.from??``),` ->`,` `,e.demand.dstIp]}),e.demand.bandwidthGbps===void 0?null:(0,I.jsxs)(`div`,{className:`text-muted-foreground`,children:[`bw=`,e.demand.bandwidthGbps,`G`]}),e.demand.label?(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:e.demand.label}):null]}),(0,I.jsx)(`td`,{className:`p-2`,children:e.queryUrl?(0,I.jsx)(`a`,{className:`text-primary underline`,href:e.queryUrl,target:`_blank`,rel:`noreferrer noopener`,children:`query`}):(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:``})}),(0,I.jsx)(`td`,{className:`p-2`,children:e.recommended}),(0,I.jsxs)(`td`,{className:`p-2`,children:[(0,I.jsx)(`div`,{children:t?.forwardingOutcome??e.error??``}),t&&!t.enforced?(0,I.jsx)(`div`,{className:`text-amber-600`,children:`missing enforcement`}):null]}),(0,I.jsx)(`td`,{className:`p-2`,children:n?(0,I.jsxs)(`div`,{className:`font-mono`,children:[n.deviceName,`:`,n.interfaceName,` (`,n.direction,`)`,n.headroomGbps===void 0?``:` headroom=${n.headroomGbps.toFixed(2)}G`,n.crossesThreshold?` crosses`:``]}):(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:``})}),(0,I.jsx)(`td`,{className:`p-2`,children:(0,I.jsxs)(`details`,{children:[(0,I.jsx)(`summary`,{className:`cursor-pointer text-muted-foreground`,children:e.candidates?.length??0}),(0,I.jsx)(`div`,{className:`mt-2 space-y-2`,children:(e.candidates??[]).map(e=>(0,I.jsxs)(`div`,{className:`rounded-md border p-2`,children:[(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center justify-between gap-2`,children:[(0,I.jsxs)(`div`,{className:`font-mono text-xs`,children:[`cand=`,e.index]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[e.enforced?`enforced`:`not enforced`,e.timedOut?`  timeout`:``]})]}),(0,I.jsxs)(`div`,{className:`mt-1 text-xs`,children:[(0,I.jsx)(`span`,{className:`font-medium`,children:`fwd:`}),` `,(0,I.jsx)(`span`,{className:`font-mono`,children:e.forwardingOutcome??``})]}),e.securityOutcome?(0,I.jsxs)(`div`,{className:`mt-1 text-xs`,children:[(0,I.jsx)(`span`,{className:`font-medium`,children:`sec:`}),` `,(0,I.jsx)(`span`,{className:`font-mono`,children:e.securityOutcome})]}):null,e.bottleneck?(0,I.jsxs)(`div`,{className:`mt-1 text-xs font-mono text-muted-foreground`,children:[e.bottleneck.deviceName,`:`,e.bottleneck.interfaceName,` (`,e.bottleneck.direction,`)`]}):null,(e.hops??[]).length?(0,I.jsxs)(`div`,{className:`mt-1 text-xs text-muted-foreground`,children:[`hops=`,e.hops?.length??0]}):null]},e.index))})]})})]},e.index)})})]})})]}):(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Seed demands and evaluate to see ranked path candidates.`})]})]})]})}async function Wu(e){return L(`/api/fwd/${encodeURIComponent(e)}/assurance/studio/scenarios`)}async function Gu(e,t){return L(`/api/fwd/${encodeURIComponent(e)}/assurance/studio/scenarios`,{method:`POST`,body:JSON.stringify(t??{})})}async function Ku(e,t,n){return L(`/api/fwd/${encodeURIComponent(e)}/assurance/studio/scenarios/${encodeURIComponent(t)}`,{method:`PUT`,body:JSON.stringify(n??{})})}async function qu(e,t){return L(`/api/fwd/${encodeURIComponent(e)}/assurance/studio/scenarios/${encodeURIComponent(t)}`,{method:`DELETE`})}async function Ju(e,t){return L(`/api/fwd/${encodeURIComponent(e)}/assurance/studio/evaluate`,{method:`POST`,body:JSON.stringify(t??{})})}async function Yu(e){return L(`/api/fwd/${encodeURIComponent(e)}/assurance/studio/runs`)}async function Xu(e,t){return L(`/api/fwd/${encodeURIComponent(e)}/assurance/studio/runs`,{method:`POST`,body:JSON.stringify(t??{})})}async function Zu(e,t){return L(`/api/fwd/${encodeURIComponent(e)}/assurance/studio/runs/${encodeURIComponent(t)}`)}const Qu=t(`/dashboard/fwd/$networkRef/hub`)({component:nd});function $u(e){let t=String(e??``).trim();if(!t)return``;let n=Date.parse(t);return Number.isFinite(n)?new Date(n).toISOString():t}function ed(e){let t=String(e??``).trim().toLowerCase();return t?t===`ok`||t===`warn`||t===`warning`?!0:!(t.includes(`fail`)||t.includes(`error`)):!1}function td(e){switch(e){case`routing`:return`Routing`;case`capacity`:return`Capacity`;case`security`:return`Security`}}function nd(){let e=o(),{networkRef:t}=Qu.useParams(),[n,r]=(0,P.useState)(`24h`),[a,s]=(0,P.useState)(`0.8`),[c,l]=(0,P.useState)(`120`),[u,d]=(0,P.useState)(`3`),[p,h]=(0,P.useState)(!0),[g,_]=(0,P.useState)(!1),[v,y]=(0,P.useState)(!0),[b,x]=(0,P.useState)(!1),[ee,S]=(0,P.useState)(!1),C=f({queryKey:W.forwardNetworkAssuranceSummary(t),queryFn:()=>ki(t),enabled:!!t,staleTime:5e3,retry:!1}),w=C.data,te=f({queryKey:W.userForwardNetworks(),queryFn:()=>lo(),enabled:!0,staleTime:2e4,retry:!1}),T=(0,P.useMemo)(()=>(te.data?.networks??[]).find(e=>String(e.id)===String(t))??null,[te.data?.networks,t]),E=f({queryKey:W.assuranceStudioRuns(t),queryFn:()=>Yu(t),enabled:!!t,staleTime:1e4,retry:!1}),D=(0,P.useMemo)(()=>w?.missing??[],[w?.missing]),ne=(0,P.useMemo)(()=>w?.warnings??[],[w?.warnings]),re=!!w?.snapshot.snapshotId,k=D.length>0,ie=ed(w?.indexingHealth.overall),A=re&&ie&&!k,ae=i({mutationFn:async()=>Ai(t),onSuccess:async n=>{e.setQueryData(W.forwardNetworkAssuranceSummary(t),n),O.success(`Forward assurance refreshed`)},onError:e=>O.error(`Refresh failed`,{description:e.message})}),oe=i({mutationFn:async()=>Mi(t),onSuccess:e=>O.success(`Demo signals seeded`,{description:`syslog=${e.inserted?.syslog??0}, traps=${e.inserted?.snmpTraps??0}`}),onError:e=>O.error(`Signal seed failed`,{description:e.message})}),se=i({mutationFn:async e=>{if(!w?.snapshot.snapshotId)throw Error(`No Forward snapshot available yet`);let r=Math.max(5,Math.min(300,Number.parseInt(c,10)||120)),i=((await Fu(t,{snapshotId:w.snapshot.snapshotId,mode:`mesh`,includeGroups:!0,maxDevices:30,maxDemands:r})).demands??[]).filter(e=>String(e.dstIp??``).trim()).slice(0,r);if(i.length===0)throw Error(`No traffic demands could be generated from this Forward snapshot`);let o=Number.parseFloat(a),s=Math.max(1,Math.min(10,Number.parseInt(u,10)||3)),l=await Ju(t,{snapshotId:w.snapshot.snapshotId,window:String(n||`24h`),demands:i,phases:{routing:e===`routing`,capacity:e===`capacity`,security:e===`security`},routing:e===`routing`?{thresholdUtil:Number.isFinite(o)?o:.8,forward:{maxResults:s},enforcement:{requireEnforcement:!0},includeHops:p,includeAcl:g,projectLoad:!0}:void 0,capacity:e===`capacity`?{includeHops:p,includeUpgradeCandidates:!0}:void 0,security:e===`security`?{requireEnforcement:v,includeReturnPath:b,requireSymmetricDelivery:b?!0:void 0,requireReturnEnforcement:b?!0:void 0,intent:`PREFER_DELIVERED`,includeTags:!0,includeNetworkFunctions:!0,maxCandidates:2e3,maxResults:1,maxReturnPathResults:b?1:0,maxSeconds:25,maxOverallSeconds:180}:void 0}),d={...l.errors??{}},f={},m={snapshotId:w.snapshot.snapshotId,window:String(n||`24h`),thresholdUtil:e===`routing`&&Number.isFinite(o)?o:void 0,demands:i,routing:e===`routing`?{includeHops:p,includeAcl:g,maxResults:s,requireEnforcement:!0}:void 0,capacity:e===`capacity`?{includeHops:p,includeUpgradeCandidates:!0}:void 0,security:e===`security`?{requireEnforcement:v,includeReturnPath:b,requireSymmetricDelivery:b?!0:void 0,requireReturnEnforcement:b?!0:void 0}:void 0};e===`routing`&&(l.routing?f.routingEval=l.routing:d.routing=d.routing??`Routing evaluation failed`),e===`capacity`&&(l.capacity?f.capacityBottlenecks=l.capacity:d.capacity=d.capacity??`Capacity evaluation failed`,l.capacityUpgradeCandidates&&(f.capacityUpgradeCandidates=l.capacityUpgradeCandidates)),e===`security`&&(l.security?f.securityPathsAssurance=l.security:d.security=d.security??`Security evaluation failed`),Object.keys(d).length>0&&(f.errors=d);let h=Object.keys(d).length===0?`SUCCEEDED`:Object.keys(f).length>1?`PARTIAL`:`FAILED`;return{preset:e,status:h,runId:(await Xu(t,{title:`${td(e)} preset (${new Date().toISOString()})`,status:h,error:Object.keys(d).length>0?JSON.stringify(d):void 0,request:m,results:f})).id,demandCount:i.length}},onSuccess:async n=>{await e.invalidateQueries({queryKey:W.assuranceStudioRuns(t)}),O.success(`${td(n.preset)} preset finished`,{description:`status=${n.status}, run=${n.runId}, demands=${n.demandCount}`})},onError:e=>O.error(`Preset run failed`,{description:e.message})});return(0,I.jsxs)(`div`,{className:`space-y-6 p-6 pb-20`,children:[(0,I.jsxs)(`div`,{className:`flex items-start justify-between gap-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3 min-w-0`,children:[(0,I.jsx)(m,{to:`/dashboard/fwd`,className:So({variant:`outline`,size:`icon`,className:`h-9 w-9`}),children:(0,I.jsx)(it,{className:`h-4 w-4`})}),(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Assurance Hub`}),(0,I.jsxs)(`p`,{className:`text-sm text-muted-foreground truncate`,children:[T?.name??t,`  Forward network`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:T?.forwardNetworkId??``})]})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(R,{variant:`outline`,onClick:()=>ae.mutate(),disabled:ae.isPending,children:[(0,I.jsx)(nt,{className:`h-4 w-4 mr-2`}),ae.isPending?`Refreshing`:`Refresh`]}),(0,I.jsx)(R,{asChild:!0,variant:`outline`,children:(0,I.jsx)(m,{to:`/dashboard/fwd/$networkRef/assurance-studio`,params:{networkRef:t},children:`Advanced`})})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Step 1  Validate Forward data`}),(0,I.jsx)(H,{children:`Confirm snapshot, indexing, and signal readiness before running checks.`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[C.isLoading?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading readiness`}):C.isError?(0,I.jsxs)(`div`,{className:`text-sm text-destructive`,children:[`Failed to load readiness: `,C.error.message]}):w?(0,I.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-3 text-sm`,children:[(0,I.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`Snapshot`}),(0,I.jsx)(`div`,{className:`font-mono text-xs mt-1`,children:w.snapshot.snapshotId||``}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground mt-1`,children:[`processed `,$u(w.snapshot.processedAt)]})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`Indexing`}),(0,I.jsx)(`div`,{className:`mt-1`,children:(0,I.jsx)(K,{variant:w.indexingHealth.overall===`ok`?`default`:`secondary`,children:w.indexingHealth.overall})}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground mt-1`,children:[`path-search`,` `,w.indexingHealth.pathSearchIndexingStatus||``]})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`Collection`}),(0,I.jsxs)(`div`,{className:`text-xs mt-1`,children:[`success devices`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:w.collectionHealth.numSuccessfulDevices??0})]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`failed devices`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:w.collectionHealth.numCollectionFailureDevices??0})]})]})]}):null,D.length>0?(0,I.jsxs)(`div`,{className:`rounded-md border border-amber-300 bg-amber-50 p-3 text-sm`,children:[(0,I.jsx)(`div`,{className:`font-medium text-amber-900`,children:`Missing evidence`}),(0,I.jsx)(`div`,{className:`mt-2 flex flex-wrap gap-2`,children:D.map(e=>(0,I.jsx)(K,{variant:`secondary`,children:e},e))}),(0,I.jsx)(`div`,{className:`mt-3 text-xs text-amber-900`,children:`Next steps: run a Forward collection for this network, verify SNMP credentials are present on the network, then click Refresh.`})]}):null,ne.length>0?(0,I.jsxs)(`div`,{className:`rounded-md border p-3 text-sm space-y-1`,children:[(0,I.jsx)(`div`,{className:`font-medium`,children:`Warnings`}),ne.map(e=>(0,I.jsx)(`div`,{className:`text-muted-foreground text-xs`,children:e},e))]}):null,(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(R,{variant:`outline`,onClick:()=>oe.mutate(),disabled:oe.isPending,children:oe.isPending?`Seeding`:`Seed SNMP/Syslog demo`}),(0,I.jsx)(K,{variant:A?`default`:`secondary`,children:A?`Ready`:`Needs data`})]}),re&&!ie?(0,I.jsx)(`div`,{className:`text-xs text-amber-700`,children:`Indexing is not ready yet. Wait for Forward indexing to complete, then refresh before running presets.`}):null]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Step 2  Run preset checks`}),(0,I.jsx)(H,{children:`Use one-click presets for routing, capacity, or security. Advanced tuning stays hidden by default.`})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`grid gap-3 md:grid-cols-3`,children:[(0,I.jsxs)(R,{variant:`outline`,className:`justify-start`,disabled:!A||se.isPending,onClick:()=>se.mutate(`routing`),children:[se.isPending&&se.variables===`routing`?(0,I.jsx)(Gt,{className:`h-4 w-4 mr-2 animate-spin`}):(0,I.jsx)(de,{className:`h-4 w-4 mr-2`}),`Routing preset`]}),(0,I.jsxs)(R,{variant:`outline`,className:`justify-start`,disabled:!A||se.isPending,onClick:()=>se.mutate(`capacity`),children:[se.isPending&&se.variables===`capacity`?(0,I.jsx)(Gt,{className:`h-4 w-4 mr-2 animate-spin`}):(0,I.jsx)(de,{className:`h-4 w-4 mr-2`}),`Capacity preset`]}),(0,I.jsxs)(R,{variant:`outline`,className:`justify-start`,disabled:!A||se.isPending,onClick:()=>se.mutate(`security`),children:[se.isPending&&se.variables===`security`?(0,I.jsx)(Gt,{className:`h-4 w-4 mr-2 animate-spin`}):(0,I.jsx)(de,{className:`h-4 w-4 mr-2`}),`Security preset`]})]}),(0,I.jsx)(R,{variant:`ghost`,size:`sm`,onClick:()=>S(e=>!e),children:ee?`Hide advanced options`:`Show advanced options`}),ee?(0,I.jsxs)(`div`,{className:`rounded-md border p-3 grid gap-4 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Window`}),(0,I.jsx)(J,{value:n,onChange:e=>r(e.target.value),placeholder:`24h`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Threshold util (routing)`}),(0,I.jsx)(J,{value:a,onChange:e=>s(e.target.value),placeholder:`0.8`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Max seeded demands`}),(0,I.jsx)(J,{value:c,onChange:e=>l(e.target.value),placeholder:`120`})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(q,{children:`Max path results (routing)`}),(0,I.jsx)(J,{value:u,onChange:e=>d(e.target.value),placeholder:`3`})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-3 space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(q,{htmlFor:`adv-include-hops`,children:`Include hops`}),(0,I.jsx)(Gs,{id:`adv-include-hops`,checked:p,onCheckedChange:e=>h(!!e)})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(q,{htmlFor:`adv-include-acl`,children:`Include ACL`}),(0,I.jsx)(Gs,{id:`adv-include-acl`,checked:g,onCheckedChange:e=>_(!!e)})]})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-3 space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(q,{htmlFor:`adv-sec-enforce`,children:`Security enforcement`}),(0,I.jsx)(Gs,{id:`adv-sec-enforce`,checked:v,onCheckedChange:e=>y(!!e)})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(q,{htmlFor:`adv-sec-return`,children:`Include return path`}),(0,I.jsx)(Gs,{id:`adv-sec-return`,checked:b,onCheckedChange:e=>x(!!e)})]})]})]}):null]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Step 3  Review findings`}),(0,I.jsx)(H,{children:`Recent preset runs are stored as Assurance Studio runs.`})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[E.isLoading?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loading runs`}):E.isError?(0,I.jsxs)(`div`,{className:`text-sm text-destructive`,children:[`Failed to load runs: `,E.error.message]}):(E.data?.runs??[]).length===0?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No runs yet. Start with a preset in Step 2.`}):(0,I.jsx)(`div`,{className:`space-y-2`,children:(E.data?.runs??[]).slice(0,8).map(e=>(0,I.jsxs)(`div`,{className:`rounded-md border p-3 flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-medium truncate`,children:String(e.title)}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:$u(e.startedAt||e.createdAt)}),e.error?(0,I.jsx)(`div`,{className:`text-xs text-destructive mt-1 truncate`,children:e.error}):null]}),(0,I.jsx)(K,{variant:String(e.status)===`SUCCEEDED`?`default`:String(e.status)===`PARTIAL`?`secondary`:`destructive`,children:String(e.status)})]},String(e.id)))}),(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-2 pt-2`,children:[(0,I.jsx)(R,{asChild:!0,variant:`outline`,size:`sm`,children:(0,I.jsx)(m,{to:`/dashboard/fwd/$networkRef/assurance`,params:{networkRef:t},children:`Assurance summary`})}),(0,I.jsx)(R,{asChild:!0,variant:`outline`,size:`sm`,children:(0,I.jsx)(m,{to:`/dashboard/fwd/$networkRef/capacity`,params:{networkRef:t},children:`Capacity explorer`})}),(0,I.jsx)(R,{asChild:!0,variant:`outline`,size:`sm`,children:(0,I.jsx)(m,{to:`/dashboard/fwd/$networkRef/assurance-studio`,params:{networkRef:t},children:`Legacy studio`})})]})]})]})]})}function rd(e,t,n){return Math.max(t,Math.min(n,e))}function id({points:e,className:t,strokeClassName:n=`stroke-foreground`,fillClassName:r=`fill-muted/30`}){let{path:i,area:a}=(0,P.useMemo)(()=>{if(!e.length)return{path:``,area:``};let t=e.map(e=>e.y).filter(e=>Number.isFinite(e)),n=t.length?Math.min(...t):0,r=(t.length?Math.max(...t):1)-n||1,i=e.map((t,i)=>({x:e.length<=1?0:i/(e.length-1)*100,y:rd(40-(t.y-n)/r*40,0,40)})).map((e,t)=>`${t===0?`M`:`L`} ${e.x.toFixed(2)} ${e.y.toFixed(2)}`).join(` `);return{path:i,area:`${i} L 100 40 L 0 40 Z`}},[e]);return e.length?(0,I.jsxs)(`svg`,{viewBox:`0 0 100 40`,preserveAspectRatio:`none`,className:F(`h-24 w-full rounded-md border bg-background`,t),role:`img`,"aria-label":`Trend chart`,children:[(0,I.jsx)(`title`,{children:`Trend chart`}),(0,I.jsx)(`path`,{d:a,className:F(r)}),(0,I.jsx)(`path`,{d:i,className:F(`fill-none stroke-[1.25]`,n),vectorEffect:`non-scaling-stroke`})]}):(0,I.jsx)(`div`,{className:F(`flex h-24 items-center justify-center rounded-md border text-xs text-muted-foreground`,t),children:`No data`})}var ad=qn({});const od=t(`/dashboard/fwd/$networkRef/capacity`)({validateSearch:e=>ad.parse(e),component:vd});function sd(e){try{return JSON.stringify(e,null,2)}catch{return String(e)}}function cd(e,t,n){let r=new Blob([n],{type:t}),i=URL.createObjectURL(r);try{let t=document.createElement(`a`);t.href=i,t.download=e,t.click()}finally{URL.revokeObjectURL(i)}}function ld(e){let t=e==null?``:String(e);return t.includes(`"`)||t.includes(`,`)||t.includes(`
`)||t.includes(`\r`)?`"${t.replaceAll(`"`,`""`)}"`:t}function ud(e,t){let n=[e.map(ld).join(`,`)];for(let e of t)n.push(e.map(ld).join(`,`));return n.join(`
`)+`
`}function dd(e){if(!e)return null;let t=Date.parse(e);return Number.isFinite(t)?new Date(t):null}function fd(e){return e===void 0||!Number.isFinite(e)?``:`${(e*100).toFixed(1)}%`}function pd(e,t=3){return e===void 0||!Number.isFinite(e)?``:e.toFixed(t)}function md(e){let t=Number(e??0);return!Number.isFinite(t)||t<=0?``:t>=1e5||t>=1e4?`${(t/1e3).toFixed(0)}G`:t>=1e3?`${(t/1e3).toFixed(1)}G`:`${t}M`}function hd(e,t){if(!e.length)return null;let n=[...e].filter(e=>Number.isFinite(e)).sort((e,t)=>e-t);if(!n.length)return null;if(t<=0)return n[0];if(t>=1)return n[n.length-1];let r=t*(n.length-1),i=Math.floor(r),a=Math.ceil(r);if(i===a)return n[i];let o=r-i;return n[i]*(1-o)+n[a]*o}function gd(e){return e.startsWith(`util_`)?`UTILIZATION`:e.includes(`packet_loss`)?`PACKET_LOSS`:`ERROR`}function _d(e){return e.includes(`memory`)?`MEMORY`:`CPU`}function vd(){let{networkRef:e}=od.useParams();od.useSearch();let t=o(),[n,r]=(0,P.useState)(`24h`),[a,s]=(0,P.useState)(`util_ingress`),[c,l]=(0,P.useState)(`device_cpu`),[u,d]=(0,P.useState)(``),[p,h]=(0,P.useState)(``),[g,_]=(0,P.useState)(`all`),[v,y]=(0,P.useState)(`all`),[b,x]=(0,P.useState)(`all`),[ee,S]=(0,P.useState)(`all`),[C,w]=(0,P.useState)(`none`),[te,T]=(0,P.useState)(168),[E,D]=(0,P.useState)(`util_ingress`),[ne,re]=(0,P.useState)(`device_cpu`),[k,ie]=(0,P.useState)(null),[A,ae]=(0,P.useState)(null),[oe,se]=(0,P.useState)(null),[ce,le]=(0,P.useState)(!1),[ue,de]=(0,P.useState)(``),[fe,pe]=(0,P.useState)(!1),[me,he]=(0,P.useState)(``),[ge,_e]=(0,P.useState)(`all`),[j,ve]=(0,P.useState)(`all`),[ye,be]=(0,P.useState)(!1),[xe,Ce]=(0,P.useState)(``),[we,Te]=(0,P.useState)(``),Ee=f({queryKey:W.userForwardNetworks(),queryFn:()=>lo(),enabled:!0,retry:!1,staleTime:3e4}),De=f({queryKey:W.userForwardNetworks(),queryFn:lo,retry:!1,staleTime:3e4}),Oe=(0,P.useMemo)(()=>{let t=Ee.data?.networks??[],n=De.data?.networks??[],r=t.find(t=>String(t?.id??``)===String(e))??n.find(t=>String(t?.id??``)===String(e));return String(r?.name??``)},[Ee.data?.networks,De.data?.networks,e]),M=f({queryKey:W.forwardNetworkCapacitySummary(e),queryFn:()=>Di(e),enabled:!!e,retry:!1,staleTime:3e4}),N=f({queryKey:W.forwardNetworkCapacityInventory(e),queryFn:()=>Li(e),enabled:!!e,retry:!1,staleTime:3e4}),ke=f({queryKey:W.forwardNetworkCapacityCoverage(e),queryFn:()=>Ni(e),enabled:!!e,retry:!1,staleTime:3e4}),Ae=f({queryKey:W.forwardNetworkCapacitySnapshotDelta(e),queryFn:()=>Pi(e),enabled:!!e,retry:!1,staleTime:3e4}),je=f({queryKey:W.forwardNetworkCapacityUpgradeCandidates(e,n),queryFn:()=>Fi(e,{window:n}),enabled:!!e,retry:!1,staleTime:3e4}),Me=String(M.data?.forwardNetworkId??N.data?.forwardNetworkId??``),Ne=(0,P.useMemo)(()=>{let e=new Map;for(let t of N.data?.interfaces??[]){let n=String(t.deviceName??``).trim(),r=String(t.interfaceName??``).trim();if(!n||!r)continue;let i=String(t.aggregateId??``).trim(),a=String(t.interfaceType??``).trim();e.set(`${n}|${r}`,{aggregateId:i||void 0,interfaceType:a||void 0})}return e},[N.data?.interfaces]),Pe=i({mutationFn:async()=>Oi(e),onSuccess:async n=>{O.success(`Refresh queued`,{description:`Run ${String(n.run?.id??``)}`.trim()}),await t.invalidateQueries({queryKey:W.forwardNetworkCapacitySummary(e)}),await t.invalidateQueries({queryKey:W.forwardNetworkCapacityInventory(e)}),await t.invalidateQueries({queryKey:W.forwardNetworkCapacityCoverage(e)}),await t.invalidateQueries({queryKey:W.forwardNetworkCapacitySnapshotDelta(e)}),await t.invalidateQueries({queryKey:[`forwardNetworkCapacityUpgradeCandidates`,e]}),await t.invalidateQueries({queryKey:W.forwardNetworkCapacityPortfolio()}),await t.invalidateQueries({queryKey:[`forwardNetworkCapacityGrowth`,e]})},onError:e=>O.error(`Failed to refresh`,{description:e.message})}),Fe=i({mutationFn:async()=>Gi(e,{}),onSuccess:e=>se(e.body),onError:e=>O.error(`Failed to load unhealthy devices`,{description:e.message})}),Ie=(0,P.useMemo)(()=>{let e=N.data?.devices??[],t=N.data?.interfaceVrfs??[],n=new Set,r=new Set,i=new Set,a=new Set;for(let t of e){for(let e of t.tagNames??[]){let t=String(e??``).trim();t&&n.add(t)}for(let e of t.groupNames??[]){let t=String(e??``).trim();t&&r.add(t)}let e=String(t.locationName??``).trim();e&&i.add(e)}for(let e of t){let t=String(e.vrf??``).trim();t&&a.add(t)}return{tags:Array.from(n).sort(),groups:Array.from(r).sort(),locations:Array.from(i).sort(),vrfs:Array.from(a).sort()}},[N.data?.devices,N.data?.interfaceVrfs]),Le=n===`24h`?1:n===`7d`?7:30,Re=M.data?.rollups??[],ze=(0,P.useMemo)(()=>{let e=u.trim().toLowerCase(),t=Re.filter(e=>e.objectType===`interface`&&e.window===n&&e.metric===a).map(e=>{let t=e.details??{},n=String(t.deviceName??``).trim(),r=String(t.interfaceName??``).trim(),i=String(t.direction??``).trim(),a=String(t.vrf??``).trim()||void 0,o=Array.isArray(t.vrfNames)?t.vrfNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,s=String(t.locationName??``).trim()||void 0,c=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,l=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,u=Ne.get(`${n}|${r}`),d=u?.aggregateId,f=u?.interfaceType===`IF_AGGREGATE`;return{id:`${n}:${r}:${i}:${e.metric}:${e.window}`,device:n,iface:r,dir:i,aggregateId:d,isAggregate:f,vrf:a,vrfNames:o,locationName:s,tagNames:c,groupNames:l,speedMbps:t.speedMbps??null,admin:String(t.adminStatus??``).trim()||void 0,oper:String(t.operStatus??``).trim()||void 0,p95:e.p95,p99:e.p99,max:e.max,slopePerDay:e.slopePerDay,forecastCrossingTs:e.forecastCrossingTs,threshold:e.threshold,samples:e.samples,raw:e}}),r=(e?t.filter(t=>t.device.toLowerCase().includes(e)||t.iface.toLowerCase().includes(e)||(t.dir||``).toLowerCase().includes(e)):t).filter(e=>{if(b!==`all`&&(e.locationName??``)!==b)return!1;if(ee!==`all`){let t=ee;if(e.vrf!==t&&!(e.vrfNames??[]).includes(t))return!1}return!(g!==`all`&&!(e.tagNames??[]).includes(g)||v!==`all`&&!(e.groupNames??[]).includes(v))});return r.sort((e,t)=>(t.max??0)-(e.max??0)),r},[Re,n,a,u,b,ee,g,v]),Be=(0,P.useMemo)(()=>{let e=p.trim().toLowerCase(),t=Re.filter(e=>e.objectType===`device`&&e.window===n&&e.metric===c).map(e=>{let t=e.details??{},n=String(t.deviceName??``).trim(),r=String(t.locationName??``).trim()||void 0,i=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,a=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0;return{id:`${n}:${e.metric}:${e.window}`,device:n,metric:e.metric,locationName:r,tagNames:i,groupNames:a,vendor:String(t.vendor??``).trim()||void 0,os:String(t.os??``).trim()||void 0,model:String(t.model??``).trim()||void 0,p95:e.p95,p99:e.p99,max:e.max,slopePerDay:e.slopePerDay,forecastCrossingTs:e.forecastCrossingTs,threshold:e.threshold,samples:e.samples,raw:e}}),r=(e?t.filter(t=>t.device.toLowerCase().includes(e)||(t.vendor||``).toLowerCase().includes(e)||(t.os||``).toLowerCase().includes(e)||(t.model||``).toLowerCase().includes(e)):t).filter(e=>!(b!==`all`&&(e.locationName??``)!==b||g!==`all`&&!(e.tagNames??[]).includes(g)||v!==`all`&&!(e.groupNames??[]).includes(v)));return r.sort((e,t)=>(t.max??0)-(e.max??0)),r},[Re,n,c,p,b,g,v]),Ve=(0,P.useMemo)(()=>{if(C===`none`)return[];let e=new Map,t=new Map,n=(n,r)=>{let i=e.get(n)??{group:n,count:0,hotCount:0,sumSpeedGbps:0,sumP95Gbps:0,sumMaxGbps:0,p95Count:0};i.count+=1,t.has(n)||t.set(n,new Set),t.get(n).add(r.device);let o=r.max??0,s=r.p95??void 0;if(i.maxMax=Math.max(i.maxMax??0,o),s!==void 0&&(i.maxP95=Math.max(i.maxP95??0,s),a.startsWith(`util_`))){let e=Number(r.speedMbps??0);if(e>0){let t=s*e/1e3;i.maxP95Gbps=Math.max(i.maxP95Gbps??0,t)}}if(a.startsWith(`util_`)){let e=Number(r.speedMbps??0);if(e>0&&(i.sumSpeedGbps=(i.sumSpeedGbps??0)+e/1e3,s!==void 0&&Number.isFinite(s)&&(i.sumP95Gbps=(i.sumP95Gbps??0)+s*e/1e3,i.p95Count=(i.p95Count??0)+1),r.max!==void 0&&r.max!==null&&Number.isFinite(r.max)&&(i.sumMaxGbps=(i.sumMaxGbps??0)+Number(r.max)*e/1e3)),r.forecastCrossingTs){let e=r.forecastCrossingTs;i.soonestForecast?Date.parse(e)<Date.parse(i.soonestForecast)&&(i.soonestForecast=e):i.soonestForecast=e}}a.startsWith(`util_`)&&o>=(r.threshold??.85)&&(i.hotCount+=1),e.set(n,i)};for(let e of ze)if(C===`location`)n(e.locationName??`unknown`,e);else if(C===`tag`){let t=e.tagNames?.length?e.tagNames:[`untagged`];for(let r of t)n(r,e)}else if(C===`group`){let t=e.groupNames?.length?e.groupNames:[`ungrouped`];for(let r of t)n(r,e)}else C===`vrf`&&n(e.vrf??e.vrfNames?.[0]??`unknown`,e);let r=Array.from(e.values());if(C===`vrf`){let e=N.data?.routeScale??[],n=N.data?.bgpNeighbors??[];for(let i of r){let r=t.get(i.group)??new Set,a=0,o=0,s=0,c=0;for(let t of e)t.vrf===i.group&&r.has(t.deviceName)&&(a+=Number(t.ipv4Routes??0),o+=Number(t.ipv6Routes??0));for(let e of n)e.vrf===i.group&&r.has(e.deviceName)&&(s+=1,String(e.sessionState??``).toUpperCase().includes(`ESTABLISHED`)&&(c+=1));i.ipv4RoutesSum=a,i.ipv6RoutesSum=o,i.bgpNeighbors=s,i.bgpEstablished=c}}return r.sort((e,t)=>(t.maxP95Gbps??t.maxP95??0)-(e.maxP95Gbps??e.maxP95??0)),r},[ze,C,a,N.data?.routeScale,N.data?.bgpNeighbors]),He=(0,P.useMemo)(()=>{if(C===`none`)return[];let e=new Map,t=(t,n)=>{let r=e.get(t)??{group:t,count:0,hotCount:0};r.count+=1;let i=n.max??0,a=n.p95??void 0;r.maxMax=Math.max(r.maxMax??0,i),a!==void 0&&(r.maxP95=Math.max(r.maxP95??0,a)),i>=(n.threshold??.85)&&(r.hotCount+=1),e.set(t,r)};for(let e of Be)if(C===`location`)t(e.locationName??`unknown`,e);else if(C===`tag`){let n=e.tagNames?.length?e.tagNames:[`untagged`];for(let r of n)t(r,e)}else if(C===`group`){let n=e.groupNames?.length?e.groupNames:[`ungrouped`];for(let r of n)t(r,e)}let n=Array.from(e.values());return n.sort((e,t)=>(t.maxP95??0)-(e.maxP95??0)),n},[Be,C]),Ue=(0,P.useMemo)(()=>{let e=Re.filter(e=>e.metric.startsWith(`util_`));return{above:e.filter(e=>(e.max??0)>=.85).length,soonest:e.map(e=>({ts:e.forecastCrossingTs??``,r:e})).filter(e=>e.ts).sort((e,t)=>Date.parse(e.ts)-Date.parse(t.ts))[0]?.r}},[Re]),We=f({queryKey:[`capacityIfaceHistory`,e,n,a,k?.id??``],queryFn:async()=>k?(await Vi(e,{type:gd(a),days:Le,maxSamples:400,interfaces:[{deviceName:k.device,interfaceName:k.iface,direction:k.dir}]})).body:null,enabled:!!(k&&Me),retry:!1,staleTime:1e4}),Ge=f({queryKey:[`capacityDeviceHistory`,e,n,c,A?.id??``],queryFn:async()=>A?(await Ui(e,{type:_d(c),days:Le,maxSamples:400,devices:[A.device]})).body:null,enabled:!!(A&&Me),retry:!1,staleTime:1e4}),Ke=(0,P.useMemo)(()=>{let e=We.data?.metrics?.[0];return(Array.isArray(e?.data)?e.data:[]).map(e=>({x:String(e?.instant??``),y:Number(e?.value??NaN)})).filter(e=>e.x&&Number.isFinite(e.y))},[We.data]),qe=(0,P.useMemo)(()=>{let e=Ge.data?.metrics?.[0];return(Array.isArray(e?.data)?e.data:[]).map(e=>({x:String(e?.instant??``),y:Number(e?.value??NaN)})).filter(e=>e.x&&Number.isFinite(e.y))},[Ge.data]),Je=(0,P.useMemo)(()=>{let e=Ke.map(e=>e.y);return{p95:hd(e,.95),p99:hd(e,.99),max:e.length?Math.max(...e):null}},[Ke]),Ye=(0,P.useMemo)(()=>{let e=qe.map(e=>e.y);return{p95:hd(e,.95),p99:hd(e,.99),max:e.length?Math.max(...e):null}},[qe]),Xe=(0,P.useMemo)(()=>[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:200},{id:`iface`,header:`Interface`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.iface}),width:220},{id:`lag`,header:`LAG`,cell:e=>e.isAggregate?(0,I.jsx)(K,{variant:`secondary`,children:`aggregate`}):e.aggregateId?(0,I.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:e.aggregateId}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}),width:170},{id:`dir`,header:`Dir`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.dir||``}),width:90},{id:`vrf`,header:`VRF`,cell:e=>{let t=e.vrf??e.vrfNames?.[0]??``;if(!t)return(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let n=(e.vrfNames??[]).length;return(0,I.jsxs)(`div`,{className:`text-xs`,children:[(0,I.jsx)(`div`,{className:`font-mono`,children:t}),n>1?(0,I.jsxs)(`div`,{className:`text-muted-foreground`,children:[n,` vrfs`]}):null]})},width:160},{id:`speed`,header:`Speed`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:md(e.speedMbps??null)}),width:90,align:`right`},{id:`state`,header:`State`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:[e.admin,e.oper].filter(Boolean).join(` / `)||``}),width:140},{id:`p95`,header:`p95`,align:`right`,cell:e=>a.startsWith(`util_`)?fd(e.p95):pd(e.p95),width:90},...a.startsWith(`util_`)?[{id:`p95Gbps`,header:`p95 (Gbps)`,align:`right`,cell:e=>{let t=Number(e.speedMbps??0),n=Number(e.p95??NaN);return!t||!Number.isFinite(n)?(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,I.jsx)(`span`,{className:`text-xs`,children:(n*t/1e3).toFixed(2)})},width:110}]:[],{id:`max`,header:`Max`,align:`right`,cell:e=>{let t=a.startsWith(`util_`)?fd(e.max):pd(e.max),n=e.threshold??(a.startsWith(`util_`)?.85:void 0);return(0,I.jsx)(`span`,{className:n!==void 0&&(e.max??0)>=n?`text-destructive font-medium`:``,children:t})},width:90},...a.startsWith(`util_`)?[{id:`maxGbps`,header:`Max (Gbps)`,align:`right`,cell:e=>{let t=Number(e.speedMbps??0),n=Number(e.max??NaN);return!t||!Number.isFinite(n)?(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,I.jsx)(`span`,{className:`text-xs`,children:(n*t/1e3).toFixed(2)})},width:110},{id:`headroom85`,header:`Headroom@85 (Gbps)`,align:`right`,cell:e=>{let t=Number(e.speedMbps??0),n=Number(e.p95??NaN),r=Number(e.threshold??.85);return!t||!Number.isFinite(n)||!Number.isFinite(r)?(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,I.jsx)(`span`,{className:`text-xs`,children:(Math.max(0,(r-n)*t)/1e3).toFixed(2)})},width:150},{id:`days85`,header:`Days@85`,align:`right`,cell:e=>{if(!e.forecastCrossingTs)return(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let t=dd(e.forecastCrossingTs);return t?(0,I.jsx)(`span`,{className:`text-xs`,children:Math.round((t.getTime()-Date.now())/(24*3600*1e3))}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90}]:[],{id:`slope`,header:`Slope/d`,align:`right`,cell:e=>a.startsWith(`util_`)?fd(e.slopePerDay):pd(e.slopePerDay),width:100},{id:`forecast`,header:`Forecast`,cell:e=>{if(!e.forecastCrossingTs)return(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let t=dd(e.forecastCrossingTs),n=t?Math.round((t.getTime()-Date.now())/(24*3600*1e3)):null;return(0,I.jsxs)(`div`,{className:`text-xs`,children:[(0,I.jsx)(`div`,{className:`font-mono`,children:e.forecastCrossingTs.slice(0,10)}),n===null?null:(0,I.jsxs)(`div`,{className:`text-muted-foreground`,children:[n,`d`]})]})},width:120},{id:`samples`,header:`N`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.samples||0}),width:70}],[a]),Ze=(0,P.useMemo)(()=>[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:240},{id:`meta`,header:`Meta`,cell:e=>(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[(0,I.jsx)(`div`,{children:[e.vendor,e.os].filter(Boolean).join(`  `)||``}),(0,I.jsx)(`div`,{className:`font-mono`,children:e.model||``})]}),width:240},{id:`p95`,header:`p95`,align:`right`,cell:e=>fd(e.p95),width:90},{id:`max`,header:`Max`,align:`right`,cell:e=>{let t=e.threshold??.85;return(0,I.jsx)(`span`,{className:(e.max??0)>=t?`text-destructive font-medium`:``,children:fd(e.max)})},width:90},{id:`slope`,header:`Slope/d`,align:`right`,cell:e=>fd(e.slopePerDay),width:100},{id:`forecast`,header:`Forecast`,cell:e=>{if(!e.forecastCrossingTs)return(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let t=dd(e.forecastCrossingTs),n=t?Math.round((t.getTime()-Date.now())/(24*3600*1e3)):null;return(0,I.jsxs)(`div`,{className:`text-xs`,children:[(0,I.jsx)(`div`,{className:`font-mono`,children:e.forecastCrossingTs.slice(0,10)}),n===null?null:(0,I.jsxs)(`div`,{className:`text-muted-foreground`,children:[n,`d`]})]})},width:120},{id:`samples`,header:`N`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.samples||0}),width:70}],[]),Qe=f({queryKey:W.forwardNetworkCapacityGrowth(e,n,E,te,`interface`),queryFn:()=>zi(e,{metric:E,window:n,objectType:`interface`,compareHours:te,limit:50}),enabled:!!(e&&Me),retry:!1,staleTime:3e4}),$e=f({queryKey:W.forwardNetworkCapacityGrowth(e,n,ne,te,`device`),queryFn:()=>zi(e,{metric:ne,window:n,objectType:`device`,compareHours:te,limit:50}),enabled:!!(e&&Me),retry:!1,staleTime:3e4}),et=(0,P.useMemo)(()=>(Qe.data?.rows??[]).map(e=>{let t=e?.now?.details??{},n=String(t.deviceName??e.objectId??``).trim(),r=String(t.interfaceName??``).trim(),i=String(t.direction??``).trim(),a=String(t.locationName??``).trim()||void 0,o=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,s=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0;return{id:String(e?.objectId??`${n}:${r}:${i}`),device:n,iface:r,dir:i,locationName:a,tagNames:o,groupNames:s,speedMbps:t.speedMbps??null,nowP95:e?.now?.p95,prevP95:e?.prev?.p95??null,deltaP95:e?.deltaP95??null,deltaP95Gbps:e?.deltaP95Gbps??null,nowMax:e?.now?.max,prevMax:e?.prev?.max??null,deltaMax:e?.deltaMax??null,nowForecast:e?.now?.forecastCrossingTs??void 0,raw:e}}).filter(e=>!(b!==`all`&&(e.locationName??``)!==b||g!==`all`&&!(e.tagNames??[]).includes(g)||v!==`all`&&!(e.groupNames??[]).includes(v))),[Qe.data?.rows,b,g,v]),tt=(0,P.useMemo)(()=>($e.data?.rows??[]).map(e=>{let t=e?.now?.details??{},n=String(t.deviceName??e.objectId??``).trim(),r=String(t.locationName??``).trim()||void 0,i=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,a=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0;return{id:String(e?.objectId??n),device:n,locationName:r,tagNames:i,groupNames:a,vendor:String(t.vendor??``).trim()||void 0,os:String(t.os??``).trim()||void 0,model:String(t.model??``).trim()||void 0,nowP95:e?.now?.p95,prevP95:e?.prev?.p95??null,deltaP95:e?.deltaP95??null,nowMax:e?.now?.max,prevMax:e?.prev?.max??null,deltaMax:e?.deltaMax??null,nowForecast:e?.now?.forecastCrossingTs??void 0,raw:e}}).filter(e=>!(b!==`all`&&(e.locationName??``)!==b||g!==`all`&&!(e.tagNames??[]).includes(g)||v!==`all`&&!(e.groupNames??[]).includes(v))),[$e.data?.rows,b,g,v]),rt=(0,P.useMemo)(()=>{let e=new Set,t=new Set;for(let n of N.data?.routeScale??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();r&&e.add(r),i&&t.add(i)}for(let n of N.data?.bgpNeighbors??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();r&&e.add(r),i&&t.add(i)}return{devices:Array.from(e).sort(),vrfs:Array.from(t).sort()}},[N.data?.routeScale,N.data?.bgpNeighbors]),at=(0,P.useMemo)(()=>(N.data?.routeScale??[]).filter(e=>!(ge!==`all`&&e.deviceName!==ge||j!==`all`&&e.vrf!==j)),[N.data?.routeScale,ge,j]),ot=(0,P.useMemo)(()=>(N.data?.bgpNeighbors??[]).filter(e=>!(ge!==`all`&&e.deviceName!==ge||j!==`all`&&e.vrf!==j)),[N.data?.bgpNeighbors,ge,j]),st=(0,P.useMemo)(()=>(N.data?.hardwareTcam??[]).filter(e=>!(ge!==`all`&&e.deviceName!==ge)),[N.data?.hardwareTcam,ge]),ct=(0,P.useMemo)(()=>{let e=new Map,t=(e,t)=>`${e}||${t}`;for(let n of N.data?.routeScale??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();if(!r||!i)continue;let a=t(r,i),o=e.get(a)??{id:a,deviceName:r,vrf:i,ipv4Routes:0,ipv6Routes:0,bgpNeighbors:0,bgpEstablished:0};o.ipv4Routes=Number(n.ipv4Routes??0),o.ipv6Routes=Number(n.ipv6Routes??0),e.set(a,o)}for(let n of N.data?.bgpNeighbors??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();if(!r||!i)continue;let a=t(r,i),o=e.get(a)??{id:a,deviceName:r,vrf:i,ipv4Routes:0,ipv6Routes:0,bgpNeighbors:0,bgpEstablished:0};o.bgpNeighbors+=1,String(n.sessionState??``).toUpperCase().includes(`ESTABLISHED`)&&(o.bgpEstablished+=1),e.set(a,o)}for(let r of Re){if(r.objectType!==`interface`||r.window!==n||!r.metric.startsWith(`util_`))continue;let i=r.details??{},a=String(i.deviceName??``).trim(),o=String(i.vrf??``).trim();if(!a||!o)continue;let s=t(a,o),c=e.get(s)??{id:s,deviceName:a,vrf:o,ipv4Routes:0,ipv6Routes:0,bgpNeighbors:0,bgpEstablished:0};c.maxIfaceMax=Math.max(c.maxIfaceMax??0,r.max??0),r.p95!==void 0&&r.p95!==null&&(c.maxIfaceP95=Math.max(c.maxIfaceP95??0,r.p95??0));let l=r.forecastCrossingTs??``;l&&(c.soonestForecast?Date.parse(l)<Date.parse(c.soonestForecast)&&(c.soonestForecast=l):c.soonestForecast=l),e.set(s,c)}let r=Array.from(e.values());return r.sort((e,t)=>(t.maxIfaceMax??0)-(e.maxIfaceMax??0)),r},[N.data?.routeScale,N.data?.bgpNeighbors,Re,n]);return(0,I.jsxs)(`div`,{className:`space-y-6 p-6 pb-20`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(m,{to:`/dashboard/fwd`,className:So({variant:`outline`,size:`icon`,className:`h-9 w-9`}),title:`Back to Forward networks`,children:(0,I.jsx)(it,{className:`h-4 w-4`})}),(0,I.jsxs)(`div`,{children:[(0,I.jsxs)(`h1`,{className:`text-2xl font-bold tracking-tight flex items-center gap-2`,children:[(0,I.jsx)(Se,{className:`h-5 w-5`}),` Capacity`]}),(0,I.jsxs)(`p`,{className:`text-sm text-muted-foreground mt-1`,children:[`Forward network:`,` `,(0,I.jsx)(`span`,{className:`font-medium`,children:Oe||e}),Me?(0,I.jsx)(`span`,{className:`ml-2 font-mono text-xs`,children:Me}):null]})]})]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsxs)(Y,{value:n,onValueChange:e=>r(e),children:[(0,I.jsx)(Z,{className:`w-[110px]`,children:(0,I.jsx)(X,{placeholder:`Window`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`24h`,children:`24h`}),(0,I.jsx)($,{value:`7d`,children:`7d`}),(0,I.jsx)($,{value:`30d`,children:`30d`})]})]}),(0,I.jsxs)(Y,{value:b,onValueChange:x,children:[(0,I.jsx)(Z,{className:`w-[190px]`,children:(0,I.jsx)(X,{placeholder:`Location`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All locations`}),Ie.locations.map(e=>(0,I.jsx)($,{value:e,children:e},e))]})]}),(0,I.jsxs)(Y,{value:ee,onValueChange:S,children:[(0,I.jsx)(Z,{className:`w-[170px]`,children:(0,I.jsx)(X,{placeholder:`VRF`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All VRFs`}),Ie.vrfs.map(e=>(0,I.jsx)($,{value:e,children:e},e))]})]}),(0,I.jsxs)(Y,{value:g,onValueChange:_,children:[(0,I.jsx)(Z,{className:`w-[170px]`,children:(0,I.jsx)(X,{placeholder:`Tag`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All tags`}),Ie.tags.map(e=>(0,I.jsx)($,{value:e,children:e},e))]})]}),(0,I.jsxs)(Y,{value:v,onValueChange:y,children:[(0,I.jsx)(Z,{className:`w-[170px]`,children:(0,I.jsx)(X,{placeholder:`Group`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All groups`}),Ie.groups.map(e=>(0,I.jsx)($,{value:e,children:e},e))]})]}),(0,I.jsxs)(Y,{value:C,onValueChange:e=>w(e),children:[(0,I.jsx)(Z,{className:`w-[140px]`,children:(0,I.jsx)(X,{placeholder:`Group by`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`none`,children:`No grouping`}),(0,I.jsx)($,{value:`location`,children:`Location`}),(0,I.jsx)($,{value:`tag`,children:`Tag`}),(0,I.jsx)($,{value:`group`,children:`Group`}),(0,I.jsx)($,{value:`vrf`,children:`VRF`})]})]}),(0,I.jsxs)(R,{variant:`outline`,onClick:()=>Pe.mutate(),disabled:Pe.isPending||!Me,title:Me?`Enqueue a background rollup task`:`Load the saved Forward network first`,children:[(0,I.jsx)(nt,{className:`mr-2 h-4 w-4`}),Pe.isPending?`Queueing`:`Refresh`]})]})]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-4 md:grid-cols-4`,children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`As Of`})}),(0,I.jsxs)(U,{className:`text-sm`,children:[(0,I.jsx)(`div`,{className:`font-mono text-xs`,children:M.data?.asOf??N.data?.asOf??``}),(0,I.jsxs)(`div`,{className:`mt-2 flex items-center gap-2`,children:[M.data?.stale?(0,I.jsx)(K,{variant:`destructive`,children:`Stale`}):(0,I.jsx)(K,{variant:`secondary`,children:`Fresh`}),(0,I.jsx)(K,{variant:`outline`,className:`font-mono text-xs`,children:Me||`no-forward`})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`Hot Interfaces`})}),(0,I.jsxs)(U,{className:`text-sm`,children:[(0,I.jsx)(`div`,{className:`text-2xl font-semibold`,children:Ue.above}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground mt-1`,children:`util_* max >= 85%`})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`Soonest Saturation`})}),(0,I.jsx)(U,{className:`text-sm`,children:Ue.soonest?.forecastCrossingTs?(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`font-mono text-xs`,children:Ue.soonest.forecastCrossingTs}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[String(Ue.soonest.details?.deviceName??``),` `,String(Ue.soonest.details?.interfaceName??``),` `,String(Ue.soonest.details?.direction??``)]})]}):(0,I.jsx)(`div`,{className:`text-muted-foreground text-sm`,children:``})})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`Coverage`})}),(0,I.jsx)(U,{className:`text-sm space-y-1`,children:(()=>{let e=ke.data,t=(e,t)=>t?`${(e/t*100).toFixed(0)}%`:``,n=e?t(e.ifacesWithSpeed,e.ifacesTotal):``,r=e?e.rollupsInterfaceTotal+e.rollupsDeviceTotal:0,i=e?t(e.rollupsWithSamples,r):``;return(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Ifaces w/speed`}),(0,I.jsxs)(`div`,{className:`font-medium`,children:[n,` `,(0,I.jsxs)(`span`,{className:`text-xs text-muted-foreground`,children:[`(`,e?`${e.ifacesWithSpeed}/${e.ifacesTotal}`:``,`)`]})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Rollups w/samples`}),(0,I.jsxs)(`div`,{className:`font-medium`,children:[i,` `,(0,I.jsxs)(`span`,{className:`text-xs text-muted-foreground`,children:[`(`,e?`${e.rollupsWithSamples}/${r}`:``,`)`]})]})]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Inv:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:e?.asOfInventory??``}),`  `,`Rollups:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:e?.asOfRollups??``})]})]})})()})]})]}),(0,I.jsxs)(ac,{defaultValue:`interfaces`,className:`space-y-4`,children:[(0,I.jsxs)(oc,{children:[(0,I.jsx)(sc,{value:`scorecard`,children:`Scorecard`}),(0,I.jsx)(sc,{value:`interfaces`,children:`Interfaces`}),(0,I.jsx)(sc,{value:`devices`,children:`Devices`}),(0,I.jsx)(sc,{value:`growth`,children:`Growth`}),(0,I.jsx)(sc,{value:`plan`,children:`Plan`}),(0,I.jsx)(sc,{value:`routing`,children:`Routing/BGP`}),(0,I.jsx)(sc,{value:`changes`,children:`Changes`}),(0,I.jsx)(sc,{value:`health`,children:`Health`}),(0,I.jsx)(sc,{value:`raw`,children:`Raw`})]}),(0,I.jsx)(cc,{value:`scorecard`,className:`space-y-4`,children:(()=>{let e=N.data?.interfaces??[],t=e.filter(e=>String(e.interfaceType??``)===`IF_AGGREGATE`),r=e.filter(e=>String(e.aggregateId??``).trim()),i=je.data?.items??[],a=i.slice(0,10),o=(()=>{let e=null;for(let t of i){let n=String(t.forecastCrossingTs??``).trim();n&&(!e||Date.parse(n)<Date.parse(e))&&(e=n)}return e})();return(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-4 md:grid-cols-3`,children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`Collection`})}),(0,I.jsxs)(U,{className:`text-sm space-y-1`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`As of`}),(0,I.jsx)(`div`,{className:`font-mono text-xs`,children:M.data?.asOf??N.data?.asOf??``})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Status`}),(0,I.jsx)(`div`,{children:M.data?.stale?(0,I.jsx)(K,{variant:`destructive`,children:`Stale`}):(0,I.jsx)(K,{variant:`secondary`,children:`Fresh`})})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Ifaces w/speed`}),(0,I.jsx)(`div`,{className:`font-medium text-xs`,children:ke.data?`${ke.data.ifacesWithSpeed}/${ke.data.ifacesTotal}`:``})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Rollups w/samples`}),(0,I.jsx)(`div`,{className:`font-medium text-xs`,children:ke.data?`${ke.data.rollupsWithSamples}/${ke.data.rollupsInterfaceTotal+ke.data.rollupsDeviceTotal}`:``})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`LAGs`})}),(0,I.jsxs)(U,{className:`text-sm space-y-1`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Aggregate ifaces`}),(0,I.jsx)(`div`,{className:`text-2xl font-semibold`,children:t.length})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Member ifaces`}),(0,I.jsx)(`div`,{className:`text-2xl font-semibold`,children:r.length})]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`LAG membership from NQE (ethernet.aggregateId + aggregation.memberNames).`})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`Upgrade Risk`})}),(0,I.jsxs)(U,{className:`text-sm space-y-1`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Candidates`}),(0,I.jsx)(`div`,{className:`text-2xl font-semibold`,children:i.length})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-between`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Soonest forecast`}),(0,I.jsx)(`div`,{className:`font-mono text-xs`,children:o?o.slice(0,10):``})]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Based on util_* rollups (window `,n,`).`]})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{className:`text-base`,children:`Top Upgrade Candidates`})}),(0,I.jsx)(U,{children:(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:220},{id:`name`,header:`Link`,cell:e=>(0,I.jsxs)(`div`,{className:`text-xs`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`font-mono`,children:e.name}),e.objectType===`lag`?(0,I.jsx)(K,{variant:`secondary`,children:`LAG`}):null]}),e.recommendedSpeedMbps?(0,I.jsxs)(`div`,{className:`text-muted-foreground`,children:[`Rec: `,md(e.recommendedSpeedMbps)]}):null]}),width:260},{id:`max`,header:`Max`,align:`right`,cell:e=>fd(e.maxUtil),width:90},{id:`forecast`,header:`Forecast`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.forecastCrossingTs?String(e.forecastCrossingTs).slice(0,10):``}),width:120},{id:`reason`,header:`Reason`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.reason||``}),width:140}],rows:a,getRowId:e=>`${e.objectType??`iface`}:${e.device}:${e.name}`,emptyText:`No upgrade candidates yet. Click Refresh to enqueue rollups.`,maxHeightClassName:`max-h-[320px]`,minWidthClassName:`min-w-0`})})]})]})})()}),(0,I.jsx)(cc,{value:`interfaces`,className:`space-y-4`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Interface Capacity`}),(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 md:flex-row md:items-center`,children:[(0,I.jsx)(J,{placeholder:`Filter (device / interface)`,value:u,onChange:e=>d(e.target.value),className:`w-[260px]`}),(0,I.jsxs)(Y,{value:a,onValueChange:e=>s(e),children:[(0,I.jsx)(Z,{className:`w-[240px]`,children:(0,I.jsx)(X,{placeholder:`Metric`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`util_ingress`,children:`Utilization (ingress)`}),(0,I.jsx)($,{value:`util_egress`,children:`Utilization (egress)`}),(0,I.jsx)($,{value:`if_error_ingress`,children:`Errors (ingress)`}),(0,I.jsx)($,{value:`if_error_egress`,children:`Errors (egress)`}),(0,I.jsx)($,{value:`if_packet_loss_ingress`,children:`Packet loss (ingress)`}),(0,I.jsx)($,{value:`if_packet_loss_egress`,children:`Packet loss (egress)`})]})]}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>{let t=[`device`,`interface`,`direction`,`window`,`metric`,`speedMbps`,`adminStatus`,`operStatus`,`p95`,`p99`,`max`,`slopePerDay`,`forecastCrossingTs`,`samples`],r=ze.map(e=>[e.device,e.iface,e.dir,n,a,e.speedMbps??``,e.admin??``,e.oper??``,e.p95??``,e.p99??``,e.max??``,e.slopePerDay??``,e.forecastCrossingTs??``,e.samples??0]);cd(`capacity_interfaces_${e}_${n}_${a}.csv`,`text/csv`,ud(t,r))},disabled:ze.length===0,children:`Export CSV`}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>le(!0),disabled:N.isLoading||N.isError,title:`Pick any interface from NQE inventory and load trend from Forward perf history`,children:`Pick interface`})]})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[C===`none`?null:(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Group summary (`,C,`)`]}),(0,I.jsx)(gs,{columns:a.startsWith(`util_`)?[{id:`group`,header:`Group`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.group}),width:220},...C===`vrf`?[{id:`routes`,header:`Routes (v4/v6)`,align:`right`,cell:e=>(0,I.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[Number(e.ipv4RoutesSum??0),`/`,Number(e.ipv6RoutesSum??0)]}),width:130},{id:`bgp`,header:`BGP`,align:`right`,cell:e=>(0,I.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[Number(e.bgpNeighbors??0),` (`,Number(e.bgpEstablished??0),`)`]}),width:100}]:[],{id:`count`,header:`Ifaces`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.count}),width:80},{id:`speed`,header:` Speed (Gbps)`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.sumSpeedGbps===void 0?``:e.sumSpeedGbps.toFixed(1)}),width:120},{id:`p95sum`,header:` p95 (Gbps)`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.sumP95Gbps===void 0?``:e.sumP95Gbps.toFixed(2)}),width:120},{id:`maxsum`,header:` Max (Gbps)`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.sumMaxGbps===void 0?``:e.sumMaxGbps.toFixed(2)}),width:120},{id:`utilp95`,header:`Util@p95`,align:`right`,cell:e=>{let t=Number(e.sumSpeedGbps??0),n=Number(e.sumP95Gbps??0);return t?(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:fd(n/t)}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90},{id:`utilmax`,header:`Util@max`,align:`right`,cell:e=>{let t=Number(e.sumSpeedGbps??0),n=Number(e.sumMaxGbps??0);return t?(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:fd(n/t)}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90},{id:`headroom`,header:`Headroom@85 (Gbps)`,align:`right`,cell:e=>{let t=Number(e.sumSpeedGbps??0),n=Number(e.sumP95Gbps??0);return t?(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:Math.max(0,t*.85-n).toFixed(2)}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:150},{id:`p95cov`,header:`p95 cov`,align:`right`,cell:e=>(0,I.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[Number(e.p95Count??0),`/`,e.count]}),width:90},{id:`soonest`,header:`Soonest`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.soonestForecast?e.soonestForecast.slice(0,10):``}),width:110}]:[{id:`group`,header:`Group`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.group}),width:260},{id:`count`,header:`Count`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.count}),width:90},{id:`hot`,header:`Hot`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.hotCount}),width:90},{id:`p95`,header:`Max p95`,align:`right`,cell:e=>pd(e.maxP95),width:100}],rows:Ve,getRowId:e=>e.group,onRowClick:e=>{C===`location`?x(e.group):C===`tag`?_(e.group===`untagged`?`all`:e.group):C===`group`?y(e.group===`ungrouped`?`all`:e.group):C===`vrf`&&S(e.group===`unknown`?`all`:e.group)},emptyText:`No groups.`,maxHeightClassName:`max-h-[260px]`,minWidthClassName:`min-w-0`})]}),M.isLoading?(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(G,{className:`h-5 w-56`}),(0,I.jsx)(G,{className:`h-32 w-full`})]}):M.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load summary:`,` `,M.error instanceof Error?M.error.message:String(M.error)]}):(0,I.jsx)(gs,{columns:Xe,rows:ze,getRowId:e=>e.id,onRowClick:e=>ie(e),emptyText:`No rollups for this window/metric yet. Click Refresh to enqueue.`})]})]})}),(0,I.jsx)(cc,{value:`devices`,className:`space-y-4`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Device Capacity`}),(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 md:flex-row md:items-center`,children:[(0,I.jsx)(J,{placeholder:`Filter (device / vendor / os)`,value:p,onChange:e=>h(e.target.value),className:`w-[260px]`}),(0,I.jsxs)(Y,{value:c,onValueChange:e=>l(e),children:[(0,I.jsx)(Z,{className:`w-[220px]`,children:(0,I.jsx)(X,{placeholder:`Metric`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`device_cpu`,children:`CPU`}),(0,I.jsx)($,{value:`device_memory`,children:`Memory`})]})]}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>{let t=[`device`,`window`,`metric`,`vendor`,`os`,`model`,`p95`,`p99`,`max`,`slopePerDay`,`forecastCrossingTs`,`samples`],r=Be.map(e=>[e.device,n,c,e.vendor??``,e.os??``,e.model??``,e.p95??``,e.p99??``,e.max??``,e.slopePerDay??``,e.forecastCrossingTs??``,e.samples??0]);cd(`capacity_devices_${e}_${n}_${c}.csv`,`text/csv`,ud(t,r))},disabled:Be.length===0,children:`Export CSV`}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>pe(!0),disabled:N.isLoading||N.isError,title:`Pick any device from NQE inventory and load trend from Forward perf history`,children:`Pick device`})]})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[C===`none`?null:(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Group summary (`,C,`)`]}),(0,I.jsx)(gs,{columns:[{id:`group`,header:`Group`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.group}),width:260},{id:`count`,header:`Count`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.count}),width:90},{id:`hot`,header:`Hot`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.hotCount}),width:90},{id:`p95`,header:`Max p95`,align:`right`,cell:e=>fd(e.maxP95),width:100}],rows:He,getRowId:e=>e.group,emptyText:`No groups.`,maxHeightClassName:`max-h-[260px]`,minWidthClassName:`min-w-0`})]}),M.isLoading?(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(G,{className:`h-5 w-56`}),(0,I.jsx)(G,{className:`h-32 w-full`})]}):M.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load summary:`,` `,M.error instanceof Error?M.error.message:String(M.error)]}):(0,I.jsx)(gs,{columns:Ze,rows:Be,getRowId:e=>e.id,onRowClick:e=>ae(e),emptyText:`No rollups for this window/metric yet. Click Refresh to enqueue.`})]})]})}),(0,I.jsxs)(cc,{value:`growth`,className:`space-y-4`,children:[(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Growth (Delta vs Prior)`}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsxs)(Y,{value:String(te),onValueChange:e=>T(Number(e)),children:[(0,I.jsx)(Z,{className:`w-[150px]`,children:(0,I.jsx)(X,{placeholder:`Compare`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`24`,children:`24h`}),(0,I.jsx)($,{value:`168`,children:`7d`}),(0,I.jsx)($,{value:`720`,children:`30d`}),(0,I.jsx)($,{value:`2160`,children:`90d`})]})]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`As of`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:Qe.data?.asOf??$e.data?.asOf??M.data?.asOf??``}),`  `,`Compared to`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:Qe.data?.compareAsOf??$e.data?.compareAsOf??``})]})]})]}),(0,I.jsx)(U,{className:`text-sm text-muted-foreground`,children:`Top growers computed from Skyforge rollups (no Forward time-series pull). Use Refresh to enqueue rollup recomputation.`})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Interfaces`}),(0,I.jsxs)(Y,{value:E,onValueChange:e=>D(e),children:[(0,I.jsx)(Z,{className:`w-[240px]`,children:(0,I.jsx)(X,{placeholder:`Metric`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`util_ingress`,children:`Utilization (ingress)`}),(0,I.jsx)($,{value:`util_egress`,children:`Utilization (egress)`})]})]})]}),(0,I.jsx)(U,{children:Qe.isLoading?(0,I.jsx)(G,{className:`h-32 w-full`}):Qe.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load growth:`,` `,Qe.error instanceof Error?Qe.error.message:String(Qe.error)]}):(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:220},{id:`iface`,header:`Interface`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.iface}),width:220},{id:`dir`,header:`Dir`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.dir}),width:90},{id:`speed`,header:`Speed`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:md(e.speedMbps??null)}),width:90},{id:`nowP95`,header:`Now p95`,align:`right`,cell:e=>fd(e.nowP95),width:100},{id:`prevP95`,header:`Prev p95`,align:`right`,cell:e=>fd(e.prevP95??void 0),width:100},{id:`deltaP95`,header:` p95`,align:`right`,cell:e=>{let t=e.deltaP95;return t==null?(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,I.jsxs)(`span`,{className:t>0?`text-foreground font-medium`:`text-muted-foreground`,children:[t>=0?`+`:``,fd(t)]})},width:90},{id:`deltaGbps`,header:` p95 (Gbps)`,align:`right`,cell:e=>e.deltaP95Gbps!==null&&e.deltaP95Gbps!==void 0?(0,I.jsxs)(`span`,{className:`text-xs`,children:[e.deltaP95Gbps>=0?`+`:``,e.deltaP95Gbps.toFixed(2)]}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}),width:120},{id:`forecast`,header:`Forecast`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.nowForecast?e.nowForecast.slice(0,10):``}),width:120}],rows:et,getRowId:e=>e.id,onRowClick:e=>{s(E),ie({id:`${e.device}:${e.iface}:${e.dir}:growth`,device:e.device,iface:e.iface,dir:e.dir||`INGRESS`,speedMbps:e.speedMbps??null,samples:0})},emptyText:`No growth rows yet. Click Refresh to enqueue.`})})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Devices`}),(0,I.jsxs)(Y,{value:ne,onValueChange:e=>re(e),children:[(0,I.jsx)(Z,{className:`w-[220px]`,children:(0,I.jsx)(X,{placeholder:`Metric`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`device_cpu`,children:`CPU`}),(0,I.jsx)($,{value:`device_memory`,children:`Memory`})]})]})]}),(0,I.jsx)(U,{children:$e.isLoading?(0,I.jsx)(G,{className:`h-32 w-full`}):$e.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load growth:`,` `,$e.error instanceof Error?$e.error.message:String($e.error)]}):(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:240},{id:`meta`,header:`Meta`,cell:e=>(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[(0,I.jsx)(`div`,{children:[e.vendor,e.os].filter(Boolean).join(`  `)||``}),(0,I.jsx)(`div`,{className:`font-mono`,children:e.model||``})]}),width:240},{id:`nowP95`,header:`Now p95`,align:`right`,cell:e=>fd(e.nowP95),width:100},{id:`prevP95`,header:`Prev p95`,align:`right`,cell:e=>fd(e.prevP95??void 0),width:100},{id:`deltaP95`,header:` p95`,align:`right`,cell:e=>{let t=e.deltaP95;return t==null?(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,I.jsxs)(`span`,{className:t>0?`text-foreground font-medium`:`text-muted-foreground`,children:[t>=0?`+`:``,fd(t)]})},width:90},{id:`forecast`,header:`Forecast`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.nowForecast?e.nowForecast.slice(0,10):``}),width:120}],rows:tt,getRowId:e=>e.id,onRowClick:e=>{l(ne),ae({id:`${e.device}:growth`,device:e.device,metric:ne,vendor:e.vendor,os:e.os,model:e.model,samples:0})},emptyText:`No growth rows yet. Click Refresh to enqueue.`})})]})]}),(0,I.jsx)(cc,{value:`plan`,className:`space-y-4`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Upgrade Candidates`}),(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 md:flex-row md:items-center`,children:[(0,I.jsx)(J,{placeholder:`Filter (device / link)`,value:we,onChange:e=>Te(e.target.value),className:`w-[260px]`}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>{let t=je.data?.items??[],r=we.trim().toLowerCase(),i=r?t.filter(e=>`${e.device} ${e.name} ${(e.members??[]).join(` `)}`.toLowerCase().includes(r)):t,a=[`objectType`,`device`,`name`,`members`,`speedMbps`,`worstDirection`,`p95Util`,`maxUtil`,`p95Gbps`,`maxGbps`,`forecastCrossingTs`,`requiredSpeedMbps`,`recommendedSpeedMbps`,`reason`,`worstMemberMaxUtil`],o=i.map(e=>[e.objectType??``,e.device??``,e.name??``,(e.members??[]).join(` `),e.speedMbps??``,e.worstDirection??``,e.p95Util??``,e.maxUtil??``,e.p95Gbps??``,e.maxGbps??``,e.forecastCrossingTs??``,e.requiredSpeedMbps??``,e.recommendedSpeedMbps??``,e.reason??``,e.worstMemberMaxUtil??``]);cd(`upgrade-candidates-${e}-${n}.csv`,`text/csv`,ud(a,o))},disabled:je.isLoading,children:`Export CSV`})]})]}),(0,I.jsx)(U,{children:je.isLoading?(0,I.jsx)(G,{className:`h-24 w-full`}):je.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load upgrade candidates:`,` `,je.error instanceof Error?je.error.message:String(je.error)]}):(()=>{let e=je.data?.items??[],t=we.trim().toLowerCase();return(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:220},{id:`link`,header:`Link`,cell:e=>(0,I.jsxs)(`div`,{className:`text-xs`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`span`,{className:`font-mono`,children:e.name}),e.objectType===`lag`?(0,I.jsx)(K,{variant:`secondary`,children:`LAG`}):null,e.recommendedSpeedMbps?(0,I.jsx)(K,{variant:`destructive`,children:`upgrade`}):null]}),(e.members??[]).length?(0,I.jsxs)(`div`,{className:`text-muted-foreground`,children:[(e.members??[]).length,` members`]}):null]}),width:240},{id:`speed`,header:`Speed`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:md(e.speedMbps)}),width:90},{id:`dir`,header:`Worst`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.worstDirection||``}),width:90},{id:`max`,header:`Max`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:e.maxUtil>=.85?`text-destructive font-medium`:``,children:fd(e.maxUtil)}),width:90},{id:`p95`,header:`p95`,align:`right`,cell:e=>fd(e.p95Util),width:90},{id:`maxGbps`,header:`Max (Gbps)`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:Number(e.maxGbps??0).toFixed(2)}),width:110},{id:`forecast`,header:`Forecast`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.forecastCrossingTs?String(e.forecastCrossingTs).slice(0,10):``}),width:120},{id:`req`,header:`Req`,align:`right`,cell:e=>e.requiredSpeedMbps?(0,I.jsx)(`span`,{className:`text-xs`,children:md(e.requiredSpeedMbps)}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}),width:90},{id:`rec`,header:`Rec`,align:`right`,cell:e=>e.recommendedSpeedMbps?(0,I.jsx)(`span`,{className:`text-xs font-medium text-destructive`,children:md(e.recommendedSpeedMbps)}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}),width:90},{id:`imb`,header:`Worst member`,align:`right`,cell:e=>e.worstMemberMaxUtil?(0,I.jsx)(`span`,{className:`text-xs`,children:fd(e.worstMemberMaxUtil)}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}),width:120},{id:`reason`,header:`Reason`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.reason||``}),width:140}],rows:t?e.filter(e=>`${e.device} ${e.name} ${(e.members??[]).join(` `)}`.toLowerCase().includes(t)):e,getRowId:e=>`${e.objectType??`iface`}:${e.device}:${e.name}`,emptyText:`No upgrade candidates for this window (no hot links / no near-term forecasts).`,maxHeightClassName:`max-h-[520px]`,minWidthClassName:`min-w-0`})})()})]})}),(0,I.jsxs)(cc,{value:`routing`,className:`space-y-4`,children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{className:`text-base`,children:`VRF Summary (Perf + Scale)`})}),(0,I.jsx)(U,{children:N.isLoading?(0,I.jsx)(G,{className:`h-28 w-full`}):N.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,N.error instanceof Error?N.error.message:String(N.error)]}):(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:240},{id:`vrf`,header:`VRF`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:180},{id:`v4`,header:`IPv4`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.ipv4Routes}),width:90},{id:`v6`,header:`IPv6`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.ipv6Routes}),width:90},{id:`bgp`,header:`BGP`,align:`right`,cell:e=>(0,I.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[e.bgpNeighbors,` (`,e.bgpEstablished,`)`]}),width:110},{id:`max`,header:`Max util`,align:`right`,cell:e=>fd(e.maxIfaceMax),width:100},{id:`forecast`,header:`Soonest`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.soonestForecast?e.soonestForecast.slice(0,10):``}),width:120}],rows:ct,getRowId:e=>e.id,onRowClick:e=>{_e(e.deviceName),ve(e.vrf),S(e.vrf)},emptyText:`No VRF summary available yet. Click Refresh to enqueue.`,maxHeightClassName:`max-h-[360px]`,minWidthClassName:`min-w-0`})})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-2 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Hardware Capacity (TCAM)`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Derived from Forward CUSTOM command outputs. Configure a TCAM command collection to populate.`})]}),(0,I.jsx)(U,{children:N.isLoading?(0,I.jsx)(G,{className:`h-28 w-full`}):N.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,N.error instanceof Error?N.error.message:String(N.error)]}):(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:240},{id:`meta`,header:`Meta`,cell:e=>(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[(0,I.jsx)(`div`,{children:[e.vendor??``,e.os??``].filter(Boolean).join(`  `)||``}),(0,I.jsx)(`div`,{className:`font-mono`,children:String(e.model??``)})]}),width:240},{id:`used`,header:`Used`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:Number(e.tcamUsed??0)}),width:90},{id:`total`,header:`Total`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:Number(e.tcamTotal??0)}),width:90},{id:`util`,header:`Util`,align:`right`,cell:e=>{let t=Number(e.tcamUsed??0),n=Number(e.tcamTotal??0);return n?(0,I.jsx)(`span`,{className:`text-xs`,children:fd(t/n)}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90},{id:`cmd`,header:`Command`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:String(e.commandText??``).slice(0,48)||``}),width:260},{id:`evidence`,header:`Evidence`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:String(e.evidence??``).slice(0,60)||``}),width:320}],rows:st,getRowId:e=>e.deviceName,onRowClick:e=>{_e(e.deviceName),Ce([`device: ${String(e.deviceName??``)}`,`command: ${String(e.commandText??``)}`,`used/total: ${Number(e.tcamUsed??0)}/${Number(e.tcamTotal??0)}`,``,String(e.evidence??``)].join(`
`)),be(!0)},emptyText:`No TCAM rows cached yet. Click Refresh after enabling custom commands.`,maxHeightClassName:`max-h-[320px]`,minWidthClassName:`min-w-0`})})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Routing Scale`}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsxs)(Y,{value:ge,onValueChange:_e,children:[(0,I.jsx)(Z,{className:`w-[220px]`,children:(0,I.jsx)(X,{placeholder:`Device`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All devices`}),rt.devices.map(e=>(0,I.jsx)($,{value:e,children:e},e))]})]}),(0,I.jsxs)(Y,{value:j,onValueChange:ve,children:[(0,I.jsx)(Z,{className:`w-[170px]`,children:(0,I.jsx)(X,{placeholder:`VRF`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All VRFs`}),rt.vrfs.map(e=>(0,I.jsx)($,{value:e,children:e},e))]})]}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>{_e(`all`),ve(`all`)},disabled:ge===`all`&&j===`all`,children:`Clear`})]})]}),(0,I.jsx)(U,{children:N.isLoading?(0,I.jsx)(G,{className:`h-28 w-full`}):N.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,N.error instanceof Error?N.error.message:String(N.error)]}):(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:240},{id:`vrf`,header:`VRF`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:180},{id:`v4`,header:`IPv4`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.ipv4Routes}),width:90},{id:`v6`,header:`IPv6`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.ipv6Routes}),width:90}],rows:at,getRowId:e=>`${e.deviceName}:${e.vrf}`,emptyText:`No routing scale cached yet. Click Refresh to enqueue.`})})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{className:`text-base`,children:`BGP Neighbors`})}),(0,I.jsx)(U,{children:N.isLoading?(0,I.jsx)(G,{className:`h-28 w-full`}):N.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,N.error instanceof Error?N.error.message:String(N.error)]}):(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:220},{id:`vrf`,header:`VRF`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:160},{id:`nbr`,header:`Neighbor`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.neighborAddress}),width:220},{id:`state`,header:`State`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.sessionState??``}),width:120},{id:`rx`,header:`Rx`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.receivedPrefixes??``}),width:90},{id:`tx`,header:`Tx`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.advertisedPrefixes??``}),width:90}],rows:ot,getRowId:e=>`${e.deviceName}:${e.vrf}:${e.neighborAddress}`,emptyText:`No BGP cache yet. Click Refresh to enqueue.`})})]})]}),(0,I.jsx)(cc,{value:`changes`,className:`space-y-4`,children:(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{className:`text-base`,children:`Snapshot Delta`})}),(0,I.jsx)(U,{className:`space-y-2`,children:Ae.isLoading?(0,I.jsx)(G,{className:`h-24 w-full`}):Ae.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load snapshot delta:`,` `,Ae.error instanceof Error?Ae.error.message:String(Ae.error)]}):(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Latest:`,` `,(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:Ae.data?.latestSnapshotId??``}),`  `,`Prev:`,` `,(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:Ae.data?.prevSnapshotId??``})]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-4 md:grid-cols-2`,children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`Route Scale Changes`})}),(0,I.jsx)(U,{children:(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:220},{id:`vrf`,header:`VRF`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:160},{id:`v4`,header:`IPv4 `,align:`right`,cell:e=>{let t=Number(e.ipv4Delta??0);return(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:t>0?`+${t}`:String(t)})},width:90},{id:`v6`,header:`IPv6 `,align:`right`,cell:e=>{let t=Number(e.ipv6Delta??0);return(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:t>0?`+${t}`:String(t)})},width:90}],rows:Ae.data?.routeDelta??[],getRowId:e=>`${e.deviceName}:${e.vrf}`,emptyText:`No route scale deltas between last two snapshots.`,maxHeightClassName:`max-h-[320px]`,minWidthClassName:`min-w-0`})})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`BGP Neighbor Changes`})}),(0,I.jsx)(U,{children:(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:220},{id:`vrf`,header:`VRF`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:160},{id:`nbr`,header:`Nbrs `,align:`right`,cell:e=>{let t=Number(e.neighborsDelta??0);return(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:t>0?`+${t}`:String(t)})},width:80},{id:`est`,header:`Est `,align:`right`,cell:e=>{let t=Number(e.establishedDelta??0);return(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:t>0?`+${t}`:String(t)})},width:80}],rows:Ae.data?.bgpDelta??[],getRowId:e=>`${e.deviceName}:${e.vrf}`,emptyText:`No BGP scale deltas between last two snapshots.`,maxHeightClassName:`max-h-[320px]`,minWidthClassName:`min-w-0`})})]})]})]})})]})}),(0,I.jsx)(cc,{value:`health`,className:`space-y-4`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Health Issues`}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>Fe.mutate(),disabled:Fe.isPending,children:Fe.isPending?`Loading`:`Load unhealthy devices`})]}),(0,I.jsx)(U,{className:`space-y-2`,children:oe?(0,I.jsx)(`pre`,{className:`max-h-[60vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:sd(oe)}):(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loads Forward health signals (including high utilization) around the latest processed snapshot.`})})]})}),(0,I.jsxs)(cc,{value:`raw`,className:`space-y-4`,children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{className:`text-base`,children:`Raw Rollups`})}),(0,I.jsx)(U,{className:`space-y-2`,children:M.isLoading?(0,I.jsx)(G,{className:`h-32 w-full`}):M.isError?(0,I.jsx)(`div`,{className:`text-destructive text-sm`,children:M.error instanceof Error?M.error.message:String(M.error)}):(0,I.jsx)(`pre`,{className:`max-h-[65vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:sd(M.data?.rollups??[])})})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{className:`text-base`,children:`Raw Inventory`})}),(0,I.jsx)(U,{className:`space-y-2`,children:N.isLoading?(0,I.jsx)(G,{className:`h-32 w-full`}):N.isError?(0,I.jsx)(`div`,{className:`text-destructive text-sm`,children:N.error instanceof Error?N.error.message:String(N.error)}):(0,I.jsx)(`pre`,{className:`max-h-[65vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:sd(N.data??{})})})]})]})]}),(0,I.jsx)(Xn,{open:!!k,onOpenChange:e=>!e&&ie(null),children:(0,I.jsxs)($n,{className:`max-w-3xl`,children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{className:`text-base`,children:`Interface Trend`})}),k?(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`text-sm`,children:[(0,I.jsxs)(`span`,{className:`font-mono text-xs`,children:[k.device,` `,k.iface,` `,k.dir]}),` `,(0,I.jsx)(K,{variant:`outline`,className:`ml-2`,children:n}),(0,I.jsx)(K,{variant:`secondary`,className:`ml-2`,children:a}),(0,I.jsxs)(Y,{value:k.dir,onValueChange:e=>ie(t=>t&&{...t,dir:String(e)}),children:[(0,I.jsx)(Z,{className:`ml-2 inline-flex h-7 w-[140px]`,children:(0,I.jsx)(X,{placeholder:`Direction`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`INGRESS`,children:`INGRESS`}),(0,I.jsx)($,{value:`EGRESS`,children:`EGRESS`})]})]}),k.vrf||k.vrfNames?.length?(0,I.jsxs)(`div`,{className:`mt-2 flex flex-wrap items-center gap-2 text-xs`,children:[(0,I.jsx)(K,{variant:`outline`,className:`font-mono text-xs`,children:`VRF`}),(0,I.jsxs)(`span`,{className:`font-mono text-xs`,children:[k.vrf??(k.vrfNames??[]).slice(0,3).join(`, `),(k.vrfNames??[]).length>3?``:``]}),(0,I.jsx)(R,{variant:`outline`,className:`h-7 px-2`,onClick:()=>{_e(k.device),ve(k.vrf??k.vrfNames?.[0]??`all`)},title:`Filter Routing/BGP tables to this device/VRF`,children:`Filter routing`})]}):null]}),We.isLoading?(0,I.jsx)(G,{className:`h-24 w-full`}):We.isError?(0,I.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load history`}):(0,I.jsx)(id,{points:Ke}),(()=>{let e=k.vrfNames?.length?k.vrfNames:k.vrf?[k.vrf]:[];if(!e.length)return null;let t=(N.data?.routeScale??[]).filter(t=>t.deviceName===k.device&&e.includes(t.vrf)),n=(N.data?.bgpNeighbors??[]).filter(t=>t.deviceName===k.device&&e.includes(t.vrf)),r=t.reduce((e,t)=>e+Number(t.ipv4Routes??0),0),i=t.reduce((e,t)=>e+Number(t.ipv6Routes??0),0),a=n.filter(e=>String(e.sessionState??``).toUpperCase().includes(`ESTABLISHED`)).length;return(0,I.jsxs)(`div`,{className:`rounded-md border bg-muted/20 p-3 text-xs`,children:[(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center justify-between gap-2`,children:[(0,I.jsxs)(`div`,{className:`text-muted-foreground`,children:[`Routing context for`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:e.slice(0,3).join(`, `)}),e.length>3?``:``]}),(0,I.jsx)(R,{variant:`outline`,className:`h-7 px-2`,onClick:()=>{_e(k.device),ve(e[0]??`all`)},children:`View in Routing tab`})]}),(0,I.jsxs)(`div`,{className:`mt-2 grid grid-cols-2 gap-2`,children:[(0,I.jsxs)(`div`,{children:[`FIB routes (sum):`,` `,(0,I.jsxs)(`span`,{className:`font-mono`,children:[`v4=`,r,` v6=`,i]})]}),(0,I.jsxs)(`div`,{className:`text-right`,children:[`BGP neighbors:`,` `,(0,I.jsxs)(`span`,{className:`font-mono`,children:[n.length,` (`,a,` established)`]})]})]})]})})(),(0,I.jsxs)(`div`,{className:`grid grid-cols-2 gap-3 text-xs text-muted-foreground`,children:[(0,I.jsxs)(`div`,{children:[`p95:`,` `,a.startsWith(`util_`)?fd(k.p95??Je.p95??void 0):pd(k.p95??Je.p95??void 0)]}),(0,I.jsxs)(`div`,{className:`text-right`,children:[`max:`,` `,a.startsWith(`util_`)?fd(k.max??Je.max??void 0):pd(k.max??Je.max??void 0)]}),(0,I.jsxs)(`div`,{children:[`slope/day:`,` `,a.startsWith(`util_`)?fd(k.slopePerDay):pd(k.slopePerDay)]}),(0,I.jsxs)(`div`,{className:`text-right`,children:[`forecast:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:k.forecastCrossingTs??``})]}),(0,I.jsxs)(`div`,{children:[`speed: `,md(k.speedMbps??null)]}),(0,I.jsxs)(`div`,{className:`text-right`,children:[`p95 (Gbps): `,(()=>{if(!a.startsWith(`util_`))return``;let e=Number(k.speedMbps??0),t=Number(k.p95??Je.p95??NaN);return!e||!Number.isFinite(t)?``:(t*e/1e3).toFixed(2)})()]})]})]}):null]})}),(0,I.jsx)(Xn,{open:!!A,onOpenChange:e=>!e&&ae(null),children:(0,I.jsxs)($n,{className:`max-w-3xl`,children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{className:`text-base`,children:`Device Trend`})}),A?(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`text-sm`,children:[(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:A.device}),` `,(0,I.jsx)(K,{variant:`outline`,className:`ml-2`,children:n}),(0,I.jsx)(K,{variant:`secondary`,className:`ml-2`,children:c})]}),Ge.isLoading?(0,I.jsx)(G,{className:`h-24 w-full`}):Ge.isError?(0,I.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load history`}):(0,I.jsx)(id,{points:qe}),(0,I.jsxs)(`div`,{className:`grid grid-cols-2 gap-3 text-xs text-muted-foreground`,children:[(0,I.jsxs)(`div`,{children:[`p95:`,` `,fd(A.p95??Ye.p95??void 0)]}),(0,I.jsxs)(`div`,{className:`text-right`,children:[`max:`,` `,fd(A.max??Ye.max??void 0)]}),(0,I.jsxs)(`div`,{children:[`slope/day: `,fd(A.slopePerDay)]}),(0,I.jsxs)(`div`,{className:`text-right`,children:[`forecast:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:A.forecastCrossingTs??``})]})]})]}):null]})}),(0,I.jsx)(Xn,{open:ce,onOpenChange:e=>!e&&le(!1),children:(0,I.jsxs)($n,{className:`max-w-2xl`,children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{className:`text-base`,children:`Pick Interface`})}),(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsx)(J,{placeholder:`Search device/interface`,value:ue,onChange:e=>de(e.target.value)}),(0,I.jsx)(`div`,{className:`max-h-[55vh] overflow-auto rounded-md border`,children:(()=>{let e=N.data?.interfaces??[],t=ue.trim().toLowerCase(),n=(t?e.filter(e=>{let n=String(e.deviceName??``).toLowerCase(),r=String(e.interfaceName??``).toLowerCase();return n.includes(t)||r.includes(t)}):e).slice(0,200);return n.length?(0,I.jsx)(`div`,{className:`divide-y`,children:n.map(e=>{let t=String(e.deviceName??``),n=String(e.interfaceName??``),r=md(e.speedMbps??null);return(0,I.jsx)(`button`,{type:`button`,className:`w-full px-3 py-2 text-left hover:bg-muted/40`,onClick:()=>{ie({id:`${t}:${n}:INGRESS:pick`,device:t,iface:n,dir:`INGRESS`,speedMbps:e.speedMbps??null,admin:e.adminStatus??void 0,oper:e.operStatus??void 0,samples:0}),le(!1)},children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{className:`font-mono text-xs`,children:[t,` `,n]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:r})]})},`${t}:${n}`)})}):(0,I.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:`No matches.`})})()}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Loads a trend directly from Forward perf history (not limited to the top-50 rollups).`})]})]})}),(0,I.jsx)(Xn,{open:ye,onOpenChange:e=>!e&&be(!1),children:(0,I.jsxs)($n,{className:`max-w-4xl`,children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{className:`text-base`,children:`TCAM Evidence`})}),(0,I.jsx)(`pre`,{className:`max-h-[70vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:xe||``})]})}),(0,I.jsx)(Xn,{open:fe,onOpenChange:e=>!e&&pe(!1),children:(0,I.jsxs)($n,{className:`max-w-2xl`,children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{className:`text-base`,children:`Pick Device`})}),(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsx)(J,{placeholder:`Search device`,value:me,onChange:e=>he(e.target.value)}),(0,I.jsx)(`div`,{className:`max-h-[55vh] overflow-auto rounded-md border`,children:(()=>{let e=N.data?.devices??[],t=me.trim().toLowerCase(),n=(t?e.filter(e=>{let n=String(e.deviceName??``).toLowerCase(),r=String(e.vendor??``).toLowerCase(),i=String(e.os??``).toLowerCase();return n.includes(t)||r.includes(t)||i.includes(t)}):e).slice(0,200);return n.length?(0,I.jsx)(`div`,{className:`divide-y`,children:n.map(e=>{let t=String(e.deviceName??``);return(0,I.jsx)(`button`,{type:`button`,className:`w-full px-3 py-2 text-left hover:bg-muted/40`,onClick:()=>{ae({id:`${t}:pick`,device:t,metric:c,vendor:e.vendor??void 0,os:e.os??void 0,model:e.model??void 0,samples:0}),pe(!1)},children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`font-mono text-xs`,children:t}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:[e.vendor??``,e.os??``].filter(Boolean).join(`  `)||``})]})},t)})}):(0,I.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:`No matches.`})})()}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Loads a trend directly from Forward perf history.`})]})]})})]})}var yd=qn({scenario:Hn().optional().catch(``),tab:Hn().optional().catch(`routing`)});const bd=t(`/dashboard/fwd/$networkRef/assurance-studio`)({validateSearch:e=>yd.parse(e),component:Od});function xd(e){let t=String(e??``).trim();if(!t)return``;let n=Date.parse(t);return Number.isFinite(n)?new Date(n).toISOString():t}function Sd(e){let t=Number(e??NaN);if(!Number.isFinite(t)||t<0)return``;let n=Math.floor(t/60),r=Math.floor(n/60);return r>0?`${r}h ${n%60}m`:n>0?`${n}m`:`${Math.floor(t)}s`}function Cd(e){return String(e??``).split(`,`).map(e=>e.trim()).filter(Boolean)}function wd(e,t,n){let r=new Blob([n],{type:t}),i=URL.createObjectURL(r);try{let t=document.createElement(`a`);t.href=i,t.download=e,t.click()}finally{URL.revokeObjectURL(i)}}function Td(e){let t=[`from,srcIp,dstIp,ipProto,srcPort,dstPort,bandwidthGbps,label`];for(let n of e??[]){let e=String(n.from??``).replaceAll(`,`,` `).trim(),r=String(n.srcIp??``).replaceAll(`,`,` `).trim(),i=String(n.dstIp??``).replaceAll(`,`,` `).trim(),a=n.ipProto===void 0?``:String(n.ipProto),o=String(n.srcPort??``).replaceAll(`,`,` `).trim(),s=String(n.dstPort??``).replaceAll(`,`,` `).trim(),c=n.bandwidthGbps===void 0?``:String(n.bandwidthGbps),l=String(n.label??``).replaceAll(`,`,` `).trim();t.push([e,r,i,a,o,s,c,l].join(`,`))}return t.join(`
`)+`
`}function Ed(e){let t=[],n=String(e??``).split(/\r?\n/).map(e=>e.trim()).filter(Boolean);if(!n.length)return t;let r=n[0].toLowerCase(),i=r.includes(`dstip`)||r.includes(`bandwidth`)||r.includes(`ipproto`),a=i?1:0;for(let e=a;e<n.length;e++){let r=n[e].split(`,`).map(e=>e.trim());if(!r.length)continue;let a=!i&&r.length<=4,o=(r[0]??``).trim(),s=a?``:(r[1]??``).trim(),c=a?(r[1]??``).trim():(r[2]??``).trim();if(!c)continue;let l=a?``:(r[3]??``).trim(),u=a?``:(r[4]??``).trim(),d=a?``:(r[5]??``).trim(),f=a?(r[2]??``).trim():(r[6]??``).trim(),p=a?(r[3]??``).trim():(r[7]??``).trim(),m=f?Number(f):NaN,h=l?Number(l):NaN;t.push({from:o||void 0,srcIp:s||void 0,dstIp:c,ipProto:Number.isFinite(h)?h:void 0,srcPort:u||void 0,dstPort:d||void 0,bandwidthGbps:Number.isFinite(m)?m:void 0,label:p||void 0})}return t}function Dd(e){let t=[];for(let n of e??[]){let e=String(n.srcIp??``).trim(),r=String(n.dstIp??``).trim();if(!e||!r)continue;let i=n.ipProto===void 0?``:String(n.ipProto),a=String(n.dstPort??``).trim(),o=[e,r];i&&o.push(i),a&&o.push(a),t.push(o.join(` `))}return t.join(`
`)}function Od(){let{networkRef:e}=bd.useParams(),{scenario:t,tab:n}=bd.useSearch(),r=bd.useNavigate(),a=o(),s=String(t??``).trim(),c=String(n??`routing`)||`routing`,l=!!f({queryKey:W.session(),queryFn:_r,staleTime:3e4,retry:!1}).data?.isAdmin,[u,d]=(0,P.useState)(!1),[p,h]=(0,P.useState)(``),[g,_]=(0,P.useState)(``),[y,b]=(0,P.useState)(``),[x,ee]=(0,P.useState)(``),[S,C]=(0,P.useState)(``),[w,te]=(0,P.useState)(``),[T,E]=(0,P.useState)(!1),[D,ne]=(0,P.useState)(`7d`),[re,k]=(0,P.useState)(`0.8`),[ie,A]=(0,P.useState)(``),[ae,oe]=(0,P.useState)(!1),[se,ce]=(0,P.useState)(`mesh`),[le,ue]=(0,P.useState)(!0),[de,fe]=(0,P.useState)(``),[pe,me]=(0,P.useState)(``),[he,ge]=(0,P.useState)(``),[j,ve]=(0,P.useState)(`30`),[ye,be]=(0,P.useState)(`200`),[xe,Se]=(0,P.useState)(!1),[Ce,we]=(0,P.useState)(!0),[Te,Ee]=(0,P.useState)(!1),[De,Oe]=(0,P.useState)(`3`),[M,N]=(0,P.useState)(!0),[ke,Ae]=(0,P.useState)(!0),[je,Me]=(0,P.useState)(!1),[Ne,Pe]=(0,P.useState)(``),[Fe,Ie]=(0,P.useState)(`ALL`),[Le,Re]=(0,P.useState)({routing:`idle`,capacity:`idle`,security:`idle`}),[ze,Be]=(0,P.useState)(!1),[Ve,He]=(0,P.useState)(!0),[Ue,We]=(0,P.useState)(!1),[Ge,Ke]=(0,P.useState)(!1),[qe,Je]=(0,P.useState)(!1),[Ye,Xe]=(0,P.useState)(!1),[Ze,Qe]=(0,P.useState)(`fw, firewall`),[$e,et]=(0,P.useState)(``),tt=f({queryKey:W.userForwardNetworks(),queryFn:()=>lo(),enabled:!0,retry:!1,staleTime:3e4}),rt=f({queryKey:W.userForwardNetworks(),queryFn:lo,retry:!1,staleTime:3e4}),at=(0,P.useMemo)(()=>{let t=tt.data?.networks??[],n=rt.data?.networks??[];return t.find(t=>String(t?.id??``)===String(e))??n.find(t=>String(t?.id??``)===String(e))},[tt.data?.networks,rt.data?.networks,e]),ot=String(at?.forwardNetworkId??``),st=String(at?.name??``)||String(e),ct=f({queryKey:W.forwardNetworkAssuranceSummary(e),queryFn:()=>ki(e),enabled:!!e,staleTime:5e3,retry:!1}),lt=ct.data,ut=i({mutationFn:()=>Ai(e),onSuccess:async t=>{O.success(`Assurance refreshed`),a.setQueryData(W.forwardNetworkAssuranceSummary(e),t),await a.invalidateQueries({queryKey:W.forwardNetworkAssuranceHistory(e)})},onError:e=>O.error(`Assurance refresh failed`,{description:String(e?.message??e??`unknown error`)})}),dt=i({mutationFn:()=>Mi(e),onSuccess:async t=>{O.success(`Seeded demo signals`,{description:`syslog CIDR ${t.syslogCidr}`}),await a.invalidateQueries({queryKey:W.forwardNetworkAssuranceSummary(e)})},onError:e=>O.error(`Seed failed`,{description:String(e?.message??e??`unknown error`)})}),ft=f({queryKey:W.assuranceStudioScenarios(e),queryFn:()=>Wu(e),enabled:!!e,retry:!1,staleTime:1e4}),pt=(0,P.useMemo)(()=>ft.data?.scenarios??[],[ft.data?.scenarios]),mt=(0,P.useMemo)(()=>pt.find(e=>e.id===s)??null,[pt,s]),ht=f({queryKey:W.assuranceStudioRuns(e),queryFn:()=>Yu(e),enabled:!!e,retry:!1,staleTime:1e4}),gt=(0,P.useMemo)(()=>{let e=ht.data?.runs??[];return Fe===`ALL`?e:e.filter(e=>String(e.status)===Fe)},[ht.data?.runs,Fe]),_t=f({queryKey:W.assuranceStudioRun(e,Ne),queryFn:()=>Zu(e,Ne),enabled:!!(je&&e&&Ne),retry:!1,staleTime:3e4});(0,P.useEffect)(()=>{e&&(s||pt.length!==0&&r({search:e=>({...e,scenario:pt[0].id}),replace:!0}))},[e,s,pt,r]),(0,P.useEffect)(()=>{if(!mt)return;b(String(mt.name??``)),ee(String(mt.description??``)),C(String(mt.spec?.snapshotId??``)),ne(String(mt.spec?.window??`7d`)||`7d`),k(mt.spec?.thresholdUtil===void 0?`0.8`:String(mt.spec.thresholdUtil)),A(Td(mt.spec?.demands??[]));let e=mt.spec?.routing??{};e.includeHops!==void 0&&Se(!!e.includeHops),e.projectLoad!==void 0&&we(!!e.projectLoad),e.includeAcl!==void 0&&Ee(!!e.includeAcl),e.maxResults!==void 0&&Oe(String(e.maxResults));{let t=e.baselineSnapshotId===void 0?``:String(e.baselineSnapshotId??``);te(t),E(!!t.trim())}e.requireEnforcement!==void 0&&N(!!e.requireEnforcement);let t=mt.spec?.capacity??{};t.includeHops!==void 0&&Be(!!t.includeHops);let n=mt.spec?.security??{};n.requireEnforcement!==void 0&&He(!!n.requireEnforcement),n.includeNetworkFunctions!==void 0&&We(!!n.includeNetworkFunctions),n.includeReturnPath!==void 0&&Ke(!!n.includeReturnPath),n.requireSymmetricDelivery!==void 0&&Je(!!n.requireSymmetricDelivery),n.requireReturnEnforcement!==void 0&&Xe(!!n.requireReturnEnforcement),Array.isArray(n.enforcementDeviceNameParts)&&Qe(n.enforcementDeviceNameParts.join(`, `)),Array.isArray(n.enforcementTagParts)&&et(n.enforcementTagParts.join(`, `)),oe(!1)},[mt?.id]);let vt=i({mutationFn:async()=>{let t=p.trim();if(!t)throw Error(`name is required`);let n=Number(re),r={snapshotId:S.trim()||void 0,window:D,thresholdUtil:Number.isFinite(n)?n:void 0,demands:Ed(ie)};return Gu(e,{name:t,description:g.trim()||void 0,spec:r})},onSuccess:async t=>{await a.invalidateQueries({queryKey:W.assuranceStudioScenarios(e)}),d(!1),h(``),_(``),O.success(`Scenario created`),r({search:e=>({...e,scenario:t.id})})},onError:e=>O.error(String(e?.message??e??`create failed`))}),yt=i({mutationFn:async()=>{if(!s)throw Error(`select a scenario first`);let t=(y.trim()||`Scenario`)+` copy`,n=Number(re),r={snapshotId:S.trim()||void 0,window:D,thresholdUtil:Number.isFinite(n)?n:void 0,demands:Ed(ie),routing:{includeHops:xe,projectLoad:Ce,includeAcl:Te,maxResults:Number(De)||3,baselineSnapshotId:w.trim()||void 0,requireEnforcement:M},capacity:{includeHops:ze},security:{requireEnforcement:Ve,includeNetworkFunctions:Ue,includeReturnPath:Ge,requireSymmetricDelivery:qe,requireReturnEnforcement:Ye,enforcementDeviceNameParts:Cd(Ze),enforcementTagParts:Cd($e)}};return Gu(e,{name:t,description:x.trim()||void 0,spec:r})},onSuccess:async t=>{await a.invalidateQueries({queryKey:W.assuranceStudioScenarios(e)}),O.success(`Scenario duplicated`,{description:t.id}),r({search:e=>({...e,scenario:t.id})})},onError:e=>O.error(String(e?.message??e??`duplicate failed`))}),bt=i({mutationFn:async()=>{if(!s)throw Error(`select a scenario first`);let t=Ed(ie),n=Number(re),r={snapshotId:S.trim()||void 0,window:D,thresholdUtil:Number.isFinite(n)?n:void 0,demands:t,routing:{includeHops:xe,projectLoad:Ce,includeAcl:Te,maxResults:Number(De)||3,baselineSnapshotId:w.trim()||void 0,requireEnforcement:M},capacity:{includeHops:ze},security:{requireEnforcement:Ve,includeNetworkFunctions:Ue,includeReturnPath:Ge,requireSymmetricDelivery:qe,requireReturnEnforcement:Ye,enforcementDeviceNameParts:Cd(Ze),enforcementTagParts:Cd($e)}};return Ku(e,s,{name:y.trim()||void 0,description:x.trim()===``?null:x.trim(),spec:r})},onSuccess:async()=>{await a.invalidateQueries({queryKey:W.assuranceStudioScenarios(e)}),oe(!1),O.success(`Scenario saved`)},onError:e=>O.error(String(e?.message??e??`save failed`))}),xt=i({mutationFn:async()=>{if(!s)throw Error(`select a scenario first`);return qu(e,s)},onSuccess:async()=>{await a.invalidateQueries({queryKey:W.assuranceStudioScenarios(e)}),O.success(`Scenario deleted`),r({search:e=>({...e,scenario:``}),replace:!0})},onError:e=>O.error(String(e?.message??e??`delete failed`))}),St=i({mutationFn:async()=>Fu(e,{snapshotId:S.trim()||void 0,mode:se,includeGroups:le,tagParts:Cd(de),nameParts:Cd(pe),deviceTypes:Cd(he),maxDevices:Number(j)||30,maxDemands:Number(ye)||200}),onSuccess:e=>{A(Td(e.demands??[])),oe(!0),O.success(`Seeded demands=${e.demands?.length??0}`)},onError:e=>O.error(String(e?.message??e??`seed failed`))}),Ct=i({mutationFn:async()=>{let t=Ed(ie);if(!t.length)throw Error(`no demands parsed from CSV`);if(T&&!w.trim())throw Error(`baselineSnapshotId is required when compareToBaseline is enabled`);let n=Number(re),r=Number(De),i=await Ju(e,{snapshotId:S.trim()||void 0,baselineSnapshotId:T&&w.trim()?w.trim():void 0,window:D,demands:t,phases:{routing:!0,capacity:!1,security:!1},routing:{thresholdUtil:Number.isFinite(n)?n:.8,forward:{maxResults:Number.isFinite(r)&&r>0?r:3},enforcement:{requireEnforcement:M},includeHops:xe,includeAcl:Te,projectLoad:Ce}});if(i?.routing)return i;throw Error(i?.errors?.routing??`routing evaluation failed`)},onError:e=>O.error(String(e?.message??e??`evaluate failed`))}),Tt=(0,P.useMemo)(()=>Ed(ie),[ie]);(0,P.useMemo)(()=>Dd(Ed(ie)),[ie]);let Et=i({mutationFn:async()=>{if(!s)throw Error(`select a scenario first`);if(T&&!w.trim())throw Error(`baselineSnapshotId is required when compareToBaseline is enabled`);let t=Tt.slice(0,200);if(!t.length)throw Error(`no demands parsed from CSV`);let n=Number(re),r=Number(De);Re({routing:`running`,capacity:`running`,security:ke&&ot?`running`:`skipped`});let i={snapshotId:S.trim()||void 0,window:D,thresholdUtil:Number.isFinite(n)?n:void 0,demands:t,routing:{includeHops:xe,projectLoad:Ce,includeAcl:Te,maxResults:Number.isFinite(r)&&r>0?r:3,baselineSnapshotId:w.trim()||void 0,requireEnforcement:M},capacity:{includeHops:ze},security:{requireEnforcement:Ve,includeNetworkFunctions:Ue,includeReturnPath:Ge,requireSymmetricDelivery:qe,requireReturnEnforcement:Ye,enforcementDeviceNameParts:Cd(Ze),enforcementTagParts:Cd($e)}},a=await Ju(e,{snapshotId:S.trim()||void 0,baselineSnapshotId:T&&w.trim()?w.trim():void 0,window:D,demands:t,phases:{routing:!0,capacity:!0,security:ke},routing:{thresholdUtil:Number.isFinite(n)?n:.8,forward:{maxResults:Number.isFinite(r)&&r>0?r:3},enforcement:{requireEnforcement:M},includeHops:xe,includeAcl:Te,projectLoad:Ce},capacity:{includeHops:ze},security:ke?{requireEnforcement:Ve,includeReturnPath:Ge,requireSymmetricDelivery:Ge?qe:void 0,requireReturnEnforcement:Ge?Ye:void 0,enforcementDeviceNameParts:Cd(Ze),enforcementTagParts:Cd($e),intent:`PREFER_DELIVERED`,includeTags:!0,includeNetworkFunctions:Ue,maxCandidates:5e3,maxResults:1,maxReturnPathResults:Ge?1:0,maxSeconds:30,maxOverallSeconds:300}:void 0}),o={...a.errors??{}},c={};a.routing?c.routingEval=a.routing:o.routingEval=o.routingEval??o.routing??`routing failed`,a.routingBaseline&&(c.routingBaseline=a.routingBaseline),a.routingDiff&&(c.routingDiff=a.routingDiff),a.capacity?c.capacityBottlenecks=a.capacity:o.capacityBottlenecks=o.capacityBottlenecks??o.capacity??`capacity failed`,a.capacityUpgradeCandidates&&(c.capacityUpgradeCandidates=a.capacityUpgradeCandidates),ke&&(a.security?c.securityPathsAssurance=a.security:o.securityPathsAssurance=o.securityPathsAssurance??o.security??`security failed`),Object.keys(o).length&&(c.errors=o),Re({routing:a.routing&&!a.errors?.routing?`succeeded`:`failed`,capacity:a.capacity&&!a.errors?.capacity?`succeeded`:`failed`,security:ke?a.security&&!a.errors?.security?`succeeded`:`failed`:`skipped`});let l=[`routingEval`,`capacityBottlenecks`,`securityPathsAssurance`].filter(e=>e in c).length,u=l===0?`FAILED`:l===(ke?3:2)?`SUCCEEDED`:`PARTIAL`;return{run:await Xu(e,{scenarioId:s,title:`${y.trim()||`Scenario`} (${new Date().toISOString()})`,status:u,error:Object.keys(o).length?JSON.stringify(o):void 0,request:i,results:c}),results:c}},onSuccess:async t=>{O.success(`Scenario run stored`,{description:t.run.id}),await a.invalidateQueries({queryKey:W.assuranceStudioRuns(e)}),Pe(t.run.id),Me(!0)},onError:e=>O.error(String(e?.message??e??`run failed`))}),Dt=i({mutationFn:async()=>{let t=Tt.filter(e=>String(e.dstIp??``).trim()).slice(0,200);if(t.length===0)throw Error(`no valid demands to evaluate`);let n=await Ju(e,{window:D,snapshotId:S.trim()||void 0,demands:t,phases:{routing:!1,capacity:!0,security:!1},capacity:{includeHops:ze}});if(n?.capacity)return{bottlenecks:n.capacity,upgradeCandidates:n.capacityUpgradeCandidates};throw Error(n?.errors?.capacity??`capacity evaluation failed`)},onError:e=>O.error(String(e?.message??e??`capacity bottlenecks failed`))});function Ot(e){try{let t=e?.results;return t?Array.isArray(t)?t:typeof t==`string`?JSON.parse(t):JSON.parse(String(t)):[]}catch{return[]}}let kt=i({mutationFn:async()=>{let t=Tt.filter(e=>String(e.dstIp??``).trim()).slice(0,200);if(t.length===0)throw Error(`no valid demands to evaluate`);let n=await Ju(e,{snapshotId:S.trim()||void 0,window:D,demands:t,phases:{routing:!1,capacity:!1,security:!0},security:{requireEnforcement:Ve,includeReturnPath:Ge,requireSymmetricDelivery:Ge?qe:void 0,requireReturnEnforcement:Ge?Ye:void 0,enforcementDeviceNameParts:Cd(Ze),enforcementTagParts:Cd($e),intent:`PREFER_DELIVERED`,includeTags:!0,includeNetworkFunctions:Ue,maxCandidates:5e3,maxResults:1,maxReturnPathResults:Ge?1:0,maxSeconds:30,maxOverallSeconds:300}});if(n?.security)return n.security;throw Error(n?.errors?.security??`security evaluation failed`)},onError:e=>O.error(String(e?.message??e??`paths assurance failed`))});return(0,I.jsxs)(`div`,{className:`space-y-6`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(R,{asChild:!0,variant:`ghost`,size:`sm`,children:(0,I.jsxs)(m,{to:`/dashboard/fwd`,children:[(0,I.jsx)(it,{className:`h-4 w-4`}),(0,I.jsx)(`span`,{className:`ml-2`,children:`Forward Networks`})]})}),(0,I.jsxs)(`div`,{children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Assurance Studio`}),(0,I.jsx)(`div`,{className:`text-lg font-semibold`,children:st})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(K,{variant:`secondary`,children:`Forward Paths + NQE`}),tt.isLoading?(0,I.jsx)(G,{className:`h-6 w-24`}):null,(0,I.jsx)(R,{asChild:!0,variant:`outline`,size:`sm`,children:(0,I.jsx)(m,{to:`/dashboard/fwd/$networkRef/hub`,params:{networkRef:e},children:`Assurance Hub`})}),(0,I.jsxs)(R,{variant:`outline`,size:`sm`,onClick:()=>ut.mutate(),disabled:ut.isPending,children:[(0,I.jsx)(nt,{className:`h-4 w-4 mr-2`}),ut.isPending?`Refreshing`:`Refresh Assurance`]}),l?(0,I.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>dt.mutate(),disabled:dt.isPending,children:dt.isPending?`Seeding`:`Seed demo signals`}):null]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-2 md:flex-row md:items-start md:justify-between`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(V,{children:`Assurance Summary`}),(0,I.jsx)(H,{children:`Live Forward snapshot health, vulnerabilities, capacity cache, and inbox signals.`})]}),(0,I.jsx)(`div`,{className:`flex flex-wrap items-center gap-2`,children:ct.isLoading?(0,I.jsx)(G,{className:`h-9 w-36`}):ct.isError?(0,I.jsx)(K,{variant:`destructive`,children:`summary unavailable`}):lt?(0,I.jsxs)(K,{variant:`outline`,className:`font-mono text-xs`,children:[`as of `,xd(lt.generatedAt)]}):null})]}),(0,I.jsxs)(U,{className:`grid gap-3 md:grid-cols-2 xl:grid-cols-3 text-sm`,children:[(0,I.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Snapshot`}),(0,I.jsx)(`div`,{className:`font-mono text-xs mt-1 truncate`,children:lt?.snapshot.snapshotId||``}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground mt-1`,children:[`age `,Sd(lt?.snapshot.ageSeconds),`  state`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:lt?.snapshot.state||``})]})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Indexing`}),(0,I.jsx)(`div`,{className:`mt-1`,children:(0,I.jsx)(K,{variant:lt?.indexingHealth.overall===`ok`?`default`:lt?.indexingHealth.overall===`warn`?`secondary`:`outline`,children:lt?.indexingHealth.overall||`unknown`})}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground mt-1 font-mono`,children:[`pathSearch=`,lt?.indexingHealth.pathSearchIndexingStatus||``]})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Vulnerabilities`}),(0,I.jsxs)(`div`,{className:`mt-1`,children:[(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:lt?.vulnerabilities.total??``}),lt?.vulnerabilities.partial?(0,I.jsx)(K,{variant:`secondary`,className:`ml-2`,children:`partial`}):null]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground mt-1`,children:[`known exploit`,` `,(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:lt?.vulnerabilities.knownExploitCount??``})]})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Capacity cache`}),(0,I.jsxs)(`div`,{className:`mt-1 text-xs`,children:[`hot ifaces (`,`>=`,`85% max):`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:lt?.capacity.hotInterfaces??0})]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground mt-1`,children:[`stale`,` `,(0,I.jsx)(K,{variant:lt?.capacity.stale?`secondary`:`default`,children:lt?.capacity.stale?`yes`:`no`})]})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Live signals (60m)`}),(0,I.jsxs)(`div`,{className:`mt-1 text-xs text-muted-foreground`,children:[`syslog`,` `,(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:lt?.liveSignals.syslog.total??0}),` `,`(crit`,` `,(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:lt?.liveSignals.syslog.critical??0}),`)`]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`snmp`,` `,(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:lt?.liveSignals.snmpTraps.total??0}),` `,`webhooks`,` `,(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:lt?.liveSignals.webhooks.total??0})]})]}),(0,I.jsxs)(`div`,{className:`rounded-md border p-3`,children:[(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Notes`}),(lt?.missing??[]).length>0?(0,I.jsx)(`div`,{className:`mt-1 flex flex-wrap gap-2`,children:(lt?.missing??[]).slice(0,6).map(e=>(0,I.jsxs)(K,{variant:`secondary`,children:[`missing:`,e]},e))}):(0,I.jsx)(`div`,{className:`mt-1 text-xs text-muted-foreground`,children:`No missing evidence detected.`}),(lt?.warnings??[]).length>0?(0,I.jsx)(`div`,{className:`mt-2 text-xs text-muted-foreground`,children:(lt?.warnings??[]).slice(0,3).join(`  `)}):null]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-2 md:flex-row md:items-start md:justify-between`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(V,{children:`Scenario`}),(0,I.jsx)(H,{children:`One saved scenario feeds Routing, Capacity, and Security tabs.`})]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsxs)(R,{variant:`outline`,size:`sm`,onClick:()=>ft.refetch(),disabled:ft.isFetching,children:[(0,I.jsx)(nt,{className:`h-4 w-4 mr-2`}),`Refresh`]}),(0,I.jsxs)(R,{variant:`outline`,size:`sm`,onClick:()=>d(!0),children:[(0,I.jsx)(v,{className:`h-4 w-4 mr-2`}),`New`]}),(0,I.jsx)(R,{variant:`outline`,size:`sm`,disabled:!s||yt.isPending,onClick:()=>yt.mutate(),children:`Duplicate`}),(0,I.jsxs)(R,{variant:`outline`,size:`sm`,disabled:!s||xt.isPending,onClick:()=>{s&&confirm(`Delete this scenario?`)&&xt.mutate()},children:[(0,I.jsx)(Ln,{className:`h-4 w-4 mr-2`}),`Delete`]}),(0,I.jsxs)(R,{size:`sm`,disabled:!s||bt.isPending||!ae,onClick:()=>bt.mutate(),children:[(0,I.jsx)(_e,{className:`h-4 w-4 mr-2`}),`Save`]}),(0,I.jsxs)(R,{size:`sm`,disabled:!s||Et.isPending,onClick:()=>Et.mutate(),children:[(0,I.jsx)(wt,{className:`h-4 w-4 mr-2`}),`Run scenario`]})]})]}),(0,I.jsxs)(U,{className:`space-y-4`,children:[Et.isPending||Le.routing!==`idle`?(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2 text-sm`,children:[(0,I.jsx)(K,{variant:`secondary`,children:`Run phases`}),(0,I.jsxs)(K,{variant:`secondary`,children:[`routing:`,` `,(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:Le.routing})]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`capacity:`,` `,(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:Le.capacity})]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`security:`,` `,(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:Le.security})]})]}):null,(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Scenario`}),(0,I.jsxs)(Y,{value:s,onValueChange:e=>{oe(!1),r({search:t=>({...t,scenario:String(e??``)})})},children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{placeholder:`Select scenario`})}),(0,I.jsx)(Q,{children:pt.map(e=>(0,I.jsx)($,{value:e.id,children:e.name},e.id))})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Name`}),(0,I.jsx)(J,{value:y,onChange:e=>{b(e.target.value),oe(!0)},placeholder:`Scenario name`})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`SnapshotId (optional)`}),(0,I.jsx)(J,{value:S,onChange:e=>{C(e.target.value),oe(!0)},placeholder:`latest processed`})]})]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1 md:col-span-2`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Baseline SnapshotId (optional)`}),(0,I.jsx)(J,{value:w,onChange:e=>{te(e.target.value),oe(!0)},placeholder:`for routing regressions`})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Compare routing`}),(0,I.jsxs)(`label`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:T,onChange:e=>{let t=e.target.checked;E(t),t&&Se(!0)}}),(0,I.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`vs baseline`})]})]})]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1 md:col-span-2`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Description`}),(0,I.jsx)(J,{value:x,onChange:e=>{ee(e.target.value),oe(!0)},placeholder:`Optional notes`})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Window`}),(0,I.jsxs)(Y,{value:D,onValueChange:e=>{ne(e),oe(!0)},children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`24h`,children:`24h`}),(0,I.jsx)($,{value:`7d`,children:`7d`}),(0,I.jsx)($,{value:`30d`,children:`30d`})]})]})]})]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-4`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Threshold util (0-1)`}),(0,I.jsx)(J,{value:re,onChange:e=>{k(e.target.value),oe(!0)}})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Max results`}),(0,I.jsx)(J,{value:De,onChange:e=>Oe(e.target.value)})]}),(0,I.jsxs)(`div`,{className:`flex items-end gap-2 md:col-span-2`,children:[(0,I.jsxs)(R,{disabled:Ct.isPending,onClick:()=>Ct.mutate(),children:[(0,I.jsx)(wt,{className:`h-4 w-4 mr-2`}),`Evaluate routing`]}),(0,I.jsx)(R,{variant:`secondary`,onClick:()=>A(``),children:`Clear demands`}),(0,I.jsxs)(`label`,{className:`ml-2 flex items-center gap-2 text-sm text-muted-foreground`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:ke,onChange:e=>Ae(e.target.checked)}),`Include security in run`]})]})]}),(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-2`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Recent runs`}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsxs)(Y,{value:Fe,onValueChange:e=>Ie(e===`SUCCEEDED`||e===`PARTIAL`||e===`FAILED`?e:`ALL`),children:[(0,I.jsx)(Z,{className:`h-8 w-[160px]`,children:(0,I.jsx)(X,{placeholder:`Filter`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`ALL`,children:`All`}),(0,I.jsx)($,{value:`SUCCEEDED`,children:`SUCCEEDED`}),(0,I.jsx)($,{value:`PARTIAL`,children:`PARTIAL`}),(0,I.jsx)($,{value:`FAILED`,children:`FAILED`})]})]}),(0,I.jsxs)(R,{variant:`outline`,size:`sm`,onClick:()=>ht.refetch(),disabled:ht.isFetching,children:[(0,I.jsx)(nt,{className:`h-4 w-4 mr-2`}),`Refresh`]})]})]}),ht.isLoading?(0,I.jsx)(G,{className:`h-14 w-full`}):gt.length===0?(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No stored runs yet.`}):(0,I.jsx)(`div`,{className:`overflow-x-auto rounded-md border`,children:(0,I.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,I.jsx)(`thead`,{className:`border-b text-xs text-muted-foreground`,children:(0,I.jsxs)(`tr`,{children:[(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Started`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Status`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Title`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Run ID`}),(0,I.jsx)(`th`,{className:`p-2 text-right`,children:`Actions`})]})}),(0,I.jsx)(`tbody`,{children:gt.slice(0,10).map(e=>(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.startedAt}),(0,I.jsx)(`td`,{className:`p-2`,children:(0,I.jsx)(K,{variant:e.status===`FAILED`?`destructive`:`secondary`,children:e.status})}),(0,I.jsx)(`td`,{className:`p-2`,children:e.title}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.id}),(0,I.jsx)(`td`,{className:`p-2 text-right`,children:(0,I.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>{Pe(e.id),Me(!0)},children:`View`})})]},e.id))})]})})]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-2`,children:[(0,I.jsxs)(z,{className:`border-dashed`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{className:`text-base`,children:`Seed demands`}),(0,I.jsx)(H,{children:`Uses NQE to discover device endpoints, then generates a demand set.`})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Mode`}),(0,I.jsxs)(Y,{value:se,onValueChange:ce,children:[(0,I.jsx)(Z,{children:(0,I.jsx)(X,{})}),(0,I.jsx)(Q,{children:(0,I.jsx)($,{value:`mesh`,children:`Mesh`})})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Include groups`}),(0,I.jsxs)(`div`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:le,onChange:e=>ue(e.target.checked)}),(0,I.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`match tagParts to groups too`})]})]})]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Tag parts`}),(0,I.jsx)(J,{value:de,onChange:e=>fe(e.target.value)})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Name parts`}),(0,I.jsx)(J,{value:pe,onChange:e=>me(e.target.value)})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Device types`}),(0,I.jsx)(J,{value:he,onChange:e=>ge(e.target.value),placeholder:`ROUTER,SWITCH`})]})]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Max devices`}),(0,I.jsx)(J,{value:j,onChange:e=>ve(e.target.value)})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Max demands`}),(0,I.jsx)(J,{value:ye,onChange:e=>be(e.target.value)})]}),(0,I.jsx)(`div`,{className:`flex items-end`,children:(0,I.jsx)(R,{variant:`outline`,disabled:St.isPending,onClick:()=>St.mutate(),children:`Seed`})})]})]})]}),(0,I.jsxs)(z,{className:`border-dashed`,children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{className:`text-base`,children:`Demands CSV`}),(0,I.jsxs)(H,{children:[`Canonical schema:`,` `,(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:`from,srcIp,dstIp,ipProto,srcPort,dstPort,bandwidthGbps,label`})]})]}),(0,I.jsxs)(U,{className:`space-y-2`,children:[(0,I.jsx)(kc,{className:`min-h-[260px] font-mono text-xs`,value:ie,onChange:e=>{A(e.target.value),oe(!0)},placeholder:`from,srcIp,dstIp,ipProto,srcPort,dstPort,bandwidthGbps,label`}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-3 text-sm text-muted-foreground`,children:[(0,I.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:xe,onChange:e=>Se(e.target.checked)}),`Include hops`]}),(0,I.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:Ce,onChange:e=>{let t=e.target.checked;we(t),t&&Se(!0)}}),`Project load`]}),(0,I.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:M,onChange:e=>N(e.target.checked)}),`Require enforcement traversal`]}),(0,I.jsxs)(`label`,{className:`flex items-center gap-2`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:Te,onChange:e=>Ee(e.target.checked)}),`Include ACL/NF details`]})]})]})]})]})]})]}),(0,I.jsxs)(ac,{value:c,onValueChange:e=>void r({search:t=>({...t,tab:e})}),children:[(0,I.jsxs)(oc,{children:[(0,I.jsx)(sc,{value:`routing`,children:`Routing`}),(0,I.jsx)(sc,{value:`capacity`,children:`Capacity`}),(0,I.jsx)(sc,{value:`security`,children:`Security`}),(0,I.jsx)(sc,{value:`actions`,children:`Actions`})]}),(0,I.jsx)(cc,{value:`routing`,className:`space-y-3`,children:(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Routing Results`})}),(0,I.jsxs)(U,{className:`space-y-3`,children:[Ct.isPending?(0,I.jsx)(G,{className:`h-20 w-full`}):null,Ct.data?.routing?(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,I.jsxs)(K,{variant:`secondary`,children:[`Demands: `,Ct.data.routing.summary.totalDemands]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`Delivered: `,Ct.data.routing.summary.delivered]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`Timed out: `,Ct.data.routing.summary.timedOut]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`Missing enforcement:`,` `,Ct.data.routing.summary.missingEnforcement]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`Crosses threshold:`,` `,Ct.data.routing.summary.crossesThreshold]})]}),Ct.data.routingDiff?(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Regression vs baseline`}),(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,I.jsxs)(K,{variant:`secondary`,children:[`Baseline:`,` `,(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:Ct.data.routingDiff.baselineSnapshotId??Ct.data.baselineSnapshotId??``})]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`Compare:`,` `,(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:Ct.data.routingDiff.compareSnapshotId??Ct.data.snapshotId??`latest`})]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`Changed: `,Ct.data.routingDiff.summary.changed,`/`,Ct.data.routingDiff.summary.totalDemands]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`Regressions:`,` `,Ct.data.routingDiff.summary.deliveryRegression]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`Improvements:`,` `,Ct.data.routingDiff.summary.deliveryImprovement]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`Path changed:`,` `,Ct.data.routingDiff.summary.pathChanged]})]}),(0,I.jsx)(`div`,{className:`overflow-x-auto`,children:(0,I.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,I.jsx)(`thead`,{children:(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`#`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Flow`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Reasons`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Baseline`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Compare`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Evidence`})]})}),(0,I.jsx)(`tbody`,{children:(Ct.data.routingDiff.items??[]).filter(e=>!!e.changed).slice(0,50).map(e=>(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`td`,{className:`p-2 text-muted-foreground`,children:e.index+1}),(0,I.jsxs)(`td`,{className:`p-2 font-mono text-xs`,children:[String(e.demand.srcIp??e.demand.from??``),` `,`-> `,e.demand.dstIp]}),(0,I.jsx)(`td`,{className:`p-2 text-xs`,children:(e.reasons??[]).includes(`delivery_regression`)?(0,I.jsx)(`span`,{className:`text-amber-600`,children:`delivery_regression`}):(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:(e.reasons??[]).join(`, `)||``})}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.baselineForwardingOutcome??``}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.compareForwardingOutcome??``}),(0,I.jsx)(`td`,{className:`p-2 text-xs`,children:(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[e.baselineQueryUrl?(0,I.jsx)(`a`,{href:e.baselineQueryUrl,target:`_blank`,rel:`noreferrer noopener`,className:`underline text-muted-foreground`,children:`baseline`}):null,e.compareQueryUrl?(0,I.jsx)(`a`,{href:e.compareQueryUrl,target:`_blank`,rel:`noreferrer noopener`,className:`underline text-muted-foreground`,children:`compare`}):null]})})]},e.index))})]})}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Showing first 50 changed flows.`})]}):null,(Ct.data.routing.interfaceImpacts??[]).length?(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Interface impacts`}),(0,I.jsx)(`div`,{className:`overflow-x-auto`,children:(0,I.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,I.jsx)(`thead`,{children:(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Device`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Interface`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Dir`}),(0,I.jsx)(`th`,{className:`p-2 text-right`,children:`Base p95`}),(0,I.jsx)(`th`,{className:`p-2 text-right`,children:`Added (Gbps)`}),(0,I.jsx)(`th`,{className:`p-2 text-right`,children:`Projected`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Crosses`})]})}),(0,I.jsx)(`tbody`,{children:[...Ct.data.routing.interfaceImpacts??[]].sort((e,t)=>Number(t.projectedUtil??0)-Number(e.projectedUtil??0)).slice(0,25).map(e=>(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.deviceName}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.interfaceName}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.direction}),(0,I.jsx)(`td`,{className:`p-2 text-right font-mono text-xs`,children:e.baseP95Util===void 0?``:e.baseP95Util.toFixed(3)}),(0,I.jsx)(`td`,{className:`p-2 text-right font-mono text-xs`,children:e.addedGbps===void 0?``:e.addedGbps.toFixed(3)}),(0,I.jsx)(`td`,{className:`p-2 text-right font-mono text-xs`,children:e.projectedUtil===void 0?``:e.projectedUtil.toFixed(3)}),(0,I.jsx)(`td`,{className:`p-2`,children:e.crossesThreshold?(0,I.jsx)(`span`,{className:`text-amber-600`,children:`yes`}):(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:`no`})})]},`${e.deviceName}:${e.interfaceName}:${e.direction}`))})]})}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Showing top 25 by projected utilization.`})]}):null,(0,I.jsx)(`div`,{className:`overflow-x-auto`,children:(0,I.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,I.jsx)(`thead`,{children:(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`#`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Demand`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Recommended`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Outcome`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Bottleneck`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Forward`})]})}),(0,I.jsx)(`tbody`,{children:Ct.data.routing.items.slice(0,50).map(e=>{let t=e.candidates?.[e.recommended],n=t?.bottleneck;return(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`td`,{className:`p-2 text-muted-foreground`,children:e.index+1}),(0,I.jsxs)(`td`,{className:`p-2`,children:[(0,I.jsxs)(`div`,{className:`font-mono`,children:[String(e.demand.srcIp??e.demand.from??``),` `,`-> `,e.demand.dstIp]}),e.demand.label?(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:e.demand.label}):null]}),(0,I.jsx)(`td`,{className:`p-2`,children:e.recommended}),(0,I.jsxs)(`td`,{className:`p-2`,children:[(0,I.jsx)(`div`,{children:t?.forwardingOutcome??e.error??``}),t&&!t.enforced?(0,I.jsx)(`div`,{className:`text-amber-600`,children:`missing enforcement`}):null]}),(0,I.jsx)(`td`,{className:`p-2`,children:n?(0,I.jsxs)(`div`,{className:`font-mono`,children:[n.deviceName,`:`,n.interfaceName,` (`,n.direction,`)`,n.headroomGbps===void 0?``:` headroom=${n.headroomGbps.toFixed(2)}G`,n.crossesThreshold?` crosses`:``]}):(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:``})}),(0,I.jsx)(`td`,{className:`p-2 text-xs`,children:e.queryUrl?(0,I.jsx)(`a`,{href:e.queryUrl,target:`_blank`,rel:`noreferrer noopener`,className:`underline text-muted-foreground`,children:`open`}):(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:``})})]},e.index)})})]})}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Showing first 50 demands.`})]}):(0,I.jsxs)(`div`,{className:`text-sm text-muted-foreground`,children:[`Click `,(0,I.jsx)(`span`,{className:`font-medium`,children:`Evaluate routing`}),` to run Forward paths-bulk and rank candidates.`]})]})]})}),(0,I.jsx)(cc,{value:`capacity`,className:`space-y-3`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Capacity (Scenario Lens)`}),(0,I.jsx)(H,{children:`Run capacity path-bottleneck analysis for the scenario demand set.`})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsx)(R,{disabled:Dt.isPending,onClick:()=>Dt.mutate(),children:`Evaluate capacity bottlenecks`}),(0,I.jsxs)(`label`,{className:`flex items-center gap-2 text-sm text-muted-foreground`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:ze,onChange:e=>Be(e.target.checked)}),`Include hops`]})]}),Dt.isPending?(0,I.jsx)(G,{className:`h-20 w-full`}):null,Dt.data?(0,I.jsxs)(`div`,{className:`space-y-4`,children:[(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`asOf=`,Dt.data.bottlenecks.asOf??``,` `,`coverage=`,Dt.data.bottlenecks.coverage?`${Dt.data.bottlenecks.coverage.rollupMatched}/${Dt.data.bottlenecks.coverage.hopInterfaceKeys} matched`:``]}),(()=>{let e=Dt.data.upgradeCandidates;return e?.items?.length?(0,I.jsxs)(`div`,{className:`rounded-md border p-3 space-y-2`,children:[(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center justify-between gap-2`,children:[(0,I.jsx)(`div`,{className:`text-sm font-medium`,children:`Upgrade candidates`}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`asOf=`,e.asOf??``]})]}),(0,I.jsx)(`div`,{className:`overflow-x-auto`,children:(0,I.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,I.jsx)(`thead`,{children:(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`User`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Target`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Speed`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Worst`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Max`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`P95`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Recommend`})]})}),(0,I.jsx)(`tbody`,{children:e.items.slice(0,5).map((e,t)=>(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.objectType??``}),(0,I.jsxs)(`td`,{className:`p-2 font-mono text-xs`,children:[e.device,`:`,e.name,e.members?.length?(0,I.jsxs)(`span`,{className:`text-muted-foreground`,children:[` `,`(`,e.members.length,` members)`]}):null]}),(0,I.jsxs)(`td`,{className:`p-2 font-mono text-xs`,children:[Math.round(e.speedMbps/1e3),`G`]}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.worstDirection}),(0,I.jsxs)(`td`,{className:`p-2 font-mono text-xs`,children:[(e.maxUtil*100).toFixed(0),`%`]}),(0,I.jsxs)(`td`,{className:`p-2 font-mono text-xs`,children:[(e.p95Util*100).toFixed(0),`%`]}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.recommendedSpeedMbps?(0,I.jsxs)(`span`,{children:[Math.round(e.recommendedSpeedMbps/1e3),`G`,` `,(0,I.jsxs)(`span`,{className:`text-muted-foreground`,children:[`(`,e.reason??`upgrade`,`)`]})]}):(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:``})})]},t))})]})}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Showing top 5 candidates.`})]}):null})(),(()=>{let e=Dt.data.bottlenecks,t=new Map;for(let n of e.items??[]){let e=n.bottleneck;if(!e)continue;let r=`${e.deviceName}:${e.interfaceName}:${e.direction}`;t.set(r,(t.get(r)??0)+1)}let n=Array.from(t.entries()).sort((e,t)=>t[1]-e[1]).slice(0,10);return n.length?(0,I.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:n.map(([e,t])=>(0,I.jsxs)(K,{variant:`secondary`,children:[(0,I.jsx)(`span`,{className:`font-mono`,children:t}),` `,(0,I.jsx)(`span`,{className:`text-muted-foreground`,children:e})]},e))}):null})(),(0,I.jsx)(`div`,{className:`overflow-x-auto`,children:(0,I.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,I.jsx)(`thead`,{children:(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`#`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Flow`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Outcome`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Bottleneck`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Headroom`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Forecast`})]})}),(0,I.jsx)(`tbody`,{children:Dt.data.bottlenecks.items.slice(0,50).map(e=>{let t=e.bottleneck;return(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`td`,{className:`p-2 text-muted-foreground`,children:e.index+1}),(0,I.jsxs)(`td`,{className:`p-2 font-mono text-xs`,children:[String(e.query.srcIp??e.query.from??``),` `,`-> `,e.query.dstIp]}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:e.forwardingOutcome??e.error??``}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:t?`${t.deviceName}:${t.interfaceName} (${t.direction})`:``}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:t?.headroomGbps!==null&&t?.headroomGbps!==void 0?`${Number(t.headroomGbps).toFixed(2)}G`:``}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:String(t?.forecastCrossingTs??``)})]},e.index)})})]})}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Showing first 50 flows.`})]}):(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Click Evaluate to compute bottlenecks from Forward paths + capacity rollups.`})]})]})}),(0,I.jsx)(cc,{value:`security`,className:`space-y-3`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Security (Paths Assurance)`}),(0,I.jsx)(H,{children:`Run enforcement-bypass detection against the scenario demand set.`})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Require enforcement`}),(0,I.jsxs)(`label`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:Ve,onChange:e=>He(e.target.checked)}),(0,I.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`violate if not enforced`})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Include return path`}),(0,I.jsxs)(`label`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:Ge,onChange:e=>Ke(e.target.checked)}),(0,I.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`also evaluate return path`})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Include networkFunctions`}),(0,I.jsxs)(`label`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:Ue,onChange:e=>We(e.target.checked)}),(0,I.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`ACL/NAT evidence (slower)`})]})]})]}),Ge?(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Require symmetric delivery`}),(0,I.jsxs)(`label`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:qe,onChange:e=>Je(e.target.checked)}),(0,I.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`delivered both ways`})]})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Require return enforcement`}),(0,I.jsxs)(`label`,{className:`flex h-10 items-center gap-2 rounded-md border px-3`,children:[(0,I.jsx)(`input`,{type:`checkbox`,checked:Ye,onChange:e=>Xe(e.target.checked)}),(0,I.jsx)(`span`,{className:`text-sm text-muted-foreground`,children:`enforced on return path`})]})]})]}):null,(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-3 md:grid-cols-2`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Enforcement device name parts`}),(0,I.jsx)(J,{value:Ze,onChange:e=>Qe(e.target.value),placeholder:`fw, firewall`})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Enforcement tag parts`}),(0,I.jsx)(J,{value:$e,onChange:e=>et(e.target.value),placeholder:`enforcement, inspection`})]})]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsx)(R,{disabled:kt.isPending||!ot,onClick:()=>kt.mutate(),children:`Run Paths Assurance`}),ot?null:(0,I.jsx)(`span`,{className:`text-sm text-amber-600`,children:`missing forwardNetworkId for this saved network`})]}),kt.isPending?(0,I.jsx)(G,{className:`h-20 w-full`}):null,kt.data?(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,I.jsxs)(K,{variant:`secondary`,children:[`Total: `,kt.data.total]}),(0,I.jsxs)(K,{variant:`secondary`,children:[`Snapshot: `,kt.data.snapshotId??`latest`]})]}),(()=>{let e=Ot(kt.data).filter(e=>!!e?.violation);return e.length?(0,I.jsx)(`div`,{className:`overflow-x-auto`,children:(0,I.jsxs)(`table`,{className:`w-full border-collapse text-sm`,children:[(0,I.jsx)(`thead`,{children:(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Flow`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Outcome`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Enforced`}),(0,I.jsx)(`th`,{className:`p-2 text-left`,children:`Reason`})]})}),(0,I.jsx)(`tbody`,{children:e.slice(0,50).map((e,t)=>(0,I.jsxs)(`tr`,{className:`border-b`,children:[(0,I.jsxs)(`td`,{className:`p-2 font-mono text-xs`,children:[String(e?.srcIp??``),` ->`,` `,String(e?.dstIp??``),` `,e?.ipProto===void 0?``:`p=${String(e?.ipProto)}`,e?.dstPort?` dport=${String(e?.dstPort)}`:``]}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:String(e?.forwardingOutcome??``)}),(0,I.jsx)(`td`,{className:`p-2 font-mono text-xs`,children:String(e?.enforced??``)}),(0,I.jsx)(`td`,{className:`p-2 text-xs text-muted-foreground`,children:Array.isArray(e?.riskReasons)&&e.riskReasons.length?String(e.riskReasons[0]):``})]},t))})]})}):(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`No violations detected.`})})()]}):(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Run Paths Assurance to detect enforcement bypass and delivery anomalies.`})]})]})}),(0,I.jsx)(cc,{value:`actions`,className:`space-y-3`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{children:[(0,I.jsx)(V,{children:`Actions`}),(0,I.jsx)(H,{children:`Demo artifacts and future closed-loop hooks.`})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`V1: export/copy artifacts; future: Ansible/tickets/change planning integrations.`}),(0,I.jsx)(R,{variant:`outline`,onClick:async()=>{let e=Ed(ie),t=Number(re),n={snapshotId:S.trim()||void 0,window:D,thresholdUtil:Number.isFinite(t)?t:void 0,demands:e};await navigator.clipboard.writeText(JSON.stringify(n,null,2)),O.success(`Copied scenario spec JSON to clipboard`)},disabled:!ie.trim(),children:`Copy scenario spec JSON`})]})]})})]}),(0,I.jsx)(Xn,{open:u,onOpenChange:d,children:(0,I.jsxs)($n,{children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{children:`New Scenario`})}),(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Name`}),(0,I.jsx)(J,{value:p,onChange:e=>h(e.target.value)})]}),(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Description`}),(0,I.jsx)(J,{value:g,onChange:e=>_(e.target.value)})]}),(0,I.jsxs)(`div`,{className:`flex items-center justify-end gap-2 pt-2`,children:[(0,I.jsx)(R,{variant:`outline`,onClick:()=>d(!1),children:`Cancel`}),(0,I.jsx)(R,{onClick:()=>vt.mutate(),disabled:vt.isPending,children:`Create`})]})]})]})}),(0,I.jsx)(Xn,{open:je,onOpenChange:e=>{Me(e),e||Pe(``)},children:(0,I.jsxs)($n,{className:`max-w-4xl`,children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{children:`Run Detail`})}),_t.isLoading?(0,I.jsx)(G,{className:`h-24 w-full`}):_t.isError?(0,I.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load run.`}):_t.data?(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`flex flex-wrap gap-2`,children:[(0,I.jsx)(K,{variant:`secondary`,children:_t.data.run.status}),(0,I.jsx)(K,{variant:`secondary`,children:(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:_t.data.run.id})})]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsx)(R,{variant:`outline`,size:`sm`,onClick:async()=>{await navigator.clipboard.writeText(JSON.stringify(_t.data,null,2)),O.success(`Copied run JSON to clipboard`)},children:`Copy JSON`}),(0,I.jsx)(R,{variant:`outline`,size:`sm`,onClick:()=>{let e=_t.data.run.id;wd(`assurance-studio-run-${e}.json`,`application/json`,JSON.stringify(_t.data,null,2)+`
`)},children:`Download JSON`})]}),(0,I.jsx)(kc,{readOnly:!0,className:`min-h-[420px] font-mono text-xs`,value:JSON.stringify(_t.data,null,2)})]}):(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:``})]})})]})}const kd=t(`/dashboard/fwd/$networkRef/assurance`)({component:Nd});function Ad(e){let t=String(e??``).trim();if(!t)return``;let n=Date.parse(t);return Number.isFinite(n)?new Date(n).toISOString():t}function jd(e){let t=Number(e??NaN);if(!Number.isFinite(t)||t<0)return``;let n=Math.floor(t/60),r=Math.floor(n/60);return r>0?`${r}h ${n%60}m`:n>0?`${n}m`:`${Math.floor(t)}s`}function Md(e){let t=Number(e??NaN);return Number.isFinite(t)?`${(t*100).toFixed(1)}%`:``}function Nd(){let e=o(),{networkRef:t}=kd.useParams(),n=f({queryKey:W.forwardNetworkAssuranceSummary(t),queryFn:()=>ki(t),enabled:!!t,staleTime:5e3,retry:!1}),r=n.data,a=(0,P.useMemo)(()=>r?.missing??[],[r?.missing]),s=(0,P.useMemo)(()=>r?.warnings??[],[r?.warnings]),c=i({mutationFn:async()=>Ai(t),onSuccess:async n=>{O.success(`Assurance refreshed`),e.setQueryData(W.forwardNetworkAssuranceSummary(t),n),await e.invalidateQueries({queryKey:W.forwardNetworkAssuranceHistory(t)})},onError:e=>O.error(`Refresh failed`,{description:e.message})}),l=f({queryKey:W.forwardNetworkAssuranceHistory(t),queryFn:()=>ji(t,`20`),enabled:!!t,staleTime:1e4,retry:!1}),u=(0,P.useMemo)(()=>l.data?.items??[],[l.data?.items]);return(0,I.jsxs)(`div`,{className:`space-y-6 p-6 pb-20`,children:[(0,I.jsxs)(`div`,{className:`flex items-start justify-between gap-4`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3 min-w-0`,children:[(0,I.jsx)(m,{to:`/dashboard/fwd`,className:So({variant:`outline`,size:`icon`,className:`h-9 w-9`}),children:(0,I.jsx)(it,{className:`h-4 w-4`})}),(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Assurance`}),(0,I.jsxs)(`p`,{className:`text-sm text-muted-foreground truncate`,children:[`Network ref: `,(0,I.jsx)(`span`,{className:`font-mono`,children:t})]})]})]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsxs)(R,{onClick:()=>c.mutate(),disabled:c.isPending,children:[(0,I.jsx)(nt,{className:`h-4 w-4 mr-2`}),c.isPending?`Refreshing`:`Refresh from Forward`]}),(0,I.jsx)(R,{asChild:!0,variant:`outline`,children:(0,I.jsx)(m,{to:`/dashboard/fwd/$networkRef/hub`,params:{networkRef:t},children:`Assurance Hub`})}),(0,I.jsx)(R,{asChild:!0,variant:`ghost`,children:(0,I.jsx)(m,{to:`/dashboard/fwd/$networkRef/assurance-studio`,params:{networkRef:t},children:`Advanced`})}),(0,I.jsx)(R,{asChild:!0,variant:`outline`,children:(0,I.jsx)(m,{to:`/dashboard/fwd/$networkRef/capacity`,params:{networkRef:t},children:`Capacity`})})]})]}),n.isLoading?(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`pt-6 text-sm text-muted-foreground`,children:`Loading`})}):n.isError?(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`pt-6 text-sm text-destructive`,children:`Failed to load assurance summary.`})}):null,a.length>0?(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Missing Evidence`})}),(0,I.jsxs)(U,{className:`space-y-2 text-sm`,children:[(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`Some Forward evidence has not been collected yet.`}),(0,I.jsx)(`div`,{className:`flex flex-wrap gap-2`,children:a.map(e=>(0,I.jsx)(K,{variant:`secondary`,children:e},e))})]})]}):null,s.length>0?(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Warnings`})}),(0,I.jsx)(U,{className:`space-y-1 text-sm`,children:s.map(e=>(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:e},e))})]}):null,r?(0,I.jsxs)(`div`,{className:`grid gap-4 md:grid-cols-2 xl:grid-cols-3`,children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Snapshot Freshness`})}),(0,I.jsxs)(U,{className:`space-y-1 text-sm`,children:[(0,I.jsxs)(`div`,{children:[`Snapshot:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:r.snapshot.snapshotId||``})]}),(0,I.jsxs)(`div`,{children:[`Processed:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:Ad(r.snapshot.processedAt)})]}),(0,I.jsxs)(`div`,{children:[`Age:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:jd(r.snapshot.ageSeconds)})]}),(0,I.jsxs)(`div`,{children:[`State:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:r.snapshot.state||``})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Indexing Health`})}),(0,I.jsxs)(U,{className:`space-y-1 text-sm`,children:[(0,I.jsxs)(`div`,{children:[`Overall:`,` `,(0,I.jsx)(K,{variant:r.indexingHealth.overall===`ok`?`default`:r.indexingHealth.overall===`warn`?`secondary`:`outline`,children:r.indexingHealth.overall})]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground pt-1`,children:[`pathSearch=`,r.indexingHealth.pathSearchIndexingStatus||``]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`search=`,r.indexingHealth.searchIndexingStatus||``,` l2=`,r.indexingHealth.l2IndexingStatus||``]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`host=`,r.indexingHealth.hostComputationStatus||``,` `,`ipLoc=`,r.indexingHealth.ipLocationIndexingStatus||``]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Vulnerabilities`})}),(0,I.jsxs)(U,{className:`space-y-1 text-sm`,children:[(0,I.jsxs)(`div`,{children:[`Total:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:r.vulnerabilities.total??``}),` `,r.vulnerabilities.partial?(0,I.jsx)(K,{variant:`secondary`,className:`ml-2`,children:`partial`}):null]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Known exploit:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:r.vulnerabilities.knownExploitCount??``})]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Index created:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:Ad(r.vulnerabilities.indexCreatedAt)})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`Capacity Cache`})}),(0,I.jsxs)(U,{className:`space-y-1 text-sm`,children:[(0,I.jsxs)(`div`,{children:[`As of:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:Ad(r.capacity.asOf)})]}),(0,I.jsxs)(`div`,{children:[`Hot ifaces (`,`>=`,`85% max):`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:r.capacity.hotInterfaces})]}),(0,I.jsxs)(`div`,{children:[`Max util max:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:Md(r.capacity.maxUtilMax)})]}),(0,I.jsxs)(`div`,{children:[`Stale:`,` `,(0,I.jsx)(K,{variant:r.capacity.stale?`secondary`:`default`,children:r.capacity.stale?`yes`:`no`})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsxs)(V,{children:[`Live Signals (Last `,r.liveSignals.windowMinutes,`m)`]})}),(0,I.jsxs)(U,{className:`space-y-1 text-sm`,children:[(0,I.jsxs)(`div`,{children:[`Syslog:`,` `,(0,I.jsxs)(`span`,{className:`font-mono`,children:[r.liveSignals.syslog.total,` (crit`,` `,r.liveSignals.syslog.critical,`)`]})]}),(0,I.jsxs)(`div`,{children:[`SNMP traps:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:r.liveSignals.snmpTraps.total})]}),(0,I.jsxs)(`div`,{children:[`Webhooks:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:r.liveSignals.webhooks.total})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{children:`History`})}),(0,I.jsx)(U,{className:`space-y-2 text-sm`,children:l.isLoading?(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`Loading`}):l.isError?(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`No history (migration not applied yet).`}):u.length===0?(0,I.jsx)(`div`,{className:`text-muted-foreground`,children:`No stored summaries yet. Click Refresh.`}):(0,I.jsx)(`div`,{className:`space-y-1`,children:u.slice(0,8).map(e=>(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:Ad(String(e.generatedAt??``))}),(0,I.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:String(e.snapshotId??``).trim()||``})]},String(e.id)))})})]})]}):null]})}const Pd=t(`/dashboard/deployments/$deploymentId/map`)({component:Fd});function Fd(){let{deploymentId:e}=Pd.useParams();ml(!0);let t=f({queryKey:W.dashboardSnapshot(),queryFn:yr,retry:!1,staleTime:1e4}),n=(0,P.useMemo)(()=>(t.data?.deployments??[]).find(t=>t.id===e),[e,t.data?.deployments]),r=String(n?.type??``),i=n?.activeTaskStatus??n?.lastStatus??`unknown`,a=f({queryKey:W.deploymentTopology(e),queryFn:async()=>{if(!n)throw Error(`deployment not found`);return ma(n.id)},enabled:!!n&&[`containerlab`,`netlab-c9s`,`clabernetes`].includes(r),retry:!1,staleTime:1e4});return n?(0,I.jsxs)(`div`,{className:`h-screen w-screen flex flex-col bg-background`,children:[(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3 border-b px-4 py-3`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3 min-w-0`,children:[(0,I.jsx)(m,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e},className:So({variant:`outline`,size:`icon`,className:`h-9 w-9`}),title:`Back to deployment`,children:(0,I.jsx)(it,{className:`h-4 w-4`})}),(0,I.jsxs)(`div`,{className:`min-w-0`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-2 min-w-0`,children:[(0,I.jsx)(`div`,{className:`font-semibold truncate`,children:n.name}),(0,I.jsx)(K,{variant:`secondary`,className:`capitalize`,children:i}),(0,I.jsx)(K,{variant:`outline`,className:`capitalize`,children:r||`unknown`})]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground font-mono truncate`,children:n.id})]})]}),(0,I.jsxs)(`div`,{className:`flex items-center gap-2`,children:[(0,I.jsxs)(`a`,{href:`/dashboard/labs/designer?importDeploymentId=${encodeURIComponent(e)}`,target:`_blank`,rel:`noreferrer noopener`,className:So({variant:`outline`,size:`sm`}),title:`Open this running topology in the Lab Designer (new tab)`,children:[(0,I.jsx)(ut,{className:`mr-2 h-4 w-4`}),`Edit in Designer`]}),(0,I.jsxs)(m,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e},className:So({variant:`outline`,size:`sm`}),title:`Open the deployment page`,children:[(0,I.jsx)(re,{className:`mr-2 h-4 w-4`}),`Details`]})]})]}),(0,I.jsx)(`div`,{className:`flex-1 min-h-0 p-3`,children:(0,I.jsx)(`div`,{className:`h-full`,children:(0,I.jsx)(Ul,{topology:a.data,deploymentId:n.id,enableTerminal:[`netlab-c9s`,`clabernetes`].includes(n.type),fullHeight:!0})})})]}):t.isLoading||t.isFetching?(0,I.jsxs)(`div`,{className:`h-screen w-screen p-6`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(G,{className:`h-9 w-9`}),(0,I.jsx)(G,{className:`h-8 w-64`})]}),(0,I.jsx)(`div`,{className:`mt-6`,children:(0,I.jsx)(G,{className:`h-[75vh] w-full`})})]}):(0,I.jsx)(`div`,{className:`h-screen w-screen p-6`,children:(0,I.jsx)(_s,{title:`Deployment not found`,description:`This deployment may have been deleted or you don't have access.`,action:{label:`Back`,onClick:()=>window.close()}})})}const Id=t(`/dashboard/deployments/$deploymentId/capacity`)({component:Jd});function Ld(e){try{return JSON.stringify(e,null,2)}catch{return String(e)}}function Rd(e,t,n){let r=new Blob([n],{type:t}),i=URL.createObjectURL(r);try{let t=document.createElement(`a`);t.href=i,t.download=e,t.click()}finally{URL.revokeObjectURL(i)}}function zd(e){let t=e==null?``:String(e);return t.includes(`"`)||t.includes(`,`)||t.includes(`
`)||t.includes(`\r`)?`"${t.replaceAll(`"`,`""`)}"`:t}function Bd(e,t){let n=[e.map(zd).join(`,`)];for(let e of t)n.push(e.map(zd).join(`,`));return n.join(`
`)+`
`}function Vd(e){if(!e)return null;let t=Date.parse(e);return Number.isFinite(t)?new Date(t):null}function Hd(e){return e===void 0||!Number.isFinite(e)?``:`${(e*100).toFixed(1)}%`}function Ud(e,t=3){return e===void 0||!Number.isFinite(e)?``:e.toFixed(t)}function Wd(e){let t=Number(e??0);return!Number.isFinite(t)||t<=0?``:t>=1e5||t>=1e4?`${(t/1e3).toFixed(0)}G`:t>=1e3?`${(t/1e3).toFixed(1)}G`:`${t}M`}function Gd(e,t){if(!e.length)return null;let n=[...e].filter(e=>Number.isFinite(e)).sort((e,t)=>e-t);if(!n.length)return null;if(t<=0)return n[0];if(t>=1)return n[n.length-1];let r=t*(n.length-1),i=Math.floor(r),a=Math.ceil(r);if(i===a)return n[i];let o=r-i;return n[i]*(1-o)+n[a]*o}function Kd(e){return e.startsWith(`util_`)?`UTILIZATION`:e.includes(`packet_loss`)?`PACKET_LOSS`:`ERROR`}function qd(e){return e.includes(`memory`)?`MEMORY`:`CPU`}function Jd(){let{deploymentId:e}=Id.useParams(),t=o(),[n,r]=(0,P.useState)(`24h`),[a,s]=(0,P.useState)(`util_ingress`),[c,l]=(0,P.useState)(`device_cpu`),[u,d]=(0,P.useState)(``),[p,h]=(0,P.useState)(``),[g,_]=(0,P.useState)(`all`),[v,y]=(0,P.useState)(`all`),[b,x]=(0,P.useState)(`all`),[ee,S]=(0,P.useState)(`all`),[C,w]=(0,P.useState)(`none`),[te,T]=(0,P.useState)(168),[E,D]=(0,P.useState)(`util_ingress`),[ne,re]=(0,P.useState)(`device_cpu`),[k,ie]=(0,P.useState)(null),[A,ae]=(0,P.useState)(null),[oe,se]=(0,P.useState)(null),[ce,le]=(0,P.useState)(!1),[ue,de]=(0,P.useState)(``),[fe,pe]=(0,P.useState)(!1),[me,he]=(0,P.useState)(``),[ge,_e]=(0,P.useState)(`all`),[j,ve]=(0,P.useState)(`all`),[ye,be]=(0,P.useState)(!1),[xe,Ce]=(0,P.useState)(``),we=f({queryKey:W.dashboardSnapshot(),queryFn:async()=>null,initialData:null,retry:!1,staleTime:1/0}),Te=(0,P.useMemo)(()=>(we.data?.deployments??[]).find(t=>t.id===e),[we.data?.deployments,e]),Ee=String((Te?.config??{}).forwardNetworkId??``),De=!!(Te?.config??{}).forwardEnabled,Oe=f({queryKey:W.deploymentCapacitySummary(e),queryFn:()=>Ti(e),enabled:!!(e&&De&&Ee),retry:!1,staleTime:3e4}),M=f({queryKey:W.deploymentCapacityInventory(e),queryFn:()=>Ii(e),enabled:!!(e&&De&&Ee),retry:!1,staleTime:3e4}),N=i({mutationFn:async()=>Ei(e),onSuccess:async n=>{O.success(`Refresh queued`,{description:`Run ${String(n.run?.id??``)}`.trim()}),await t.invalidateQueries({queryKey:W.deploymentCapacitySummary(e)}),await t.invalidateQueries({queryKey:W.deploymentCapacityInventory(e)}),await t.invalidateQueries({queryKey:[`deploymentCapacityGrowth`,e]})},onError:e=>O.error(`Failed to refresh`,{description:e.message})}),ke=i({mutationFn:async()=>Wi(e,{}),onSuccess:e=>se(e.body),onError:e=>O.error(`Failed to load unhealthy devices`,{description:e.message})}),Ae=(0,P.useMemo)(()=>{let e=M.data?.devices??[],t=M.data?.interfaceVrfs??[],n=new Set,r=new Set,i=new Set,a=new Set;for(let t of e){for(let e of t.tagNames??[]){let t=String(e??``).trim();t&&n.add(t)}for(let e of t.groupNames??[]){let t=String(e??``).trim();t&&r.add(t)}let e=String(t.locationName??``).trim();e&&i.add(e)}for(let e of t){let t=String(e.vrf??``).trim();t&&a.add(t)}return{tags:Array.from(n).sort(),groups:Array.from(r).sort(),locations:Array.from(i).sort(),vrfs:Array.from(a).sort()}},[M.data?.devices,M.data?.interfaceVrfs]),je=n===`24h`?1:n===`7d`?7:30,Me=Oe.data?.rollups??[],Ne=(0,P.useMemo)(()=>{let e=u.trim().toLowerCase(),t=Me.filter(e=>e.objectType===`interface`&&e.window===n&&e.metric===a).map(e=>{let t=e.details??{},n=String(t.deviceName??``).trim(),r=String(t.interfaceName??``).trim(),i=String(t.direction??``).trim(),a=String(t.vrf??``).trim()||void 0,o=Array.isArray(t.vrfNames)?t.vrfNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,s=String(t.locationName??``).trim()||void 0,c=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,l=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0;return{id:`${n}:${r}:${i}:${e.metric}:${e.window}`,device:n,iface:r,dir:i,vrf:a,vrfNames:o,locationName:s,tagNames:c,groupNames:l,speedMbps:t.speedMbps??null,admin:String(t.adminStatus??``).trim()||void 0,oper:String(t.operStatus??``).trim()||void 0,p95:e.p95,p99:e.p99,max:e.max,slopePerDay:e.slopePerDay,forecastCrossingTs:e.forecastCrossingTs,threshold:e.threshold,samples:e.samples,raw:e}}),r=(e?t.filter(t=>t.device.toLowerCase().includes(e)||t.iface.toLowerCase().includes(e)||(t.dir||``).toLowerCase().includes(e)):t).filter(e=>{if(b!==`all`&&(e.locationName??``)!==b)return!1;if(ee!==`all`){let t=ee;if(e.vrf!==t&&!(e.vrfNames??[]).includes(t))return!1}return!(g!==`all`&&!(e.tagNames??[]).includes(g)||v!==`all`&&!(e.groupNames??[]).includes(v))});return r.sort((e,t)=>(t.max??0)-(e.max??0)),r},[Me,n,a,u,b,ee,g,v]),Pe=(0,P.useMemo)(()=>{let e=p.trim().toLowerCase(),t=Me.filter(e=>e.objectType===`device`&&e.window===n&&e.metric===c).map(e=>{let t=e.details??{},n=String(t.deviceName??``).trim(),r=String(t.locationName??``).trim()||void 0,i=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,a=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0;return{id:`${n}:${e.metric}:${e.window}`,device:n,metric:e.metric,locationName:r,tagNames:i,groupNames:a,vendor:String(t.vendor??``).trim()||void 0,os:String(t.os??``).trim()||void 0,model:String(t.model??``).trim()||void 0,p95:e.p95,p99:e.p99,max:e.max,slopePerDay:e.slopePerDay,forecastCrossingTs:e.forecastCrossingTs,threshold:e.threshold,samples:e.samples,raw:e}}),r=(e?t.filter(t=>t.device.toLowerCase().includes(e)||(t.vendor||``).toLowerCase().includes(e)||(t.os||``).toLowerCase().includes(e)||(t.model||``).toLowerCase().includes(e)):t).filter(e=>!(b!==`all`&&(e.locationName??``)!==b||g!==`all`&&!(e.tagNames??[]).includes(g)||v!==`all`&&!(e.groupNames??[]).includes(v)));return r.sort((e,t)=>(t.max??0)-(e.max??0)),r},[Me,n,c,p,b,g,v]),Fe=(0,P.useMemo)(()=>{if(C===`none`)return[];let e=new Map,t=new Map,n=(n,r)=>{let i=e.get(n)??{group:n,count:0,hotCount:0,sumSpeedGbps:0,sumP95Gbps:0,sumMaxGbps:0,p95Count:0};i.count+=1,t.has(n)||t.set(n,new Set),t.get(n).add(r.device);let o=r.max??0,s=r.p95??void 0;if(i.maxMax=Math.max(i.maxMax??0,o),s!==void 0&&(i.maxP95=Math.max(i.maxP95??0,s),a.startsWith(`util_`))){let e=Number(r.speedMbps??0);if(e>0){let t=s*e/1e3;i.maxP95Gbps=Math.max(i.maxP95Gbps??0,t)}}if(a.startsWith(`util_`)){let e=Number(r.speedMbps??0);if(e>0&&(i.sumSpeedGbps=(i.sumSpeedGbps??0)+e/1e3,s!==void 0&&Number.isFinite(s)&&(i.sumP95Gbps=(i.sumP95Gbps??0)+s*e/1e3,i.p95Count=(i.p95Count??0)+1),r.max!==void 0&&r.max!==null&&Number.isFinite(r.max)&&(i.sumMaxGbps=(i.sumMaxGbps??0)+Number(r.max)*e/1e3)),r.forecastCrossingTs){let e=r.forecastCrossingTs;i.soonestForecast?Date.parse(e)<Date.parse(i.soonestForecast)&&(i.soonestForecast=e):i.soonestForecast=e}}a.startsWith(`util_`)&&o>=(r.threshold??.85)&&(i.hotCount+=1),e.set(n,i)};for(let e of Ne)if(C===`location`)n(e.locationName??`unknown`,e);else if(C===`tag`){let t=e.tagNames?.length?e.tagNames:[`untagged`];for(let r of t)n(r,e)}else if(C===`group`){let t=e.groupNames?.length?e.groupNames:[`ungrouped`];for(let r of t)n(r,e)}else C===`vrf`&&n(e.vrf??e.vrfNames?.[0]??`unknown`,e);let r=Array.from(e.values());if(C===`vrf`){let e=M.data?.routeScale??[],n=M.data?.bgpNeighbors??[];for(let i of r){let r=t.get(i.group)??new Set,a=0,o=0,s=0,c=0;for(let t of e)t.vrf===i.group&&r.has(t.deviceName)&&(a+=Number(t.ipv4Routes??0),o+=Number(t.ipv6Routes??0));for(let e of n)e.vrf===i.group&&r.has(e.deviceName)&&(s+=1,String(e.sessionState??``).toUpperCase().includes(`ESTABLISHED`)&&(c+=1));i.ipv4RoutesSum=a,i.ipv6RoutesSum=o,i.bgpNeighbors=s,i.bgpEstablished=c}}return r.sort((e,t)=>(t.maxP95Gbps??t.maxP95??0)-(e.maxP95Gbps??e.maxP95??0)),r},[Ne,C,a,M.data?.routeScale,M.data?.bgpNeighbors]),Ie=(0,P.useMemo)(()=>{if(C===`none`)return[];let e=new Map,t=(t,n)=>{let r=e.get(t)??{group:t,count:0,hotCount:0};r.count+=1;let i=n.max??0,a=n.p95??void 0;r.maxMax=Math.max(r.maxMax??0,i),a!==void 0&&(r.maxP95=Math.max(r.maxP95??0,a)),i>=(n.threshold??.85)&&(r.hotCount+=1),e.set(t,r)};for(let e of Pe)if(C===`location`)t(e.locationName??`unknown`,e);else if(C===`tag`){let n=e.tagNames?.length?e.tagNames:[`untagged`];for(let r of n)t(r,e)}else if(C===`group`){let n=e.groupNames?.length?e.groupNames:[`ungrouped`];for(let r of n)t(r,e)}let n=Array.from(e.values());return n.sort((e,t)=>(t.maxP95??0)-(e.maxP95??0)),n},[Pe,C]),Le=(0,P.useMemo)(()=>{let e=Me.filter(e=>e.metric.startsWith(`util_`));return{above:e.filter(e=>(e.max??0)>=.85).length,soonest:e.map(e=>({ts:e.forecastCrossingTs??``,r:e})).filter(e=>e.ts).sort((e,t)=>Date.parse(e.ts)-Date.parse(t.ts))[0]?.r}},[Me]),Re=f({queryKey:[`capacityIfaceHistory`,e,n,a,k?.id??``],queryFn:async()=>k?(await Bi(e,{type:Kd(a),days:je,maxSamples:400,interfaces:[{deviceName:k.device,interfaceName:k.iface,direction:k.dir}]})).body:null,enabled:!!(k&&e&&De&&Ee),retry:!1,staleTime:1e4}),ze=f({queryKey:[`capacityDeviceHistory`,e,n,c,A?.id??``],queryFn:async()=>A?(await Hi(e,{type:qd(c),days:je,maxSamples:400,devices:[A.device]})).body:null,enabled:!!(A&&e&&De&&Ee),retry:!1,staleTime:1e4}),Be=(0,P.useMemo)(()=>{let e=Re.data?.metrics?.[0];return(Array.isArray(e?.data)?e.data:[]).map(e=>({x:String(e?.instant??``),y:Number(e?.value??NaN)})).filter(e=>e.x&&Number.isFinite(e.y))},[Re.data]),Ve=(0,P.useMemo)(()=>{let e=ze.data?.metrics?.[0];return(Array.isArray(e?.data)?e.data:[]).map(e=>({x:String(e?.instant??``),y:Number(e?.value??NaN)})).filter(e=>e.x&&Number.isFinite(e.y))},[ze.data]),He=(0,P.useMemo)(()=>{let e=Be.map(e=>e.y);return{p95:Gd(e,.95),p99:Gd(e,.99),max:e.length?Math.max(...e):null}},[Be]),Ue=(0,P.useMemo)(()=>{let e=Ve.map(e=>e.y);return{p95:Gd(e,.95),p99:Gd(e,.99),max:e.length?Math.max(...e):null}},[Ve]),We=(0,P.useMemo)(()=>[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:200},{id:`iface`,header:`Interface`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.iface}),width:220},{id:`dir`,header:`Dir`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.dir||``}),width:90},{id:`vrf`,header:`VRF`,cell:e=>{let t=e.vrf??e.vrfNames?.[0]??``;if(!t)return(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let n=(e.vrfNames??[]).length;return(0,I.jsxs)(`div`,{className:`text-xs`,children:[(0,I.jsx)(`div`,{className:`font-mono`,children:t}),n>1?(0,I.jsxs)(`div`,{className:`text-muted-foreground`,children:[n,` vrfs`]}):null]})},width:160},{id:`speed`,header:`Speed`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:Wd(e.speedMbps??null)}),width:90,align:`right`},{id:`state`,header:`State`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:[e.admin,e.oper].filter(Boolean).join(` / `)||``}),width:140},{id:`p95`,header:`p95`,align:`right`,cell:e=>a.startsWith(`util_`)?Hd(e.p95):Ud(e.p95),width:90},...a.startsWith(`util_`)?[{id:`p95Gbps`,header:`p95 (Gbps)`,align:`right`,cell:e=>{let t=Number(e.speedMbps??0),n=Number(e.p95??NaN);return!t||!Number.isFinite(n)?(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,I.jsx)(`span`,{className:`text-xs`,children:(n*t/1e3).toFixed(2)})},width:110}]:[],{id:`max`,header:`Max`,align:`right`,cell:e=>{let t=a.startsWith(`util_`)?Hd(e.max):Ud(e.max),n=e.threshold??(a.startsWith(`util_`)?.85:void 0);return(0,I.jsx)(`span`,{className:n!==void 0&&(e.max??0)>=n?`text-destructive font-medium`:``,children:t})},width:90},...a.startsWith(`util_`)?[{id:`maxGbps`,header:`Max (Gbps)`,align:`right`,cell:e=>{let t=Number(e.speedMbps??0),n=Number(e.max??NaN);return!t||!Number.isFinite(n)?(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,I.jsx)(`span`,{className:`text-xs`,children:(n*t/1e3).toFixed(2)})},width:110},{id:`headroom85`,header:`Headroom@85 (Gbps)`,align:`right`,cell:e=>{let t=Number(e.speedMbps??0),n=Number(e.p95??NaN),r=Number(e.threshold??.85);return!t||!Number.isFinite(n)||!Number.isFinite(r)?(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,I.jsx)(`span`,{className:`text-xs`,children:(Math.max(0,(r-n)*t)/1e3).toFixed(2)})},width:150},{id:`days85`,header:`Days@85`,align:`right`,cell:e=>{if(!e.forecastCrossingTs)return(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let t=Vd(e.forecastCrossingTs);return t?(0,I.jsx)(`span`,{className:`text-xs`,children:Math.round((t.getTime()-Date.now())/(24*3600*1e3))}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90}]:[],{id:`slope`,header:`Slope/d`,align:`right`,cell:e=>a.startsWith(`util_`)?Hd(e.slopePerDay):Ud(e.slopePerDay),width:100},{id:`forecast`,header:`Forecast`,cell:e=>{if(!e.forecastCrossingTs)return(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let t=Vd(e.forecastCrossingTs),n=t?Math.round((t.getTime()-Date.now())/(24*3600*1e3)):null;return(0,I.jsxs)(`div`,{className:`text-xs`,children:[(0,I.jsx)(`div`,{className:`font-mono`,children:e.forecastCrossingTs.slice(0,10)}),n===null?null:(0,I.jsxs)(`div`,{className:`text-muted-foreground`,children:[n,`d`]})]})},width:120},{id:`samples`,header:`N`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.samples||0}),width:70}],[a]),Ge=(0,P.useMemo)(()=>[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:240},{id:`meta`,header:`Meta`,cell:e=>(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[(0,I.jsx)(`div`,{children:[e.vendor,e.os].filter(Boolean).join(`  `)||``}),(0,I.jsx)(`div`,{className:`font-mono`,children:e.model||``})]}),width:240},{id:`p95`,header:`p95`,align:`right`,cell:e=>Hd(e.p95),width:90},{id:`max`,header:`Max`,align:`right`,cell:e=>{let t=e.threshold??.85;return(0,I.jsx)(`span`,{className:(e.max??0)>=t?`text-destructive font-medium`:``,children:Hd(e.max)})},width:90},{id:`slope`,header:`Slope/d`,align:`right`,cell:e=>Hd(e.slopePerDay),width:100},{id:`forecast`,header:`Forecast`,cell:e=>{if(!e.forecastCrossingTs)return(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``});let t=Vd(e.forecastCrossingTs),n=t?Math.round((t.getTime()-Date.now())/(24*3600*1e3)):null;return(0,I.jsxs)(`div`,{className:`text-xs`,children:[(0,I.jsx)(`div`,{className:`font-mono`,children:e.forecastCrossingTs.slice(0,10)}),n===null?null:(0,I.jsxs)(`div`,{className:`text-muted-foreground`,children:[n,`d`]})]})},width:120},{id:`samples`,header:`N`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.samples||0}),width:70}],[]),Ke=f({queryKey:W.deploymentCapacityGrowth(e,n,E,te,`interface`),queryFn:()=>Ri(e,{metric:E,window:n,objectType:`interface`,compareHours:te,limit:50}),enabled:!!(e&&De&&Ee),retry:!1,staleTime:3e4}),qe=f({queryKey:W.deploymentCapacityGrowth(e,n,ne,te,`device`),queryFn:()=>Ri(e,{metric:ne,window:n,objectType:`device`,compareHours:te,limit:50}),enabled:!!(e&&De&&Ee),retry:!1,staleTime:3e4}),Je=(0,P.useMemo)(()=>(Ke.data?.rows??[]).map(e=>{let t=e?.now?.details??{},n=String(t.deviceName??e.objectId??``).trim(),r=String(t.interfaceName??``).trim(),i=String(t.direction??``).trim(),a=String(t.locationName??``).trim()||void 0,o=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,s=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0;return{id:String(e?.objectId??`${n}:${r}:${i}`),device:n,iface:r,dir:i,locationName:a,tagNames:o,groupNames:s,speedMbps:t.speedMbps??null,nowP95:e?.now?.p95,prevP95:e?.prev?.p95??null,deltaP95:e?.deltaP95??null,deltaP95Gbps:e?.deltaP95Gbps??null,nowMax:e?.now?.max,prevMax:e?.prev?.max??null,deltaMax:e?.deltaMax??null,nowForecast:e?.now?.forecastCrossingTs??void 0,raw:e}}).filter(e=>!(b!==`all`&&(e.locationName??``)!==b||g!==`all`&&!(e.tagNames??[]).includes(g)||v!==`all`&&!(e.groupNames??[]).includes(v))),[Ke.data?.rows,b,g,v]),Ye=(0,P.useMemo)(()=>(qe.data?.rows??[]).map(e=>{let t=e?.now?.details??{},n=String(t.deviceName??e.objectId??``).trim(),r=String(t.locationName??``).trim()||void 0,i=Array.isArray(t.tagNames)?t.tagNames.map(e=>String(e??``).trim()).filter(Boolean):void 0,a=Array.isArray(t.groupNames)?t.groupNames.map(e=>String(e??``).trim()).filter(Boolean):void 0;return{id:String(e?.objectId??n),device:n,locationName:r,tagNames:i,groupNames:a,vendor:String(t.vendor??``).trim()||void 0,os:String(t.os??``).trim()||void 0,model:String(t.model??``).trim()||void 0,nowP95:e?.now?.p95,prevP95:e?.prev?.p95??null,deltaP95:e?.deltaP95??null,nowMax:e?.now?.max,prevMax:e?.prev?.max??null,deltaMax:e?.deltaMax??null,nowForecast:e?.now?.forecastCrossingTs??void 0,raw:e}}).filter(e=>!(b!==`all`&&(e.locationName??``)!==b||g!==`all`&&!(e.tagNames??[]).includes(g)||v!==`all`&&!(e.groupNames??[]).includes(v))),[qe.data?.rows,b,g,v]),Xe=(0,P.useMemo)(()=>{let e=new Set,t=new Set;for(let n of M.data?.routeScale??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();r&&e.add(r),i&&t.add(i)}for(let n of M.data?.bgpNeighbors??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();r&&e.add(r),i&&t.add(i)}return{devices:Array.from(e).sort(),vrfs:Array.from(t).sort()}},[M.data?.routeScale,M.data?.bgpNeighbors]),Ze=(0,P.useMemo)(()=>(M.data?.routeScale??[]).filter(e=>!(ge!==`all`&&e.deviceName!==ge||j!==`all`&&e.vrf!==j)),[M.data?.routeScale,ge,j]),Qe=(0,P.useMemo)(()=>(M.data?.bgpNeighbors??[]).filter(e=>!(ge!==`all`&&e.deviceName!==ge||j!==`all`&&e.vrf!==j)),[M.data?.bgpNeighbors,ge,j]),$e=(0,P.useMemo)(()=>(M.data?.hardwareTcam??[]).filter(e=>!(ge!==`all`&&e.deviceName!==ge)),[M.data?.hardwareTcam,ge]),et=(0,P.useMemo)(()=>{let e=new Map,t=(e,t)=>`${e}||${t}`;for(let n of M.data?.routeScale??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();if(!r||!i)continue;let a=t(r,i),o=e.get(a)??{id:a,deviceName:r,vrf:i,ipv4Routes:0,ipv6Routes:0,bgpNeighbors:0,bgpEstablished:0};o.ipv4Routes=Number(n.ipv4Routes??0),o.ipv6Routes=Number(n.ipv6Routes??0),e.set(a,o)}for(let n of M.data?.bgpNeighbors??[]){let r=String(n.deviceName??``).trim(),i=String(n.vrf??``).trim();if(!r||!i)continue;let a=t(r,i),o=e.get(a)??{id:a,deviceName:r,vrf:i,ipv4Routes:0,ipv6Routes:0,bgpNeighbors:0,bgpEstablished:0};o.bgpNeighbors+=1,String(n.sessionState??``).toUpperCase().includes(`ESTABLISHED`)&&(o.bgpEstablished+=1),e.set(a,o)}for(let r of Me){if(r.objectType!==`interface`||r.window!==n||!r.metric.startsWith(`util_`))continue;let i=r.details??{},a=String(i.deviceName??``).trim(),o=String(i.vrf??``).trim();if(!a||!o)continue;let s=t(a,o),c=e.get(s)??{id:s,deviceName:a,vrf:o,ipv4Routes:0,ipv6Routes:0,bgpNeighbors:0,bgpEstablished:0};c.maxIfaceMax=Math.max(c.maxIfaceMax??0,r.max??0),r.p95!==void 0&&r.p95!==null&&(c.maxIfaceP95=Math.max(c.maxIfaceP95??0,r.p95??0));let l=r.forecastCrossingTs??``;l&&(c.soonestForecast?Date.parse(l)<Date.parse(c.soonestForecast)&&(c.soonestForecast=l):c.soonestForecast=l),e.set(s,c)}let r=Array.from(e.values());return r.sort((e,t)=>(t.maxIfaceMax??0)-(e.maxIfaceMax??0)),r},[M.data?.routeScale,M.data?.bgpNeighbors,Me,n]);return Te?(0,I.jsxs)(`div`,{className:`space-y-6 p-6 pb-20`,children:[(0,I.jsxs)(`div`,{className:`flex flex-col gap-4 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(m,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e},className:So({variant:`outline`,size:`icon`,className:`h-9 w-9`}),title:`Back to deployment`,children:(0,I.jsx)(it,{className:`h-4 w-4`})}),(0,I.jsxs)(`div`,{children:[(0,I.jsxs)(`h1`,{className:`text-2xl font-bold tracking-tight flex items-center gap-2`,children:[(0,I.jsx)(Se,{className:`h-5 w-5`}),` Capacity`]}),(0,I.jsxs)(`p`,{className:`text-sm text-muted-foreground mt-1`,children:[`Deployment: `,(0,I.jsx)(`span`,{className:`font-medium`,children:Te.name})]})]})]}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsxs)(Y,{value:n,onValueChange:e=>r(e),children:[(0,I.jsx)(Z,{className:`w-[110px]`,children:(0,I.jsx)(X,{placeholder:`Window`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`24h`,children:`24h`}),(0,I.jsx)($,{value:`7d`,children:`7d`}),(0,I.jsx)($,{value:`30d`,children:`30d`})]})]}),(0,I.jsxs)(Y,{value:b,onValueChange:x,children:[(0,I.jsx)(Z,{className:`w-[190px]`,children:(0,I.jsx)(X,{placeholder:`Location`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All locations`}),Ae.locations.map(e=>(0,I.jsx)($,{value:e,children:e},e))]})]}),(0,I.jsxs)(Y,{value:ee,onValueChange:S,children:[(0,I.jsx)(Z,{className:`w-[170px]`,children:(0,I.jsx)(X,{placeholder:`VRF`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All VRFs`}),Ae.vrfs.map(e=>(0,I.jsx)($,{value:e,children:e},e))]})]}),(0,I.jsxs)(Y,{value:g,onValueChange:_,children:[(0,I.jsx)(Z,{className:`w-[170px]`,children:(0,I.jsx)(X,{placeholder:`Tag`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All tags`}),Ae.tags.map(e=>(0,I.jsx)($,{value:e,children:e},e))]})]}),(0,I.jsxs)(Y,{value:v,onValueChange:y,children:[(0,I.jsx)(Z,{className:`w-[170px]`,children:(0,I.jsx)(X,{placeholder:`Group`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All groups`}),Ae.groups.map(e=>(0,I.jsx)($,{value:e,children:e},e))]})]}),(0,I.jsxs)(Y,{value:C,onValueChange:e=>w(e),children:[(0,I.jsx)(Z,{className:`w-[140px]`,children:(0,I.jsx)(X,{placeholder:`Group by`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`none`,children:`No grouping`}),(0,I.jsx)($,{value:`location`,children:`Location`}),(0,I.jsx)($,{value:`tag`,children:`Tag`}),(0,I.jsx)($,{value:`group`,children:`Group`}),(0,I.jsx)($,{value:`vrf`,children:`VRF`})]})]}),(0,I.jsxs)(R,{variant:`outline`,onClick:()=>N.mutate(),disabled:N.isPending||!De||!Ee,title:!De||!Ee?`Enable Forward and run sync first`:`Enqueue a background rollup task`,children:[(0,I.jsx)(nt,{className:`mr-2 h-4 w-4`}),N.isPending?`Queueing`:`Refresh`]})]})]}),(0,I.jsxs)(`div`,{className:`grid grid-cols-1 gap-4 md:grid-cols-3`,children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`As Of`})}),(0,I.jsxs)(U,{className:`text-sm`,children:[(0,I.jsx)(`div`,{className:`font-mono text-xs`,children:Oe.data?.asOf??M.data?.asOf??``}),(0,I.jsxs)(`div`,{className:`mt-2 flex items-center gap-2`,children:[Oe.data?.stale?(0,I.jsx)(K,{variant:`destructive`,children:`Stale`}):(0,I.jsx)(K,{variant:`secondary`,children:`Fresh`}),(0,I.jsx)(K,{variant:`outline`,className:`font-mono text-xs`,children:Ee||`no-forward`})]})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`Hot Interfaces`})}),(0,I.jsxs)(U,{className:`text-sm`,children:[(0,I.jsx)(`div`,{className:`text-2xl font-semibold`,children:Le.above}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground mt-1`,children:`util_* max >= 85%`})]})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{className:`pb-2`,children:(0,I.jsx)(V,{className:`text-sm`,children:`Soonest Saturation`})}),(0,I.jsx)(U,{className:`text-sm`,children:Le.soonest?.forecastCrossingTs?(0,I.jsxs)(`div`,{className:`space-y-1`,children:[(0,I.jsx)(`div`,{className:`font-mono text-xs`,children:Le.soonest.forecastCrossingTs}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[String(Le.soonest.details?.deviceName??``),` `,String(Le.soonest.details?.interfaceName??``),` `,String(Le.soonest.details?.direction??``)]})]}):(0,I.jsx)(`div`,{className:`text-muted-foreground text-sm`,children:``})})]})]}),(0,I.jsxs)(ac,{defaultValue:`interfaces`,className:`space-y-4`,children:[(0,I.jsxs)(oc,{children:[(0,I.jsx)(sc,{value:`interfaces`,children:`Interfaces`}),(0,I.jsx)(sc,{value:`devices`,children:`Devices`}),(0,I.jsx)(sc,{value:`growth`,children:`Growth`}),(0,I.jsx)(sc,{value:`routing`,children:`Routing/BGP`}),(0,I.jsx)(sc,{value:`health`,children:`Health`}),(0,I.jsx)(sc,{value:`raw`,children:`Raw`})]}),(0,I.jsx)(cc,{value:`interfaces`,className:`space-y-4`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Interface Capacity`}),(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 md:flex-row md:items-center`,children:[(0,I.jsx)(J,{placeholder:`Filter (device / interface)`,value:u,onChange:e=>d(e.target.value),className:`w-[260px]`}),(0,I.jsxs)(Y,{value:a,onValueChange:e=>s(e),children:[(0,I.jsx)(Z,{className:`w-[240px]`,children:(0,I.jsx)(X,{placeholder:`Metric`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`util_ingress`,children:`Utilization (ingress)`}),(0,I.jsx)($,{value:`util_egress`,children:`Utilization (egress)`}),(0,I.jsx)($,{value:`if_error_ingress`,children:`Errors (ingress)`}),(0,I.jsx)($,{value:`if_error_egress`,children:`Errors (egress)`}),(0,I.jsx)($,{value:`if_packet_loss_ingress`,children:`Packet loss (ingress)`}),(0,I.jsx)($,{value:`if_packet_loss_egress`,children:`Packet loss (egress)`})]})]}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>{let t=[`device`,`interface`,`direction`,`window`,`metric`,`speedMbps`,`adminStatus`,`operStatus`,`p95`,`p99`,`max`,`slopePerDay`,`forecastCrossingTs`,`samples`],r=Ne.map(e=>[e.device,e.iface,e.dir,n,a,e.speedMbps??``,e.admin??``,e.oper??``,e.p95??``,e.p99??``,e.max??``,e.slopePerDay??``,e.forecastCrossingTs??``,e.samples??0]);Rd(`capacity_interfaces_${e}_${n}_${a}.csv`,`text/csv`,Bd(t,r))},disabled:Ne.length===0,children:`Export CSV`}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>le(!0),disabled:M.isLoading||M.isError,title:`Pick any interface from NQE inventory and load trend from Forward perf history`,children:`Pick interface`})]})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[C===`none`?null:(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Group summary (`,C,`)`]}),(0,I.jsx)(gs,{columns:a.startsWith(`util_`)?[{id:`group`,header:`Group`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.group}),width:220},...C===`vrf`?[{id:`routes`,header:`Routes (v4/v6)`,align:`right`,cell:e=>(0,I.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[Number(e.ipv4RoutesSum??0),`/`,Number(e.ipv6RoutesSum??0)]}),width:130},{id:`bgp`,header:`BGP`,align:`right`,cell:e=>(0,I.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[Number(e.bgpNeighbors??0),` (`,Number(e.bgpEstablished??0),`)`]}),width:100}]:[],{id:`count`,header:`Ifaces`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.count}),width:80},{id:`speed`,header:` Speed (Gbps)`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.sumSpeedGbps===void 0?``:e.sumSpeedGbps.toFixed(1)}),width:120},{id:`p95sum`,header:` p95 (Gbps)`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.sumP95Gbps===void 0?``:e.sumP95Gbps.toFixed(2)}),width:120},{id:`maxsum`,header:` Max (Gbps)`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.sumMaxGbps===void 0?``:e.sumMaxGbps.toFixed(2)}),width:120},{id:`utilp95`,header:`Util@p95`,align:`right`,cell:e=>{let t=Number(e.sumSpeedGbps??0),n=Number(e.sumP95Gbps??0);return t?(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:Hd(n/t)}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90},{id:`utilmax`,header:`Util@max`,align:`right`,cell:e=>{let t=Number(e.sumSpeedGbps??0),n=Number(e.sumMaxGbps??0);return t?(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:Hd(n/t)}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90},{id:`headroom`,header:`Headroom@85 (Gbps)`,align:`right`,cell:e=>{let t=Number(e.sumSpeedGbps??0),n=Number(e.sumP95Gbps??0);return t?(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:Math.max(0,t*.85-n).toFixed(2)}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:150},{id:`p95cov`,header:`p95 cov`,align:`right`,cell:e=>(0,I.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[Number(e.p95Count??0),`/`,e.count]}),width:90},{id:`soonest`,header:`Soonest`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.soonestForecast?e.soonestForecast.slice(0,10):``}),width:110}]:[{id:`group`,header:`Group`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.group}),width:260},{id:`count`,header:`Count`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.count}),width:90},{id:`hot`,header:`Hot`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.hotCount}),width:90},{id:`p95`,header:`Max p95`,align:`right`,cell:e=>Ud(e.maxP95),width:100}],rows:Fe,getRowId:e=>e.group,onRowClick:e=>{C===`location`?x(e.group):C===`tag`?_(e.group===`untagged`?`all`:e.group):C===`group`?y(e.group===`ungrouped`?`all`:e.group):C===`vrf`&&S(e.group===`unknown`?`all`:e.group)},emptyText:`No groups.`,maxHeightClassName:`max-h-[260px]`,minWidthClassName:`min-w-0`})]}),Oe.isLoading?(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(G,{className:`h-5 w-56`}),(0,I.jsx)(G,{className:`h-32 w-full`})]}):Oe.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load summary:`,` `,Oe.error instanceof Error?Oe.error.message:String(Oe.error)]}):(0,I.jsx)(gs,{columns:We,rows:Ne,getRowId:e=>e.id,onRowClick:e=>ie(e),emptyText:`No rollups for this window/metric yet. Click Refresh to enqueue.`})]})]})}),(0,I.jsx)(cc,{value:`devices`,className:`space-y-4`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Device Capacity`}),(0,I.jsxs)(`div`,{className:`flex flex-col gap-2 md:flex-row md:items-center`,children:[(0,I.jsx)(J,{placeholder:`Filter (device / vendor / os)`,value:p,onChange:e=>h(e.target.value),className:`w-[260px]`}),(0,I.jsxs)(Y,{value:c,onValueChange:e=>l(e),children:[(0,I.jsx)(Z,{className:`w-[220px]`,children:(0,I.jsx)(X,{placeholder:`Metric`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`device_cpu`,children:`CPU`}),(0,I.jsx)($,{value:`device_memory`,children:`Memory`})]})]}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>{let t=[`device`,`window`,`metric`,`vendor`,`os`,`model`,`p95`,`p99`,`max`,`slopePerDay`,`forecastCrossingTs`,`samples`],r=Pe.map(e=>[e.device,n,c,e.vendor??``,e.os??``,e.model??``,e.p95??``,e.p99??``,e.max??``,e.slopePerDay??``,e.forecastCrossingTs??``,e.samples??0]);Rd(`capacity_devices_${e}_${n}_${c}.csv`,`text/csv`,Bd(t,r))},disabled:Pe.length===0,children:`Export CSV`}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>pe(!0),disabled:M.isLoading||M.isError,title:`Pick any device from NQE inventory and load trend from Forward perf history`,children:`Pick device`})]})]}),(0,I.jsxs)(U,{className:`space-y-3`,children:[C===`none`?null:(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`Group summary (`,C,`)`]}),(0,I.jsx)(gs,{columns:[{id:`group`,header:`Group`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.group}),width:260},{id:`count`,header:`Count`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.count}),width:90},{id:`hot`,header:`Hot`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.hotCount}),width:90},{id:`p95`,header:`Max p95`,align:`right`,cell:e=>Hd(e.maxP95),width:100}],rows:Ie,getRowId:e=>e.group,emptyText:`No groups.`,maxHeightClassName:`max-h-[260px]`,minWidthClassName:`min-w-0`})]}),Oe.isLoading?(0,I.jsxs)(`div`,{className:`space-y-2`,children:[(0,I.jsx)(G,{className:`h-5 w-56`}),(0,I.jsx)(G,{className:`h-32 w-full`})]}):Oe.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load summary:`,` `,Oe.error instanceof Error?Oe.error.message:String(Oe.error)]}):(0,I.jsx)(gs,{columns:Ge,rows:Pe,getRowId:e=>e.id,onRowClick:e=>ae(e),emptyText:`No rollups for this window/metric yet. Click Refresh to enqueue.`})]})]})}),(0,I.jsxs)(cc,{value:`growth`,className:`space-y-4`,children:[(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Growth (Delta vs Prior)`}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsxs)(Y,{value:String(te),onValueChange:e=>T(Number(e)),children:[(0,I.jsx)(Z,{className:`w-[150px]`,children:(0,I.jsx)(X,{placeholder:`Compare`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`24`,children:`24h`}),(0,I.jsx)($,{value:`168`,children:`7d`}),(0,I.jsx)($,{value:`720`,children:`30d`}),(0,I.jsx)($,{value:`2160`,children:`90d`})]})]}),(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[`As of`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:Ke.data?.asOf??qe.data?.asOf??Oe.data?.asOf??``}),`  `,`Compared to`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:Ke.data?.compareAsOf??qe.data?.compareAsOf??``})]})]})]}),(0,I.jsx)(U,{className:`text-sm text-muted-foreground`,children:`Top growers computed from Skyforge rollups (no Forward time-series pull). Use Refresh to enqueue rollup recomputation.`})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Interfaces`}),(0,I.jsxs)(Y,{value:E,onValueChange:e=>D(e),children:[(0,I.jsx)(Z,{className:`w-[240px]`,children:(0,I.jsx)(X,{placeholder:`Metric`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`util_ingress`,children:`Utilization (ingress)`}),(0,I.jsx)($,{value:`util_egress`,children:`Utilization (egress)`})]})]})]}),(0,I.jsx)(U,{children:Ke.isLoading?(0,I.jsx)(G,{className:`h-32 w-full`}):Ke.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load growth:`,` `,Ke.error instanceof Error?Ke.error.message:String(Ke.error)]}):(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:220},{id:`iface`,header:`Interface`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.iface}),width:220},{id:`dir`,header:`Dir`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.dir}),width:90},{id:`speed`,header:`Speed`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:Wd(e.speedMbps??null)}),width:90},{id:`nowP95`,header:`Now p95`,align:`right`,cell:e=>Hd(e.nowP95),width:100},{id:`prevP95`,header:`Prev p95`,align:`right`,cell:e=>Hd(e.prevP95??void 0),width:100},{id:`deltaP95`,header:` p95`,align:`right`,cell:e=>{let t=e.deltaP95;return t==null?(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,I.jsxs)(`span`,{className:t>0?`text-foreground font-medium`:`text-muted-foreground`,children:[t>=0?`+`:``,Hd(t)]})},width:90},{id:`deltaGbps`,header:` p95 (Gbps)`,align:`right`,cell:e=>e.deltaP95Gbps!==null&&e.deltaP95Gbps!==void 0?(0,I.jsxs)(`span`,{className:`text-xs`,children:[e.deltaP95Gbps>=0?`+`:``,e.deltaP95Gbps.toFixed(2)]}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}),width:120},{id:`forecast`,header:`Forecast`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.nowForecast?e.nowForecast.slice(0,10):``}),width:120}],rows:Je,getRowId:e=>e.id,onRowClick:e=>{s(E),ie({id:`${e.device}:${e.iface}:${e.dir}:growth`,device:e.device,iface:e.iface,dir:e.dir||`INGRESS`,speedMbps:e.speedMbps??null,samples:0})},emptyText:`No growth rows yet. Click Refresh to enqueue.`})})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Devices`}),(0,I.jsxs)(Y,{value:ne,onValueChange:e=>re(e),children:[(0,I.jsx)(Z,{className:`w-[220px]`,children:(0,I.jsx)(X,{placeholder:`Metric`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`device_cpu`,children:`CPU`}),(0,I.jsx)($,{value:`device_memory`,children:`Memory`})]})]})]}),(0,I.jsx)(U,{children:qe.isLoading?(0,I.jsx)(G,{className:`h-32 w-full`}):qe.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load growth:`,` `,qe.error instanceof Error?qe.error.message:String(qe.error)]}):(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.device}),width:240},{id:`meta`,header:`Meta`,cell:e=>(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[(0,I.jsx)(`div`,{children:[e.vendor,e.os].filter(Boolean).join(`  `)||``}),(0,I.jsx)(`div`,{className:`font-mono`,children:e.model||``})]}),width:240},{id:`nowP95`,header:`Now p95`,align:`right`,cell:e=>Hd(e.nowP95),width:100},{id:`prevP95`,header:`Prev p95`,align:`right`,cell:e=>Hd(e.prevP95??void 0),width:100},{id:`deltaP95`,header:` p95`,align:`right`,cell:e=>{let t=e.deltaP95;return t==null?(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``}):(0,I.jsxs)(`span`,{className:t>0?`text-foreground font-medium`:`text-muted-foreground`,children:[t>=0?`+`:``,Hd(t)]})},width:90},{id:`forecast`,header:`Forecast`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.nowForecast?e.nowForecast.slice(0,10):``}),width:120}],rows:Ye,getRowId:e=>e.id,onRowClick:e=>{l(ne),ae({id:`${e.device}:growth`,device:e.device,metric:ne,vendor:e.vendor,os:e.os,model:e.model,samples:0})},emptyText:`No growth rows yet. Click Refresh to enqueue.`})})]})]}),(0,I.jsxs)(cc,{value:`routing`,className:`space-y-4`,children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{className:`text-base`,children:`VRF Summary (Perf + Scale)`})}),(0,I.jsx)(U,{children:M.isLoading?(0,I.jsx)(G,{className:`h-28 w-full`}):M.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,M.error instanceof Error?M.error.message:String(M.error)]}):(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:240},{id:`vrf`,header:`VRF`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:180},{id:`v4`,header:`IPv4`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.ipv4Routes}),width:90},{id:`v6`,header:`IPv6`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:e.ipv6Routes}),width:90},{id:`bgp`,header:`BGP`,align:`right`,cell:e=>(0,I.jsxs)(`span`,{className:`text-xs tabular-nums`,children:[e.bgpNeighbors,` (`,e.bgpEstablished,`)`]}),width:110},{id:`max`,header:`Max util`,align:`right`,cell:e=>Hd(e.maxIfaceMax),width:100},{id:`forecast`,header:`Soonest`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.soonestForecast?e.soonestForecast.slice(0,10):``}),width:120}],rows:et,getRowId:e=>e.id,onRowClick:e=>{_e(e.deviceName),ve(e.vrf),S(e.vrf)},emptyText:`No VRF summary available yet. Click Refresh to enqueue.`,maxHeightClassName:`max-h-[360px]`,minWidthClassName:`min-w-0`})})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-2 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Hardware Capacity (TCAM)`}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Derived from Forward CUSTOM command outputs. Configure a TCAM command collection to populate.`})]}),(0,I.jsx)(U,{children:M.isLoading?(0,I.jsx)(G,{className:`h-28 w-full`}):M.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,M.error instanceof Error?M.error.message:String(M.error)]}):(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:240},{id:`meta`,header:`Meta`,cell:e=>(0,I.jsxs)(`div`,{className:`text-xs text-muted-foreground`,children:[(0,I.jsx)(`div`,{children:[e.vendor??``,e.os??``].filter(Boolean).join(`  `)||``}),(0,I.jsx)(`div`,{className:`font-mono`,children:String(e.model??``)})]}),width:240},{id:`used`,header:`Used`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:Number(e.tcamUsed??0)}),width:90},{id:`total`,header:`Total`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs tabular-nums`,children:Number(e.tcamTotal??0)}),width:90},{id:`util`,header:`Util`,align:`right`,cell:e=>{let t=Number(e.tcamUsed??0),n=Number(e.tcamTotal??0);return n?(0,I.jsx)(`span`,{className:`text-xs`,children:Hd(t/n)}):(0,I.jsx)(`span`,{className:`text-muted-foreground text-xs`,children:``})},width:90},{id:`cmd`,header:`Command`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:String(e.commandText??``).slice(0,48)||``}),width:260},{id:`evidence`,header:`Evidence`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs text-muted-foreground`,children:String(e.evidence??``).slice(0,60)||``}),width:320}],rows:$e,getRowId:e=>e.deviceName,onRowClick:e=>{_e(e.deviceName),Ce([`device: ${String(e.deviceName??``)}`,`command: ${String(e.commandText??``)}`,`used/total: ${Number(e.tcamUsed??0)}/${Number(e.tcamTotal??0)}`,``,String(e.evidence??``)].join(`
`)),be(!0)},emptyText:`No TCAM rows cached yet. Click Refresh after enabling custom commands.`,maxHeightClassName:`max-h-[320px]`,minWidthClassName:`min-w-0`})})]}),(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Routing Scale`}),(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center gap-2`,children:[(0,I.jsxs)(Y,{value:ge,onValueChange:_e,children:[(0,I.jsx)(Z,{className:`w-[220px]`,children:(0,I.jsx)(X,{placeholder:`Device`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All devices`}),Xe.devices.map(e=>(0,I.jsx)($,{value:e,children:e},e))]})]}),(0,I.jsxs)(Y,{value:j,onValueChange:ve,children:[(0,I.jsx)(Z,{className:`w-[170px]`,children:(0,I.jsx)(X,{placeholder:`VRF`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`all`,children:`All VRFs`}),Xe.vrfs.map(e=>(0,I.jsx)($,{value:e,children:e},e))]})]}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>{_e(`all`),ve(`all`)},disabled:ge===`all`&&j===`all`,children:`Clear`})]})]}),(0,I.jsx)(U,{children:M.isLoading?(0,I.jsx)(G,{className:`h-28 w-full`}):M.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,M.error instanceof Error?M.error.message:String(M.error)]}):(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:240},{id:`vrf`,header:`VRF`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:180},{id:`v4`,header:`IPv4`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.ipv4Routes}),width:90},{id:`v6`,header:`IPv6`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.ipv6Routes}),width:90}],rows:Ze,getRowId:e=>`${e.deviceName}:${e.vrf}`,emptyText:`No routing scale cached yet. Click Refresh to enqueue.`})})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{className:`text-base`,children:`BGP Neighbors`})}),(0,I.jsx)(U,{children:M.isLoading?(0,I.jsx)(G,{className:`h-28 w-full`}):M.isError?(0,I.jsxs)(`div`,{className:`text-destructive text-sm`,children:[`Failed to load inventory:`,` `,M.error instanceof Error?M.error.message:String(M.error)]}):(0,I.jsx)(gs,{columns:[{id:`device`,header:`Device`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.deviceName}),width:220},{id:`vrf`,header:`VRF`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.vrf}),width:160},{id:`nbr`,header:`Neighbor`,cell:e=>(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:e.neighborAddress}),width:220},{id:`state`,header:`State`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.sessionState??``}),width:120},{id:`rx`,header:`Rx`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.receivedPrefixes??``}),width:90},{id:`tx`,header:`Tx`,align:`right`,cell:e=>(0,I.jsx)(`span`,{className:`text-xs`,children:e.advertisedPrefixes??``}),width:90}],rows:Qe,getRowId:e=>`${e.deviceName}:${e.vrf}:${e.neighborAddress}`,emptyText:`No BGP cache yet. Click Refresh to enqueue.`})})]})]}),(0,I.jsx)(cc,{value:`health`,className:`space-y-4`,children:(0,I.jsxs)(z,{children:[(0,I.jsxs)(B,{className:`flex flex-col gap-3 md:flex-row md:items-center md:justify-between`,children:[(0,I.jsx)(V,{className:`text-base`,children:`Health Issues`}),(0,I.jsx)(R,{variant:`outline`,onClick:()=>ke.mutate(),disabled:ke.isPending,children:ke.isPending?`Loading`:`Load unhealthy devices`})]}),(0,I.jsx)(U,{className:`space-y-2`,children:oe?(0,I.jsx)(`pre`,{className:`max-h-[60vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:Ld(oe)}):(0,I.jsx)(`div`,{className:`text-sm text-muted-foreground`,children:`Loads Forward health signals (including high utilization) around the latest processed snapshot.`})})]})}),(0,I.jsxs)(cc,{value:`raw`,className:`space-y-4`,children:[(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{className:`text-base`,children:`Raw Rollups`})}),(0,I.jsx)(U,{className:`space-y-2`,children:Oe.isLoading?(0,I.jsx)(G,{className:`h-32 w-full`}):Oe.isError?(0,I.jsx)(`div`,{className:`text-destructive text-sm`,children:Oe.error instanceof Error?Oe.error.message:String(Oe.error)}):(0,I.jsx)(`pre`,{className:`max-h-[65vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:Ld(Oe.data?.rollups??[])})})]}),(0,I.jsxs)(z,{children:[(0,I.jsx)(B,{children:(0,I.jsx)(V,{className:`text-base`,children:`Raw Inventory`})}),(0,I.jsx)(U,{className:`space-y-2`,children:M.isLoading?(0,I.jsx)(G,{className:`h-32 w-full`}):M.isError?(0,I.jsx)(`div`,{className:`text-destructive text-sm`,children:M.error instanceof Error?M.error.message:String(M.error)}):(0,I.jsx)(`pre`,{className:`max-h-[65vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:Ld(M.data??{})})})]})]})]}),(0,I.jsx)(Xn,{open:!!k,onOpenChange:e=>!e&&ie(null),children:(0,I.jsxs)($n,{className:`max-w-3xl`,children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{className:`text-base`,children:`Interface Trend`})}),k?(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`text-sm`,children:[(0,I.jsxs)(`span`,{className:`font-mono text-xs`,children:[k.device,` `,k.iface,` `,k.dir]}),` `,(0,I.jsx)(K,{variant:`outline`,className:`ml-2`,children:n}),(0,I.jsx)(K,{variant:`secondary`,className:`ml-2`,children:a}),(0,I.jsxs)(Y,{value:k.dir,onValueChange:e=>ie(t=>t&&{...t,dir:String(e)}),children:[(0,I.jsx)(Z,{className:`ml-2 inline-flex h-7 w-[140px]`,children:(0,I.jsx)(X,{placeholder:`Direction`})}),(0,I.jsxs)(Q,{children:[(0,I.jsx)($,{value:`INGRESS`,children:`INGRESS`}),(0,I.jsx)($,{value:`EGRESS`,children:`EGRESS`})]})]}),k.vrf||k.vrfNames?.length?(0,I.jsxs)(`div`,{className:`mt-2 flex flex-wrap items-center gap-2 text-xs`,children:[(0,I.jsx)(K,{variant:`outline`,className:`font-mono text-xs`,children:`VRF`}),(0,I.jsxs)(`span`,{className:`font-mono text-xs`,children:[k.vrf??(k.vrfNames??[]).slice(0,3).join(`, `),(k.vrfNames??[]).length>3?``:``]}),(0,I.jsx)(R,{variant:`outline`,className:`h-7 px-2`,onClick:()=>{_e(k.device),ve(k.vrf??k.vrfNames?.[0]??`all`)},title:`Filter Routing/BGP tables to this device/VRF`,children:`Filter routing`})]}):null]}),Re.isLoading?(0,I.jsx)(G,{className:`h-24 w-full`}):Re.isError?(0,I.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load history`}):(0,I.jsx)(id,{points:Be}),(()=>{let e=k.vrfNames?.length?k.vrfNames:k.vrf?[k.vrf]:[];if(!e.length)return null;let t=(M.data?.routeScale??[]).filter(t=>t.deviceName===k.device&&e.includes(t.vrf)),n=(M.data?.bgpNeighbors??[]).filter(t=>t.deviceName===k.device&&e.includes(t.vrf)),r=t.reduce((e,t)=>e+Number(t.ipv4Routes??0),0),i=t.reduce((e,t)=>e+Number(t.ipv6Routes??0),0),a=n.filter(e=>String(e.sessionState??``).toUpperCase().includes(`ESTABLISHED`)).length;return(0,I.jsxs)(`div`,{className:`rounded-md border bg-muted/20 p-3 text-xs`,children:[(0,I.jsxs)(`div`,{className:`flex flex-wrap items-center justify-between gap-2`,children:[(0,I.jsxs)(`div`,{className:`text-muted-foreground`,children:[`Routing context for`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:e.slice(0,3).join(`, `)}),e.length>3?``:``]}),(0,I.jsx)(R,{variant:`outline`,className:`h-7 px-2`,onClick:()=>{_e(k.device),ve(e[0]??`all`)},children:`View in Routing tab`})]}),(0,I.jsxs)(`div`,{className:`mt-2 grid grid-cols-2 gap-2`,children:[(0,I.jsxs)(`div`,{children:[`FIB routes (sum):`,` `,(0,I.jsxs)(`span`,{className:`font-mono`,children:[`v4=`,r,` v6=`,i]})]}),(0,I.jsxs)(`div`,{className:`text-right`,children:[`BGP neighbors:`,` `,(0,I.jsxs)(`span`,{className:`font-mono`,children:[n.length,` (`,a,` established)`]})]})]})]})})(),(0,I.jsxs)(`div`,{className:`grid grid-cols-2 gap-3 text-xs text-muted-foreground`,children:[(0,I.jsxs)(`div`,{children:[`p95:`,` `,a.startsWith(`util_`)?Hd(k.p95??He.p95??void 0):Ud(k.p95??He.p95??void 0)]}),(0,I.jsxs)(`div`,{className:`text-right`,children:[`max:`,` `,a.startsWith(`util_`)?Hd(k.max??He.max??void 0):Ud(k.max??He.max??void 0)]}),(0,I.jsxs)(`div`,{children:[`slope/day:`,` `,a.startsWith(`util_`)?Hd(k.slopePerDay):Ud(k.slopePerDay)]}),(0,I.jsxs)(`div`,{className:`text-right`,children:[`forecast:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:k.forecastCrossingTs??``})]}),(0,I.jsxs)(`div`,{children:[`speed: `,Wd(k.speedMbps??null)]}),(0,I.jsxs)(`div`,{className:`text-right`,children:[`p95 (Gbps): `,(()=>{if(!a.startsWith(`util_`))return``;let e=Number(k.speedMbps??0),t=Number(k.p95??He.p95??NaN);return!e||!Number.isFinite(t)?``:(t*e/1e3).toFixed(2)})()]})]})]}):null]})}),(0,I.jsx)(Xn,{open:!!A,onOpenChange:e=>!e&&ae(null),children:(0,I.jsxs)($n,{className:`max-w-3xl`,children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{className:`text-base`,children:`Device Trend`})}),A?(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsxs)(`div`,{className:`text-sm`,children:[(0,I.jsx)(`span`,{className:`font-mono text-xs`,children:A.device}),` `,(0,I.jsx)(K,{variant:`outline`,className:`ml-2`,children:n}),(0,I.jsx)(K,{variant:`secondary`,className:`ml-2`,children:c})]}),ze.isLoading?(0,I.jsx)(G,{className:`h-24 w-full`}):ze.isError?(0,I.jsx)(`div`,{className:`text-sm text-destructive`,children:`Failed to load history`}):(0,I.jsx)(id,{points:Ve}),(0,I.jsxs)(`div`,{className:`grid grid-cols-2 gap-3 text-xs text-muted-foreground`,children:[(0,I.jsxs)(`div`,{children:[`p95:`,` `,Hd(A.p95??Ue.p95??void 0)]}),(0,I.jsxs)(`div`,{className:`text-right`,children:[`max:`,` `,Hd(A.max??Ue.max??void 0)]}),(0,I.jsxs)(`div`,{children:[`slope/day: `,Hd(A.slopePerDay)]}),(0,I.jsxs)(`div`,{className:`text-right`,children:[`forecast:`,` `,(0,I.jsx)(`span`,{className:`font-mono`,children:A.forecastCrossingTs??``})]})]})]}):null]})}),(0,I.jsx)(Xn,{open:ce,onOpenChange:e=>!e&&le(!1),children:(0,I.jsxs)($n,{className:`max-w-2xl`,children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{className:`text-base`,children:`Pick Interface`})}),(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsx)(J,{placeholder:`Search device/interface`,value:ue,onChange:e=>de(e.target.value)}),(0,I.jsx)(`div`,{className:`max-h-[55vh] overflow-auto rounded-md border`,children:(()=>{let e=M.data?.interfaces??[],t=ue.trim().toLowerCase(),n=(t?e.filter(e=>{let n=String(e.deviceName??``).toLowerCase(),r=String(e.interfaceName??``).toLowerCase();return n.includes(t)||r.includes(t)}):e).slice(0,200);return n.length?(0,I.jsx)(`div`,{className:`divide-y`,children:n.map(e=>{let t=String(e.deviceName??``),n=String(e.interfaceName??``),r=Wd(e.speedMbps??null);return(0,I.jsx)(`button`,{type:`button`,className:`w-full px-3 py-2 text-left hover:bg-muted/40`,onClick:()=>{ie({id:`${t}:${n}:INGRESS:pick`,device:t,iface:n,dir:`INGRESS`,speedMbps:e.speedMbps??null,admin:e.adminStatus??void 0,oper:e.operStatus??void 0,samples:0}),le(!1)},children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsxs)(`div`,{className:`font-mono text-xs`,children:[t,` `,n]}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:r})]})},`${t}:${n}`)})}):(0,I.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:`No matches.`})})()}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Loads a trend directly from Forward perf history (not limited to the top-50 rollups).`})]})]})}),(0,I.jsx)(Xn,{open:ye,onOpenChange:e=>!e&&be(!1),children:(0,I.jsxs)($n,{className:`max-w-4xl`,children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{className:`text-base`,children:`TCAM Evidence`})}),(0,I.jsx)(`pre`,{className:`max-h-[70vh] overflow-auto rounded-md border bg-muted/40 p-3 text-xs`,children:xe||``})]})}),(0,I.jsx)(Xn,{open:fe,onOpenChange:e=>!e&&pe(!1),children:(0,I.jsxs)($n,{className:`max-w-2xl`,children:[(0,I.jsx)(er,{children:(0,I.jsx)(nr,{className:`text-base`,children:`Pick Device`})}),(0,I.jsxs)(`div`,{className:`space-y-3`,children:[(0,I.jsx)(J,{placeholder:`Search device`,value:me,onChange:e=>he(e.target.value)}),(0,I.jsx)(`div`,{className:`max-h-[55vh] overflow-auto rounded-md border`,children:(()=>{let e=M.data?.devices??[],t=me.trim().toLowerCase(),n=(t?e.filter(e=>{let n=String(e.deviceName??``).toLowerCase(),r=String(e.vendor??``).toLowerCase(),i=String(e.os??``).toLowerCase();return n.includes(t)||r.includes(t)||i.includes(t)}):e).slice(0,200);return n.length?(0,I.jsx)(`div`,{className:`divide-y`,children:n.map(e=>{let t=String(e.deviceName??``);return(0,I.jsx)(`button`,{type:`button`,className:`w-full px-3 py-2 text-left hover:bg-muted/40`,onClick:()=>{ae({id:`${t}:pick`,device:t,metric:c,vendor:e.vendor??void 0,os:e.os??void 0,model:e.model??void 0,samples:0}),pe(!1)},children:(0,I.jsxs)(`div`,{className:`flex items-center justify-between gap-3`,children:[(0,I.jsx)(`div`,{className:`font-mono text-xs`,children:t}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:[e.vendor??``,e.os??``].filter(Boolean).join(`  `)||``})]})},t)})}):(0,I.jsx)(`div`,{className:`p-4 text-sm text-muted-foreground`,children:`No matches.`})})()}),(0,I.jsx)(`div`,{className:`text-xs text-muted-foreground`,children:`Loads a trend directly from Forward perf history.`})]})]})})]}):(0,I.jsxs)(`div`,{className:`space-y-6 p-6`,children:[(0,I.jsxs)(`div`,{className:`flex items-center gap-3`,children:[(0,I.jsx)(m,{to:`/dashboard/deployments/$deploymentId`,params:{deploymentId:e},className:So({variant:`outline`,size:`icon`,className:`h-9 w-9`}),children:(0,I.jsx)(it,{className:`h-4 w-4`})}),(0,I.jsx)(`h1`,{className:`text-2xl font-bold tracking-tight`,children:`Capacity`})]}),(0,I.jsx)(z,{children:(0,I.jsx)(U,{className:`pt-6 text-sm text-muted-foreground`,children:`Deployment not found.`})})]})}var Yd=ys.update({id:`/webhooks`,path:`/webhooks`,getParentRoute:()=>ds}),Xd=Ss.update({id:`/syslog`,path:`/syslog`,getParentRoute:()=>ds}),Zd=Es.update({id:`/status`,path:`/status`,getParentRoute:()=>ds}),Qd=js.update({id:`/snmp`,path:`/snmp`,getParentRoute:()=>ds}),$d=Ks.update({id:`/notifications`,path:`/notifications`,getParentRoute:()=>ds}),ef=lc.update({id:`/design`,path:`/design`,getParentRoute:()=>ds}),tf=dc.update({id:`/`,path:`/`,getParentRoute:()=>ds}),nf=pc.update({id:`/docs/`,path:`/docs/`,getParentRoute:()=>ds}),rf=mc.update({id:`/dashboard/`,path:`/dashboard/`,getParentRoute:()=>ds}),af=gc.update({id:`/admin/`,path:`/admin/`,getParentRoute:()=>ds}),of=vc.update({id:`/docs/$slug`,path:`/docs/$slug`,getParentRoute:()=>ds}),sf=Wc.update({id:`/dashboard/settings`,path:`/dashboard/settings`,getParentRoute:()=>ds}),cf=qc.update({id:`/dashboard/servicenow`,path:`/dashboard/servicenow`,getParentRoute:()=>ds}),lf=Yc.update({id:`/dashboard/s3`,path:`/dashboard/s3`,getParentRoute:()=>ds}),uf=Zc.update({id:`/dashboard/policy-reports`,path:`/dashboard/policy-reports`,getParentRoute:()=>ds}),df=$c.update({id:`/dashboard/integrations`,path:`/dashboard/integrations`,getParentRoute:()=>ds}),ff=tl.update({id:`/dashboard/forward`,path:`/dashboard/forward`,getParentRoute:()=>ds}),pf=rl.update({id:`/dashboard/elastic`,path:`/dashboard/elastic`,getParentRoute:()=>ds}),mf=cl.update({id:`/admin/settings`,path:`/admin/settings`,getParentRoute:()=>ds}),hf=fl.update({id:`/admin/governance`,path:`/admin/governance`,getParentRoute:()=>ds}),gf=hl.update({id:`/dashboard/runs/`,path:`/dashboard/runs/`,getParentRoute:()=>ds}),_f=vl.update({id:`/dashboard/fwd/`,path:`/dashboard/fwd/`,getParentRoute:()=>ds}),vf=xl.update({id:`/dashboard/docs/`,path:`/dashboard/docs/`,getParentRoute:()=>ds}),yf=Cl.update({id:`/dashboard/deployments/`,path:`/dashboard/deployments/`,getParentRoute:()=>ds}),bf=Dl.update({id:`/dashboard/runs/$runId`,path:`/dashboard/runs/$runId`,getParentRoute:()=>ds}),xf=Zl.update({id:`/dashboard/labs/map`,path:`/dashboard/labs/map`,getParentRoute:()=>ds}),Sf=au.update({id:`/dashboard/labs/designer`,path:`/dashboard/labs/designer`,getParentRoute:()=>ds}),Cf=_u.update({id:`/dashboard/fwd/collector`,path:`/dashboard/fwd/collector`,getParentRoute:()=>ds}),wf=bu.update({id:`/dashboard/docs/$slug`,path:`/dashboard/docs/$slug`,getParentRoute:()=>ds}),Tf=Du.update({id:`/dashboard/deployments/new`,path:`/dashboard/deployments/new`,getParentRoute:()=>ds}),Ef=ju.update({id:`/dashboard/deployments/$deploymentId/`,path:`/dashboard/deployments/$deploymentId/`,getParentRoute:()=>ds}),Df=Ru.update({id:`/dashboard/fwd/$networkRef/traffic-scenarios`,path:`/dashboard/fwd/$networkRef/traffic-scenarios`,getParentRoute:()=>ds}),Of=Qu.update({id:`/dashboard/fwd/$networkRef/hub`,path:`/dashboard/fwd/$networkRef/hub`,getParentRoute:()=>ds}),kf=od.update({id:`/dashboard/fwd/$networkRef/capacity`,path:`/dashboard/fwd/$networkRef/capacity`,getParentRoute:()=>ds}),Af=bd.update({id:`/dashboard/fwd/$networkRef/assurance-studio`,path:`/dashboard/fwd/$networkRef/assurance-studio`,getParentRoute:()=>ds}),jf=kd.update({id:`/dashboard/fwd/$networkRef/assurance`,path:`/dashboard/fwd/$networkRef/assurance`,getParentRoute:()=>ds}),Mf=Pd.update({id:`/dashboard/deployments/$deploymentId/map`,path:`/dashboard/deployments/$deploymentId/map`,getParentRoute:()=>ds}),Nf={IndexRoute:tf,DesignRoute:ef,NotificationsRoute:$d,SnmpRoute:Qd,StatusRoute:Zd,SyslogRoute:Xd,WebhooksRoute:Yd,AdminGovernanceRoute:hf,AdminSettingsRoute:mf,DashboardElasticRoute:pf,DashboardForwardRoute:ff,DashboardIntegrationsRoute:df,DashboardPolicyReportsRoute:uf,DashboardS3Route:lf,DashboardServicenowRoute:cf,DashboardSettingsRoute:sf,DocsSlugRoute:of,AdminIndexRoute:af,DashboardIndexRoute:rf,DocsIndexRoute:nf,DashboardDeploymentsNewRoute:Tf,DashboardDocsSlugRoute:wf,DashboardFwdCollectorRoute:Cf,DashboardLabsDesignerRoute:Sf,DashboardLabsMapRoute:xf,DashboardRunsRunIdRoute:bf,DashboardDeploymentsIndexRoute:yf,DashboardDocsIndexRoute:vf,DashboardFwdIndexRoute:_f,DashboardRunsIndexRoute:gf,DashboardDeploymentsDeploymentIdCapacityRoute:Id.update({id:`/dashboard/deployments/$deploymentId/capacity`,path:`/dashboard/deployments/$deploymentId/capacity`,getParentRoute:()=>ds}),DashboardDeploymentsDeploymentIdMapRoute:Mf,DashboardFwdNetworkRefAssuranceRoute:jf,DashboardFwdNetworkRefAssuranceStudioRoute:Af,DashboardFwdNetworkRefCapacityRoute:kf,DashboardFwdNetworkRefHubRoute:Of,DashboardFwdNetworkRefTrafficScenariosRoute:Df,DashboardDeploymentsDeploymentIdIndexRoute:Ef};const Pf=p({routeTree:ds._addFileChildren(Nf)._addFileTypes(),defaultPreload:`intent`,defaultPreloadDelay:50,context:{queryClient:void 0}});var Ff=new a({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1,staleTime:1e4}}});Yn.createRoot(document.getElementById(`root`)).render((0,I.jsx)(P.StrictMode,{children:(0,I.jsx)(l,{client:Ff,children:(0,I.jsx)(u,{router:Pf,context:{queryClient:Ff}})})}));